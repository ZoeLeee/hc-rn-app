"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[480],{98878:(e,t,i)=>{var r=i(15631),s=i(73803),n=i(67759),a=i(72208);class o{static AddFlare(e,t,i,r,s){return new o(e,t,i,r,s)}constructor(e,t,i,o,l){this.size=e,this.position=t,this.alphaMode=6,this.color=i||new r.Wo(1,1,1),this.texture=o?new s.x(o,l.getScene(),!0):null,this._system=l;const h=l.scene.getEngine();this._drawWrapper=new n.q(h),this._drawWrapper.effect=h.createEffect("lensFlare",[a.o.PositionKind],["color","viewportMatrix"],["textureSampler"],""),l.lensFlares.push(this)}dispose(){this.texture&&this.texture.dispose();const e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)}}var l=i(13514),h=i(58095),u=i(72739),c=i(15210),d=i(1316),m=i(98163),g=(i(99476),i(40971),i(77851));class p{get scene(){return this._scene}constructor(e,t,i){this.name=e,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=i||c.l.LastCreatedScene,p._SceneComponentInitialization(this._scene),this._emitter=t,this.id=e,i.lensFlareSystems.push(this),this.meshesSelectionPredicate=e=>i.activeCamera&&e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&i.activeCamera.layerMask);const r=i.getEngine(),s=[];s.push(1,1),s.push(-1,1),s.push(-1,-1),s.push(1,-1),this._vertexBuffers[a.o.PositionKind]=new a.o(r,s,a.o.PositionKind,!1,!1,2),this._createIndexBuffer()}_createIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}get isEnabled(){return this._isEnabled}set isEnabled(e){this._isEnabled=e}getScene(){return this._scene}getEmitter(){return this._emitter}setEmitter(e){this._emitter=e}getEmitterPosition(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position}computeEffectivePosition(e){let t=this.getEmitterPosition();t=h.P.Project(t,h.y3.Identity(),this._scene.getTransformMatrix(),e),this._positionX=t.x,this._positionY=t.y,t=h.P.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(e.x-=this.viewportBorder,e.y-=this.viewportBorder,e.width+=2*this.viewportBorder,e.height+=2*this.viewportBorder,t.x+=this.viewportBorder,t.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder);const i=this._scene.useRightHandedSystem;return!!(t.z>0&&!i||t.z<0&&i)&&(this._positionX>e.x&&this._positionX<e.x+e.width&&this._positionY>e.y&&(this._positionY,e.y,e.height),!0)}_isVisible(){if(!this._isEnabled||!this._scene.activeCamera)return!1;const e=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),t=e.length();e.normalize();const i=new d.z(this._scene.activeCamera.globalPosition,e),r=this._scene.pickWithRay(i,this.meshesSelectionPredicate,!0);return!r||!r.hit||r.distance>t}render(){if(!this._scene.activeCamera)return!1;const e=this._scene.getEngine(),t=this._scene.activeCamera.viewport.toGlobal(e.getRenderWidth(!0),e.getRenderHeight(!0));if(!this.computeEffectivePosition(t))return!1;if(!this._isVisible())return!1;let i,r;i=this._positionX<this.borderLimit+t.x?this.borderLimit+t.x-this._positionX:this._positionX>t.x+t.width-this.borderLimit?this._positionX-t.x-t.width+this.borderLimit:0,r=this._positionY<this.borderLimit+t.y?this.borderLimit+t.y-this._positionY:this._positionY>t.y+t.height-this.borderLimit?this._positionY-t.y-t.height+this.borderLimit:0;let s=i>r?i:r;s-=this.viewportBorder,s>this.borderLimit&&(s=this.borderLimit);let n=1-u.R.Clamp(s/this.borderLimit,0,1);if(n<0)return!1;n>1&&(n=1),this.viewportBorder>0&&(t.x+=this.viewportBorder,t.y+=this.viewportBorder,t.width-=2*this.viewportBorder,t.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);const a=t.x+t.width/2,o=t.y+t.height/2,l=a-this._positionX,c=o-this._positionY;e.setState(!1),e.setDepthBuffer(!1);for(let i=0;i<this.lensFlares.length;i++){const r=this.lensFlares[i];if(!r._drawWrapper.effect.isReady()||r.texture&&!r.texture.isReady())continue;e.enableEffect(r._drawWrapper),e.bindBuffers(this._vertexBuffers,this._indexBuffer,r._drawWrapper.effect),e.setAlphaMode(r.alphaMode);const s=a-l*r.position,u=o-c*r.position,d=r.size,g=r.size*e.getAspectRatio(this._scene.activeCamera,!0),p=s/(t.width+2*t.x)*2-1,_=1-u/(t.height+2*t.y)*2,f=h.y3.FromValues(d/2,0,0,0,0,g/2,0,0,0,0,1,0,p,_,0,1);r._drawWrapper.effect.setMatrix("viewportMatrix",f),r._drawWrapper.effect.setTexture("textureSampler",r.texture),r._drawWrapper.effect.setFloat4("color",r.color.r*n,r.color.g*n,r.color.b*n,1),e.drawElementsType(m.F.TriangleFillMode,0,6)}return e.setDepthBuffer(!0),e.setAlphaMode(0),!0}rebuild(){var e;this._createIndexBuffer();for(const t in this._vertexBuffers)null===(e=this._vertexBuffers[t])||void 0===e||e._rebuild()}dispose(){const e=this._vertexBuffers[a.o.PositionKind];for(e&&(e.dispose(),this._vertexBuffers[a.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();const t=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(t,1)}static Parse(e,t,i){const s=t.getLastEntryById(e.emitterId),n=e.name||"lensFlareSystem#"+e.emitterId,a=new p(n,s,t);a.id=e.id||n,a.borderLimit=e.borderLimit;for(let t=0;t<e.flares.length;t++){const s=e.flares[t];o.AddFlare(s.size,s.position,r.Wo.FromArray(s.color),s.textureName?i+s.textureName:"",a)}return a}serialize(){const e={};e.id=this.id,e.name=this.name,e.emitterId=this.getEmitter().id,e.borderLimit=this.borderLimit,e.flares=[];for(let t=0;t<this.lensFlares.length;t++){const i=this.lensFlares[t];e.flares.push({size:i.size,position:i.position,color:i.color.asArray(),textureName:l.w1.GetFilename(i.texture?i.texture.name:"")})}return e}}p._SceneComponentInitialization=e=>{throw(0,g.S)("LensFlareSystemSceneComponent")};var _=i(85627),f=i(57755);f.p.AddParser(_.l.NAME_LENSFLARESYSTEM,((e,t,i,r)=>{if(void 0!==e.lensFlareSystems&&null!==e.lensFlareSystems){i.lensFlareSystems||(i.lensFlareSystems=new Array);for(let s=0,n=e.lensFlareSystems.length;s<n;s++){const n=e.lensFlareSystems[s],a=p.Parse(n,t,r);i.lensFlareSystems.push(a)}}})),f.p.prototype.getLensFlareSystemByName=function(e){for(let t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},f.p.prototype.getLensFlareSystemById=function(e){for(let t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===e)return this.lensFlareSystems[t];return null},f.p.prototype.getLensFlareSystemByID=function(e){return this.getLensFlareSystemById(e)},f.p.prototype.removeLensFlareSystem=function(e){const t=this.lensFlareSystems.indexOf(e);return-1!==t&&this.lensFlareSystems.splice(t,1),t},f.p.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};class S{constructor(e){this.name=_.l.NAME_LENSFLARESYSTEM,this.scene=e,e.lensFlareSystems=new Array}register(){this.scene._afterCameraDrawStage.registerStep(_.l.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)}rebuild(){for(let e=0;e<this.scene.lensFlareSystems.length;e++)this.scene.lensFlareSystems[e].rebuild()}addFromContainer(e){e.lensFlareSystems&&e.lensFlareSystems.forEach((e=>{this.scene.addLensFlareSystem(e)}))}removeFromContainer(e,t){e.lensFlareSystems&&e.lensFlareSystems.forEach((e=>{this.scene.removeLensFlareSystem(e),t&&e.dispose()}))}serialize(e){e.lensFlareSystems=[];const t=this.scene.lensFlareSystems;for(const i of t)e.lensFlareSystems.push(i.serialize())}dispose(){const e=this.scene.lensFlareSystems;for(;e.length;)e[0].dispose()}_draw(e){if(this.scene.lensFlaresEnabled){const t=this.scene.lensFlareSystems;l.w1.StartPerformanceCounter("Lens flares",t.length>0);for(const i of t)0!=(e.layerMask&i.layerMask)&&i.render();l.w1.EndPerformanceCounter("Lens flares",t.length>0)}}}p._SceneComponentInitialization=e=>{let t=e._getComponent(_.l.NAME_LENSFLARESYSTEM);t||(t=new S(e),e._addComponent(t))}},89118:(e,t,i)=>{i.d(t,{uX:()=>r.u});var r=i(89982),s=i(58095),n=i(63784),a=(i(85138),i(61380),i(9669),i(77851)),o=i(91859),l=i(39521),h=i(84318),u=i(15210);const c=s.P.Up(),d=s.P.Zero(),m=new s.P,g=new s.P,p=new s.y3;class _ extends r.u{_validateFilter(e){return e===r.u.FILTER_NONE||e===r.u.FILTER_PCF||e===r.u.FILTER_PCSS?e:(console.error('Unsupported filter "'+e+'"!'),r.u.FILTER_NONE)}get numCascades(){return this._numCascades}set numCascades(e){(e=Math.min(Math.max(e,_.MIN_CASCADES_COUNT),_.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=e,this.recreateShadowMap(),this._recreateSceneUBOs())}get freezeShadowCastersBoundingInfo(){return this._freezeShadowCastersBoundingInfo}set freezeShadowCastersBoundingInfo(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()}_computeShadowCastersBoundingInfo(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){const e=this._shadowMap.renderList;for(let t=0;t<e.length;t++){const i=e[t];if(!i)continue;const r=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld)}const t=this._scene.meshes;for(let e=0;e<t.length;e++){const i=t[e];if(!(i&&i.isVisible&&i.isEnabled&&i.receiveShadows))continue;const r=i.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld)}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)}get shadowCastersBoundingInfo(){return this._shadowCastersBoundingInfo}set shadowCastersBoundingInfo(e){this._shadowCastersBoundingInfo=e}setMinMaxDistance(e,t){this._minDistance===e&&this._maxDistance===t||(e>t&&(e=0,t=1),e<0&&(e=0),t>1&&(t=1),this._minDistance=e,this._maxDistance=t,this._breaksAreDirty=!0)}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}getClassName(){return _.CLASSNAME}getCascadeMinExtents(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null}getCascadeMaxExtents(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null}get shadowMaxZ(){return this._getCamera()?this._shadowMaxZ:0}set shadowMaxZ(e){const t=this._getCamera();t?this._shadowMaxZ===e||e<t.minZ||e>t.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e}get debug(){return this._debug}set debug(e){this._debug=e,this._light._markMeshesAsLightDirty()}get depthClamp(){return this._depthClamp}set depthClamp(e){this._depthClamp=e}get cascadeBlendPercentage(){return this._cascadeBlendPercentage}set cascadeBlendPercentage(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()}get lambda(){return this._lambda}set lambda(e){const t=Math.min(Math.max(e,0),1);this._lambda!=t&&(this._lambda=t,this._breaksAreDirty=!0)}getCascadeViewMatrix(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null}getCascadeProjectionMatrix(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null}getCascadeTransformMatrix(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null}setDepthRenderer(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)}get autoCalcDepthBounds(){return this._autoCalcDepthBounds}set autoCalcDepthBounds(e){const t=this._getCamera();if(t){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new l.j(t),this._depthReducer.onAfterReductionPerformed.add((e=>{let t=e.min,i=e.max;t>=i&&(t=0,i=1),t==this._minDistance&&i==this._maxDistance||this.setMinMaxDistance(t,i)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}}get autoCalcDepthBoundsRefreshRate(){var e,t,i;return null!==(i=null===(t=null===(e=this._depthReducer)||void 0===e?void 0:e.depthRenderer)||void 0===t?void 0:t.getDepthMap().refreshRate)&&void 0!==i?i:-1}set autoCalcDepthBoundsRefreshRate(e){var t;(null===(t=this._depthReducer)||void 0===t?void 0:t.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)}splitFrustum(){this._breaksAreDirty=!0}_splitFrustum(){const e=this._getCamera();if(!e)return;const t=e.minZ,i=e.maxZ,r=i-t,s=this._minDistance,n=t+s*r,a=t+(this._shadowMaxZ<i&&this._shadowMaxZ>=t?Math.min((this._shadowMaxZ-t)/(i-t),this._maxDistance):this._maxDistance)*r,o=a-n,l=a/n;for(let e=0;e<this._cascades.length;++e){const i=(e+1)/this._numCascades,a=n*l**i,h=n+o*i,u=this._lambda*(a-h)+h;this._cascades[e].prevBreakDistance=0===e?s:this._cascades[e-1].breakDistance,this._cascades[e].breakDistance=(u-t)/r,this._viewSpaceFrustumsZ[e]=u,this._frustumLengths[e]=(this._cascades[e].breakDistance-this._cascades[e].prevBreakDistance)*r}this._breaksAreDirty=!1}_computeMatrices(){const e=this._scene;if(!this._getCamera())return;s.P.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(s.P.Dot(this._lightDirection,s.P.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);const t=e.getEngine().useReverseDepthBuffer;for(let i=0;i<this._numCascades;++i){this._computeFrustumInWorldSpace(i),this._computeCascadeFrustum(i),this._cascadeMaxExtents[i].subtractToRef(this._cascadeMinExtents[i],m),this._frustumCenter[i].addToRef(this._lightDirection.scale(this._cascadeMinExtents[i].z),this._shadowCameraPos[i]),s.y3.LookAtLHToRef(this._shadowCameraPos[i],this._frustumCenter[i],c,this._viewMatrices[i]);let n=0,a=m.z;const o=this._shadowCastersBoundingInfo;o.update(this._viewMatrices[i]),a=Math.min(a,o.boundingBox.maximumWorld.z),n=this._depthClamp&&this.filter!==r.u.FILTER_PCSS?Math.max(n,o.boundingBox.minimumWorld.z):Math.min(n,o.boundingBox.minimumWorld.z),s.y3.OrthoOffCenterLHToRef(this._cascadeMinExtents[i].x,this._cascadeMaxExtents[i].x,this._cascadeMinExtents[i].y,this._cascadeMaxExtents[i].y,t?a:n,t?n:a,this._projectionMatrices[i],e.getEngine().isNDCHalfZRange),this._cascadeMinExtents[i].z=n,this._cascadeMaxExtents[i].z=a,this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),s.P.TransformCoordinatesToRef(d,this._transformMatrices[i],m),m.scaleInPlace(this._mapSize/2),g.copyFromFloats(Math.round(m.x),Math.round(m.y),Math.round(m.z)),g.subtractInPlace(m).scaleInPlace(2/this._mapSize),s.y3.TranslationToRef(g.x,g.y,0,p),this._projectionMatrices[i].multiplyToRef(p,this._projectionMatrices[i]),this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),this._transformMatrices[i].copyToArray(this._transformMatricesAsArray,16*i)}}_computeFrustumInWorldSpace(e){const t=this._getCamera();if(!t)return;const i=this._cascades[e].prevBreakDistance,r=this._cascades[e].breakDistance,n=this._scene.getEngine().isNDCHalfZRange;t.getViewMatrix();const a=s.y3.Invert(t.getTransformationMatrix()),o=this._scene.getEngine().useReverseDepthBuffer?4:0;for(let t=0;t<_._FrustumCornersNDCSpace.length;++t)m.copyFrom(_._FrustumCornersNDCSpace[(t+o)%_._FrustumCornersNDCSpace.length]),n&&-1===m.z&&(m.z=0),s.P.TransformCoordinatesToRef(m,a,this._frustumCornersWorldSpace[e][t]);for(let t=0;t<_._FrustumCornersNDCSpace.length/2;++t)m.copyFrom(this._frustumCornersWorldSpace[e][t+4]).subtractInPlace(this._frustumCornersWorldSpace[e][t]),g.copyFrom(m).scaleInPlace(i),m.scaleInPlace(r),m.addInPlace(this._frustumCornersWorldSpace[e][t]),this._frustumCornersWorldSpace[e][t+4].copyFrom(m),this._frustumCornersWorldSpace[e][t].addInPlace(g)}_computeCascadeFrustum(e){this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0);if(this._getCamera()){for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][t]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){let t=0;for(let i=0;i<this._frustumCornersWorldSpace[e].length;++i){const r=this._frustumCornersWorldSpace[e][i].subtractToRef(this._frustumCenter[e],m).length();t=Math.max(t,r)}t=Math.ceil(16*t)/16,this._cascadeMaxExtents[e].copyFromFloats(t,t,t),this._cascadeMinExtents[e].copyFromFloats(-t,-t,-t)}else{const t=this._frustumCenter[e];this._frustumCenter[e].addToRef(this._lightDirection,m),s.y3.LookAtLHToRef(t,m,c,p);for(let t=0;t<this._frustumCornersWorldSpace[e].length;++t)s.P.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][t],p,m),this._cascadeMinExtents[e].minimizeInPlace(m),this._cascadeMaxExtents[e].maximizeInPlace(m)}}}_recreateSceneUBOs(){if(this._disposeSceneUBOs(),this._sceneUBOs)for(let e=0;e<this._numCascades;++e)this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for CSM Shadow Generator (light "${this._light.name}" cascade #${e})`))}static get IsSupported(){const e=u.l.LastCreatedEngine;return!!e&&e._features.supportCSM}constructor(e,t,i,r){_.IsSupported?(super(e,t,i,r),this.usePercentageCloserFiltering=!0):h.Y.Error("CascadedShadowMap is not supported by the current engine.")}_initializeGenerator(){var e,t,i,r,n,a,l,h,u,c,d,m,g,p,f,S,x,C,N,T;this.penumbraDarkness=null!==(e=this.penumbraDarkness)&&void 0!==e?e:1,this._numCascades=null!==(t=this._numCascades)&&void 0!==t?t:_.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=null!==(i=this.stabilizeCascades)&&void 0!==i&&i,this._freezeShadowCastersBoundingInfoObservable=null!==(r=this._freezeShadowCastersBoundingInfoObservable)&&void 0!==r?r:null,this.freezeShadowCastersBoundingInfo=null!==(n=this.freezeShadowCastersBoundingInfo)&&void 0!==n&&n,this._scbiMin=null!==(a=this._scbiMin)&&void 0!==a?a:new s.P(0,0,0),this._scbiMax=null!==(l=this._scbiMax)&&void 0!==l?l:new s.P(0,0,0),this._shadowCastersBoundingInfo=null!==(h=this._shadowCastersBoundingInfo)&&void 0!==h?h:new o.j(new s.P(0,0,0),new s.P(0,0,0)),this._breaksAreDirty=null===(u=this._breaksAreDirty)||void 0===u||u,this._minDistance=null!==(c=this._minDistance)&&void 0!==c?c:0,this._maxDistance=null!==(d=this._maxDistance)&&void 0!==d?d:1,this._currentLayer=null!==(m=this._currentLayer)&&void 0!==m?m:0,this._shadowMaxZ=null!==(f=null!==(g=this._shadowMaxZ)&&void 0!==g?g:null===(p=this._getCamera())||void 0===p?void 0:p.maxZ)&&void 0!==f?f:1e4,this._debug=null!==(S=this._debug)&&void 0!==S&&S,this._depthClamp=null===(x=this._depthClamp)||void 0===x||x,this._cascadeBlendPercentage=null!==(C=this._cascadeBlendPercentage)&&void 0!==C?C:.1,this._lambda=null!==(N=this._lambda)&&void 0!==N?N:.5,this._autoCalcDepthBounds=null!==(T=this._autoCalcDepthBounds)&&void 0!==T&&T,this._recreateSceneUBOs(),super._initializeGenerator()}_createTargetRenderTexture(){const e=this._scene.getEngine(),t={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new n._(this._light.name+"_CSMShadowMap",t,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0)}_initializeShadowMap(){if(super._initializeShadowMap(),null===this._shadowMap)return;this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(let e=0;e<this._numCascades;++e){this._cascades[e]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[e]=s.y3.Zero(),this._projectionMatrices[e]=s.y3.Zero(),this._transformMatrices[e]=s.y3.Zero(),this._cascadeMinExtents[e]=new s.P,this._cascadeMaxExtents[e]=new s.P,this._frustumCenter[e]=new s.P,this._shadowCameraPos[e]=new s.P,this._frustumCornersWorldSpace[e]=new Array(_._FrustumCornersNDCSpace.length);for(let t=0;t<_._FrustumCornersNDCSpace.length;++t)this._frustumCornersWorldSpace[e][t]=new s.P}const e=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.clear(),this._shadowMap.onBeforeRenderObservable.clear(),this._shadowMap.onBeforeRenderObservable.add((t=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[t]),this._currentLayer=t,this._filter===r.u.FILTER_PCF&&e.setColorWrite(!1),this._scene.setTransformMatrix(this.getCascadeViewMatrix(t),this.getCascadeProjectionMatrix(t)),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onBeforeBindObservable.add((()=>{var t;this._currentSceneUBO=this._scene.getSceneUniformBuffer(),null===(t=e._debugPushGroup)||void 0===t||t.call(e,`cascaded shadow map generation for pass id ${e.currentRenderPassId}`,1),this._breaksAreDirty&&this._splitFrustum(),this._computeMatrices()})),this._splitFrustum()}_bindCustomEffectForRenderSubMeshForShadowMap(e,t){t.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))}_isReadyCustomDefines(e){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==r.u.FILTER_PCSS?"1":"0"))}prepareDefines(e,t){super.prepareDefines(e,t);const i=this._scene,r=this._light;if(!i.shadowsEnabled||!r.shadowEnabled)return;e["SHADOWCSM"+t]=!0,e["SHADOWCSMDEBUG"+t]=this.debug,e["SHADOWCSMNUM_CASCADES"+t]=this.numCascades,e["SHADOWCSM_RIGHTHANDED"+t]=i.useRightHandedSystem;const s=this._getCamera();s&&this._shadowMaxZ<s.maxZ&&(e["SHADOWCSMUSESHADOWMAXZ"+t]=!0),0===this.cascadeBlendPercentage&&(e["SHADOWCSMNOBLEND"+t]=!0)}bindShadowLight(e,t){const i=this._light;if(!this._scene.shadowsEnabled||!i.shadowEnabled)return;const s=this._getCamera();if(!s)return;const n=this.getShadowMap();if(!n)return;const a=n.getSize().width;if(t.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),t.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),t.setFloat("cascadeBlendFactor"+e,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),t.setArray("frustumLengths"+e,this._frustumLengths),this._filter===r.u.FILTER_PCF)t.setDepthStencilTexture("shadowSampler"+e,n),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),a,1/a,this.frustumEdgeFalloff,e);else if(this._filter===r.u.FILTER_PCSS){for(let e=0;e<this._numCascades;++e)this._lightSizeUVCorrection[2*e+0]=0===e?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[e].x-this._cascadeMinExtents[e].x),this._lightSizeUVCorrection[2*e+1]=0===e?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[e].y-this._cascadeMinExtents[e].y),this._depthCorrection[e]=0===e?1:(this._cascadeMaxExtents[e].z-this._cascadeMinExtents[e].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);t.setDepthStencilTexture("shadowSampler"+e,n),t.setTexture("depthSampler"+e,n),t.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),t.setArray("depthCorrection"+e,this._depthCorrection),t.setFloat("penumbraDarkness"+e,this.penumbraDarkness),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/a,this._contactHardeningLightSizeUVRatio*a,this.frustumEdgeFalloff,e)}else t.setTexture("shadowSampler"+e,n),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),a,1/a,this.frustumEdgeFalloff,e);i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(s),this.getLight().getDepthMinZ(s)+this.getLight().getDepthMaxZ(s),e)}getTransformMatrix(){return this.getCascadeTransformMatrix(0)}dispose(){super.dispose(),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)}serialize(){const e=super.serialize(),t=this.getShadowMap();if(!t)return e;if(e.numCascades=this._numCascades,e.debug=this._debug,e.stabilizeCascades=this.stabilizeCascades,e.lambda=this._lambda,e.cascadeBlendPercentage=this.cascadeBlendPercentage,e.depthClamp=this._depthClamp,e.autoCalcDepthBounds=this.autoCalcDepthBounds,e.shadowMaxZ=this._shadowMaxZ,e.penumbraDarkness=this.penumbraDarkness,e.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.renderList=[],t.renderList)for(let i=0;i<t.renderList.length;i++){const r=t.renderList[i];e.renderList.push(r.id)}return e}static Parse(e,t){const i=r.u.Parse(e,t,((e,t,i)=>new _(e,t,void 0,i)));return void 0!==e.numCascades&&(i.numCascades=e.numCascades),void 0!==e.debug&&(i.debug=e.debug),void 0!==e.stabilizeCascades&&(i.stabilizeCascades=e.stabilizeCascades),void 0!==e.lambda&&(i.lambda=e.lambda),void 0!==e.cascadeBlendPercentage&&(i.cascadeBlendPercentage=e.cascadeBlendPercentage),void 0!==e.depthClamp&&(i.depthClamp=e.depthClamp),void 0!==e.autoCalcDepthBounds&&(i.autoCalcDepthBounds=e.autoCalcDepthBounds),void 0!==e.shadowMaxZ&&(i.shadowMaxZ=e.shadowMaxZ),void 0!==e.penumbraDarkness&&(i.penumbraDarkness=e.penumbraDarkness),void 0!==e.freezeShadowCastersBoundingInfo&&(i.freezeShadowCastersBoundingInfo=e.freezeShadowCastersBoundingInfo),void 0!==e.minDistance&&void 0!==e.maxDistance&&i.setMinMaxDistance(e.minDistance,e.maxDistance),i}}_._FrustumCornersNDCSpace=[new s.P(-1,1,-1),new s.P(1,1,-1),new s.P(1,-1,-1),new s.P(-1,-1,-1),new s.P(-1,1,1),new s.P(1,1,1),new s.P(1,-1,1),new s.P(-1,-1,1)],_.CLASSNAME="CascadedShadowGenerator",_.DEFAULT_CASCADES_COUNT=4,_.MIN_CASCADES_COUNT=2,_.MAX_CASCADES_COUNT=4,_._SceneComponentInitialization=e=>{throw(0,a.S)("ShadowGeneratorSceneComponent")};var f=i(85627);i(57755).p.AddParser(f.l.NAME_SHADOWGENERATOR,((e,t)=>{if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(let i=0,s=e.shadowGenerators.length;i<s;i++){const s=e.shadowGenerators[i];s.className===_.CLASSNAME?_.Parse(s,t):r.u.Parse(s,t)}}));class S{constructor(e){this.name=f.l.NAME_SHADOWGENERATOR,this.scene=e}register(){this.scene._gatherRenderTargetsStage.registerStep(f.l.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)}rebuild(){}serialize(e){e.shadowGenerators=[];const t=this.scene.lights;for(const i of t){const t=i.getShadowGenerators();if(t){const i=t.values();for(let t=i.next();!0!==t.done;t=i.next()){const i=t.value;e.shadowGenerators.push(i.serialize())}}}}addFromContainer(e){}removeFromContainer(e,t){}dispose(){}_gatherRenderTargets(e){const t=this.scene;if(this.scene.shadowsEnabled)for(let i=0;i<t.lights.length;i++){const r=t.lights[i],s=r.getShadowGenerators();if(r.isEnabled()&&r.shadowEnabled&&s){const i=s.values();for(let r=i.next();!0!==r.done;r=i.next()){const i=r.value.getShadowMap();-1!==t.textures.indexOf(i)&&e.push(i)}}}}}r.u._SceneComponentInitialization=e=>{let t=e._getComponent(f.l.NAME_SHADOWGENERATOR);t||(t=new S(e),e._addComponent(t))}},89982:(e,t,i)=>{i.d(t,{u:()=>S});var r=i(58095),s=i(15631),n=i(72208),a=i(43812),o=i(90360),l=i(73803),h=i(63784),u=i(16142),c=i(442),d=i(62897),m=i(77851),g=i(38309),p=i(70235),_=i(67759),f=(i(85138),i(61380),i(9669),i(97425),i(77633));class S{get bias(){return this._bias}set bias(e){this._bias=e}get normalBias(){return this._normalBias}set normalBias(e){this._normalBias=e}get blurBoxOffset(){return this._blurBoxOffset}set blurBoxOffset(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())}get blurScale(){return this._blurScale}set blurScale(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())}get blurKernel(){return this._blurKernel}set blurKernel(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())}get useKernelBlur(){return this._useKernelBlur}set useKernelBlur(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())}get depthScale(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()}set depthScale(e){this._depthScale=e}_validateFilter(e){return e}get filter(){return this._filter}set filter(e){if(e=this._validateFilter(e),this._light.needCube()){if(e===S.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(e===S.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(e===S.FILTER_PCF||e===S.FILTER_PCSS)return void(this.usePoissonSampling=!0)}e!==S.FILTER_PCF&&e!==S.FILTER_PCSS||this._scene.getEngine()._features.supportShadowSamplers?this._filter!==e&&(this._filter=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0}get usePoissonSampling(){return this.filter===S.FILTER_POISSONSAMPLING}set usePoissonSampling(e){const t=this._validateFilter(S.FILTER_POISSONSAMPLING);(e||this.filter===S.FILTER_POISSONSAMPLING)&&(this.filter=e?t:S.FILTER_NONE)}get useExponentialShadowMap(){return this.filter===S.FILTER_EXPONENTIALSHADOWMAP}set useExponentialShadowMap(e){const t=this._validateFilter(S.FILTER_EXPONENTIALSHADOWMAP);(e||this.filter===S.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=e?t:S.FILTER_NONE)}get useBlurExponentialShadowMap(){return this.filter===S.FILTER_BLUREXPONENTIALSHADOWMAP}set useBlurExponentialShadowMap(e){const t=this._validateFilter(S.FILTER_BLUREXPONENTIALSHADOWMAP);(e||this.filter===S.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=e?t:S.FILTER_NONE)}get useCloseExponentialShadowMap(){return this.filter===S.FILTER_CLOSEEXPONENTIALSHADOWMAP}set useCloseExponentialShadowMap(e){const t=this._validateFilter(S.FILTER_CLOSEEXPONENTIALSHADOWMAP);(e||this.filter===S.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t:S.FILTER_NONE)}get useBlurCloseExponentialShadowMap(){return this.filter===S.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP}set useBlurCloseExponentialShadowMap(e){const t=this._validateFilter(S.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(e||this.filter===S.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t:S.FILTER_NONE)}get usePercentageCloserFiltering(){return this.filter===S.FILTER_PCF}set usePercentageCloserFiltering(e){const t=this._validateFilter(S.FILTER_PCF);(e||this.filter===S.FILTER_PCF)&&(this.filter=e?t:S.FILTER_NONE)}get filteringQuality(){return this._filteringQuality}set filteringQuality(e){this._filteringQuality!==e&&(this._filteringQuality=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())}get useContactHardeningShadow(){return this.filter===S.FILTER_PCSS}set useContactHardeningShadow(e){const t=this._validateFilter(S.FILTER_PCSS);(e||this.filter===S.FILTER_PCSS)&&(this.filter=e?t:S.FILTER_NONE)}get contactHardeningLightSizeUVRatio(){return this._contactHardeningLightSizeUVRatio}set contactHardeningLightSizeUVRatio(e){this._contactHardeningLightSizeUVRatio=e}get darkness(){return this._darkness}set darkness(e){this.setDarkness(e)}getDarkness(){return this._darkness}setDarkness(e){return this._darkness=e>=1?1:e<=0?0:e,this}get transparencyShadow(){return this._transparencyShadow}set transparencyShadow(e){this.setTransparencyShadow(e)}setTransparencyShadow(e){return this._transparencyShadow=e,this}getShadowMap(){return this._shadowMap}getShadowMapForRendering(){return this._shadowMap2?this._shadowMap2:this._shadowMap}getClassName(){return S.CLASSNAME}addShadowCaster(e,t=!0){if(!this._shadowMap)return this;if(this._shadowMap.renderList||(this._shadowMap.renderList=[]),-1===this._shadowMap.renderList.indexOf(e)&&this._shadowMap.renderList.push(e),t)for(const t of e.getChildMeshes())-1===this._shadowMap.renderList.indexOf(t)&&this._shadowMap.renderList.push(t);return this}removeShadowCaster(e,t=!0){if(!this._shadowMap||!this._shadowMap.renderList)return this;const i=this._shadowMap.renderList.indexOf(e);if(-1!==i&&this._shadowMap.renderList.splice(i,1),t)for(const t of e.getChildren())this.removeShadowCaster(t);return this}getLight(){return this._light}_getCamera(){var e;return null!==(e=this._camera)&&void 0!==e?e:this._scene.activeCamera}get mapSize(){return this._mapSize}set mapSize(e){this._mapSize=e,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}constructor(e,t,i,s){this.onBeforeShadowMapRenderObservable=new d.y$,this.onAfterShadowMapRenderObservable=new d.y$,this.onBeforeShadowMapRenderMeshObservable=new d.y$,this.onAfterShadowMapRenderMeshObservable=new d.y$,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=S.FILTER_NONE,this._filteringQuality=S.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.useOpacityTextureForTransparentShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=r.P.Zero(),this._viewMatrix=r.y3.Zero(),this._projectionMatrix=r.y3.Zero(),this._transformMatrix=r.y3.Zero(),this._cachedPosition=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=r.y3.Identity(),this._mapSize=e,this._light=t,this._scene=t.getScene(),this._camera=null!=s?s:null;let n=t._shadowGenerators;n||(n=t._shadowGenerators=new Map),n.set(this._camera,this),this.id=t.id,this._useUBO=this._scene.getEngine().supportsUniformBuffers,this._useUBO&&(this._sceneUBOs=[],this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for Shadow Generator (light "${this._light.name}")`))),S._SceneComponentInitialization(this._scene);const a=this._scene.getEngine().getCaps();i?a.textureFloatRender&&a.textureFloatLinearFiltering?this._textureType=1:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?this._textureType=2:this._textureType=0:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?this._textureType=2:a.textureFloatRender&&a.textureFloatLinearFiltering?this._textureType=1:this._textureType=0,this._initializeGenerator(),this._applyFilterValues()}_initializeGenerator(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()}_createTargetRenderTexture(){const e=this._scene.getEngine();e._features.supportDepthStencilTexture?(this._shadowMap=new h._(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0)):this._shadowMap=new h._(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())}_initializeShadowMap(){if(this._createTargetRenderTexture(),null===this._shadowMap)return;this._shadowMap.wrapU=l.x.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=l.x.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(l.x.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.customIsReadyFunction=()=>!0;const e=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.add((()=>{var t;this._currentSceneUBO=this._scene.getSceneUniformBuffer(),null===(t=e._debugPushGroup)||void 0===t||t.call(e,`shadow map generation for pass id ${e.currentRenderPassId}`,1)})),this._shadowMap.onBeforeRenderObservable.add((t=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[0]),this._currentFaceIndex=t,this._filter===S.FILTER_PCF&&e.setColorWrite(!1),this.getTransformMatrix(),this._scene.setTransformMatrix(this._viewMatrix,this._projectionMatrix),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onAfterUnbindObservable.add((()=>{var t,i;if(this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._currentSceneUBO),this._scene.updateTransformMatrix(),this._filter===S.FILTER_PCF&&e.setColorWrite(!0),!this.useBlurExponentialShadowMap&&!this.useBlurCloseExponentialShadowMap)return void(null===(t=e._debugPopGroup)||void 0===t||t.call(e,1));const r=this.getShadowMapForRendering();r&&(this._scene.postProcessManager.directRender(this._blurPostProcesses,r.renderTarget,!0),e.unBindFramebuffer(r.renderTarget,!0),null===(i=e._debugPopGroup)||void 0===i||i.call(e,1))}));const t=new s.HE(0,0,0,0),i=new s.HE(1,1,1,1);this._shadowMap.onClearObservable.add((e=>{this._filter===S.FILTER_PCF?e.clear(i,!1,!0,!1):this.useExponentialShadowMap||this.useBlurExponentialShadowMap?e.clear(t,!0,!0,!1):e.clear(i,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((e=>{this._storedUniqueId=this._shadowMap.uniqueId,this._mapSize=e.getRenderSize(),this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}));for(let e=p.$.MIN_RENDERINGGROUPS;e<p.$.MAX_RENDERINGGROUPS;e++)this._shadowMap.setRenderingAutoClearDepthStencil(e,!1)}_initializeBlurRTTAndPostProcesses(){const e=this._scene.getEngine(),t=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new h._(this._light.name+"_shadowMap2",t,this._scene,!1,!0,this._textureType,void 0,void 0,!1),this._shadowMap2.wrapU=l.x.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=l.x.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(l.x.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new c.i(this._light.name+"KernelBlurX",new r.FM(1,0),this.blurKernel,1,null,l.x.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.width=t,this._kernelBlurXPostprocess.height=t,this._kernelBlurXPostprocess.externalTextureSamplerBinding=!0,this._kernelBlurXPostprocess.onApplyObservable.add((e=>{e.setTexture("textureSampler",this._shadowMap)})),this._kernelBlurYPostprocess=new c.i(this._light.name+"KernelBlurY",new r.FM(0,1),this.blurKernel,1,null,l.x.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,0===this._textureType&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new u.D(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,l.x.BILINEAR_SAMPLINGMODE,e,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.externalTextureSamplerBinding=!0,this._boxBlurPostprocess.onApplyObservable.add((e=>{e.setFloat2("screenSize",t,t),e.setTexture("textureSampler",this._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])}_renderForShadowMap(e,t,i,r){let s;if(r.length)for(s=0;s<r.length;s++)this._renderSubMeshForShadowMap(r.data[s]);for(s=0;s<e.length;s++)this._renderSubMeshForShadowMap(e.data[s]);for(s=0;s<t.length;s++)this._renderSubMeshForShadowMap(t.data[s]);if(this._transparencyShadow)for(s=0;s<i.length;s++)this._renderSubMeshForShadowMap(i.data[s],!0);else for(s=0;s<i.length;s++)i.data[s].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}_bindCustomEffectForRenderSubMeshForShadowMap(e,t,i){t.setMatrix("viewProjection",this.getTransformMatrix())}_renderSubMeshForShadowMap(e,t=!1){var i,r;const s=e.getRenderingMesh(),n=e.getEffectiveMesh(),l=this._scene,h=l.getEngine(),u=e.getMaterial();if(n._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!u||0===e.verticesCount||e._renderId===l.getRenderId())return;const c=n._getWorldMatrixDeterminant()<0;let d=null!==(i=s.overrideMaterialSideOrientation)&&void 0!==i?i:u.sideOrientation;c&&(d=0===d?1:0);const m=0===d;h.setState(u.backFaceCulling,void 0,void 0,m,u.cullBackFaces);const g=s._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(g.mustReturn)return;const p=h.getCaps().instancedArrays&&(null!==g.visibleInstances[e._id]&&void 0!==g.visibleInstances[e._id]||s.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(e))if(this.isReady(e,p,t)){e._renderId=l.getRenderId();const i=u.shadowDepthWrapper,c=null!==(r=null==i?void 0:i.getEffect(e,this,h.currentRenderPassId))&&void 0!==r?r:e._getDrawWrapper(),d=_.q.GetEffect(c);h.enableEffect(c),p||s._bind(e,d,u.fillMode),this.getTransformMatrix(),d.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===a._.LIGHTTYPEID_DIRECTIONALLIGHT?d.setVector3("lightDataSM",this._cachedDirection):d.setVector3("lightDataSM",this._cachedPosition);const m=this._getCamera();if(m&&d.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(m),this.getLight().getDepthMinZ(m)+this.getLight().getDepthMaxZ(m)),t&&this.enableSoftTransparentShadow&&d.setFloat("softTransparentShadowSM",n.visibility*u.alpha),i)e._setMainDrawWrapperOverride(c),i.standalone?i.baseMaterial.bindForSubMesh(n.getWorldMatrix(),s,e):u.bindForSubMesh(n.getWorldMatrix(),s,e),e._setMainDrawWrapperOverride(null);else{if(this.useOpacityTextureForTransparentShadow){const e=u.opacityTexture;e&&(d.setTexture("diffuseSampler",e),d.setMatrix("diffuseMatrix",e.getTextureMatrix()||this._defaultTextureMatrix))}else if(u.needAlphaTesting()||u.needAlphaBlending()){const e=u.getAlphaTestTexture();e&&(d.setTexture("diffuseSampler",e),d.setMatrix("diffuseMatrix",e.getTextureMatrix()||this._defaultTextureMatrix))}if(s.useBones&&s.computeBonesUsingShaders&&s.skeleton){const e=s.skeleton;if(e.isUsingTextureForMatrices){const t=e.getTransformMatrixTexture(s);if(!t)return;d.setTexture("boneSampler",t),d.setFloat("boneTextureWidth",4*(e.bones.length+1))}else d.setMatrices("mBones",e.getTransformMatrices(s))}o.G.BindMorphTargetParameters(s,d),s.morphTargetManager&&s.morphTargetManager.isUsingTextureForTargets&&s.morphTargetManager._bind(d),(0,f.an)(d,u,l)}this._useUBO||i||this._bindCustomEffectForRenderSubMeshForShadowMap(e,d,n),o.G.BindSceneUniformBuffer(d,this._scene.getSceneUniformBuffer()),this._scene.getSceneUniformBuffer().bindUniformBuffer();const S=n.getWorldMatrix();p&&(n.getMeshUniformBuffer().bindToEffect(d,"Mesh"),n.transferToEffect(S)),this.forceBackFacesOnly&&h.setState(!0,0,!1,!0,u.cullBackFaces),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(s),this.onBeforeShadowMapRenderObservable.notifyObservers(d),s._processRendering(n,e,d,u.fillMode,g,p,((e,t)=>{n===s||e?(n.getMeshUniformBuffer().bindToEffect(d,"Mesh"),n.transferToEffect(e?t:S)):(s.getMeshUniformBuffer().bindToEffect(d,"Mesh"),s.transferToEffect(t))})),this.forceBackFacesOnly&&h.setState(!0,0,!1,!1,u.cullBackFaces),this.onAfterShadowMapRenderObservable.notifyObservers(d),this.onAfterShadowMapRenderMeshObservable.notifyObservers(s)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}_applyFilterValues(){this._shadowMap&&(this.filter===S.FILTER_NONE||this.filter===S.FILTER_PCSS?this._shadowMap.updateSamplingMode(l.x.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(l.x.BILINEAR_SAMPLINGMODE))}forceCompilation(e,t){const i={useInstances:!1,...t},r=this.getShadowMap();if(!r)return void(e&&e(this));const s=r.renderList;if(!s)return void(e&&e(this));const n=new Array;for(const e of s)n.push(...e.subMeshes);if(0===n.length)return void(e&&e(this));let a=0;const o=()=>{var t,r;if(this._scene&&this._scene.getEngine()){for(;this.isReady(n[a],i.useInstances,null!==(r=null===(t=n[a].getMaterial())||void 0===t?void 0:t.needAlphaBlendingForMesh(n[a].getMesh()))&&void 0!==r&&r);)if(a++,a>=n.length)return void(e&&e(this));setTimeout(o,16)}};o()}forceCompilationAsync(e){return new Promise((t=>{this.forceCompilation((()=>{t()}),e)}))}_isReadyCustomDefines(e,t,i){}_prepareShadowDefines(e,t,i,r){i.push("#define SM_LIGHTTYPE_"+this._light.getClassName().toUpperCase()),i.push("#define SM_FLOAT "+(0!==this._textureType?"1":"0")),i.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),i.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));const s=e.getMesh();return i.push("#define SM_NORMALBIAS "+(this.normalBias&&s.isVerticesDataPresent(n.o.NormalKind)?"1":"0")),i.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===a._.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),i.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),i.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&r?"1":"0")),this._isReadyCustomDefines(i,e,t),i}isReady(e,t,i){var r;const s=e.getMaterial(),a=null==s?void 0:s.shadowDepthWrapper;if(!s)return!1;const l=[];if(this._prepareShadowDefines(e,t,l,i),a){if(!a.isReadyForSubMesh(e,l,this,t,this._scene.getEngine().currentRenderPassId))return!1}else{const i=e._getDrawWrapper(void 0,!0);let a=i.effect,h=i.defines;const u=[n.o.PositionKind],c=e.getMesh();this.normalBias&&c.isVerticesDataPresent(n.o.NormalKind)&&(u.push(n.o.NormalKind),l.push("#define NORMAL"),c.nonUniformScaling&&l.push("#define NONUNIFORMSCALING"));const d=null==s?void 0:s.needAlphaTesting(),m=null==s?void 0:s.needAlphaBlending();if(s&&(d||m)){let e=null;if(e=this.useOpacityTextureForTransparentShadow?s.opacityTexture:s.getAlphaTestTexture(),e){if(!e.isReady())return!1;const t=null!==(r=s.alphaCutOff)&&void 0!==r?r:S.DEFAULT_ALPHA_CUTOFF;l.push("#define ALPHATEXTURE"),d&&l.push(`#define ALPHATESTVALUE ${t}${t%1==0?".":""}`),c.isVerticesDataPresent(n.o.UVKind)&&(u.push(n.o.UVKind),l.push("#define UV1")),c.isVerticesDataPresent(n.o.UV2Kind)&&1===e.coordinatesIndex&&(u.push(n.o.UV2Kind),l.push("#define UV2"))}}const p=new g.L;if(c.useBones&&c.computeBonesUsingShaders&&c.skeleton){u.push(n.o.MatricesIndicesKind),u.push(n.o.MatricesWeightsKind),c.numBoneInfluencers>4&&(u.push(n.o.MatricesIndicesExtraKind),u.push(n.o.MatricesWeightsExtraKind));const e=c.skeleton;l.push("#define NUM_BONE_INFLUENCERS "+c.numBoneInfluencers),c.numBoneInfluencers>0&&p.addCPUSkinningFallback(0,c),e.isUsingTextureForMatrices?l.push("#define BONETEXTURE"):l.push("#define BonesPerMesh "+(e.bones.length+1))}else l.push("#define NUM_BONE_INFLUENCERS 0");const _=c.morphTargetManager;let x=0;if(_&&_.numInfluencers>0&&(l.push("#define MORPHTARGETS"),x=_.numInfluencers,l.push("#define NUM_MORPH_INFLUENCERS "+x),_.isUsingTextureForTargets&&l.push("#define MORPHTARGETS_TEXTURE"),o.G.PrepareAttributesForMorphTargetsInfluencers(u,c,x)),(0,f.AN)(s,this._scene,l),t&&(l.push("#define INSTANCES"),o.G.PushAttributesForInstances(u),e.getRenderingMesh().hasThinInstances&&l.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(const e of this.customShaderOptions.defines)-1===l.indexOf(e)&&l.push(e);const C=l.join("\n");if(h!==C){h=C;let e="shadowMap";const t=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","boneTextureWidth","softTransparentShadowSM","morphTargetTextureInfo","morphTargetTextureIndices"],r=["diffuseSampler","boneSampler","morphTargets"],s=["Scene","Mesh"];if((0,f.qx)(t),this.customShaderOptions){if(e=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(const e of this.customShaderOptions.attributes)-1===u.indexOf(e)&&u.push(e);if(this.customShaderOptions.uniforms)for(const e of this.customShaderOptions.uniforms)-1===t.indexOf(e)&&t.push(e);if(this.customShaderOptions.samplers)for(const e of this.customShaderOptions.samplers)-1===r.indexOf(e)&&r.push(e)}const n=this._scene.getEngine();a=n.createEffect(e,{attributes:u,uniformsNames:t,uniformBuffersNames:s,samplers:r,defines:C,fallbacks:p,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:x}},n),i.setEffect(a,h)}if(!a.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()))}prepareDefines(e,t){const i=this._scene,r=this._light;i.shadowsEnabled&&r.shadowEnabled&&(e["SHADOW"+t]=!0,this.useContactHardeningShadow?(e["SHADOWPCSS"+t]=!0,this._filteringQuality===S.QUALITY_LOW?e["SHADOWLOWQUALITY"+t]=!0:this._filteringQuality===S.QUALITY_MEDIUM&&(e["SHADOWMEDIUMQUALITY"+t]=!0)):this.usePercentageCloserFiltering?(e["SHADOWPCF"+t]=!0,this._filteringQuality===S.QUALITY_LOW?e["SHADOWLOWQUALITY"+t]=!0:this._filteringQuality===S.QUALITY_MEDIUM&&(e["SHADOWMEDIUMQUALITY"+t]=!0)):this.usePoissonSampling?e["SHADOWPOISSON"+t]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?e["SHADOWESM"+t]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(e["SHADOWCLOSEESM"+t]=!0),r.needCube()&&(e["SHADOWCUBE"+t]=!0))}bindShadowLight(e,t){const i=this._light;if(!this._scene.shadowsEnabled||!i.shadowEnabled)return;const r=this._getCamera();if(!r)return;const s=this.getShadowMap();s&&(i.needCube()||t.setMatrix("lightMatrix"+e,this.getTransformMatrix()),this._filter===S.FILTER_PCF?(t.setDepthStencilTexture("shadowSampler"+e,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s.getSize().width,1/s.getSize().width,this.frustumEdgeFalloff,e)):this._filter===S.FILTER_PCSS?(t.setDepthStencilTexture("shadowSampler"+e,this.getShadowMapForRendering()),t.setTexture("depthSampler"+e,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/s.getSize().width,this._contactHardeningLightSizeUVRatio*s.getSize().width,this.frustumEdgeFalloff,e)):(t.setTexture("shadowSampler"+e,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/s.getSize().width,this.depthScale,this.frustumEdgeFalloff,e)),i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(r),this.getLight().getDepthMinZ(r)+this.getLight().getDepthMaxZ(r),e))}getTransformMatrix(){const e=this._scene;if(this._currentRenderId===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderId=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;let t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),r.P.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(r.P.Dot(this._lightDirection,r.P.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),r.y3.LookAtLHToRef(t,t.add(this._lightDirection),r.P.Up(),this._viewMatrix);const e=this.getShadowMap();if(e){const t=e.renderList;t&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,t)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix}recreateShadowMap(){const e=this._shadowMap;if(!e)return;const t=e.renderList;if(this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this._filter,this._applyFilterValues(),t){this._shadowMap.renderList||(this._shadowMap.renderList=[]);for(const e of t)this._shadowMap.renderList.push(e)}else this._shadowMap.renderList=null}_disposeBlurPostProcesses(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]}_disposeRTTandPostProcesses(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()}_disposeSceneUBOs(){if(this._sceneUBOs){for(const e of this._sceneUBOs)e.dispose();this._sceneUBOs=[]}}dispose(){if(this._disposeRTTandPostProcesses(),this._disposeSceneUBOs(),this._light){if(this._light._shadowGenerators){const e=this._light._shadowGenerators.entries();for(let t=e.next();!0!==t.done;t=e.next()){const[e,i]=t.value;i===this&&this._light._shadowGenerators.delete(e)}0===this._light._shadowGenerators.size&&(this._light._shadowGenerators=null)}this._light._markMeshesAsLightDirty()}this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()}serialize(){var e;const t={},i=this.getShadowMap();if(!i)return t;if(t.className=this.getClassName(),t.lightId=this._light.id,t.cameraId=null===(e=this._camera)||void 0===e?void 0:e.id,t.id=this.id,t.mapSize=i.getRenderSize(),t.forceBackFacesOnly=this.forceBackFacesOnly,t.darkness=this.getDarkness(),t.transparencyShadow=this._transparencyShadow,t.frustumEdgeFalloff=this.frustumEdgeFalloff,t.bias=this.bias,t.normalBias=this.normalBias,t.usePercentageCloserFiltering=this.usePercentageCloserFiltering,t.useContactHardeningShadow=this.useContactHardeningShadow,t.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,t.filteringQuality=this.filteringQuality,t.useExponentialShadowMap=this.useExponentialShadowMap,t.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,t.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.usePoissonSampling=this.usePoissonSampling,t.depthScale=this.depthScale,t.blurBoxOffset=this.blurBoxOffset,t.blurKernel=this.blurKernel,t.blurScale=this.blurScale,t.useKernelBlur=this.useKernelBlur,t.renderList=[],i.renderList)for(let e=0;e<i.renderList.length;e++){const r=i.renderList[e];t.renderList.push(r.id)}return t}static Parse(e,t,i){const r=t.getLightById(e.lightId),s=void 0!==e.cameraId?t.getCameraById(e.cameraId):null,n=i?i(e.mapSize,r,s):new S(e.mapSize,r,void 0,s),a=n.getShadowMap();for(let i=0;i<e.renderList.length;i++){t.getMeshesById(e.renderList[i]).forEach((function(e){a&&(a.renderList||(a.renderList=[]),a.renderList.push(e))}))}return void 0!==e.id&&(n.id=e.id),n.forceBackFacesOnly=!!e.forceBackFacesOnly,void 0!==e.darkness&&n.setDarkness(e.darkness),e.transparencyShadow&&n.setTransparencyShadow(!0),void 0!==e.frustumEdgeFalloff&&(n.frustumEdgeFalloff=e.frustumEdgeFalloff),void 0!==e.bias&&(n.bias=e.bias),void 0!==e.normalBias&&(n.normalBias=e.normalBias),e.usePercentageCloserFiltering?n.usePercentageCloserFiltering=!0:e.useContactHardeningShadow?n.useContactHardeningShadow=!0:e.usePoissonSampling?n.usePoissonSampling=!0:e.useExponentialShadowMap?n.useExponentialShadowMap=!0:e.useBlurExponentialShadowMap?n.useBlurExponentialShadowMap=!0:e.useCloseExponentialShadowMap?n.useCloseExponentialShadowMap=!0:e.useBlurCloseExponentialShadowMap?n.useBlurCloseExponentialShadowMap=!0:e.useVarianceShadowMap?n.useExponentialShadowMap=!0:e.useBlurVarianceShadowMap&&(n.useBlurExponentialShadowMap=!0),void 0!==e.contactHardeningLightSizeUVRatio&&(n.contactHardeningLightSizeUVRatio=e.contactHardeningLightSizeUVRatio),void 0!==e.filteringQuality&&(n.filteringQuality=e.filteringQuality),e.depthScale&&(n.depthScale=e.depthScale),e.blurScale&&(n.blurScale=e.blurScale),e.blurBoxOffset&&(n.blurBoxOffset=e.blurBoxOffset),e.useKernelBlur&&(n.useKernelBlur=e.useKernelBlur),e.blurKernel&&(n.blurKernel=e.blurKernel),n}}S.CLASSNAME="ShadowGenerator",S.FILTER_NONE=0,S.FILTER_EXPONENTIALSHADOWMAP=1,S.FILTER_POISSONSAMPLING=2,S.FILTER_BLUREXPONENTIALSHADOWMAP=3,S.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,S.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,S.FILTER_PCF=6,S.FILTER_PCSS=7,S.QUALITY_HIGH=0,S.QUALITY_MEDIUM=1,S.QUALITY_LOW=2,S.DEFAULT_ALPHA_CUTOFF=.5,S._SceneComponentInitialization=e=>{throw(0,m.S)("ShadowGeneratorSceneComponent")}},258:(e,t,i)=>{i.d(t,{O:()=>h});var r=i(72433),s=i(96969),n=i(58095),a=i(17834),o=i(43812),l=i(319);a.N.AddNodeConstructor("Light_Type_1",((e,t)=>()=>new h(e,n.P.Zero(),t)));class h extends l.O{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(e){this._orthoLeft=e}get orthoRight(){return this._orthoRight}set orthoRight(e){this._orthoRight=e}get orthoTop(){return this._orthoTop}set orthoTop(e){this._orthoTop=e}get orthoBottom(){return this._orthoBottom}set orthoBottom(e){this._orthoBottom=e}constructor(e,t,i){super(e,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=t.scale(-1),this.direction=t}getClassName(){return"DirectionalLight"}getTypeID(){return o._.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)}_setDefaultFixedFrustumShadowProjectionMatrix(e){const t=this.getScene().activeCamera;t&&n.y3.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e,this.getScene().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(e,t,i){const r=this.getScene().activeCamera;if(!r)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const e=n.P.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;let r=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let a=0;a<i.length;a++){const o=i[a];if(!o)continue;const l=o.getBoundingInfo().boundingBox;for(let i=0;i<l.vectorsWorld.length;i++)n.P.TransformCoordinatesToRef(l.vectorsWorld[i],t,e),e.x<this._orthoLeft&&(this._orthoLeft=e.x),e.y<this._orthoBottom&&(this._orthoBottom=e.y),e.x>this._orthoRight&&(this._orthoRight=e.x),e.y>this._orthoTop&&(this._orthoTop=e.y),this.autoCalcShadowZBounds&&(e.z<r&&(r=e.z),e.z>s&&(s=e.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=r,this._shadowMaxZ=s)}const s=this._orthoRight-this._orthoLeft,a=this._orthoTop-this._orthoBottom,o=void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,h=this.getScene().getEngine().useReverseDepthBuffer;n.y3.OrthoOffCenterLHToRef(this._orthoLeft-s*this.shadowOrthoScale,this._orthoRight+s*this.shadowOrthoScale,this._orthoBottom-a*this.shadowOrthoScale,this._orthoTop+a*this.shadowOrthoScale,h?l:o,h?o:l,e,this.getScene().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?(e.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(e){const t=this._scene.getEngine();return!t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}getDepthMaxZ(e){const t=this._scene.getEngine();return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}prepareLightSpecificDefines(e,t){e["DIRLIGHT"+t]=!0}}(0,r.gn)([(0,s.qC)()],h.prototype,"shadowFrustumSize",null),(0,r.gn)([(0,s.qC)()],h.prototype,"shadowOrthoScale",null),(0,r.gn)([(0,s.qC)()],h.prototype,"autoUpdateExtends",void 0),(0,r.gn)([(0,s.qC)()],h.prototype,"autoCalcShadowZBounds",void 0),(0,r.gn)([(0,s.qC)("orthoLeft")],h.prototype,"_orthoLeft",void 0),(0,r.gn)([(0,s.qC)("orthoRight")],h.prototype,"_orthoRight",void 0),(0,r.gn)([(0,s.qC)("orthoTop")],h.prototype,"_orthoTop",void 0),(0,r.gn)([(0,s.qC)("orthoBottom")],h.prototype,"_orthoBottom",void 0)},51356:(e,t,i)=>{i.d(t,{e:()=>h});var r=i(72433),s=i(96969),n=i(58095),a=i(15631),o=i(17834),l=i(43812);o.N.AddNodeConstructor("Light_Type_3",((e,t)=>()=>new h(e,n.P.Zero(),t)));class h extends l._{constructor(e,t,i){super(e,i),this.groundColor=new a.Wo(0,0,0),this.direction=t||n.P.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(e){return this.direction=n.P.Normalize(e.subtract(n.P.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(e,t){const i=n.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this}transferToNodeMaterialEffect(e,t){const i=n.P.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=n.y3.Identity()),this._worldMatrix}getTypeID(){return l._.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(e,t){e["HEMILIGHT"+t]=!0}}(0,r.gn)([(0,s.n9)()],h.prototype,"groundColor",void 0),(0,r.gn)([(0,s.hd)()],h.prototype,"direction",void 0)},25340:(e,t,i)=>{i(43812),i(319),i(89118),i(258),i(51356),i(65064),i(96761)},43812:(e,t,i)=>{i.d(t,{_:()=>c});var r=i(72433),s=i(96969),n=i(58095),a=i(15631),o=i(17834),l=i(83353),h=i(48620),u=i(51011);class c extends o.N{get range(){return this._range}set range(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(e){this._intensityMode=e,this._computePhotometricScale()}get radius(){return this._radius}set radius(e){this._radius=e,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(e){this._excludeWithLayerMask=e,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())}constructor(e,t){super(e,t),this.diffuse=new a.Wo(1,1,1),this.specular=new a.Wo(1,1,1),this.falloffType=c.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=c.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new l.M(this.getScene().getEngine(),void 0,void 0,e),this._buildUniformLayout(),this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this._resyncMeshes()}transferTexturesToEffect(e,t){return this}_bindLight(e,t,i,r,s=!0){var n;const o=e.toString();let l=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+o),this._renderId!==t.getRenderId()||this._lastUseSpecular!==r||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=r;const e=this.getScaledIntensity();this.transferToEffect(i,o),this.diffuse.scaleToRef(e,a.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",a.zZ.Color3[0],this.range,o),r&&(this.specular.scaleToRef(e,a.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",a.zZ.Color3[1],this.radius,o)),l=!0}if(this.transferTexturesToEffect(i,o),t.shadowsEnabled&&this.shadowEnabled&&s){const e=null!==(n=this.getShadowGenerator(t.activeCamera))&&void 0!==n?n:this.getShadowGenerator();e&&(e.bindShadowLight(o,i),l=!0)}l?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(e){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(e){super.setEnabled(e),this._resyncMeshes()}getShadowGenerator(e=null){var t;return null===this._shadowGenerators?null:null!==(t=this._shadowGenerators.get(e))&&void 0!==t?t:null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return n.P.Zero()}canAffectMesh(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))}dispose(e,t=!1){if(this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.dispose()}this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const e=this._parentContainer.lights.indexOf(this);e>-1&&this._parentContainer.lights.splice(e,1),this._parentContainer=null}for(const e of this.getScene().meshes)e._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(e,t)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(e,t=null){const i=c.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;const r=s.p4.Clone(i,this);return e&&(r.name=e),t&&(r.parent=t),r.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(r),r}serialize(){const e=s.p4.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((t=>{e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((t=>{e.includedOnlyMeshesIds.push(t.id)}))),s.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e}static GetConstructorFromName(e,t,i){const r=o.N.Construct("Light_Type_"+e,t,i);return r||null}static Parse(e,t){const i=c.GetConstructorFromName(e.type,e.name,t);if(!i)return null;const r=s.p4.Parse(i,e,t);if(e.excludedMeshesIds&&(r._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=e.includedOnlyMeshesIds),void 0!==e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(r._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.falloffType&&(r.falloffType=e.falloffType),void 0!==e.lightmapMode&&(r.lightmapMode=e.lightmapMode),e.animations){for(let t=0;t<e.animations.length;t++){const i=e.animations[t],s=(0,h.q)("BABYLON.Animation");s&&r.animations.push(s.Parse(i))}o.N.ParseAnimationRanges(r,e,t)}return e.autoAnimate&&t.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&r.setEnabled(e.isEnabled),r}_hookArrayForExcluded(e){const t=e.push;e.push=(...i)=>{const r=t.apply(e,i);for(const e of i)e._resyncLightSource(this);return r};const i=e.splice;e.splice=(t,r)=>{const s=i.apply(e,[t,r]);for(const e of s)e._resyncLightSource(this);return s};for(const t of e)t._resyncLightSource(this)}_hookArrayForIncludedOnly(e){const t=e.push;e.push=(...i)=>{const r=t.apply(e,i);return this._resyncMeshes(),r};const i=e.splice;e.splice=(t,r)=>{const s=i.apply(e,[t,r]);return this._resyncMeshes(),s},this._resyncMeshes()}_resyncMeshes(){for(const e of this.getScene().meshes)e._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const e of this.getScene().meshes)-1!==e.lightSources.indexOf(this)&&e._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let e=0;const t=this.getTypeID();let i=this.intensityMode;switch(i===c.INTENSITYMODE_AUTOMATIC&&(i=t===c.LIGHTTYPEID_DIRECTIONALLIGHT?c.INTENSITYMODE_ILLUMINANCE:c.INTENSITYMODE_LUMINOUSINTENSITY),t){case c.LIGHTTYPEID_POINTLIGHT:case c.LIGHTTYPEID_SPOTLIGHT:switch(i){case c.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case c.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case c.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case c.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case c.INTENSITYMODE_ILLUMINANCE:e=1;break;case c.INTENSITYMODE_LUMINANCE:{let t=this.radius;t=Math.max(t,.001);e=2*Math.PI*(1-Math.cos(t));break}}break;case c.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e}_reorderLightsInScene(){const e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}c.FALLOFF_DEFAULT=u.m.FALLOFF_DEFAULT,c.FALLOFF_PHYSICAL=u.m.FALLOFF_PHYSICAL,c.FALLOFF_GLTF=u.m.FALLOFF_GLTF,c.FALLOFF_STANDARD=u.m.FALLOFF_STANDARD,c.LIGHTMAP_DEFAULT=u.m.LIGHTMAP_DEFAULT,c.LIGHTMAP_SPECULAR=u.m.LIGHTMAP_SPECULAR,c.LIGHTMAP_SHADOWSONLY=u.m.LIGHTMAP_SHADOWSONLY,c.INTENSITYMODE_AUTOMATIC=u.m.INTENSITYMODE_AUTOMATIC,c.INTENSITYMODE_LUMINOUSPOWER=u.m.INTENSITYMODE_LUMINOUSPOWER,c.INTENSITYMODE_LUMINOUSINTENSITY=u.m.INTENSITYMODE_LUMINOUSINTENSITY,c.INTENSITYMODE_ILLUMINANCE=u.m.INTENSITYMODE_ILLUMINANCE,c.INTENSITYMODE_LUMINANCE=u.m.INTENSITYMODE_LUMINANCE,c.LIGHTTYPEID_POINTLIGHT=u.m.LIGHTTYPEID_POINTLIGHT,c.LIGHTTYPEID_DIRECTIONALLIGHT=u.m.LIGHTTYPEID_DIRECTIONALLIGHT,c.LIGHTTYPEID_SPOTLIGHT=u.m.LIGHTTYPEID_SPOTLIGHT,c.LIGHTTYPEID_HEMISPHERICLIGHT=u.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,r.gn)([(0,s.n9)()],c.prototype,"diffuse",void 0),(0,r.gn)([(0,s.n9)()],c.prototype,"specular",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"falloffType",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"intensity",void 0),(0,r.gn)([(0,s.qC)()],c.prototype,"range",null),(0,r.gn)([(0,s.qC)()],c.prototype,"intensityMode",null),(0,r.gn)([(0,s.qC)()],c.prototype,"radius",null),(0,r.gn)([(0,s.qC)()],c.prototype,"_renderPriority",void 0),(0,r.gn)([(0,s.wz)("_reorderLightsInScene")],c.prototype,"renderPriority",void 0),(0,r.gn)([(0,s.qC)("shadowEnabled")],c.prototype,"_shadowEnabled",void 0),(0,r.gn)([(0,s.qC)("excludeWithLayerMask")],c.prototype,"_excludeWithLayerMask",void 0),(0,r.gn)([(0,s.qC)("includeOnlyWithLayerMask")],c.prototype,"_includeOnlyWithLayerMask",void 0),(0,r.gn)([(0,s.qC)("lightmapMode")],c.prototype,"_lightmapMode",void 0)},51011:(e,t,i)=>{i.d(t,{m:()=>r});class r{static CompareLightsPriority(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority}}r.FALLOFF_DEFAULT=0,r.FALLOFF_PHYSICAL=1,r.FALLOFF_GLTF=2,r.FALLOFF_STANDARD=3,r.LIGHTMAP_DEFAULT=0,r.LIGHTMAP_SPECULAR=1,r.LIGHTMAP_SHADOWSONLY=2,r.INTENSITYMODE_AUTOMATIC=0,r.INTENSITYMODE_LUMINOUSPOWER=1,r.INTENSITYMODE_LUMINOUSINTENSITY=2,r.INTENSITYMODE_ILLUMINANCE=3,r.INTENSITYMODE_LUMINANCE=4,r.LIGHTTYPEID_POINTLIGHT=0,r.LIGHTTYPEID_DIRECTIONALLIGHT=1,r.LIGHTTYPEID_SPOTLIGHT=2,r.LIGHTTYPEID_HEMISPHERICLIGHT=3},65064:(e,t,i)=>{i.d(t,{c:()=>h});var r=i(72433),s=i(96969),n=i(58095),a=i(17834),o=i(43812),l=i(319);a.N.AddNodeConstructor("Light_Type_0",((e,t)=>()=>new h(e,n.P.Zero(),t)));class h extends l.O{get shadowAngle(){return this._shadowAngle}set shadowAngle(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(e){const t=this.needCube();if(this._direction=e,this.needCube()!==t&&this._shadowGenerators){const e=this._shadowGenerators.values();for(let t=e.next();!0!==t.done;t=e.next()){t.value.recreateShadowMap()}}}constructor(e,t,i){super(e,i),this._shadowAngle=Math.PI/2,this.position=t}getClassName(){return"PointLight"}getTypeID(){return o._.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(e){if(this.direction)return super.getShadowDirection(e);switch(e){case 0:return new n.P(1,0,0);case 1:return new n.P(-1,0,0);case 2:return new n.P(0,-1,0);case 3:return new n.P(0,1,0);case 4:return new n.P(0,0,1);case 5:return new n.P(0,0,-1)}return n.P.Zero()}_setDefaultShadowProjectionMatrix(e,t,i){const r=this.getScene().activeCamera;if(!r)return;const s=void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,o=this.getScene().getEngine().useReverseDepthBuffer;n.y3.PerspectiveFovLHToRef(this.shadowAngle,1,o?a:s,o?s:a,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}transferToNodeMaterialEffect(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(e,t){e["POINTLIGHT"+t]=!0}}(0,r.gn)([(0,s.qC)()],h.prototype,"shadowAngle",null)},319:(e,t,i)=>{i.d(t,{O:()=>l});var r=i(72433),s=i(96969),n=i(58095),a=i(43812),o=i(43048);class l extends a._{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0}_setPosition(e){this._position=e}get position(){return this._position}set position(e){this._setPosition(e)}_setDirection(e){this._direction=e}get direction(){return this._direction}set direction(e){this._setDirection(e)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=n.P.Zero()),n.P.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=n.P.Zero()),n.P.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(e){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(e){return this.direction=n.P.Normalize(e.subtract(this.position)),this.direction}getRotation(){this.direction.normalize();const e=n.P.Cross(this.direction,o.RD.Y),t=n.P.Cross(e,this.direction);return n.P.RotationFromAxis(e,t,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=n.P.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}computeWorldMatrix(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=n.y3.Identity()),n.y3.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ}getDepthMaxZ(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ}setShadowProjectionMatrix(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}}(0,r.gn)([(0,s.hd)()],l.prototype,"position",null),(0,r.gn)([(0,s.hd)()],l.prototype,"direction",null),(0,r.gn)([(0,s.qC)()],l.prototype,"shadowMinZ",null),(0,r.gn)([(0,s.qC)()],l.prototype,"shadowMaxZ",null)},96761:(e,t,i)=>{i.d(t,{P:()=>u});var r=i(72433),s=i(96969),n=i(58095),a=i(17834),o=i(43812),l=i(319),h=i(73803);a.N.AddNodeConstructor("Light_Type_2",((e,t)=>()=>new u(e,n.P.Zero(),n.P.Zero(),0,0,t)));class u extends l.O{get angle(){return this._angle}set angle(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(e){this._innerAngle=e,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(e){this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(u._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):u._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(e){return void 0!==e.onGeneratedObservable}static _IsTexture(e){return void 0!==e.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(e){this._projectionTextureProjectionLightMatrix=e,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(e,t,i,r,s,a){super(e,a),this._innerAngle=0,this._projectionTextureMatrix=n.y3.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=n.P.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=n.P.Zero(),this._projectionTextureViewLightMatrix=n.y3.Zero(),this._projectionTextureProjectionLightMatrix=n.y3.Zero(),this._projectionTextureScalingMatrix=n.y3.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=t,this.direction=i,this.angle=r,this.exponent=s}getClassName(){return"SpotLight"}getTypeID(){return o._.LIGHTTYPEID_SPOTLIGHT}_setDirection(e){super._setDirection(e),this._projectionTextureViewLightDirty=!0}_setPosition(e){super._setPosition(e),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(e,t,i){const r=this.getScene().activeCamera;if(!r)return;this._shadowAngleScale=this._shadowAngleScale||1;const s=this._shadowAngleScale*this._angle,a=void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,l=this.getScene().getEngine().useReverseDepthBuffer;n.y3.PerspectiveFovLHToRef(s,1,l?o:a,l?a:o,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,l)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),n.y3.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const e=this.projectionTextureLightFar,t=this.projectionTextureLightNear,i=e/(e-t),r=-i*t,s=1/Math.tan(this._angle/2);n.y3.FromValuesToRef(s/1,0,0,0,0,s,0,0,0,0,i,1,0,0,r,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof h.x){const e=this._projectionTexture.uScale/2,t=this._projectionTexture.vScale/2;n.y3.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(e,t){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+t,this.projectionTexture)),this}transferToEffect(e,t){let i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),i=n.P.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),i=n.P.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this}transferToNodeMaterialEffect(e,t){let i;return i=this.computeTransformedInformation()?n.P.Normalize(this.transformedDirection):n.P.Normalize(this.direction),this.getScene().useRightHandedSystem?e.setFloat3(t,-i.x,-i.y,-i.z):e.setFloat3(t,i.x,i.y,i.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(e){const t=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i}getDepthMaxZ(e){const t=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:i}prepareLightSpecificDefines(e,t){e["SPOTLIGHT"+t]=!0,e["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,r.gn)([(0,s.qC)()],u.prototype,"angle",null),(0,r.gn)([(0,s.qC)()],u.prototype,"innerAngle",null),(0,r.gn)([(0,s.qC)()],u.prototype,"shadowAngleScale",null),(0,r.gn)([(0,s.qC)()],u.prototype,"exponent",void 0),(0,r.gn)([(0,s.qC)()],u.prototype,"projectionTextureLightNear",null),(0,r.gn)([(0,s.qC)()],u.prototype,"projectionTextureLightFar",null),(0,r.gn)([(0,s.qC)()],u.prototype,"projectionTextureUpDirection",null),(0,r.gn)([(0,s.oU)("projectedLightTexture")],u.prototype,"_projectionTexture",void 0)},32664:(e,t,i)=>{var r=i(37290);class s{constructor(e,t="",i="black"){this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=i,this._resizeLoadingUI=()=>{const e=this._renderingCanvas.getBoundingClientRect(),t=window.getComputedStyle(this._renderingCanvas).position;this._loadingDiv&&(this._loadingDiv.style.position="fixed"===t?"fixed":"absolute",this._loadingDiv.style.left=e.left+"px",this._loadingDiv.style.top=e.top+"px",this._loadingDiv.style.width=e.width+"px",this._loadingDiv.style.height=e.height+"px")}}displayLoadingUI(){if(this._loadingDiv)return;this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingDiv.style.display="grid",this._loadingDiv.style.gridTemplateRows="100%",this._loadingDiv.style.gridTemplateColumns="100%",this._loadingDiv.style.justifyItems="center",this._loadingDiv.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText,this._style=document.createElement("style"),this._style.type="text/css";this._style.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(this._style);const e=!!window.SVGSVGElement,t=new Image;s.DefaultLogoUrl?t.src=s.DefaultLogoUrl:t.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",t.style.width="150px",t.style.gridColumn="1",t.style.gridRow="1",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.position="absolute";const i=document.createElement("div");i.style.width="300px",i.style.gridColumn="1",i.style.gridRow="1",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)",i.style.position="absolute";const r=new Image;if(s.DefaultSpinnerUrl?r.src=s.DefaultSpinnerUrl:r.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",r.style.animation="spin1 0.75s infinite linear",r.style.webkitAnimation="spin1 0.75s infinite linear",r.style.transformOrigin="50% 50%",r.style.webkitTransformOrigin="50% 50%",!e){const e={w:16,h:18.5},i={w:30,h:30};t.style.width=`${e.w}vh`,t.style.height=`${e.h}vh`,t.style.left=`calc(50% - ${e.w/2}vh)`,t.style.top=`calc(50% - ${e.h/2}vh)`,r.style.width=`${i.w}vh`,r.style.height=`${i.h}vh`,r.style.left=`calc(50% - ${i.w/2}vh)`,r.style.top=`calc(50% - ${i.h/2}vh)`}i.appendChild(r),this._loadingDiv.appendChild(t),this._loadingDiv.appendChild(i),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}hideLoadingUI(){if(!this._loadingDiv)return;this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",(()=>{this._loadingTextDiv&&(this._loadingTextDiv.remove(),this._loadingTextDiv=null),this._loadingDiv&&(this._loadingDiv.remove(),this._loadingDiv=null),this._style&&(this._style.remove(),this._style=null),window.removeEventListener("resize",this._resizeLoadingUI)}))}set loadingUIText(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)}get loadingUIText(){return this._loadingText}get loadingUIBackgroundColor(){return this._loadingDivBackgroundColor}set loadingUIBackgroundColor(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)}}s.DefaultLogoUrl="",s.DefaultSpinnerUrl="",r.D.DefaultLoadingScreenFactory=e=>new s(e);var n=i(84318),a=i(2055),o=i(58095),l=i(15631),h=i(91243),u=i(63946),c=i(30700),d=i(98163),m=i(91855),g=i(44394),p=i(85790),_=i(4849),f=i(43812),S=i(85627),x=i(63407),C=i(57755),N=i(7701),T=i(85619),M=i(52106),E=i(27398),v=i(82460),I=i(90371),y=i(96584),b=i(4323),L=i(48620),w=i(13514),F=i(16142);class P{}P.LoaderInjectedPhysicsEngine=void 0;let A={},D={};const O=(e,t,i,r)=>{if(!t.materials)return null;for(let s=0,n=t.materials.length;s<n;s++){const n=t.materials[s];if(e(n))return{parsedMaterial:n,material:d.F.Parse(n,i,r)}}return null},B=(e,t,i)=>{for(const r in t)if(e.name===t[r])return i.push(e.id),!0;return void 0!==e.parentId&&-1!==i.indexOf(e.parentId)&&(i.push(e.id),!0)},R=(e,t)=>e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown"),V=(e,t)=>{const i=t;if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){const r=t._waitingData.lods.ids,s=i.isEnabled(!1);if(t._waitingData.lods.distances){const n=t._waitingData.lods.distances;if(n.length>=r.length){const t=n.length>r.length?n[n.length-1]:0;i.setEnabled(!1);for(let t=0;t<r.length;t++){const s=r[t],a=e.getMeshById(s);null!=a&&i.addLODLevel(n[t],a)}t>0&&i.addLODLevel(t,null),!0===s&&i.setEnabled(!0)}else w.w1.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},U=(e,t,i)=>{if("number"!=typeof e){const r=i.getLastEntryById(e);if(r&&null!=t){return r.instances[parseInt(t)]}return r}const r=A[e];if(r&&null!=t){return r.instances[parseInt(t)]}return r},k=(e,t)=>"number"!=typeof e?t.getLastMaterialById(e,!0):D[e],$=(e,t,i,r,s=!1)=>{const o=new N.TJ(e);let l="importScene has failed JSON parse";try{var S=JSON.parse(t);l="";const r=x.n.loggingLevel===x.n.DETAILED_LOGGING;let N,v;if(void 0!==S.environmentTexture&&null!==S.environmentTexture){const t=void 0===S.isPBR||S.isPBR;if(S.environmentTextureType&&"BABYLON.HDRCubeTexture"===S.environmentTextureType){const r=S.environmentTextureSize?S.environmentTextureSize:128,s=new p.e((S.environmentTexture.match(/https?:\/\//g)?"":i)+S.environmentTexture,e,r,!0,!t,void 0,S.environmentTexturePrefilterOnLoad);S.environmentTextureRotationY&&(s.rotationY=S.environmentTextureRotationY),e.environmentTexture=s}else if("object"==typeof S.environmentTexture){const t=g.B.Parse(S.environmentTexture,e,i);e.environmentTexture=t}else if(S.environmentTexture.endsWith(".env")){const t=new g.B((S.environmentTexture.match(/https?:\/\//g)?"":i)+S.environmentTexture,e,S.environmentTextureForcedExtension);S.environmentTextureRotationY&&(t.rotationY=S.environmentTextureRotationY),e.environmentTexture=t}else{const t=g.B.CreateFromPrefilteredData((S.environmentTexture.match(/https?:\/\//g)?"":i)+S.environmentTexture,e,S.environmentTextureForcedExtension);S.environmentTextureRotationY&&(t.rotationY=S.environmentTextureRotationY),e.environmentTexture=t}if(!0===S.createDefaultSkybox){const i=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,r=S.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,t,i,r)}o.environmentTexture=e.environmentTexture}if(void 0!==S.environmentIntensity&&null!==S.environmentIntensity&&(e.environmentIntensity=S.environmentIntensity),void 0!==S.lights&&null!==S.lights)for(N=0,v=S.lights.length;N<v;N++){const t=S.lights[N],i=f._.Parse(t,e);i&&(A[t.uniqueId]=i,o.lights.push(i),i._parentContainer=o,l+=0===N?"\n\tLights:":"",l+="\n\t\t"+i.toString(r))}if(void 0!==S.reflectionProbes&&null!==S.reflectionProbes)for(N=0,v=S.reflectionProbes.length;N<v;N++){const t=S.reflectionProbes[N],s=b.x.Parse(t,e,i);s&&(o.reflectionProbes.push(s),s._parentContainer=o,l+=0===N?"\n\tReflection Probes:":"",l+="\n\t\t"+s.toString(r))}if(void 0!==S.animations&&null!==S.animations)for(N=0,v=S.animations.length;N<v;N++){const t=S.animations[N],i=(0,L.q)("BABYLON.Animation");if(i){const s=i.Parse(t);e.animations.push(s),o.animations.push(s),l+=0===N?"\n\tAnimations:":"",l+="\n\t\t"+s.toString(r)}}if(void 0!==S.materials&&null!==S.materials)for(N=0,v=S.materials.length;N<v;N++){const t=S.materials[N],s=d.F.Parse(t,e,i);if(s){D[t.uniqueId||t.id]=s,o.materials.push(s),s._parentContainer=o,l+=0===N?"\n\tMaterials:":"",l+="\n\t\t"+s.toString(r);s.getActiveTextures().forEach((e=>{-1==o.textures.indexOf(e)&&(o.textures.push(e),e._parentContainer=o)}))}}if(void 0!==S.multiMaterials&&null!==S.multiMaterials)for(N=0,v=S.multiMaterials.length;N<v;N++){const t=S.multiMaterials[N],i=m.G.ParseMultiMaterial(t,e);D[t.uniqueId||t.id]=i,o.multiMaterials.push(i),i._parentContainer=o,l+=0===N?"\n\tMultiMaterials:":"",l+="\n\t\t"+i.toString(r);i.getActiveTextures().forEach((e=>{-1==o.textures.indexOf(e)&&(o.textures.push(e),e._parentContainer=o)}))}if(void 0!==S.morphTargetManagers&&null!==S.morphTargetManagers)for(const t of S.morphTargetManagers){const i=E.O.Parse(t,e);o.morphTargetManagers.push(i),i._parentContainer=o}if(void 0!==S.skeletons&&null!==S.skeletons)for(N=0,v=S.skeletons.length;N<v;N++){const t=S.skeletons[N],i=M.O.Parse(t,e);o.skeletons.push(i),i._parentContainer=o,l+=0===N?"\n\tSkeletons:":"",l+="\n\t\t"+i.toString(r)}const I=S.geometries;if(null!=I){const t=new Array,r=I.vertexData;if(null!=r)for(N=0,v=r.length;N<v;N++){const s=r[N];t.push(u.Z.Parse(s,e,i))}t.forEach((e=>{e&&(o.geometries.push(e),e._parentContainer=o)}))}if(void 0!==S.transformNodes&&null!==S.transformNodes)for(N=0,v=S.transformNodes.length;N<v;N++){const t=S.transformNodes[N],r=c.Y.Parse(t,e,i);A[t.uniqueId]=r,o.transformNodes.push(r),r._parentContainer=o}if(void 0!==S.meshes&&null!==S.meshes)for(N=0,v=S.meshes.length;N<v;N++){const t=S.meshes[N],s=h.Kj.Parse(t,e,i);if(A[t.uniqueId]=s,o.meshes.push(s),s._parentContainer=o,s.hasInstances)for(const e of s.instances)o.meshes.push(e),e._parentContainer=o;l+=0===N?"\n\tMeshes:":"",l+="\n\t\t"+s.toString(r)}if(void 0!==S.cameras&&null!==S.cameras)for(N=0,v=S.cameras.length;N<v;N++){const t=S.cameras[N],i=a.V.Parse(t,e);A[t.uniqueId]=i,o.cameras.push(i),i._parentContainer=o,l+=0===N?"\n\tCameras:":"",l+="\n\t\t"+i.toString(r)}if(void 0!==S.postProcesses&&null!==S.postProcesses)for(N=0,v=S.postProcesses.length;N<v;N++){const t=S.postProcesses[N],r=F.D.Parse(t,e,i);r&&(o.postProcesses.push(r),r._parentContainer=o,l+=0===N?"\nPostprocesses:":"",l+="\n\t\t"+r.toString())}if(void 0!==S.animationGroups&&null!==S.animationGroups)for(N=0,v=S.animationGroups.length;N<v;N++){const t=S.animationGroups[N],i=_.O.Parse(t,e);o.animationGroups.push(i),i._parentContainer=o,l+=0===N?"\n\tAnimationGroups:":"",l+="\n\t\t"+i.toString(r)}for(N=0,v=e.cameras.length;N<v;N++){const t=e.cameras[N];null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(N=0,v=e.lights.length;N<v;N++){const t=e.lights[N];t&&null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(N=0,v=e.transformNodes.length;N<v;N++){const t=e.transformNodes[N];null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null)}for(N=0,v=e.meshes.length;N<v;N++){const t=e.meshes[N];null!==t._waitingParentId&&(t.parent=U(t._waitingParentId,t._waitingParentInstanceIndex,e),t._waitingParentId=null,t._waitingParentInstanceIndex=null),t._waitingData.lods&&V(e,t)}for(e.multiMaterials.forEach((t=>{t._waitingSubMaterialsUniqueIds.forEach((i=>{t.subMaterials.push(k(i,e))})),t._waitingSubMaterialsUniqueIds=[]})),e.meshes.forEach((t=>{null!==t._waitingMaterialId&&(t.material=k(t._waitingMaterialId,e),t._waitingMaterialId=null)})),N=0,v=e.skeletons.length;N<v;N++){const t=e.skeletons[N];t._hasWaitingData&&(null!=t.bones&&t.bones.forEach((t=>{if(t._waitingTransformNodeId){const i=e.getLastEntryById(t._waitingTransformNodeId);i&&t.linkTransformNode(i),t._waitingTransformNodeId=null}})),t._hasWaitingData=null)}for(N=0,v=e.meshes.length;N<v;N++){const t=e.meshes[N];t._waitingData.freezeWorldMatrix?(t.freezeWorldMatrix(),t._waitingData.freezeWorldMatrix=null):t.computeWorldMatrix(!0)}for(N=0,v=e.lights.length;N<v;N++){const t=e.lights[N];if(t._excludedMeshesIds.length>0){for(let i=0;i<t._excludedMeshesIds.length;i++){const r=e.getMeshById(t._excludedMeshesIds[i]);r&&t.excludedMeshes.push(r)}t._excludedMeshesIds=[]}if(t._includedOnlyMeshesIds.length>0){for(let i=0;i<t._includedOnlyMeshesIds.length;i++){const r=e.getMeshById(t._includedOnlyMeshesIds[i]);r&&t.includedOnlyMeshes.push(r)}t._includedOnlyMeshesIds=[]}}for(e.geometries.forEach((e=>{e._loadedUniqueId=""})),C.p.Parse(S,e,o,i),N=0,v=e.meshes.length;N<v;N++){const t=e.meshes[N];t._waitingData.actions&&(T.k.Parse(t._waitingData.actions,t,e),t._waitingData.actions=null)}void 0!==S.actions&&null!==S.actions&&T.k.Parse(S.actions,null,e)}catch(e){const t=R("loadAssets",S?S.producer:"Unknown")+l;if(!r)throw n.Y.Log(t),e;r(t,e)}finally{A={},D={},s||o.removeAllFromScene(),null!==l&&x.n.loggingLevel!==x.n.NO_LOGGING&&n.Y.Log(R("loadAssets",S?S.producer:"Unknown")+(x.n.loggingLevel!==x.n.MINIMAL_LOGGING?l:""))}return o};x.n.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:e=>-1!==e.indexOf("babylon"),importMesh:(e,t,i,r,s,a,o,l)=>{var d;let g="importMesh has failed JSON parse";try{var p=JSON.parse(i);g="";const l=x.n.loggingLevel===x.n.DETAILED_LOGGING;e?Array.isArray(e)||(e=[e]):e=null;const _=new Array,f=new Map,N=[];if(void 0!==p.transformNodes&&null!==p.transformNodes)for(let e=0,i=p.transformNodes.length;e<i;e++){const i=p.transformNodes[e],s=c.Y.Parse(i,t,r);N.push(s),f.set(s._waitingParsedUniqueId,s),s._waitingParsedUniqueId=null}if(void 0!==p.meshes&&null!==p.meshes){const i=[],a=[],c=[],S=[];for(let d=0,x=p.meshes.length;d<x;d++){const x=p.meshes[d];if(null===e||B(x,e,_)){if(null!==e&&delete e[e.indexOf(x.name)],void 0!==x.geometryId&&null!==x.geometryId&&void 0!==p.geometries&&null!==p.geometries){let e=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach((i=>{!0!==e&&p.geometries[i]&&Array.isArray(p.geometries[i])&&p.geometries[i].forEach((s=>{if(s.id===x.geometryId){if("vertexData"===i)u.Z.Parse(s,t,r);e=!0}}))})),!1===e&&n.Y.Warn("Geometry not found for mesh "+x.id)}if(x.materialUniqueId||x.materialId){const e=x.materialUniqueId?c:a;let i=-1!==e.indexOf(x.materialUniqueId||x.materialId);if(!1===i&&void 0!==p.multiMaterials&&null!==p.multiMaterials){const s=(i,s)=>{e.push(i);const n=O(s,p,t,r);n&&n.material&&(D[n.parsedMaterial.uniqueId||n.parsedMaterial.id]=n.material,g+="\n\tMaterial "+n.material.toString(l))};for(let r=0,n=p.multiMaterials.length;r<n;r++){const n=p.multiMaterials[r];if(x.materialUniqueId&&n.uniqueId===x.materialUniqueId||n.id===x.materialId){n.materialsUniqueIds?n.materialsUniqueIds.forEach((e=>s(e,(t=>t.uniqueId===e)))):n.materials.forEach((e=>s(e,(t=>t.id===e)))),e.push(n.uniqueId||n.id);const r=m.G.ParseMultiMaterial(n,t);D[n.uniqueId||n.id]=r,r&&(i=!0,g+="\n\tMulti-Material "+r.toString(l));break}}}if(!1===i){e.push(x.materialUniqueId||x.materialId);const i=O((e=>x.materialUniqueId&&e.uniqueId===x.materialUniqueId||e.id===x.materialId),p,t,r);i&&i.material?(D[i.parsedMaterial.uniqueId||i.parsedMaterial.id]=i.material,g+="\n\tMaterial "+i.material.toString(l)):n.Y.Warn("Material not found for mesh "+x.id)}}if(x.skeletonId>-1&&void 0!==p.skeletons&&null!==p.skeletons){if(!(i.indexOf(x.skeletonId)>-1))for(let e=0,r=p.skeletons.length;e<r;e++){const r=p.skeletons[e];if(r.id===x.skeletonId){const e=M.O.Parse(r,t);o.push(e),i.push(r.id),g+="\n\tSkeleton "+e.toString(l)}}}if(x.morphTargetManagerId>-1&&void 0!==p.morphTargetManagers&&null!==p.morphTargetManagers){if(!(S.indexOf(x.morphTargetManagerId)>-1))for(let e=0,i=p.morphTargetManagers.length;e<i;e++){const i=p.morphTargetManagers[e];if(i.id===x.morphTargetManagerId){const e=E.O.Parse(i,t);S.push(e.uniqueId),g+="\nMorph target "+e.toString()}}}const d=h.Kj.Parse(x,t,r);s.push(d),f.set(d._waitingParsedUniqueId,d),d._waitingParsedUniqueId=null,g+="\n\tMesh "+d.toString(l)}}t.multiMaterials.forEach((e=>{e._waitingSubMaterialsUniqueIds.forEach((i=>{e.subMaterials.push(k(i,t))})),e._waitingSubMaterialsUniqueIds=[]})),t.meshes.forEach((e=>{null!==e._waitingMaterialId&&(e.material=k(e._waitingMaterialId,t),e._waitingMaterialId=null)}));for(let e=0,i=t.transformNodes.length;e<i;e++){const i=t.transformNodes[e];if(null!==i._waitingParentId){let e=f.get(parseInt(i._waitingParentId))||null;null===e&&(e=t.getLastEntryById(i._waitingParentId));let r=e;i._waitingParentInstanceIndex&&(r=e.instances[parseInt(i._waitingParentInstanceIndex)],i._waitingParentInstanceIndex=null),i.parent=r,i._waitingParentId=null}}let x;for(let e=0,i=t.meshes.length;e<i;e++){if(x=t.meshes[e],x._waitingParentId){let e=f.get(parseInt(x._waitingParentId))||null;null===e&&(e=t.getLastEntryById(x._waitingParentId));let i=e;if(x._waitingParentInstanceIndex&&(i=e.instances[parseInt(x._waitingParentInstanceIndex)],x._waitingParentInstanceIndex=null),x.parent=i,"TransformNode"===(null===(d=x.parent)||void 0===d?void 0:d.getClassName())){const e=N.indexOf(x.parent);e>-1&&N.splice(e,1)}x._waitingParentId=null}x._waitingData.lods&&V(t,x)}for(const e of N)e.dispose();for(let e=0,i=t.skeletons.length;e<i;e++){const i=t.skeletons[e];i._hasWaitingData&&(null!=i.bones&&i.bones.forEach((e=>{if(e._waitingTransformNodeId){const i=t.getLastEntryById(e._waitingTransformNodeId);i&&e.linkTransformNode(i),e._waitingTransformNodeId=null}})),i._hasWaitingData=null)}for(let e=0,i=t.meshes.length;e<i;e++)x=t.meshes[e],x._waitingData.freezeWorldMatrix?(x.freezeWorldMatrix(),x._waitingData.freezeWorldMatrix=null):x.computeWorldMatrix(!0)}if(void 0!==p.particleSystems&&null!==p.particleSystems){const e=C.p.GetIndividualParser(S.l.NAME_PARTICLESYSTEM);if(e)for(let i=0,s=p.particleSystems.length;i<s;i++){const s=p.particleSystems[i];-1!==_.indexOf(s.emitterId)&&a.push(e(s,t,r))}}return t.geometries.forEach((e=>{e._loadedUniqueId=""})),!0}catch(e){const t=R("importMesh",p?p.producer:"Unknown")+g;if(!l)throw n.Y.Log(t),e;l(t,e)}finally{null!==g&&x.n.loggingLevel!==x.n.NO_LOGGING&&n.Y.Log(R("importMesh",p?p.producer:"Unknown")+(x.n.loggingLevel!==x.n.MINIMAL_LOGGING?g:""))}return!1},load:(e,t,i,r)=>{let s="importScene has failed JSON parse";try{var a=JSON.parse(t);if(s="",void 0!==a.useDelayedTextureLoading&&null!==a.useDelayedTextureLoading&&(e.useDelayedTextureLoading=a.useDelayedTextureLoading&&!x.n.ForceFullSceneLoadingForIncremental),void 0!==a.autoClear&&null!==a.autoClear&&(e.autoClear=a.autoClear),void 0!==a.clearColor&&null!==a.clearColor&&(e.clearColor=l.HE.FromArray(a.clearColor)),void 0!==a.ambientColor&&null!==a.ambientColor&&(e.ambientColor=l.Wo.FromArray(a.ambientColor)),void 0!==a.gravity&&null!==a.gravity&&(e.gravity=o.P.FromArray(a.gravity)),void 0!==a.useRightHandedSystem&&(e.useRightHandedSystem=!!a.useRightHandedSystem),a.fogMode&&0!==a.fogMode)switch(e.fogMode=a.fogMode,e.fogColor=l.Wo.FromArray(a.fogColor),e.fogStart=a.fogStart,e.fogEnd=a.fogEnd,e.fogDensity=a.fogDensity,s+="\tFog mode for scene:  ",e.fogMode){case 1:s+="exp\n";break;case 2:s+="exp2\n";break;case 3:s+="linear\n"}if(a.physicsEnabled){let t;"cannon"===a.physicsEngine||a.physicsEngine===v.s.name?t=new v.s(void 0,void 0,P.LoaderInjectedPhysicsEngine):"oimo"===a.physicsEngine||a.physicsEngine===I.A.name?t=new I.A(void 0,P.LoaderInjectedPhysicsEngine):"ammo"!==a.physicsEngine&&a.physicsEngine!==y.b.name||(t=new y.b(void 0,P.LoaderInjectedPhysicsEngine,void 0)),s="\tPhysics engine "+(a.physicsEngine?a.physicsEngine:"oimo")+" enabled\n";const i=a.physicsGravity?o.P.FromArray(a.physicsGravity):null;e.enablePhysics(i,t)}void 0!==a.metadata&&null!==a.metadata&&(e.metadata=a.metadata),void 0!==a.collisionsEnabled&&null!==a.collisionsEnabled&&(e.collisionsEnabled=a.collisionsEnabled);return!!$(e,t,i,r,!0)&&(a.autoAnimate&&e.beginAnimation(e,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),void 0!==a.activeCameraID&&null!==a.activeCameraID&&e.setActiveCameraById(a.activeCameraID),!0)}catch(e){const t=R("importScene",a?a.producer:"Unknown")+s;if(!r)throw n.Y.Log(t),e;r(t,e)}finally{null!==s&&x.n.loggingLevel!==x.n.NO_LOGGING&&n.Y.Log(R("importScene",a?a.producer:"Unknown")+(x.n.loggingLevel!==x.n.MINIMAL_LOGGING?s:""))}return!1},loadAssetContainer:(e,t,i,r)=>$(e,t,i,r)});i(43824)},63407:(e,t,i)=>{i.d(t,{n:()=>m});var r,s=i(13514),n=i(62897),a=i(65273),o=i(37290),l=i(15210),h=i(84318),u=i(43824),c=i(79245),d=i(46223);!function(e){e[e.Clean=0]="Clean",e[e.Stop=1]="Stop",e[e.Sync=2]="Sync",e[e.NoSync=3]="NoSync"}(r||(r={}));class m{static get ForceFullSceneLoadingForIncremental(){return u.Z.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){u.Z.ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return u.Z.ShowLoadingScreen}static set ShowLoadingScreen(e){u.Z.ShowLoadingScreen=e}static get loggingLevel(){return u.Z.loggingLevel}static set loggingLevel(e){u.Z.loggingLevel=e}static get CleanBoneMatrixWeights(){return u.Z.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){u.Z.CleanBoneMatrixWeights=e}static GetDefaultPlugin(){return m._RegisteredPlugins[".babylon"]}static _GetPluginForExtension(e){const t=m._RegisteredPlugins[e];return t||(h.Y.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),m.GetDefaultPlugin())}static _GetPluginForDirectLoad(e){for(const t in m._RegisteredPlugins){const i=m._RegisteredPlugins[t].plugin;if(i.canDirectLoad&&i.canDirectLoad(e))return m._RegisteredPlugins[t]}return m.GetDefaultPlugin()}static _GetPluginForFilename(e){const t=e.indexOf("?");-1!==t&&(e=e.substring(0,t));const i=e.lastIndexOf("."),r=e.substring(i,e.length).toLowerCase();return m._GetPluginForExtension(r)}static _GetDirectLoad(e){return"data:"===e.substr(0,5)?e.substr(5):null}static _FormatErrorMessage(e,t,i){let r="Unable to load from "+e.url;return t?r+=`: ${t}`:i&&(r+=`: ${i}`),r}static _LoadData(e,t,i,r,s,n,a){const l=m._GetDirectLoad(e.url),h=a?m._GetPluginForExtension(a):l?m._GetPluginForDirectLoad(e.url):m._GetPluginForFilename(e.url);let u;if(u=void 0!==h.plugin.createPlugin?h.plugin.createPlugin():h.plugin,!u)throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(m.OnPluginActivatedObservable.notifyObservers(u),l&&(u.canDirectLoad&&u.canDirectLoad(e.url)||!(0,c.VL)(e.url))){if(u.directLoad){const e=u.directLoad(t,l);e.then?e.then((e=>{i(u,e)})).catch((e=>{s("Error in directLoad of _loadData: "+e,e)})):i(u,e)}else i(u,l);return u}const d=h.isBinary,g=(e,r)=>{t.isDisposed?s("Scene has been disposed"):i(u,e,r)};let p=null,_=!1;const f=u.onDisposeObservable;f&&f.add((()=>{_=!0,p&&(p.abort(),p=null),n()}));const S=()=>{if(_)return;const i=(e,t)=>{s(null==e?void 0:e.statusText,t)},n=e.file||e.url;p=u.loadFile?u.loadFile(t,n,g,r,d,i):t._loadFile(n,g,r,!0,d,i)},x=t.getEngine();let C=x.enableOfflineSupport;if(C){let i=!1;for(const r of t.disableOfflineSupportExceptionRules)if(r.test(e.url)){i=!0;break}C=!i}return C&&o.D.OfflineProviderFactory?t.offlineProvider=o.D.OfflineProviderFactory(e.url,S,x.disableManifestCheck):S(),u}static _GetFileInfo(e,t){let i,r,n=null;if(t)if(t.name){const e=t;i=`file:${e.name}`,r=e.name,n=e}else if("string"==typeof t&&t.startsWith("data:"))i=t,r="";else{const n=t;if("/"===n.substr(0,1))return s.w1.Error("Wrong sceneFilename parameter"),null;i=e+n,r=n}else i=e,r=s.w1.GetFilename(e),e=s.w1.GetFolderPath(e);return{url:i,rootUrl:e,name:r,file:n}}static GetPluginForExtension(e){return m._GetPluginForExtension(e).plugin}static IsPluginForExtensionAvailable(e){return!!m._RegisteredPlugins[e]}static RegisterPlugin(e){if("string"==typeof e.extensions){const t=e.extensions;m._RegisteredPlugins[t.toLowerCase()]={plugin:e,isBinary:!1}}else{const t=e.extensions;Object.keys(t).forEach((i=>{m._RegisteredPlugins[i.toLowerCase()]={plugin:e,isBinary:t[i].isBinary}}))}}static ImportMesh(e,t,i="",r=l.l.LastCreatedScene,s=null,n=null,a=null,o=null){if(!r)return h.Y.Error("No scene available to import mesh to"),null;const u=m._GetFileInfo(t,i);if(!u)return null;const c={};r.addPendingData(c);const g=()=>{r.removePendingData(c)},p=(e,t)=>{const i=m._FormatErrorMessage(u,e,t);a?a(r,i,new d.LH(i,d.SM.SceneLoaderError,t)):h.Y.Error(i),g()},_=n?e=>{try{n(e)}catch(e){p("Error in onProgress callback: "+e,e)}}:void 0,f=(e,t,i,n,a,o,l)=>{if(r.importedMeshesFiles.push(u.url),s)try{s(e,t,i,n,a,o,l)}catch(e){p("Error in onSuccess callback: "+e,e)}r.removePendingData(c)};return m._LoadData(u,r,((t,i,s)=>{if(t.rewriteRootURL&&(u.rootUrl=t.rewriteRootURL(u.rootUrl,s)),t.importMesh){const s=t,n=new Array,a=new Array,o=new Array;if(!s.importMesh(e,r,i,u.rootUrl,n,a,o,p))return;r.loadingPluginName=t.name,f(n,a,o,[],[],[],[])}else{t.importMeshAsync(e,r,i,u.rootUrl,_,u.name).then((e=>{r.loadingPluginName=t.name,f(e.meshes,e.particleSystems,e.skeletons,e.animationGroups,e.transformNodes,e.geometries,e.lights)})).catch((e=>{p(e.message,e)}))}}),_,p,g,o)}static ImportMeshAsync(e,t,i="",r=l.l.LastCreatedScene,s=null,n=null){return new Promise(((a,o)=>{m.ImportMesh(e,t,i,r,((e,t,i,r,s,n,o)=>{a({meshes:e,particleSystems:t,skeletons:i,animationGroups:r,transformNodes:s,geometries:n,lights:o})}),s,((e,t,i)=>{o(i||new Error(t))}),n)}))}static Load(e,t="",i=l.l.LastCreatedEngine,r=null,n=null,o=null,h=null){return i?m.Append(e,t,new a.x(i),r,n,o,h):(s.w1.Error("No engine available"),null)}static LoadAsync(e,t="",i=l.l.LastCreatedEngine,r=null,s=null){return new Promise(((n,a)=>{m.Load(e,t,i,(e=>{n(e)}),r,((e,t,i)=>{a(i||new Error(t))}),s)}))}static Append(e,t="",i=l.l.LastCreatedScene,r=null,s=null,n=null,a=null){if(!i)return h.Y.Error("No scene available to append to"),null;const o=m._GetFileInfo(e,t);if(!o)return null;const u={};i.addPendingData(u);const c=()=>{i.removePendingData(u)};m.ShowLoadingScreen&&!this._ShowingLoadingScreen&&(this._ShowingLoadingScreen=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),this._ShowingLoadingScreen=!1})));const g=(e,t)=>{const r=m._FormatErrorMessage(o,e,t);n?n(i,r,new d.LH(r,d.SM.SceneLoaderError,t)):h.Y.Error(r),c()},p=s?e=>{try{s(e)}catch(e){g("Error in onProgress callback",e)}}:void 0,_=()=>{if(r)try{r(i)}catch(e){g("Error in onSuccess callback",e)}i.removePendingData(u)};return m._LoadData(o,i,((e,t)=>{if(e.load){if(!e.load(i,t,o.rootUrl,g))return;i.loadingPluginName=e.name,_()}else{e.loadAsync(i,t,o.rootUrl,p,o.name).then((()=>{i.loadingPluginName=e.name,_()})).catch((e=>{g(e.message,e)}))}}),p,g,c,a)}static AppendAsync(e,t="",i=l.l.LastCreatedScene,r=null,s=null){return new Promise(((n,a)=>{m.Append(e,t,i,(e=>{n(e)}),r,((e,t,i)=>{a(i||new Error(t))}),s)}))}static LoadAssetContainer(e,t="",i=l.l.LastCreatedScene,r=null,s=null,n=null,a=null){if(!i)return h.Y.Error("No scene available to load asset container to"),null;const o=m._GetFileInfo(e,t);if(!o)return null;const u={};i.addPendingData(u);const c=()=>{i.removePendingData(u)},g=(e,t)=>{const r=m._FormatErrorMessage(o,e,t);n?n(i,r,new d.LH(r,d.SM.SceneLoaderError,t)):h.Y.Error(r),c()},p=s?e=>{try{s(e)}catch(e){g("Error in onProgress callback",e)}}:void 0,_=e=>{if(r)try{r(e)}catch(e){g("Error in onSuccess callback",e)}i.removePendingData(u)};return m._LoadData(o,i,((e,t)=>{if(e.loadAssetContainer){const r=e.loadAssetContainer(i,t,o.rootUrl,g);if(!r)return;i.loadingPluginName=e.name,_(r)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(i,t,o.rootUrl,p,o.name).then((t=>{i.loadingPluginName=e.name,_(t)})).catch((e=>{g(e.message,e)}))}else g("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),p,g,c,a)}static LoadAssetContainerAsync(e,t="",i=l.l.LastCreatedScene,r=null,s=null){return new Promise(((n,a)=>{m.LoadAssetContainer(e,t,i,(e=>{n(e)}),r,((e,t,i)=>{a(i||new Error(t))}),s)}))}static ImportAnimations(e,t="",i=l.l.LastCreatedScene,s=!0,n=r.Clean,a=null,o=null,u=null,c=null,d=null){if(!i)return void h.Y.Error("No scene available to load animations to");if(s){for(const e of i.animatables)e.reset();i.stopAllAnimations(),i.animationGroups.slice().forEach((e=>{e.dispose()}));i.getNodes().forEach((e=>{e.animations&&(e.animations=[])}))}else switch(n){case r.Clean:i.animationGroups.slice().forEach((e=>{e.dispose()}));break;case r.Stop:i.animationGroups.forEach((e=>{e.stop()}));break;case r.Sync:i.animationGroups.forEach((e=>{e.reset(),e.restart()}));break;case r.NoSync:break;default:return void h.Y.Error("Unknown animation group loading mode value '"+n+"'")}const m=i.animatables.length;this.LoadAssetContainer(e,t,i,(e=>{e.mergeAnimationsTo(i,i.animatables.slice(m),a),e.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),o&&o(i)}),u,c,d)}static ImportAnimationsAsync(e,t="",i=l.l.LastCreatedScene,s=!0,n=r.Clean,a=null,o=null,h=null,u=null,c=null){return new Promise(((r,o)=>{m.ImportAnimations(e,t,i,s,n,a,(e=>{r(e)}),h,((e,t,i)=>{o(i||new Error(t))}),c)}))}}m.NO_LOGGING=0,m.MINIMAL_LOGGING=1,m.SUMMARY_LOGGING=2,m.DETAILED_LOGGING=3,m.OnPluginActivatedObservable=new n.y$,m._RegisteredPlugins={},m._ShowingLoadingScreen=!1},43824:(e,t,i)=>{i.d(t,{Z:()=>r});class r{static get ForceFullSceneLoadingForIncremental(){return r._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(e){r._ForceFullSceneLoadingForIncremental=e}static get ShowLoadingScreen(){return r._ShowLoadingScreen}static set ShowLoadingScreen(e){r._ShowLoadingScreen=e}static get loggingLevel(){return r._LoggingLevel}static set loggingLevel(e){r._LoggingLevel=e}static get CleanBoneMatrixWeights(){return r._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(e){r._CleanBoneMatrixWeights=e}}r._ForceFullSceneLoadingForIncremental=!1,r._ShowLoadingScreen=!0,r._CleanBoneMatrixWeights=!1,r._LoggingLevel=0},17713:(e,t,i)=>{i.d(t,{I:()=>N});var r=i(72433),s=i(96969),n=i(7788),a=i(84318),o=i(65273),l=i(58095),h=i(72208),u=i(90360),c=i(64849),d=i(74375),m=i(90622),g=i(73803),p=i(48620),_=i(46110),f=i(15631),S=(i(91699),i(83825),i(38309)),x=i(77633);class C extends c.H{constructor(){super(),this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.GAMMADIFFUSE=!1,this.DIFFUSEHASALPHA=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONBLUR=!1,this.REFLECTIONFRESNEL=!1,this.REFLECTIONFALLOFF=!1,this.TEXTURELODSUPPORT=!1,this.PREMULTIPLYALPHA=!1,this.USERGBCOLOR=!1,this.USEHIGHLIGHTANDSHADOWCOLORS=!1,this.BACKMAT_SHADOWONLY=!1,this.NOISE=!1,this.REFLECTIONBGR=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=!1,this.TONEMAPPING_ACES=!1,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.EQUIRECTANGULAR_RELFECTION_FOV=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.UV1=!1,this.UV2=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.SHADOWFLOAT=!1,this.LOGARITHMICDEPTH=!1,this.NONUNIFORMSCALING=!1,this.ALPHATEST=!1,this.rebuild()}}class N extends d.a{get _perceptualColor(){return this.__perceptualColor}set _perceptualColor(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()}get primaryColorShadowLevel(){return this._primaryColorShadowLevel}set primaryColorShadowLevel(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()}get primaryColorHighlightLevel(){return this._primaryColorHighlightLevel}set primaryColorHighlightLevel(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()}set reflectionStandardFresnelWeight(e){let t=e;t<.5?(t*=2,this.reflectionReflectance0=N.StandardReflectance0*t,this.reflectionReflectance90=N.StandardReflectance90*t):(t=2*t-1,this.reflectionReflectance0=N.StandardReflectance0+(1-N.StandardReflectance0)*t,this.reflectionReflectance90=N.StandardReflectance90+(1-N.StandardReflectance90)*t)}get fovMultiplier(){return this._fovMultiplier}set fovMultiplier(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))}_attachImageProcessingConfiguration(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsImageProcessingDirty()}))))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(e){this.imageProcessingConfiguration.colorCurvesEnabled=e}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(e){this.imageProcessingConfiguration.colorGradingEnabled=e}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(e){this._imageProcessingConfiguration.toneMappingEnabled=e}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(e){this._imageProcessingConfiguration.exposure=e}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(e){this._imageProcessingConfiguration.contrast=e}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(e){this.imageProcessingConfiguration.colorGradingTexture=e}get cameraColorCurves(){return this.imageProcessingConfiguration.colorCurves}set cameraColorCurves(e){this.imageProcessingConfiguration.colorCurves=e}constructor(e,t){super(e,t),this.primaryColor=f.Wo.White(),this._primaryColorShadowLevel=0,this._primaryColorHighlightLevel=0,this.reflectionTexture=null,this.reflectionBlur=0,this.diffuseTexture=null,this._shadowLights=null,this.shadowLights=null,this.shadowLevel=0,this.sceneCenter=l.P.Zero(),this.opacityFresnel=!0,this.reflectionFresnel=!1,this.reflectionFalloffDistance=0,this.reflectionAmount=1,this.reflectionReflectance0=.05,this.reflectionReflectance90=.5,this.useRGBColor=!0,this.enableNoise=!1,this._fovMultiplier=1,this.useEquirectangularFOV=!1,this._maxSimultaneousLights=4,this.maxSimultaneousLights=4,this._shadowOnly=!1,this.shadowOnly=!1,this._imageProcessingObserver=null,this.switchToBGR=!1,this._renderTargets=new n.t(16),this._reflectionControls=l.Lt.Zero(),this._white=f.Wo.White(),this._primaryShadowColor=f.Wo.Black(),this._primaryHighlightColor=f.Wo.Black(),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._renderTargets.push(this._diffuseTexture),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._renderTargets)}get hasRenderTargetTextures(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)}needAlphaTesting(){return!0}needAlphaBlending(){return this.alpha<1||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||this._shadowOnly}isReadyForSubMesh(e,t,i=!1){if(t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady&&t.effect._wasPreviouslyUsingInstances===i)return!0;t.materialDefines||(t.materialDefines=new C);const r=this.getScene(),s=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const n=r.getEngine();if(u.G.PrepareDefinesForLights(r,e,s,!1,this._maxSimultaneousLights),s._needNormals=!0,u.G.PrepareDefinesForMultiview(r,s),s._areTexturesDirty){if(s._needUVs=!1,r.texturesEnabled){if(r.getEngine().getCaps().textureLOD&&(s.TEXTURELODSUPPORT=!0),this._diffuseTexture&&_.k.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;u.G.PrepareDefinesForMergedUV(this._diffuseTexture,s,"DIFFUSE"),s.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,s.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,s.OPACITYFRESNEL=this._opacityFresnel}else s.DIFFUSE=!1,s.DIFFUSEDIRECTUV=0,s.DIFFUSEHASALPHA=!1,s.GAMMADIFFUSE=!1,s.OPACITYFRESNEL=!1;const e=this._reflectionTexture;if(e&&_.k.ReflectionTextureEnabled){if(!e.isReadyOrNotBlocking())return!1;switch(s.REFLECTION=!0,s.GAMMAREFLECTION=e.gammaSpace,s.RGBDREFLECTION=e.isRGBD,s.REFLECTIONBLUR=this._reflectionBlur>0,s.LODINREFLECTIONALPHA=e.lodLevelInAlpha,s.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,s.REFLECTIONBGR=this.switchToBGR,e.coordinatesMode===g.x.INVCUBIC_MODE&&(s.INVERTCUBICMAP=!0),s.REFLECTIONMAP_3D=e.isCube,s.REFLECTIONMAP_OPPOSITEZ=s.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!e.invertZ:e.invertZ,e.coordinatesMode){case g.x.EXPLICIT_MODE:s.REFLECTIONMAP_EXPLICIT=!0;break;case g.x.PLANAR_MODE:s.REFLECTIONMAP_PLANAR=!0;break;case g.x.PROJECTION_MODE:s.REFLECTIONMAP_PROJECTION=!0;break;case g.x.SKYBOX_MODE:s.REFLECTIONMAP_SKYBOX=!0;break;case g.x.SPHERICAL_MODE:s.REFLECTIONMAP_SPHERICAL=!0;break;case g.x.EQUIRECTANGULAR_MODE:s.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case g.x.FIXED_EQUIRECTANGULAR_MODE:s.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case g.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:s.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case g.x.CUBIC_MODE:case g.x.INVCUBIC_MODE:default:s.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(s.REFLECTIONFRESNEL=!0,s.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(s.REFLECTIONFRESNEL=!1,s.REFLECTIONFALLOFF=!1)}else s.REFLECTION=!1,s.REFLECTIONFRESNEL=!1,s.REFLECTIONFALLOFF=!1,s.REFLECTIONBLUR=!1,s.REFLECTIONMAP_3D=!1,s.REFLECTIONMAP_SPHERICAL=!1,s.REFLECTIONMAP_PLANAR=!1,s.REFLECTIONMAP_CUBIC=!1,s.REFLECTIONMAP_PROJECTION=!1,s.REFLECTIONMAP_SKYBOX=!1,s.REFLECTIONMAP_EXPLICIT=!1,s.REFLECTIONMAP_EQUIRECTANGULAR=!1,s.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,s.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,s.INVERTCUBICMAP=!1,s.REFLECTIONMAP_OPPOSITEZ=!1,s.LODINREFLECTIONALPHA=!1,s.GAMMAREFLECTION=!1,s.RGBDREFLECTION=!1}s.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,s.USERGBCOLOR=this._useRGBColor,s.NOISE=this._enableNoise}if(s._areLightsDirty&&(s.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel),s.BACKMAT_SHADOWONLY=this._shadowOnly),s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s)}if(u.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),s),u.G.PrepareDefinesForFrameBoundValues(r,n,this,s,i,null,t.getRenderingMesh().hasThinInstances),u.G.PrepareDefinesForAttributes(e,s,!1,!0,!1)&&e&&(r.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(h.o.NormalKind)||(e.createNormals(!0),a.Y.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const i=new S.L;s.FOG&&i.addFallback(0,"FOG"),s.POINTSIZE&&i.addFallback(1,"POINTSIZE"),s.MULTIVIEW&&i.addFallback(0,"MULTIVIEW"),u.G.HandleFallbacksForShadows(s,i,this._maxSimultaneousLights);const a=[h.o.PositionKind];s.NORMAL&&a.push(h.o.NormalKind),s.UV1&&a.push(h.o.UVKind),s.UV2&&a.push(h.o.UV2Kind),u.G.PrepareAttributesForBones(a,e,s,i),u.G.PrepareAttributesForInstances(a,s);const o=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"];(0,x.qx)(o);const l=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],c=["Material","Scene"];m.$&&(m.$.PrepareUniforms(o,s),m.$.PrepareSamplers(l,s)),u.G.PrepareUniformsAndSamplersList({uniformsNames:o,uniformBuffersNames:c,samplers:l,defines:s,maxSimultaneousLights:this._maxSimultaneousLights});const d=s.toString(),g=r.getEngine().createEffect("background",{attributes:a,uniformsNames:o,uniformBuffersNames:c,samplers:l,defines:d,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},n);t.setEffect(g,s,this._materialContext),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(s._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,t.effect._wasPreviouslyUsingInstances=i,r.performancePriority!==o.a.BackwardCompatible&&(this.checkReadyOnlyOnce=!0),!0)}_computePrimaryColorFromPerceptualColor(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())}_computePrimaryColors(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))}buildUniformLayout(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()}unbind(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),super.unbind()}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindForSubMesh(e,t,i){const r=this.getScene(),s=i.materialDefines;if(!s)return;const n=i.effect;if(!n)return;this._activeEffect=n,this.bindOnlyWorldMatrix(e),u.G.BindBonesParameters(t,this._activeEffect);const a=this._mustRebind(r,n,t.visibility);if(a){this._uniformBuffer.bindToEffect(n,"Material"),this.bindViewProjection(n);const e=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(r.texturesEnabled&&(this._diffuseTexture&&_.k.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),u.G.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),e&&_.k.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",e.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",e.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",e.getSize().width,e.lodGenerationScale,e.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),s.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),r.texturesEnabled&&(this._diffuseTexture&&_.k.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),e&&_.k.ReflectionTextureEnabled&&(s.REFLECTIONBLUR&&s.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",e):s.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",e._lodTextureMid||e),this._uniformBuffer.setTexture("reflectionSamplerLow",e._lodTextureLow||e),this._uniformBuffer.setTexture("reflectionSamplerHigh",e._lodTextureHigh||e)):this._uniformBuffer.setTexture("reflectionSampler",e),s.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),(0,x.an)(this._activeEffect,this,r),r.bindEyePosition(n)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._uniformBuffer.bindToEffect(n,"Material"),this._needToBindSceneUbo=!0);!a&&this.isFrozen||(r.lightsEnabled&&u.G.BindLights(r,t,this._activeEffect,s,this._maxSimultaneousLights),this.bindView(n),u.G.BindFogParameters(r,t,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect),this._uniformBuffer.update()}hasTexture(e){return!!super.hasTexture(e)||(this._reflectionTexture===e||this._diffuseTexture===e)}dispose(e=!1,t=!1){t&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e)}clone(e){return s.p4.Clone((()=>new N(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.BackgroundMaterial",e}getClassName(){return"BackgroundMaterial"}static Parse(e,t,i){return s.p4.Parse((()=>new N(e.name,t)),e,t,i)}}N.StandardReflectance0=.05,N.StandardReflectance90=.5,(0,r.gn)([(0,s.n9)()],N.prototype,"_primaryColor",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsLightsDirty")],N.prototype,"primaryColor",void 0),(0,r.gn)([(0,s.n9)()],N.prototype,"__perceptualColor",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_primaryColorShadowLevel",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_primaryColorHighlightLevel",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsLightsDirty")],N.prototype,"primaryColorHighlightLevel",null),(0,r.gn)([(0,s.oU)()],N.prototype,"_reflectionTexture",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionTexture",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_reflectionBlur",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionBlur",void 0),(0,r.gn)([(0,s.oU)()],N.prototype,"_diffuseTexture",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"diffuseTexture",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"shadowLights",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_shadowLevel",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"shadowLevel",void 0),(0,r.gn)([(0,s.hd)()],N.prototype,"_sceneCenter",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"sceneCenter",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_opacityFresnel",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"opacityFresnel",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_reflectionFresnel",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionFresnel",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_reflectionFalloffDistance",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionFalloffDistance",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_reflectionAmount",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionAmount",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_reflectionReflectance0",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionReflectance0",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_reflectionReflectance90",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"reflectionReflectance90",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_useRGBColor",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useRGBColor",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_enableNoise",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"enableNoise",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_maxSimultaneousLights",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"maxSimultaneousLights",void 0),(0,r.gn)([(0,s.qC)()],N.prototype,"_shadowOnly",void 0),(0,r.gn)([(0,s.wz)("_markAllSubMeshesAsLightsDirty")],N.prototype,"shadowOnly",void 0),(0,r.gn)([(0,s.rX)()],N.prototype,"_imageProcessingConfiguration",void 0),(0,p.H)("BABYLON.BackgroundMaterial",N)},99625:(e,t,i)=>{i(17713)},853:(e,t,i)=>{i.d(t,{K:()=>l});var r=i(89592),s=i(89762),n=i(70848),a=i(48620),o=i(73803);class l extends r.k{constructor(e){super(e,n.u.VertexAndFragment),this._samplerName="textureSampler",this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._isUnique=!1,this.registerInput("uv",s.E.AutoDetect,!1,n.u.VertexAndFragment),this.registerOutput("rgba",s.E.Color4,n.u.Neutral),this.registerOutput("rgb",s.E.Color3,n.u.Neutral),this.registerOutput("r",s.E.Float,n.u.Neutral),this.registerOutput("g",s.E.Float,n.u.Neutral),this.registerOutput("b",s.E.Float,n.u.Neutral),this.registerOutput("a",s.E.Float,n.u.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(s.E.Vector2|s.E.Vector3|s.E.Vector4),this._inputs[0]._prioritizeVertex=!1}getClassName(){return"CurrentScreenBlock"}get uv(){return this._inputs[0]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}initialize(e){e._excludeVariableName("textureSampler")}get target(){return this.uv.isConnected?this.uv.sourceBlock.isInput?n.u.VertexAndFragment:n.u.Fragment:n.u.VertexAndFragment}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}_injectVertexCode(e){const t=this.uv;if(t.connectedPoint.ownerBlock.isInput){t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,"vec2")}if(this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,"vec2"),e.compilationString+=`${this._mainUVName} = ${t.associatedVariableName}.xy;\r\n`,this._outputs.some((e=>e.isConnectedInVertexShader))){this._writeTextureRead(e,!0);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name,!0)}}_writeTextureRead(e,t=!1){const i=this.uv;if(t){if(e.target===n.u.Fragment)return;e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${this._samplerName}, ${i.associatedVariableName});\r\n`}else this.uv.ownerBlock.target!==n.u.Fragment?e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${this._samplerName}, ${this._mainUVName});\r\n`:e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${this._samplerName}, ${i.associatedVariableName});\r\n`}_writeOutput(e,t,i,r=!1){if(r){if(e.target===n.u.Fragment)return;e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i};\r\n`}else this.uv.ownerBlock.target!==n.u.Fragment?(e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i};\r\n`,e.compilationString+=`#ifdef ${this._linearDefineName}\r\n`,e.compilationString+=`${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\r\n`,e.compilationString+="#endif\r\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\r\n`,e.compilationString+=`${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\r\n`,e.compilationString+="#endif\r\n"):e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i};\r\n`}_buildBlock(e){if(super._buildBlock(e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==n.u.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(!this._outputs.some((e=>e.isConnectedInFragmentShader)))return;e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),this._writeTextureRead(e);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,t.name);return this}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=o.x.Parse(e.texture,t,i))}}(0,a.H)("BABYLON.CurrentScreenBlock",l)},14611:(e,t,i)=>{i.d(t,{S:()=>d});var r=i(89592),s=i(89762),n=i(96979),a=i(70848),o=i(48620),l=i(73803),h=i(97163),u=i(93682),c=i(15210);class d extends r.k{get texture(){return this._texture}set texture(e){var t;if(this._texture===e)return;const i=null!==(t=null==e?void 0:e.getScene())&&void 0!==t?t:c.l.LastCreatedScene;!e&&i&&i.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this._texture))),this._texture=e,e&&i&&i.markAllMaterialsAsDirty(1,(t=>t.hasTexture(e)))}get samplerName(){return this._samplerName}constructor(e){super(e,a.u.VertexAndFragment),this.registerOutput("source",s.E.Object,a.u.VertexAndFragment,new u.C("source",this,n.Ab.Output,d,"ImageSourceBlock"))}bind(e){this.texture&&e.setTexture(this._samplerName,this.texture)}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}getClassName(){return"ImageSourceBlock"}get source(){return this._outputs[0]}_buildBlock(e){return super._buildBlock(e),e.target===a.u.Vertex&&(this._samplerName=e._getFreeVariableName(this.name+"Sampler"),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.bindableBlocks.push(this)),e._emit2DSampler(this._samplerName),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return this.texture?(e+=`${this._codeVariableName}.texture = new BABYLON.Texture("${this.texture.name}", null, ${this.texture.noMipmap}, ${this.texture.invertY}, ${this.texture.samplingMode});\r\n`,e+=`${this._codeVariableName}.texture.wrapU = ${this.texture.wrapU};\r\n`,e+=`${this._codeVariableName}.texture.wrapV = ${this.texture.wrapV};\r\n`,e+=`${this._codeVariableName}.texture.uAng = ${this.texture.uAng};\r\n`,e+=`${this._codeVariableName}.texture.vAng = ${this.texture.vAng};\r\n`,e+=`${this._codeVariableName}.texture.wAng = ${this.texture.wAng};\r\n`,e+=`${this._codeVariableName}.texture.uOffset = ${this.texture.uOffset};\r\n`,e+=`${this._codeVariableName}.texture.vOffset = ${this.texture.vOffset};\r\n`,e+=`${this._codeVariableName}.texture.uScale = ${this.texture.uScale};\r\n`,e+=`${this._codeVariableName}.texture.vScale = ${this.texture.vScale};\r\n`,e+=`${this._codeVariableName}.texture.coordinatesMode = ${this.texture.coordinatesMode};\r\n`,e):e}serialize(){const e=super.serialize();return this.texture&&!this.texture.isRenderTarget&&"VideoTexture"!==this.texture.getClassName()&&(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),e.texture&&!h.O.IgnoreTexturesAtLoadTime&&void 0!==e.texture.url&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=l.x.Parse(e.texture,t,i))}}(0,o.H)("BABYLON.ImageSourceBlock",d)},73109:(e,t,i)=>{var r=i(89592),s=i(89762),n=i(69958),a=i(70848),o=i(90360),l=i(62976),h=i(48620);i(62495);class u extends r.k{constructor(e){super(e,a.u.VertexAndFragment,!1),this.registerInput("worldPosition",s.E.Vector4,!1,a.u.Vertex),this.registerInput("view",s.E.Matrix,!1,a.u.Vertex),this.registerInput("input",s.E.AutoDetect,!1,a.u.Fragment),this.registerInput("fogColor",s.E.AutoDetect,!1,a.u.Fragment),this.registerOutput("output",s.E.Color3,a.u.Fragment),this.input.addExcludedConnectionPointFromAllowedTypes(s.E.Color3|s.E.Vector3|s.E.Color4),this.fogColor.addExcludedConnectionPointFromAllowedTypes(s.E.Color3|s.E.Vector3|s.E.Color4)}getClassName(){return"FogBlock"}get worldPosition(){return this._inputs[0]}get view(){return this._inputs[1]}get input(){return this._inputs[2]}get fogColor(){return this._inputs[3]}get output(){return this._outputs[0]}autoConfigure(e){if(!this.view.isConnected){let t=e.getInputBlockByPredicate((e=>e.systemValue===n.$.View));t||(t=new l.S("view"),t.setAsSystemValue(n.$.View)),t.output.connectTo(this.view)}if(!this.fogColor.isConnected){let t=e.getInputBlockByPredicate((e=>e.systemValue===n.$.FogColor));t||(t=new l.S("fogColor",void 0,s.E.Color3),t.setAsSystemValue(n.$.FogColor)),t.output.connectTo(this.fogColor)}}prepareDefines(e,t,i){const r=e.getScene();i.setValue("FOG",t.fogEnabled&&o.G.GetFogState(e,r))}bind(e,t,i){if(!i)return;const r=i.getScene();e.setFloat4(this._fogParameters,r.fogMode,r.fogStart,r.fogEnd,r.fogDensity)}_buildBlock(e){if(super._buildBlock(e),e.target===a.u.Fragment){e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),e._emitFunctionFromInclude("fogFragmentDeclaration",`//${this.name}`,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});const t=e._getFreeVariableName("fog"),i=this.input,r=this.fogColor;this._fogParameters=e._getFreeVariableName("fogParameters");const s=this._outputs[0];e._emitUniformFromString(this._fogParameters,"vec4"),e.compilationString+="#ifdef FOG\r\n",e.compilationString+=`float ${t} = CalcFogFactor(${this._fogDistanceName}, ${this._fogParameters});\r\n`,e.compilationString+=this._declareOutput(s,e)+` = ${t} * ${i.associatedVariableName}.rgb + (1.0 - ${t}) * ${r.associatedVariableName}.rgb;\r\n`,e.compilationString+=`#else\r\n${this._declareOutput(s,e)} =  ${i.associatedVariableName}.rgb;\r\n`,e.compilationString+="#endif\r\n"}else{const t=this.worldPosition,i=this.view;this._fogDistanceName=e._getFreeVariableName("vFogDistance"),e._emitVaryingFromString(this._fogDistanceName,"vec3"),e.compilationString+=`${this._fogDistanceName} = (${i.associatedVariableName} * ${t.associatedVariableName}).xyz;\r\n`}return this}}(0,h.H)("BABYLON.FogBlock",u);var c=i(72433),d=i(12352);i(46545),i(50682),i(46462),i(70089),i(87954),i(54081),i(43921),i(6506),i(16744);class m extends r.k{static _OnGenerateOnlyFragmentCodeChanged(e,t){const i=e;return i.worldPosition.isConnected?(i.generateOnlyFragmentCode=!i.generateOnlyFragmentCode,console.error("The worldPosition input must not be connected to be able to switch!"),!1):(i._setTarget(),!0)}_setTarget(){this._setInitialTarget(this.generateOnlyFragmentCode?a.u.Fragment:a.u.VertexAndFragment),this.getInputByName("worldPosition").target=this.generateOnlyFragmentCode?a.u.Fragment:a.u.Vertex}constructor(e){super(e,a.u.VertexAndFragment),this._lightId=0,this.generateOnlyFragmentCode=!1,this._isUnique=!0,this.registerInput("worldPosition",s.E.Vector4,!1,a.u.Vertex),this.registerInput("worldNormal",s.E.Vector4,!1,a.u.Fragment),this.registerInput("cameraPosition",s.E.Vector3,!1,a.u.Fragment),this.registerInput("glossiness",s.E.Float,!0,a.u.Fragment),this.registerInput("glossPower",s.E.Float,!0,a.u.Fragment),this.registerInput("diffuseColor",s.E.Color3,!0,a.u.Fragment),this.registerInput("specularColor",s.E.Color3,!0,a.u.Fragment),this.registerInput("view",s.E.Matrix,!0),this.registerOutput("diffuseOutput",s.E.Color3,a.u.Fragment),this.registerOutput("specularOutput",s.E.Color3,a.u.Fragment),this.registerOutput("shadow",s.E.Float,a.u.Fragment)}getClassName(){return"LightBlock"}get worldPosition(){return this._inputs[0]}get worldNormal(){return this._inputs[1]}get cameraPosition(){return this._inputs[2]}get glossiness(){return this._inputs[3]}get glossPower(){return this._inputs[4]}get diffuseColor(){return this._inputs[5]}get specularColor(){return this._inputs[6]}get view(){return this._inputs[7]}get diffuseOutput(){return this._outputs[0]}get specularOutput(){return this._outputs[1]}get shadow(){return this._outputs[2]}autoConfigure(e){if(!this.cameraPosition.isConnected){let t=e.getInputBlockByPredicate((e=>e.systemValue===n.$.CameraPosition));t||(t=new l.S("cameraPosition"),t.setAsSystemValue(n.$.CameraPosition)),t.output.connectTo(this.cameraPosition)}}prepareDefines(e,t,i){if(!i._areLightsDirty)return;const r=e.getScene();if(this.light){const t={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};o.G.PrepareDefinesForLight(r,e,this.light,this._lightId,i,!0,t),t.needRebuild&&i.rebuild()}else o.G.PrepareDefinesForLights(r,e,i,!0,t.maxSimultaneousLights)}updateUniformsAndSamples(e,t,i,r){for(let s=0;s<t.maxSimultaneousLights&&i["LIGHT"+s];s++){const t=e.uniforms.indexOf("vLightData"+s)>=0;o.G.PrepareUniformsAndSamplersForLight(s,e.uniforms,e.samplers,i["PROJECTEDLIGHTTEXTURE"+s],r,t)}}bind(e,t,i){if(!i)return;const r=i.getScene();this.light?o.G.BindLight(this.light,this._lightId,r,e,!0):o.G.BindLights(r,i,e,!0,t.maxSimultaneousLights)}_injectVertexCode(e){const t=this.worldPosition,i=`//${this.name}`;this.light?(this._lightId=(void 0!==e.counters.lightCounter?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));const r="v_"+t.associatedVariableName;e._emitVaryingFromString(r,"vec4")&&(e.compilationString+=`${r} = ${t.associatedVariableName};\r\n`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:t.associatedVariableName}]}):(e.compilationString+=`vec4 worldPos = ${t.associatedVariableName};\r\n`,this.view.isConnected&&(e.compilationString+=`mat4 view = ${this.view.associatedVariableName};\r\n`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{repeatKey:"maxSimultaneousLights"}))}_buildBlock(e){if(super._buildBlock(e),e.target!==a.u.Fragment)return void this._injectVertexCode(e);this.generateOnlyFragmentCode&&e.sharedData.dynamicUniformBlocks.push(this),e.sharedData.forcedBindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);const t=`//${this.name}`,i=this.worldPosition;let r=i.associatedVariableName;this.generateOnlyFragmentCode?(r=e._getFreeVariableName("globalWorldPos"),e._emitFunction("light_globalworldpos",`vec3 ${r};\r\n`,t),e.compilationString+=`${r} = ${i.associatedVariableName}.xyz;\r\n`,e.compilationString+=e._emitCodeFromInclude("shadowsVertex",t,{repeatKey:"maxSimultaneousLights",substitutionVars:this.generateOnlyFragmentCode?`worldPos,${i.associatedVariableName}`:void 0})):r="v_"+r+".xyz",e._emitFunctionFromInclude("helperFunctions",t),e._emitFunctionFromInclude("lightsFragmentFunctions",t,{replaceStrings:[{search:/vPositionW/g,replace:r}]}),e._emitFunctionFromInclude("shadowsFragmentFunctions",t,{replaceStrings:[{search:/vPositionW/g,replace:r}]}),this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",t,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",t,{repeatKey:"maxSimultaneousLights",substitutionVars:this.generateOnlyFragmentCode?"varying,":void 0}),0===this._lightId&&(e._registerTempVariable("viewDirectionW")&&(e.compilationString+=`vec3 viewDirectionW = normalize(${this.cameraPosition.associatedVariableName} - ${r});\r\n`),e.compilationString+="lightingInfo info;\r\n",e.compilationString+="float shadow = 1.;\r\n",e.compilationString+=`float glossiness = ${this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0"} * ${this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0"};\r\n`,e.compilationString+="vec3 diffuseBase = vec3(0., 0., 0.);\r\n",e.compilationString+="vec3 specularBase = vec3(0., 0., 0.);\r\n",e.compilationString+=`vec3 normalW = ${this.worldNormal.associatedVariableName}.xyz;\r\n`),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",t,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",t,{repeatKey:"maxSimultaneousLights"});const s=this.diffuseOutput,n=this.specularOutput;return e.compilationString+=this._declareOutput(s,e)+` = diffuseBase${this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:""};\r\n`,n.hasEndpoints&&(e.compilationString+=this._declareOutput(n,e)+` = specularBase${this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:""};\r\n`),this.shadow.hasEndpoints&&(e.compilationString+=this._declareOutput(this.shadow,e)+" = shadow;\r\n"),this}serialize(){const e=super.serialize();return e.generateOnlyFragmentCode=this.generateOnlyFragmentCode,this.light&&(e.lightId=this.light.id),e}_deserialize(e,t,i){super._deserialize(e,t,i),e.lightId&&(this.light=t.getLightById(e.lightId)),this.generateOnlyFragmentCode=e.generateOnlyFragmentCode,this._setTarget()}}(0,c.gn)([(0,d.p)("Generate only fragment code",d.U.Boolean,"ADVANCED",{notifiers:{rebuild:!0,update:!0,onValidation:m._OnGenerateOnlyFragmentCodeChanged}})],m.prototype,"generateOnlyFragmentCode",void 0),(0,h.H)("BABYLON.LightBlock",m);var g=i(96979),p=i(97163),_=i(73803),f=i(44337),S=i(14611),x=i(93682),C=i(15210);class N extends r.k{get texture(){var e;return this.source.isConnected?(null===(e=this.source.connectedPoint)||void 0===e?void 0:e.ownerBlock).texture:this._texture}set texture(e){var t;if(this._texture===e)return;const i=null!==(t=null==e?void 0:e.getScene())&&void 0!==t?t:C.l.LastCreatedScene;!e&&i&&i.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this._texture))),this._texture=e,e&&i&&i.markAllMaterialsAsDirty(1,(t=>t.hasTexture(e)))}get samplerName(){return this._imageSource?this._imageSource.samplerName:this._samplerName}get hasImageSource(){return this.source.isConnected}set convertToGammaSpace(e){var t;if(e!==this._convertToGammaSpace&&(this._convertToGammaSpace=e,this.texture)){const e=null!==(t=this.texture.getScene())&&void 0!==t?t:C.l.LastCreatedScene;null==e||e.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this.texture)))}}get convertToGammaSpace(){return this._convertToGammaSpace}set convertToLinearSpace(e){var t;if(e!==this._convertToLinearSpace&&(this._convertToLinearSpace=e,this.texture)){const e=null!==(t=this.texture.getScene())&&void 0!==t?t:C.l.LastCreatedScene;null==e||e.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this.texture)))}}get convertToLinearSpace(){return this._convertToLinearSpace}constructor(e,t=!1){super(e,t?a.u.Fragment:a.u.VertexAndFragment),this._convertToGammaSpace=!1,this._convertToLinearSpace=!1,this.disableLevelMultiplication=!1,this._fragmentOnly=t,this.registerInput("uv",s.E.AutoDetect,!1,a.u.VertexAndFragment),this.registerInput("source",s.E.Object,!0,a.u.VertexAndFragment,new x.C("source",this,g.Ab.Input,S.S,"ImageSourceBlock")),this.registerOutput("rgba",s.E.Color4,a.u.Neutral),this.registerOutput("rgb",s.E.Color3,a.u.Neutral),this.registerOutput("r",s.E.Float,a.u.Neutral),this.registerOutput("g",s.E.Float,a.u.Neutral),this.registerOutput("b",s.E.Float,a.u.Neutral),this.registerOutput("a",s.E.Float,a.u.Neutral),this.registerOutput("level",s.E.Float,a.u.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(s.E.Vector2|s.E.Vector3|s.E.Vector4),this._inputs[0]._prioritizeVertex=!t}getClassName(){return"TextureBlock"}get uv(){return this._inputs[0]}get source(){return this._inputs[1]}get rgba(){return this._outputs[0]}get rgb(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}get level(){return this._outputs[6]}get target(){if(this._fragmentOnly)return a.u.Fragment;if(!this.uv.isConnected)return a.u.VertexAndFragment;if(this.uv.sourceBlock.isInput)return a.u.VertexAndFragment;let e=this.uv.connectedPoint;for(;e;){if(e.target===a.u.Fragment)return a.u.Fragment;if(e.target===a.u.Vertex)return a.u.VertexAndFragment;if(e.target===a.u.Neutral||e.target===a.u.VertexAndFragment){const t=e.ownerBlock;if(t.target===a.u.Fragment)return a.u.Fragment;e=null;for(const i of t.inputs)if(i.connectedPoint){e=i.connectedPoint;break}}}return a.u.VertexAndFragment}set target(e){}autoConfigure(e){if(!this.uv.isConnected)if(e.mode===f.a.PostProcess){const t=e.getBlockByPredicate((e=>"uv"===e.name));t&&t.connectTo(this)}else{const t=e.mode===f.a.Particle?"particle_uv":"uv";let i=e.getInputBlockByPredicate((e=>e.isAttribute&&e.name===t));i||(i=new l.S("uv"),i.setAsAttribute(t)),i.output.connectTo(this.uv)}}initializeDefines(e,t,i){i._areTexturesDirty&&void 0!==this._mainUVDefineName&&i.setValue(this._mainUVDefineName,!1,!0)}prepareDefines(e,t,i){if(!i._areTexturesDirty)return;if(!this.texture||!this.texture.getTextureMatrix)return void(this._isMixed&&(i.setValue(this._defineName,!1,!0),i.setValue(this._mainUVDefineName,!0,!0)));const r=this.convertToGammaSpace&&this.texture&&!this.texture.gammaSpace,s=this.convertToLinearSpace&&this.texture&&this.texture.gammaSpace;i.setValue(this._linearDefineName,r,!0),i.setValue(this._gammaDefineName,s,!0),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(i.setValue(this._defineName,!1,!0),i.setValue(this._mainUVDefineName,!0,!0)):(i.setValue(this._defineName,!0),null==i[this._mainUVDefineName]&&i.setValue(this._mainUVDefineName,!1,!0)))}isReady(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())}bind(e){this.texture&&(this._isMixed&&(e.setFloat(this._textureInfoName,this.texture.level),e.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),this._imageSource||e.setTexture(this._samplerName,this.texture))}get _isMixed(){return this.target!==a.u.Fragment}_injectVertexCode(e){const t=this.uv;if(this._defineName=e._getFreeDefineName("UVTRANSFORM"),this._mainUVDefineName="VMAIN"+t.associatedVariableName.toUpperCase(),this._mainUVName="vMain"+t.associatedVariableName,this._transformedUVName=e._getFreeVariableName("transformedUV"),this._textureTransformName=e._getFreeVariableName("textureTransform"),this._textureInfoName=e._getFreeVariableName("textureInfoName"),this.level.associatedVariableName=this._textureInfoName,e._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName),e._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName),e._emitUniformFromString(this._textureTransformName,"mat4",this._defineName),e.compilationString+=`#ifdef ${this._defineName}\r\n`,e.compilationString+=`${this._transformedUVName} = vec2(${this._textureTransformName} * vec4(${t.associatedVariableName}.xy, 1.0, 0.0));\r\n`,e.compilationString+=`#elif defined(${this._mainUVDefineName})\r\n`,e.compilationString+=`${this._mainUVName} = ${t.associatedVariableName}.xy;\r\n`,e.compilationString+="#endif\r\n",this._outputs.some((e=>e.isConnectedInVertexShader))){this._writeTextureRead(e,!0);for(const t of this._outputs)t.hasEndpoints&&"level"!==t.name&&this._writeOutput(e,t,t.name,!0)}}_generateTextureLookup(e){const t=this.samplerName;e.compilationString+=`#ifdef ${this._defineName}\r\n`,e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${t}, ${this._transformedUVName});\r\n`,e.compilationString+=`#elif defined(${this._mainUVDefineName})\r\n`,e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${t}, ${this._mainUVName?this._mainUVName:this.uv.associatedVariableName});\r\n`,e.compilationString+="#endif\r\n"}_writeTextureRead(e,t=!1){const i=this.uv;if(t){if(e.target===a.u.Fragment)return;this._generateTextureLookup(e)}else this.uv.ownerBlock.target!==a.u.Fragment?this._generateTextureLookup(e):e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${this.samplerName}, ${i.associatedVariableName});\r\n`}_generateConversionCode(e,t,i){"a"!==i&&(this.texture&&this.texture.gammaSpace||(e.compilationString+=`#ifdef ${this._linearDefineName}\n                    ${t.associatedVariableName} = toGammaSpace(${t.associatedVariableName});\n                    #endif\n                `),e.compilationString+=`#ifdef ${this._gammaDefineName}\n                ${t.associatedVariableName} = toLinearSpace(${t.associatedVariableName});\n                #endif\n            `)}_writeOutput(e,t,i,r=!1){if(r){if(e.target===a.u.Fragment)return;return e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i};\r\n`,void this._generateConversionCode(e,t,i)}if(this.uv.ownerBlock.target===a.u.Fragment)return e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i};\r\n`,void this._generateConversionCode(e,t,i);let s="";this.disableLevelMultiplication||(s=` * ${this._textureInfoName}`),e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i}${s};\r\n`,this._generateConversionCode(e,t,i)}_buildBlock(e){if(super._buildBlock(e),this.source.isConnected?this._imageSource=this.source.connectedPoint.ownerBlock:this._imageSource=null,(e.target===a.u.Vertex||this._fragmentOnly||e.target===a.u.Fragment)&&(this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA")),(!this._isMixed&&e.target===a.u.Fragment||this._isMixed&&e.target===a.u.Vertex)&&(this._imageSource||(this._samplerName=e._getFreeVariableName(this.name+"Sampler"),e._emit2DSampler(this._samplerName)),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this)),e.target!==a.u.Fragment)return void this._injectVertexCode(e);if(!this._outputs.some((e=>e.isConnectedInFragmentShader)))return;this._isMixed&&!this._imageSource&&e._emit2DSampler(this._samplerName);const t=`//${this.name}`;e._emitFunctionFromInclude("helperFunctions",t),this._isMixed&&e._emitUniformFromString(this._textureInfoName,"float"),this._writeTextureRead(e);for(const t of this._outputs)t.hasEndpoints&&"level"!==t.name&&this._writeOutput(e,t,t.name);return this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.convertToGammaSpace = ${this.convertToGammaSpace};\r\n`,e+=`${this._codeVariableName}.convertToLinearSpace = ${this.convertToLinearSpace};\r\n`,e+=`${this._codeVariableName}.disableLevelMultiplication = ${this.disableLevelMultiplication};\r\n`,this.texture?(e+=`${this._codeVariableName}.texture = new BABYLON.Texture("${this.texture.name}", null, ${this.texture.noMipmap}, ${this.texture.invertY}, ${this.texture.samplingMode});\r\n`,e+=`${this._codeVariableName}.texture.wrapU = ${this.texture.wrapU};\r\n`,e+=`${this._codeVariableName}.texture.wrapV = ${this.texture.wrapV};\r\n`,e+=`${this._codeVariableName}.texture.uAng = ${this.texture.uAng};\r\n`,e+=`${this._codeVariableName}.texture.vAng = ${this.texture.vAng};\r\n`,e+=`${this._codeVariableName}.texture.wAng = ${this.texture.wAng};\r\n`,e+=`${this._codeVariableName}.texture.uOffset = ${this.texture.uOffset};\r\n`,e+=`${this._codeVariableName}.texture.vOffset = ${this.texture.vOffset};\r\n`,e+=`${this._codeVariableName}.texture.uScale = ${this.texture.uScale};\r\n`,e+=`${this._codeVariableName}.texture.vScale = ${this.texture.vScale};\r\n`,e+=`${this._codeVariableName}.texture.coordinatesMode = ${this.texture.coordinatesMode};\r\n`,e):e}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.fragmentOnly=this._fragmentOnly,e.disableLevelMultiplication=this.disableLevelMultiplication,this.hasImageSource||!this.texture||this.texture.isRenderTarget||"VideoTexture"===this.texture.getClassName()||(e.texture=this.texture.serialize()),e}_deserialize(e,t,i){super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this._fragmentOnly=!!e.fragmentOnly,this.disableLevelMultiplication=!!e.disableLevelMultiplication,e.texture&&!p.O.IgnoreTexturesAtLoadTime&&void 0!==e.texture.url&&(i=0===e.texture.url.indexOf("data:")?"":i,this.texture=_.x.Parse(e.texture,t,i))}}(0,h.H)("BABYLON.TextureBlock",N);var T=i(44264);class M extends T.W{_onGenerateOnlyFragmentCodeChanged(){return this.position.isConnected?(this.generateOnlyFragmentCode=!this.generateOnlyFragmentCode,console.error("The position input must not be connected to be able to switch!"),!1):this.worldPosition.isConnected?(this.generateOnlyFragmentCode=!this.generateOnlyFragmentCode,console.error("The worldPosition input must not be connected to be able to switch!"),!1):(this._setTarget(),!0)}_setTarget(){super._setTarget(),this.getInputByName("position").target=this.generateOnlyFragmentCode?a.u.Fragment:a.u.Vertex,this.getInputByName("worldPosition").target=this.generateOnlyFragmentCode?a.u.Fragment:a.u.Vertex}constructor(e){super(e),this.registerInput("position",s.E.AutoDetect,!1,a.u.Vertex),this.registerInput("worldPosition",s.E.Vector4,!1,a.u.Vertex),this.registerInput("worldNormal",s.E.Vector4,!1,a.u.Fragment),this.registerInput("world",s.E.Matrix,!1,a.u.Vertex),this.registerInput("cameraPosition",s.E.Vector3,!1,a.u.Fragment),this.registerInput("view",s.E.Matrix,!1,a.u.Fragment),this.registerOutput("rgb",s.E.Color3,a.u.Fragment),this.registerOutput("rgba",s.E.Color4,a.u.Fragment),this.registerOutput("r",s.E.Float,a.u.Fragment),this.registerOutput("g",s.E.Float,a.u.Fragment),this.registerOutput("b",s.E.Float,a.u.Fragment),this.registerOutput("a",s.E.Float,a.u.Fragment),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(s.E.Color3|s.E.Vector3|s.E.Vector4)}getClassName(){return"ReflectionTextureBlock"}get position(){return this._inputs[0]}get worldPosition(){return this._inputs[1]}get worldNormal(){return this._inputs[2]}get world(){return this._inputs[3]}get cameraPosition(){return this._inputs[4]}get view(){return this._inputs[5]}get rgb(){return this._outputs[0]}get rgba(){return this._outputs[1]}get r(){return this._outputs[2]}get g(){return this._outputs[3]}get b(){return this._outputs[4]}get a(){return this._outputs[5]}autoConfigure(e){if(super.autoConfigure(e),!this.cameraPosition.isConnected){let t=e.getInputBlockByPredicate((e=>e.systemValue===n.$.CameraPosition));t||(t=new l.S("cameraPosition"),t.setAsSystemValue(n.$.CameraPosition)),t.output.connectTo(this.cameraPosition)}}_buildBlock(e){if(super._buildBlock(e),!this.texture)return e.compilationString+=this.writeOutputs(e,"vec4(0.)"),this;if(e.target!==a.u.Fragment)return e.compilationString+=this.handleVertexSide(e),this;this.generateOnlyFragmentCode&&(e.compilationString+=this.handleVertexSide(e)),this.handleFragmentSideInits(e);const t=e._getFreeVariableName("normalWUnit");return e.compilationString+=`vec4 ${t} = normalize(${this.worldNormal.associatedVariableName});\r\n`,e.compilationString+=this.handleFragmentSideCodeReflectionCoords(t),e.compilationString+=this.handleFragmentSideCodeReflectionColor(void 0,""),e.compilationString+=this.writeOutputs(e,this._reflectionColorName),this}}(0,h.H)("BABYLON.ReflectionTextureBlock",M);i(853);class E extends r.k{constructor(e){super(e,a.u.VertexAndFragment),this.useNonLinearDepth=!1,this.force32itsFloat=!1,this._isUnique=!0,this.registerInput("uv",s.E.AutoDetect,!1,a.u.VertexAndFragment),this.registerOutput("depth",s.E.Float,a.u.Neutral),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(s.E.Vector2|s.E.Vector3|s.E.Vector4),this._inputs[0]._prioritizeVertex=!1}getClassName(){return"SceneDepthBlock"}get uv(){return this._inputs[0]}get depth(){return this._outputs[0]}initialize(e){e._excludeVariableName("textureSampler")}get target(){return this.uv.isConnected?this.uv.sourceBlock.isInput?a.u.VertexAndFragment:a.u.Fragment:a.u.VertexAndFragment}_getTexture(e){return e.enableDepthRenderer(void 0,this.useNonLinearDepth,this.force32itsFloat).getDepthMap()}bind(e,t){const i=this._getTexture(t.getScene());e.setTexture(this._samplerName,i)}_injectVertexCode(e){const t=this.uv;if(t.connectedPoint.ownerBlock.isInput){t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,"vec"+(t.type===s.E.Vector3?"3":t.type===s.E.Vector4?"4":"2"))}if(this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,"vec2"),e.compilationString+=`${this._mainUVName} = ${t.associatedVariableName}.xy;\r\n`,this._outputs.some((e=>e.isConnectedInVertexShader))){this._writeTextureRead(e,!0);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,"r",!0)}}_writeTextureRead(e,t=!1){const i=this.uv;if(t){if(e.target===a.u.Fragment)return;e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${this._samplerName}, ${i.associatedVariableName}.xy);\r\n`}else this.uv.ownerBlock.target!==a.u.Fragment?e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${this._samplerName}, ${this._mainUVName});\r\n`:e.compilationString+=`vec4 ${this._tempTextureRead} = texture2D(${this._samplerName}, ${i.associatedVariableName}.xy);\r\n`}_writeOutput(e,t,i,r=!1){if(r){if(e.target===a.u.Fragment)return;e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i};\r\n`}else this.uv.ownerBlock.target,a.u.Fragment,e.compilationString+=`${this._declareOutput(t,e)} = ${this._tempTextureRead}.${i};\r\n`}_buildBlock(e){if(super._buildBlock(e),this._samplerName=e._getFreeVariableName(this.name+"Sampler"),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.bindableBlocks.indexOf(this)<0&&e.sharedData.bindableBlocks.push(this),e.target!==a.u.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(this._outputs.some((e=>e.isConnectedInFragmentShader))){e._emit2DSampler(this._samplerName),this._writeTextureRead(e);for(const t of this._outputs)t.hasEndpoints&&this._writeOutput(e,t,"r");return this}}serialize(){const e=super.serialize();return e.useNonLinearDepth=this.useNonLinearDepth,e.force32itsFloat=this.force32itsFloat,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.useNonLinearDepth=e.useNonLinearDepth,this.force32itsFloat=e.force32itsFloat}}(0,c.gn)([(0,d.p)("Use non linear depth",d.U.Boolean,"ADVANCED",{notifiers:{activatePreviewCommand:!0,callback:e=>e.disableDepthRenderer()}})],E.prototype,"useNonLinearDepth",void 0),(0,c.gn)([(0,d.p)("Force 32 bits float",d.U.Boolean,"ADVANCED",{notifiers:{activatePreviewCommand:!0,callback:e=>e.disableDepthRenderer()}})],E.prototype,"force32itsFloat",void 0),(0,h.H)("BABYLON.SceneDepthBlock",E);var v=i(77633);class I extends r.k{constructor(e){super(e,a.u.VertexAndFragment,!0),this.registerInput("worldPosition",s.E.Vector4,!1)}getClassName(){return"ClipPlanesBlock"}initialize(e){e._excludeVariableName("vClipPlane"),e._excludeVariableName("fClipDistance"),e._excludeVariableName("vClipPlane2"),e._excludeVariableName("fClipDistance2"),e._excludeVariableName("vClipPlane3"),e._excludeVariableName("fClipDistance3"),e._excludeVariableName("vClipPlane4"),e._excludeVariableName("fClipDistance4"),e._excludeVariableName("vClipPlane5"),e._excludeVariableName("fClipDistance5"),e._excludeVariableName("vClipPlane6"),e._excludeVariableName("fClipDistance6")}get worldPosition(){return this._inputs[0]}get target(){return a.u.VertexAndFragment}set target(e){}prepareDefines(e,t,i){var r,s,n,a,o,l;const h=e.getScene(),u=!!(null!==(r=t.clipPlane)&&void 0!==r?r:h.clipPlane),c=!!(null!==(s=t.clipPlane2)&&void 0!==s?s:h.clipPlane2),d=!!(null!==(n=t.clipPlane3)&&void 0!==n?n:h.clipPlane3),m=!!(null!==(a=t.clipPlane4)&&void 0!==a?a:h.clipPlane4),g=!!(null!==(o=t.clipPlane5)&&void 0!==o?o:h.clipPlane5),p=!!(null!==(l=t.clipPlane6)&&void 0!==l?l:h.clipPlane6);i.setValue("CLIPPLANE",u,!0),i.setValue("CLIPPLANE2",c,!0),i.setValue("CLIPPLANE3",d,!0),i.setValue("CLIPPLANE4",m,!0),i.setValue("CLIPPLANE5",g,!0),i.setValue("CLIPPLANE6",p,!0)}bind(e,t,i){if(!i)return;const r=i.getScene();(0,v.an)(e,t,r)}_buildBlock(e){super._buildBlock(e);const t=`//${this.name}`;if(e.target!==a.u.Fragment){const i=this.worldPosition;return e._emitFunctionFromInclude("clipPlaneVertexDeclaration",t,{replaceStrings:[{search:/uniform vec4 vClipPlane\d*;/g,replace:""}]}),e.compilationString+=e._emitCodeFromInclude("clipPlaneVertex",t,{replaceStrings:[{search:/worldPos/g,replace:i.associatedVariableName}]}),e._emitUniformFromString("vClipPlane","vec4"),e._emitUniformFromString("vClipPlane2","vec4"),e._emitUniformFromString("vClipPlane3","vec4"),e._emitUniformFromString("vClipPlane4","vec4"),e._emitUniformFromString("vClipPlane5","vec4"),void e._emitUniformFromString("vClipPlane6","vec4")}return e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e._emitFunctionFromInclude("clipPlaneFragmentDeclaration",t),e.compilationString+=e._emitCodeFromInclude("clipPlaneFragment",t),this}}(0,h.H)("BABYLON.ClipPlanesBlock",I)},44264:(e,t,i)=>{i.d(t,{W:()=>g});var r=i(72433),s=i(89592),n=i(70848),a=i(97163),o=i(48620),l=i(62976),h=i(69958),u=(i(76350),i(44394)),c=i(73803),d=i(15210),m=i(12352);class g extends s.k{get texture(){return this._texture}set texture(e){var t;if(this._texture===e)return;const i=null!==(t=null==e?void 0:e.getScene())&&void 0!==t?t:d.l.LastCreatedScene;!e&&i&&i.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this._texture))),this._texture=e,e&&i&&i.markAllMaterialsAsDirty(1,(t=>t.hasTexture(e)))}static _OnGenerateOnlyFragmentCodeChanged(e,t){return e._onGenerateOnlyFragmentCodeChanged()}_onGenerateOnlyFragmentCodeChanged(){return this._setTarget(),!0}_setTarget(){this._setInitialTarget(this.generateOnlyFragmentCode?n.u.Fragment:n.u.VertexAndFragment)}constructor(e){super(e,n.u.VertexAndFragment),this.generateOnlyFragmentCode=!1}getClassName(){return"ReflectionTextureBaseBlock"}_getTexture(){return this.texture}autoConfigure(e){if(!this.position.isConnected){let t=e.getInputBlockByPredicate((e=>e.isAttribute&&"position"===e.name));t||(t=new l.S("position"),t.setAsAttribute()),t.output.connectTo(this.position)}if(!this.world.isConnected){let t=e.getInputBlockByPredicate((e=>e.systemValue===h.$.World));t||(t=new l.S("world"),t.setAsSystemValue(h.$.World)),t.output.connectTo(this.world)}if(this.view&&!this.view.isConnected){let t=e.getInputBlockByPredicate((e=>e.systemValue===h.$.View));t||(t=new l.S("view"),t.setAsSystemValue(h.$.View)),t.output.connectTo(this.view)}}prepareDefines(e,t,i){if(!i._areTexturesDirty)return;const r=this._getTexture();r&&r.getTextureMatrix&&(i.setValue(this._define3DName,r.isCube,!0),i.setValue(this._defineLocalCubicName,!!r.boundingBoxSize,!0),i.setValue(this._defineExplicitName,0===r.coordinatesMode,!0),i.setValue(this._defineSkyboxName,5===r.coordinatesMode,!0),i.setValue(this._defineCubicName,3===r.coordinatesMode||6===r.coordinatesMode,!0),i.setValue("INVERTCUBICMAP",6===r.coordinatesMode,!0),i.setValue(this._defineSphericalName,1===r.coordinatesMode,!0),i.setValue(this._definePlanarName,2===r.coordinatesMode,!0),i.setValue(this._defineProjectionName,4===r.coordinatesMode,!0),i.setValue(this._defineEquirectangularName,7===r.coordinatesMode,!0),i.setValue(this._defineEquirectangularFixedName,8===r.coordinatesMode,!0),i.setValue(this._defineMirroredEquirectangularFixedName,9===r.coordinatesMode,!0))}isReady(){const e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())}bind(e,t,i){const r=this._getTexture();if(i&&r&&(e.setMatrix(this._reflectionMatrixName,r.getReflectionTextureMatrix()),r.isCube?e.setTexture(this._cubeSamplerName,r):e.setTexture(this._2DSamplerName,r),r.boundingBoxSize)){const t=r;e.setVector3(this._reflectionPositionName,t.boundingBoxPosition),e.setVector3(this._reflectionSizeName,t.boundingBoxSize)}}handleVertexSide(e){if(this.generateOnlyFragmentCode&&e.target===n.u.Vertex)return"";this._define3DName=e._getFreeDefineName("REFLECTIONMAP_3D"),this._defineCubicName=e._getFreeDefineName("REFLECTIONMAP_CUBIC"),this._defineSphericalName=e._getFreeDefineName("REFLECTIONMAP_SPHERICAL"),this._definePlanarName=e._getFreeDefineName("REFLECTIONMAP_PLANAR"),this._defineProjectionName=e._getFreeDefineName("REFLECTIONMAP_PROJECTION"),this._defineExplicitName=e._getFreeDefineName("REFLECTIONMAP_EXPLICIT"),this._defineEquirectangularName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR"),this._defineLocalCubicName=e._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC"),this._defineMirroredEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"),this._defineEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"),this._defineSkyboxName=e._getFreeDefineName("REFLECTIONMAP_SKYBOX"),this._defineOppositeZ=e._getFreeDefineName("REFLECTIONMAP_OPPOSITEZ"),this._reflectionMatrixName=e._getFreeVariableName("reflectionMatrix"),e._emitUniformFromString(this._reflectionMatrixName,"mat4");let t="";this._worldPositionNameInFragmentOnlyMode=e._getFreeVariableName("worldPosition");const i=this.generateOnlyFragmentCode?this._worldPositionNameInFragmentOnlyMode:"v_"+this.worldPosition.associatedVariableName;return(this.generateOnlyFragmentCode||e._emitVaryingFromString(i,"vec4"))&&(t+=`${this.generateOnlyFragmentCode?"vec4 ":""}${i} = ${this.worldPosition.associatedVariableName};\r\n`),this._positionUVWName=e._getFreeVariableName("positionUVW"),this._directionWName=e._getFreeVariableName("directionW"),(this.generateOnlyFragmentCode||e._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName))&&(t+=`#ifdef ${this._defineSkyboxName}\r\n`,t+=`${this.generateOnlyFragmentCode?"vec3 ":""}${this._positionUVWName} = ${this.position.associatedVariableName}.xyz;\r\n`,t+="#endif\r\n"),(this.generateOnlyFragmentCode||e._emitVaryingFromString(this._directionWName,"vec3",`defined(${this._defineEquirectangularFixedName}) || defined(${this._defineMirroredEquirectangularFixedName})`))&&(t+=`#if defined(${this._defineEquirectangularFixedName}) || defined(${this._defineMirroredEquirectangularFixedName})\r\n`,t+=`${this.generateOnlyFragmentCode?"vec3 ":""}${this._directionWName} = normalize(vec3(${this.world.associatedVariableName} * vec4(${this.position.associatedVariableName}.xyz, 0.0)));\r\n`,t+="#endif\r\n"),t}handleFragmentSideInits(e){e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),e._samplerDeclaration+=`#ifdef ${this._define3DName}\r\n`,e._samplerDeclaration+=`uniform samplerCube ${this._cubeSamplerName};\r\n`,e._samplerDeclaration+="#else\r\n",e._samplerDeclaration+=`uniform sampler2D ${this._2DSamplerName};\r\n`,e._samplerDeclaration+="#endif\r\n",e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);const t=`//${this.name}`;e._emitFunction("ReciprocalPI","#define RECIPROCAL_PI2 0.15915494",""),e._emitFunctionFromInclude("helperFunctions",t),e._emitFunctionFromInclude("reflectionFunction",t,{replaceStrings:[{search:/vec3 computeReflectionCoords/g,replace:"void DUMMYFUNC"}]}),this._reflectionColorName=e._getFreeVariableName("reflectionColor"),this._reflectionVectorName=e._getFreeVariableName("reflectionUVW"),this._reflectionCoordsName=e._getFreeVariableName("reflectionCoords"),this._reflectionPositionName=e._getFreeVariableName("vReflectionPosition"),e._emitUniformFromString(this._reflectionPositionName,"vec3"),this._reflectionSizeName=e._getFreeVariableName("vReflectionPosition"),e._emitUniformFromString(this._reflectionSizeName,"vec3")}handleFragmentSideCodeReflectionCoords(e,t,i=!1,r=!1){t||(t=this.generateOnlyFragmentCode?this._worldPositionNameInFragmentOnlyMode:`v_${this.worldPosition.associatedVariableName}`);const s=this._reflectionMatrixName,n=`normalize(${this._directionWName})`,a=`${this._positionUVWName}`,o=`${this.cameraPosition.associatedVariableName}`,l=`${this.view.associatedVariableName}`;e+=".xyz";let h=`\n            #ifdef ${this._defineMirroredEquirectangularFixedName}\n                vec3 ${this._reflectionVectorName} = computeMirroredFixedEquirectangularCoords(${t}, ${e}, ${n});\n            #endif\n\n            #ifdef ${this._defineEquirectangularFixedName}\n                vec3 ${this._reflectionVectorName} = computeFixedEquirectangularCoords(${t}, ${e}, ${n});\n            #endif\n\n            #ifdef ${this._defineEquirectangularName}\n                vec3 ${this._reflectionVectorName} = computeEquirectangularCoords(${t}, ${e}, ${o}.xyz, ${s});\n            #endif\n\n            #ifdef ${this._defineSphericalName}\n                vec3 ${this._reflectionVectorName} = computeSphericalCoords(${t}, ${e}, ${l}, ${s});\n            #endif\n\n            #ifdef ${this._definePlanarName}\n                vec3 ${this._reflectionVectorName} = computePlanarCoords(${t}, ${e}, ${o}.xyz, ${s});\n            #endif\n\n            #ifdef ${this._defineCubicName}\n                #ifdef ${this._defineLocalCubicName}\n                    vec3 ${this._reflectionVectorName} = computeCubicLocalCoords(${t}, ${e}, ${o}.xyz, ${s}, ${this._reflectionSizeName}, ${this._reflectionPositionName});\n                #else\n                vec3 ${this._reflectionVectorName} = computeCubicCoords(${t}, ${e}, ${o}.xyz, ${s});\n                #endif\n            #endif\n\n            #ifdef ${this._defineProjectionName}\n                vec3 ${this._reflectionVectorName} = computeProjectionCoords(${t}, ${l}, ${s});\n            #endif\n\n            #ifdef ${this._defineSkyboxName}\n                vec3 ${this._reflectionVectorName} = computeSkyBoxCoords(${a}, ${s});\n            #endif\n\n            #ifdef ${this._defineExplicitName}\n                vec3 ${this._reflectionVectorName} = vec3(0, 0, 0);\n            #endif\r\n`;return r||(h+=`#ifdef ${this._defineOppositeZ}\n                ${this._reflectionVectorName}.z *= -1.0;\n            #endif\r\n`),i||(h+=`\n                #ifdef ${this._define3DName}\n                    vec3 ${this._reflectionCoordsName} = ${this._reflectionVectorName};\n                #else\n                    vec2 ${this._reflectionCoordsName} = ${this._reflectionVectorName}.xy;\n                    #ifdef ${this._defineProjectionName}\n                        ${this._reflectionCoordsName} /= ${this._reflectionVectorName}.z;\n                    #endif\n                    ${this._reflectionCoordsName}.y = 1.0 - ${this._reflectionCoordsName}.y;\n                #endif\r\n`),h}handleFragmentSideCodeReflectionColor(e,t=".rgb"){let i=`${"vec"+(0===t.length?"4":t.length-1)} ${this._reflectionColorName};\n            #ifdef ${this._define3DName}\r\n`;return i+=e?`${this._reflectionColorName} = textureCubeLodEXT(${this._cubeSamplerName}, ${this._reflectionVectorName}, ${e})${t};\r\n`:`${this._reflectionColorName} = textureCube(${this._cubeSamplerName}, ${this._reflectionVectorName})${t};\r\n`,i+="\n            #else\r\n",i+=e?`${this._reflectionColorName} = texture2DLodEXT(${this._2DSamplerName}, ${this._reflectionCoordsName}, ${e})${t};\r\n`:`${this._reflectionColorName} = texture2D(${this._2DSamplerName}, ${this._reflectionCoordsName})${t};\r\n`,i+="#endif\r\n",i}writeOutputs(e,t){let i="";if(e.target===n.u.Fragment)for(const r of this._outputs)r.hasEndpoints&&(i+=`${this._declareOutput(r,e)} = ${t}.${r.name};\r\n`);return i}_buildBlock(e){return super._buildBlock(e),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();if(!this.texture)return e;if(this.texture.isCube){const t=this.texture.forcedExtension;e+=`${this._codeVariableName}.texture = new BABYLON.CubeTexture("${this.texture.name}", undefined, undefined, ${this.texture.noMipmap}, null, undefined, undefined, undefined, ${this.texture._prefiltered}, ${t?'"'+t+'"':"null"});\r\n`}else e+=`${this._codeVariableName}.texture = new BABYLON.Texture("${this.texture.name}", null);\r\n`;return e+=`${this._codeVariableName}.texture.coordinatesMode = ${this.texture.coordinatesMode};\r\n`,e}serialize(){const e=super.serialize();return this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e.generateOnlyFragmentCode=this.generateOnlyFragmentCode,e}_deserialize(e,t,i){super._deserialize(e,t,i),e.texture&&!a.O.IgnoreTexturesAtLoadTime&&(i=0===e.texture.url.indexOf("data:")?"":i,e.texture.isCube?this.texture=u.B.Parse(e.texture,t,i):this.texture=c.x.Parse(e.texture,t,i)),this.generateOnlyFragmentCode=e.generateOnlyFragmentCode,this._setTarget()}}(0,r.gn)([(0,m.p)("Generate only fragment code",m.U.Boolean,"ADVANCED",{notifiers:{rebuild:!0,update:!0,onValidation:g._OnGenerateOnlyFragmentCodeChanged}})],g.prototype,"generateOnlyFragmentCode",void 0),(0,o.H)("BABYLON.ReflectionTextureBaseBlock",g)},80498:(e,t,i)=>{i.d(t,{v:()=>c});var r=i(89592),s=i(89762),n=i(70848),a=i(96979),o=i(48620),l=i(93682),h=i(69958),u=i(62976);class c extends r.k{constructor(e){super(e,n.u.Fragment,!0),this.registerInput("normal",s.E.AutoDetect,!1),this.normal.addExcludedConnectionPointFromAllowedTypes(s.E.Color4|s.E.Vector4|s.E.Vector3),this.registerInput("tangent",s.E.Vector4,!1),this.registerInput("world",s.E.Matrix,!1),this.registerOutput("TBN",s.E.Object,n.u.Fragment,new l.C("TBN",this,a.Ab.Output,c,"TBNBlock")),this.registerOutput("row0",s.E.Vector3,n.u.Fragment),this.registerOutput("row1",s.E.Vector3,n.u.Fragment),this.registerOutput("row2",s.E.Vector3,n.u.Fragment)}getClassName(){return"TBNBlock"}initialize(e){e._excludeVariableName("tbnNormal"),e._excludeVariableName("tbnTangent"),e._excludeVariableName("tbnBitangent"),e._excludeVariableName("TBN")}get normal(){return this._inputs[0]}get tangent(){return this._inputs[1]}get world(){return this._inputs[2]}get TBN(){return this._outputs[0]}get row0(){return this._outputs[1]}get row1(){return this._outputs[2]}get row2(){return this._outputs[3]}get target(){return n.u.Fragment}set target(e){}autoConfigure(e){if(!this.world.isConnected){let t=e.getInputBlockByPredicate((e=>e.isSystemValue&&e.systemValue===h.$.World));t||(t=new u.S("world"),t.setAsSystemValue(h.$.World)),t.output.connectTo(this.world)}if(!this.normal.isConnected){let t=e.getInputBlockByPredicate((e=>e.isAttribute&&"normal"===e.name));t||(t=new u.S("normal"),t.setAsAttribute("normal")),t.output.connectTo(this.normal)}if(!this.tangent.isConnected){let t=e.getInputBlockByPredicate((e=>e.isAttribute&&"tangent"===e.name&&e.type===s.E.Vector4));t||(t=new u.S("tangent"),t.setAsAttribute("tangent")),t.output.connectTo(this.tangent)}}prepareDefines(e,t,i){var r,s,n,a;const o=this.normal,l=this.tangent;let h=o.isConnected;(null===(r=o.connectInputBlock)||void 0===r?void 0:r.isAttribute)&&!e.isVerticesDataPresent(null===(s=o.connectInputBlock)||void 0===s?void 0:s.name)&&(h=!1);let u=l.isConnected;(null===(n=l.connectInputBlock)||void 0===n?void 0:n.isAttribute)&&!e.isVerticesDataPresent(null===(a=l.connectInputBlock)||void 0===a?void 0:a.name)&&(u=!1);const c=h&&u;i.setValue("TBNBLOCK",c,!0)}_buildBlock(e){super._buildBlock(e);const t=this.normal,i=this.tangent,r=this.world,s=this.TBN,a=this.row0,o=this.row1,l=this.row2;return e.target===n.u.Fragment&&(e.compilationString+=`\n                // ${this.name}\n                vec3 tbnNormal = normalize(${t.associatedVariableName}).xyz;\n                vec3 tbnTangent = normalize(${i.associatedVariableName}.xyz);\n                vec3 tbnBitangent = cross(tbnNormal, tbnTangent) * ${i.associatedVariableName}.w;\n                mat3 ${s.associatedVariableName} = mat3(${r.associatedVariableName}) * mat3(tbnTangent, tbnBitangent, tbnNormal);\n            `,a.hasEndpoints&&(e.compilationString+=this._declareOutput(a,e)+` = vec3(${s.associatedVariableName}[0][0], ${s.associatedVariableName}[0][1], ${s.associatedVariableName}[0][2]);\r\n`),o.hasEndpoints&&(e.compilationString+=this._declareOutput(o,e)+` = vec3(${s.associatedVariableName}[1[0], ${s.associatedVariableName}[1][1], ${s.associatedVariableName}[1][2]);\r\n`),l.hasEndpoints&&(e.compilationString+=this._declareOutput(l,e)+` = vec3(${s.associatedVariableName}[2][0], ${s.associatedVariableName}[2][1], ${s.associatedVariableName}[2][2]);\r\n`),e.sharedData.blocksWithDefines.push(this)),this}}(0,o.H)("BABYLON.TBNBlock",c)},62374:(e,t,i)=>{i.d(t,{g:()=>u});var r=i(72433),s=i(89592),n=i(89762),a=i(70848),o=i(48620),l=i(12352),h=i(90360);class u extends s.k{constructor(e){super(e,a.u.Fragment,!0),this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this.useLogarithmicDepth=!1,this.registerInput("rgba",n.E.Color4,!0),this.registerInput("rgb",n.E.AutoDetect,!0),this.registerInput("a",n.E.Float,!0),this.rgb.addExcludedConnectionPointFromAllowedTypes(n.E.Color3|n.E.Vector3|n.E.Float)}getClassName(){return"FragmentOutputBlock"}initialize(e){e._excludeVariableName("logarithmicDepthConstant"),e._excludeVariableName("vFragmentDepth")}get rgba(){return this._inputs[0]}get rgb(){return this._inputs[1]}get a(){return this._inputs[2]}prepareDefines(e,t,i){i.setValue(this._linearDefineName,this.convertToLinearSpace,!0),i.setValue(this._gammaDefineName,this.convertToGammaSpace,!0)}bind(e,t,i){this.useLogarithmicDepth&&i&&h.G.BindLogDepth(void 0,e,i.getScene())}_buildBlock(e){super._buildBlock(e);const t=this.rgba,i=this.rgb,r=this.a;e.sharedData.hints.needAlphaBlending=t.isConnected||r.isConnected,e.sharedData.blocksWithDefines.push(this),this.useLogarithmicDepth&&(e._emitUniformFromString("logarithmicDepthConstant","float"),e._emitVaryingFromString("vFragmentDepth","float"),e.sharedData.bindableBlocks.push(this)),this._linearDefineName=e._getFreeDefineName("CONVERTTOLINEAR"),this._gammaDefineName=e._getFreeDefineName("CONVERTTOGAMMA");const s=`//${this.name}`;if(e._emitFunctionFromInclude("helperFunctions",s),t.connectedPoint)r.isConnected?e.compilationString+=`gl_FragColor = vec4(${t.associatedVariableName}.rgb, ${r.associatedVariableName});\r\n`:e.compilationString+=`gl_FragColor = ${t.associatedVariableName};\r\n`;else if(i.connectedPoint){let t="1.0";r.connectedPoint&&(t=r.associatedVariableName),i.connectedPoint.type===n.E.Float?e.compilationString+=`gl_FragColor = vec4(${i.associatedVariableName}, ${i.associatedVariableName}, ${i.associatedVariableName}, ${t});\r\n`:e.compilationString+=`gl_FragColor = vec4(${i.associatedVariableName}, ${t});\r\n`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(t);return e.compilationString+=`#ifdef ${this._linearDefineName}\r\n`,e.compilationString+="gl_FragColor = toLinearSpace(gl_FragColor);\r\n",e.compilationString+="#endif\r\n",e.compilationString+=`#ifdef ${this._gammaDefineName}\r\n`,e.compilationString+="gl_FragColor = toGammaSpace(gl_FragColor);\r\n",e.compilationString+="#endif\r\n",this.useLogarithmicDepth&&(e.compilationString+="gl_FragDepthEXT = log2(vFragmentDepth) * logarithmicDepthConstant * 0.5;\r\n"),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.convertToGammaSpace = ${this.convertToGammaSpace};\r\n`,e+=`${this._codeVariableName}.convertToLinearSpace = ${this.convertToLinearSpace};\r\n`,e+=`${this._codeVariableName}.useLogarithmicDepth = ${this.useLogarithmicDepth};\r\n`,e}serialize(){const e=super.serialize();return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.useLogarithmicDepth=this.useLogarithmicDepth,e}_deserialize(e,t,i){var r;super._deserialize(e,t,i),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=e.convertToLinearSpace,this.useLogarithmicDepth=null!==(r=e.useLogarithmicDepth)&&void 0!==r&&r}}(0,r.gn)([(0,l.p)("Convert to gamma space",l.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],u.prototype,"convertToGammaSpace",void 0),(0,r.gn)([(0,l.p)("Convert to linear space",l.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],u.prototype,"convertToLinearSpace",void 0),(0,r.gn)([(0,l.p)("Use logarithmic depth",l.U.Boolean,"PROPERTIES")],u.prototype,"useLogarithmicDepth",void 0),(0,o.H)("BABYLON.FragmentOutputBlock",u)},90479:(e,t,i)=>{i(62374);var r=i(72433),s=i(89592),n=i(89762),a=i(70848),o=i(48620),l=i(12352);i(54081),i(69464),i(47157);class h extends s.k{constructor(e){super(e,a.u.Fragment),this.convertInputToLinearSpace=!0,this.registerInput("color",n.E.AutoDetect),this.registerOutput("output",n.E.Color4),this.registerOutput("rgb",n.E.Color3),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(n.E.Color3|n.E.Color4|n.E.Vector3|n.E.Vector4)}getClassName(){return"ImageProcessingBlock"}get color(){return this._inputs[0]}get output(){return this._outputs[0]}get rgb(){return this._outputs[1]}initialize(e){e._excludeVariableName("exposureLinear"),e._excludeVariableName("contrast"),e._excludeVariableName("vInverseScreenSize"),e._excludeVariableName("vignetteSettings1"),e._excludeVariableName("vignetteSettings2"),e._excludeVariableName("vCameraColorCurveNegative"),e._excludeVariableName("vCameraColorCurveNeutral"),e._excludeVariableName("vCameraColorCurvePositive"),e._excludeVariableName("txColorTransform"),e._excludeVariableName("colorTransformSettings"),e._excludeVariableName("ditherIntensity")}isReady(e,t,i){return!(i._areImageProcessingDirty&&t.imageProcessingConfiguration&&!t.imageProcessingConfiguration.isReady())}prepareDefines(e,t,i){i._areImageProcessingDirty&&t.imageProcessingConfiguration&&t.imageProcessingConfiguration.prepareDefines(i)}bind(e,t,i){i&&t.imageProcessingConfiguration&&t.imageProcessingConfiguration.bind(e)}_buildBlock(e){var t;super._buildBlock(e),e.sharedData.blocksWithDefines.push(this),e.sharedData.blockingBlocks.push(this),e.sharedData.bindableBlocks.push(this),e.uniforms.push("exposureLinear"),e.uniforms.push("contrast"),e.uniforms.push("vInverseScreenSize"),e.uniforms.push("vignetteSettings1"),e.uniforms.push("vignetteSettings2"),e.uniforms.push("vCameraColorCurveNegative"),e.uniforms.push("vCameraColorCurveNeutral"),e.uniforms.push("vCameraColorCurvePositive"),e.uniforms.push("txColorTransform"),e.uniforms.push("colorTransformSettings"),e.uniforms.push("ditherIntensity");const i=this.color,r=this._outputs[0],s=`//${this.name}`;return e._emitFunctionFromInclude("helperFunctions",s),e._emitFunctionFromInclude("imageProcessingDeclaration",s),e._emitFunctionFromInclude("imageProcessingFunctions",s),(null===(t=i.connectedPoint)||void 0===t?void 0:t.isConnected)&&(i.connectedPoint.type===n.E.Color4||i.connectedPoint.type===n.E.Vector4?e.compilationString+=`${this._declareOutput(r,e)} = ${i.associatedVariableName};\r\n`:e.compilationString+=`${this._declareOutput(r,e)} = vec4(${i.associatedVariableName}, 1.0);\r\n`,e.compilationString+="#ifdef IMAGEPROCESSINGPOSTPROCESS\r\n",this.convertInputToLinearSpace&&(e.compilationString+=`${r.associatedVariableName}.rgb = toLinearSpace(${i.associatedVariableName}.rgb);\r\n`),e.compilationString+="#else\r\n",e.compilationString+="#ifdef IMAGEPROCESSING\r\n",this.convertInputToLinearSpace&&(e.compilationString+=`${r.associatedVariableName}.rgb = toLinearSpace(${i.associatedVariableName}.rgb);\r\n`),e.compilationString+=`${r.associatedVariableName} = applyImageProcessing(${r.associatedVariableName});\r\n`,e.compilationString+="#endif\r\n",e.compilationString+="#endif\r\n",this.rgb.hasEndpoints&&(e.compilationString+=this._declareOutput(this.rgb,e)+` = ${this.output.associatedVariableName}.xyz;\r\n`)),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.convertInputToLinearSpace = ${this.convertInputToLinearSpace};\r\n`,e}serialize(){const e=super.serialize();return e.convertInputToLinearSpace=this.convertInputToLinearSpace,e}_deserialize(e,t,i){var r;super._deserialize(e,t,i),this.convertInputToLinearSpace=null===(r=e.convertInputToLinearSpace)||void 0===r||r}}(0,r.gn)([(0,l.p)("Convert input to linear space",l.U.Boolean,"ADVANCED")],h.prototype,"convertInputToLinearSpace",void 0),(0,o.H)("BABYLON.ImageProcessingBlock",h);var u=i(96979),c=i(62976),d=i(93682),m=i(80498);i(82953),i(44345),i(16161);class g extends s.k{constructor(e){super(e,a.u.Fragment),this._tangentSpaceParameterName="",this._tangentCorrectionFactorName="",this._worldMatrixName="",this.invertX=!1,this.invertY=!1,this.useParallaxOcclusion=!1,this.useObjectSpaceNormalMap=!1,this._isUnique=!0,this.registerInput("worldPosition",n.E.Vector4,!1),this.registerInput("worldNormal",n.E.Vector4,!1),this.registerInput("worldTangent",n.E.Vector4,!0),this.registerInput("uv",n.E.Vector2,!1),this.registerInput("normalMapColor",n.E.Color3,!1),this.registerInput("strength",n.E.Float,!1),this.registerInput("viewDirection",n.E.Vector3,!0),this.registerInput("parallaxScale",n.E.Float,!0),this.registerInput("parallaxHeight",n.E.Float,!0),this.registerInput("TBN",n.E.Object,!0,a.u.VertexAndFragment,new d.C("TBN",this,u.Ab.Input,m.v,"TBNBlock")),this.registerInput("world",n.E.Matrix,!0),this.registerOutput("output",n.E.Vector4),this.registerOutput("uvOffset",n.E.Vector2)}getClassName(){return"PerturbNormalBlock"}get worldPosition(){return this._inputs[0]}get worldNormal(){return this._inputs[1]}get worldTangent(){return this._inputs[2]}get uv(){return this._inputs[3]}get normalMapColor(){return this._inputs[4]}get strength(){return this._inputs[5]}get viewDirection(){return this._inputs[6]}get parallaxScale(){return this._inputs[7]}get parallaxHeight(){return this._inputs[8]}get TBN(){return this._inputs[9]}get world(){return this._inputs[10]}get output(){return this._outputs[0]}get uvOffset(){return this._outputs[1]}prepareDefines(e,t,i){const r=this.normalMapColor.connectedPoint._ownerBlock.samplerName,s=this.viewDirection.isConnected&&(this.useParallaxOcclusion&&r||!this.useParallaxOcclusion&&this.parallaxHeight.isConnected);i.setValue("BUMP",!0),i.setValue("PARALLAX",s,!0),i.setValue("PARALLAXOCCLUSION",this.useParallaxOcclusion,!0),i.setValue("OBJECTSPACE_NORMALMAP",this.useObjectSpaceNormalMap,!0)}bind(e,t,i){t.getScene()._mirroredCameraPosition?e.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):e.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1),i&&(e.setFloat(this._tangentCorrectionFactorName,i.getWorldMatrix().determinant()<0?-1:1),this.useObjectSpaceNormalMap&&!this.world.isConnected&&e.setMatrix(this._worldMatrixName,i.getWorldMatrix()))}autoConfigure(e){if(!this.uv.isConnected){let t=e.getInputBlockByPredicate((e=>e.isAttribute&&"uv"===e.name));t||(t=new c.S("uv"),t.setAsAttribute()),t.output.connectTo(this.uv)}if(!this.strength.isConnected){const e=new c.S("strength");e.value=1,e.output.connectTo(this.strength)}}_buildBlock(e){super._buildBlock(e);const t=`//${this.name}`,i=this.uv,r=this.worldPosition,s=this.worldNormal,n=this.worldTangent;e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._tangentSpaceParameterName=e._getFreeDefineName("tangentSpaceParameter"),e._emitUniformFromString(this._tangentSpaceParameterName,"vec2"),this._tangentCorrectionFactorName=e._getFreeDefineName("tangentCorrectionFactor"),e._emitUniformFromString(this._tangentCorrectionFactorName,"float"),this._worldMatrixName=e._getFreeDefineName("perturbNormalWorldMatrix"),e._emitUniformFromString(this._worldMatrixName,"mat4");let a=null;this.normalMapColor.connectedPoint&&(a=this.normalMapColor.connectedPoint._ownerBlock.samplerName);const o=this.viewDirection.isConnected&&(this.useParallaxOcclusion&&a||!this.useParallaxOcclusion&&this.parallaxHeight.isConnected),l=this.parallaxScale.isConnectedToInputBlock?this.parallaxScale.connectInputBlock.isConstant?e._emitFloat(this.parallaxScale.connectInputBlock.value):this.parallaxScale.associatedVariableName:"0.05",h=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?`\r\n#if !defined(NORMALXYSCALE)\r\n1.0/\r\n#endif\r\n${e._emitFloat(this.strength.connectInputBlock.value)}`:`\r\n#if !defined(NORMALXYSCALE)\r\n1.0/\r\n#endif\r\n${this.strength.associatedVariableName}`;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");const u={search:/defined\(TANGENT\)/g,replace:n.isConnected?"defined(TANGENT)":"defined(IGNORE)"},c=this.TBN;c.isConnected?e.compilationString+=`\n            #ifdef TBNBLOCK\n            mat3 vTBN = ${c.associatedVariableName};\n            #endif\n            `:n.isConnected&&(e.compilationString+=`vec3 tbnNormal = normalize(${s.associatedVariableName}.xyz);\r\n`,e.compilationString+=`vec3 tbnTangent = normalize(${n.associatedVariableName}.xyz);\r\n`,e.compilationString+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent) * ${this._tangentCorrectionFactorName};\r\n`,e.compilationString+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n"),e._emitFunctionFromInclude("bumpFragmentMainFunctions",t,{replaceStrings:[u,{search:/varying mat3 vTBN/g,replace:""},{search:/uniform mat4 normalMatrix;/g,replace:""}]}),e._emitFunctionFromInclude("bumpFragmentFunctions",t,{replaceStrings:[{search:/#include<samplerFragmentDeclaration>\(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump\)/g,replace:""},{search:/uniform sampler2D bumpSampler;/g,replace:""},{search:/vec2 parallaxOcclusion\(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale\)/g,replace:"#define inline\r\nvec2 parallaxOcclusion(vec3 vViewDirCoT, vec3 vNormalCoT, vec2 texCoord, float parallaxScale, sampler2D bumpSampler)"},{search:/vec2 parallaxOffset\(vec3 viewDir,float heightScale\)/g,replace:"vec2 parallaxOffset(vec3 viewDir, float heightScale, float height_)"},{search:/texture2D\(bumpSampler,vBumpUV\)\.w/g,replace:"height_"}]});const d=o&&a?`texture2D(${a}, ${i.associatedVariableName} + uvOffset).xyz`:this.normalMapColor.associatedVariableName;return e.compilationString+=this._declareOutput(this.output,e)+" = vec4(0.);\r\n",e.compilationString+=e._emitCodeFromInclude("bumpFragment",t,{replaceStrings:[{search:/texture2D\(bumpSampler,vBumpUV\)/g,replace:`${d}`},{search:/#define CUSTOM_FRAGMENT_BUMP_FRAGMENT/g,replace:`mat4 normalMatrix = toNormalMatrix(${this.world.isConnected?this.world.associatedVariableName:this._worldMatrixName});`},{search:/perturbNormal\(TBN,texture2D\(bumpSampler,vBumpUV\+uvOffset\).xyz,vBumpInfos.y\)/g,replace:`perturbNormal(TBN, ${d}, vBumpInfos.y)`},{search:/parallaxOcclusion\(invTBN\*-viewDirectionW,invTBN\*normalW,vBumpUV,vBumpInfos.z\)/g,replace:`parallaxOcclusion((invTBN * -viewDirectionW), (invTBN * normalW), vBumpUV, vBumpInfos.z, ${o&&this.useParallaxOcclusion?a:"bumpSampler"})`},{search:/parallaxOffset\(invTBN\*viewDirectionW,vBumpInfos\.z\)/g,replace:`parallaxOffset(invTBN * viewDirectionW, vBumpInfos.z, ${o?this.parallaxHeight.associatedVariableName:"0."})`},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vBumpInfos.y/g,replace:h},{search:/vBumpInfos.z/g,replace:l},{search:/vBumpUV/g,replace:i.associatedVariableName},{search:/vPositionW/g,replace:r.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+".xyz = "},{search:/mat3\(normalMatrix\)\*normalW/g,replace:"mat3(normalMatrix) * "+this.output.associatedVariableName+".xyz"},{search:/normalW/g,replace:s.associatedVariableName+".xyz"},{search:/viewDirectionW/g,replace:o?this.viewDirection.associatedVariableName:"vec3(0.)"},u]}),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode()+`${this._codeVariableName}.invertX = ${this.invertX};\r\n`;return e+=`${this._codeVariableName}.invertY = ${this.invertY};\r\n`,e+=`${this._codeVariableName}.useParallaxOcclusion = ${this.useParallaxOcclusion};\r\n`,e+=`${this._codeVariableName}.useObjectSpaceNormalMap = ${this.useObjectSpaceNormalMap};\r\n`,e}serialize(){const e=super.serialize();return e.invertX=this.invertX,e.invertY=this.invertY,e.useParallaxOcclusion=this.useParallaxOcclusion,e.useObjectSpaceNormalMap=this.useObjectSpaceNormalMap,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.invertX=e.invertX,this.invertY=e.invertY,this.useParallaxOcclusion=!!e.useParallaxOcclusion,this.useObjectSpaceNormalMap=!!e.useObjectSpaceNormalMap}}(0,r.gn)([(0,l.p)("Invert X axis",l.U.Boolean,"PROPERTIES",{notifiers:{update:!1}})],g.prototype,"invertX",void 0),(0,r.gn)([(0,l.p)("Invert Y axis",l.U.Boolean,"PROPERTIES",{notifiers:{update:!1}})],g.prototype,"invertY",void 0),(0,r.gn)([(0,l.p)("Use parallax occlusion",l.U.Boolean)],g.prototype,"useParallaxOcclusion",void 0),(0,r.gn)([(0,l.p)("Object Space Mode",l.U.Boolean,"PROPERTIES",{notifiers:{update:!1}})],g.prototype,"useObjectSpaceNormalMap",void 0),(0,o.H)("BABYLON.PerturbNormalBlock",g);class p extends s.k{constructor(e){super(e,a.u.Fragment,!0),this.registerInput("value",n.E.Float,!0),this.registerInput("cutoff",n.E.Float,!0)}getClassName(){return"DiscardBlock"}get value(){return this._inputs[0]}get cutoff(){return this._inputs[1]}_buildBlock(e){if(super._buildBlock(e),e.sharedData.hints.needAlphaTesting=!0,this.cutoff.isConnected&&this.value.isConnected)return e.compilationString+=`if (${this.value.associatedVariableName} < ${this.cutoff.associatedVariableName}) discard;\r\n`,this}}(0,o.H)("BABYLON.DiscardBlock",p);class _ extends s.k{constructor(e){super(e,a.u.Fragment),this.registerOutput("output",n.E.Float,a.u.Fragment)}getClassName(){return"FrontFacingBlock"}get output(){return this._outputs[0]}_buildBlock(e){if(super._buildBlock(e),e.target===a.u.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";const t=this._outputs[0];return e.compilationString+=this._declareOutput(t,e)+" = gl_FrontFacing ? 1.0 : 0.0;\r\n",this}}(0,o.H)("BABYLON.FrontFacingBlock",_);class f extends s.k{constructor(e){super(e,a.u.Fragment),this.registerInput("input",n.E.AutoDetect,!1),this.registerOutput("dx",n.E.BasedOnInput),this.registerOutput("dy",n.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[1]._typeConnectionSource=this._inputs[0]}getClassName(){return"DerivativeBlock"}get input(){return this._inputs[0]}get dx(){return this._outputs[0]}get dy(){return this._outputs[1]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0],i=this._outputs[1];return e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),t.hasEndpoints&&(e.compilationString+=this._declareOutput(t,e)+` = dFdx(${this.input.associatedVariableName});\r\n`),i.hasEndpoints&&(e.compilationString+=this._declareOutput(i,e)+` = dFdy(${this.input.associatedVariableName});\r\n`),this}}(0,o.H)("BABYLON.DerivativeBlock",f);class S extends s.k{constructor(e){super(e,a.u.Fragment),this.registerOutput("xy",n.E.Vector2,a.u.Fragment),this.registerOutput("xyz",n.E.Vector3,a.u.Fragment),this.registerOutput("xyzw",n.E.Vector4,a.u.Fragment),this.registerOutput("x",n.E.Float,a.u.Fragment),this.registerOutput("y",n.E.Float,a.u.Fragment),this.registerOutput("z",n.E.Float,a.u.Fragment),this.registerOutput("w",n.E.Float,a.u.Fragment)}getClassName(){return"FragCoordBlock"}get xy(){return this._outputs[0]}get xyz(){return this._outputs[1]}get xyzw(){return this._outputs[2]}get x(){return this._outputs[3]}get y(){return this._outputs[4]}get z(){return this._outputs[5]}get output(){return this._outputs[6]}writeOutputs(e){let t="";for(const i of this._outputs)i.hasEndpoints&&(t+=`${this._declareOutput(i,e)} = gl_FragCoord.${i.name};\r\n`);return t}_buildBlock(e){if(super._buildBlock(e),e.target===a.u.Vertex)throw"FragCoordBlock must only be used in a fragment shader";return e.compilationString+=this.writeOutputs(e),this}}(0,o.H)("BABYLON.FragCoordBlock",S);class x extends s.k{constructor(e){super(e,a.u.Fragment),this.registerOutput("xy",n.E.Vector2,a.u.Fragment),this.registerOutput("x",n.E.Float,a.u.Fragment),this.registerOutput("y",n.E.Float,a.u.Fragment)}getClassName(){return"ScreenSizeBlock"}get xy(){return this._outputs[0]}get x(){return this._outputs[1]}get y(){return this._outputs[2]}bind(e){const t=this._scene.getEngine();e.setFloat2(this._varName,t.getRenderWidth(),t.getRenderHeight())}writeOutputs(e,t){let i="";for(const r of this._outputs)r.hasEndpoints&&(i+=`${this._declareOutput(r,e)} = ${t}.${r.name};\r\n`);return i}_buildBlock(e){if(super._buildBlock(e),this._scene=e.sharedData.scene,e.target===a.u.Vertex)throw"ScreenSizeBlock must only be used in a fragment shader";return e.sharedData.bindableBlocks.push(this),this._varName=e._getFreeVariableName("screenSize"),e._emitUniformFromString(this._varName,"vec2"),e.compilationString+=this.writeOutputs(e,this._varName),this}}(0,o.H)("BABYLON.ScreenSizeBlock",x);var C=i(69958);class N extends s.k{constructor(e){super(e,a.u.Fragment),this.registerInput("vector",n.E.AutoDetect),this.registerInput("worldViewProjection",n.E.Matrix),this.registerOutput("output",n.E.Vector2),this.registerOutput("x",n.E.Float),this.registerOutput("y",n.E.Float),this.inputs[0].addExcludedConnectionPointFromAllowedTypes(n.E.Color3|n.E.Vector3|n.E.Vector4)}getClassName(){return"ScreenSpaceBlock"}get vector(){return this._inputs[0]}get worldViewProjection(){return this._inputs[1]}get output(){return this._outputs[0]}get x(){return this._outputs[1]}get y(){return this._outputs[2]}autoConfigure(e){if(!this.worldViewProjection.isConnected){let t=e.getInputBlockByPredicate((e=>e.systemValue===C.$.WorldViewProjection));t||(t=new c.S("worldViewProjection"),t.setAsSystemValue(C.$.WorldViewProjection)),t.output.connectTo(this.worldViewProjection)}}_buildBlock(e){super._buildBlock(e);const t=this.vector,i=this.worldViewProjection;if(!t.connectedPoint)return;const r=i.associatedVariableName,s=e._getFreeVariableName("screenSpaceTemp");switch(t.connectedPoint.type){case n.E.Vector3:e.compilationString+=`vec4 ${s} = ${r} * vec4(${t.associatedVariableName}, 1.0);\r\n`;break;case n.E.Vector4:e.compilationString+=`vec4 ${s} = ${r} * ${t.associatedVariableName};\r\n`}return e.compilationString+=`${s}.xy /= ${s}.w;`,e.compilationString+=`${s}.xy = ${s}.xy * 0.5 + vec2(0.5, 0.5);`,this.output.hasEndpoints&&(e.compilationString+=this._declareOutput(this.output,e)+` = ${s}.xy;\r\n`),this.x.hasEndpoints&&(e.compilationString+=this._declareOutput(this.x,e)+` = ${s}.x;\r\n`),this.y.hasEndpoints&&(e.compilationString+=this._declareOutput(this.y,e)+` = ${s}.y;\r\n`),this}}(0,o.H)("BABYLON.ScreenSpaceBlock",N);var T=i(58095);class M extends s.k{constructor(e){super(e,a.u.Fragment),this.registerInput("input",n.E.Vector2),this.registerInput("strength",n.E.Float),this.registerInput("center",n.E.Vector2),this.registerInput("offset",n.E.Vector2),this.registerOutput("output",n.E.Vector2),this.registerOutput("x",n.E.Float),this.registerOutput("y",n.E.Float)}getClassName(){return"TwirlBlock"}get input(){return this._inputs[0]}get strength(){return this._inputs[1]}get center(){return this._inputs[2]}get offset(){return this._inputs[3]}get output(){return this._outputs[0]}get x(){return this._outputs[1]}get y(){return this._outputs[2]}autoConfigure(){if(!this.center.isConnected){const e=new c.S("center");e.value=new T.FM(.5,.5),e.output.connectTo(this.center)}if(!this.strength.isConnected){const e=new c.S("strength");e.value=1,e.output.connectTo(this.strength)}if(!this.offset.isConnected){const e=new c.S("offset");e.value=new T.FM(0,0),e.output.connectTo(this.offset)}}_buildBlock(e){super._buildBlock(e);const t=e._getFreeVariableName("delta"),i=e._getFreeVariableName("angle"),r=e._getFreeVariableName("x"),s=e._getFreeVariableName("y"),n=e._getFreeVariableName("result");return e.compilationString+=`\n            vec2 ${t} = ${this.input.associatedVariableName} - ${this.center.associatedVariableName};\n            float ${i} = ${this.strength.associatedVariableName} * length(${t});\n            float ${r} = cos(${i}) * ${t}.x - sin(${i}) * ${t}.y;\n            float ${s} = sin(${i}) * ${t}.x + cos(${i}) * ${t}.y;\n            vec2 ${n} = vec2(${r} + ${this.center.associatedVariableName}.x + ${this.offset.associatedVariableName}.x, ${s} + ${this.center.associatedVariableName}.y + ${this.offset.associatedVariableName}.y);\n        `,this.output.hasEndpoints&&(e.compilationString+=this._declareOutput(this.output,e)+` = ${n};\r\n`),this.x.hasEndpoints&&(e.compilationString+=this._declareOutput(this.x,e)+` = ${n}.x;\r\n`),this.y.hasEndpoints&&(e.compilationString+=this._declareOutput(this.y,e)+` = ${n}.y;\r\n`),this}}(0,o.H)("BABYLON.TwirlBlock",M);class E extends s.k{constructor(e){super(e,a.u.Fragment),this.generateInWorldSpace=!1,this.automaticNormalizationNormal=!0,this.automaticNormalizationTangent=!0,this.registerInput("input",n.E.Float),this.registerInput("worldPosition",n.E.Vector3),this.registerInput("worldNormal",n.E.Vector3),this.registerInput("worldTangent",n.E.AutoDetect,!0),this.registerOutput("output",n.E.Vector4),this.registerOutput("xyz",n.E.Vector3),this._inputs[3].addExcludedConnectionPointFromAllowedTypes(n.E.Color3|n.E.Vector3|n.E.Vector4)}getClassName(){return"HeightToNormalBlock"}get input(){return this._inputs[0]}get worldPosition(){return this._inputs[1]}get worldNormal(){return this._inputs[2]}get worldTangent(){return this._inputs[3]}get output(){return this._outputs[0]}get xyz(){return this._outputs[1]}_buildBlock(e){super._buildBlock(e);const t=this._outputs[0];this.generateInWorldSpace||this.worldTangent.isConnected||console.error(`You must connect the 'worldTangent' input of the ${this.name} block!`);const i=this.generateInWorldSpace?"":"\n            vec3 biTangent = cross(normal, tangent);\n            mat3 TBN = mat3(tangent, biTangent, normal);\n            ",r=this.generateInWorldSpace?"":"\n            result = TBN * result;\n            result = result * vec3(0.5) + vec3(0.5);\n            ",s=`\n            vec4 heightToNormal(in float height, in vec3 position, in vec3 tangent, in vec3 normal) {\n                ${i}\n                ${this.automaticNormalizationTangent?"tangent = normalize(tangent);":""}\n                ${this.automaticNormalizationNormal?"normal = normalize(normal);":""}\n                vec3 worlddX = dFdx(position);\n                vec3 worlddY = dFdy(position);\n                vec3 crossX = cross(normal, worlddX);\n                vec3 crossY = cross(normal, worlddY);\n                float d = abs(dot(crossY, worlddX));\n                vec3 inToNormal = vec3(((((height + dFdx(height)) - height) * crossY) + (((height + dFdy(height)) - height) * crossX)) * sign(d));\n                inToNormal.y *= -1.0;\n                vec3 result = normalize((d * normal) - inToNormal);\n                ${r}\n                return vec4(result, 0.);\n            }`;return e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),e._emitFunction("heightToNormal",s,"// heightToNormal"),e.compilationString+=this._declareOutput(t,e)+` = heightToNormal(${this.input.associatedVariableName}, ${this.worldPosition.associatedVariableName}, ${this.worldTangent.isConnected?this.worldTangent.associatedVariableName:"vec3(0.)"}.xyz, ${this.worldNormal.associatedVariableName});\r\n`,this.xyz.hasEndpoints&&(e.compilationString+=this._declareOutput(this.xyz,e)+` = ${this.output.associatedVariableName}.xyz;\r\n`),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.generateInWorldSpace = ${this.generateInWorldSpace};\r\n`,e+=`${this._codeVariableName}.automaticNormalizationNormal = ${this.automaticNormalizationNormal};\r\n`,e+=`${this._codeVariableName}.automaticNormalizationTangent = ${this.automaticNormalizationTangent};\r\n`,e}serialize(){const e=super.serialize();return e.generateInWorldSpace=this.generateInWorldSpace,e.automaticNormalizationNormal=this.automaticNormalizationNormal,e.automaticNormalizationTangent=this.automaticNormalizationTangent,e}_deserialize(e,t,i){super._deserialize(e,t,i),this.generateInWorldSpace=e.generateInWorldSpace,this.automaticNormalizationNormal=e.automaticNormalizationNormal,this.automaticNormalizationTangent=e.automaticNormalizationTangent}}(0,r.gn)([(0,l.p)("Generate in world space instead of tangent space",l.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],E.prototype,"generateInWorldSpace",void 0),(0,r.gn)([(0,l.p)("Force normalization for the worldNormal input",l.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],E.prototype,"automaticNormalizationNormal",void 0),(0,r.gn)([(0,l.p)("Force normalization for the worldTangent input",l.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],E.prototype,"automaticNormalizationTangent",void 0),(0,o.H)("BABYLON.HeightToNormalBlock",E);class v extends s.k{constructor(e){super(e,a.u.Fragment,!0),this.registerInput("depth",n.E.Float,!0),this.registerInput("worldPos",n.E.Vector4,!0),this.registerInput("viewProjection",n.E.Matrix,!0)}getClassName(){return"FragDepthBlock"}get depth(){return this._inputs[0]}get worldPos(){return this._inputs[1]}get viewProjection(){return this._inputs[2]}_buildBlock(e){return super._buildBlock(e),this.depth.isConnected?e.compilationString+=`gl_FragDepth = ${this.depth.associatedVariableName};\r\n`:this.worldPos.isConnected&&this.viewProjection.isConnected?e.compilationString+=`\n                vec4 p = ${this.viewProjection.associatedVariableName} * ${this.worldPos.associatedVariableName};\n                float v = p.z / p.w;\n                #ifndef IS_NDC_HALF_ZRANGE\n                    v = v * 0.5 + 0.5;\n                #endif\n                gl_FragDepth = v;\n    \n            `:console.warn("FragDepthBlock: either the depth input or both the worldPos and viewProjection inputs must be connected!"),this}}(0,o.H)("BABYLON.FragDepthBlock",v);class I extends s.k{constructor(e){super(e,a.u.Fragment),this.registerInput("worldPosition",n.E.Vector4,!1),this.registerInput("viewProjection",n.E.Matrix,!1),this.registerInput("worldNormal",n.E.AutoDetect,!0),this.registerOutput("depth",n.E.Vector3),this.worldNormal.addExcludedConnectionPointFromAllowedTypes(n.E.Color3|n.E.Vector3|n.E.Vector4)}getClassName(){return"ShadowMapBlock"}initialize(e){e._excludeVariableName("vPositionWSM"),e._excludeVariableName("lightDataSM"),e._excludeVariableName("biasAndScaleSM"),e._excludeVariableName("depthValuesSM"),e._excludeVariableName("clipPos"),e._excludeVariableName("worldPos"),e._excludeVariableName("zSM")}get worldPosition(){return this._inputs[0]}get viewProjection(){return this._inputs[1]}get worldNormal(){return this._inputs[2]}get depth(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);const t=`//${this.name}`;return e._emitUniformFromString("biasAndScaleSM","vec3"),e._emitUniformFromString("lightDataSM","vec3"),e._emitUniformFromString("depthValuesSM","vec2"),e._emitFunctionFromInclude("packingFunctions",t),e.compilationString+=`vec4 worldPos = ${this.worldPosition.associatedVariableName};\r\n`,e.compilationString+="vec3 vPositionWSM;\r\n",e.compilationString+="float vDepthMetricSM = 0.0;\r\n",e.compilationString+="float zSM;\r\n",this.worldNormal.isConnected&&(e.compilationString+=`vec3 vNormalW = ${this.worldNormal.associatedVariableName}.xyz;\r\n`,e.compilationString+=e._emitCodeFromInclude("shadowMapVertexNormalBias",t)),e.compilationString+=`vec4 clipPos = ${this.viewProjection.associatedVariableName} * worldPos;\r\n`,e.compilationString+=e._emitCodeFromInclude("shadowMapVertexMetric",t,{replaceStrings:[{search:/gl_Position/g,replace:"clipPos"}]}),e.compilationString+=e._emitCodeFromInclude("shadowMapFragment",t,{replaceStrings:[{search:/return;/g,replace:""}]}),e.compilationString+="\n            #if SM_DEPTHTEXTURE == 1\n                #ifdef IS_NDC_HALF_ZRANGE\n                    gl_FragDepth = (clipPos.z / clipPos.w);\n                #else\n                    gl_FragDepth = (clipPos.z / clipPos.w) * 0.5 + 0.5;\n                #endif\n            #endif\n        ",e.compilationString+=`${this._declareOutput(this.depth,e)} = vec3(depthSM, 1., 1.);\r\n`,this}}(0,o.H)("BABYLON.ShadowMapBlock",I)},92194:(e,t,i)=>{var r;i.d(t,{c:()=>r}),function(e){e[e.None=0]="None",e[e.Time=1]="Time",e[e.RealTime=2]="RealTime"}(r||(r={}))},32247:(e,t,i)=>{i(62976),i(92194)},62976:(e,t,i)=>{i.d(t,{S:()=>f});var r=i(89592),s=i(89762),n=i(88215),a=i(69958),o=i(58095),l=i(70848),h=i(48620),u=i(34389),c=i(92194),d=i(62897),m=i(29945);const g={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},p={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},_={particle_texturemask:!0};class f extends r.k{get type(){if(this._type===s.E.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=s.E.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=s.E.Vector2,this._type;case"Vector3":return this._type=s.E.Vector3,this._type;case"Vector4":return this._type=s.E.Vector4,this._type;case"Color3":return this._type=s.E.Color3,this._type;case"Color4":return this._type=s.E.Color4,this._type;case"Matrix":return this._type=s.E.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"particle_positionw":return this._type=s.E.Vector3,this._type;case"uv":case"uv2":case"uv3":case"uv4":case"uv5":case"uv6":case"position2d":case"particle_uv":return this._type=s.E.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"world0":case"world1":case"world2":case"world3":case"tangent":return this._type=s.E.Vector4,this._type;case"color":case"instanceColor":case"particle_color":case"particle_texturemask":return this._type=s.E.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case a.$.World:case a.$.WorldView:case a.$.WorldViewProjection:case a.$.View:case a.$.ViewProjection:case a.$.Projection:return this._type=s.E.Matrix,this._type;case a.$.CameraPosition:return this._type=s.E.Vector3,this._type;case a.$.FogColor:return this._type=s.E.Color3,this._type;case a.$.DeltaTime:case a.$.MaterialAlpha:return this._type=s.E.Float,this._type;case a.$.CameraParameters:return this._type=s.E.Vector4,this._type}}return this._type}constructor(e,t=l.u.Vertex,i=s.E.AutoDetect){super(e,t,!1,!0),this._mode=n.M.Undefined,this._animationType=c.c.None,this.min=0,this.max=0,this.isBoolean=!1,this.matrixMode=0,this._systemValue=null,this.isConstant=!1,this.groupInInspector="",this.onValueChangedObservable=new d.y$,this.convertToGammaSpace=!1,this.convertToLinearSpace=!1,this._type=i,this.setDefaultValue(),this.registerOutput("output",i)}validateBlockName(e){return!!this.isAttribute||super.validateBlockName(e)}get output(){return this._outputs[0]}setAsAttribute(e){return this._mode=n.M.Attribute,e&&(this.name=e),this}setAsSystemValue(e){return this.systemValue=e,this}get value(){return this._storedValue}set value(e){this.type===s.E.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=n.M.Uniform,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(e){this._valueCallback=e,this._mode=n.M.Uniform}get associatedVariableName(){return this._associatedVariableName}set associatedVariableName(e){this._associatedVariableName=e}get animationType(){return this._animationType}set animationType(e){this._animationType=e}get isUndefined(){return this._mode===n.M.Undefined}get isUniform(){return this._mode===n.M.Uniform}set isUniform(e){this._mode=e?n.M.Uniform:n.M.Undefined,this.associatedVariableName=""}get isAttribute(){return this._mode===n.M.Attribute}set isAttribute(e){this._mode=e?n.M.Attribute:n.M.Undefined,this.associatedVariableName=""}get isVarying(){return this._mode===n.M.Varying}set isVarying(e){this._mode=e?n.M.Varying:n.M.Undefined,this.associatedVariableName=""}get isSystemValue(){return null!=this._systemValue}get systemValue(){return this._systemValue}set systemValue(e){this._mode=n.M.Uniform,this.associatedVariableName="",this._systemValue=e}getClassName(){return"InputBlock"}animate(e){switch(this._animationType){case c.c.Time:this.type===s.E.Float&&(this.value+=.01*e.getAnimationRatio());break;case c.c.RealTime:this.type===s.E.Float&&(this.value=(m.F.Now-e.getEngine().startTime)/1e3)}}_emitDefine(e){return"!"===e[0]?`#ifndef ${e.substring(1)}\r\n`:`#ifdef ${e}\r\n`}initialize(){this.associatedVariableName=""}setDefaultValue(){switch(this.type){case s.E.Float:this.value=0;break;case s.E.Vector2:this.value=o.FM.Zero();break;case s.E.Vector3:this.value=o.P.Zero();break;case s.E.Vector4:this.value=o.Lt.Zero();break;case s.E.Color3:this.value=u.Wo.White();break;case s.E.Color4:this.value=new u.HE(1,1,1,1);break;case s.E.Matrix:this.value=o.y3.Identity()}}_emitConstant(e){switch(this.type){case s.E.Float:return`${e._emitFloat(this.value)}`;case s.E.Vector2:return`vec2(${this.value.x}, ${this.value.y})`;case s.E.Vector3:return`vec3(${this.value.x}, ${this.value.y}, ${this.value.z})`;case s.E.Vector4:return`vec4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;case s.E.Color3:return u.zZ.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&u.zZ.Color3[0].toGammaSpaceToRef(u.zZ.Color3[0]),this.convertToLinearSpace&&u.zZ.Color3[0].toLinearSpaceToRef(u.zZ.Color3[0]),`vec3(${u.zZ.Color3[0].r}, ${u.zZ.Color3[0].g}, ${u.zZ.Color3[0].b})`;case s.E.Color4:return u.zZ.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&u.zZ.Color4[0].toGammaSpaceToRef(u.zZ.Color4[0]),this.convertToLinearSpace&&u.zZ.Color4[0].toLinearSpaceToRef(u.zZ.Color4[0]),`vec4(${u.zZ.Color4[0].r}, ${u.zZ.Color4[0].g}, ${u.zZ.Color4[0].b}, ${u.zZ.Color4[0].a})`}return""}get _noContextSwitch(){return p[this.name]}_emit(e,t){var i;if(this.isUniform){if(this.associatedVariableName||(this.associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant){if(-1!==e.constants.indexOf(this.associatedVariableName))return;return e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=this._declareOutput(this.output,e)+` = ${this._emitConstant(e)};\r\n`)}if(-1!==e.uniforms.indexOf(this.associatedVariableName))return;e.uniforms.push(this.associatedVariableName),t&&(e._uniformDeclaration+=this._emitDefine(t)),e._uniformDeclaration+=`uniform ${e._getGLType(this.type)} ${this.associatedVariableName};\r\n`,t&&(e._uniformDeclaration+="#endif\r\n");const i=e.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case a.$.WorldView:i.needWorldViewMatrix=!0;break;case a.$.WorldViewProjection:i.needWorldViewProjectionMatrix=!0}else this._animationType!==c.c.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=null!==(i=g[this.name])&&void 0!==i?i:this.name,this.target===l.u.Vertex&&e._vertexState)return void(p[this.name]?_[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),t):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),t):this._emit(e._vertexState,t));if(-1!==e.attributes.indexOf(this.associatedVariableName))return;e.attributes.push(this.associatedVariableName),p[this.name]?_[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),t):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),t):(t&&(e._attributeDeclaration+=this._emitDefine(t)),e._attributeDeclaration+=`attribute ${e._getGLType(this.type)} ${this.associatedVariableName};\r\n`,t&&(e._attributeDeclaration+="#endif\r\n"))}}_transmitWorld(e,t,i,r){if(!this._systemValue)return;const s=this.associatedVariableName;switch(this._systemValue){case a.$.World:e.setMatrix(s,t);break;case a.$.WorldView:e.setMatrix(s,i);break;case a.$.WorldViewProjection:e.setMatrix(s,r)}}_transmit(e,t,i){if(this.isAttribute)return;const r=this.associatedVariableName;if(this._systemValue){switch(this._systemValue){case a.$.World:case a.$.WorldView:case a.$.WorldViewProjection:return;case a.$.View:e.setMatrix(r,t.getViewMatrix());break;case a.$.Projection:e.setMatrix(r,t.getProjectionMatrix());break;case a.$.ViewProjection:e.setMatrix(r,t.getTransformMatrix());break;case a.$.CameraPosition:t.bindEyePosition(e,r,!0);break;case a.$.FogColor:e.setColor3(r,t.fogColor);break;case a.$.DeltaTime:e.setFloat(r,t.deltaTime/1e3);break;case a.$.CameraParameters:t.activeCamera&&e.setFloat4(r,t.getEngine().hasOriginBottomLeft?-1:1,t.activeCamera.minZ,t.activeCamera.maxZ,1/t.activeCamera.maxZ);break;case a.$.MaterialAlpha:e.setFloat(r,i.alpha)}return}const n=this._valueCallback?this._valueCallback():this._storedValue;if(null!==n)switch(this.type){case s.E.Float:e.setFloat(r,n);break;case s.E.Int:e.setInt(r,n);break;case s.E.Color3:u.zZ.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&u.zZ.Color3[0].toGammaSpaceToRef(u.zZ.Color3[0]),this.convertToLinearSpace&&u.zZ.Color3[0].toLinearSpaceToRef(u.zZ.Color3[0]),e.setColor3(r,u.zZ.Color3[0]);break;case s.E.Color4:u.zZ.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&u.zZ.Color4[0].toGammaSpaceToRef(u.zZ.Color4[0]),this.convertToLinearSpace&&u.zZ.Color4[0].toLinearSpaceToRef(u.zZ.Color4[0]),e.setDirectColor4(r,u.zZ.Color4[0]);break;case s.E.Vector2:e.setVector2(r,n);break;case s.E.Vector3:e.setVector3(r,n);break;case s.E.Vector4:e.setVector4(r,n);break;case s.E.Matrix:e.setMatrix(r,n)}}_buildBlock(e){super._buildBlock(e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)}_dumpPropertiesCode(){const e=this._codeVariableName;if(this.isAttribute)return super._dumpPropertiesCode()+`${e}.setAsAttribute("${this.name}");\r\n`;if(this.isSystemValue)return super._dumpPropertiesCode()+`${e}.setAsSystemValue(BABYLON.NodeMaterialSystemValues.${a.$[this._systemValue]});\r\n`;if(this.isUniform){const t=[];let i="";switch(this.type){case s.E.Float:i=`${this.value}`;break;case s.E.Vector2:i=`new BABYLON.Vector2(${this.value.x}, ${this.value.y})`;break;case s.E.Vector3:i=`new BABYLON.Vector3(${this.value.x}, ${this.value.y}, ${this.value.z})`;break;case s.E.Vector4:i=`new BABYLON.Vector4(${this.value.x}, ${this.value.y}, ${this.value.z}, ${this.value.w})`;break;case s.E.Color3:i=`new BABYLON.Color3(${this.value.r}, ${this.value.g}, ${this.value.b})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case s.E.Color4:i=`new BABYLON.Color4(${this.value.r}, ${this.value.g}, ${this.value.b}, ${this.value.a})`,this.convertToGammaSpace&&(i+=".toGammaSpace()"),this.convertToLinearSpace&&(i+=".toLinearSpace()");break;case s.E.Matrix:i=`BABYLON.Matrix.FromArray([${this.value.m}])`}return t.push(`${e}.value = ${i}`),this.type===s.E.Float&&t.push(`${e}.min = ${this.min}`,`${e}.max = ${this.max}`,`${e}.isBoolean = ${this.isBoolean}`,`${e}.matrixMode = ${this.matrixMode}`,`${e}.animationType = BABYLON.AnimatedInputBlockTypes.${c.c[this.animationType]}`),t.push(`${e}.isConstant = ${this.isConstant}`),t.push(""),super._dumpPropertiesCode()+t.join(";\r\n")}return super._dumpPropertiesCode()}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const e=super.serialize();return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,null!=this._storedValue&&this._mode===n.M.Uniform&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e}_deserialize(e,t,i){if(this._mode=e.mode,super._deserialize(e,t,i),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,"tangent"===e.name&&e.mode===n.M.Attribute&&e.type===s.E.Vector3&&(this._type=s.E.Vector4),e.valueType)if("number"===e.valueType)this._storedValue=e.value;else{const t=(0,h.q)(e.valueType);t&&(this._storedValue=t.FromArray(e.value))}}}(0,h.H)("BABYLON.InputBlock",f)},23680:(e,t,i)=>{i.d(t,{p:()=>u});var r=i(89592),s=i(89762),n=i(96979),a=i(70848),o=i(48620),l=i(93682),h=i(80498);class u extends r.k{constructor(e){super(e,a.u.Fragment),this._tangentCorrectionFactorName="",this._isUnique=!0,this.registerInput("intensity",s.E.Float,!0,a.u.Fragment),this.registerInput("direction",s.E.Vector2,!0,a.u.Fragment),this.registerInput("uv",s.E.Vector2,!0),this.registerInput("worldTangent",s.E.Vector4,!0),this.registerInput("TBN",s.E.Object,!0,a.u.VertexAndFragment,new l.C("TBN",this,n.Ab.Input,h.v,"TBNBlock")),this.registerOutput("anisotropy",s.E.Object,a.u.Fragment,new l.C("anisotropy",this,n.Ab.Output,u,"AnisotropyBlock"))}initialize(e){e._excludeVariableName("anisotropicOut"),e._excludeVariableName("TBN")}getClassName(){return"AnisotropyBlock"}get intensity(){return this._inputs[0]}get direction(){return this._inputs[1]}get uv(){return this._inputs[2]}get worldTangent(){return this._inputs[3]}get TBN(){return this._inputs[4]}get anisotropy(){return this._outputs[0]}_generateTBNSpace(e){let t="";const i=`//${this.name}`,r=this.uv,s=this.worldPositionConnectionPoint,n=this.worldNormalConnectionPoint,a=this.worldTangent;r.isConnected||console.error("You must connect the 'uv' input of the Anisotropy block!"),e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");const o={search:/defined\(TANGENT\)/g,replace:a.isConnected?"defined(TANGENT)":"defined(IGNORE)"},l=this.TBN;return l.isConnected?e.compilationString+=`\n            #ifdef TBNBLOCK\n            mat3 vTBN = ${l.associatedVariableName};\n            #endif\n            `:a.isConnected&&(t+=`vec3 tbnNormal = normalize(${n.associatedVariableName}.xyz);\r\n`,t+=`vec3 tbnTangent = normalize(${a.associatedVariableName}.xyz);\r\n`,t+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent) * ${this._tangentCorrectionFactorName};\r\n`,t+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n"),t+=`\n            #if defined(${a.isConnected?"TANGENT":"IGNORE"}) && defined(NORMAL)\n                mat3 TBN = vTBN;\n            #else\n                mat3 TBN = cotangent_frame(${n.associatedVariableName+".xyz"}, ${"v_"+s.associatedVariableName+".xyz"}, ${r.isConnected?r.associatedVariableName:"vec2(0.)"}, vec2(1., 1.));\n            #endif\r\n`,e._emitFunctionFromInclude("bumpFragmentMainFunctions",i,{replaceStrings:[o]}),t}getCode(e,t=!1){let i="";t&&(i+=this._generateTBNSpace(e));const r=this.intensity.isConnected?this.intensity.associatedVariableName:"1.0";return i+=`anisotropicOutParams anisotropicOut;\n            anisotropicBlock(\n                vec3(${this.direction.isConnected?this.direction.associatedVariableName:"vec2(1., 0.)"}, ${r}),\n            #ifdef ANISOTROPIC_TEXTURE\n                vec3(0.),\n            #endif\n                TBN,\n                normalW,\n                viewDirectionW,\n                anisotropicOut\n            );\r\n`,i}prepareDefines(e,t,i){super.prepareDefines(e,t,i),i.setValue("ANISOTROPIC",!0),i.setValue("ANISOTROPIC_TEXTURE",!1,!0)}bind(e,t,i){super.bind(e,t,i),i&&e.setFloat(this._tangentCorrectionFactorName,i.getWorldMatrix().determinant()<0?-1:1)}_buildBlock(e){return e.target===a.u.Fragment&&(e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._tangentCorrectionFactorName=e._getFreeDefineName("tangentCorrectionFactor"),e._emitUniformFromString(this._tangentCorrectionFactorName,"float")),this}}(0,o.H)("BABYLON.AnisotropyBlock",u)},24278:(e,t,i)=>{i.d(t,{N:()=>g});var r=i(72433),s=i(89592),n=i(89762),a=i(96979),o=i(70848),l=i(48620),h=i(62976),u=i(93682),c=i(13283),d=i(12352),m=i(80498);class g extends s.k{constructor(e){super(e,o.u.Fragment),this._tangentCorrectionFactorName="",this.remapF0OnInterfaceChange=!0,this._isUnique=!0,this.registerInput("intensity",n.E.Float,!1,o.u.Fragment),this.registerInput("roughness",n.E.Float,!0,o.u.Fragment),this.registerInput("indexOfRefraction",n.E.Float,!0,o.u.Fragment),this.registerInput("normalMapColor",n.E.Color3,!0,o.u.Fragment),this.registerInput("uv",n.E.Vector2,!0,o.u.Fragment),this.registerInput("tintColor",n.E.Color3,!0,o.u.Fragment),this.registerInput("tintAtDistance",n.E.Float,!0,o.u.Fragment),this.registerInput("tintThickness",n.E.Float,!0,o.u.Fragment),this.registerInput("worldTangent",n.E.Vector4,!0),this.registerInput("worldNormal",n.E.AutoDetect,!0),this.worldNormal.addExcludedConnectionPointFromAllowedTypes(n.E.Color4|n.E.Vector4|n.E.Vector3),this.registerInput("TBN",n.E.Object,!0,o.u.VertexAndFragment,new u.C("TBN",this,a.Ab.Input,m.v,"TBNBlock")),this.registerOutput("clearcoat",n.E.Object,o.u.Fragment,new u.C("clearcoat",this,a.Ab.Output,g,"ClearCoatBlock"))}initialize(e){e._excludeVariableName("clearcoatOut"),e._excludeVariableName("vClearCoatParams"),e._excludeVariableName("vClearCoatTintParams"),e._excludeVariableName("vClearCoatRefractionParams"),e._excludeVariableName("vClearCoatTangentSpaceParams"),e._excludeVariableName("vGeometricNormaClearCoatW")}getClassName(){return"ClearCoatBlock"}get intensity(){return this._inputs[0]}get roughness(){return this._inputs[1]}get indexOfRefraction(){return this._inputs[2]}get normalMapColor(){return this._inputs[3]}get uv(){return this._inputs[4]}get tintColor(){return this._inputs[5]}get tintAtDistance(){return this._inputs[6]}get tintThickness(){return this._inputs[7]}get worldTangent(){return this._inputs[8]}get worldNormal(){return this._inputs[9]}get TBN(){return this._inputs[10]}get clearcoat(){return this._outputs[0]}autoConfigure(){if(!this.intensity.isConnected){const e=new h.S("ClearCoat intensity",o.u.Fragment,n.E.Float);e.value=1,e.output.connectTo(this.intensity)}}prepareDefines(e,t,i){super.prepareDefines(e,t,i),i.setValue("CLEARCOAT",!0),i.setValue("CLEARCOAT_TEXTURE",!1,!0),i.setValue("CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),i.setValue("CLEARCOAT_TINT",this.tintColor.isConnected||this.tintThickness.isConnected||this.tintAtDistance.isConnected,!0),i.setValue("CLEARCOAT_BUMP",this.normalMapColor.isConnected,!0),i.setValue("CLEARCOAT_DEFAULTIOR",!this.indexOfRefraction.isConnected||this.indexOfRefraction.connectInputBlock.value===c.Y._DefaultIndexOfRefraction,!0),i.setValue("CLEARCOAT_REMAP_F0",this.remapF0OnInterfaceChange,!0)}bind(e,t,i){var r,s;super.bind(e,t,i);const n=null!==(s=null===(r=this.indexOfRefraction.connectInputBlock)||void 0===r?void 0:r.value)&&void 0!==s?s:c.Y._DefaultIndexOfRefraction,a=1-n,o=1+n,l=Math.pow(-a/o,2),h=1/n;e.setFloat4("vClearCoatRefractionParams",l,h,a,o);const u=this.clearcoat.hasEndpoints?this.clearcoat.endpoints[0].ownerBlock:null,d=(null==u?void 0:u.perturbedNormal.isConnected)?u.perturbedNormal.connectedPoint.ownerBlock:null;this._scene._mirroredCameraPosition?e.setFloat2("vClearCoatTangentSpaceParams",(null==d?void 0:d.invertX)?1:-1,(null==d?void 0:d.invertY)?1:-1):e.setFloat2("vClearCoatTangentSpaceParams",(null==d?void 0:d.invertX)?-1:1,(null==d?void 0:d.invertY)?-1:1),i&&e.setFloat(this._tangentCorrectionFactorName,i.getWorldMatrix().determinant()<0?-1:1)}_generateTBNSpace(e,t,i){let r="";const s=`//${this.name}`,n=this.worldTangent;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");const a={search:/defined\(TANGENT\)/g,replace:n.isConnected?"defined(TANGENT)":"defined(IGNORE)"},o=this.TBN;return o.isConnected?e.compilationString+=`\n            #ifdef TBNBLOCK\n            mat3 vTBN = ${o.associatedVariableName};\n            #endif\n            `:n.isConnected&&(r+=`vec3 tbnNormal = normalize(${i}.xyz);\r\n`,r+=`vec3 tbnTangent = normalize(${n.associatedVariableName}.xyz);\r\n`,r+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent) * ${this._tangentCorrectionFactorName};\r\n`,r+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n"),e._emitFunctionFromInclude("bumpFragmentMainFunctions",s,{replaceStrings:[a]}),r}static GetCode(e,t,i,r,s,n,a){let o="";const l=(null==t?void 0:t.intensity.isConnected)?t.intensity.associatedVariableName:"1.",h=(null==t?void 0:t.roughness.isConnected)?t.roughness.associatedVariableName:"0.",u=(null==t?void 0:t.normalMapColor.isConnected)?t.normalMapColor.associatedVariableName:"vec3(0.)",c=(null==t?void 0:t.uv.isConnected)?t.uv.associatedVariableName:"vec2(0.)",d=(null==t?void 0:t.tintColor.isConnected)?t.tintColor.associatedVariableName:"vec3(1.)",m=(null==t?void 0:t.tintThickness.isConnected)?t.tintThickness.associatedVariableName:"1.",g=(null==t?void 0:t.tintAtDistance.isConnected)?t.tintAtDistance.associatedVariableName:"1.";if(t){e._emitUniformFromString("vClearCoatRefractionParams","vec4"),e._emitUniformFromString("vClearCoatTangentSpaceParams","vec2");const i=t.worldNormal;o+=`vec3 vGeometricNormaClearCoatW = ${i.isConnected?"normalize("+i.associatedVariableName+".xyz)":"geometricNormalW"};\r\n`}else o+="vec3 vGeometricNormaClearCoatW = geometricNormalW;\r\n";return s&&t&&(o+=t._generateTBNSpace(e,r,a),n=t.worldTangent.isConnected),o+=`clearcoatOutParams clearcoatOut;\n\n        #ifdef CLEARCOAT\n            vec2 vClearCoatParams = vec2(${l}, ${h});\n            vec4 vClearCoatTintParams = vec4(${d}, ${m});\n\n            clearcoatBlock(\n                ${r}.xyz,\n                vGeometricNormaClearCoatW,\n                viewDirectionW,\n                vClearCoatParams,\n                specularEnvironmentR0,\n            #ifdef CLEARCOAT_TEXTURE\n                vec2(0.),\n            #endif\n            #ifdef CLEARCOAT_TINT\n                vClearCoatTintParams,\n                ${g},\n                vClearCoatRefractionParams,\n                #ifdef CLEARCOAT_TINT_TEXTURE\n                    vec4(0.),\n                #endif\n            #endif\n            #ifdef CLEARCOAT_BUMP\n                vec2(0., 1.),\n                vec4(${u}, 0.),\n                ${c},\n                #if defined(${n?"TANGENT":"IGNORE"}) && defined(NORMAL)\n                    vTBN,\n                #else\n                    vClearCoatTangentSpaceParams,\n                #endif\n                #ifdef OBJECTSPACE_NORMALMAP\n                    normalMatrix,\n                #endif\n            #endif\n            #if defined(FORCENORMALFORWARD) && defined(NORMAL)\n                faceNormal,\n            #endif\n            #ifdef REFLECTION\n                ${null==i?void 0:i._vReflectionMicrosurfaceInfosName},\n                ${null==i?void 0:i._vReflectionInfosName},\n                ${null==i?void 0:i.reflectionColor},\n                vLightingIntensity,\n                #ifdef ${null==i?void 0:i._define3DName}\n                    ${null==i?void 0:i._cubeSamplerName},\n                #else\n                    ${null==i?void 0:i._2DSamplerName},\n                #endif\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef ${null==i?void 0:i._define3DName}\n                        ${null==i?void 0:i._cubeSamplerName},\n                        ${null==i?void 0:i._cubeSamplerName},\n                    #else\n                        ${null==i?void 0:i._2DSamplerName},\n                        ${null==i?void 0:i._2DSamplerName},\n                    #endif\n                #endif\n            #endif\n            #if defined(ENVIRONMENTBRDF) && !defined(${null==i?void 0:i._defineSkyboxName})\n                #ifdef RADIANCEOCCLUSION\n                    ambientMonochrome,\n                #endif\n            #endif\n            #if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n                (gl_FrontFacing ? 1. : -1.),\n            #endif\n                clearcoatOut\n            );\n        #else\n            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;\n        #endif\r\n`,o}_buildBlock(e){return this._scene=e.sharedData.scene,e.target===o.u.Fragment&&(e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._tangentCorrectionFactorName=e._getFreeDefineName("tangentCorrectionFactor"),e._emitUniformFromString(this._tangentCorrectionFactorName,"float")),this}_dumpPropertiesCode(){let e=super._dumpPropertiesCode();return e+=`${this._codeVariableName}.remapF0OnInterfaceChange = ${this.remapF0OnInterfaceChange};\r\n`,e}serialize(){const e=super.serialize();return e.remapF0OnInterfaceChange=this.remapF0OnInterfaceChange,e}_deserialize(e,t,i){var r;super._deserialize(e,t,i),this.remapF0OnInterfaceChange=null===(r=e.remapF0OnInterfaceChange)||void 0===r||r}}(0,r.gn)([(0,d.p)("Remap F0 on interface change",d.U.Boolean,"ADVANCED")],g.prototype,"remapF0OnInterfaceChange",void 0),(0,l.H)("BABYLON.ClearCoatBlock",g)},63881:(e,t,i)=>{i(84315),i(55159),i(23680),i(69890),i(24278),i(45073),i(76882)}}]);