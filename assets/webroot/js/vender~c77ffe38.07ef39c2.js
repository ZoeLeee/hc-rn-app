"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[274],{48017:(t,e,i)=>{i.d(e,{N:()=>a});var s=i(58095),o=i(48939),n=i(17834),r=i(43048);class a extends n.N{get _matrix(){return this._compose(),this._localMatrix}set _matrix(t){this._needToCompose=!1,t.updateFlag!==this._localMatrix.updateFlag&&(this._localMatrix.copyFrom(t),this._markAsDirtyAndDecompose())}constructor(t,e,i=null,o=null,n=null,r=null,a=null){super(t,e.getScene()),this.name=t,this.children=new Array,this.animations=new Array,this._index=null,this._absoluteTransform=new s.y3,this._invertedAbsoluteTransform=new s.y3,this._scalingDeterminant=1,this._worldTransform=new s.y3,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=e,this._localMatrix=o?o.clone():s.y3.Identity(),this._restPose=n||this._localMatrix.clone(),this._baseMatrix=r||this._localMatrix.clone(),this._index=a,e.bones.push(this),this.setParent(i,!1),(r||o)&&this._updateDifferenceMatrix()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(t){this.setParent(t)}setParent(t,e=!0){if(this.parent!==t){if(this.parent){const t=this.parent.children.indexOf(this);-1!==t&&this.parent.children.splice(t,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),e&&this._updateDifferenceMatrix(),this.markAsDirty()}}getLocalMatrix(){return this._compose(),this._localMatrix}getBaseMatrix(){return this._baseMatrix}getRestPose(){return this._restPose}setRestPose(t){this._restPose.copyFrom(t)}getBindPose(){return this._baseMatrix}setBindPose(t){this.updateMatrix(t)}getWorldMatrix(){return this._worldTransform}returnToRest(){var t;if(this._linkedTransformNode){const e=s.jp.Vector3[0],i=s.jp.Quaternion[0],o=s.jp.Vector3[1];this.getRestPose().decompose(e,i,o),this._linkedTransformNode.position.copyFrom(o),this._linkedTransformNode.rotationQuaternion=null!==(t=this._linkedTransformNode.rotationQuaternion)&&void 0!==t?t:s._f.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(i),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restPose}getInvertedAbsoluteTransform(){return this._invertedAbsoluteTransform}getAbsoluteTransform(){return this._absoluteTransform}linkTransformNode(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this._localPosition}set position(t){this._decompose(),this._localPosition.copyFrom(t),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(t){this.setRotation(t)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(t){this.setRotationQuaternion(t)}get scaling(){return this.getScale()}set scaling(t){this.setScale(t)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=s.P.Zero(),this._localRotation=s._f.Zero(),this._localPosition=s.P.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,s.y3.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)}updateMatrix(t,e=!0,i=!0){this._baseMatrix.copyFrom(t),e&&this._updateDifferenceMatrix(),i?this._matrix=t:this.markAsDirty()}_updateDifferenceMatrix(t,e=!0){if(t||(t=this._baseMatrix),this.parent?t.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(t),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),e)for(let t=0;t<this.children.length;t++)this.children[t]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}translate(t,e=r.T.LOCAL,i){const o=this.getLocalMatrix();if(e==r.T.LOCAL)o.addAtIndex(12,t.x),o.addAtIndex(13,t.y),o.addAtIndex(14,t.z);else{let e=null;i&&(e=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();const n=a._TmpMats[0],r=a._TmpVecs[0];this.parent?i&&e?(n.copyFrom(this.parent.getAbsoluteTransform()),n.multiplyToRef(e,n)):n.copyFrom(this.parent.getAbsoluteTransform()):s.y3.IdentityToRef(n),n.setTranslationFromFloats(0,0,0),n.invert(),s.P.TransformCoordinatesToRef(t,n,r),o.addAtIndex(12,r.x),o.addAtIndex(13,r.y),o.addAtIndex(14,r.z)}this._markAsDirtyAndDecompose()}setPosition(t,e=r.T.LOCAL,i){const o=this.getLocalMatrix();if(e==r.T.LOCAL)o.setTranslationFromFloats(t.x,t.y,t.z);else{let e=null;i&&(e=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();const n=a._TmpMats[0],r=a._TmpVecs[0];this.parent?(i&&e?(n.copyFrom(this.parent.getAbsoluteTransform()),n.multiplyToRef(e,n)):n.copyFrom(this.parent.getAbsoluteTransform()),n.invert()):s.y3.IdentityToRef(n),s.P.TransformCoordinatesToRef(t,n,r),o.setTranslationFromFloats(r.x,r.y,r.z)}this._markAsDirtyAndDecompose()}setAbsolutePosition(t,e){this.setPosition(t,r.T.WORLD,e)}scale(t,e,i,o=!1){const n=this.getLocalMatrix(),r=a._TmpMats[0];s.y3.ScalingToRef(t,e,i,r),r.multiplyToRef(n,n),r.invert();for(const s of this.children){const o=s.getLocalMatrix();o.multiplyToRef(r,o),o.multiplyAtIndex(12,t),o.multiplyAtIndex(13,e),o.multiplyAtIndex(14,i),s._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),o)for(const s of this.children)s.scale(t,e,i,o)}setScale(t){this._decompose(),this._localScaling.copyFrom(t),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(t){this._decompose(),t.copyFrom(this._localScaling)}setYawPitchRoll(t,e,i,o=r.T.LOCAL,n){if(o===r.T.LOCAL){const r=a._TmpQuat;return s._f.RotationYawPitchRollToRef(t,e,i,r),void this.setRotationQuaternion(r,o,n)}const h=a._TmpMats[0];if(!this._getNegativeRotationToRef(h,n))return;const l=a._TmpMats[1];s.y3.RotationYawPitchRollToRef(t,e,i,l),h.multiplyToRef(l,l),this._rotateWithMatrix(l,o,n)}rotate(t,e,i=r.T.LOCAL,o){const n=a._TmpMats[0];n.setTranslationFromFloats(0,0,0),s.y3.RotationAxisToRef(t,e,n),this._rotateWithMatrix(n,i,o)}setAxisAngle(t,e,i=r.T.LOCAL,o){if(i===r.T.LOCAL){const n=a._TmpQuat;return s._f.RotationAxisToRef(t,e,n),void this.setRotationQuaternion(n,i,o)}const n=a._TmpMats[0];if(!this._getNegativeRotationToRef(n,o))return;const h=a._TmpMats[1];s.y3.RotationAxisToRef(t,e,h),n.multiplyToRef(h,h),this._rotateWithMatrix(h,i,o)}setRotation(t,e=r.T.LOCAL,i){this.setYawPitchRoll(t.y,t.x,t.z,e,i)}setRotationQuaternion(t,e=r.T.LOCAL,i){if(e===r.T.LOCAL)return this._decompose(),this._localRotation.copyFrom(t),void this._markAsDirtyAndCompose();const o=a._TmpMats[0];if(!this._getNegativeRotationToRef(o,i))return;const n=a._TmpMats[1];s.y3.FromQuaternionToRef(t,n),o.multiplyToRef(n,n),this._rotateWithMatrix(n,e,i)}setRotationMatrix(t,e=r.T.LOCAL,i){if(e===r.T.LOCAL){const o=a._TmpQuat;return s._f.FromRotationMatrixToRef(t,o),void this.setRotationQuaternion(o,e,i)}const o=a._TmpMats[0];if(!this._getNegativeRotationToRef(o,i))return;const n=a._TmpMats[1];n.copyFrom(t),o.multiplyToRef(t,n),this._rotateWithMatrix(n,e,i)}_rotateWithMatrix(t,e=r.T.LOCAL,i){const s=this.getLocalMatrix(),o=s.m[12],n=s.m[13],h=s.m[14],l=this.getParent(),c=a._TmpMats[3],d=a._TmpMats[4];l&&e==r.T.WORLD?(i?(c.copyFrom(i.getWorldMatrix()),l.getAbsoluteTransform().multiplyToRef(c,c)):c.copyFrom(l.getAbsoluteTransform()),d.copyFrom(c),d.invert(),s.multiplyToRef(c,s),s.multiplyToRef(t,s),s.multiplyToRef(d,s)):e==r.T.WORLD&&i?(c.copyFrom(i.getWorldMatrix()),d.copyFrom(c),d.invert(),s.multiplyToRef(c,s),s.multiplyToRef(t,s),s.multiplyToRef(d,s)):s.multiplyToRef(t,s),s.setTranslationFromFloats(o,n,h),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()}_getNegativeRotationToRef(t,e){const i=a._TmpMats[2];return t.copyFrom(this.getAbsoluteTransform()),e?(t.multiplyToRef(e.getWorldMatrix(),t),s.y3.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,i)):s.y3.IdentityToRef(i),t.invert(),!isNaN(t.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(i,t),!0)}getPosition(t=r.T.LOCAL,e=null){const i=s.P.Zero();return this.getPositionToRef(t,e,i),i}getPositionToRef(t=r.T.LOCAL,e,i){if(t==r.T.LOCAL){const t=this.getLocalMatrix();i.x=t.m[12],i.y=t.m[13],i.z=t.m[14]}else{let t=null;e&&(t=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();let s=a._TmpMats[0];e&&t?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(t,s)):s=this.getAbsoluteTransform(),i.x=s.m[12],i.y=s.m[13],i.z=s.m[14]}}getAbsolutePosition(t=null){const e=s.P.Zero();return this.getPositionToRef(r.T.WORLD,t,e),e}getAbsolutePositionToRef(t,e){this.getPositionToRef(r.T.WORLD,t,e)}computeAbsoluteTransforms(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);const t=this._skeleton.getPoseMatrix();t&&this._absoluteTransform.multiplyToRef(t,this._absoluteTransform)}const t=this.children,e=t.length;for(let i=0;i<e;i++)t[i].computeAbsoluteTransforms()}getDirection(t,e=null){const i=s.P.Zero();return this.getDirectionToRef(t,e,i),i}getDirectionToRef(t,e=null,i){let o=null;e&&(o=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();const n=a._TmpMats[0];n.copyFrom(this.getAbsoluteTransform()),e&&o&&n.multiplyToRef(o,n),s.P.TransformNormalToRef(t,n,i),i.normalize()}getRotation(t=r.T.LOCAL,e=null){const i=s.P.Zero();return this.getRotationToRef(t,e,i),i}getRotationToRef(t=r.T.LOCAL,e=null,i){const s=a._TmpQuat;this.getRotationQuaternionToRef(t,e,s),s.toEulerAnglesToRef(i)}getRotationQuaternion(t=r.T.LOCAL,e=null){const i=s._f.Identity();return this.getRotationQuaternionToRef(t,e,i),i}getRotationQuaternionToRef(t=r.T.LOCAL,e=null,i){if(t==r.T.LOCAL)this._decompose(),i.copyFrom(this._localRotation);else{const t=a._TmpMats[0],s=this.getAbsoluteTransform();e?s.multiplyToRef(e.getWorldMatrix(),t):t.copyFrom(s),t.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyAtIndex(1,this._scalingDeterminant),t.multiplyAtIndex(2,this._scalingDeterminant),t.decompose(void 0,i,void 0)}}getRotationMatrix(t=r.T.LOCAL,e){const i=s.y3.Identity();return this.getRotationMatrixToRef(t,e,i),i}getRotationMatrixToRef(t=r.T.LOCAL,e,i){if(t==r.T.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(i);else{const t=a._TmpMats[0],s=this.getAbsoluteTransform();e?s.multiplyToRef(e.getWorldMatrix(),t):t.copyFrom(s),t.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyAtIndex(1,this._scalingDeterminant),t.multiplyAtIndex(2,this._scalingDeterminant),t.getRotationMatrixToRef(i)}}getAbsolutePositionFromLocal(t,e=null){const i=s.P.Zero();return this.getAbsolutePositionFromLocalToRef(t,e,i),i}getAbsolutePositionFromLocalToRef(t,e=null,i){let o=null;e&&(o=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();let n=a._TmpMats[0];e&&o?(n.copyFrom(this.getAbsoluteTransform()),n.multiplyToRef(o,n)):n=this.getAbsoluteTransform(),s.P.TransformCoordinatesToRef(t,n,i)}getLocalPositionFromAbsolute(t,e=null){const i=s.P.Zero();return this.getLocalPositionFromAbsoluteToRef(t,e,i),i}getLocalPositionFromAbsoluteToRef(t,e=null,i){let o=null;e&&(o=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();const n=a._TmpMats[0];n.copyFrom(this.getAbsoluteTransform()),e&&o&&n.multiplyToRef(o,n),n.invert(),s.P.TransformCoordinatesToRef(t,n,i)}setCurrentPoseAsRest(){this.setRestPose(this.getLocalMatrix())}}a._TmpVecs=o.B.BuildArray(2,s.P.Zero),a._TmpQuat=s._f.Identity(),a._TmpMats=o.B.BuildArray(5,s.y3.Identity)},95358:(t,e,i)=>{i(48017);var s=i(58095),o=i(43048),n=i(84318);class r{get maxAngle(){return this._maxAngle}set maxAngle(t){this._setMaxAngle(t)}constructor(t,e,i){this.targetPosition=s.P.Zero(),this.poleTargetPosition=s.P.Zero(),this.poleTargetLocalOffset=s.P.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=s._f.Identity(),this._bone1Mat=s.y3.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=s.P.Right(),this._slerping=!1,this._adjustRoll=0,this._notEnoughInformation=!1,this._bone2=e;const r=e.getParent();if(!r)return this._notEnoughInformation=!0,void n.Y.Error("BoneIKController: bone must have a parent for IK to work.");if(this._bone1=r,0===this._bone2.children.length&&!this._bone2.length)return this._notEnoughInformation=!0,void n.Y.Error("BoneIKController: bone must not be a leaf or it should have a length for IK to work.");this.mesh=t;const a=e.getPosition();if(e.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,a.x>a.y&&a.x>a.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length&&this._bone2.length){const t=this._bone1.getScale(),e=this._bone2.getScale();this._bone1Length=this._bone1.length*t.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*e.y*this.mesh.scaling.y}else if(this._bone2.children[0]){t.computeWorldMatrix(!0);const e=this._bone2.children[0].getAbsolutePosition(t),i=this._bone2.getAbsolutePosition(t),o=this._bone1.getAbsolutePosition(t);this._bone2Length=s.P.Distance(e,i),this._bone1Length=s.P.Distance(i,o)}else{t.computeWorldMatrix(!0);const e=this._bone2.getScale();this._bone2Length=this._bone2.length*e.y*this.mesh.scaling.y;const i=this._bone2.getAbsolutePosition(t),o=this._bone1.getAbsolutePosition(t);this._bone1Length=s.P.Distance(i,o)}this._bone1.getRotationMatrixToRef(o.T.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,i&&(i.targetMesh&&(this.targetMesh=i.targetMesh,this.targetMesh.computeWorldMatrix(!0)),i.poleTargetMesh?(this.poleTargetMesh=i.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):i.poleTargetBone?this.poleTargetBone=i.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),i.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(i.poleTargetLocalOffset),i.poleAngle&&(this.poleAngle=i.poleAngle),i.bendAxis&&this._bendAxis.copyFrom(i.bendAxis),i.maxAngle&&(this.maxAngle=i.maxAngle),i.slerpAmount&&(this.slerpAmount=i.slerpAmount))}_setMaxAngle(t){t<0&&(t=0),(t>Math.PI||null==t)&&(t=Math.PI),this._maxAngle=t;const e=this._bone1Length,i=this._bone2Length;this._maxReach=Math.sqrt(e*e+i*i-2*e*i*Math.cos(t))}update(){if(this._notEnoughInformation)return;const t=this.targetPosition,e=this.poleTargetPosition,i=r._TmpMats[0],n=r._TmpMats[1];this.targetMesh&&t.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,e):this.poleTargetMesh&&s.P.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),e);const a=r._TmpVecs[0],h=r._TmpVecs[1],l=r._TmpVecs[2],c=r._TmpVecs[3],d=r._TmpVecs[4],_=r._TmpQuat;this._bone1.getAbsolutePositionToRef(this.mesh,a),e.subtractToRef(a,d),0==d.x&&0==d.y&&0==d.z?d.y=1:d.normalize(),t.subtractToRef(a,c),c.normalize(),s.P.CrossToRef(c,d,h),h.normalize(),s.P.CrossToRef(c,h,l),l.normalize(),s.y3.FromXYZAxesToRef(l,c,h,i);const u=this._bone1Length,p=this._bone2Length;let m=s.P.Distance(a,t);this._maxReach>0&&(m=Math.min(this._maxReach,m));let g=(p*p+m*m-u*u)/(2*p*m),f=(m*m+u*u-p*p)/(2*m*u);g>1&&(g=1),f>1&&(f=1),g<-1&&(g=-1),f<-1&&(f=-1);const y=Math.acos(g),C=Math.acos(f);let R=-y-C;if(this._rightHandedSystem)s.y3.RotationYawPitchRollToRef(0,0,this._adjustRoll,n),n.multiplyToRef(i,i),s.y3.RotationAxisToRef(this._bendAxis,C,n),n.multiplyToRef(i,i);else{const t=r._TmpVecs[5];t.copyFrom(this._bendAxis),t.x*=-1,s.y3.RotationAxisToRef(t,-C,n),n.multiplyToRef(i,i)}this.poleAngle&&(s.y3.RotationAxisToRef(c,this.poleAngle,n),i.multiplyToRef(n,i)),this._bone1&&(this.slerpAmount<1?(this._slerping||s._f.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),s._f.FromRotationMatrixToRef(i,_),s._f.SlerpToRef(this._bone1Quat,_,this.slerpAmount,this._bone1Quat),R=this._bone2Ang*(1-this.slerpAmount)+R*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,o.T.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(i,o.T.WORLD,this.mesh),this._bone1Mat.copyFrom(i),this._slerping=!1),this._updateLinkedTransformRotation(this._bone1)),this._bone2.setAxisAngle(this._bendAxis,R,o.T.LOCAL),this._updateLinkedTransformRotation(this._bone2),this._bone2Ang=R}_updateLinkedTransformRotation(t){t._linkedTransformNode&&(t._linkedTransformNode.rotationQuaternion||(t._linkedTransformNode.rotationQuaternion=new s._f),t.getRotationQuaternionToRef(o.T.LOCAL,null,t._linkedTransformNode.rotationQuaternion))}}r._TmpVecs=[s.P.Zero(),s.P.Zero(),s.P.Zero(),s.P.Zero(),s.P.Zero(),s.P.Zero()],r._TmpQuat=s._f.Identity(),r._TmpMats=[s.y3.Identity(),s.y3.Identity()];var a=i(48939);class h{get minYaw(){return this._minYaw}set minYaw(t){this._minYaw=t,this._minYawSin=Math.sin(t),this._minYawCos=Math.cos(t),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)}get maxYaw(){return this._maxYaw}set maxYaw(t){this._maxYaw=t,this._maxYawSin=Math.sin(t),this._maxYawCos=Math.cos(t),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch=t,this._minPitchTan=Math.tan(t)}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch=t,this._maxPitchTan=Math.tan(t)}constructor(t,e,i,n){if(this.upAxis=s.P.Up(),this.upAxisSpace=o.T.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=s._f.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=s.P.Forward(),this.mesh=t,this.bone=e,this.target=i,n&&(n.adjustYaw&&(this.adjustYaw=n.adjustYaw),n.adjustPitch&&(this.adjustPitch=n.adjustPitch),n.adjustRoll&&(this.adjustRoll=n.adjustRoll),null!=n.maxYaw?this.maxYaw=n.maxYaw:this.maxYaw=Math.PI,null!=n.minYaw?this.minYaw=n.minYaw:this.minYaw=-Math.PI,null!=n.maxPitch?this.maxPitch=n.maxPitch:this.maxPitch=Math.PI,null!=n.minPitch?this.minPitch=n.minPitch:this.minPitch=-Math.PI,null!=n.slerpAmount&&(this.slerpAmount=n.slerpAmount),null!=n.upAxis&&(this.upAxis=n.upAxis),null!=n.upAxisSpace&&(this.upAxisSpace=n.upAxisSpace),null!=n.yawAxis||null!=n.pitchAxis)){let t=o.RD.Y,e=o.RD.X;null!=n.yawAxis&&(t=n.yawAxis.clone(),t.normalize()),null!=n.pitchAxis&&(e=n.pitchAxis.clone(),e.normalize());const i=s.P.Cross(e,t);this._transformYawPitch=s.y3.Identity(),s.y3.FromXYZAxesToRef(e,t,i,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}e.getParent()||this.upAxisSpace!=o.T.BONE||(this.upAxisSpace=o.T.LOCAL)}update(){if(this.slerpAmount<1&&!this._firstFrameSkipped)return void(this._firstFrameSkipped=!0);const t=this.bone,e=h._TmpVecs[0];t.getAbsolutePositionToRef(this.mesh,e);let i=this.target;const n=h._TmpMats[0],r=h._TmpMats[1],a=this.mesh,l=t.getParent(),c=h._TmpVecs[1];c.copyFrom(this.upAxis),this.upAxisSpace==o.T.BONE&&l?(this._transformYawPitch&&s.P.TransformCoordinatesToRef(c,this._transformYawPitchInv,c),l.getDirectionToRef(c,this.mesh,c)):this.upAxisSpace==o.T.LOCAL&&(a.getDirectionToRef(c,c),1==a.scaling.x&&1==a.scaling.y&&1==a.scaling.z||c.normalize());let d=!1,_=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(d=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(_=!0),d||_){const t=h._TmpMats[2],n=h._TmpMats[3];if(this.upAxisSpace==o.T.BONE&&1==c.y&&l)l.getRotationMatrixToRef(o.T.WORLD,this.mesh,t);else if(this.upAxisSpace!=o.T.LOCAL||1!=c.y||l){let e=h._TmpVecs[2];e.copyFrom(this._fowardAxis),this._transformYawPitch&&s.P.TransformCoordinatesToRef(e,this._transformYawPitchInv,e),l?l.getDirectionToRef(e,this.mesh,e):a.getDirectionToRef(e,e);const i=s.P.Cross(c,e);i.normalize(),e=s.P.Cross(i,c),s.y3.FromXYZAxesToRef(i,c,e,t)}else t.copyFrom(a.getWorldMatrix());t.invertToRef(n);let r=null;if(_){const o=h._TmpVecs[3];i.subtractToRef(e,o),s.P.TransformCoordinatesToRef(o,n,o),r=Math.sqrt(o.x*o.x+o.z*o.z);const a=Math.atan2(o.y,r);let l=a;a>this._maxPitch?(o.y=this._maxPitchTan*r,l=this._maxPitch):a<this._minPitch&&(o.y=this._minPitchTan*r,l=this._minPitch),a!=l&&(s.P.TransformCoordinatesToRef(o,t,o),o.addInPlace(e),i=o)}if(d){const a=h._TmpVecs[4];i.subtractToRef(e,a),s.P.TransformCoordinatesToRef(a,n,a);const l=Math.atan2(a.x,a.z);let c=l;if((l>this._maxYaw||l<this._minYaw)&&(null==r&&(r=Math.sqrt(a.x*a.x+a.z*a.z)),this._yawRange>Math.PI?this._isAngleBetween(l,this._maxYaw,this._midYawConstraint)?(a.z=this._maxYawCos*r,a.x=this._maxYawSin*r,c=this._maxYaw):this._isAngleBetween(l,this._midYawConstraint,this._minYaw)&&(a.z=this._minYawCos*r,a.x=this._minYawSin*r,c=this._minYaw):l>this._maxYaw?(a.z=this._maxYawCos*r,a.x=this._maxYawSin*r,c=this._maxYaw):l<this._minYaw&&(a.z=this._minYawCos*r,a.x=this._minYawSin*r,c=this._minYaw)),this._slerping&&this._yawRange>Math.PI){const t=h._TmpVecs[8];t.copyFrom(o.RD.Z),this._transformYawPitch&&s.P.TransformCoordinatesToRef(t,this._transformYawPitchInv,t);const e=h._TmpMats[4];this._boneQuat.toRotationMatrix(e),this.mesh.getWorldMatrix().multiplyToRef(e,e),s.P.TransformCoordinatesToRef(t,e,t),s.P.TransformCoordinatesToRef(t,n,t);const i=Math.atan2(t.x,t.z);if(this._getAngleBetween(i,l)>this._getAngleBetween(i,this._midYawConstraint)){null==r&&(r=Math.sqrt(a.x*a.x+a.z*a.z));const t=this._getAngleBetween(i,this._maxYaw);this._getAngleBetween(i,this._minYaw)<t?(c=i+.75*Math.PI,a.z=Math.cos(c)*r,a.x=Math.sin(c)*r):(c=i-.75*Math.PI,a.z=Math.cos(c)*r,a.x=Math.sin(c)*r)}}l!=c&&(s.P.TransformCoordinatesToRef(a,t,a),a.addInPlace(e),i=a)}}const u=h._TmpVecs[5],p=h._TmpVecs[6],m=h._TmpVecs[7],g=h._TmpQuat;i.subtractToRef(e,u),u.normalize(),s.P.CrossToRef(c,u,p),p.normalize(),s.P.CrossToRef(u,p,m),m.normalize(),s.y3.FromXYZAxesToRef(p,m,u,n),0===p.x&&0===p.y&&0===p.z||0===m.x&&0===m.y&&0===m.z||0===u.x&&0===u.y&&0===u.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(s.y3.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,r),r.multiplyToRef(n,n)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(o.T.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(n,n),s._f.FromRotationMatrixToRef(n,g),s._f.SlerpToRef(this._boneQuat,g,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,o.T.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(n,n),this.bone.setRotationMatrix(n,o.T.WORLD,this.mesh),this._slerping=!1),this._updateLinkedTransformRotation())}_getAngleDiff(t,e){let i=e-t;return i%=2*Math.PI,i>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI),i}_getAngleBetween(t,e){let i=0;return i=(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)?e-t:t-e,i>Math.PI&&(i=2*Math.PI-i),i}_isAngleBetween(t,e,i){if(t=(t%=2*Math.PI)<0?t+2*Math.PI:t,(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(i=(i%=2*Math.PI)<0?i+2*Math.PI:i)){if(t>e&&t<i)return!0}else if(t>i&&t<e)return!0;return!1}_updateLinkedTransformRotation(){const t=this.bone;t._linkedTransformNode&&(t._linkedTransformNode.rotationQuaternion||(t._linkedTransformNode.rotationQuaternion=new s._f),t.getRotationQuaternionToRef(o.T.LOCAL,null,t._linkedTransformNode.rotationQuaternion))}}h._TmpVecs=a.B.BuildArray(10,s.P.Zero),h._TmpQuat=s._f.Identity(),h._TmpMats=a.B.BuildArray(5,s.y3.Identity);i(52106)},52106:(t,e,i)=>{i.d(e,{O:()=>_});var s=i(48017),o=i(62897),n=i(58095),r=i(46807),a=i(18770),h=i(4906),l=i(15210),c=i(84318),d=i(1101);class _{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(t,e,i){this.name=t,this.id=e,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=n.y3.Identity(),this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new o.y$,this.bones=[],this._scene=i||l.l.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const s=this._scene.getEngine().getCaps();this._canUseTextureForBones=s.textureFloat&&s.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((t=>!t.getParent()))}getTransformMatrices(t){return this.needInitialSkinMatrix?(t._bonesTransformMatrices||this.prepare(),t._bonesTransformMatrices):(this._transformMatrices||this.prepare(),this._transformMatrices)}getTransformMatrixTexture(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture}getScene(){return this._scene}toString(t){let e=`Name: ${this.name}, nBones: ${this.bones.length}`;if(e+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,t){e+=", Ranges: {";let t=!0;for(const i in this._ranges)t&&(e+=", ",t=!1),e+=i;e+="}"}return e}getBoneIndexByName(t){for(let e=0,i=this.bones.length;e<i;e++)if(this.bones[e].name===t)return e;return-1}createAnimationRange(t,e,i){if(!this._ranges[t]){this._ranges[t]=new h.X(t,e,i);for(let s=0,o=this.bones.length;s<o;s++)this.bones[s].animations[0]&&this.bones[s].animations[0].createRange(t,e,i)}}deleteAnimationRange(t,e=!0){for(let i=0,s=this.bones.length;i<s;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(t,e);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}getAnimationRanges(){const t=[];let e;for(e in this._ranges)t.push(this._ranges[e]);return t}copyAnimationRange(t,e,i=!1){if(this._ranges[e]||!t.getAnimationRange(e))return!1;let s=!0;const o=this._getHighestAnimationFrame()+1,n={},r=t.bones;let a,l;for(l=0,a=r.length;l<a;l++)n[r[l].name]=r[l];this.bones.length!==r.length&&(c.Y.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${r.length}`),s=!1);const d=i&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(l=0,a=this.bones.length;l<a;l++){const t=this.bones[l].name,r=n[t];r?s=s&&this.bones[l].copyAnimationRange(r,e,o,i,d):(c.Y.Warn("copyAnimationRange: not same rig, missing source bone "+t),s=!1)}const _=t.getAnimationRange(e);return _&&(this._ranges[e]=new h.X(e,_.from+o,_.to+o)),s}returnToRest(){for(const t of this.bones)-1!==t._index&&t.returnToRest()}_getHighestAnimationFrame(){let t=0;for(let e=0,i=this.bones.length;e<i;e++)if(this.bones[e].animations[0]){const i=this.bones[e].animations[0].getHighestFrame();t<i&&(t=i)}return t}beginAnimation(t,e,i,s){const o=this.getAnimationRange(t);return o?this._scene.beginAnimation(this,o.from,o.to,e,i,s):null}static MakeAnimationAdditive(t,e=0,i){const s=t.getAnimationRange(i);if(!s)return null;const o=t._scene.getAllAnimatablesByTarget(t);let n=null;for(let t=0;t<o.length;t++){const e=o[t];if(e.fromFrame===(null==s?void 0:s.from)&&e.toFrame===(null==s?void 0:s.to)){n=e;break}}const r=t.getAnimatables();for(let t=0;t<r.length;t++){const s=r[t].animations;if(s)for(let t=0;t<s.length;t++)a.f.MakeAnimationAdditive(s[t],e,i)}return n&&(n.isAdditive=!0),t}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(t){this._meshesWithPoseMatrix.push(t)}_unregisterMeshWithPoseMatrix(t){const e=this._meshesWithPoseMatrix.indexOf(t);e>-1&&this._meshesWithPoseMatrix.splice(e,1)}_computeTransformMatrices(t,e){this.onBeforeComputeObservable.notifyObservers(this);for(let i=0;i<this.bones.length;i++){const s=this.bones[i];s._childUpdateId++;const o=s.getParent();if(o?s.getLocalMatrix().multiplyToRef(o.getWorldMatrix(),s.getWorldMatrix()):e?s.getLocalMatrix().multiplyToRef(e,s.getWorldMatrix()):s.getWorldMatrix().copyFrom(s.getLocalMatrix()),-1!==s._index){const e=null===s._index?i:s._index;s.getInvertedAbsoluteTransform().multiplyToArray(s.getWorldMatrix(),t,16*e)}}this._identity.copyToArray(t,16*this.bones.length)}prepare(){if(this._numBonesWithLinkedTransformNode>0)for(const t of this.bones)if(t._linkedTransformNode){const e=t._linkedTransformNode;t.position=e.position,e.rotationQuaternion?t.rotationQuaternion=e.rotationQuaternion:t.rotation=e.rotation,t.scaling=e.scaling}if(this.needInitialSkinMatrix)for(const t of this._meshesWithPoseMatrix){const e=t.getPoseMatrix();let i=this._isDirty;if(t._bonesTransformMatrices&&t._bonesTransformMatrices.length===16*(this.bones.length+1)||(t._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),i=!0),i){if(this._synchronizedWithMesh!==t){this._synchronizedWithMesh=t;for(const t of this.bones)if(!t.getParent()){t.getBaseMatrix().multiplyToRef(e,n.jp.Matrix[1]),t._updateDifferenceMatrix(n.jp.Matrix[1])}if(this.isUsingTextureForMatrices){const e=4*(this.bones.length+1);t._transformMatrixTexture&&t._transformMatrixTexture.getSize().width===e||(t._transformMatrixTexture&&t._transformMatrixTexture.dispose(),t._transformMatrixTexture=r.l.CreateRGBATexture(t._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(t._bonesTransformMatrices,e),this.isUsingTextureForMatrices&&t._transformMatrixTexture&&t._transformMatrixTexture.update(t._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=r.l.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables}clone(t,e){const i=new _(t,e||t,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let t=0;t<this.bones.length;t++){const e=this.bones[t];let o=null;const n=e.getParent();if(n){const t=this.bones.indexOf(n);o=i.bones[t]}const r=new s.N(e.name,i,o,e.getBaseMatrix().clone(),e.getRestPose().clone());r._index=e._index,e._linkedTransformNode&&r.linkTransformNode(e._linkedTransformNode),d.j.DeepCopy(e.animations,r.animations)}if(this._ranges){i._ranges={};for(const t in this._ranges){const e=this._ranges[t];e&&(i._ranges[t]=e.clone())}}return this._isDirty=!0,i}enableBlending(t=.01){this.bones.forEach((e=>{e.animations.forEach((e=>{e.enableBlending=!0,e.blendingSpeed=t}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){const t=this._parentContainer.skeletons.indexOf(this);t>-1&&this._parentContainer.skeletons.splice(t,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){var t;const e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let i=0;i<this.bones.length;i++){const s=this.bones[i],o=s.getParent(),n={parentBoneIndex:o?this.bones.indexOf(o):-1,index:s.getIndex(),name:s.name,id:s.id,matrix:s.getBaseMatrix().toArray(),rest:s.getRestPose().toArray(),linkedTransformNodeId:null===(t=s.getTransformNode())||void 0===t?void 0:t.id};e.bones.push(n),s.length&&(n.length=s.length),s.metadata&&(n.metadata=s.metadata),s.animations&&s.animations.length>0&&(n.animation=s.animations[0].serialize()),e.ranges=[];for(const t in this._ranges){const i=this._ranges[t];if(!i)continue;const s={};s.name=t,s.from=i.from,s.to=i.to,e.ranges.push(s)}}return e}static Parse(t,e){const i=new _(t.name,t.id,e);let o;for(t.dimensionsAtRest&&(i.dimensionsAtRest=n.P.FromArray(t.dimensionsAtRest)),i.needInitialSkinMatrix=t.needInitialSkinMatrix,o=0;o<t.bones.length;o++){const e=t.bones[o],r=t.bones[o].index;let h=null;e.parentBoneIndex>-1&&(h=i.bones[e.parentBoneIndex]);const l=e.rest?n.y3.FromArray(e.rest):null,c=new s.N(e.name,i,h,n.y3.FromArray(e.matrix),l,null,r);void 0!==e.id&&null!==e.id&&(c.id=e.id),e.length&&(c.length=e.length),e.metadata&&(c.metadata=e.metadata),e.animation&&c.animations.push(a.f.Parse(e.animation)),void 0!==e.linkedTransformNodeId&&null!==e.linkedTransformNodeId&&(i._hasWaitingData=!0,c._waitingTransformNodeId=e.linkedTransformNodeId)}if(t.ranges)for(o=0;o<t.ranges.length;o++){const e=t.ranges[o];i.createAnimationRange(e.name,e.from,e.to)}return i}computeAbsoluteTransforms(t=!1){(this._absoluteTransformIsDirty||t)&&(this.bones[0].computeAbsoluteTransforms(),this._absoluteTransformIsDirty=!1)}getPoseMatrix(){let t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t}sortBones(){const t=new Array,e=new Array(this.bones.length);for(let i=0;i<this.bones.length;i++)this._sortBones(i,t,e);this.bones=t}_sortBones(t,e,i){if(i[t])return;i[t]=!0;const s=this.bones[t];if(!s)return;void 0===s._index&&(s._index=t);const o=s.getParent();o&&this._sortBones(this.bones.indexOf(o),e,i),e.push(s)}setCurrentPoseAsRest(){this.bones.forEach((t=>{t.setCurrentPoseAsRest()}))}}},72208:(t,e,i)=>{i.d(e,{l:()=>o,o:()=>n});var s=i(23582);class o{constructor(t,e,i,o=0,n=!1,r=!1,a=!1,h){this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=i,this._instanced=r,this._divisor=h||1,e instanceof s.h?(this._data=null,this._buffer=e):(this._data=e,this._buffer=null),this.byteStride=a?o:o*Float32Array.BYTES_PER_ELEMENT,n||this.create()}createVertexBuffer(t,e,i,s,o,r=!1,a){const h=r?e:e*Float32Array.BYTES_PER_ELEMENT,l=s?r?s:s*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new n(this._engine,this,t,this._updatable,!0,l,void 0===o?this._instanced:o,h,i,void 0,void 0,!0,this._divisor||a)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(t=null){!t&&this._buffer||(t=t||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t))}_rebuild(){this._buffer=null,this.create(this._data)}update(t){this.create(t)}updateDirectly(t,e,i,s=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,s?e:e*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===e&&void 0===i?t:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)}}class n{get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(t){const e=0!=t;this._instanceDivisor=t,e!==this._instanced&&(this._instanced=e,this._computeHashCode())}constructor(t,e,i,s,r,a,h,l,c,d,_=!1,u=!1,p=1,m=!1){if(e instanceof o?(this._buffer=e,this._ownsBuffer=m):(this._buffer=new o(t,e,s,a,r,h,u),this._ownsBuffer=!0),this.uniqueId=n._Counter++,this._kind=i,null==d){const t=this.getData();this.type=n.FLOAT,t instanceof Int8Array?this.type=n.BYTE:t instanceof Uint8Array?this.type=n.UNSIGNED_BYTE:t instanceof Int16Array?this.type=n.SHORT:t instanceof Uint16Array?this.type=n.UNSIGNED_SHORT:t instanceof Int32Array?this.type=n.INT:t instanceof Uint32Array&&(this.type=n.UNSIGNED_INT)}else this.type=d;const g=n.GetTypeByteLength(this.type);u?(this._size=c||(a?a/g:n.DeduceStride(i)),this.byteStride=a||this._buffer.byteStride||this._size*g,this.byteOffset=l||0):(this._size=c||a||n.DeduceStride(i),this.byteStride=a?a*g:this._buffer.byteStride||this._size*g,this.byteOffset=(l||0)*g),this.normalized=_,this._instanced=void 0!==h&&h,this._instanceDivisor=h?p:0,this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer&&this._buffer._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(t,e){const i=this.getData();if(!i)return null;const s=this.getSize()*n.GetTypeByteLength(this.type),o=t*this.getSize();if(this.type!==n.FLOAT||this.byteStride!==s){const t=new Float32Array(o);return this.forEach(o,((e,i)=>t[i]=e)),t}if(!(i instanceof Array||i instanceof Float32Array)||0!==this.byteOffset||i.length!==o){if(i instanceof Array){const t=this.byteOffset/4;return i.slice(t,t+o)}if(i instanceof ArrayBuffer)return new Float32Array(i,this.byteOffset,o);{let t=i.byteOffset+this.byteOffset;if(e){const e=new Float32Array(o),s=new Float32Array(i.buffer,t,o);return e.set(s),e}const s=t%4;return s&&(t=Math.max(0,t-s)),new Float32Array(i.buffer,t,o)}}return e?i.slice():i}getBuffer(){return this._buffer.getBuffer()}getStrideSize(){return this.byteStride/n.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/n.GetTypeByteLength(this.type)}getSize(t=!1){return t?this._size*n.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(t){this._buffer.create(t)}update(t){this._buffer.update(t)}updateDirectly(t,e,i=!1){this._buffer.updateDirectly(t,e,void 0,i)}dispose(){this._ownsBuffer&&this._buffer.dispose()}forEach(t,e){n.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,e)}static DeduceStride(t){switch(t){case n.UVKind:case n.UV2Kind:case n.UV3Kind:case n.UV4Kind:case n.UV5Kind:case n.UV6Kind:return 2;case n.NormalKind:case n.PositionKind:return 3;case n.ColorKind:case n.MatricesIndicesKind:case n.MatricesIndicesExtraKind:case n.MatricesWeightsKind:case n.MatricesWeightsExtraKind:case n.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetTypeByteLength(t){switch(t){case n.BYTE:case n.UNSIGNED_BYTE:return 1;case n.SHORT:case n.UNSIGNED_SHORT:return 2;case n.INT:case n.UNSIGNED_INT:case n.FLOAT:return 4;default:throw new Error(`Invalid type '${t}'`)}}static ForEach(t,e,i,s,o,r,a,h){if(t instanceof Array){let o=e/4;const n=i/4;for(let e=0;e<r;e+=s){for(let i=0;i<s;i++)h(t[o+i],e+i);o+=n}}else{const l=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),c=n.GetTypeByteLength(o);for(let t=0;t<r;t+=s){let r=e;for(let e=0;e<s;e++){h(n._GetFloatValue(l,o,r,a),t+e),r+=c}e+=i}}}static _GetFloatValue(t,e,i,s){switch(e){case n.BYTE:{let e=t.getInt8(i);return s&&(e=Math.max(e/127,-1)),e}case n.UNSIGNED_BYTE:{let e=t.getUint8(i);return s&&(e/=255),e}case n.SHORT:{let e=t.getInt16(i,!0);return s&&(e=Math.max(e/32767,-1)),e}case n.UNSIGNED_SHORT:{let e=t.getUint16(i,!0);return s&&(e/=65535),e}case n.INT:return t.getInt32(i,!0);case n.UNSIGNED_INT:return t.getUint32(i,!0);case n.FLOAT:return t.getFloat32(i,!0);default:throw new Error(`Invalid component type ${e}`)}}}n._Counter=0,n.BYTE=5120,n.UNSIGNED_BYTE=5121,n.SHORT=5122,n.UNSIGNED_SHORT=5123,n.INT=5124,n.UNSIGNED_INT=5125,n.FLOAT=5126,n.PositionKind="position",n.NormalKind="normal",n.TangentKind="tangent",n.UVKind="uv",n.UV2Kind="uv2",n.UV3Kind="uv3",n.UV4Kind="uv4",n.UV5Kind="uv5",n.UV6Kind="uv6",n.ColorKind="color",n.ColorInstanceKind="instanceColor",n.MatricesIndicesKind="matricesIndices",n.MatricesWeightsKind="matricesWeights",n.MatricesIndicesExtraKind="matricesIndicesExtra",n.MatricesWeightsExtraKind="matricesWeightsExtra"},23582:(t,e,i)=>{i.d(e,{h:()=>s});class s{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=s._Counter++}}s._Counter=0},71927:(t,e,i)=>{i(72208),i(23582),i(93752)},93752:(t,e,i)=>{i.d(e,{N:()=>s});class s{constructor(t,e,i=3){this._engine=t,this._engine._storageBuffers.push(this),this._create(e,i)}_create(t,e){this._bufferSize=t,this._creationFlags=e,this._buffer=this._engine.createStorageBuffer(t,e)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(t,e,i){this._buffer&&this._engine.updateStorageBuffer(this._buffer,t,e,i)}read(t,e,i){return this._engine.readFromStorageBuffer(this._buffer,t,e,i)}dispose(){const t=this._engine._storageBuffers,e=t.indexOf(this);-1!==e&&(t[e]=t[t.length-1],t.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}},23402:(t,e,i)=>{i.d(e,{Y:()=>l});var s=i(72433),o=i(96969),n=i(62897),r=i(76324),a=i(49671),h=i(13514);class l{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new n.y$,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==r.kD.POINTERWHEEL)return;const i=e.event,s=i.deltaMode===a.G.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*s*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*s*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*s*i.deltaZ/this._normalize,i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,r.kD.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,s.gn)([(0,o.qC)()],l.prototype,"wheelPrecisionX",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"wheelPrecisionY",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"wheelPrecisionZ",void 0)},23592:(t,e,i)=>{i.d(e,{O:()=>a});var s=i(72433),o=i(96969),n=i(13514),r=i(76324);class a{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(t){t=n.w1.BackCompatCameraNoPreventDefault(arguments);const e=this.camera.getEngine(),i=e.getInputElement();let s=0,o=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{var a,h;const l=n.event,c="touch"===l.pointerType;if(e.isInVRExclusivePointerMode)return;if(n.type!==r.kD.POINTERMOVE&&-1===this.buttons.indexOf(l.button))return;const d=l.target;if(this._altKey=l.altKey,this._ctrlKey=l.ctrlKey,this._metaKey=l.metaKey,this._shiftKey=l.shiftKey,this._buttonsPressed=l.buttons,e.isPointerLock){const t=l.movementX,e=l.movementY;this.onTouch(null,t,e),this._pointA=null,this._pointB=null}else{if(n.type!==r.kD.POINTERDOWN&&c&&(null===(a=this._pointA)||void 0===a?void 0:a.pointerId)!==l.pointerId&&(null===(h=this._pointB)||void 0===h?void 0:h.pointerId)!==l.pointerId)return;if(n.type!==r.kD.POINTERDOWN||-1!==this._currentActiveButton&&!c)if(n.type===r.kD.POINTERDOUBLETAP)this.onDoubleTap(l.pointerType);else if(n.type!==r.kD.POINTERUP||this._currentActiveButton!==l.button&&!c){if(n.type===r.kD.POINTERMOVE)if(t||l.preventDefault(),this._pointA&&null===this._pointB){const t=l.clientX-this._pointA.x,e=l.clientY-this._pointA.y;this.onTouch(this._pointA,t,e),this._pointA.x=l.clientX,this._pointA.y=l.clientY}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===l.pointerId?this._pointA:this._pointB;t.x=l.clientX,t.y=l.clientY;const e=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,r=e*e+i*i,a={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:l.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,s,r,o,a),o=a,s=r}}else{try{null==d||d.releasePointerCapture(l.pointerId)}catch(t){}c||(this._pointB=null),e._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==l.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==l.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==s||o)&&(this.onMultiTouch(this._pointA,this._pointB,s,0,o,null),s=0,o=null),this._currentActiveButton=-1,this.onButtonUp(l),t||l.preventDefault()}else{try{null==d||d.setPointerCapture(l.pointerId)}catch(t){}if(null===this._pointA)this._pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType};else{if(null!==this._pointB)return;this._pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}}-1!==this._currentActiveButton||c||(this._currentActiveButton=l.button),this.onButtonDown(l),t||(l.preventDefault(),i&&i.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,r.kD.POINTERDOWN|r.kD.POINTERUP|r.kD.POINTERMOVE|r.kD.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,s=0,o=null,this.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const a=this.camera.getScene().getEngine().getHostWindow();a&&n.w1.RegisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const t=this.camera.getScene().getEngine().getHostWindow();t&&n.w1.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,e,i){}onMultiTouch(t,e,i,s,o,n){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,s.gn)([(0,o.qC)()],a.prototype,"buttons",void 0)},75537:(t,e,i)=>{i.d(e,{R:()=>a});var s=i(72433),o=i(96969),n=i(73321),r=i(34987);class a{constructor(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(t){this._yAxisScale=t?-1:1}attachControl(){const t=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add((t=>{t.type!==r.nJ.POSE_ENABLED&&(this.gamepad&&t.type!==r.nJ.XBOX||(this.gamepad=t))})),this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add((t=>{this.gamepad===t&&(this.gamepad=null)})),this.gamepad=t.getGamepadByType(r.nJ.XBOX)}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad){const t=this.camera,e=this.gamepad.rightStick;if(e){if(0!=e.x){const i=e.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(t.inertialAlphaOffset+=i)}if(0!=e.y){const i=e.y/this.gamepadRotationSensibility*this._yAxisScale;0!=i&&Math.abs(i)>.005&&(t.inertialBetaOffset+=i)}}const i=this.gamepad.leftStick;if(i&&0!=i.y){const t=i.y/this.gamepadMoveSensibility;0!=t&&Math.abs(t)>.005&&(this.camera.inertialRadiusOffset-=t)}}}getClassName(){return"ArcRotateCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,s.gn)([(0,o.qC)()],a.prototype,"gamepadRotationSensibility",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"gamepadMoveSensibility",void 0),n.u.ArcRotateCameraGamepadInput=a},34286:(t,e,i)=>{i.d(e,{v:()=>h});var s=i(72433),o=i(96969),n=i(73321),r=i(63737),a=i(13514);class h{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=a.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===r.OG.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(t||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),i.preventDefault&&(t||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,s.gn)([(0,o.qC)()],h.prototype,"keysUp",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"keysDown",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"keysLeft",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"keysRight",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"keysReset",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"panningSensibility",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"zoomingSensibility",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"useAltToZoom",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"angularSpeed",void 0),n.u.ArcRotateCameraKeyboardMoveInput=h},20462:(t,e,i)=>{i.d(e,{F:()=>u});var s=i(72433),o=i(96969),n=i(73321),r=i(76324),a=i(62464),h=i(58095),l=i(48154),c=i(49671),d=i(72739),_=i(13514);class u{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=h.P.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,e){let i=0;const s=.01*t*this.wheelDeltaPercentage*e;return i=t>0?s/(1+this.wheelDeltaPercentage):s*(1+this.wheelDeltaPercentage),i}attachControl(t){t=_.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==r.kD.POINTERWHEEL)return;const i=e.event;let s=0;const o=i.deltaMode===c.G.DOM_DELTA_LINE?40:1,n=-i.deltaY*o;if(this.customComputeDeltaFromMouseWheel)s=this.customComputeDeltaFromMouseWheel(n,this,i);else if(this.wheelDeltaPercentage){if(s=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),s>0){let t=this.camera.radius,e=this.camera.inertialRadiusOffset+s;for(let i=0;i<20&&Math.abs(e)>.001;i++)t-=e,e*=this.camera.inertia;t=d.R.Clamp(t,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(n,t)}}else s=n/(40*this.wheelPrecision);s&&(this.zoomToMouseLocation&&this._hitPlane?this._zoomToMouse(s):this.camera.inertialRadiusOffset+=s),i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,r.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,e=t.target.subtract(t.position);this._hitPlane=a.J.FromPositionAndNormal(t.target,e)}_getPosition(){var t;const e=this.camera,i=e.getScene(),s=i.createPickingRay(i.pointerX,i.pointerY,h.y3.Identity(),e,!1);let o=0;return this._hitPlane&&(o=null!==(t=s.intersectsPlane(this._hitPlane))&&void 0!==t?t:0),s.origin.addInPlace(s.direction.scaleInPlace(o))}_zoomToMouse(t){var e,i;const s=this.camera,o=1-s.inertia;if(s.lowerRadiusLimit){const i=null!==(e=s.lowerRadiusLimit)&&void 0!==e?e:0;s.radius-(s.inertialRadiusOffset+t)/o<i&&(t=(s.radius-i)*o-s.inertialRadiusOffset)}if(s.upperRadiusLimit){const e=null!==(i=s.upperRadiusLimit)&&void 0!==i?i:0;s.radius-(s.inertialRadiusOffset+t)/o>e&&(t=(s.radius-e)*o-s.inertialRadiusOffset)}const n=t/o/s.radius,r=this._getPosition(),a=h.jp.Vector3[6];r.subtractToRef(s.target,a),a.scaleInPlace(n),a.scaleInPlace(o),this._inertialPanning.addInPlace(a),s.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<l.kn&&(t.x=0),Math.abs(t.y)<l.kn&&(t.y=0),Math.abs(t.z)<l.kn&&(t.z=0)}}(0,s.gn)([(0,o.qC)()],u.prototype,"wheelPrecision",void 0),(0,s.gn)([(0,o.qC)()],u.prototype,"zoomToMouseLocation",void 0),(0,s.gn)([(0,o.qC)()],u.prototype,"wheelDeltaPercentage",void 0),n.u.ArcRotateCameraMouseWheelInput=u},75105:(t,e,i)=>{i.d(e,{H:()=>a});var s=i(72433),o=i(96969),n=i(73321),r=i(23592);class a extends r.O{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,e){if(0!==this.panningSensibility&&t&&e){const i=e.x-t.x,s=e.y-t.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility}}_computePinchZoom(t,e){const i=this.camera.radius||a.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(t)/Math.sqrt(e):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(e-t)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(e-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,e,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=e/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,e,i,s,o,n){0===i&&null===o||0===s&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,s),this._computeMultiTouchPanning(o,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(s)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,s),this._isPinching=!0):this._computeMultiTouchPanning(o,n)):this.multiTouchPanning?this._computeMultiTouchPanning(o,n):this.pinchZoom&&this._computePinchZoom(i,s))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}a.MinimumRadiusForPinch=.001,(0,s.gn)([(0,o.qC)()],a.prototype,"buttons",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"angularSensibilityX",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"angularSensibilityY",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"pinchPrecision",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"pinchDeltaPercentage",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"useNaturalPinchZoom",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"pinchZoom",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"panningSensibility",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"multiTouchPanning",void 0),(0,s.gn)([(0,o.qC)()],a.prototype,"multiTouchPanAndZoom",void 0),n.u.ArcRotateCameraPointersInput=a},39418:(t,e,i)=>{var s=i(73321),o=i(58095),n=i(13514),r=i(93151),a=i(62897);r.a.prototype.addDeviceOrientation=function(t){return this._deviceOrientationInput||(this._deviceOrientationInput=new h,t&&(this._deviceOrientationInput.smoothFactor=t),this.add(this._deviceOrientationInput)),this};class h{static WaitForOrientationChangeAsync(t){return new Promise(((e,i)=>{let s=!1;const o=()=>{window.removeEventListener("deviceorientation",o),s=!0,e()};t&&setTimeout((()=>{s||(window.removeEventListener("deviceorientation",o),i("WaitForOrientationChangeAsync timed out"))}),t),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"==t?window.addEventListener("deviceorientation",o):n.w1.Warn("Permission not granted.")})).catch((t=>{n.w1.Error(t)})):window.addEventListener("deviceorientation",o)}))}constructor(){this._screenOrientationAngle=0,this._screenQuaternion=new o._f,this._alpha=0,this._beta=0,this._gamma=0,this.smoothFactor=0,this._onDeviceOrientationChangedObservable=new a.y$,this._orientationChanged=()=>{this._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,this._screenOrientationAngle=-n.w1.ToRadians(this._screenOrientationAngle/2),this._screenQuaternion.copyFromFloats(0,Math.sin(this._screenOrientationAngle),0,Math.cos(this._screenOrientationAngle))},this._deviceOrientation=t=>{this.smoothFactor?(this._alpha=null!==t.alpha?n.w1.SmoothAngleChange(this._alpha,t.alpha,this.smoothFactor):0,this._beta=null!==t.beta?n.w1.SmoothAngleChange(this._beta,t.beta,this.smoothFactor):0,this._gamma=null!==t.gamma?n.w1.SmoothAngleChange(this._gamma,t.gamma,this.smoothFactor):0):(this._alpha=null!==t.alpha?t.alpha:0,this._beta=null!==t.beta?t.beta:0,this._gamma=null!==t.gamma?t.gamma:0),null!==t.alpha&&this._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new o._f(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}get camera(){return this._camera}set camera(t){this._camera=t,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new o._f),this._camera&&this._camera.onDisposeObservable.add((()=>{this._onDeviceOrientationChangedObservable.clear()}))}attachControl(){const t=this.camera.getScene().getEngine().getHostWindow();if(t){const e=()=>{t.addEventListener("orientationchange",this._orientationChanged),t.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t?e():n.w1.Warn("Permission not granted.")})).catch((t=>{n.w1.Error(t)})):e()}}detachControl(){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0}checkInputs(){this._alpha&&(o._f.RotationYawPitchRollToRef(n.w1.ToRadians(this._alpha),n.w1.ToRadians(this._beta),-n.w1.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)}getClassName(){return"FreeCameraDeviceOrientationInput"}getSimpleName(){return"deviceOrientation"}}s.u.FreeCameraDeviceOrientationInput=h},61660:(t,e,i)=>{i.d(e,{c:()=>h});var s=i(72433),o=i(96969),n=i(73321),r=i(58095),a=i(34987);class h{constructor(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this.deadzoneDelta=.1,this._yAxisScale=1,this._cameraTransform=r.y3.Identity(),this._deltaTransform=r.P.Zero(),this._vector3=r.P.Zero(),this._vector2=r.FM.Zero()}get invertYAxis(){return 1!==this._yAxisScale}set invertYAxis(t){this._yAxisScale=t?-1:1}attachControl(){const t=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add((t=>{t.type!==a.nJ.POSE_ENABLED&&(this.gamepad&&t.type!==a.nJ.XBOX||(this.gamepad=t))})),this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add((t=>{this.gamepad===t&&(this.gamepad=null)})),this.gamepad=t.getGamepadByType(a.nJ.XBOX),!this.gamepad&&t.gamepads.length&&(this.gamepad=t.gamepads[0])}detachControl(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null}checkInputs(){if(this.gamepad&&this.gamepad.leftStick){const t=this.camera,e=this.gamepad.leftStick;0!==this.gamepadMoveSensibility&&(e.x=Math.abs(e.x)>this.deadzoneDelta?e.x/this.gamepadMoveSensibility:0,e.y=Math.abs(e.y)>this.deadzoneDelta?e.y/this.gamepadMoveSensibility:0);let i=this.gamepad.rightStick;i&&0!==this.gamepadAngularSensibility?(i.x=Math.abs(i.x)>this.deadzoneDelta?i.x/this.gamepadAngularSensibility:0,i.y=(Math.abs(i.y)>this.deadzoneDelta?i.y/this.gamepadAngularSensibility:0)*this._yAxisScale):i={x:0,y:0},t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):r.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);const s=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*s,0,-e.y*s),r.P.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),t.cameraRotation.addInPlace(this._vector2)}}getClassName(){return"FreeCameraGamepadInput"}getSimpleName(){return"gamepad"}}(0,s.gn)([(0,o.qC)()],h.prototype,"gamepadAngularSensibility",void 0),(0,s.gn)([(0,o.qC)()],h.prototype,"gamepadMoveSensibility",void 0),n.u.FreeCameraGamepadInput=h},3251:(t,e,i)=>{i.d(e,{Y:()=>l});var s=i(72433),o=i(96969),n=i(73321),r=i(63737),a=i(58095),h=i(13514);class l{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===r.OG.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),t||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),t||i.preventDefault()}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e],s=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?t._localDirection.copyFromFloats(-s,0,0):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,0,s):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(s,0,0):-1!==this.keysDown.indexOf(i)?t._localDirection.copyFromFloats(0,0,-s):-1!==this.keysUpward.indexOf(i)?t._localDirection.copyFromFloats(0,s,0):-1!==this.keysDownward.indexOf(i)?t._localDirection.copyFromFloats(0,-s,0):-1!==this.keysRotateLeft.indexOf(i)?(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)&&(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y+=this._getLocalRotation()),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),a.P.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){let t=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(t*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(t*=-1),t}}(0,s.gn)([(0,o.qC)()],l.prototype,"keysUp",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"keysUpward",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"keysDown",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"keysDownward",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"keysLeft",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"keysRight",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"rotationSpeed",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"keysRotateLeft",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"keysRotateRight",void 0),n.u.FreeCameraKeyboardMoveInput=l},37026:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(72433),o=i(62897),n=i(96969),r=i(73321),a=i(76324),h=i(13514);class l{constructor(t=!0){this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new o.y$,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments);const e=this.camera.getEngine(),i=e.getInputElement();this._pointerInput||(this._pointerInput=s=>{const o=s.event,n="touch"===o.pointerType;if(e.isInVRExclusivePointerMode)return;if(!this.touchEnabled&&n)return;if(s.type!==a.kD.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const r=o.target;if(s.type===a.kD.POINTERDOWN){if(n&&-1!==this._activePointerId||!n&&-1!==this._currentActiveButton)return;this._activePointerId=o.pointerId;try{null==r||r.setPointerCapture(o.pointerId)}catch(t){}-1===this._currentActiveButton&&(this._currentActiveButton=o.button),this._previousPosition={x:o.clientX,y:o.clientY},t||(o.preventDefault(),i&&i.focus()),e.isPointerLock&&this._onMouseMove&&this._onMouseMove(s.event)}else if(s.type===a.kD.POINTERUP){if(n&&this._activePointerId!==o.pointerId||!n&&this._currentActiveButton!==o.button)return;try{null==r||r.releasePointerCapture(o.pointerId)}catch(t){}this._currentActiveButton=-1,this._previousPosition=null,t||o.preventDefault(),this._activePointerId=-1}else if(s.type===a.kD.POINTERMOVE&&(this._activePointerId===o.pointerId||!n))if(e.isPointerLock&&this._onMouseMove)this._onMouseMove(s.event);else if(this._previousPosition){let e=o.clientX-this._previousPosition.x;const i=o.clientY-this._previousPosition.y;this.camera.getScene().useRightHandedSystem&&(e*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this._allowCameraRotation&&(this.camera.cameraRotation.y+=e/this.angularSensibility,this.camera.cameraRotation.x+=i/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:e,offsetY:i}),this._previousPosition={x:o.clientX,y:o.clientY},t||o.preventDefault()}}),this._onMouseMove=i=>{if(!e.isPointerLock)return;if(e.isInVRExclusivePointerMode)return;let s=i.movementX;this.camera.getScene().useRightHandedSystem&&(s*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(s*=-1),this.camera.cameraRotation.y+=s/this.angularSensibility;const o=i.movementY;this.camera.cameraRotation.x+=o/this.angularSensibility,this._previousPosition=null,t||i.preventDefault()},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,a.kD.POINTERDOWN|a.kD.POINTERUP|a.kD.POINTERMOVE),i&&(this._contextMenuBind=this.onContextMenu.bind(this),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(t){t.preventDefault()}detachControl(){if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,s.gn)([(0,n.qC)()],l.prototype,"buttons",void 0),(0,s.gn)([(0,n.qC)()],l.prototype,"angularSensibility",void 0),r.u.FreeCameraMouseInput=l},99106:(t,e,i)=>{i.d(e,{A:()=>c});var s,o=i(72433),n=i(96969),r=i(73321),a=i(23402),h=i(58095),l=i(43048);!function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(s||(s={}));class c extends a.Y{constructor(){super(...arguments),this._moveRelative=h.P.Zero(),this._rotateRelative=h.P.Zero(),this._moveScene=h.P.Zero(),this._wheelXAction=s.MoveRelative,this._wheelXActionCoordinate=l.c7.X,this._wheelYAction=s.MoveRelative,this._wheelYActionCoordinate=l.c7.Z,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(t){null===t&&this._wheelXAction!==s.MoveRelative||(this._wheelXAction=s.MoveRelative,this._wheelXActionCoordinate=t)}get wheelXMoveRelative(){return this._wheelXAction!==s.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(t){null===t&&this._wheelYAction!==s.MoveRelative||(this._wheelYAction=s.MoveRelative,this._wheelYActionCoordinate=t)}get wheelYMoveRelative(){return this._wheelYAction!==s.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(t){null===t&&this._wheelZAction!==s.MoveRelative||(this._wheelZAction=s.MoveRelative,this._wheelZActionCoordinate=t)}get wheelZMoveRelative(){return this._wheelZAction!==s.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(t){null===t&&this._wheelXAction!==s.RotateRelative||(this._wheelXAction=s.RotateRelative,this._wheelXActionCoordinate=t)}get wheelXRotateRelative(){return this._wheelXAction!==s.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(t){null===t&&this._wheelYAction!==s.RotateRelative||(this._wheelYAction=s.RotateRelative,this._wheelYActionCoordinate=t)}get wheelYRotateRelative(){return this._wheelYAction!==s.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(t){null===t&&this._wheelZAction!==s.RotateRelative||(this._wheelZAction=s.RotateRelative,this._wheelZActionCoordinate=t)}get wheelZRotateRelative(){return this._wheelZAction!==s.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(t){null===t&&this._wheelXAction!==s.MoveScene||(this._wheelXAction=s.MoveScene,this._wheelXActionCoordinate=t)}get wheelXMoveScene(){return this._wheelXAction!==s.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(t){null===t&&this._wheelYAction!==s.MoveScene||(this._wheelYAction=s.MoveScene,this._wheelYActionCoordinate=t)}get wheelYMoveScene(){return this._wheelYAction!==s.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(t){null===t&&this._wheelZAction!==s.MoveScene||(this._wheelZAction=s.MoveScene,this._wheelZActionCoordinate=t)}get wheelZMoveScene(){return this._wheelZAction!==s.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);const t=h.y3.Zero();this.camera.getViewMatrix().invertToRef(t);const e=h.P.Zero();h.P.TransformNormalToRef(this._moveRelative,t,e),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(e),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(t,e,i){if(0===t)return;if(null===e||null===i)return;let o=null;switch(e){case s.MoveRelative:o=this._moveRelative;break;case s.RotateRelative:o=this._rotateRelative;break;case s.MoveScene:o=this._moveScene}switch(i){case l.c7.X:o.set(t,0,0);break;case l.c7.Y:o.set(0,t,0);break;case l.c7.Z:o.set(0,0,t)}}}(0,o.gn)([(0,n.qC)()],c.prototype,"wheelXMoveRelative",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelYMoveRelative",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelZMoveRelative",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelXRotateRelative",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelYRotateRelative",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelZRotateRelative",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelXMoveScene",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelYMoveScene",null),(0,o.gn)([(0,n.qC)()],c.prototype,"wheelZMoveScene",null),r.u.FreeCameraMouseWheelInput=c},86009:(t,e,i)=>{i.d(e,{y:()=>l});var s=i(72433),o=i(96969),n=i(73321),r=i(76324),a=i(58095),h=i(13514);class l{constructor(t=!1){this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=h.w1.IsSafari()}attachControl(t){t=h.w1.BackCompatCameraNoPreventDefault(arguments);let e=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const s=i.event,o="mouse"===s.pointerType||this._isSafari&&void 0===s.pointerType;if(this.allowMouse||!o)if(i.type===r.kD.POINTERDOWN){if(t||s.preventDefault(),this._pointerPressed.push(s.pointerId),1!==this._pointerPressed.length)return;e={x:s.clientX,y:s.clientY}}else if(i.type===r.kD.POINTERUP){t||s.preventDefault();const i=this._pointerPressed.indexOf(s.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;e=null,this._offsetX=null,this._offsetY=null}else if(i.type===r.kD.POINTERMOVE){if(t||s.preventDefault(),!e)return;if(0!=this._pointerPressed.indexOf(s.pointerId))return;this._offsetX=s.clientX-e.x,this._offsetY=-(s.clientY-e.y)}}),this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,r.kD.POINTERDOWN|r.kD.POINTERUP|r.kD.POINTERMOVE),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.addEventListener("blur",this._onLostFocus)}}detachControl(){if(this._pointerInput){if(this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const t=this.camera;t.cameraRotation.y=this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const e=t._computeLocalCameraSpeed(),i=new a.P(0,0,0!==this.touchMoveSensibility?e*this._offsetY/this.touchMoveSensibility:0);a.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(a.P.TransformCoordinates(i,t._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,s.gn)([(0,o.qC)()],l.prototype,"touchAngularSensibility",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"touchMoveSensibility",void 0),n.u.FreeCameraTouchInput=l},28044:(t,e,i)=>{i.d(e,{S:()=>l});var s=i(58095),o=i(16325),n=i(43792),r=i(372),a=i(84318),h=i(66513);function l(t,e){const i=e.vrCameraMetrics||r.X.GetDefault();t._rigCameras[0]._cameraRigParams.vrMetrics=i,t._rigCameras[0].viewport=new h.l(0,0,.5,1),t._rigCameras[0]._cameraRigParams.vrWorkMatrix=new s.y3,t._rigCameras[0]._cameraRigParams.vrHMatrix=i.leftHMatrix,t._rigCameras[0]._cameraRigParams.vrPreViewMatrix=i.leftPreViewMatrix,t._rigCameras[0].getProjectionMatrix=t._rigCameras[0]._getVRProjectionMatrix,t._rigCameras[1]._cameraRigParams.vrMetrics=i,t._rigCameras[1].viewport=new h.l(.5,0,.5,1),t._rigCameras[1]._cameraRigParams.vrWorkMatrix=new s.y3,t._rigCameras[1]._cameraRigParams.vrHMatrix=i.rightHMatrix,t._rigCameras[1]._cameraRigParams.vrPreViewMatrix=i.rightPreViewMatrix,t._rigCameras[1].getProjectionMatrix=t._rigCameras[1]._getVRProjectionMatrix,i.multiviewEnabled&&(t.getScene().getEngine().getCaps().multiview?(t._useMultiviewToSingleView=!0,t._rigPostProcess=new n.E("VRMultiviewToSingleview",t,i.postProcessScaleFactor)):(a.Y.Warn("Multiview is not supported, falling back to standard rendering"),i.multiviewEnabled=!1)),i.compensateDistortion&&(t._rigCameras[0]._rigPostProcess=new o.T("VR_Distort_Compensation_Left",t._rigCameras[0],!1,i),t._rigCameras[1]._rigPostProcess=new o.T("VR_Distort_Compensation_Right",t._rigCameras[1],!0,i))}},51345:(t,e,i)=>{i.d(e,{j:()=>n});var s=i(58095),o=i(66513);function n(t,e){if(e.vrDisplay){const i=e.vrDisplay.getEyeParameters("left"),n=e.vrDisplay.getEyeParameters("right");t._rigCameras[0].viewport=new o.l(0,0,.5,1),t._rigCameras[0].setCameraRigParameter("left",!0),t._rigCameras[0].setCameraRigParameter("specs",e.specs),t._rigCameras[0].setCameraRigParameter("eyeParameters",i),t._rigCameras[0].setCameraRigParameter("frameData",e.frameData),t._rigCameras[0].setCameraRigParameter("parentCamera",e.parentCamera),t._rigCameras[0]._cameraRigParams.vrWorkMatrix=new s.y3,t._rigCameras[0].getProjectionMatrix=t._getWebVRProjectionMatrix,t._rigCameras[0].parent=t,t._rigCameras[0]._getViewMatrix=t._getWebVRViewMatrix,t._rigCameras[1].viewport=new o.l(.5,0,.5,1),t._rigCameras[1].setCameraRigParameter("eyeParameters",n),t._rigCameras[1].setCameraRigParameter("specs",e.specs),t._rigCameras[1].setCameraRigParameter("frameData",e.frameData),t._rigCameras[1].setCameraRigParameter("parentCamera",e.parentCamera),t._rigCameras[1]._cameraRigParams.vrWorkMatrix=new s.y3,t._rigCameras[1].getProjectionMatrix=t._getWebVRProjectionMatrix,t._rigCameras[1].parent=t,t._rigCameras[1]._getViewMatrix=t._getWebVRViewMatrix}}},372:(t,e,i)=>{i.d(e,{X:()=>o});var s=i(58095);class o{constructor(){this.compensateDistortion=!0,this.multiviewEnabled=!1}get aspectRatio(){return this.hResolution/(2*this.vResolution)}get aspectRatioFov(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))}get leftHMatrix(){const t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return s.y3.Translation(t,0,0)}get rightHMatrix(){const t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return s.y3.Translation(-t,0,0)}get leftPreViewMatrix(){return s.y3.Translation(.5*this.interpupillaryDistance,0,0)}get rightPreViewMatrix(){return s.y3.Translation(-.5*this.interpupillaryDistance,0,0)}static GetDefault(){const t=new o;return t.hResolution=1280,t.vResolution=800,t.hScreenSize=.149759993,t.vScreenSize=.0935999975,t.vScreenCenter=.0467999987,t.eyeToScreenDistance=.0410000011,t.lensSeparationDistance=.063500002,t.interpupillaryDistance=.064000003,t.distortionK=[1,.219999999,.239999995,0],t.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],t.postProcessScaleFactor=1.714605507808412,t.lensCenterOffset=.151976421,t}}},62091:(t,e,i)=>{i.d(e,{i:()=>l});var s=i(2055),o=i(39821),n=i(372),r=i(58095),a=i(17834),h=i(28044);a.N.AddNodeConstructor("VRDeviceOrientationFreeCamera",((t,e)=>()=>new l(t,r.P.Zero(),e)));class l extends o.n{constructor(t,e,i,o=!0,r=n.X.GetDefault()){super(t,e,i),this._setRigMode=h.S.bind(null,this),r.compensateDistortion=o,this.setCameraRigMode(s.V.RIG_MODE_VR,{vrCameraMetrics:r})}getClassName(){return"VRDeviceOrientationFreeCamera"}}},12110:(t,e,i)=>{i.d(e,{F:()=>V});var s=i(84318),o=i(62897),n=i(78098),r=i(86121),a=i(39821),h=i(62091),l=i(58705),c=i(76324),d=i(58095),_=i(15631),u=i(34987),p=i(94557),m=i(97338),g=i(76576),f=i(91243),y=i(1316),C=i(90622),R=i(3085),b=i(93980),P=i(90216),v=i(88916),T=i(18770),x=i(372),M=(i(93197),i(83534),i(43048)),w=i(97654),O=i(9022),k=i(62845),S=i(49353),D=i(41525);class A{constructor(t,e=null){if(this.scene=t,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=A._IdCounter++,e)this._gazeTracker=e.clone("gazeTracker");else{this._gazeTracker=(0,S.eu)("gazeTracker",{diameter:.0035,thickness:.0025,tessellation:20,updatable:!1},t),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;const e=new R.K("targetMat",t);e.specularColor=_.Wo.Black(),e.emissiveColor=new _.Wo(.7,.7,.7),e.backFaceCulling=!1,this._gazeTracker.material=e}}_getForwardRay(t){return new y.z(d.P.Zero(),new d.P(0,0,t))}_selectionPointerDown(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})}_selectionPointerUp(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1}_activatePointer(){this._activePointer=!0}_deactivatePointer(){this._activePointer=!1}_updatePointerDistance(t=100){}dispose(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()}}A._IdCounter=0;class I extends A{constructor(t,e,i){super(e,i),this.webVRController=t,this._laserPointer=(0,k.wf)("laserPointer",{updatable:!1,height:1,diameterTop:.004,diameterBottom:2e-4,tessellation:20,subdivisions:1},e);const s=new R.K("laserPointerMat",e);if(s.emissiveColor=new _.Wo(.7,.7,.7),s.alpha=.6,this._laserPointer.material=s,this._laserPointer.rotation.x=Math.PI/2,this._laserPointer.position.z=-.5,this._laserPointer.isVisible=!1,this._laserPointer.isPickable=!1,!t.mesh){const i=new f.Kj("preloadControllerMesh",e),s=new f.Kj(p.K4.POINTING_POSE,e);s.rotation.x=-.7,i.addChild(s),t.attachToMesh(i)}this._setLaserPointerParent(t.mesh),this._meshAttachedObserver=t._meshAttachedObservable.add((t=>{this._setLaserPointerParent(t)}))}_getForwardRay(t){return this.webVRController.getForwardRay(t)}_activatePointer(){super._activatePointer(),this._laserPointer.isVisible=!0}_deactivatePointer(){super._deactivatePointer(),this._laserPointer.isVisible=!1}_setLaserPointerColor(t){this._laserPointer.material.emissiveColor=t}_setLaserPointerLightingDisabled(t){this._laserPointer.material.disableLighting=t}_setLaserPointerParent(t){const e=t=>{t.isPickable=!1,t.getChildMeshes().forEach((t=>{e(t)}))};e(t);const i=t.getChildren(void 0,!1);let s=t;this.webVRController._pointingPoseNode=null;for(let t=0;t<i.length;t++)if(i[t].name&&i[t].name.indexOf(p.K4.POINTING_POSE)>=0){s=i[t],this.webVRController._pointingPoseNode=s;break}this._laserPointer.parent=s}_updatePointerDistance(t=100){this._laserPointer.scaling.y=t,this._laserPointer.position.z=-t/2}dispose(){super.dispose(),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)}}class E extends A{constructor(t,e){super(e),this._getCamera=t}_getForwardRay(t){const e=this._getCamera();return e?e.getForwardRay(t):new y.z(d.P.Zero(),d.P.Forward())}}class V{get onEnteringVR(){return this.onEnteringVRObservable}get onExitingVR(){return this.onExitingVRObservable}get onControllerMeshLoaded(){return this.onControllerMeshLoadedObservable}get teleportationTarget(){return this._teleportationTarget}set teleportationTarget(t){t&&(t.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=t)}get gazeTrackerMesh(){return this._cameraGazer._gazeTracker}set gazeTrackerMesh(t){t&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=t,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))}get leftControllerGazeTrackerMesh(){return this._leftController?this._leftController._gazeTracker:null}get rightControllerGazeTrackerMesh(){return this._rightController?this._rightController._gazeTracker:null}get displayGaze(){return this._displayGaze}set displayGaze(t){this._displayGaze=t,t||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))}get displayLaserPointer(){return this._displayLaserPointer}set displayLaserPointer(t){this._displayLaserPointer=t,t?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))}get deviceOrientationCamera(){return this._deviceOrientationCamera}get currentVRCamera(){return this._webVRready?this._webVRCamera:this._scene.activeCamera}get webVRCamera(){return this._webVRCamera}get vrDeviceOrientationCamera(){return this._vrDeviceOrientationCamera}get vrButton(){return this._btnVR}get _teleportationRequestInitiated(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated}constructor(t,e={}){this.webVROptions=e,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new o.y$,this.onAfterEnteringVRObservable=new o.y$,this.onExitingVRObservable=new o.y$,this.onControllerMeshLoadedObservable=new o.y$,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=V.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new d.P(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new d.P(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new _.Wo(.7,.7,.7),this._laserColor=new _.Wo(.7,.7,.7),this._pickedLaserColor=new _.Wo(.2,.2,1),this._pickedGazeColor=new _.Wo(0,0,1),this.onNewMeshSelected=new o.y$,this.onMeshSelectedWithController=new o.y$,this.onNewMeshPicked=new o.y$,this.onBeforeCameraTeleport=new o.y$,this.onAfterCameraTeleport=new o.y$,this.onSelectedMeshUnselected=new o.y$,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=()=>{this._moveButtonToBottomRight(),this._fullscreenVRpresenting&&this._webVRready&&this.exitVR()},this._onFullscreenChange=()=>{this._fullscreenVRpresenting=!!document.fullscreenElement,!this._fullscreenVRpresenting&&this._inputElement&&(this.exitVR(),!this._useCustomVRButton&&this._btnVR&&(this._btnVR.style.top=this._inputElement.offsetTop+this._inputElement.offsetHeight-70+"px",this._btnVR.style.left=this._inputElement.offsetLeft+this._inputElement.offsetWidth-100+"px",this._updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this._beforeRender=()=>{this._leftController&&this._leftController._activePointer&&this._castRayAndSelectObject(this._leftController),this._rightController&&this._rightController._activePointer&&this._castRayAndSelectObject(this._rightController),this._noControllerIsActive&&(this._scene.getEngine().isPointerLock||this.enableGazeEvenWhenNoPointerLock)?this._castRayAndSelectObject(this._cameraGazer):this._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=t=>{if(t.type!==u.nJ.POSE_ENABLED)t.leftStick&&t.onleftstickchanged((t=>{this._teleportationInitialized&&this.teleportationEnabled&&(!this._leftController&&!this._rightController||this._leftController&&!this._leftController._activePointer&&this._rightController&&!this._rightController._activePointer)&&(this._checkTeleportWithRay(t,this._cameraGazer),this._checkTeleportBackwards(t,this._cameraGazer))})),t.rightStick&&t.onrightstickchanged((t=>{this._teleportationInitialized&&this._checkRotate(t,this._cameraGazer)})),t.type===u.nJ.XBOX&&(t.onbuttondown((t=>{this._interactionsEnabled&&t===g.nR.A&&this._cameraGazer._selectionPointerDown()})),t.onbuttonup((t=>{this._interactionsEnabled&&t===g.nR.A&&this._cameraGazer._selectionPointerUp()})));else{const e=t,i=new I(e,this._scene,this._cameraGazer._gazeTracker);"right"===e.hand||this._leftController&&this._leftController.webVRController!=e?this._rightController=i:this._leftController=i,this._tryEnableInteractionOnController(i)}},this._tryEnableInteractionOnController=t=>{this._interactionsRequested&&!t._interactionsEnabled&&this._enableInteractionOnController(t),this._teleportationRequested&&!t._teleportationEnabled&&this._enableTeleportationOnController(t)},this._onNewGamepadDisconnected=t=>{t instanceof m.T&&("left"===t.hand&&null!=this._leftController&&(this._leftController.dispose(),this._leftController=null),"right"===t.hand&&null!=this._rightController&&(this._rightController.dispose(),this._rightController=null))},this._workingVector=d.P.Zero(),this._workingQuaternion=d._f.Identity(),this._workingMatrix=d.y3.Identity(),s.Y.Warn("WebVR is deprecated. Please avoid using this experience helper and use the WebXR experience helper instead"),this._scene=t,this._inputElement=t.getEngine().getInputElement();if("getVRDisplays"in navigator||void 0!==e.useXR||(e.useXR=!0),void 0===e.createFallbackVRDeviceOrientationFreeCamera&&(e.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===e.createDeviceOrientationCamera&&(e.createDeviceOrientationCamera=!0),void 0===e.laserToggle&&(e.laserToggle=!0),void 0===e.defaultHeight&&(e.defaultHeight=1.7),e.useCustomVRButton&&(this._useCustomVRButton=!0,e.customVRButton&&(this._btnVR=e.customVRButton)),e.rayLength&&(this._rayLength=e.rayLength),this._defaultHeight=e.defaultHeight,e.positionScale&&(this._rayLength*=e.positionScale,this._defaultHeight*=e.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new d.P(0,this._defaultHeight,0),e.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new a.n("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof r.C&&this._scene.activeCamera.rotation)){const t=this._scene.activeCamera;t.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(t.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(d._f.RotationYawPitchRoll(t.rotation.y,t.rotation.x,t.rotation.z)),this._deviceOrientationCamera.rotation=t.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?w.g.IsSessionSupportedAsync("immersive-vr").then((i=>{i?(s.Y.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),t.createDefaultXRExperienceAsync({floorMeshes:e.floorMeshes||[]}).then((e=>{this.xr=e,this.xrTestDone=!0,this._cameraGazer=new E((()=>this.xr.baseExperience.camera),t),this.xr.baseExperience.onStateChangedObservable.add((t=>{switch(t){case O.k.ENTERING_XR:this.onEnteringVRObservable.notifyObservers(this),this._interactionsEnabled||this.xr.pointerSelection.detach(),this.xr.pointerSelection.displayLaserPointer=this._displayLaserPointer;break;case O.k.EXITING_XR:this.onExitingVRObservable.notifyObservers(this),this._scene.getEngine().resize();break;case O.k.IN_XR:this._hasEnteredVR=!0;break;case O.k.NOT_IN_XR:this._hasEnteredVR=!1}}))}))):this._completeVRInit(t,e)})):this._completeVRInit(t,e)}_completeVRInit(t,e){if(this.xrTestDone=!0,e.createFallbackVRDeviceOrientationFreeCamera&&(e.useMultiview&&(e.vrDeviceOrientationCameraMetrics||(e.vrDeviceOrientationCameraMetrics=x.X.GetDefault()),e.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new h.i("VRDeviceOrientationVRHelper",this._position,this._scene,!0,e.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new l.$("WebVRHelper",this._position,this._scene,e),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new E((()=>this.currentVRCamera),t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";let t=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";t+=".babylonVRicon.vrdisplaypresenting { display: none; }";const e=document.createElement("style");e.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(e),this._moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",(()=>{this.isInVRMode?this._scene.getEngine().disableVR():this.enterVR()}));const i=this._scene.getEngine().getHostWindow();i&&(i.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),e.createFallbackVRDeviceOrientationFreeCamera?this._displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add((t=>{t.vrDisplay&&this._displayVRButton()})),this._onKeyDown=t=>{27===t.keyCode&&this.isInVRMode&&this.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add((()=>{this._hasEnteredVR&&this.exitVROnDoubleTap&&(this.exitVR(),this._fullscreenVRpresenting&&this._scene.getEngine().exitFullscreen())}),c.kD.POINTERDOUBLETAP,!1),this._onVRDisplayChangedBind=t=>this._onVRDisplayChanged(t),this._onVrDisplayPresentChangeBind=()=>this._onVrDisplayPresentChange(),this._onVRRequestPresentStart=()=>{this._webVRrequesting=!0,this._updateButtonVisibility()},this._onVRRequestPresentComplete=()=>{this._webVRrequesting=!1,this._updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChangedBind),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),i.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),t.onDisposeObservable.add((()=>{this.dispose()})),this._webVRCamera.onControllerMeshLoadedObservable.add((t=>this._onDefaultMeshLoaded(t))),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this._updateButtonVisibility(),this._circleEase=new v.qP,this._circleEase.setEasingMode(v.Kp.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,t.onPointerObservable.add((e=>{this._interactionsEnabled&&t.activeCamera===this.vrDeviceOrientationCamera&&"mouse"===e.event.pointerType&&(e.type===c.kD.POINTERDOWN?this._cameraGazer._selectionPointerDown():e.type===c.kD.POINTERUP&&this._cameraGazer._selectionPointerUp())})),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))}_onDefaultMeshLoaded(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(t){s.Y.Warn("Error in your custom logic onControllerMeshLoaded: "+t)}}get isInVRMode(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===O.k.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting}_onVrDisplayPresentChange(){const t=this._scene.getEngine().getVRDevice();if(t){const e=this._webVRpresenting;this._webVRpresenting=t.isPresenting,e&&!this._webVRpresenting&&this.exitVR()}else s.Y.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this._updateButtonVisibility()}_onVRDisplayChanged(t){this._webVRsupported=t.vrSupported,this._webVRready=!!t.vrDisplay,this._webVRpresenting=t.vrDisplay&&t.vrDisplay.isPresenting,this._updateButtonVisibility()}_moveButtonToBottomRight(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){const t=this._inputElement.getBoundingClientRect();this._btnVR.style.top=t.top+t.height-70+"px",this._btnVR.style.left=t.left+t.width-100+"px"}}_displayVRButton(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)}_updateButtonVisibility(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))}enterVR(){if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(t){s.Y.Warn("Error in your custom logic onEnteringVR: "+t)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=d._f.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){const t=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,e=d._f.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-t,i=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=d._f.FromEulerAngles(0,i+e,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce((t=>{this.onAfterEnteringVRObservable.notifyObservers({success:t})})),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this._updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce((()=>{this.onAfterEnteringVRObservable.notifyObservers({success:!0})}))),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this._beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach((t=>{t&&t._activatePointer()})),this._hasEnteredVR=!0)}}exitVR(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(t){s.Y.Warn("Error in your custom logic onExitingVR: "+t)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this._updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this._beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach((t=>{t&&t._deactivatePointer()})),this._hasEnteredVR=!1;const t=this._scene.getEngine();t._onVrDisplayPresentChange&&t._onVrDisplayPresentChange()}}get position(){return this._position}set position(t){this._position=t,this._scene.activeCamera&&(this._scene.activeCamera.position=t)}enableInteractions(){if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr)return void(this.xr.baseExperience.state===O.k.IN_XR&&this.xr.pointerSelection.attach());this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=t=>t.isVisible&&(t.isPickable||t.name===this._floorMeshName),this.meshSelectionPredicate=()=>!0,this._raySelectionPredicate=t=>!!(this._isTeleportationFloor(t)||-1===t.name.indexOf("gazeTracker")&&-1===t.name.indexOf("teleportationTarget")&&-1===t.name.indexOf("torusTeleportation"))&&this.raySelectionPredicate(t),this._interactionsEnabled=!0}}get _noControllerIsActive(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)}_isTeleportationFloor(t){for(let e=0;e<this._floorMeshesCollection.length;e++)if(this._floorMeshesCollection[e].id===t.id)return!0;return!(!this._floorMeshName||t.name!==this._floorMeshName)}addFloorMesh(t){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(t)>-1||this._floorMeshesCollection.push(t))}removeFloorMesh(t){if(!this._floorMeshesCollection)return;const e=this._floorMeshesCollection.indexOf(t);-1!==e&&this._floorMeshesCollection.splice(e,1)}enableTeleportation(t={}){if(!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(t.floorMeshes||t.floorMeshName)){const e=t.floorMeshes||[];if(!e.length){const i=this._scene.getMeshByName(t.floorMeshName);i&&e.push(i)}if(this.xr)return e.forEach((t=>{this.xr.teleportation.addFloorMesh(t)})),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){const e=()=>{this.xrTestDone&&(this._scene.unregisterBeforeRender(e),this.xr?this.xr.teleportation.attached||this.xr.teleportation.attach():this.enableTeleportation(t))};return void this._scene.registerBeforeRender(e)}}t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),t.teleportationMode&&(this._teleportationMode=t.teleportationMode),t.teleportationTime&&t.teleportationTime>0&&(this._teleportationTime=t.teleportationTime),t.teleportationSpeed&&t.teleportationSpeed>0&&(this._teleportationSpeed=t.teleportationSpeed),void 0!==t.easingFunction&&(this._teleportationEasing=t.easingFunction),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);const e=new C.$;e.vignetteColor=new _.HE(0,0,0,0),e.vignetteEnabled=!0,this._postProcessMove=new P.z("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,e),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}}_enableInteractionOnController(t){t.webVRController.mesh&&(t._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&t._activatePointer(),this.webVROptions.laserToggle&&t.webVRController.onMainButtonStateChangedObservable.add((e=>{this._displayLaserPointer&&1===e.value&&(t._activePointer?t._deactivatePointer():t._activatePointer(),this.displayGaze&&(t._gazeTracker.isVisible=t._activePointer))})),t.webVRController.onTriggerStateChangedObservable.add((e=>{let i=t;this._noControllerIsActive&&(i=this._cameraGazer),i._pointerDownOnMeshAsked?e.value<this._padSensibilityDown&&i._selectionPointerUp():e.value>this._padSensibilityUp&&i._selectionPointerDown()})))}_checkTeleportWithRay(t,e){this._teleportationRequestInitiated&&!e._teleportationRequestInitiated||(e._teleportationRequestInitiated?Math.sqrt(t.y*t.y+t.x*t.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),e._teleportationRequestInitiated=!1):t.y<-this._padSensibilityUp&&e._dpadPressed&&(e._activatePointer(),e._teleportationRequestInitiated=!0))}_checkRotate(t,e){e._teleportationRequestInitiated||(e._rotationLeftAsked?t.x>-this._padSensibilityDown&&(e._rotationLeftAsked=!1):t.x<-this._padSensibilityUp&&e._dpadPressed&&(e._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),e._rotationRightAsked?t.x<this._padSensibilityDown&&(e._rotationRightAsked=!1):t.x>this._padSensibilityUp&&e._dpadPressed&&(e._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))}_checkTeleportBackwards(t,e){if(!e._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&e._dpadPressed){if(!e._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;let t=d._f.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),i=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(t=this.currentVRCamera.deviceRotationQuaternion,i=this.currentVRCamera.devicePosition),t.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,d._f.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),d.P.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);const s=new y.z(i,this._workingVector),o=this._scene.pickWithRay(s,this._raySelectionPredicate);o&&o.pickedPoint&&o.pickedMesh&&this._isTeleportationFloor(o.pickedMesh)&&o.distance<5&&this.teleportCamera(o.pickedPoint),e._teleportationBackRequestInitiated=!0}}else e._teleportationBackRequestInitiated=!1}_enableTeleportationOnController(t){t.webVRController.mesh&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===p.wc.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add((e=>{t._dpadPressed=e.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)}))),t.webVRController.onPadValuesChangedObservable.add((e=>{this.teleportationEnabled&&(this._checkTeleportBackwards(e,t),this._checkTeleportWithRay(e,t)),this._checkRotate(e,t)})))}_createTeleportationCircles(){this._teleportationTarget=(0,D.$6)("teleportationTarget",{width:2,height:2,subdivisions:2},this._scene),this._teleportationTarget.isPickable=!1;const t=new b.c("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;const e=t.getContext();e.beginPath(),e.arc(256,256,200,0,2*Math.PI,!1),e.fillStyle=this._teleportationFillColor,e.fill(),e.lineWidth=10,e.strokeStyle=this._teleportationBorderColor,e.stroke(),e.closePath(),t.update();const i=new R.K("TextPlaneMaterial",this._scene);i.diffuseTexture=t,this._teleportationTarget.material=i;const s=(0,S.eu)("torusTeleportation",{diameter:.75,thickness:.1,tessellation:25,updatable:!1},this._scene);s.isPickable=!1,s.parent=this._teleportationTarget;const o=new T.f("animationInnerCircle","position.y",30,T.f.ANIMATIONTYPE_FLOAT,T.f.ANIMATIONLOOPMODE_CYCLE),n=[];n.push({frame:0,value:0}),n.push({frame:30,value:.4}),n.push({frame:60,value:0}),o.setKeys(n);const r=new v.bi;r.setEasingMode(v.Kp.EASINGMODE_EASEINOUT),o.setEasingFunction(r),s.animations=[],s.animations.push(o),this._scene.beginAnimation(s,0,60,!0),this._hideTeleportationTarget()}_displayTeleportationTarget(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))}_hideTeleportationTarget(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))}_rotateCamera(t){if(!(this.currentVRCamera instanceof n.c))return;t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];const e=d._f.FromRotationMatrix(d.y3.RotationY(Math.PI/4*this._rotationAngle)),i=new T.f("animationRotation","rotationQuaternion",90,T.f.ANIMATIONTYPE_QUATERNION,T.f.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),s.push({frame:6,value:e}),i.setKeys(s),i.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(i),this._postProcessMove.animations=[];const o=new T.f("animationPP","vignetteWeight",90,T.f.ANIMATIONTYPE_FLOAT,T.f.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:0}),r.push({frame:3,value:4}),r.push({frame:6,value:0}),o.setKeys(r),o.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(o);const a=new T.f("animationPP2","vignetteStretch",90,T.f.ANIMATIONTYPE_FLOAT,T.f.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:3,value:10}),h.push({frame:6,value:0}),a.setKeys(h),a.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(a),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,(()=>{this._webVRCamera.detachPostProcess(this._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}_moveTeleportationSelectorTo(t,e,i){if(t.pickedPoint){e._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));const s=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),i);if(s){const t=d.P.Cross(M.RD.Y,s),e=d.P.Cross(s,t);d.P.RotationFromAxisToRef(e,s,t,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}}teleportCamera(t){if(!(this.currentVRCamera instanceof n.c))return;this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector);let e,i;if(this._teleportationMode==V.TELEPORTATIONMODE_CONSTANTSPEED){i=90;const t=d.P.Distance(this.currentVRCamera.position,this._workingVector);e=this._teleportationSpeed/t}else i=Math.round(90*this._teleportationTime/1e3),e=1;this.currentVRCamera.animations=[];const s=new T.f("animationCameraTeleportation","position",90,T.f.ANIMATIONTYPE_VECTOR3,T.f.ANIMATIONLOOPMODE_CONSTANT),o=[{frame:0,value:this.currentVRCamera.position},{frame:i,value:this._workingVector}];s.setKeys(o),s.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(s),this._postProcessMove.animations=[];const r=Math.round(i/2),a=new T.f("animationPP","vignetteWeight",90,T.f.ANIMATIONTYPE_FLOAT,T.f.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:r,value:8}),h.push({frame:i,value:0}),a.setKeys(h),this._postProcessMove.animations.push(a);const l=new T.f("animationPP2","vignetteStretch",90,T.f.ANIMATIONTYPE_FLOAT,T.f.ANIMATIONLOOPMODE_CONSTANT),c=[];c.push({frame:0,value:0}),c.push({frame:r,value:10}),c.push({frame:i,value:0}),l.setKeys(c),this._postProcessMove.animations.push(l),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,i,!1,e,(()=>{this._webVRCamera.detachPostProcess(this._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,i,!1,e,(()=>{this.onAfterCameraTeleport.notifyObservers(this._workingVector)})),this._hideTeleportationTarget()}_convertNormalToDirectionOfRay(t,e){if(t){Math.acos(d.P.Dot(t,e.direction))<Math.PI/2&&t.scaleInPlace(-1)}return t}_castRayAndSelectObject(t){if(!(this.currentVRCamera instanceof n.c))return;const e=t._getForwardRay(this._rayLength),i=this._scene.pickWithRay(e,this._raySelectionPredicate);if(i&&this._scene.simulatePointerMove(i,{pointerId:t._id}),t._currentHit=i,i&&i.pickedPoint){if(this._displayGaze){let s=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(s=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=i.distance*s,t._gazeTracker.scaling.y=i.distance*s,t._gazeTracker.scaling.z=i.distance*s);const o=this._convertNormalToDirectionOfRay(i.getNormal(),e),n=.002;if(o){const e=d.P.Cross(M.RD.Y,o),i=d.P.Cross(o,e);d.P.RotationFromAxisToRef(i,o,e,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(i.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=n:t._gazeTracker.position.x-=n,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=n:t._gazeTracker.position.y-=n,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=n:t._gazeTracker.position.z-=n}t._updatePointerDistance(i.distance)}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(i&&i.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(i.pickedMesh)&&i.pickedPoint)return t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,void(t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(i,t,e));if(i.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(i.pickedMesh)){this.onNewMeshPicked.notifyObservers(i),t._currentMeshSelected=i.pickedMesh,i.pickedMesh.isPickable&&i.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),t._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(i.pickedMesh);const e=t;e.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:i.pickedMesh,controller:e.webVRController})}catch(t){s.Y.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+t)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}_notifySelectedMeshUnselected(t){t&&this.onSelectedMeshUnselected.notifyObservers(t)}setLaserColor(t,e=this._pickedLaserColor){this._laserColor=t,this._pickedLaserColor=e}setLaserLightingState(t=!0){this._leftController&&this._leftController._setLaserPointerLightingDisabled(!t),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!t)}setGazeColor(t,e=this._pickedGazeColor){this._gazeColor=t,this._pickedGazeColor=e}changeLaserColor(t){this.updateControllerLaserColor&&(this._leftController&&this._leftController._setLaserPointerColor(t),this._rightController&&this._rightController._setLaserPointerColor(t))}changeGazeColor(t){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=t,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=t),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=t))}dispose(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection.length=0,document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChangedBind),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this._beforeRender)}getClassName(){return"VRExperienceHelper"}}V.TELEPORTATIONMODE_CONSTANTTIME=0,V.TELEPORTATIONMODE_CONSTANTSPEED=1},58705:(t,e,i)=>{i.d(e,{$:()=>m});var s=i(62897),o=i(78098),n=i(2055),r=i(58095),a=i(34987),h=i(94557),l=i(17834),c=i(51356),d=i(84318),_=i(43792),u=i(13514),p=i(51345);i(99986);l.N.AddNodeConstructor("WebVRFreeCamera",((t,e)=>()=>new m(t,r.P.Zero(),e))),l.N.AddNodeConstructor("WebVRGamepadCamera",((t,e)=>()=>new m(t,r.P.Zero(),e)));class m extends o.c{constructor(t,e,i,o={}){super(t,e,i),this._webVROptions=o,this._vrDevice=null,this.rawPose=null,this._specsVersion="1.1",this._attached=!1,this._descendants=[],this._deviceRoomPosition=r.P.Zero(),this._deviceRoomRotationQuaternion=r._f.Identity(),this._standingMatrix=null,this.devicePosition=r.P.Zero(),this.deviceRotationQuaternion=r._f.Identity(),this.deviceScaleFactor=1,this._deviceToWorld=r.y3.Identity(),this._worldToDevice=r.y3.Identity(),this.controllers=[],this.onControllersAttachedObservable=new s.y$,this.onControllerMeshLoadedObservable=new s.y$,this.onPoseUpdatedFromDeviceObservable=new s.y$,this._poseSet=!1,this.rigParenting=!0,this._defaultHeight=void 0,this._setRigMode=p.j.bind(null,this),this._detachIfAttached=()=>{const t=this.getEngine().getVRDevice();t&&!t.isPresenting&&this.detachControl()},this._workingVector=r.P.Zero(),this._oneVector=r.P.One(),this._workingMatrix=r.y3.Identity(),this._tmpMatrix=new r.y3,this._cache.position=r.P.Zero(),o.defaultHeight&&(this._defaultHeight=o.defaultHeight,this.position.y=this._defaultHeight),this.minZ=.1,5===arguments.length&&(this._webVROptions=arguments[4]),null==this._webVROptions.trackPosition&&(this._webVROptions.trackPosition=!0),null==this._webVROptions.controllerMeshes&&(this._webVROptions.controllerMeshes=!0),null==this._webVROptions.defaultLightingOnControllers&&(this._webVROptions.defaultLightingOnControllers=!0),this.rotationQuaternion=new r._f,this._webVROptions&&this._webVROptions.positionScale&&(this.deviceScaleFactor=this._webVROptions.positionScale);const a=this.getEngine();this._onVREnabled=t=>{t&&this.initControllers()},a.onVRRequestPresentComplete.add(this._onVREnabled),a.initWebVR().add((t=>{t.vrDisplay&&this._vrDevice!==t.vrDisplay&&(this._vrDevice=t.vrDisplay,this.setCameraRigMode(n.V.RIG_MODE_WEBVR,{parentCamera:this,vrDisplay:this._vrDevice,frameData:this._frameData,specs:this._specsVersion}),this._attached&&this.getEngine().enableVR(this._webVROptions))})),"undefined"!=typeof VRFrameData&&(this._frameData=new VRFrameData),o.useMultiview&&(this.getScene().getEngine().getCaps().multiview?(this._useMultiviewToSingleView=!0,this._rigPostProcess=new _.E("VRMultiviewToSingleview",this,1)):(d.Y.Warn("Multiview is not supported, falling back to standard rendering"),this._useMultiviewToSingleView=!1)),this.getScene().onBeforeCameraRenderObservable.add((t=>{t.parent===this&&this.rigParenting&&(this._descendants=this.getDescendants(!0,(t=>{const e=this.controllers.some((e=>e._mesh===t)),i=-1!==this._rigCameras.indexOf(t);return!e&&!i})),this._descendants.forEach((e=>{e.parent=t})))})),this.getScene().onAfterCameraRenderObservable.add((t=>{t.parent===this&&this.rigParenting&&this._descendants.forEach((t=>{t.parent=this}))}))}deviceDistanceToRoomGround(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0}useStandingMatrix(t=(t=>{})){this.getEngine().initWebVRAsync().then((e=>{e.vrDisplay&&e.vrDisplay.stageParameters&&e.vrDisplay.stageParameters.sittingToStandingTransform&&this._webVROptions.trackPosition?(this._standingMatrix=new r.y3,r.y3.FromFloat32ArrayToRefScaled(e.vrDisplay.stageParameters.sittingToStandingTransform,0,1,this._standingMatrix),this.getScene().useRightHandedSystem||this._standingMatrix&&this._standingMatrix.toggleModelMatrixHandInPlace(),t(!0)):t(!1)}))}useStandingMatrixAsync(){return new Promise((t=>{this.useStandingMatrix((e=>{t(e)}))}))}dispose(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),super.dispose()}getControllerByName(t){for(const e of this.controllers)if(e.hand===t)return e;return null}get leftController(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController}get rightController(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController}getForwardRay(t=100){return this.leftCamera?super.getForwardRay(t,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):super.getForwardRay(t)}_checkInputs(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),super._checkInputs()}updateFromDevice(t){t&&t.orientation&&4===t.orientation.length&&(this.rawPose=t,this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this._webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)}attachControl(t){t=u.w1.BackCompatCameraNoPreventDefault(arguments),super.attachControl(t),this._attached=!0,t=!n.V.ForceAttachControlToAlwaysPreventDefault&&t,this._vrDevice&&this.getEngine().enableVR(this._webVROptions);const e=this._scene.getEngine().getHostWindow();e&&e.addEventListener("vrdisplaypresentchange",this._detachIfAttached)}detachControl(){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),super.detachControl(),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)}getClassName(){return"WebVRFreeCamera"}resetToCurrentRotation(){this._vrDevice.resetPose()}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),t.position.copyFrom(this._deviceRoomPosition),e.position.copyFrom(this._deviceRoomPosition)}_correctPositionIfNotTrackPosition(t,e=!1){this.rawPose&&this.rawPose.position&&!this._webVROptions.trackPosition&&(r.y3.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),e||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(t,t))}_updateCache(t){this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this._updateCacheCalled||(this._updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),r.P.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),r.y3.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach((t=>{t._deviceToWorld.copyFrom(this._deviceToWorld),this._correctPositionIfNotTrackPosition(t._deviceToWorld),t.update()}))),t||super._updateCache(),this._updateCacheCalled=!1}_computeDevicePosition(){r.P.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)}update(){this._computeDevicePosition(),r.y3.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),r._f.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),super.update()}_getViewMatrix(){return r.y3.Identity()}_getWebVRViewMatrix(){const t=this._cameraRigParams.parentCamera;t._updateCache();const e=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return r.y3.FromArrayToRef(e,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),r.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==t.deviceScaleFactor&&(this._webvrViewMatrix.invert(),t.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,t.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,t.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,t.deviceScaleFactor)),this._webvrViewMatrix.invert()),t._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),t._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||r.y3.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(t.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix}_getWebVRProjectionMatrix(){const t=this.parent;t._vrDevice.depthNear=t.minZ,t._vrDevice.depthFar=t.maxZ;const e=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return r.y3.FromArrayToRef(e,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix}initControllers(){this.controllers.length=0;const t=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add((t=>{if(t.type===a.nJ.POSE_ENABLED){const e=t;e.defaultModel&&e.defaultModel.setEnabled(!1),"right"===e.hand&&(this._rightController=null),"left"===e.hand&&(this._leftController=null);const i=this.controllers.indexOf(e);-1!==i&&this.controllers.splice(i,1)}})),this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add((t=>{if(t.type===a.nJ.POSE_ENABLED){const e=t;if(this._webVROptions.trackPosition||(e._disableTrackPosition(new r.P("left"==e.hand?-.15:.15,-.5,.25)),this._updateCacheWhenTrackingDisabledObserver||(this._updateCacheWhenTrackingDisabledObserver=this._scene.onBeforeRenderObservable.add((()=>{this._updateCache()})))),e.deviceScaleFactor=this.deviceScaleFactor,e._deviceToWorld.copyFrom(this._deviceToWorld),this._correctPositionIfNotTrackPosition(e._deviceToWorld),this._webVROptions.controllerMeshes&&(e.defaultModel?e.defaultModel.setEnabled(!0):e.initControllerMesh(this.getScene(),(t=>{if(t.scaling.scaleInPlace(this.deviceScaleFactor),this.onControllerMeshLoadedObservable.notifyObservers(e),this._webVROptions.defaultLightingOnControllers){this._lightOnControllers||(this._lightOnControllers=new c.e("vrControllersLight",new r.P(0,1,0),this.getScene()));const e=function(t,i){const s=t.getChildren();s&&0!==s.length&&s.forEach((t=>{i.includedOnlyMeshes.push(t),e(t,i)}))};this._lightOnControllers.includedOnlyMeshes.push(t),e(t,this._lightOnControllers)}}))),e.attachToPoseControlledCamera(this),-1===this.controllers.indexOf(e)){this.controllers.push(e);let t=!1;for(let e=0;e<this.controllers.length;e++)this.controllers[e].controllerType===h.wc.VIVE&&(t?this.controllers[e].hand="right":(t=!0,this.controllers[e].hand="left"));this.controllers.length>=2&&this.onControllersAttachedObservable.notifyObservers(this.controllers)}}}))}}},78443:(t,e,i)=>{i.d(e,{Y:()=>f});var s=i(72433),o=i(96969),n=i(62897),r=i(58095),a=i(17834),h=i(91243),l=i(93008),c=i(97391),d=i(81989),_=i(2055),u=i(86121),p=i(50532),m=i(48154),g=i(13514);a.N.AddNodeConstructor("ArcRotateCamera",((t,e)=>()=>new f(t,0,0,1,r.P.Zero(),e)));class f extends u.C{get target(){return this._target}set target(t){this.setTarget(t)}get targetHost(){return this._targetHost}set targetHost(t){t&&this.setTarget(t)}getTarget(){return this.target}get position(){return this._position}set position(t){this.setPosition(t)}set upVector(t){this._upToYMatrix||(this._yToUpMatrix=new r.y3,this._upToYMatrix=new r.y3,this._upVector=r.P.Zero()),t.normalize(),this._upVector.copyFrom(t),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){r.y3.RotationAlignToRef(r.P.UpReadOnly,this._upVector,this._yToUpMatrix),r.y3.RotationAlignToRef(this._upVector,r.P.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set angularSensibilityX(t){const e=this.inputs.attached.pointers;e&&(e.angularSensibilityX=t)}get angularSensibilityY(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set angularSensibilityY(t){const e=this.inputs.attached.pointers;e&&(e.angularSensibilityY=t)}get pinchPrecision(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set pinchPrecision(t){const e=this.inputs.attached.pointers;e&&(e.pinchPrecision=t)}get pinchDeltaPercentage(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set pinchDeltaPercentage(t){const e=this.inputs.attached.pointers;e&&(e.pinchDeltaPercentage=t)}get useNaturalPinchZoom(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set useNaturalPinchZoom(t){const e=this.inputs.attached.pointers;e&&(e.useNaturalPinchZoom=t)}get panningSensibility(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set panningSensibility(t){const e=this.inputs.attached.pointers;e&&(e.panningSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const e=this.inputs.attached.keyboard;e&&(e.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const e=this.inputs.attached.keyboard;e&&(e.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRight=t)}get wheelPrecision(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set wheelPrecision(t){const e=this.inputs.attached.mousewheel;e&&(e.wheelPrecision=t)}get zoomToMouseLocation(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set zoomToMouseLocation(t){const e=this.inputs.attached.mousewheel;e&&(e.zoomToMouseLocation=t)}get wheelDeltaPercentage(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set wheelDeltaPercentage(t){const e=this.inputs.attached.mousewheel;e&&(e.wheelDeltaPercentage=t)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new c.r,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new d.d,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new l.o,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(t,e,i,s,o,a,h=!0){super(t,r.P.Zero(),a,h),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=r.P.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=r.FM.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this._viewMatrix=new r.y3,this.panningAxis=new r.P(1,1,0),this._transformedDirection=new r.P,this.mapPanning=!1,this.onMeshTargetChangedObservable=new n.y$,this.checkCollisions=!1,this.collisionRadius=new r.P(.5,.5,.5),this._previousPosition=r.P.Zero(),this._collisionVelocity=r.P.Zero(),this._newPosition=r.P.Zero(),this._computationVector=r.P.Zero(),this._onCollisionPositionChange=(t,e,i=null)=>{i?(this.setPosition(e),this.onCollide&&this.onCollide(i)):this._previousPosition.copyFrom(this._position);const s=Math.cos(this.alpha),o=Math.sin(this.alpha),n=Math.cos(this.beta);let r=Math.sin(this.beta);0===r&&(r=1e-4);const a=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*s*r,this.radius*n,this.radius*o*r),a.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let h=this.upVector;this.allowUpsideDown&&this.beta<0&&(h=h.clone(),h=h.negate()),this._computeViewMatrix(this._position,a,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=r.P.Zero(),o&&this.setTarget(o),this.alpha=e,this.beta=i,this.radius=s,this.getViewMatrix(),this.inputs=new p.$(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=r.FM.Zero()}_updateCache(t){t||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}const t=this._getLockedTargetPosition();return t||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(t,e,i=!0,s=2){const o=arguments;e=g.w1.BackCompatCameraNoPreventDefault(o),this._useCtrlForPanning=i,this._panningMouseButton=s,"boolean"==typeof o[0]&&(o.length>1&&(this._useCtrlForPanning=o[1]),o.length>2&&(this._panningMouseButton=o[2])),this.inputs.attachElement(e),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const t=this.invertRotation?-1:1;let e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e*t,this.beta+=this.inertialBetaOffset*t,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<m.kn&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<m.kn&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*m.kn&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const t=new r.P(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),t.multiplyInPlace(this.panningAxis),r.P.TransformNormalToRef(t,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);r.P.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*m.kn&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*m.kn&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||r.P.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const t=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const e=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*e*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(t){this._position.equals(t)||(this._position.copyFrom(t),this.rebuildAnglesAndRadius())}setTarget(t,e=!1,i=!1,s=!1){var o;if(s=null!==(o=this.overrideCloneAlphaBetaRadius)&&void 0!==o?o:s,t.getBoundingInfo)this._targetBoundingCenter=e?t.getBoundingInfo().boundingBox.centerWorld.clone():null,t.computeWorldMatrix(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const e=t,s=this._getTargetPosition();if(s&&!i&&s.equals(e))return;this._targetHost=null,this._target=e,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}s||this.rebuildAnglesAndRadius()}_getViewMatrix(){const t=Math.cos(this.alpha),e=Math.sin(this.alpha),i=Math.cos(this.beta);let s=Math.sin(this.beta);0===s&&(s=1e-4),0===this.radius&&(this.radius=1e-4);const o=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*s,this.radius*i,this.radius*e*s),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||r.P.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),o.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let t=this.upVector;this.allowUpsideDown&&s<0&&(t=t.negate()),this._computeViewMatrix(this._position,o,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=o,this._viewMatrix}zoomOn(t,e=!1){t=t||this.getScene().meshes;const i=h.Kj.MinMax(t),s=r.P.Distance(i.min,i.max);this.radius=s*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:s},e)}focusOn(t,e=!1){let i,s;if(void 0===t.min){const e=t||this.getScene().meshes;i=h.Kj.MinMax(e),s=r.P.Distance(i.min,i.max)}else{i=t,s=t.distance}this._target=h.Kj.Center(i),e||(this.maxZ=2*s)}createRigCamera(t,e){let i=0;switch(this.cameraRigMode){case _.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case _.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case _.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case _.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case _.V.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===e?1:-1);break;case _.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===e?-1:1)}const s=new f(t,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return s._cameraRigParams={},s.isRigCamera=!0,s.rigParent=this,s.upVector=this.upVector,s.mode=this.mode,s.orthoLeft=this.orthoLeft,s.orthoRight=this.orthoRight,s.orthoBottom=this.orthoBottom,s.orthoTop=this.orthoTop,s}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];switch(t.beta=e.beta=this.beta,this.cameraRigMode){case _.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case _.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case _.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case _.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case _.V.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case _.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,s.gn)([(0,o.qC)()],f.prototype,"alpha",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"beta",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"radius",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,s.gn)([(0,o.hd)("target")],f.prototype,"_target",void 0),(0,s.gn)([(0,o.RR)("targetHost")],f.prototype,"_targetHost",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"inertialAlphaOffset",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"inertialBetaOffset",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"inertialRadiusOffset",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"lowerAlphaLimit",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"upperAlphaLimit",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"lowerBetaLimit",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"upperBetaLimit",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"lowerRadiusLimit",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"upperRadiusLimit",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"inertialPanningX",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"inertialPanningY",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"pinchToPanMaxDistance",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"panningDistanceLimit",void 0),(0,s.gn)([(0,o.hd)()],f.prototype,"panningOriginTarget",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"panningInertia",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"zoomToMouseLocation",null),(0,s.gn)([(0,o.qC)()],f.prototype,"zoomOnFactor",void 0),(0,s.gn)([(0,o.QC)()],f.prototype,"targetScreenOffset",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"allowUpsideDown",void 0),(0,s.gn)([(0,o.qC)()],f.prototype,"useInputToRestoreState",void 0)},50532:(t,e,i)=>{i.d(e,{$:()=>a});var s=i(75105),o=i(34286),n=i(20462),r=i(73321);class a extends r.p{constructor(t){super(t)}addMouseWheel(){return this.add(new n.F),this}addPointers(){return this.add(new s.H),this}addKeyboard(){return this.add(new o.v),this}}},2055:(t,e,i)=>{i.d(e,{V:()=>m});var s=i(72433),o=i(96969),n=i(7788),r=i(13514),a=i(62897),h=i(58095),l=i(17834),c=i(84318),d=i(48620),_=i(77851),u=i(66513),p=i(84319);class m extends l.N{get position(){return this._position}set position(t){this._position=t}set upVector(t){this._upVector=t}get upVector(){return this._upVector}get screenArea(){var t,e,i,s;let o=0,n=0;if(this.mode===m.PERSPECTIVE_CAMERA)this.fovMode===m.FOVMODE_VERTICAL_FIXED?(n=2*this.minZ*Math.tan(this.fov/2),o=this.getEngine().getAspectRatio(this)*n):(o=2*this.minZ*Math.tan(this.fov/2),n=o/this.getEngine().getAspectRatio(this));else{const r=this.getEngine().getRenderWidth()/2,a=this.getEngine().getRenderHeight()/2;o=(null!==(t=this.orthoRight)&&void 0!==t?t:r)-(null!==(e=this.orthoLeft)&&void 0!==e?e:-r),n=(null!==(i=this.orthoTop)&&void 0!==i?i:a)-(null!==(s=this.orthoBottom)&&void 0!==s?s:-a)}return o*n}set orthoLeft(t){this._orthoLeft=t;for(const e of this._rigCameras)e.orthoLeft=t}get orthoLeft(){return this._orthoLeft}set orthoRight(t){this._orthoRight=t;for(const e of this._rigCameras)e.orthoRight=t}get orthoRight(){return this._orthoRight}set orthoBottom(t){this._orthoBottom=t;for(const e of this._rigCameras)e.orthoBottom=t}get orthoBottom(){return this._orthoBottom}set orthoTop(t){this._orthoTop=t;for(const e of this._rigCameras)e.orthoTop=t}get orthoTop(){return this._orthoTop}set mode(t){this._mode=t;for(const e of this._rigCameras)e.mode=t}get mode(){return this._mode}constructor(t,e,i,s=!0){super(t,i),this._position=h.P.Zero(),this._upVector=h.P.Up(),this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=m.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new u.l(0,0,1,1),this.layerMask=268435455,this.fovMode=m.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=m.RIG_MODE_NONE,this.customRenderTargets=new Array,this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new a.y$,this.onProjectionMatrixChangedObservable=new a.y$,this.onAfterCheckInputsObservable=new a.y$,this.onRestoreStateObservable=new a.y$,this.isRigCamera=!1,this._rigCameras=new Array,this._webvrViewMatrix=h.y3.Identity(),this._skipRendering=!1,this._projectionMatrix=new h.y3,this._postProcesses=new Array,this._activeMeshes=new n.t(256),this._globalPosition=h.P.Zero(),this._computedViewMatrix=h.y3.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=h.y3.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=h._f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),s&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=e,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${t}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Camera"}toString(t){let e="Name: "+this.name;if(e+=", type: "+this.getClassName(),this.animations)for(let i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e}applyVerticalCorrection(){const t=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-t.x:t.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(t){return-1!==this._activeMeshes.indexOf(t)}isReady(t=!1){if(t)for(const t of this._postProcesses)if(t&&!t.isReady())return!1;return super.isReady(t)}_initCache(){super._initCache(),this._cache.position=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(t){t||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;const e=this.getEngine();return t=this.mode===m.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===e.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===e.getRenderWidth()&&this._cache.renderHeight===e.getRenderHeight(),t}attachControl(t,e){}detachControl(t){}update(){this._checkInputs(),this.cameraRigMode!==m.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let t=0;t<this._postProcesses.length;t++)if(null!==this._postProcesses[t])return this._postProcesses[t];return null}_cascadePostProcessesToRigCams(){const t=this._getFirstPostProcess();t&&t.markTextureDirty();for(let t=0,e=this._rigCameras.length;t<e;t++){const e=this._rigCameras[t],i=e._rigPostProcess;if(i){"pass"===i.getEffectName()&&(e.isIntermediate=0===this._postProcesses.length),e._postProcesses=this._postProcesses.slice(0).concat(i),i.markTextureDirty()}else e._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(t,e=null){return!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(c.Y.Error("You're trying to reuse a post process not defined as reusable."),0):(null==e||e<0?this._postProcesses.push(t):null===this._postProcesses[e]?this._postProcesses[e]=t:this._postProcesses.splice(e,0,t),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(t))}detachPostProcess(t){const e=this._postProcesses.indexOf(t);-1!==e&&(this._postProcesses[e]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return h.y3.Identity()}getViewMatrix(t){return!t&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(t){this._doNotComputeProjectionMatrix=!0,void 0!==t&&(this._projectionMatrix=t)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(t){var e,i,s,o,n,r,a,l;if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const c=this.getEngine(),d=this.getScene(),_=c.useReverseDepthBuffer;if(this.mode===m.PERSPECTIVE_CAMERA){let t;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),t=d.useRightHandedSystem?h.y3.PerspectiveFovRHToRef:h.y3.PerspectiveFovLHToRef,t(this.fov,c.getAspectRatio(this),_?this.maxZ:this.minZ,_?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===m.FOVMODE_VERTICAL_FIXED,c.isNDCHalfZRange,this.projectionPlaneTilt,_)}else{const t=c.getRenderWidth()/2,u=c.getRenderHeight()/2;d.useRightHandedSystem?h.y3.OrthoOffCenterRHToRef(null!==(e=this.orthoLeft)&&void 0!==e?e:-t,null!==(i=this.orthoRight)&&void 0!==i?i:t,null!==(s=this.orthoBottom)&&void 0!==s?s:-u,null!==(o=this.orthoTop)&&void 0!==o?o:u,_?this.maxZ:this.minZ,_?this.minZ:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange):h.y3.OrthoOffCenterLHToRef(null!==(n=this.orthoLeft)&&void 0!==n?n:-t,null!==(r=this.orthoRight)&&void 0!==r?r:t,null!==(a=this.orthoBottom)&&void 0!==a?a:-u,null!==(l=this.orthoTop)&&void 0!==l?l:u,_?this.maxZ:this.minZ,_?this.minZ:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?p.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=p.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(t,e=!1){if(this._updateFrustumPlanes(),e&&this.rigCameras.length>0){let e=!1;return this.rigCameras.forEach((i=>{i._updateFrustumPlanes(),e=e||t.isInFrustum(i._frustumPlanes)})),e}return t.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(t=100,e,i){throw(0,_.S)("Ray")}getForwardRayToRef(t,e=100,i,s){throw(0,_.S)("Ray")}dispose(t,e=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const t=this._rigCameras.pop();t&&t.dispose()}if(this._parentContainer){const t=this._parentContainer.cameras.indexOf(this);t>-1&&this._parentContainer.cameras.splice(t,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==m.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let t=this._postProcesses.length;for(;--t>=0;){const e=this._postProcesses[t];e&&e.dispose(this)}}let i=this.customRenderTargets.length;for(;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(t,e)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(t,e){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){const t=this._rigCameras.pop();t&&t.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=e.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=r.w1.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==m.RIG_MODE_NONE){const t=this.createRigCamera(this.name+"_L",0);t&&(t._isLeftCamera=!0);const e=this.createRigCamera(this.name+"_R",1);e&&(e._isRightCamera=!0),t&&e&&(this._rigCameras.push(t),this._rigCameras.push(e))}this._setRigMode(e),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(t){}_getVRProjectionMatrix(){return h.y3.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}_updateCameraRotationMatrix(){}_updateWebVRCameraRotationMatrix(){}_getWebVRProjectionMatrix(){return h.y3.Identity()}_getWebVRViewMatrix(){return h.y3.Identity()}setCameraRigParameter(t,e){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=e,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=r.w1.ToRadians(e/.0637))}createRigCamera(t,e){return null}_updateRigCameras(){for(let t=0;t<this._rigCameras.length;t++)this._rigCameras[t].minZ=this.minZ,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.copyFrom(this.upVector);this.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const t=o.p4.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(t),this.inputs&&this.inputs.serialize(t),o.p4.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}clone(t,e=null){const i=o.p4.Clone(m.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=t,i.parent=e,this.onClonedObservable.notifyObservers(i),i}getDirection(t){const e=h.P.Zero();return this.getDirectionToRef(t,e),e}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(t,e){h.P.TransformNormalToRef(t,this.getWorldMatrix(),e)}static GetConstructorFromName(t,e,i,s=0,o=!0){const n=l.N.Construct(t,e,i,{interaxial_distance:s,isStereoscopicSideBySide:o});return n||(()=>m._CreateDefaultParsedCamera(e,i))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(t,e){const i=t.type,s=m.GetConstructorFromName(i,t.name,e,t.interaxial_distance,t.isStereoscopicSideBySide),n=o.p4.Parse(s,t,e);if(void 0!==t.parentId&&(n._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(n._waitingParentInstanceIndex=t.parentInstanceIndex),n.inputs&&(n.inputs.parse(t),n._setupInputs()),t.upVector&&(n.upVector=h.P.FromArray(t.upVector)),n.setPosition&&(n.position.copyFromFloats(0,0,0),n.setPosition(h.P.FromArray(t.position))),t.target&&n.setTarget&&n.setTarget(h.P.FromArray(t.target)),t.cameraRigMode){const e=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};n.setCameraRigMode(t.cameraRigMode,e)}if(t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],s=(0,d.q)("BABYLON.Animation");s&&n.animations.push(s.Parse(i))}l.N.ParseAnimationRanges(n,t,e)}return t.autoAnimate&&e.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&n.setEnabled(t.isEnabled),n}}m._CreateDefaultParsedCamera=(t,e)=>{throw(0,_.S)("UniversalCamera")},m.PERSPECTIVE_CAMERA=0,m.ORTHOGRAPHIC_CAMERA=1,m.FOVMODE_VERTICAL_FIXED=0,m.FOVMODE_HORIZONTAL_FIXED=1,m.RIG_MODE_NONE=0,m.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,m.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,m.RIG_MODE_STEREOSCOPIC_INTERLACED=14,m.RIG_MODE_VR=20,m.RIG_MODE_WEBVR=21,m.RIG_MODE_CUSTOM=22,m.ForceAttachControlToAlwaysPreventDefault=!1,(0,s.gn)([(0,o.hd)("position")],m.prototype,"_position",void 0),(0,s.gn)([(0,o.hd)("upVector")],m.prototype,"_upVector",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"orthoLeft",null),(0,s.gn)([(0,o.qC)()],m.prototype,"orthoRight",null),(0,s.gn)([(0,o.qC)()],m.prototype,"orthoBottom",null),(0,s.gn)([(0,o.qC)()],m.prototype,"orthoTop",null),(0,s.gn)([(0,o.qC)()],m.prototype,"fov",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"projectionPlaneTilt",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"minZ",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"maxZ",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"inertia",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"mode",null),(0,s.gn)([(0,o.qC)()],m.prototype,"layerMask",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"fovMode",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"cameraRigMode",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"interaxialDistance",void 0),(0,s.gn)([(0,o.qC)()],m.prototype,"isStereoscopicSideBySide",void 0)},73321:(t,e,i)=>{i.d(e,{p:()=>a,u:()=>r});var s=i(84318),o=i(96969),n=i(2055),r={};class a{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const e=t.getSimpleName();this.attached[e]?s.Y.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const e in this.attached){const i=this.attached[e];if(i===t)return i.detachControl(),i.camera=null,delete this.attached[e],void this.rebuildInputCheck()}}removeByType(t){for(const e in this.attached){const i=this.attached[e];i.getClassName()===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}}_addCheckInputs(t){const e=this.checkInputs;return()=>{e(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(t=!1){if(!this.attachedToElement){t=!n.V.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const e in this.attached)this.attached[e].attachControl(t)}}detachElement(t=!1){for(const e in this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const e={};for(const t in this.attached){const i=this.attached[t],s=o.p4.Serialize(i);e[i.getClassName()]=s}t.inputsmgr=e}parse(t){const e=t.inputsmgr;if(e){this.clear();for(const t in e){const i=r[t];if(i){const s=e[t],n=o.p4.Parse((()=>new i),s,null);this.add(n)}}}else for(const e in this.attached){const i=r[this.attached[e].getClassName()];if(i){const s=o.p4.Parse((()=>new i),t,null);this.remove(this.attached[e]),this.add(s)}}}}},39821:(t,e,i)=>{i.d(e,{n:()=>a});var s=i(78098),o=i(58095),n=i(17834),r=(i(39418),i(43048));n.N.AddNodeConstructor("DeviceOrientationCamera",((t,e)=>()=>new a(t,o.P.Zero(),e)));class a extends s.c{constructor(t,e,i){super(t,e,i),this._tmpDragQuaternion=new o._f,this._disablePointerInputWhenUsingDeviceOrientation=!0,this._dragFactor=0,this._quaternionCache=new o._f,this.inputs.addDeviceOrientation(),this.inputs._deviceOrientationInput&&this.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce((()=>{this._disablePointerInputWhenUsingDeviceOrientation&&this.inputs._mouseInput&&(this.inputs._mouseInput._allowCameraRotation=!1,this.inputs._mouseInput.onPointerMovedObservable.add((t=>{0!=this._dragFactor&&(this._initialQuaternion||(this._initialQuaternion=new o._f),o._f.FromEulerAnglesToRef(0,t.offsetX*this._dragFactor,0,this._tmpDragQuaternion),this._initialQuaternion.multiplyToRef(this._tmpDragQuaternion,this._initialQuaternion))})))}))}get disablePointerInputWhenUsingDeviceOrientation(){return this._disablePointerInputWhenUsingDeviceOrientation}set disablePointerInputWhenUsingDeviceOrientation(t){this._disablePointerInputWhenUsingDeviceOrientation=t}enableHorizontalDragging(t=1/300){this._dragFactor=t}getClassName(){return"DeviceOrientationCamera"}_checkInputs(){super._checkInputs(),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}resetToCurrentRotation(t=r.RD.Y){this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new o._f),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach((e=>{t[e]?this._initialQuaternion[e]*=-1:this._initialQuaternion[e]=0})),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))}}},78098:(t,e,i)=>{i.d(e,{c:()=>c});var s=i(72433),o=i(96969),n=i(58095),r=i(37290),a=i(86121),h=i(93151),l=i(13514);class c extends a.C{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const e=this.inputs.attached.keyboard;e&&(e.keysUp=t)}get keysUpward(){const t=this.inputs.attached.keyboard;return t?t.keysUpward:[]}set keysUpward(t){const e=this.inputs.attached.keyboard;e&&(e.keysUpward=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const e=this.inputs.attached.keyboard;e&&(e.keysDown=t)}get keysDownward(){const t=this.inputs.attached.keyboard;return t?t.keysDownward:[]}set keysDownward(t){const e=this.inputs.attached.keyboard;e&&(e.keysDownward=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRight=t)}get keysRotateLeft(){const t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]}set keysRotateLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysRotateLeft=t)}get keysRotateRight(){const t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]}set keysRotateRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRotateRight=t)}constructor(t,e,i,s=!0){super(t,e,i,s),this.ellipsoid=new n.P(.5,1,.5),this.ellipsoidOffset=new n.P(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=n.P.Zero(),this._diffPosition=n.P.Zero(),this._newPosition=n.P.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(t,e,i=null)=>{(t=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>r.D.CollisionsEpsilon&&(this.position.addInPlace(this._diffPosition),this.onCollide&&i&&this.onCollide(i))})(e)},this.inputs=new h.a(this),this.inputs.addKeyboard().addMouse()}attachControl(t,e){e=l.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new n.P(0,0,0),this.cameraRotation=new n.FM(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let e;e=this.parent?n.P.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,e.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let s=t;this.applyGravity&&(s=t.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,s,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=n.P.Zero(),this._transformedDirection=n.P.Zero()),this.inputs.checkInputs(),super._checkInputs()}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FreeCamera"}}(0,s.gn)([(0,o.hd)()],c.prototype,"ellipsoid",void 0),(0,s.gn)([(0,o.hd)()],c.prototype,"ellipsoidOffset",void 0),(0,s.gn)([(0,o.qC)()],c.prototype,"checkCollisions",void 0),(0,s.gn)([(0,o.qC)()],c.prototype,"applyGravity",void 0)},93151:(t,e,i)=>{i.d(e,{a:()=>h});var s=i(73321),o=i(3251),n=i(37026),r=i(99106),a=i(86009);class h extends s.p{constructor(t){super(t),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new o.Y),this}addMouse(t=!0){return this._mouseInput||(this._mouseInput=new n.A(t),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new r.A,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new a.y),this}clear(){super.clear(),this._mouseInput=null}}},94474:(t,e,i)=>{i(23402);var s=i(23592),o=(i(75537),i(34286),i(20462),i(75105),i(73321)),n=i(50532),r=i(13514);n.$.prototype.addVRDeviceOrientation=function(){return this.add(new a),this};class a{constructor(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}attachControl(t){t=r.w1.BackCompatCameraNoPreventDefault(arguments),this.camera.attachControl(t);const e=this.camera.getScene().getEngine().getHostWindow();e&&("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t?e.addEventListener("deviceorientation",this._deviceOrientationHandler):r.w1.Warn("Permission not granted.")})).catch((t=>{r.w1.Error(t)})):e.addEventListener("deviceorientation",this._deviceOrientationHandler))}_onOrientationEvent(t){null!==t.alpha&&(this._alpha=(0|+t.alpha)*this.alphaCorrection),null!==t.gamma&&(this._gamma=(0|+t.gamma)*this.gammaCorrection),this._dirty=!0}checkInputs(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)}detachControl(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)}getClassName(){return"ArcRotateCameraVRDeviceOrientationInput"}getSimpleName(){return"VRDeviceOrientation"}}o.u.ArcRotateCameraVRDeviceOrientationInput=a;var h=i(72433),l=i(96969),c=i(63737),d=i(58095);class _{constructor(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}attachControl(t){t=r.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(e.type===c.OG.KEYDOWN){if(-1!==this.keysForward.indexOf(i.keyCode)||-1!==this.keysBackward.indexOf(i.keyCode)||-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),t||i.preventDefault()}}else if(-1!==this.keysForward.indexOf(i.keyCode)||-1!==this.keysBackward.indexOf(i.keyCode)||-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),t||i.preventDefault()}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}getClassName(){return"FlyCameraKeyboardInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e],s=t._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(i)?t._localDirection.copyFromFloats(0,0,s):-1!==this.keysBackward.indexOf(i)?t._localDirection.copyFromFloats(0,0,-s):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,s,0):-1!==this.keysDown.indexOf(i)?t._localDirection.copyFromFloats(0,-s,0):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(s,0,0):-1!==this.keysLeft.indexOf(i)&&t._localDirection.copyFromFloats(-s,0,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),d.P.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}}(0,h.gn)([(0,l.qC)()],_.prototype,"keysForward",void 0),(0,h.gn)([(0,l.qC)()],_.prototype,"keysBackward",void 0),(0,h.gn)([(0,l.qC)()],_.prototype,"keysUp",void 0),(0,h.gn)([(0,l.qC)()],_.prototype,"keysDown",void 0),(0,h.gn)([(0,l.qC)()],_.prototype,"keysRight",void 0),(0,h.gn)([(0,l.qC)()],_.prototype,"keysLeft",void 0),o.u.FlyCameraKeyboardInput=_;var u=i(76324),p=i(43048);class m{constructor(){this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this._previousPosition=null}attachControl(t){t=r.w1.BackCompatCameraNoPreventDefault(arguments),this._noPreventDefault=t,this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver((t=>{this._pointerInput(t)}),u.kD.POINTERDOWN|u.kD.POINTERUP|u.kD.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add((()=>{this.camera.rollCorrect&&this.camera.restoreRoll(this.camera.rollCorrect)}))}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._observer=null,this._rollObserver=null,this._previousPosition=null,this._noPreventDefault=void 0)}getClassName(){return"FlyCameraMouseInput"}getSimpleName(){return"mouse"}_pointerInput(t){const e=t.event,i=this.camera.getEngine();if(i.isInVRExclusivePointerMode)return;if(!this.touchEnabled&&"touch"===e.pointerType)return;if(t.type!==u.kD.POINTERMOVE&&-1===this.buttons.indexOf(e.button))return;const s=e.target;if(t.type===u.kD.POINTERDOWN){try{null==s||s.setPointerCapture(e.pointerId)}catch(e){}this._previousPosition={x:e.clientX,y:e.clientY},this.activeButton=e.button,this._noPreventDefault||(e.preventDefault(),this._element.focus()),i.isPointerLock&&this._onMouseMove(t.event)}else if(t.type===u.kD.POINTERUP){try{null==s||s.releasePointerCapture(e.pointerId)}catch(e){}this.activeButton=-1,this._previousPosition=null,this._noPreventDefault||e.preventDefault()}else if(t.type===u.kD.POINTERMOVE){if(!this._previousPosition)return void(i.isPointerLock&&this._onMouseMove(t.event));const s=e.clientX-this._previousPosition.x,o=e.clientY-this._previousPosition.y;this._rotateCamera(s,o),this._previousPosition={x:e.clientX,y:e.clientY},this._noPreventDefault||e.preventDefault()}}_onMouseMove(t){const e=this.camera.getEngine();if(!e.isPointerLock||e.isInVRExclusivePointerMode)return;const i=t.movementX,s=t.movementY;this._rotateCamera(i,s),this._previousPosition=null,this._noPreventDefault||t.preventDefault()}_rotateCamera(t,e){const i=this.camera;this.camera.getScene().useRightHandedSystem&&(t*=-1),i.parent&&i.parent._getWorldMatrixDeterminant()<0&&(t*=-1);const s=t/this.angularSensibility,o=e/this.angularSensibility,n=d._f.RotationYawPitchRoll(i.rotation.y,i.rotation.x,i.rotation.z);let r;if(this.buttonsPitch.some((t=>t===this.activeButton))&&(r=d._f.RotationAxis(p.RD.X,o),n.multiplyInPlace(r)),this.buttonsYaw.some((t=>t===this.activeButton))){r=d._f.RotationAxis(p.RD.Y,s),n.multiplyInPlace(r);const t=i.bankedTurnLimit+i._trackRoll;if(i.bankedTurn&&-t<i.rotation.z&&i.rotation.z<t){const t=i.bankedTurnMultiplier*-s;r=d._f.RotationAxis(p.RD.Z,t),n.multiplyInPlace(r)}}this.buttonsRoll.some((t=>t===this.activeButton))&&(r=d._f.RotationAxis(p.RD.Z,-s),i._trackRoll-=s,n.multiplyInPlace(r)),n.toEulerAnglesToRef(i.rotation)}}(0,h.gn)([(0,l.qC)()],m.prototype,"buttons",void 0),(0,h.gn)([(0,l.qC)()],m.prototype,"angularSensibility",void 0),o.u.FlyCameraMouseInput=m;class g{constructor(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}attachControl(t){t=r.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===c.OG.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,this._shiftPressed=i.shiftKey,-1!==this.keysHeightOffsetIncr.indexOf(i.keyCode)||-1!==this.keysHeightOffsetDecr.indexOf(i.keyCode)||-1!==this.keysRotationOffsetIncr.indexOf(i.keyCode)||-1!==this.keysRotationOffsetDecr.indexOf(i.keyCode)||-1!==this.keysRadiusIncr.indexOf(i.keyCode)||-1!==this.keysRadiusDecr.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(t||i.preventDefault())}}else if(-1!==this.keysHeightOffsetIncr.indexOf(i.keyCode)||-1!==this.keysHeightOffsetDecr.indexOf(i.keyCode)||-1!==this.keysRotationOffsetIncr.indexOf(i.keyCode)||-1!==this.keysRotationOffsetDecr.indexOf(i.keyCode)||-1!==this.keysRadiusIncr.indexOf(i.keyCode)||-1!==this.keysRadiusDecr.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),i.preventDefault&&(t||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){this._onKeyboardObserver&&this._keys.forEach((t=>{-1!==this.keysHeightOffsetIncr.indexOf(t)&&this._modifierHeightOffset()?this.camera.heightOffset+=this.heightSensibility:-1!==this.keysHeightOffsetDecr.indexOf(t)&&this._modifierHeightOffset()?this.camera.heightOffset-=this.heightSensibility:-1!==this.keysRotationOffsetIncr.indexOf(t)&&this._modifierRotationOffset()?(this.camera.rotationOffset+=this.rotationSensibility,this.camera.rotationOffset%=360):-1!==this.keysRotationOffsetDecr.indexOf(t)&&this._modifierRotationOffset()?(this.camera.rotationOffset-=this.rotationSensibility,this.camera.rotationOffset%=360):-1!==this.keysRadiusIncr.indexOf(t)&&this._modifierRadius()?this.camera.radius+=this.radiusSensibility:-1!==this.keysRadiusDecr.indexOf(t)&&this._modifierRadius()&&(this.camera.radius-=this.radiusSensibility)}))}getClassName(){return"FollowCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}_modifierHeightOffset(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed}_modifierRotationOffset(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed}_modifierRadius(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed}}(0,h.gn)([(0,l.qC)()],g.prototype,"keysHeightOffsetIncr",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysHeightOffsetDecr",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysHeightOffsetModifierAlt",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysHeightOffsetModifierCtrl",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysHeightOffsetModifierShift",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRotationOffsetIncr",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRotationOffsetDecr",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRotationOffsetModifierAlt",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRotationOffsetModifierCtrl",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRotationOffsetModifierShift",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRadiusIncr",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRadiusDecr",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRadiusModifierAlt",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRadiusModifierCtrl",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"keysRadiusModifierShift",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"heightSensibility",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"rotationSensibility",void 0),(0,h.gn)([(0,l.qC)()],g.prototype,"radiusSensibility",void 0),o.u.FollowCameraKeyboardMoveInput=g;class f{constructor(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}attachControl(t){t=r.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==u.kD.POINTERWHEEL)return;const i=e.event;let s=0;const o=Math.max(-1,Math.min(1,i.deltaY));this.wheelDeltaPercentage?(console.assert(this.axisControlRadius+this.axisControlHeight+this.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controls ONE axis. Currently enabled: axisControlRadius: "+this.axisControlRadius+", axisControlHeightOffset: "+this.axisControlHeight+", axisControlRotationOffset: "+this.axisControlRotation),this.axisControlRadius?s=.01*o*this.wheelDeltaPercentage*this.camera.radius:this.axisControlHeight?s=.01*o*this.wheelDeltaPercentage*this.camera.heightOffset:this.axisControlRotation&&(s=.01*o*this.wheelDeltaPercentage*this.camera.rotationOffset)):s=o*this.wheelPrecision,s&&(this.axisControlRadius?this.camera.radius+=s:this.axisControlHeight?this.camera.heightOffset-=s:this.axisControlRotation&&(this.camera.rotationOffset-=s)),i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,u.kD.POINTERWHEEL)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,h.gn)([(0,l.qC)()],f.prototype,"axisControlRadius",void 0),(0,h.gn)([(0,l.qC)()],f.prototype,"axisControlHeight",void 0),(0,h.gn)([(0,l.qC)()],f.prototype,"axisControlRotation",void 0),(0,h.gn)([(0,l.qC)()],f.prototype,"wheelPrecision",void 0),(0,h.gn)([(0,l.qC)()],f.prototype,"wheelDeltaPercentage",void 0),o.u.FollowCameraMouseWheelInput=f;class y extends s.O{constructor(){super(...arguments),this.angularSensibilityX=1,this.angularSensibilityY=1,this.pinchPrecision=1e4,this.pinchDeltaPercentage=0,this.axisXControlRadius=!1,this.axisXControlHeight=!1,this.axisXControlRotation=!0,this.axisYControlRadius=!1,this.axisYControlHeight=!0,this.axisYControlRotation=!1,this.axisPinchControlRadius=!0,this.axisPinchControlHeight=!1,this.axisPinchControlRotation=!1,this.warningEnable=!0,this._warningCounter=0}getClassName(){return"FollowCameraPointersInput"}onTouch(t,e,i){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=e/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=i/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=e/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=i/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=e/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=i/this.angularSensibilityY)}onMultiTouch(t,e,i,s,o,n){if(0===i&&null===o)return;if(0===s&&null===n)return;let r=(s-i)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(r*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=r*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=r*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=r*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=r),this.axisPinchControlHeight&&(this.camera.heightOffset+=r),this.axisPinchControlRadius&&(this.camera.radius-=r))}_warning(){if(!this.warningEnable||this._warningCounter++%100!=0)return;const t="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,t+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,t+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,t+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}}(0,h.gn)([(0,l.qC)()],y.prototype,"angularSensibilityX",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"angularSensibilityY",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"pinchPrecision",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"pinchDeltaPercentage",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisXControlRadius",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisXControlHeight",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisXControlRotation",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisYControlRadius",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisYControlHeight",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisYControlRotation",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisPinchControlRadius",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisPinchControlHeight",void 0),(0,h.gn)([(0,l.qC)()],y.prototype,"axisPinchControlRotation",void 0),o.u.FollowCameraPointersInput=y;i(39418),i(61660),i(3251),i(37026),i(99106),i(86009);var C=i(59711);i(93151).a.prototype.addVirtualJoystick=function(){return this.add(new R),this};class R{getLeftJoystick(){return this._leftjoystick}getRightJoystick(){return this._rightjoystick}checkInputs(){if(this._leftjoystick){const t=this.camera,e=50*t._computeLocalCameraSpeed(),i=d.y3.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),s=d.P.TransformCoordinates(new d.P(this._leftjoystick.deltaPosition.x*e,this._leftjoystick.deltaPosition.y*e,this._leftjoystick.deltaPosition.z*e),i);t.cameraDirection=t.cameraDirection.add(s),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}}attachControl(){this._leftjoystick=new C.N(!0),this._leftjoystick.setAxisForUpDown(C.h.Z),this._leftjoystick.setAxisForLeftRight(C.h.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new C.N(!1),this._rightjoystick.setAxisForUpDown(C.h.X),this._rightjoystick.setAxisForLeftRight(C.h.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")}detachControl(){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()}getClassName(){return"FreeCameraVirtualJoystickInput"}getSimpleName(){return"virtualJoystick"}}o.u.FreeCameraVirtualJoystickInput=R;var b=i(2055),P=i(86121),v=i(78098),T=(i(94925),i(78443)),x=(i(39821),i(37290));class M extends o.p{constructor(t){super(t)}addKeyboard(){return this.add(new _),this}addMouse(){return this.add(new m),this}}class w extends P.C{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)}get keysForward(){const t=this.inputs.attached.keyboard;return t?t.keysForward:[]}set keysForward(t){const e=this.inputs.attached.keyboard;e&&(e.keysForward=t)}get keysBackward(){const t=this.inputs.attached.keyboard;return t?t.keysBackward:[]}set keysBackward(t){const e=this.inputs.attached.keyboard;e&&(e.keysBackward=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const e=this.inputs.attached.keyboard;e&&(e.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const e=this.inputs.attached.keyboard;e&&(e.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRight=t)}constructor(t,e,i,s=!0){super(t,e,i,s),this.ellipsoid=new d.P(1,1,1),this.ellipsoidOffset=new d.P(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this.cameraDirection=d.P.Zero(),this._trackRoll=0,this.rollCorrect=100,this.bankedTurn=!1,this.bankedTurnLimit=Math.PI/2,this.bankedTurnMultiplier=1,this._needMoveForGravity=!1,this._oldPosition=d.P.Zero(),this._diffPosition=d.P.Zero(),this._newPosition=d.P.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=(t,e,i=null)=>{(t=>{this._newPosition.copyFrom(t),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>x.D.CollisionsEpsilon&&(this.position.addInPlace(this._diffPosition),this.onCollide&&i&&this.onCollide(i))})(e)},this.inputs=new M(this),this.inputs.addKeyboard().addMouse()}attachControl(t,e){e=r.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e)}detachControl(){this.inputs.detachElement(),this.cameraDirection=new d.P(0,0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let e;e=this.parent?d.P.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,e.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let s=t;this.applyGravity&&(s=t.add(this.getScene().gravity)),i.getNewPosition(this._oldPosition,s,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=d.P.Zero(),this._transformedDirection=d.P.Zero()),this.inputs.checkInputs(),super._checkInputs()}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}restoreRoll(t){const e=this._trackRoll,i=e-this.rotation.z;Math.abs(i)>=.001&&(this.rotation.z+=i/t,Math.abs(e-this.rotation.z)<=.001&&(this.rotation.z=e))}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"FlyCamera"}}(0,h.gn)([(0,l.hd)()],w.prototype,"ellipsoid",void 0),(0,h.gn)([(0,l.hd)()],w.prototype,"ellipsoidOffset",void 0),(0,h.gn)([(0,l.qC)()],w.prototype,"checkCollisions",void 0),(0,h.gn)([(0,l.qC)()],w.prototype,"applyGravity",void 0);var O=i(17834);class k extends o.p{constructor(t){super(t)}addKeyboard(){return this.add(new g),this}addMouseWheel(){return this.add(new f),this}addPointers(){return this.add(new y),this}addVRDeviceOrientation(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this}}O.N.AddNodeConstructor("FollowCamera",((t,e)=>()=>new S(t,d.P.Zero(),e))),O.N.AddNodeConstructor("ArcFollowCamera",((t,e)=>()=>new D(t,0,0,1,null,e)));class S extends P.C{constructor(t,e,i,s=null){super(t,e,i),this.radius=12,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.rotationOffset=0,this.lowerRotationOffsetLimit=null,this.upperRotationOffsetLimit=null,this.heightOffset=4,this.lowerHeightOffsetLimit=null,this.upperHeightOffsetLimit=null,this.cameraAcceleration=.05,this.maxCameraSpeed=20,this.lockedTarget=s,this.inputs=new k(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_follow(t){if(!t)return;const e=d.jp.Matrix[0];t.absoluteRotationQuaternion.toRotationMatrix(e);const i=Math.atan2(e.m[8],e.m[10]),s=r.w1.ToRadians(this.rotationOffset)+i,o=t.getAbsolutePosition(),n=o.x+Math.sin(s)*this.radius,a=o.z+Math.cos(s)*this.radius,h=n-this.position.x,l=o.y+this.heightOffset-this.position.y,c=a-this.position.z;let _=h*this.cameraAcceleration*2,u=l*this.cameraAcceleration,p=c*this.cameraAcceleration*2;(_>this.maxCameraSpeed||_<-this.maxCameraSpeed)&&(_=_<1?-this.maxCameraSpeed:this.maxCameraSpeed),(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=u<1?-this.maxCameraSpeed:this.maxCameraSpeed),(p>this.maxCameraSpeed||p<-this.maxCameraSpeed)&&(p=p<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new d.P(this.position.x+_,this.position.y+u,this.position.z+p),this.setTarget(o)}attachControl(t,e){e=r.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e),this._reset=()=>{}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){this.inputs.checkInputs(),this._checkLimits(),super._checkInputs(),this.lockedTarget&&this._follow(this.lockedTarget)}_checkLimits(){null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),null!==this.lowerHeightOffsetLimit&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),null!==this.upperHeightOffsetLimit&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),null!==this.lowerRotationOffsetLimit&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),null!==this.upperRotationOffsetLimit&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)}getClassName(){return"FollowCamera"}}(0,h.gn)([(0,l.qC)()],S.prototype,"radius",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"lowerRadiusLimit",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"upperRadiusLimit",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"rotationOffset",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"lowerRotationOffsetLimit",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"upperRotationOffsetLimit",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"heightOffset",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"lowerHeightOffsetLimit",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"upperHeightOffsetLimit",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"cameraAcceleration",void 0),(0,h.gn)([(0,l.qC)()],S.prototype,"maxCameraSpeed",void 0),(0,h.gn)([(0,l.RR)("lockedTargetId")],S.prototype,"lockedTarget",void 0);class D extends P.C{constructor(t,e,i,s,o,n){super(t,d.P.Zero(),n),this.alpha=e,this.beta=i,this.radius=s,this._cartesianCoordinates=d.P.Zero(),this.setMeshTarget(o)}setMeshTarget(t){this._meshTarget=t,this._follow()}_follow(){if(!this._meshTarget)return;this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);const t=this._meshTarget.getAbsolutePosition();this.position=t.add(this._cartesianCoordinates),this.setTarget(t)}_checkInputs(){super._checkInputs(),this._follow()}getClassName(){return"ArcFollowCamera"}}var A=i(71143);O.N.AddNodeConstructor("GamepadCamera",((t,e)=>()=>new I(t,d.P.Zero(),e)));class I extends A.x{constructor(t,e,i){super(t,e,i)}getClassName(){return"GamepadCamera"}}var E=i(89815),V=i(92151);function F(t){t._rigCameras[0]._rigPostProcess=new E.Q(t.name+"_passthru",1,t._rigCameras[0]),t._rigCameras[1]._rigPostProcess=new V.k(t.name+"_anaglyph",1,t._rigCameras)}O.N.AddNodeConstructor("AnaglyphArcRotateCamera",((t,e,i)=>()=>new L(t,0,0,1,d.P.Zero(),i.interaxial_distance,e)));class L extends T.Y{constructor(t,e,i,s,o,n,r){super(t,e,i,s,o,r),this._setRigMode=F.bind(null,this),this.interaxialDistance=n,this.setCameraRigMode(b.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}getClassName(){return"AnaglyphArcRotateCamera"}}O.N.AddNodeConstructor("AnaglyphFreeCamera",((t,e,i)=>()=>new N(t,d.P.Zero(),i.interaxial_distance,e)));class N extends v.c{constructor(t,e,i,s){super(t,e,s),this._setRigMode=F.bind(null,this),this.interaxialDistance=i,this.setCameraRigMode(b.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i})}getClassName(){return"AnaglyphFreeCamera"}}O.N.AddNodeConstructor("AnaglyphGamepadCamera",((t,e,i)=>()=>new B(t,d.P.Zero(),i.interaxial_distance,e)));class B extends I{constructor(t,e,i,s){super(t,e,s),this._setRigMode=F.bind(null,this),this.interaxialDistance=i,this.setCameraRigMode(b.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i})}getClassName(){return"AnaglyphGamepadCamera"}}O.N.AddNodeConstructor("AnaglyphUniversalCamera",((t,e,i)=>()=>new z(t,d.P.Zero(),i.interaxial_distance,e)));class z extends A.x{constructor(t,e,i,s){super(t,e,s),this._setRigMode=F.bind(null,this),this.interaxialDistance=i,this.setCameraRigMode(b.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i})}getClassName(){return"AnaglyphUniversalCamera"}}var W=i(66513),Y=i(280);function q(t){const e=t.cameraRigMode===b.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||t.cameraRigMode===b.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,i=t.cameraRigMode===b.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;t.cameraRigMode===b.V.RIG_MODE_STEREOSCOPIC_INTERLACED?(t._rigCameras[0]._rigPostProcess=new E.Q(t.name+"_passthru",1,t._rigCameras[0]),t._rigCameras[1]._rigPostProcess=new Y.i(t.name+"_stereoInterlace",t._rigCameras,!1,!0)):(t._rigCameras[i?1:0].viewport=new W.l(0,0,e?.5:1,e?1:.5),t._rigCameras[i?0:1].viewport=new W.l(e?.5:0,e?0:.5,e?.5:1,e?1:.5))}O.N.AddNodeConstructor("StereoscopicArcRotateCamera",((t,e,i)=>()=>new Z(t,0,0,1,d.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)));class Z extends T.Y{constructor(t,e,i,s,o,n,r,a){super(t,e,i,s,o,a),this._setRigMode=q.bind(null,this),this.interaxialDistance=n,this.isStereoscopicSideBySide=r,this.setCameraRigMode(r?b.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}getClassName(){return"StereoscopicArcRotateCamera"}}O.N.AddNodeConstructor("StereoscopicFreeCamera",((t,e,i)=>()=>new G(t,d.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)));class G extends v.c{constructor(t,e,i,s,o){super(t,e,o),this._setRigMode=q.bind(null,this),this.interaxialDistance=i,this.isStereoscopicSideBySide=s,this.setCameraRigMode(s?b.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i})}getClassName(){return"StereoscopicFreeCamera"}}O.N.AddNodeConstructor("StereoscopicGamepadCamera",((t,e,i)=>()=>new U(t,d.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)));class U extends I{constructor(t,e,i,s,o){super(t,e,o),this._setRigMode=q.bind(null,this),this.interaxialDistance=i,this.isStereoscopicSideBySide=s,this.setCameraRigMode(s?b.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i})}getClassName(){return"StereoscopicGamepadCamera"}}O.N.AddNodeConstructor("StereoscopicFreeCamera",((t,e,i)=>()=>new H(t,d.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)));class H extends A.x{constructor(t,e,i,s,o){super(t,e,o),this._setRigMode=q.bind(null,this),this.interaxialDistance=i,this.isStereoscopicSideBySide=s,this.setCameraRigMode(s?b.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:b.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i})}getClassName(){return"StereoscopicUniversalCamera"}}i(30700);O.N.AddNodeConstructor("VirtualJoysticksCamera",((t,e)=>()=>new X(t,d.P.Zero(),e)));class X extends v.c{constructor(t,e,i){super(t,e,i),this.inputs.addVirtualJoystick()}getClassName(){return"VirtualJoysticksCamera"}}var j=i(372),Q=i(28044);O.N.AddNodeConstructor("VRDeviceOrientationArcRotateCamera",((t,e)=>()=>new K(t,0,0,1,d.P.Zero(),e)));class K extends T.Y{constructor(t,e,i,s,o,n,r=!0,a=j.X.GetDefault()){super(t,e,i,s,o,n),this._setRigMode=Q.S.bind(null,this),a.compensateDistortion=r,this.setCameraRigMode(b.V.RIG_MODE_VR,{vrCameraMetrics:a}),this.inputs.addVRDeviceOrientation()}getClassName(){return"VRDeviceOrientationArcRotateCamera"}}var $=i(62091);i(93197);O.N.AddNodeConstructor("VRDeviceOrientationGamepadCamera",((t,e)=>()=>new J(t,d.P.Zero(),e)));class J extends $.i{constructor(t,e,i,s=!0,o=j.X.GetDefault()){super(t,e,i,s,o),this._setRigMode=Q.S.bind(null,this),this.inputs.addGamepad()}getClassName(){return"VRDeviceOrientationGamepadCamera"}}i(12110),i(58705),i(51345)},86121:(t,e,i)=>{i.d(e,{C:()=>l});var s=i(72433),o=i(96969),n=i(2055),r=i(58095),a=i(48154),h=i(43048);class l extends n.V{constructor(t,e,i,s=!0){super(t,e,i,s),this._tmpUpVector=r.P.Zero(),this._tmpTargetVector=r.P.Zero(),this.cameraDirection=new r.P(0,0,0),this.cameraRotation=new r.FM(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new r._f,this.rotation=new r.P(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=r.P.Zero(),this._initialFocalDistance=1,this._viewMatrix=r.y3.Zero(),this._camMatrix=r.y3.Zero(),this._cameraTransformMatrix=r.y3.Zero(),this._cameraRotationMatrix=r.y3.Zero(),this._referencePoint=new r.P(0,0,1),this._transformedReferencePoint=r.P.Zero(),this._defaultUp=r.P.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(t){this.getWorldMatrix();const e=this.getTarget().subtract(this.position);return e.normalize(),e.scaleInPlace(t),this.globalPosition.add(e)}_getLockedTargetPosition(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new r._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(t){t||super._updateCache();const e=this._getLockedTargetPosition();e?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(e):this._cache.lockedTarget=e.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))}setTarget(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=a.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),r.y3.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const e=t.subtract(this.position);e.x>=0?this.rotation.y=-Math.atan(e.z/e.x)+Math.PI/2:this.rotation.y=-Math.atan(e.z/e.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&r._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(t){this.setTarget(t)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(r.jp.Matrix[0]),r.P.TransformNormalToRef(this.cameraDirection,r.jp.Matrix[0],r.jp.Vector3[0]),void this.position.addInPlace(r.jp.Vector3[0]);this.position.addInPlace(this.cameraDirection)}_checkInputs(){const t=this.invertRotation?-this.inverseRotationSpeed:1,e=this._decideIfNeedsToMove(),i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(e&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*t,this.rotation.y+=this.cameraRotation.y*t,!this.noRotationConstraint){const t=1.570796;this.rotation.x>t&&(this.rotation.x=t),this.rotation.x<-t&&(this.rotation.x=-t)}if(this.rotationQuaternion){this.rotation.lengthSquared()&&r._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}}e&&(Math.abs(this.cameraDirection.x)<this.speed*a.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*a.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*a.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*a.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*a.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):r.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return r.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),r.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?h.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(r._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),h.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(t,e,i){if(this.ignoreParentScaling){if(this.parent){const s=this.parent.getWorldMatrix();r.P.TransformCoordinatesToRef(t,s,this._globalPosition),r.P.TransformCoordinatesToRef(e,s,this._tmpTargetVector),r.P.TransformNormalToRef(i,s,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._tmpTargetVector.copyFrom(e),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?r.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):r.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?r.y3.LookAtRHToRef(t,e,i,this._viewMatrix):r.y3.LookAtLHToRef(t,e,i,this._viewMatrix),this.parent){const t=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(t,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t)}createRigCamera(t,e){if(this.cameraRigMode!==n.V.RIG_MODE_NONE){const e=new l(t,this.position.clone(),this.getScene());return e.isRigCamera=!0,e.rigParent=this,this.cameraRigMode!==n.V.RIG_MODE_VR&&this.cameraRigMode!==n.V.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new r._f),e._cameraRigParams={},e.rotationQuaternion=new r._f),e.mode=this.mode,e.orthoLeft=this.orthoLeft,e.orthoRight=this.orthoRight,e.orthoTop=this.orthoTop,e.orthoBottom=this.orthoBottom,e}return null}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case n.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case n.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.V.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,s=this.cameraRigMode===n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,e);break}case n.V.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),e.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),e.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),e.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(t,e){this.getTarget().subtractToRef(this.position,l._TargetFocalPoint),l._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const i=l._TargetFocalPoint.addInPlace(this.position);r.y3.TranslationToRef(-i.x,-i.y,-i.z,l._TargetTransformMatrix),l._TargetTransformMatrix.multiplyToRef(r.y3.RotationAxis(e.upVector,t),l._RigCamTransformMatrix),r.y3.TranslationToRef(i.x,i.y,i.z,l._TargetTransformMatrix),l._RigCamTransformMatrix.multiplyToRef(l._TargetTransformMatrix,l._RigCamTransformMatrix),r.P.TransformCoordinatesToRef(this.position,l._RigCamTransformMatrix,e.position),e.setTarget(i)}getClassName(){return"TargetCamera"}}l._RigCamTransformMatrix=new r.y3,l._TargetTransformMatrix=new r.y3,l._TargetFocalPoint=new r.P,(0,s.gn)([(0,o.hd)()],l.prototype,"rotation",void 0),(0,s.gn)([(0,o.qC)()],l.prototype,"speed",void 0),(0,s.gn)([(0,o.RR)("lockedTargetId")],l.prototype,"lockedTarget",void 0)},94925:(t,e,i)=>{i.d(e,{H:()=>n});var s=i(78098),o=i(58095);i(17834).N.AddNodeConstructor("TouchCamera",((t,e)=>()=>new n(t,o.P.Zero(),e)));class n extends s.c{get touchAngularSensibility(){const t=this.inputs.attached.touch;return t?t.touchAngularSensibility:0}set touchAngularSensibility(t){const e=this.inputs.attached.touch;e&&(e.touchAngularSensibility=t)}get touchMoveSensibility(){const t=this.inputs.attached.touch;return t?t.touchMoveSensibility:0}set touchMoveSensibility(t){const e=this.inputs.attached.touch;e&&(e.touchMoveSensibility=t)}constructor(t,e,i){super(t,e,i),this.inputs.addTouch(),this._setupInputs()}getClassName(){return"TouchCamera"}_setupInputs(){const t=this.inputs.attached.touch,e=this.inputs.attached.mouse;e?e.touchEnabled=!1:t.allowMouse=!0}}},71143:(t,e,i)=>{i.d(e,{x:()=>a});var s=i(94925),o=i(17834),n=i(58095),r=i(2055);i(93197);o.N.AddNodeConstructor("FreeCamera",((t,e)=>()=>new a(t,n.P.Zero(),e)));class a extends s.H{get gamepadAngularSensibility(){const t=this.inputs.attached.gamepad;return t?t.gamepadAngularSensibility:0}set gamepadAngularSensibility(t){const e=this.inputs.attached.gamepad;e&&(e.gamepadAngularSensibility=t)}get gamepadMoveSensibility(){const t=this.inputs.attached.gamepad;return t?t.gamepadMoveSensibility:0}set gamepadMoveSensibility(t){const e=this.inputs.attached.gamepad;e&&(e.gamepadMoveSensibility=t)}constructor(t,e,i){super(t,e,i),this.inputs.addGamepad()}getClassName(){return"UniversalCamera"}}r.V._CreateDefaultParsedCamera=(t,e)=>new a(t,n.P.Zero(),e)},71218:(t,e,i)=>{var s=i(58095),o=i(62464);const n=function(){const t={root:0,found:!1};return function(e,i,s,o){t.root=0,t.found=!1;const n=i*i-4*e*s;if(n<0)return t;const r=Math.sqrt(n);let a=(-i-r)/(2*e),h=(-i+r)/(2*e);if(a>h){const t=h;h=a,a=t}return a>0&&a<o?(t.root=a,t.found=!0,t):h>0&&h<o?(t.root=h,t.found=!0,t):t}}();class r{constructor(){this._collisionPoint=s.P.Zero(),this._planeIntersectionPoint=s.P.Zero(),this._tempVector=s.P.Zero(),this._tempVector2=s.P.Zero(),this._tempVector3=s.P.Zero(),this._tempVector4=s.P.Zero(),this._edge=s.P.Zero(),this._baseToVertex=s.P.Zero(),this._destinationPoint=s.P.Zero(),this._slidePlaneNormal=s.P.Zero(),this._displacementVector=s.P.Zero(),this._radius=s.P.One(),this._retry=0,this._basePointWorld=s.P.Zero(),this._velocityWorld=s.P.Zero(),this._normalizedVelocity=s.P.Zero(),this._collisionMask=-1}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}get slidePlaneNormal(){return this._slidePlaneNormal}_initialize(t,e,i){this._velocity=e,this._velocitySquaredLength=this._velocity.lengthSquared();const s=Math.sqrt(this._velocitySquaredLength);0===s||1===s?this._normalizedVelocity.copyFromFloats(e._x,e._y,e._z):e.scaleToRef(1/s,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),e.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=i,this.collisionFound=!1}_checkPointInTriangle(t,e,i,o,n){e.subtractToRef(t,this._tempVector),i.subtractToRef(t,this._tempVector2),s.P.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);let r=s.P.Dot(this._tempVector4,n);return!(r<0)&&(o.subtractToRef(t,this._tempVector3),s.P.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),r=s.P.Dot(this._tempVector4,n),!(r<0)&&(s.P.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),r=s.P.Dot(this._tempVector4,n),r>=0))}_canDoCollision(t,e,i,o){const n=s.P.Distance(this._basePointWorld,t),r=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(n>this._velocityWorldLength+r+e)&&!!((t,e,i,s)=>!(t.x>i.x+s||i.x-s>e.x||t.y>i.y+s||i.y-s>e.y||t.z>i.z+s||i.z-s>e.z))(i,o,this._basePointWorld,this._velocityWorldLength+r)}_testTriangle(t,e,i,a,h,l,c){let d,_=!1;e||(e=[]),e[t]||(e[t]=new o.J(0,0,0,0),e[t].copyFromPoints(i,a,h));const u=e[t];if(!l&&!u.isFrontFacingTo(this._normalizedVelocity,0))return;const p=u.signedDistanceTo(this._basePoint),m=s.P.Dot(u.normal,this._velocity);if(r.DoubleSidedCheck&&m>1e-4)return;if(0==m){if(Math.abs(p)>=1)return;_=!0,d=0}else{d=(-1-p)/m;let t=(1-p)/m;if(d>t){const e=t;t=d,d=e}if(d>1||t<0)return;d<0&&(d=0),d>1&&(d=1)}this._collisionPoint.copyFromFloats(0,0,0);let g=!1,f=1;if(_||(this._basePoint.subtractToRef(u.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(d,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,i,a,h,u.normal)&&(g=!0,f=d,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!g){let t=this._velocitySquaredLength;this._basePoint.subtractToRef(i,this._tempVector);let e=2*s.P.Dot(this._velocity,this._tempVector),o=this._tempVector.lengthSquared()-1,r=n(t,e,o,f);r.found&&(f=r.root,g=!0,this._collisionPoint.copyFrom(i)),this._basePoint.subtractToRef(a,this._tempVector),e=2*s.P.Dot(this._velocity,this._tempVector),o=this._tempVector.lengthSquared()-1,r=n(t,e,o,f),r.found&&(f=r.root,g=!0,this._collisionPoint.copyFrom(a)),this._basePoint.subtractToRef(h,this._tempVector),e=2*s.P.Dot(this._velocity,this._tempVector),o=this._tempVector.lengthSquared()-1,r=n(t,e,o,f),r.found&&(f=r.root,g=!0,this._collisionPoint.copyFrom(h)),a.subtractToRef(i,this._edge),i.subtractToRef(this._basePoint,this._baseToVertex);let l=this._edge.lengthSquared(),c=s.P.Dot(this._edge,this._velocity),d=s.P.Dot(this._edge,this._baseToVertex);if(t=l*-this._velocitySquaredLength+c*c,e=2*(l*s.P.Dot(this._velocity,this._baseToVertex)-c*d),o=l*(1-this._baseToVertex.lengthSquared())+d*d,r=n(t,e,o,f),r.found){const t=(c*r.root-d)/l;t>=0&&t<=1&&(f=r.root,g=!0,this._edge.scaleInPlace(t),i.addToRef(this._edge,this._collisionPoint))}if(h.subtractToRef(a,this._edge),a.subtractToRef(this._basePoint,this._baseToVertex),l=this._edge.lengthSquared(),c=s.P.Dot(this._edge,this._velocity),d=s.P.Dot(this._edge,this._baseToVertex),t=l*-this._velocitySquaredLength+c*c,e=2*(l*s.P.Dot(this._velocity,this._baseToVertex)-c*d),o=l*(1-this._baseToVertex.lengthSquared())+d*d,r=n(t,e,o,f),r.found){const t=(c*r.root-d)/l;t>=0&&t<=1&&(f=r.root,g=!0,this._edge.scaleInPlace(t),a.addToRef(this._edge,this._collisionPoint))}if(i.subtractToRef(h,this._edge),h.subtractToRef(this._basePoint,this._baseToVertex),l=this._edge.lengthSquared(),c=s.P.Dot(this._edge,this._velocity),d=s.P.Dot(this._edge,this._baseToVertex),t=l*-this._velocitySquaredLength+c*c,e=2*(l*s.P.Dot(this._velocity,this._baseToVertex)-c*d),o=l*(1-this._baseToVertex.lengthSquared())+d*d,r=n(t,e,o,f),r.found){const t=(c*r.root-d)/l;t>=0&&t<=1&&(f=r.root,g=!0,this._edge.scaleInPlace(t),h.addToRef(this._edge,this._collisionPoint))}}if(g){const t=f*f*this._velocitySquaredLength;(!this.collisionFound||t<this._nearestDistanceSquared)&&(c.collisionResponse&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistanceSquared=t,this._nearestDistance=Math.sqrt(t),this.collisionFound=!0),this.collidedMesh=c)}}_collide(t,e,i,s,o,n,r,a,h,l=!1){if(l)if(i&&0!==i.length)for(let n=s;n<o-2;n+=1){const s=i[n],o=i[n+1],l=i[n+2];if(4294967295===l){n+=2;continue}const c=e[s],d=e[o],_=e[l];c&&d&&_&&((h?1:0)^n%2?this._testTriangle(n,t,c,d,_,r,a):this._testTriangle(n,t,d,c,_,r,a))}else for(let i=0;i<e.length-2;i+=1){const s=e[i],o=e[i+1],n=e[i+2];s&&o&&n&&((h?1:0)^i%2?this._testTriangle(i,t,s,o,n,r,a):this._testTriangle(i,t,o,s,n,r,a))}else if(i&&0!==i.length)for(let l=s;l<o;l+=3){const s=e[i[l]-n],o=e[i[l+1]-n],c=e[i[l+2]-n];h?this._testTriangle(l,t,s,o,c,r,a):this._testTriangle(l,t,c,o,s,r,a)}else for(let i=0;i<e.length;i+=3){const s=e[i],o=e[i+1],n=e[i+2];h?this._testTriangle(i,t,s,o,n,r,a):this._testTriangle(i,t,n,o,s,r,a)}}_getResponse(t,e){t.addToRef(e,this._destinationPoint),e.scaleInPlace(this._nearestDistance/e.length()),this._basePoint.addToRef(e,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(o.J.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,e)}}r.DoubleSidedCheck=!1;var a=i(65273),h=i(37290);class l{constructor(){this._scaledPosition=s.P.Zero(),this._scaledVelocity=s.P.Zero(),this._finalPosition=s.P.Zero()}getNewPosition(t,e,i,s,o,n,r){t.divideToRef(i._radius,this._scaledPosition),e.divideToRef(i._radius,this._scaledVelocity),i.collidedMesh=null,i._retry=0,i._initialVelocity=this._scaledVelocity,i._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,s,this._finalPosition,o),this._finalPosition.multiplyInPlace(i._radius),n(r,this._finalPosition,i.collidedMesh)}createCollider(){return new r}init(t){this._scene=t}_collideWithWorld(t,e,i,s,o,n=null){const r=10*h.D.CollisionsEpsilon;if(i._retry>=s)return void o.copyFrom(t);const a=n?n.collisionMask:i.collisionMask;i._initialize(t,e,r);const l=n&&n.surroundingMeshes||this._scene.meshes;for(let t=0;t<l.length;t++){const e=l[t];e.isEnabled()&&e.checkCollisions&&e.subMeshes&&e!==n&&0!=(a&e.collisionGroup)&&e._checkCollision(i)}i.collisionFound?(0===e.x&&0===e.y&&0===e.z||i._getResponse(t,e),e.length()<=r?o.copyFrom(t):(i._retry++,this._collideWithWorld(t,e,i,s,o,n))):t.addToRef(e,o)}}a.x.CollisionCoordinatorFactory=()=>new l;i(5292),i(94184),i(72521)},94184:(t,e,i)=>{i.d(e,{c:()=>s});class s{constructor(t,e,i){this.bu=t,this.bv=e,this.distance=i,this.faceId=0,this.subMeshId=0}}},72521:(t,e,i)=>{i.d(e,{a:()=>o});var s=i(58095);class o{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new s.P(0,0,0),this._diffPositionForCollisions=new s.P(0,0,0),this._collisionResponse=!0}}},5292:(t,e,i)=>{i.d(e,{p:()=>n});var s=i(58095),o=i(72208);class n{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(t=!1,e=!0){if(!this.pickedMesh||e&&!this.pickedMesh.isVerticesDataPresent(o.o.NormalKind))return null;const i=this.pickedMesh.getIndices();if(!i)return null;let n;if(e){const t=this.pickedMesh.getVerticesData(o.o.NormalKind);let e=s.P.FromArray(t,3*i[3*this.faceId]),r=s.P.FromArray(t,3*i[3*this.faceId+1]),a=s.P.FromArray(t,3*i[3*this.faceId+2]);e=e.scale(this.bu),r=r.scale(this.bv),a=a.scale(1-this.bu-this.bv),n=new s.P(e.x+r.x+a.x,e.y+r.y+a.y,e.z+r.z+a.z)}else{const t=this.pickedMesh.getVerticesData(o.o.PositionKind),e=s.P.FromArray(t,3*i[3*this.faceId]),r=s.P.FromArray(t,3*i[3*this.faceId+1]),a=s.P.FromArray(t,3*i[3*this.faceId+2]),h=e.subtract(r),l=a.subtract(r);n=s.P.Cross(h,l)}const r=(t,e)=>{let i=t.getWorldMatrix();t.nonUniformScaling&&(s.jp.Matrix[0].copyFrom(i),i=s.jp.Matrix[0],i.setTranslationFromFloats(0,0,0),i.invert(),i.transposeToRef(s.jp.Matrix[1]),i=s.jp.Matrix[1]),s.P.TransformNormalToRef(e,i,e)};if(t&&r(this.pickedMesh,n),this.ray){const e=s.jp.Vector3[0].copyFrom(n);t||r(this.pickedMesh,e),s.P.Dot(e,this.ray.direction)>0&&n.negateInPlace()}return n.normalize(),n}getTextureCoordinates(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(o.o.UVKind))return null;const t=this.pickedMesh.getIndices();if(!t)return null;const e=this.pickedMesh.getVerticesData(o.o.UVKind);if(!e)return null;let i=s.FM.FromArray(e,2*t[3*this.faceId]),n=s.FM.FromArray(e,2*t[3*this.faceId+1]),r=s.FM.FromArray(e,2*t[3*this.faceId+2]);return i=i.scale(this.bu),n=n.scale(this.bv),r=r.scale(1-this.bu-this.bv),new s.FM(i.x+n.x+r.x,i.y+n.y+r.y)}}},47884:(t,e,i)=>{i.d(e,{e:()=>s});class s{}s.UseOpenGLOrientationForUV=!1},77840:(t,e,i)=>{i(47884)},27154:(t,e,i)=>{i.d(e,{n:()=>l});var s=i(84318),o=i(62897),n=i(80352),r=i(91153),a=i(69543),h=i(41659);class l{constructor(t,e,i,s=""){var c,d;let _;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.uniqueId=0,this.onCompileObservable=new o.y$,this.onErrorObservable=new o.y$,this.onBindObservable=new o.y$,this._wasPreviouslyReady=!1,this._isReady=!1,this._compilationError="",this._key="",this._computeSourceCodeOverride="",this._pipelineContext=null,this._computeSourceCode="",this._rawComputeSourceCode="",this._shaderLanguage=h.x.WGSL,this.name=t,this._key=s,this._engine=i,this.uniqueId=l._UniqueIdSeed++,this.defines=null!==(c=e.defines)&&void 0!==c?c:"",this.onError=e.onError,this.onCompiled=e.onCompiled,this._entryPoint=null!==(d=e.entryPoint)&&void 0!==d?d:"main",this._shaderStore=a.v.GetShadersStore(this._shaderLanguage),this._shaderRepository=a.v.GetShadersRepository(this._shaderLanguage),this._includeShaderStore=a.v.GetIncludesShadersStore(this._shaderLanguage);const u=(0,n.CG)()?this._engine.getHostDocument():null;t.computeSource?_="source:"+t.computeSource:t.computeElement?(_=u?u.getElementById(t.computeElement):null,_||(_=t.computeElement)):_=t.compute||t;const p={defines:this.defines.split("\n"),indexParameters:void 0,isFragment:!1,shouldUseHighPrecisionShader:!1,processor:null,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:this._shaderRepository,includesShadersStore:this._includeShaderStore,version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:null,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer};this._loadShader(_,"Compute","",(i=>{r.L.Initialize(p),r.L.PreProcess(i,p,(s=>{this._rawComputeSourceCode=i,e.processFinalCode&&(s=e.processFinalCode(s));const o=r.L.Finalize(s,"",p);this._useFinalCode(o.vertexCode,t)}),this._engine)}))}_useFinalCode(t,e){if(e){const i=e.computeElement||e.compute||e.spectorName||e;this._computeSourceCode="//#define SHADER_NAME compute:"+i+"\n"+t}else this._computeSourceCode=t;this._prepareEffect()}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch(t){return!1}}_isReadyInternal(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getCompilationError(){return this._compilationError}executeWhenCompiled(t){this.isReady()?t(this):(this.onCompileObservable.add((e=>{t(e)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(t){try{if(this._isReadyInternal())return}catch(e){return void this._processCompilationErrors(e,t)}setTimeout((()=>{this._checkIsReady(t)}),16)}_loadShader(t,e,i,s){if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement){return void s((0,n.v)(t))}if("source:"===t.substr(0,7))return void s(t.substr(7));if("base64:"===t.substr(0,7)){return void s(window.atob(t.substr(7)))}if(this._shaderStore[t+e+"Shader"])return void s(this._shaderStore[t+e+"Shader"]);if(i&&this._shaderStore[t+i+"Shader"])return void s(this._shaderStore[t+i+"Shader"]);let o;o="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:this._shaderRepository+t,this._engine._loadFile(o+"."+e.toLowerCase()+".fx",s)}get computeSourceCode(){var t,e;return this._computeSourceCodeOverride?this._computeSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getComputeShaderCode())&&void 0!==e?e:this._computeSourceCode}get rawComputeSourceCode(){return this._rawComputeSourceCode}_prepareEffect(){const t=this.defines,e=this._pipelineContext;this._isReady=!1;try{const i=this._engine;this._pipelineContext=i.createComputePipelineContext(),this._pipelineContext._name=this._key,i._prepareComputePipelineContext(this._pipelineContext,this._computeSourceCodeOverride?this._computeSourceCodeOverride:this._computeSourceCode,this._rawComputeSourceCode,this._computeSourceCodeOverride?null:t,this._entryPoint),i._executeWhenComputeStateIsCompiled(this._pipelineContext,(()=>{this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),e&&this.getEngine()._deleteComputePipelineContext(e)})),this._pipelineContext.isAsync&&this._checkIsReady(e)}catch(t){this._processCompilationErrors(t,e)}}_getShaderCodeAndErrorLine(t,e){const i=/COMPUTE SHADER ERROR: 0:(\d+?):/;let s=null;if(e&&t){const o=e.match(i);if(o&&2===o.length){const e=parseInt(o[1]),i=t.split("\n",-1);i.length>=e&&(s=`Offending line [${e}] in compute code: ${i[e-1]}`)}}return[t,s]}_processCompilationErrors(t,e=null){var i;if(this._compilationError=t.message,s.Y.Error("Unable to compile compute effect:"),s.Y.Error("Defines:\r\n"+this.defines),l.LogShaderCodeOnCompilationError){let t=null,e=null;(null===(i=this._pipelineContext)||void 0===i?void 0:i._getComputeShaderCode())&&([e,t]=this._getShaderCodeAndErrorLine(this._pipelineContext._getComputeShaderCode(),this._compilationError),e&&(s.Y.Error("Compute code:"),s.Y.Error(e))),t&&s.Y.Error(t)}s.Y.Error("Error: "+this._compilationError),e&&(this._pipelineContext=e,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this))}dispose(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseComputeEffect(this)}static RegisterShader(t,e){a.v.GetShadersStore(h.x.WGSL)[`${t}ComputeShader`]=e}}l._UniqueIdSeed=0,l.LogShaderCodeOnCompilationError=!0},73821:(t,e,i)=>{i.d(e,{U:()=>d});var s=i(72433),o=i(96969),n=i(48620),r=i(34435),a=i(73803),h=i(46310),l=i(84318),c=i(90729);class d{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(t,e,i,s={}){this._bindings={},this._samplers={},this._contextIsDirty=!1,this.onCompiled=null,this.onError=null,this.name=t,this._engine=e,this.uniqueId=h.K.UniqueId,this._engine.getCaps().supportComputeShaders?s.bindingsMapping?(this._context=e.createComputeContext(),this._shaderPath=i,this._options={bindingsMapping:{},defines:[],...s}):l.Y.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):l.Y.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(t,e,i=!0){const s=this._bindings[t];this._bindings[t]={type:i?r.t.Texture:r.t.TextureWithoutSampler,object:e,indexInGroupEntries:null==s?void 0:s.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!s||s.object!==e||s.type!==this._bindings[t].type)}setStorageTexture(t,e){const i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==e),this._bindings[t]={type:r.t.StorageTexture,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}}setUniformBuffer(t,e){const i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==e),this._bindings[t]={type:r.t.UniformBuffer,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}}setStorageBuffer(t,e){const i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==e),this._bindings[t]={type:r.t.StorageBuffer,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}}setTextureSampler(t,e){const i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||!e.compareSampler(i.object)),this._bindings[t]={type:r.t.Sampler,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}}isReady(){let t=this._effect;for(const t in this._bindings){const e=this._bindings[t],i=e.type,s=e.object;switch(i){case r.t.Texture:case r.t.TextureWithoutSampler:case r.t.StorageTexture:if(!s.isReady())return!1;break}}const e=[],i=this._shaderPath;if(this._options.defines)for(let t=0;t<this._options.defines.length;t++)e.push(this._options.defines[t]);const s=e.join("\n");return this._cachedDefines!==s&&(this._cachedDefines=s,t=this._engine.createComputeEffect(i,{defines:s,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=t),!!t.isReady()}dispatch(t,e,i){var s;if(!this.isReady())return!1;for(const t in this._bindings){const e=this._bindings[t];if(!this._options.bindingsMapping[t])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+t+"'");if(e.type!==r.t.Texture)continue;const i=this._samplers[t],o=e.object;i&&o._texture&&i.compareSampler(o._texture)||(this._samplers[t]=(new c.a).setParameters(o.wrapU,o.wrapV,o.wrapR,o.anisotropicFilteringLevel,o._texture.samplingMode,null===(s=o._texture)||void 0===s?void 0:s._comparisonFunction),this._contextIsDirty=!0)}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),this._engine.computeDispatch(this._effect,this._context,this._bindings,t,e,i,this._options.bindingsMapping),!0}dispatchWhenReady(t,e,i,s=10){return new Promise((o=>{const n=()=>{this.dispatch(t,e,i)?o():setTimeout(n,s)};n()}))}serialize(){const t=o.p4.Serialize(this);t.options=this._options,t.shaderPath=this._shaderPath,t.bindings={},t.textures={};for(const e in this._bindings){const i=this._bindings[e],s=i.object;switch(i.type){case r.t.Texture:case r.t.TextureWithoutSampler:case r.t.StorageTexture:{const o=s.serialize();o&&(t.textures[e]=o,t.bindings[e]={type:i.type});break}case r.t.UniformBuffer:}}return t}static Parse(t,e,i){const s=o.p4.Parse((()=>new d(t.name,e.getEngine(),t.shaderPath,t.options)),t,e,i);for(const o in t.textures){const n=t.bindings[o],h=a.x.Parse(t.textures[o],e,i);n.type===r.t.Texture?s.setTexture(o,h):n.type===r.t.TextureWithoutSampler?s.setTexture(o,h,!1):s.setStorageTexture(o,h)}return s}}(0,s.gn)([(0,o.qC)()],d.prototype,"name",void 0),(0,n.H)("BABYLON.ComputeShader",d)},93553:(t,e,i)=>{i(27154),i(73821)},33178:(t,e,i)=>{i.d(e,{k:()=>r});var s=i(48939),o=i(58095),n=i(48154);class r{constructor(t,e,i){this.vectors=s.B.BuildArray(8,o.P.Zero),this.center=o.P.Zero(),this.centerWorld=o.P.Zero(),this.extendSize=o.P.Zero(),this.extendSizeWorld=o.P.Zero(),this.directions=s.B.BuildArray(3,o.P.Zero),this.vectorsWorld=s.B.BuildArray(8,o.P.Zero),this.minimumWorld=o.P.Zero(),this.maximumWorld=o.P.Zero(),this.minimum=o.P.Zero(),this.maximum=o.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,e,i)}reConstruct(t,e,i){const s=t.x,n=t.y,r=t.z,a=e.x,h=e.y,l=e.z,c=this.vectors;this.minimum.copyFromFloats(s,n,r),this.maximum.copyFromFloats(a,h,l),c[0].copyFromFloats(s,n,r),c[1].copyFromFloats(a,h,l),c[2].copyFromFloats(a,n,r),c[3].copyFromFloats(s,h,r),c[4].copyFromFloats(s,n,l),c[5].copyFromFloats(a,h,r),c[6].copyFromFloats(s,h,l),c[7].copyFromFloats(a,n,l),e.addToRef(t,this.center).scaleInPlace(.5),e.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||o.y3.IdentityReadOnly,this._update(this._worldMatrix)}scale(t){const e=r._TmpVector3,i=this.maximum.subtractToRef(this.minimum,e[0]),s=i.length();i.normalizeFromLength(s);const o=s*t,n=i.scaleInPlace(.5*o),a=this.center.subtractToRef(n,e[1]),h=this.center.addToRef(n,e[2]);return this.reConstruct(a,h,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){const e=this.minimumWorld,i=this.maximumWorld,s=this.directions,n=this.vectorsWorld,r=this.vectors;if(t.isIdentity()){e.copyFrom(this.minimum),i.copyFrom(this.maximum);for(let t=0;t<8;++t)n[t].copyFrom(r[t]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{e.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(let s=0;s<8;++s){const a=n[s];o.P.TransformCoordinatesToRef(r[s],t,a),e.minimizeInPlace(a),i.maximizeInPlace(a)}i.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(e,this.centerWorld).scaleInPlace(.5)}o.P.FromArrayToRef(t.m,0,s[0]),o.P.FromArrayToRef(t.m,4,s[1]),o.P.FromArrayToRef(t.m,8,s[2]),this._worldMatrix=t}isInFrustum(t){return r.IsInFrustum(this.vectorsWorld,t)}isCompletelyInFrustum(t){return r.IsCompletelyInFrustum(this.vectorsWorld,t)}intersectsPoint(t){const e=this.minimumWorld,i=this.maximumWorld,s=e.x,o=e.y,r=e.z,a=i.x,h=i.y,l=i.z,c=t.x,d=t.y,_=t.z,u=-n.kn;return!(a-c<u||u>c-s)&&(!(h-d<u||u>d-o)&&!(l-_<u||u>_-r))}intersectsSphere(t){return r.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}intersectsMinMax(t,e){const i=this.minimumWorld,s=this.maximumWorld,o=i.x,n=i.y,r=i.z,a=s.x,h=s.y,l=s.z,c=t.x,d=t.y,_=t.z,u=e.x,p=e.y,m=e.z;return!(a<c||o>u)&&(!(h<d||n>p)&&!(l<_||r>m))}dispose(){var t,e;null===(t=this._drawWrapperFront)||void 0===t||t.dispose(),null===(e=this._drawWrapperBack)||void 0===e||e.dispose()}static Intersects(t,e){return t.intersectsMinMax(e.minimumWorld,e.maximumWorld)}static IntersectsSphere(t,e,i,s){const n=r._TmpVector3[0];o.P.ClampToRef(i,t,e,n);return o.P.DistanceSquared(i,n)<=s*s}static IsCompletelyInFrustum(t,e){for(let i=0;i<6;++i){const s=e[i];for(let e=0;e<8;++e)if(s.dotCoordinate(t[e])<0)return!1}return!0}static IsInFrustum(t,e){for(let i=0;i<6;++i){let s=!0;const o=e[i];for(let e=0;e<8;++e)if(o.dotCoordinate(t[e])>=0){s=!1;break}if(s)return!1}return!0}}r._TmpVector3=s.B.BuildArray(3,o.P.Zero)},91859:(t,e,i)=>{i.d(e,{j:()=>d});var s=i(48939),o=i(58095),n=i(33178),r=i(14750);const a={min:0,max:0},h={min:0,max:0},l=(t,e,i)=>{const s=o.P.Dot(e.centerWorld,t),n=Math.abs(o.P.Dot(e.directions[0],t))*e.extendSize.x+Math.abs(o.P.Dot(e.directions[1],t))*e.extendSize.y+Math.abs(o.P.Dot(e.directions[2],t))*e.extendSize.z;i.min=s-n,i.max=s+n},c=(t,e,i)=>(l(t,e,a),l(t,i,h),!(a.min>h.max||h.min>a.max));class d{constructor(t,e,i){this._isLocked=!1,this.boundingBox=new n.k(t,e,i),this.boundingSphere=new r.K(t,e,i)}reConstruct(t,e,i){this.boundingBox.reConstruct(t,e,i),this.boundingSphere.reConstruct(t,e,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(t){this._isLocked=t}update(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))}centerOn(t,e){const i=d._TmpVector3[0].copyFrom(t).subtractInPlace(e),s=d._TmpVector3[1].copyFrom(t).addInPlace(e);return this.boundingBox.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,s,this.boundingBox.getWorldMatrix()),this}encapsulate(t){const e=o.P.Minimize(this.minimum,t),i=o.P.Maximize(this.maximum,t);return this.reConstruct(e,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(t){return this.encapsulate(t.boundingBox.centerWorld.subtract(t.boundingBox.extendSizeWorld)),this.encapsulate(t.boundingBox.centerWorld.add(t.boundingBox.extendSizeWorld)),this}scale(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this}isInFrustum(t,e=0){if((2===e||3===e)&&this.boundingSphere.isCenterInFrustum(t))return!0;if(!this.boundingSphere.isInFrustum(t))return!1;return!(1!==e&&3!==e)||this.boundingBox.isInFrustum(t)}get diagonalLength(){const t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,d._TmpVector3[0]).length()}isCompletelyInFrustum(t){return this.boundingBox.isCompletelyInFrustum(t)}_checkCollision(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t))}intersects(t,e){if(!r.K.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!n.k.Intersects(this.boundingBox,t.boundingBox))return!1;if(!e)return!0;const i=this.boundingBox,s=t.boundingBox;return!!c(i.directions[0],i,s)&&(!!c(i.directions[1],i,s)&&(!!c(i.directions[2],i,s)&&(!!c(s.directions[0],i,s)&&(!!c(s.directions[1],i,s)&&(!!c(s.directions[2],i,s)&&(!!c(o.P.Cross(i.directions[0],s.directions[0]),i,s)&&(!!c(o.P.Cross(i.directions[0],s.directions[1]),i,s)&&(!!c(o.P.Cross(i.directions[0],s.directions[2]),i,s)&&(!!c(o.P.Cross(i.directions[1],s.directions[0]),i,s)&&(!!c(o.P.Cross(i.directions[1],s.directions[1]),i,s)&&(!!c(o.P.Cross(i.directions[1],s.directions[2]),i,s)&&(!!c(o.P.Cross(i.directions[2],s.directions[0]),i,s)&&(!!c(o.P.Cross(i.directions[2],s.directions[1]),i,s)&&!!c(o.P.Cross(i.directions[2],s.directions[2]),i,s))))))))))))))}}d._TmpVector3=s.B.BuildArray(2,o.P.Zero)},14750:(t,e,i)=>{i.d(e,{K:()=>n});var s=i(48939),o=i(58095);class n{constructor(t,e,i){this.center=o.P.Zero(),this.centerWorld=o.P.Zero(),this.minimum=o.P.Zero(),this.maximum=o.P.Zero(),this.reConstruct(t,e,i)}reConstruct(t,e,i){this.minimum.copyFrom(t),this.maximum.copyFrom(e);const s=o.P.Distance(t,e);e.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*s,this._update(i||o.y3.IdentityReadOnly)}scale(t){const e=this.radius*t,i=n._TmpVector3,s=i[0].setAll(e),o=this.center.subtractToRef(s,i[1]),r=this.center.addToRef(s,i[2]);return this.reConstruct(o,r,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{o.P.TransformCoordinatesToRef(this.center,t,this.centerWorld);const e=n._TmpVector3[0];o.P.TransformNormalFromFloatsToRef(1,1,1,t,e),this.radiusWorld=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))*this.radius}}isInFrustum(t){const e=this.centerWorld,i=this.radiusWorld;for(let s=0;s<6;s++)if(t[s].dotCoordinate(e)<=-i)return!1;return!0}isCenterInFrustum(t){const e=this.centerWorld;for(let i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0}intersectsPoint(t){const e=o.P.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<e)}static Intersects(t,e){const i=o.P.DistanceSquared(t.centerWorld,e.centerWorld),s=t.radiusWorld+e.radiusWorld;return!(s*s<i)}static CreateFromCenterAndRadius(t,e,i){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,e),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const s=new n(this._TmpVector3[0],this._TmpVector3[2]);return s._worldMatrix=i||o.y3.Identity(),s}}n._TmpVector3=s.B.BuildArray(3,o.P.Zero)},25235:(t,e,i)=>{var s=i(33178),o=(i(91859),i(14750),i(7788)),n=i(58095);class r{constructor(t,e,i,s,o,n){this.entries=new Array,this._boundingVectors=new Array,this._capacity=i,this._depth=s,this._maxDepth=o,this._creationFunc=n,this._minPoint=t,this._maxPoint=e,this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors[2].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[3].y=e.y,this._boundingVectors.push(t.clone()),this._boundingVectors[4].z=e.z,this._boundingVectors.push(e.clone()),this._boundingVectors[5].z=t.z,this._boundingVectors.push(e.clone()),this._boundingVectors[6].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[7].y=t.y}get capacity(){return this._capacity}get minPoint(){return this._minPoint}get maxPoint(){return this._maxPoint}addEntry(t){if(this.blocks)for(let e=0;e<this.blocks.length;e++){this.blocks[e].addEntry(t)}else this._creationFunc(t,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(t){if(this.blocks){for(let e=0;e<this.blocks.length;e++){this.blocks[e].removeEntry(t)}return}const e=this.entries.indexOf(t);e>-1&&this.entries.splice(e,1)}addEntries(t){for(let e=0;e<t.length;e++){const i=t[e];this.addEntry(i)}}select(t,e,i){if(s.k.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(let s=0;s<this.blocks.length;s++){this.blocks[s].select(t,e,i)}return}i?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}}intersects(t,e,i,o){if(s.k.IntersectsSphere(this._minPoint,this._maxPoint,t,e)){if(this.blocks){for(let s=0;s<this.blocks.length;s++){this.blocks[s].intersects(t,e,i,o)}return}o?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}}intersectsRay(t,e){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(let i=0;i<this.blocks.length;i++){this.blocks[i].intersectsRay(t,e)}return}e.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){r._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(t,e,i,s,o,a,h,l){h.blocks=new Array;const c=new n.P((e.x-t.x)/2,(e.y-t.y)/2,(e.z-t.z)/2);for(let e=0;e<2;e++)for(let n=0;n<2;n++)for(let d=0;d<2;d++){const _=t.add(c.multiplyByFloats(e,n,d)),u=t.add(c.multiplyByFloats(e+1,n+1,d+1)),p=new r(_,u,s,o+1,a,l);p.addEntries(i),h.blocks.push(p)}}}class a{constructor(t,e,i=2){this.maxDepth=i,this.dynamicContent=new Array,this._maxBlockCapacity=e||64,this._selectionContent=new o.f(1024),this._creationFunc=t}update(t,e,i){r._CreateBlocks(t,e,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}addMesh(t){for(let e=0;e<this.blocks.length;e++){this.blocks[e].addEntry(t)}}removeMesh(t){for(let e=0;e<this.blocks.length;e++){this.blocks[e].removeEntry(t)}}select(t,e){this._selectionContent.reset();for(let i=0;i<this.blocks.length;i++){this.blocks[i].select(t,this._selectionContent,e)}return e?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent}intersects(t,e,i){this._selectionContent.reset();for(let s=0;s<this.blocks.length;s++){this.blocks[s].intersects(t,e,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent}intersectsRay(t){this._selectionContent.reset();for(let e=0;e<this.blocks.length;e++){this.blocks[e].intersectsRay(t,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent}}a.CreationFuncForMeshes=(t,e)=>{const i=t.getBoundingInfo();!t.isBlocked&&i.boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},a.CreationFuncForSubMeshes=(t,e)=>{t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)};var h=i(65273),l=i(71419),c=i(1316),d=i(85627),_=i(15210);h.x.prototype.createOrUpdateSelectionOctree=function(t=64,e=2){let i=this._getComponent(d.l.NAME_OCTREE);i||(i=new u(this),this._addComponent(i)),this._selectionOctree||(this._selectionOctree=new a(a.CreationFuncForMeshes,t,e));const s=this.getWorldExtends();return this._selectionOctree.update(s.min,s.max,this.meshes),this._selectionOctree},Object.defineProperty(h.x.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),l.x.prototype.createOrUpdateSubmeshesOctree=function(t=64,e=2){const i=this.getScene();let s=i._getComponent(d.l.NAME_OCTREE);s||(s=new u(i),i._addComponent(s)),this._submeshesOctree||(this._submeshesOctree=new a(a.CreationFuncForSubMeshes,t,e)),this.computeWorldMatrix(!0);const o=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(o.minimumWorld,o.maximumWorld,this.subMeshes),this._submeshesOctree};class u{constructor(t){this.name=d.l.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new c.z(n.P.Zero(),new n.P(1,1,1)),(t=t||_.l.LastCreatedScene)&&(this.scene=t,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this))}register(){this.scene.onMeshRemovedObservable.add((t=>{const e=this.scene.selectionOctree;if(null!=e){const i=e.dynamicContent.indexOf(t);-1!==i&&e.dynamicContent.splice(i,1)}})),this.scene.onMeshImportedObservable.add((t=>{const e=this.scene.selectionOctree;null!=e&&e.addMesh(t)}))}getActiveMeshCandidates(){var t;return(null===(t=this.scene._selectionOctree)||void 0===t?void 0:t.select(this.scene.frustumPlanes))||this.scene._getDefaultMeshCandidates()}getActiveSubMeshCandidates(t){if(t._submeshesOctree&&t.useOctreeForRenderingSelection){return t._submeshesOctree.select(this.scene.frustumPlanes)}return this.scene._getDefaultSubMeshCandidates(t)}getIntersectingSubMeshCandidates(t,e){if(t._submeshesOctree&&t.useOctreeForPicking){c.z.TransformToRef(e,t.getWorldMatrix(),this._tempRay);return t._submeshesOctree.intersectsRay(this._tempRay)}return this.scene._getDefaultSubMeshCandidates(t)}getCollidingSubMeshCandidates(t,e){if(t._submeshesOctree&&t.useOctreeForCollisions){const i=e._velocityWorldLength+Math.max(e._radius.x,e._radius.y,e._radius.z);return t._submeshesOctree.intersects(e._basePointWorld,i)}return this.scene._getDefaultSubMeshCandidates(t)}rebuild(){}dispose(){}}},1316:(t,e,i)=>{i.d(e,{z:()=>c});var s=i(48939),o=i(58095),n=i(5292),r=i(94184),a=i(65273),h=i(2055),l=i(15210);class c{constructor(t,e,i=Number.MAX_VALUE){this.origin=t,this.direction=e,this.length=i}clone(){return new c(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(t,e,i=0){const s=c._TmpVector3[0].copyFromFloats(t.x-i,t.y-i,t.z-i),o=c._TmpVector3[1].copyFromFloats(e.x+i,e.y+i,e.z+i);let n,r,a,h,l=0,d=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<s.x||this.origin.x>o.x)return!1}else if(n=1/this.direction.x,r=(s.x-this.origin.x)*n,a=(o.x-this.origin.x)*n,a===-1/0&&(a=1/0),r>a&&(h=r,r=a,a=h),l=Math.max(r,l),d=Math.min(a,d),l>d)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<s.y||this.origin.y>o.y)return!1}else if(n=1/this.direction.y,r=(s.y-this.origin.y)*n,a=(o.y-this.origin.y)*n,a===-1/0&&(a=1/0),r>a&&(h=r,r=a,a=h),l=Math.max(r,l),d=Math.min(a,d),l>d)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<s.z||this.origin.z>o.z)return!1}else if(n=1/this.direction.z,r=(s.z-this.origin.z)*n,a=(o.z-this.origin.z)*n,a===-1/0&&(a=1/0),r>a&&(h=r,r=a,a=h),l=Math.max(r,l),d=Math.min(a,d),l>d)return!1;return!0}intersectsBox(t,e=0){return this.intersectsBoxMinMax(t.minimum,t.maximum,e)}intersectsSphere(t,e=0){const i=t.center.x-this.origin.x,s=t.center.y-this.origin.y,o=t.center.z-this.origin.z,n=i*i+s*s+o*o,r=t.radius+e,a=r*r;if(n<=a)return!0;const h=i*this.direction.x+s*this.direction.y+o*this.direction.z;if(h<0)return!1;return n-h*h<=a}intersectsTriangle(t,e,i){const s=c._TmpVector3[0],n=c._TmpVector3[1],a=c._TmpVector3[2],h=c._TmpVector3[3],l=c._TmpVector3[4];e.subtractToRef(t,s),i.subtractToRef(t,n),o.P.CrossToRef(this.direction,n,a);const d=o.P.Dot(s,a);if(0===d)return null;const _=1/d;this.origin.subtractToRef(t,h);const u=o.P.Dot(h,a)*_;if(u<0||u>1)return null;o.P.CrossToRef(h,s,l);const p=o.P.Dot(this.direction,l)*_;if(p<0||u+p>1)return null;const m=o.P.Dot(n,l)*_;return m>this.length?null:new r.c(1-u-p,u,m)}intersectsPlane(t){let e;const i=o.P.Dot(t.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const s=o.P.Dot(t.normal,this.origin);return e=(-t.d-s)/i,e<0?e<-9.99999997475243e-7?null:0:e}}intersectsAxis(t,e=0){switch(t){case"y":{const t=(this.origin.y-e)/this.direction.y;return t>0?null:new o.P(this.origin.x+this.direction.x*-t,e,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-e)/this.direction.x;return t>0?null:new o.P(e,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-e)/this.direction.z;return t>0?null:new o.P(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,e)}default:return null}}intersectsMesh(t,e){const i=o.jp.Matrix[0];return t.getWorldMatrix().invertToRef(i),this._tmpRay?c.TransformToRef(this,i,this._tmpRay):this._tmpRay=c.Transform(this,i),t.intersects(this._tmpRay,e)}intersectsMeshes(t,e,i){i?i.length=0:i=[];for(let s=0;s<t.length;s++){const o=this.intersectsMesh(t[s],e);o.hit&&i.push(o)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0}intersectionSegment(t,e,i){const s=this.origin,n=o.jp.Vector3[0],r=o.jp.Vector3[1],a=o.jp.Vector3[2],h=o.jp.Vector3[3];e.subtractToRef(t,n),this.direction.scaleToRef(c._Rayl,a),s.addToRef(a,r),t.subtractToRef(s,h);const l=o.P.Dot(n,n),d=o.P.Dot(n,a),_=o.P.Dot(a,a),u=o.P.Dot(n,h),p=o.P.Dot(a,h),m=l*_-d*d;let g,f,y=m,C=m;m<c._Smallnum?(g=0,y=1,f=p,C=_):(g=d*p-_*u,f=l*p-d*u,g<0?(g=0,f=p,C=_):g>y&&(g=y,f=p+d,C=_)),f<0?(f=0,-u<0?g=0:-u>l?g=y:(g=-u,y=l)):f>C&&(f=C,-u+d<0?g=0:-u+d>l?g=y:(g=-u+d,y=l));const R=Math.abs(g)<c._Smallnum?0:g/y,b=Math.abs(f)<c._Smallnum?0:f/C,P=o.jp.Vector3[4];a.scaleToRef(b,P);const v=o.jp.Vector3[5];n.scaleToRef(R,v),v.addInPlace(h);const T=o.jp.Vector3[6];v.subtractToRef(P,T);return b>0&&b<=this.length&&T.lengthSquared()<i*i?v.length():-1}update(t,e,i,s,n,r,a,h=!1){if(h){c._RayDistant||(c._RayDistant=c.Zero()),c._RayDistant.unprojectRayToRef(t,e,i,s,o.y3.IdentityReadOnly,r,a);const h=o.jp.Matrix[0];n.invertToRef(h),c.TransformToRef(c._RayDistant,h,this)}else this.unprojectRayToRef(t,e,i,s,n,r,a);return this}static Zero(){return new c(o.P.Zero(),o.P.Zero())}static CreateNew(t,e,i,s,o,n,r){return c.Zero().update(t,e,i,s,o,n,r)}static CreateNewFromTo(t,e,i=o.y3.IdentityReadOnly){const s=e.subtract(t),n=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return s.normalize(),c.Transform(new c(t,s,n),i)}static Transform(t,e){const i=new c(new o.P(0,0,0),new o.P(0,0,0));return c.TransformToRef(t,e,i),i}static TransformToRef(t,e,i){o.P.TransformCoordinatesToRef(t.origin,e,i.origin),o.P.TransformNormalToRef(t.direction,e,i.direction),i.length=t.length;const s=i.direction,n=s.length();if(0!==n&&1!==n){const t=1/n;s.x*=t,s.y*=t,s.z*=t,i.length*=n}}unprojectRayToRef(t,e,i,s,n,r,a){var h;const c=o.jp.Matrix[0];n.multiplyToRef(r,c),c.multiplyToRef(a,c),c.invert();const d=o.jp.Vector3[0];d.x=t/i*2-1,d.y=-(e/s*2-1),d.z=(null===(h=l.l.LastCreatedEngine)||void 0===h?void 0:h.isNDCHalfZRange)?0:-1;const _=o.jp.Vector3[1].copyFromFloats(d.x,d.y,1-1e-8),u=o.jp.Vector3[2],p=o.jp.Vector3[3];o.P._UnprojectFromInvertedMatrixToRef(d,c,u),o.P._UnprojectFromInvertedMatrixToRef(_,c,p),this.origin.copyFrom(u),p.subtractToRef(u,this.direction),this.direction.normalize()}}c._TmpVector3=s.B.BuildArray(6,o.P.Zero),c._RayDistant=c.Zero(),c._Smallnum=1e-8,c._Rayl=1e9,a.x.prototype.createPickingRay=function(t,e,i,s,o=!1){const n=c.Zero();return this.createPickingRayToRef(t,e,i,n,s,o),n},a.x.prototype.createPickingRayToRef=function(t,e,i,s,n,r=!1,a=!1){const h=this.getEngine();if(!n){if(!this.activeCamera)return this;n=this.activeCamera}const l=n.viewport.toGlobal(h.getRenderWidth(),h.getRenderHeight());return t=t/h.getHardwareScalingLevel()-l.x,e=e/h.getHardwareScalingLevel()-(h.getRenderHeight()-l.y-l.height),s.update(t,e,l.width,l.height,i||o.y3.IdentityReadOnly,r?o.y3.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix(),a),this},a.x.prototype.createPickingRayInCameraSpace=function(t,e,i){const s=c.Zero();return this.createPickingRayInCameraSpaceToRef(t,e,s,i),s},a.x.prototype.createPickingRayInCameraSpaceToRef=function(t,e,i,s){if(!n.p)return this;const r=this.getEngine();if(!s){if(!this.activeCamera)throw new Error("Active camera not set");s=this.activeCamera}const a=s.viewport.toGlobal(r.getRenderWidth(),r.getRenderHeight()),h=o.y3.Identity();return t=t/r.getHardwareScalingLevel()-a.x,e=e/r.getHardwareScalingLevel()-(r.getRenderHeight()-a.y-a.height),i.update(t,e,a.width,a.height,h,h,s.getProjectionMatrix()),this},a.x.prototype._internalPickForMesh=function(t,e,i,s,o,n,r,a){const h=e(s,i.enableDistantPicking),l=i.intersects(h,o,r,n,s,a);return l&&l.hit?!o&&null!=t&&l.distance>=t.distance?null:l:null},a.x.prototype._internalPick=function(t,e,i,s,r){let a=null;const h=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),l=this.cameraToUseForPointers||this.activeCamera;for(let n=0;n<this.meshes.length;n++){const c=this.meshes[n];if(e){if(!e(c))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;const d=h&&c.isWorldMatrixCameraDependent(),_=c.computeWorldMatrix(d,l);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const e=this._internalPickForMesh(a,t,c,_,!0,!0,r);if(e){if(s)return e;const n=o.jp.Matrix[1],h=c.thinInstanceGetWorldMatrices();for(let e=0;e<h.length;e++){h[e].multiplyToRef(_,n);const o=this._internalPickForMesh(a,t,c,n,i,s,r,!0);if(o&&(a=o,a.thinInstanceIndex=e,i))return a}}}else{const e=this._internalPickForMesh(a,t,c,_,i,s,r);if(e&&(a=e,i))return a}}return a||new n.p},a.x.prototype._internalMultiPick=function(t,e,i){if(!n.p)return null;const s=new Array,r=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),a=this.cameraToUseForPointers||this.activeCamera;for(let n=0;n<this.meshes.length;n++){const h=this.meshes[n];if(e){if(!e(h))continue}else if(!h.isEnabled()||!h.isVisible||!h.isPickable)continue;const l=r&&h.isWorldMatrixCameraDependent(),c=h.computeWorldMatrix(l,a);if(h.hasThinInstances&&h.thinInstanceEnablePicking){if(this._internalPickForMesh(null,t,h,c,!0,!0,i)){const e=o.jp.Matrix[1],n=h.thinInstanceGetWorldMatrices();for(let o=0;o<n.length;o++){n[o].multiplyToRef(c,e);const r=this._internalPickForMesh(null,t,h,e,!1,!1,i,!0);r&&(r.thinInstanceIndex=o,s.push(r))}}}else{const e=this._internalPickForMesh(null,t,h,c,!1,!1,i);e&&s.push(e)}}return s},a.x.prototype.pickWithBoundingInfo=function(t,e,i,s,r){if(!n.p)return null;const a=this._internalPick((i=>(this._tempPickingRay||(this._tempPickingRay=c.Zero()),this.createPickingRayToRef(t,e,i,this._tempPickingRay,r||null),this._tempPickingRay)),i,s,!0);return a&&(a.ray=this.createPickingRay(t,e,o.y3.Identity(),r||null)),a},Object.defineProperty(a.x.prototype,"_pickingAvailable",{get:()=>!0,enumerable:!1,configurable:!1}),a.x.prototype.pick=function(t,e,i,s,n,r,a=!1){const h=this._internalPick(((i,s)=>(this._tempPickingRay||(this._tempPickingRay=c.Zero()),this.createPickingRayToRef(t,e,i,this._tempPickingRay,n||null,!1,s),this._tempPickingRay)),i,s,!1,r);return h&&(h.ray=this.createPickingRay(t,e,o.y3.Identity(),n||null)),h},a.x.prototype.pickWithRay=function(t,e,i,s){const n=this._internalPick((e=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=o.y3.Identity()),e.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=c.Zero()),c.TransformToRef(t,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),e,i,!1,s);return n&&(n.ray=t),n},a.x.prototype.multiPick=function(t,e,i,s,o){return this._internalMultiPick((i=>this.createPickingRay(t,e,i,s||null)),i,o)},a.x.prototype.multiPickWithRay=function(t,e,i){return this._internalMultiPick((e=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=o.y3.Identity()),e.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=c.Zero()),c.TransformToRef(t,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),e,i)},h.V.prototype.getForwardRay=function(t=100,e,i){return this.getForwardRayToRef(new c(o.P.Zero(),o.P.Zero(),t),t,e,i)},h.V.prototype.getForwardRayToRef=function(t,e=100,i,s){return i||(i=this.getWorldMatrix()),t.length=e,s?t.origin.copyFrom(s):t.origin.copyFrom(this.position),o.jp.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),o.P.TransformNormalToRef(o.jp.Vector3[2],i,o.jp.Vector3[3]),o.P.NormalizeToRef(o.jp.Vector3[3],t.direction),t}}}]);