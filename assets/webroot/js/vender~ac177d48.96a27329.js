"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[289],{99977:(e,t,s)=>{var i=s(34779),r=(s(23845),s(51917));class n extends i.d{constructor(e,t,s){super(e,a[s],t,s,!0),this.profileId="generic-hand-select-grasp"}_getFilenameAndPath(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}}_getModelLoadingConstraints(){return!0}_processLoadedModel(e){}_setRootMesh(e){}_updateModel(){}}r.V.RegisterController("generic-hand-select-grasp",((e,t)=>new n(t,e.gamepad,e.handedness)));const a={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-none",assetPath:"none.glb"}};s(28170);var o=s(91243),h=s(58095),l=s(63407),d=s(84318);class c extends i.d{constructor(e,t,s){super(e,u["left-right"],t,s),this._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},this.profileId="microsoft-mixed-reality"}_getFilenameAndPath(){let e="";e="left"===this.handedness?c.MODEL_LEFT_FILENAME:c.MODEL_RIGHT_FILENAME;return{filename:e,path:c.MODEL_BASE_URL+"default/"}}_getModelLoadingConstraints(){const e=l.n.IsPluginForExtensionAvailable(".glb");return e||d.Y.Warn("glTF / glb loaded was not registered, using generic controller instead"),e}_processLoadedModel(e){this.rootMesh&&(this.getComponentIds().forEach(((e,t)=>{if(!this.disableAnimation&&e&&this.rootMesh){const s=this._mapping.buttons[e],i=s.rootNodeName;if(!i)return void d.Y.Log("Skipping unknown button at index: "+t+" with mapped name: "+e);const r=this._getChildByName(this.rootMesh,i);if(!r)return void d.Y.Warn("Missing button mesh with name: "+i);if(s.valueMesh=this._getImmediateChildByName(r,this._mapping.defaultButton.valueNodeName),s.pressedMesh=this._getImmediateChildByName(r,this._mapping.defaultButton.pressedNodeName),s.unpressedMesh=this._getImmediateChildByName(r,this._mapping.defaultButton.unpressedNodeName),s.valueMesh&&s.pressedMesh&&s.unpressedMesh){const t=this.getComponent(e);t&&t.onButtonStateChangedObservable.add((e=>{this._lerpTransform(s,e.value)}),void 0,!0)}else d.Y.Warn("Missing button submesh under mesh with name: "+i)}})),this.getComponentIds().forEach((e=>{const t=this.getComponent(e);t.isAxes()&&["x-axis","y-axis"].forEach((s=>{if(!this.rootMesh)return;const i=this._mapping.axes[e][s],r=this._getChildByName(this.rootMesh,i.rootNodeName);r?(i.valueMesh=this._getImmediateChildByName(r,this._mapping.defaultAxis.valueNodeName),i.minMesh=this._getImmediateChildByName(r,this._mapping.defaultAxis.minNodeName),i.maxMesh=this._getImmediateChildByName(r,this._mapping.defaultAxis.maxNodeName),i.valueMesh&&i.minMesh&&i.maxMesh?t&&t.onAxisValueChangedObservable.add((e=>{const t="x-axis"===s?e.x:e.y;this._lerpTransform(i,t,!0)}),void 0,!0):d.Y.Warn("Missing axis submesh under mesh with name: "+i.rootNodeName)):d.Y.Warn("Missing axis mesh with name: "+i.rootNodeName)}))})))}_setRootMesh(e){let t;this.rootMesh=new o.Kj(this.profileId+" "+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(let s=0;s<e.length;s++){const i=e[s];i.isPickable=!1,i.parent||(t=i)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=h._f.FromEulerAngles(0,Math.PI,0))}_updateModel(){}}c.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",c.MODEL_LEFT_FILENAME="left.glb",c.MODEL_RIGHT_FILENAME="right.glb",r.V.RegisterController("windows-mixed-reality",((e,t)=>new c(t,e.gamepad,e.handedness)));const u={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}};class _ extends i.d{constructor(e,t,s,i=!1,r=!1){super(e,g[s],t,s),this._forceLegacyControllers=r,this.profileId="oculus-touch"}_getFilenameAndPath(){let e="";e="left"===this.handedness?_.MODEL_LEFT_FILENAME:_.MODEL_RIGHT_FILENAME;return{filename:e,path:this._isQuest()?_.QUEST_MODEL_BASE_URL:_.MODEL_BASE_URL}}_getModelLoadingConstraints(){return!0}_processLoadedModel(e){const t=this._isQuest(),s="right"===this.handedness?-1:1;this.getComponentIds().forEach((e=>{const i=e&&this.getComponent(e);i&&i.onButtonStateChangedObservable.add((i=>{if(this.rootMesh&&!this.disableAnimation)switch(e){case"xr-standard-trigger":return void(t||(this._modelRootNode.getChildren()[3].rotation.x=.2*-i.value,this._modelRootNode.getChildren()[3].position.y=.005*-i.value,this._modelRootNode.getChildren()[3].position.z=.005*-i.value));case"xr-standard-squeeze":return void(t||(this._modelRootNode.getChildren()[4].position.x=s*i.value*.0035));case"xr-standard-thumbstick":return;case"a-button":case"x-button":return void(t||(i.pressed?this._modelRootNode.getChildren()[1].position.y=-.001:this._modelRootNode.getChildren()[1].position.y=0));case"b-button":case"y-button":return void(t||(i.pressed?this._modelRootNode.getChildren()[2].position.y=-.001:this._modelRootNode.getChildren()[2].position.y=0))}}),void 0,!0)}))}_setRootMesh(e){this.rootMesh=new o.Kj(this.profileId+" "+this.handedness,this.scene),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=h._f.FromEulerAngles(0,Math.PI,0)),e.forEach((e=>{e.isPickable=!1})),this._isQuest()?this._modelRootNode=e[0]:(this._modelRootNode=e[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh}_updateModel(){}_isQuest(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers}}_.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",_.MODEL_LEFT_FILENAME="left.babylon",_.MODEL_RIGHT_FILENAME="right.babylon",_.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",r.V.RegisterController("oculus-touch",((e,t)=>new _(t,e.gamepad,e.handedness))),r.V.RegisterController("oculus-touch-legacy",((e,t)=>new _(t,e.gamepad,e.handedness,!0)));const g={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}};class p extends i.d{constructor(e,t,s){super(e,m[s],t,s),this.profileId="htc-vive"}_getFilenameAndPath(){return{filename:p.MODEL_FILENAME,path:p.MODEL_BASE_URL}}_getModelLoadingConstraints(){return!0}_processLoadedModel(e){this.getComponentIds().forEach((e=>{const t=e&&this.getComponent(e);t&&t.onButtonStateChangedObservable.add((t=>{if(this.rootMesh&&!this.disableAnimation)switch(e){case"xr-standard-trigger":return void(this._modelRootNode.getChildren()[6].rotation.x=.15*-t.value);case"xr-standard-touchpad":case"xr-standard-squeeze":return}}),void 0,!0)}))}_setRootMesh(e){this.rootMesh=new o.Kj(this.profileId+" "+this.handedness,this.scene),e.forEach((e=>{e.isPickable=!1})),this._modelRootNode=e[1],this._modelRootNode.parent=this.rootMesh,this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=h._f.FromEulerAngles(0,Math.PI,0))}_updateModel(){}}p.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",p.MODEL_FILENAME="wand.babylon",r.V.RegisterController("htc-vive",((e,t)=>new p(t,e.gamepad,e.handedness)));const m={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}};s(18786)},34779:(e,t,s)=>{s.d(t,{d:()=>l});var i=s(23845),r=s(62897),n=s(84318),a=s(63407),o=s(58095),h=s(91243);class l{constructor(e,t,s,n,a=!1,o){this.scene=e,this.layout=t,this.gamepadObject=s,this.handedness=n,this._doNotLoadControllerMesh=a,this._controllerCache=o,this._initComponent=e=>{if(!e)return;const t=this.layout.components[e],s=t.type,r=t.gamepadIndices.button,n=[];void 0!==t.gamepadIndices.xAxis&&void 0!==t.gamepadIndices.yAxis&&n.push(t.gamepadIndices.xAxis,t.gamepadIndices.yAxis),this.components[e]=new i.n(e,s,r,n)},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new r.y$,t.components&&Object.keys(t.components).forEach(this._initComponent)}dispose(){this.getComponentIds().forEach((e=>this.getComponent(e).dispose())),this.rootMesh&&(this.rootMesh.getChildren(void 0,!0).forEach((e=>{e.setEnabled(!1)})),this.rootMesh.dispose(!!this._controllerCache,!this._controllerCache))}getAllComponentsOfType(e){return this.getComponentIds().map((e=>this.components[e])).filter((t=>t.type===e))}getComponent(e){return this.components[e]}getComponentIds(){return Object.keys(this.components)}getComponentOfType(e){return this.getAllComponentsOfType(e)[0]||null}getMainComponent(){return this.getComponent(this.layout.selectComponentId)}async loadModel(){const e=!this._getModelLoadingConstraints();let t=this._getGenericFilenameAndPath();return e?n.Y.Warn("Falling back to generic models"):t=this._getFilenameAndPath(),new Promise(((s,i)=>{const r=t=>{e?this._getGenericParentMesh(t):this._setRootMesh(t),this._processLoadedModel(t),this._modelReady=!0,this.onModelLoadedObservable.notifyObservers(this),s(!0)};if(this._controllerCache){const e=this._controllerCache.filter((e=>e.filename===t.filename&&e.path===t.path));if(e[0])return e[0].meshes.forEach((e=>e.setEnabled(!0))),void r(e[0].meshes)}a.n.ImportMesh("",t.path,t.filename,this.scene,(e=>{this._controllerCache&&this._controllerCache.push({...t,meshes:e}),r(e)}),null,((e,s)=>{n.Y.Log(s),n.Y.Warn(`Failed to retrieve controller model of type ${this.profileId} from the remote server: ${t.path}${t.filename}`),i(s)}))}))}updateFromXRFrame(e){this.getComponentIds().forEach((e=>this.getComponent(e).update(this.gamepadObject))),this.updateModel(e)}get handness(){return this.handedness}pulse(e,t,s=0){return this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[s]?this.gamepadObject.hapticActuators[s].pulse(e,t):Promise.resolve(!1)}_getChildByName(e,t){return e.getChildren((e=>e.name===t),!1)[0]}_getImmediateChildByName(e,t){return e.getChildren((e=>e.name==t),!0)[0]}_lerpTransform(e,t,s){if(!e.minMesh||!e.maxMesh||!e.valueMesh)return;if(!e.minMesh.rotationQuaternion||!e.maxMesh.rotationQuaternion||!e.valueMesh.rotationQuaternion)return;const i=s?.5*t+.5:t;o._f.SlerpToRef(e.minMesh.rotationQuaternion,e.maxMesh.rotationQuaternion,i,e.valueMesh.rotationQuaternion),o.P.LerpToRef(e.minMesh.position,e.maxMesh.position,i,e.valueMesh.position)}updateModel(e){this._modelReady&&this._updateModel(e)}_getGenericFilenameAndPath(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}}_getGenericParentMesh(e){this.rootMesh=new h.Kj(this.profileId+" "+this.handedness,this.scene),e.forEach((e=>{e.parent||(e.isPickable=!1,e.setParent(this.rootMesh))})),this.rootMesh.rotationQuaternion=o._f.FromEulerAngles(0,Math.PI,0)}}},23845:(e,t,s)=>{s.d(t,{n:()=>r});var i=s(62897);class r{constructor(e,t,s=-1,r=[]){this.id=e,this.type=t,this._buttonIndex=s,this._axesIndices=r,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new i.y$,this.onButtonStateChangedObservable=new i.y$}get axes(){return this._axes}get changes(){return this._changes}get hasChanges(){return this._hasChanges}get pressed(){return this._pressed}get touched(){return this._touched}get value(){return this._currentValue}dispose(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()}isAxes(){return 0!==this._axesIndices.length}isButton(){return-1!==this._buttonIndex}update(e){let t=!1,s=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){const s=e.buttons[this._buttonIndex];if(!s)return;this._currentValue!==s.value&&(this.changes.value={current:s.value,previous:this._currentValue},t=!0,this._currentValue=s.value),this._touched!==s.touched&&(this.changes.touched={current:s.touched,previous:this._touched},t=!0,this._touched=s.touched),this._pressed!==s.pressed&&(this.changes.pressed={current:s.pressed,previous:this._pressed},t=!0,this._pressed=s.pressed)}this.isAxes()&&(this._axes.x!==e.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:e.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=e.axes[this._axesIndices[0]],s=!0),this._axes.y!==e.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=e.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:e.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=e.axes[this._axesIndices[1]],s=!0)),t&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),s&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))}}r.BUTTON_TYPE="button",r.SQUEEZE_TYPE="squeeze",r.THUMBSTICK_TYPE="thumbstick",r.TOUCHPAD_TYPE="touchpad",r.TRIGGER_TYPE="trigger"},28170:(e,t,s)=>{s.d(t,{z:()=>a});var i=s(34779),r=s(91243),n=s(58095);class a extends i.d{constructor(e,t,s){super(e,o[s],t,s),this.profileId=a.ProfileId}_getFilenameAndPath(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}}_getModelLoadingConstraints(){return!0}_processLoadedModel(e){}_setRootMesh(e){this.rootMesh=new r.Kj(this.profileId+" "+this.handedness,this.scene),e.forEach((e=>{e.isPickable=!1,e.parent||e.setParent(this.rootMesh)})),this.rootMesh.rotationQuaternion=n._f.FromEulerAngles(0,Math.PI,0)}_updateModel(){}}a.ProfileId="generic-trigger";const o={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}}},51917:(e,t,s)=>{s.d(t,{V:()=>o});var i=s(28170),r=s(13514),n=s(18786);const a=[];class o{static ClearProfilesCache(){this._ProfilesList=null,this._ProfileLoadingPromises={}}static DefaultFallbacks(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("generic-hand-select",["generic-trigger"])}static FindFallbackWithProfileId(e){const t=this._Fallbacks[e]||[];return t.unshift(e),t}static GetMotionControllerWithXRInput(e,t,s){const i=[];if(s&&i.push(s),i.push(...e.profiles||[]),i.length&&!i[0]&&i.pop(),e.gamepad&&e.gamepad.id&&e.gamepad.id===(e.gamepad.id.match(/oculus touch/gi)?e.gamepad.id:void 0))i.push("oculus-touch-v2");const r=i.indexOf("windows-mixed-reality");if(-1!==r&&i.splice(r,0,"microsoft-mixed-reality"),i.length||i.push("generic-trigger"),this.UseOnlineRepository){const s=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,r=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return s.call(this,i,e,t).catch((()=>r.call(this,i,e,t)))}return this._LoadProfilesFromAvailableControllers(i,e,t)}static RegisterController(e,t){this._AvailableControllers[e]=t}static RegisterFallbacksForProfileId(e,t){this._Fallbacks[e]?this._Fallbacks[e].push(...t):this._Fallbacks[e]=t}static UpdateProfilesList(){return this._ProfilesList=r.w1.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then((e=>JSON.parse(e.toString()))),this._ProfilesList}static ClearControllerCache(){a.forEach((e=>{e.meshes.forEach((e=>{e.dispose(!1,!0)}))})),a.length=0}static _LoadProfileFromRepository(e,t,s){return Promise.resolve().then((()=>this._ProfilesList?this._ProfilesList:this.UpdateProfilesList())).then((t=>{for(let s=0;s<e.length;++s)if(e[s]&&t[e[s]])return e[s];throw new Error(`neither controller ${e[0]} nor all fallbacks were found in the repository,`)})).then((e=>(this._ProfileLoadingPromises[e]||(this._ProfileLoadingPromises[e]=r.w1.LoadFileAsync(`${this.BaseRepositoryUrl}/profiles/${e}/profile.json`,!1).then((e=>JSON.parse(e)))),this._ProfileLoadingPromises[e]))).then((e=>new n.t(s,t,e,this.BaseRepositoryUrl,this.DisableControllerCache?void 0:a)))}static _LoadProfilesFromAvailableControllers(e,t,s){for(let i=0;i<e.length;++i){if(!e[i])continue;const r=this.FindFallbackWithProfileId(e[i]);for(let e=0;e<r.length;++e){const i=this._AvailableControllers[r[e]];if(i)return Promise.resolve(i(t,s))}}throw new Error("no controller requested was found in the available controllers list")}}o._AvailableControllers={},o._Fallbacks={},o._ProfileLoadingPromises={},o.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",o.PrioritizeOnlineRepository=!0,o.UseOnlineRepository=!0,o.DisableControllerCache=!0,o.RegisterController(i.z.ProfileId,((e,t)=>new i.z(t,e.gamepad,e.handedness))),o.DefaultFallbacks()},18786:(e,t,s)=>{s.d(t,{t:()=>u});var i=s(34779),r=s(63407),n=s(91243),a=s(43048),o=s(15631),h=s(23845),l=s(48087),d=s(3085),c=s(84318);class u extends i.d{constructor(e,t,s,i,r){super(e,s.layouts[t.handedness||"none"],t.gamepad,t.handedness,void 0,r),this._repositoryUrl=i,this.controllerCache=r,this._buttonMeshMapping={},this._touchDots={},this.profileId=s.profileId}dispose(){super.dispose(),this.controllerCache||Object.keys(this._touchDots).forEach((e=>{this._touchDots[e].dispose()}))}_getFilenameAndPath(){return{filename:this.layout.assetPath,path:`${this._repositoryUrl}/profiles/${this.profileId}/`}}_getModelLoadingConstraints(){const e=r.n.IsPluginForExtensionAvailable(".glb");return e||c.Y.Warn("glTF / glb loader was not registered, using generic controller instead"),e}_processLoadedModel(e){this.getComponentIds().forEach((e=>{const t=this.layout.components[e];this._buttonMeshMapping[e]={mainMesh:this._getChildByName(this.rootMesh,t.rootNodeName),states:{}},Object.keys(t.visualResponses).forEach((s=>{const i=t.visualResponses[s];if("transform"===i.valueNodeProperty)this._buttonMeshMapping[e].states[s]={valueMesh:this._getChildByName(this.rootMesh,i.valueNodeName),minMesh:this._getChildByName(this.rootMesh,i.minNodeName),maxMesh:this._getChildByName(this.rootMesh,i.maxNodeName)};else{const r=t.type===h.n.TOUCHPAD_TYPE&&t.touchPointNodeName?t.touchPointNodeName:i.valueNodeName;if(this._buttonMeshMapping[e].states[s]={valueMesh:this._getChildByName(this.rootMesh,r)},t.type===h.n.TOUCHPAD_TYPE&&!this._touchDots[s]){const t=(0,l.Qk)(s+"dot",{diameter:.0015,segments:8},this.scene);t.material=new d.K(s+"mat",this.scene),t.material.diffuseColor=o.Wo.Red(),t.parent=this._buttonMeshMapping[e].states[s].valueMesh||null,t.isVisible=!1,this._touchDots[s]=t}}}))}))}_setRootMesh(e){let t;this.rootMesh=new n.Kj(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(let s=0;s<e.length;s++){const i=e[s];i.isPickable=!1,i.parent||(t=i)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(a.RD.Y,Math.PI,a.T.WORLD)}_updateModel(e){this.disableAnimation||this.getComponentIds().forEach((e=>{const t=this.getComponent(e);if(!t.hasChanges)return;const s=this._buttonMeshMapping[e],i=this.layout.components[e];Object.keys(i.visualResponses).forEach((e=>{const r=i.visualResponses[e];let n=t.value;if("xAxis"===r.componentProperty?n=t.axes.x:"yAxis"===r.componentProperty&&(n=t.axes.y),"transform"===r.valueNodeProperty)this._lerpTransform(s.states[e],n,"button"!==r.componentProperty);else{const i=s.states[e].valueMesh;i&&(i.isVisible=t.touched||t.pressed),this._touchDots[e]&&(this._touchDots[e].isVisible=t.touched||t.pressed)}}))}))}}},78189:(e,t,s)=>{s(16485);var i=s(49576);(0,i.Oz)("NativeXRFrame",class{get session(){return this._nativeImpl.session}constructor(e){this._nativeImpl=e,this._xrTransform=new XRRigidTransform,this._xrPose={transform:this._xrTransform,emulatedPosition:!1},this._xrPoseVectorData=new Float32Array(8),this.fillPoses=this._nativeImpl.fillPoses.bind(this._nativeImpl),this.getViewerPose=this._nativeImpl.getViewerPose.bind(this._nativeImpl),this.getHitTestResults=this._nativeImpl.getHitTestResults.bind(this._nativeImpl),this.getHitTestResultsForTransientInput=()=>{throw new Error("XRFrame.getHitTestResultsForTransientInput not supported on native.")},this.createAnchor=this._nativeImpl.createAnchor.bind(this._nativeImpl),this.getJointPose=this._nativeImpl.getJointPose.bind(this._nativeImpl),this.fillJointRadii=this._nativeImpl.fillJointRadii.bind(this._nativeImpl),this.getLightEstimate=()=>{throw new Error("XRFrame.getLightEstimate not supported on native.")},this.getImageTrackingResults=()=>{var e;return null!==(e=this._nativeImpl._imageTrackingResults)&&void 0!==e?e:[]}}getPose(e,t){if(!this._nativeImpl.getPoseData(e,t,this._xrPoseVectorData.buffer,this._xrTransform.matrix.buffer))return;const s=this._xrTransform.position;s.x=this._xrPoseVectorData[0],s.y=this._xrPoseVectorData[1],s.z=this._xrPoseVectorData[2],s.w=this._xrPoseVectorData[3];const i=this._xrTransform.orientation;return i.x=this._xrPoseVectorData[4],i.y=this._xrPoseVectorData[5],i.z=this._xrPoseVectorData[6],i.w=this._xrPoseVectorData[7],this._xrPose}get trackedAnchors(){return this._nativeImpl.trackedAnchors}get worldInformation(){return this._nativeImpl.worldInformation}get detectedPlanes(){return this._nativeImpl.detectedPlanes}get featurePointCloud(){return this._nativeImpl.featurePointCloud}})},16485:(e,t,s)=>{s.d(t,{HK:()=>o,z5:()=>n});var i=s(64829),r=s(69022);class n extends i.s{constructor(e){super((()=>e.framebufferWidth),(()=>e.framebufferHeight),e,"XRWebGLLayer",(e=>new a(e,this))),this.layer=e}}class a extends r.y{constructor(e,t){super(e.scene,t),this.layerWrapper=t,this._nativeRTTProvider=navigator.xr.getNativeRenderTargetProvider(e.session,this._createRenderTargetTexture.bind(this),this._destroyRenderTargetTexture.bind(this)),this._nativeLayer=t.layer}trySetViewportForView(e){return e.x=0,e.y=0,e.width=1,e.height=1,!0}getRenderTargetTextureForEye(e){return this._nativeRTTProvider.getRenderTargetForEye(e)}getRenderTargetTextureForView(e){return this._nativeRTTProvider.getRenderTargetForEye(e.eye)}getFramebufferDimensions(){return{framebufferWidth:this._nativeLayer.framebufferWidth,framebufferHeight:this._nativeLayer.framebufferHeight}}}class o{constructor(e){this._nativeRenderTarget=navigator.xr.getWebXRRenderTarget(e.scene.getEngine())}async initializeXRLayerAsync(e){return await this._nativeRenderTarget.initializeXRLayerAsync(e),this.xrLayer=this._nativeRenderTarget.xrLayer,this.xrLayer}dispose(){}}},52281:(e,t,s)=>{s.d(t,{o:()=>d});var i=s(58095),r=s(2055),n=s(78098),a=s(86121),o=s(66513),h=s(62897),l=s(9022);class d extends n.c{constructor(e,t,s){super(e,i.P.Zero(),t),this._xrSessionManager=s,this._firstFrame=!1,this._referenceQuaternion=i._f.Identity(),this._referencedPosition=new i.P,this._trackingState=l.j.NOT_TRACKING,this.onBeforeCameraTeleport=new h.y$,this.onAfterCameraTeleport=new h.y$,this.onTrackingStateChanged=new h.y$,this.compensateOnFirstFrame=!0,this.minZ=.1,this.rotationQuaternion=new i._f,this.cameraRigMode=r.V.RIG_MODE_CUSTOM,this.updateUpVectorFromRotation=!0,this._updateNumberOfRigCameras(1),this.freezeProjectionMatrix(),this._xrSessionManager.onXRSessionInit.add((()=>{this._referencedPosition.copyFromFloats(0,0,0),this._referenceQuaternion.copyFromFloats(0,0,0,1),this._firstFrame=this.compensateOnFirstFrame})),this._xrSessionManager.onXRFrameObservable.add((()=>{this._firstFrame&&this._updateFromXRSession(),this._updateReferenceSpace(),this._updateFromXRSession()}),void 0,!0)}get trackingState(){return this._trackingState}_setTrackingState(e){this._trackingState!==e&&(this._trackingState=e,this.onTrackingStateChanged.notifyObservers(e))}get realWorldHeight(){const e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return e&&e.transform?e.transform.position.y:0}_updateForDualEyeDebugging(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new o.l(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new o.l(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null}setTransformationFromNonVRCamera(e=this.getScene().activeCamera,t=!0){if(!e||e===this)return;e.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,i._f.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,t&&this._xrSessionManager.resetReferenceSpace()}getClassName(){return"WebXRCamera"}setTarget(e){const t=i.jp.Vector3[1];e.subtractToRef(this.position,t),t.y=0,t.normalize();const s=Math.atan2(t.x,t.z);this.rotationQuaternion.toEulerAnglesToRef(t),i._f.FromEulerAnglesToRef(t.x,s,t.z,this.rotationQuaternion)}dispose(){super.dispose(),this._lastXRViewerPose=void 0}_updateFromXRSession(){const e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(this._lastXRViewerPose=e||void 0,!e)return void this._setTrackingState(l.j.NOT_TRACKING);const t=e.emulatedPosition?l.j.TRACKING_LOST:l.j.TRACKING;if(this._setTrackingState(t),this.minZ!==this._cache.minZ||this.maxZ!==this._cache.maxZ){const e={depthFar:this.maxZ||1e4,depthNear:this.minZ};this._xrSessionManager.updateRenderState(e),this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ}if(e.transform){const t=e.transform.orientation;if(void 0===e.transform.orientation.x)return;const s=e.transform.position;this._referencedPosition.set(s.x,s.y,s.z),this._referenceQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==e.views.length&&this._updateNumberOfRigCameras(e.views.length),e.views.forEach(((e,t)=>{var s;const r=this.rigCameras[t];r.isLeftCamera||r.isRightCamera||("right"===e.eye?r._isRightCamera=!0:"left"===e.eye&&(r._isLeftCamera=!0));const n=e.transform.position,a=e.transform.orientation;r.parent=this.parent,r.position.set(n.x,n.y,n.z),r.rotationQuaternion.set(a.x,a.y,a.z,a.w),this._scene.useRightHandedSystem||(r.position.z*=-1,r.rotationQuaternion.z*=-1,r.rotationQuaternion.w*=-1),i.y3.FromFloat32ArrayToRefScaled(e.projectionMatrix,0,1,r._projectionMatrix),this._scene.useRightHandedSystem||r._projectionMatrix.toggleProjectionMatrixHandInPlace(),0===t&&this._projectionMatrix.copyFrom(r._projectionMatrix);const o=this._xrSessionManager.getRenderTargetTextureForView(e);this._renderingMultiview=(null===(s=null==o?void 0:o._texture)||void 0===s?void 0:s.isMultiview)||!1,this._renderingMultiview?0==t&&(this._xrSessionManager.trySetViewportForView(this.viewport,e),this.outputRenderTarget=o):(this._xrSessionManager.trySetViewportForView(r.viewport,e),r.outputRenderTarget=o||this._xrSessionManager.getRenderTargetTextureForView(e)),r.layerMask=this.layerMask}))}_updateNumberOfRigCameras(e=1){for(;this.rigCameras.length<e;){const e=new a.C("XR-RigCamera: "+this.rigCameras.length,i.P.Zero(),this.getScene());e.minZ=.1,e.rotationQuaternion=new i._f,e.updateUpVectorFromRotation=!0,e.isRigCamera=!0,e.rigParent=this,e.freezeProjectionMatrix(),this.rigCameras.push(e)}for(;this.rigCameras.length>e;){const e=this.rigCameras.pop();e&&e.dispose()}}_updateReferenceSpace(){if(!this.position.equals(this._referencedPosition)||!this.rotationQuaternion.equals(this._referenceQuaternion)){const e=i.jp.Matrix[0],t=i.jp.Matrix[1],s=i.jp.Matrix[2];i.y3.ComposeToRef(d._ScaleReadOnly,this._referenceQuaternion,this._referencedPosition,e),i.y3.ComposeToRef(d._ScaleReadOnly,this.rotationQuaternion,this.position,t),e.invert().multiplyToRef(t,s),s.invert(),this._scene.useRightHandedSystem||s.toggleModelMatrixHandInPlace(),s.decompose(void 0,this._referenceQuaternion,this._referencedPosition);const r=new XRRigidTransform({x:this._referencedPosition.x,y:this._referencedPosition.y,z:this._referencedPosition.z},{x:this._referenceQuaternion.x,y:this._referenceQuaternion.y,z:this._referenceQuaternion.z,w:this._referenceQuaternion.w});this._xrSessionManager.referenceSpace=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(r)}}}d._ScaleReadOnly=i.P.One()},33102:(e,t,s)=>{s.d(t,{B:()=>d});var i=s(90570),r=s(428),n=s(59237),a=s(79326),o=s(62510),h=s(54774),l=s(84318);class d{constructor(){}static CreateAsync(e,t={}){const s=new d;if(e.onDisposeObservable.addOnce((()=>{s.dispose()})),!t.disableDefaultUI){const i={renderTarget:s.renderTarget,...t.uiOptions||{}};t.optionalFeatures&&("boolean"==typeof t.optionalFeatures?i.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:i.optionalFeatures=t.optionalFeatures),s.enterExitUI=new o.Af(e,i)}return i.M.CreateAsync(e).then((e=>{if(s.baseExperience=e,t.ignoreNativeCameraTransformation&&(s.baseExperience.camera.compensateOnFirstFrame=!1),s.input=new r.t(e.sessionManager,e.camera,{controllerOptions:{renderingGroupId:t.renderingGroupId},...t.inputOptions||{}}),!t.disablePointerSelection){const e={...t.pointerSelectionOptions,xrInput:s.input,renderingGroupId:t.renderingGroupId};s.pointerSelection=s.baseExperience.featuresManager.enableFeature(n.S.Name,t.useStablePlugins?"stable":"latest",e),t.disableTeleportation||(s.teleportation=s.baseExperience.featuresManager.enableFeature(h.z.Name,t.useStablePlugins?"stable":"latest",{floorMeshes:t.floorMeshes,xrInput:s.input,renderingGroupId:t.renderingGroupId,...t.teleportationOptions}),s.teleportation.setSelectionFeature(s.pointerSelection))}return t.disableNearInteraction||(s.nearInteraction=s.baseExperience.featuresManager.enableFeature(a.X.Name,t.useStablePlugins?"stable":"latest",{xrInput:s.input,farInteractionFeature:s.pointerSelection,renderingGroupId:t.renderingGroupId,useUtilityLayer:!0,enableNearInteractionOnAllControllers:!0,...t.nearInteractionOptions})),s.renderTarget=s.baseExperience.sessionManager.getWebXRRenderTarget(t.outputCanvasOptions),t.disableDefaultUI?void 0:s.enterExitUI.setHelperAsync(s.baseExperience,s.renderTarget)})).then((()=>s)).catch((e=>(l.Y.Error("Error initializing XR"),l.Y.Error(e),s)))}dispose(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()}}},62510:(e,t,s)=>{s.d(t,{Af:()=>o});var i=s(62897),r=s(9022),n=s(13514);class a{constructor(e,t,s){this.element=e,this.sessionMode=t,this.referenceSpaceType=s}update(e){}}class o{constructor(e,t){if(this._scene=e,this.options=t,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new i.y$,this._onSessionGranted=e=>{this._helper&&this._enterXRWithButtonIndex(0)},this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),!t.ignoreSessionGrantedEvent&&navigator.xr&&navigator.xr.addEventListener("sessiongranted",this._onSessionGranted),"undefined"!=typeof window&&window.location&&"http:"===window.location.protocol&&"localhost"!==window.location.hostname)throw n.w1.Warn("WebXR can only be served over HTTPS"),new Error("WebXR can only be served over HTTPS");if(t.customButtons)this._buttons=t.customButtons;else{this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;";const e=t.sessionMode||"immersive-vr",s=t.referenceSpaceType||"local-floor";let i=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+("undefined"==typeof SVGSVGElement?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";i+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';const r=document.createElement("style");r.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(r);const n=document.createElement("button");n.className="babylonVRicon",n.title=`${e} - ${s}`,this._buttons.push(new a(n,e,s)),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",n.className="babylonVRicon"+(e===this?" vrdisplaypresenting":"")},this._updateButtons(null)}const s=e.getEngine().getInputElement();s&&s.parentNode&&(s.parentNode.appendChild(this.overlay),e.onDisposeObservable.addOnce((()=>{this.dispose()})))}async setHelperAsync(e,t){this._helper=e,this._renderTarget=t;const s=this._buttons.map((t=>e.sessionManager.isSessionSupportedAsync(t.sessionMode)));e.onStateChangedObservable.add((e=>{e==r.k.NOT_IN_XR&&this._updateButtons(null)}));(await Promise.all(s)).forEach(((e,t)=>{e?(this.overlay.appendChild(this._buttons[t].element),this._buttons[t].element.onclick=this._enterXRWithButtonIndex.bind(this,t)):n.w1.Warn(`Session mode "${this._buttons[t].sessionMode}" not supported in browser`)}))}static async CreateAsync(e,t,s){const i=new o(e,s);return await i.setHelperAsync(t,s.renderTarget||void 0),i}async _enterXRWithButtonIndex(e=0){if(this._helper.state==r.k.IN_XR)await this._helper.exitXRAsync(),this._updateButtons(null);else if(this._helper.state==r.k.NOT_IN_XR)try{await this._helper.enterXRAsync(this._buttons[e].sessionMode,this._buttons[e].referenceSpaceType,this._renderTarget,{optionalFeatures:this.options.optionalFeatures,requiredFeatures:this.options.requiredFeatures}),this._updateButtons(this._buttons[e])}catch(t){this._updateButtons(null);const s=this._buttons[e].element,i=s.title;s.title="Error entering XR session : "+i,s.classList.add("xr-error"),this.options.onError&&this.options.onError(t)}}dispose(){const e=this._scene.getEngine().getInputElement();e&&e.parentNode&&e.parentNode.contains(this.overlay)&&e.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear(),navigator.xr.removeEventListener("sessiongranted",this._onSessionGranted)}_updateButtons(e){this._activeButton=e,this._buttons.forEach((e=>{e.update(this._activeButton)})),this.activeButtonChangedObservable.notifyObservers(this._activeButton)}}},90570:(e,t,s)=>{s.d(t,{M:()=>c});var i=s(62897),r=s(97654),n=s(52281),a=s(9022),o=s(2914),h=s(84318),l=s(71143),d=s(58095);class c{constructor(e){this._scene=e,this._nonVRCamera=null,this._attachedToElement=!1,this._spectatorCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this._spectatorMode=!1,this._lastTimestamp=0,this.onInitialXRPoseSetObservable=new i.y$,this.onStateChangedObservable=new i.y$,this.state=a.k.NOT_IN_XR,this.sessionManager=new r.g(e),this.camera=new n.o("webxr",e,this.sessionManager),this.featuresManager=new o.d(this.sessionManager),e.onDisposeObservable.addOnce((()=>{this.dispose()}))}static CreateAsync(e){const t=new c(e);return t.sessionManager.initializeAsync().then((()=>(t._supported=!0,t))).catch((e=>{throw t._setState(a.k.NOT_IN_XR),t.dispose(),e}))}dispose(){var e;this.exitXRAsync(),this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),null===(e=this._spectatorCamera)||void 0===e||e.dispose(),this._nonVRCamera&&(this._scene.activeCamera=this._nonVRCamera)}async enterXRAsync(e,t,s=this.sessionManager.getWebXRRenderTarget(),i={}){var r,n,l;if(!this._supported)throw"WebXR not supported in this browser or environment";this._setState(a.k.ENTERING_XR),"viewer"!==t&&"local"!==t&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push(t)),i=await this.featuresManager._extendXRSessionInitObject(i),"immersive-ar"===e&&"unbounded"!==t&&h.Y.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode");try{await this.sessionManager.initializeSessionAsync(e,i),await this.sessionManager.setReferenceSpaceTypeAsync(t);const h=await s.initializeXRLayerAsync(this.sessionManager.session),d={depthFar:this.camera.maxZ||1e4,depthNear:this.camera.minZ};return this.featuresManager.getEnabledFeature(o.b.LAYERS)||(d.baseLayer=h),this.sessionManager.updateRenderState(d),this.sessionManager.runXRRenderLoop(),this._originalSceneAutoClear=this._scene.autoClear,this._nonVRCamera=this._scene.activeCamera,this._attachedToElement=!!(null===(n=null===(r=this._nonVRCamera)||void 0===r?void 0:r.inputs)||void 0===n?void 0:n.attachedToElement),null===(l=this._nonVRCamera)||void 0===l||l.detachControl(),this._scene.activeCamera=this.camera,"immersive-ar"!==e?this._nonXRToXRCamera():(this._scene.autoClear=!1,this.camera.compensateOnFirstFrame=!1,this.camera.position.set(0,0,0),this.camera.rotationQuaternion.set(0,0,0,1)),this.sessionManager.onXRSessionEnded.addOnce((()=>{this.state!==a.k.EXITING_XR&&this._setState(a.k.EXITING_XR),this.camera.rigCameras.forEach((e=>{e.outputRenderTarget=null})),this._scene.autoClear=this._originalSceneAutoClear,this._scene.activeCamera=this._nonVRCamera,this._attachedToElement&&this._nonVRCamera&&this._nonVRCamera.attachControl(!!this._nonVRCamera.inputs.noPreventDefault),"immersive-ar"!==e&&this.camera.compensateOnFirstFrame&&(this._nonVRCamera.setPosition?this._nonVRCamera.setPosition(this.camera.position):this._nonVRCamera.position.copyFrom(this.camera.position)),this._setState(a.k.NOT_IN_XR)})),this.sessionManager.onXRFrameObservable.addOnce((()=>{this._setState(a.k.IN_XR)})),this.sessionManager}catch(e){throw e.message,this._setState(a.k.NOT_IN_XR),e}}exitXRAsync(){return this.state!==a.k.IN_XR?Promise.resolve():(this._setState(a.k.EXITING_XR),this.sessionManager.exitXRAsync())}enableSpectatorMode(e){this._spectatorMode||(this._spectatorMode=!0,this._switchSpectatorMode(e))}disableSpecatatorMode(){this._spectatorMode&&(this._spectatorMode=!1,this._switchSpectatorMode())}_switchSpectatorMode(e){const t=1/((null==e?void 0:e.fps)?e.fps:1e3)*1e3,s=(null==e?void 0:e.preferredCameraIndex)?null==e?void 0:e.preferredCameraIndex:0,i=()=>{if(this._spectatorCamera){this.sessionManager.currentTimestamp-this._lastTimestamp>=t&&(this._lastTimestamp=this.sessionManager.currentTimestamp,this._spectatorCamera.position.copyFrom(this.camera.rigCameras[s].globalPosition),this._spectatorCamera.rotationQuaternion.copyFrom(this.camera.rigCameras[s].absoluteRotation))}};if(this._spectatorMode){if(s>=this.camera.rigCameras.length)throw new Error("the preferred camera index is beyond the length of rig camera array.");const e=()=>{this.state===a.k.IN_XR?(this._spectatorCamera=new l.x("webxr-spectator",d.P.Zero(),this._scene),this._spectatorCamera.rotationQuaternion=new d._f,this._scene.activeCameras=[this.camera,this._spectatorCamera],this.sessionManager.onXRFrameObservable.add(i),this._scene.onAfterRenderCameraObservable.add((e=>{e===this.camera&&(this._scene.getEngine().framebufferDimensionsObject=null)}))):this.state===a.k.EXITING_XR&&(this.sessionManager.onXRFrameObservable.removeCallback(i),this._scene.activeCameras=null)};this.onStateChangedObservable.add(e),e()}else this.sessionManager.onXRFrameObservable.removeCallback(i),this._scene.activeCameras=[this.camera]}_nonXRToXRCamera(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)}_setState(e){this.state!==e&&(this.state=e,this.onStateChangedObservable.notifyObservers(this.state))}}},2914:(e,t,s)=>{s.d(t,{b:()=>r,d:()=>n});var i=s(13514);class r{}r.ANCHOR_SYSTEM="xr-anchor-system",r.BACKGROUND_REMOVER="xr-background-remover",r.HIT_TEST="xr-hit-test",r.MESH_DETECTION="xr-mesh-detection",r.PHYSICS_CONTROLLERS="xr-physics-controller",r.PLANE_DETECTION="xr-plane-detection",r.POINTER_SELECTION="xr-controller-pointer-selection",r.TELEPORTATION="xr-controller-teleportation",r.FEATURE_POINTS="xr-feature-points",r.HAND_TRACKING="xr-hand-tracking",r.IMAGE_TRACKING="xr-image-tracking",r.NEAR_INTERACTION="xr-near-interaction",r.DOM_OVERLAY="xr-dom-overlay",r.MOVEMENT="xr-controller-movement",r.LIGHT_ESTIMATION="xr-light-estimation",r.EYE_TRACKING="xr-eye-tracking",r.WALKING_LOCOMOTION="xr-walking-locomotion",r.LAYERS="xr-layers";class n{constructor(e){this._xrSessionManager=e,this._features={},this._xrSessionManager.onXRSessionInit.add((()=>{this.getEnabledFeatures().forEach((e=>{const t=this._features[e];!t.enabled||t.featureImplementation.attached||t.featureImplementation.disableAutoAttach||this.attachFeature(e)}))})),this._xrSessionManager.onXRSessionEnded.add((()=>{this.getEnabledFeatures().forEach((e=>{const t=this._features[e];t.enabled&&t.featureImplementation.attached&&this.detachFeature(e)}))}))}static AddWebXRFeature(e,t,s=1,i=!1){this._AvailableFeatures[e]=this._AvailableFeatures[e]||{latest:s},s>this._AvailableFeatures[e].latest&&(this._AvailableFeatures[e].latest=s),i&&(this._AvailableFeatures[e].stable=s),this._AvailableFeatures[e][s]=t}static ConstructFeature(e,t=1,s,i){const r=this._AvailableFeatures[e][t];if(!r)throw new Error("feature not found");return r(s,i)}static GetAvailableFeatures(){return Object.keys(this._AvailableFeatures)}static GetAvailableVersions(e){return Object.keys(this._AvailableFeatures[e])}static GetLatestVersionOfFeature(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].latest||-1}static GetStableVersionOfFeature(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].stable||-1}attachFeature(e){const t=this._features[e];t&&t.enabled&&!t.featureImplementation.attached&&t.featureImplementation.attach()}detachFeature(e){const t=this._features[e];t&&t.featureImplementation.attached&&t.featureImplementation.detach()}disableFeature(e){const t="string"==typeof e?e:e.Name,s=this._features[t];return!(!s||!s.enabled)&&(s.enabled=!1,this.detachFeature(t),s.featureImplementation.dispose(),delete this._features[t],!0)}dispose(){this.getEnabledFeatures().forEach((e=>{this.disableFeature(e)}))}enableFeature(e,t="latest",s={},r=!0,a=!0){const o="string"==typeof e?e:e.Name;let h=0;if("string"==typeof t){if(!t)throw new Error(`Error in provided version - ${o} (${t})`);if(h="stable"===t?n.GetStableVersionOfFeature(o):"latest"===t?n.GetLatestVersionOfFeature(o):+t,-1===h||isNaN(h))throw new Error(`feature not found - ${o} (${t})`)}else h=t;const l=n._ConflictingFeatures[o];if(void 0!==l&&-1!==this.getEnabledFeatures().indexOf(l))throw new Error(`Feature ${o} cannot be enabled while ${l} is enabled.`);const d=this._features[o],c=n.ConstructFeature(o,h,this._xrSessionManager,s);if(!c)throw new Error(`feature not found - ${o}`);d&&this.disableFeature(o);const u=c();if(u.dependsOn){const e=u.dependsOn.every((e=>!!this._features[e]));if(!e)throw new Error(`Dependant features missing. Make sure the following features are enabled - ${u.dependsOn.join(", ")}`)}if(u.isCompatible())return this._features[o]={featureImplementation:u,enabled:!0,version:h,required:a},r?this._xrSessionManager.session&&!this._features[o].featureImplementation.attached&&this.attachFeature(o):this._features[o].featureImplementation.disableAutoAttach=!0,this._features[o].featureImplementation;if(a)throw new Error("required feature not compatible");return i.w1.Warn(`Feature ${o} not compatible with the current environment/browser and was not enabled.`),u}getEnabledFeature(e){return this._features[e]&&this._features[e].featureImplementation}getEnabledFeatures(){return Object.keys(this._features)}async _extendXRSessionInitObject(e){const t=this.getEnabledFeatures();for(const s of t){const t=this._features[s],i=t.featureImplementation.xrNativeFeatureName;if(i&&(t.required?(e.requiredFeatures=e.requiredFeatures||[],-1===e.requiredFeatures.indexOf(i)&&e.requiredFeatures.push(i)):(e.optionalFeatures=e.optionalFeatures||[],-1===e.optionalFeatures.indexOf(i)&&e.optionalFeatures.push(i))),t.featureImplementation.getXRSessionInitExtension){const s=await t.featureImplementation.getXRSessionInitExtension();e={...e,...s}}}return e}}n._AvailableFeatures={},n._ConflictingFeatures={[r.TELEPORTATION]:r.MOVEMENT,[r.MOVEMENT]:r.TELEPORTATION}},428:(e,t,s)=>{s.d(t,{t:()=>a});var i=s(62897),r=s(5412),n=s(51917);class a{constructor(e,t,s={}){if(this.xrSessionManager=e,this.xrCamera=t,this._options=s,this.controllers=[],this.onControllerAddedObservable=new i.y$,this.onControllerRemovedObservable=new i.y$,this._onInputSourcesChange=e=>{this._addAndRemoveControllers(e.added,e.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add((()=>{this._addAndRemoveControllers([],this.controllers.map((e=>e.inputSource)))})),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add((e=>{e.addEventListener("inputsourceschange",this._onInputSourcesChange)})),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add((e=>{this.controllers.forEach((t=>{t.updateFromXRFrame(e,this.xrSessionManager.referenceSpace,this.xrCamera)}))})),this._options.customControllersRepositoryURL&&(n.V.BaseRepositoryUrl=this._options.customControllersRepositoryURL),n.V.UseOnlineRepository=!this._options.disableOnlineControllerRepository,n.V.UseOnlineRepository)try{n.V.UpdateProfilesList().catch((()=>{n.V.UseOnlineRepository=!1}))}catch(e){n.V.UseOnlineRepository=!1}}_addAndRemoveControllers(e,t){const s=this.controllers.map((e=>e.inputSource));for(const t of e)if(-1===s.indexOf(t)){const e=new r.e(this.xrSessionManager.scene,t,{...this._options.controllerOptions||{},forceControllerProfile:this._options.forceInputProfile,doNotLoadControllerMesh:this._options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this._options.disableControllerAnimation});this.controllers.push(e),this.onControllerAddedObservable.notifyObservers(e)}const i=[],n=[];this.controllers.forEach((e=>{-1===t.indexOf(e.inputSource)?i.push(e):n.push(e)})),this.controllers=i,n.forEach((e=>{this.onControllerRemovedObservable.notifyObservers(e),e.dispose()}))}dispose(){this.controllers.forEach((e=>{e.dispose()})),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear(),n.V.ClearControllerCache()}}},5412:(e,t,s)=>{s.d(t,{e:()=>l});var i=s(62897),r=s(71419),n=s(58095),a=s(51917),o=s(13514);let h=0;class l{constructor(e,t,s={}){this._scene=e,this.inputSource=t,this._options=s,this._tmpVector=new n.P,this._disposed=!1,this.onDisposeObservable=new i.y$,this.onMeshLoadedObservable=new i.y$,this.onMotionControllerInitObservable=new i.y$,this._uniqueId=`controller-${h++}-${t.targetRayMode}-${t.handedness}`,this.pointer=new r.x(`${this._uniqueId}-pointer`,e),this.pointer.rotationQuaternion=new n._f,this.inputSource.gripSpace&&(this.grip=new r.x(`${this._uniqueId}-grip`,this._scene),this.grip.rotationQuaternion=new n._f),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&"tracked-pointer"===this.inputSource.targetRayMode&&a.V.GetMotionControllerWithXRInput(t,e,this._options.forceControllerProfile).then((e=>{this.motionController=e,this.onMotionControllerInitObservable.notifyObservers(e),this._options.doNotLoadControllerMesh||this.motionController._doNotLoadControllerMesh||this.motionController.loadModel().then((e=>{var t;e&&this.motionController&&this.motionController.rootMesh&&(this._options.renderingGroupId&&(this.motionController.rootMesh.renderingGroupId=this._options.renderingGroupId,this.motionController.rootMesh.getChildMeshes(!1).forEach((e=>e.renderingGroupId=this._options.renderingGroupId))),this.onMeshLoadedObservable.notifyObservers(this.motionController.rootMesh),this.motionController.rootMesh.parent=this.grip||this.pointer,this.motionController.disableAnimation=!!this._options.disableMotionControllerAnimation),this._disposed&&(null===(t=this.motionController)||void 0===t||t.dispose())}))}),(()=>{o.w1.Warn("Could not find a matching motion controller for the registered input source")}))}get uniqueId(){return this._uniqueId}dispose(){this.grip&&this.grip.dispose(!0),this.motionController&&this.motionController.dispose(),this.pointer.dispose(!0),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0}getWorldPointerRayToRef(e,t=!1){const s=t&&this.grip?this.grip:this.pointer;n.P.TransformNormalToRef(this._tmpVector,s.getWorldMatrix(),e.direction),e.direction.normalize(),e.origin.copyFrom(s.absolutePosition),e.length=1e3}updateFromXRFrame(e,t,s){const i=e.getPose(this.inputSource.targetRaySpace,t);if(this._lastXRPose=i,i){const e=i.transform.position;this.pointer.position.set(e.x,e.y,e.z);const t=i.transform.orientation;this.pointer.rotationQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1),this.pointer.parent=s.parent}if(this.inputSource.gripSpace&&this.grip){const i=e.getPose(this.inputSource.gripSpace,t);if(i){const e=i.transform.position,t=i.transform.orientation;this.grip.position.set(e.x,e.y,e.z),this.grip.rotationQuaternion.set(t.x,t.y,t.z,t.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}this.grip.parent=s.parent}this.motionController&&this.motionController.updateFromXRFrame(e)}}},64829:(e,t,s)=>{s.d(t,{s:()=>i});class i{get isFixedFoveationSupported(){return"XRWebGLLayer"==this.layerType&&"number"==typeof this.layer.fixedFoveation}get fixedFoveation(){return this.isFixedFoveationSupported?this.layer.fixedFoveation:null}set fixedFoveation(e){if(this.isFixedFoveationSupported){const t=Math.max(0,Math.min(1,e||0));this.layer.fixedFoveation=t}}constructor(e,t,s,i,r){this.getWidth=e,this.getHeight=t,this.layer=s,this.layerType=i,this.createRenderTargetTextureProvider=r}}},3195:(e,t,s)=>{s.d(t,{_:()=>a,n:()=>o});var i=s(62897),r=s(13514),n=s(44347);class a{static GetDefaults(e){const t=new a;return t.canvasOptions={antialias:!0,depth:!0,stencil:!e||e.isStencilEnable,alpha:!0,framebufferScaleFactor:1},t.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",t}}class o{constructor(e,t=a.GetDefaults()){if(this._options=t,this._canvas=null,this._engine=null,this.xrLayer=null,this._xrLayerWrapper=null,this.onXRLayerInitObservable=new i.y$,this._engine=e.scene.getEngine(),this._engine.onDisposeObservable.addOnce((()=>{this._engine=null})),t.canvasElement)this._setManagedOutputCanvas(t.canvasElement);else{const e=document.createElement("canvas");e.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(e)}e.onXRSessionInit.add((()=>{this._addCanvas()})),e.onXRSessionEnded.add((()=>{this._removeCanvas()}))}dispose(){this._removeCanvas(),this._setManagedOutputCanvas(null)}async initializeXRLayerAsync(e){const t=()=>(this.xrLayer=new XRWebGLLayer(e,this.canvasContext,this._options.canvasOptions),this._xrLayerWrapper=new n.J(this.xrLayer),this.onXRLayerInitObservable.notifyObservers(this.xrLayer),this.xrLayer);return this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then((()=>{}),(()=>{r.w1.Warn("Error executing makeXRCompatible. This does not mean that the session will work incorrectly.")})).then((()=>t())):Promise.resolve(t())}_addCanvas(){this._canvas&&this._engine&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce((()=>{this._setCanvasSize(!0)}))}_removeCanvas(){this._canvas&&this._engine&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)}_setCanvasSize(e=!0,t=this._xrLayerWrapper){this._canvas&&this._engine&&(e?t&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=t.getWidth()+"px",this._canvas.style.height=t.getHeight()+"px"):this._engine.setSize(t.getWidth(),t.getHeight())):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))}_setManagedOutputCanvas(e){this._removeCanvas(),e?(this._originalCanvasSize={width:e.offsetWidth,height:e.offsetHeight},this._canvas=e,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)}}},69022:(e,t,s)=>{s.d(t,{y:()=>o});var i=s(61319),r=s(59157),n=s(19363),a=s(63784);class o{constructor(e,t){this._scene=e,this.layerWrapper=t,this._renderTargetTextures=new Array,this._engine=e.getEngine()}_createInternalTexture(e,t){const s=new r.l(this._engine,r.S.Unknown,!0);return s.width=e.width,s.height=e.height,s._hardwareTexture=new i.B(t,this._engine._gl),s.isReady=!0,s}_createRenderTargetTexture(e,t,s,i,r,o){if(!this._engine)throw new Error("Engine is disposed");const h={width:e,height:t},l=o?new n.x(this._scene,h):new a._("XR renderTargetTexture",h,this._scene),d=l.renderTarget;if(d._samples=l.samples,!s&&i||(d._framebuffer=s),i)if(o)d._colorTextureArray=i;else{const e=this._createInternalTexture(h,i);d.setTexture(e,0),l._texture=e}return r&&(o?d._depthStencilTextureArray=r:d._depthStencilTexture=this._createInternalTexture(h,r)),l.disableRescaling(),"undefined"!=typeof XRWebGLBinding&&(l.skipInitialClear=!0),this._renderTargetTextures.push(l),l}_destroyRenderTargetTexture(e){this._renderTargetTextures.splice(this._renderTargetTextures.indexOf(e),1),e.dispose()}getFramebufferDimensions(){return this._framebufferDimensions}dispose(){this._renderTargetTextures.forEach((e=>e.dispose())),this._renderTargetTextures.length=0}}},97654:(e,t,s)=>{s.d(t,{g:()=>h});var i=s(84318),r=s(62897),n=s(3195),a=s(16485),o=s(44347);class h{constructor(e){this.scene=e,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new r.y$,this.onXRReferenceSpaceChanged=new r.y$,this.onXRSessionEnded=new r.y$,this.onXRSessionInit=new r.y$,this.inXRFrameLoop=!1,this.inXRSession=!1,this._engine=e.getEngine(),this._onEngineDisposedObserver=this._engine.onDisposeObservable.addOnce((()=>{this._engine=null})),e.onDisposeObservable.addOnce((()=>{this.dispose()}))}get referenceSpace(){return this._referenceSpace}set referenceSpace(e){this._referenceSpace=e,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)}get sessionMode(){return this._sessionMode}dispose(){var e;this.inXRSession&&this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear(),null===(e=this._engine)||void 0===e||e.onDisposeObservable.remove(this._onEngineDisposedObserver),this._engine=null}exitXRAsync(){return this.session&&this.inXRSession?(this.inXRSession=!1,this.session.end().catch((()=>{i.Y.Warn("Could not end XR session.")}))):Promise.resolve()}trySetViewportForView(e,t){var s;return(null===(s=this._baseLayerRTTProvider)||void 0===s?void 0:s.trySetViewportForView(e,t))||!1}getRenderTargetTextureForEye(e){var t;return(null===(t=this._baseLayerRTTProvider)||void 0===t?void 0:t.getRenderTargetTextureForEye(e))||null}getRenderTargetTextureForView(e){var t;return(null===(t=this._baseLayerRTTProvider)||void 0===t?void 0:t.getRenderTargetTextureForView(e))||null}getWebXRRenderTarget(e){const t=this.scene.getEngine();return this._xrNavigator.xr.native?new a.HK(this):((e=e||n._.GetDefaults(t)).canvasElement=e.canvasElement||t.getRenderingCanvas()||void 0,new n.n(this,e))}initializeAsync(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")}initializeSessionAsync(e="immersive-vr",t={}){return this._xrNavigator.xr.requestSession(e,t).then((t=>(this.session=t,this._sessionMode=e,this.onXRSessionInit.notifyObservers(t),this.inXRSession=!0,this.session.addEventListener("end",(()=>{var e;this.inXRSession=!1,this.onXRSessionEnded.notifyObservers(null),this._engine&&(this._engine.framebufferDimensionsObject=null,this._engine.restoreDefaultFramebuffer(),this._engine.customAnimationFrameRequester=null,this._engine._renderLoop()),this.isNative&&(null===(e=this._baseLayerRTTProvider)||void 0===e||e.dispose()),this._baseLayerRTTProvider=null,this._baseLayerWrapper=null}),{once:!0}),this.session)))}isSessionSupportedAsync(e){return h.IsSessionSupportedAsync(e)}resetReferenceSpace(){this.referenceSpace=this.baseReferenceSpace}runXRRenderLoop(){var e;this.inXRSession&&this._engine&&(this._engine.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:(e,t)=>{var s;this.inXRSession&&this._engine&&(this.currentFrame=t,this.currentTimestamp=e,t&&(this.inXRFrameLoop=!0,this._engine.framebufferDimensionsObject=(null===(s=this._baseLayerRTTProvider)||void 0===s?void 0:s.getFramebufferDimensions())||null,this.onXRFrameObservable.notifyObservers(t),this._engine._renderLoop(),this._engine.framebufferDimensionsObject=null,this.inXRFrameLoop=!1))}},this._engine.framebufferDimensionsObject=(null===(e=this._baseLayerRTTProvider)||void 0===e?void 0:e.getFramebufferDimensions())||null,"undefined"!=typeof window&&window.cancelAnimationFrame&&window.cancelAnimationFrame(this._engine._frameHandler),this._engine._renderLoop())}setReferenceSpaceTypeAsync(e="local-floor"){return this.session.requestReferenceSpace(e).then((e=>e),(e=>(i.Y.Error("XR.requestReferenceSpace failed for the following reason: "),i.Y.Error(e),i.Y.Log('Defaulting to universally-supported "viewer" reference space type.'),this.session.requestReferenceSpace("viewer").then((e=>{const t=new XRRigidTransform({x:0,y:-this.defaultHeightCompensation,z:0});return e.getOffsetReferenceSpace(t)}),(e=>{throw i.Y.Error(e),'XR initialization failed: required "viewer" reference space type not supported.'}))))).then((e=>this.session.requestReferenceSpace("viewer").then((t=>(this.viewerReferenceSpace=t,e))))).then((e=>(this.referenceSpace=this.baseReferenceSpace=e,this.referenceSpace)))}updateRenderStateAsync(e){return Promise.resolve(this.session.updateRenderState(e))}_setBaseLayerWrapper(e){var t,s;this.isNative&&(null===(t=this._baseLayerRTTProvider)||void 0===t||t.dispose()),this._baseLayerWrapper=e,this._baseLayerRTTProvider=(null===(s=this._baseLayerWrapper)||void 0===s?void 0:s.createRenderTargetTextureProvider(this))||null}updateRenderState(e){e.baseLayer&&this._setBaseLayerWrapper(this.isNative?new a.z5(e.baseLayer):new o.J(e.baseLayer)),this.session.updateRenderState(e)}static IsSessionSupportedAsync(e){if(!navigator.xr)return Promise.resolve(!1);const t=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return t?t.call(navigator.xr,e).then((e=>{const t=void 0===e||e;return Promise.resolve(t)})).catch((e=>(i.Y.Warn(e),Promise.resolve(!1)))):Promise.resolve(!1)}get isNative(){var e;return null!==(e=this._xrNavigator.xr.native)&&void 0!==e&&e}get currentFrameRate(){var e;return null===(e=this.session)||void 0===e?void 0:e.frameRate}get supportedFrameRates(){var e;return null===(e=this.session)||void 0===e?void 0:e.supportedFrameRates}updateTargetFrameRate(e){return this.session.updateTargetFrameRate(e)}runInXRFrame(e,t=!0){this.inXRFrameLoop?e():!this.inXRSession&&t||this.onXRFrameObservable.addOnce(e)}get isFixedFoveationSupported(){var e;return(null===(e=this._baseLayerWrapper)||void 0===e?void 0:e.isFixedFoveationSupported)||!1}get fixedFoveation(){var e;return(null===(e=this._baseLayerWrapper)||void 0===e?void 0:e.fixedFoveation)||null}set fixedFoveation(e){const t=Math.max(0,Math.min(1,e||0));this._baseLayerWrapper&&(this._baseLayerWrapper.fixedFoveation=t)}}},9022:(e,t,s)=>{var i,r;s.d(t,{j:()=>r,k:()=>i}),function(e){e[e.ENTERING_XR=0]="ENTERING_XR",e[e.EXITING_XR=1]="EXITING_XR",e[e.IN_XR=2]="IN_XR",e[e.NOT_IN_XR=3]="NOT_IN_XR"}(i||(i={})),function(e){e[e.NOT_TRACKING=0]="NOT_TRACKING",e[e.TRACKING_LOST=1]="TRACKING_LOST",e[e.TRACKING=2]="TRACKING"}(r||(r={}))},44347:(e,t,s)=>{s.d(t,{J:()=>n});var i=s(64829),r=s(69022);class n extends i.s{constructor(e){super((()=>e.framebufferWidth),(()=>e.framebufferHeight),e,"XRWebGLLayer",(e=>new a(e.scene,this))),this.layer=e}}class a extends r.y{constructor(e,t){super(e,t),this.layerWrapper=t,this._layer=t.layer,this._framebufferDimensions={framebufferWidth:this._layer.framebufferWidth,framebufferHeight:this._layer.framebufferHeight}}trySetViewportForView(e,t){const s=this._layer.getViewport(t);if(!s)return!1;const i=this._framebufferDimensions.framebufferWidth,r=this._framebufferDimensions.framebufferHeight;return e.x=s.x/i,e.y=s.y/r,e.width=s.width/i,e.height=s.height/r,!0}getRenderTargetTextureForEye(e){const t=this._layer.framebufferWidth,s=this._layer.framebufferHeight,i=this._layer.framebuffer;return this._rtt&&t===this._framebufferDimensions.framebufferWidth&&s===this._framebufferDimensions.framebufferHeight&&i===this._framebuffer||(this._rtt=this._createRenderTargetTexture(t,s,i),this._framebufferDimensions.framebufferWidth=t,this._framebufferDimensions.framebufferHeight=s,this._framebuffer=i),this._rtt}getRenderTargetTextureForView(e){return this.getRenderTargetTextureForEye(e.eye)}}},57755:(e,t,s)=>{s.d(t,{p:()=>i});class i{constructor(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}static AddParser(e,t){this._BabylonFileParsers[e]=t}static GetParser(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null}static AddIndividualParser(e,t){this._IndividualBabylonFileParsers[e]=t}static GetIndividualParser(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null}static Parse(e,t,s,i){for(const r in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,r)&&this._BabylonFileParsers[r](e,t,s,i)}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture=e}getNodes(){let e=new Array;return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach((t=>e=e.concat(t.bones))),e}}i._BabylonFileParsers={},i._IndividualBabylonFileParsers={}},7701:(e,t,s)=>{s.d(t,{TJ:()=>g});var i=s(57755),r=s(91243),n=s(30700),a=s(84318),o=s(15210),h=s(63003),l=s(43812),d=s(2055),c=s(13514);class u extends i.p{}class _{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((e=>{e.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((e=>{e.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((e=>{e.dispose()})),this.animationGroups.length=0}}class g extends i.p{constructor(e){super(),this._wasAddedToScene=!1,(e=e||o.l.LastCreatedScene)&&(this.scene=e,this.sounds=[],this.effectLayers=[],this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.reflectionProbes=[],e.onDisposeObservable.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=e.getEngine().onContextRestoredObservable.add((()=>{for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();for(const e of this.particleSystems)e.rebuild();for(const e of this.textures)e._rebuild()})))}_topologicalSort(e){const t=new Map;for(const s of e)t.set(s.uniqueId,s);const s={dependsOn:new Map,dependedBy:new Map};for(const t of e){const e=t.uniqueId;s.dependsOn.set(e,new Set),s.dependedBy.set(e,new Set)}for(const i of e){const e=i.uniqueId,r=s.dependsOn.get(e);if(i instanceof h.S){const n=i.sourceMesh;t.has(n.uniqueId)&&(r.add(n.uniqueId),s.dependedBy.get(n.uniqueId).add(e))}const n=s.dependedBy.get(e);for(const r of i.getDescendants()){const i=r.uniqueId;if(t.has(i)){n.add(i);s.dependsOn.get(i).add(e)}}}const i=[],r=[];for(const i of e){const e=i.uniqueId;0===s.dependsOn.get(e).size&&(r.push(i),t.delete(e))}const n=r;for(;n.length>0;){const e=n.shift();i.push(e);const r=s.dependedBy.get(e.uniqueId);for(const i of Array.from(r.values())){const r=s.dependsOn.get(i);r.delete(e.uniqueId),0===r.size&&t.get(i)&&(n.push(t.get(i)),t.delete(i))}}return t.size>0&&(console.error("SceneSerializer._topologicalSort: There were unvisited nodes:"),t.forEach((e=>console.error(e.name)))),i}_addNodeAndDescendantsToList(e,t,s,i){if(!(i&&!i(s)||t.has(s.uniqueId))){e.push(s),t.add(s.uniqueId);for(const r of s.getDescendants(!0))this._addNodeAndDescendantsToList(e,t,r,i)}}_isNodeInContainer(e){return e instanceof r.Kj&&-1!==this.meshes.indexOf(e)||(e instanceof n.Y&&-1!==this.transformNodes.indexOf(e)||(e instanceof l._&&-1!==this.lights.indexOf(e)||e instanceof d.V&&-1!==this.cameras.indexOf(e)))}_isValidHierarchy(){for(const e of this.meshes)if(e.parent&&!this._isNodeInContainer(e.parent))return a.Y.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.transformNodes)if(e.parent&&!this._isNodeInContainer(e.parent))return a.Y.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.lights)if(e.parent&&!this._isNodeInContainer(e.parent))return a.Y.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;for(const e of this.cameras)if(e.parent&&!this._isNodeInContainer(e.parent))return a.Y.Warn(`Node ${e.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(e,t=!1,s){this._isValidHierarchy()||c.w1.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const i={},n={},a=new _,o=[],h=[],l={doNotInstantiate:!0,...s};l.doNotInstantiate||(l.doNotInstantiate=e=>!!e.skeleton);const d=[],u=new Set;for(const e of this.transformNodes)null===e.parent&&this._addNodeAndDescendantsToList(d,u,e,l.predicate);for(const e of this.meshes)null===e.parent&&this._addNodeAndDescendantsToList(d,u,e,l.predicate);const g=this._topologicalSort(d),p=(s,o)=>{if(((t,s)=>{if(i[t.uniqueId]=s.uniqueId,n[s.uniqueId]=s,e&&(s.name=e(t.name)),s instanceof r.Kj){const e=s;if(e.morphTargetManager){const s=t.morphTargetManager;e.morphTargetManager=s.clone();for(let t=0;t<s.numTargets;t++){const r=s.getTarget(t),a=e.morphTargetManager.getTarget(t);i[r.uniqueId]=a.uniqueId,n[a.uniqueId]=a}}}})(s,o),s.parent){const e=i[s.parent.uniqueId],t=n[e];o.parent=t||s.parent}if(o.position.copyFrom(s.position),o.rotation.copyFrom(s.rotation),o.scaling.copyFrom(s.scaling),o.material){const r=o;if(r.material)if(t){const t=s.material;if(-1===h.indexOf(t)){let s=t.clone(e?e(t.name):"Clone of "+t.name);if(h.push(t),i[t.uniqueId]=s.uniqueId,n[s.uniqueId]=s,"MultiMaterial"===t.getClassName()){const r=t;for(const t of r.subMaterials)t&&(s=t.clone(e?e(t.name):"Clone of "+t.name),h.push(t),i[t.uniqueId]=s.uniqueId,n[s.uniqueId]=s);r.subMaterials=r.subMaterials.map((e=>e&&n[i[e.uniqueId]]))}}"InstancedMesh"!==r.getClassName()&&(r.material=n[i[t.uniqueId]])}else"MultiMaterial"===r.material.getClassName()?-1===this.scene.multiMaterials.indexOf(r.material)&&this.scene.addMultiMaterial(r.material):-1===this.scene.materials.indexOf(r.material)&&this.scene.addMaterial(r.material)}null===o.parent&&a.rootNodes.push(o)};return g.forEach((e=>{if("InstancedMesh"===e.getClassName()){const t=e,s=t.sourceMesh,r=i[s.uniqueId],a=("number"==typeof r?n[r]:s).createInstance(t.name);p(t,a)}else{const t=!(null==l?void 0:l.doNotInstantiate)&&e.getTotalVertices()>0?e.createInstance(`instance of ${e.name}`):e.clone(`Clone of ${e.name}`,null,!0);if(!t)throw new Error(`Could not clone or instantiate node on Asset Container ${e.name}`);p(e,t)}})),this.skeletons.forEach((t=>{if(l.predicate&&!l.predicate(t))return;const s=t.clone(e?e(t.name):"Clone of "+t.name);for(const e of this.meshes)if(e.skeleton===t&&!e.isAnInstance){const t=n[i[e.uniqueId]];if(t.isAnInstance)continue;if(t.skeleton=s,-1!==o.indexOf(s))continue;o.push(s);for(const e of s.bones)e._linkedTransformNode&&(e._linkedTransformNode=n[i[e._linkedTransformNode.uniqueId]])}a.skeletons.push(s)})),this.animationGroups.forEach((t=>{if(l.predicate&&!l.predicate(t))return;const s=t.clone(e?e(t.name):"Clone of "+t.name,(e=>n[i[e.uniqueId]]||e));a.animationGroups.push(s)})),a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||c.w1.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(const e of this.scene._serializableComponents)e.addFromContainer(this);this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(e=null){this.cameras.forEach((t=>{e&&!e(t)||this.scene.addCamera(t)})),this.lights.forEach((t=>{e&&!e(t)||this.scene.addLight(t)})),this.meshes.forEach((t=>{e&&!e(t)||this.scene.addMesh(t)})),this.skeletons.forEach((t=>{e&&!e(t)||this.scene.addSkeleton(t)})),this.animations.forEach((t=>{e&&!e(t)||this.scene.addAnimation(t)})),this.animationGroups.forEach((t=>{e&&!e(t)||this.scene.addAnimationGroup(t)})),this.multiMaterials.forEach((t=>{e&&!e(t)||this.scene.addMultiMaterial(t)})),this.materials.forEach((t=>{e&&!e(t)||this.scene.addMaterial(t)})),this.morphTargetManagers.forEach((t=>{e&&!e(t)||this.scene.addMorphTargetManager(t)})),this.geometries.forEach((t=>{e&&!e(t)||this.scene.addGeometry(t)})),this.transformNodes.forEach((t=>{e&&!e(t)||this.scene.addTransformNode(t)})),this.actionManagers.forEach((t=>{e&&!e(t)||this.scene.addActionManager(t)})),this.textures.forEach((t=>{e&&!e(t)||this.scene.addTexture(t)})),this.reflectionProbes.forEach((t=>{e&&!e(t)||this.scene.addReflectionProbe(t)}))}removeAllFromScene(){this._isValidHierarchy()||c.w1.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this)}removeFromScene(e=null){this.cameras.forEach((t=>{e&&!e(t)||this.scene.removeCamera(t)})),this.lights.forEach((t=>{e&&!e(t)||this.scene.removeLight(t)})),this.meshes.forEach((t=>{e&&!e(t)||this.scene.removeMesh(t)})),this.skeletons.forEach((t=>{e&&!e(t)||this.scene.removeSkeleton(t)})),this.animations.forEach((t=>{e&&!e(t)||this.scene.removeAnimation(t)})),this.animationGroups.forEach((t=>{e&&!e(t)||this.scene.removeAnimationGroup(t)})),this.multiMaterials.forEach((t=>{e&&!e(t)||this.scene.removeMultiMaterial(t)})),this.materials.forEach((t=>{e&&!e(t)||this.scene.removeMaterial(t)})),this.morphTargetManagers.forEach((t=>{e&&!e(t)||this.scene.removeMorphTargetManager(t)})),this.geometries.forEach((t=>{e&&!e(t)||this.scene.removeGeometry(t)})),this.transformNodes.forEach((t=>{e&&!e(t)||this.scene.removeTransformNode(t)})),this.actionManagers.forEach((t=>{e&&!e(t)||this.scene.removeActionManager(t)})),this.textures.forEach((t=>{e&&!e(t)||this.scene.removeTexture(t)})),this.reflectionProbes.forEach((t=>{e&&!e(t)||this.scene.removeReflectionProbe(t)}))}dispose(){this.cameras.slice(0).forEach((e=>{e.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((e=>{e.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((e=>{e.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((e=>{e.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((e=>{e.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((e=>{e.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((e=>{e.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((e=>{e.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((e=>{e.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((e=>{e.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((e=>{e.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((e=>{e.dispose()})),this.reflectionProbes.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.scene._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(e,t,s){if(e&&t)for(const i of e){let e=!0;if(s)for(const t of s)if(i===t){e=!1;break}e&&(t.push(i),i._parentContainer=this)}}moveAllFromScene(e){this._wasAddedToScene=!1,void 0===e&&(e=new u);for(const t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||("_environmentTexture"===t?null:[]),this._moveAssets(this.scene[t],this[t],e[t]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()}createRootMesh(){const e=new r.Kj("assetContainerRootMesh",this.scene);return this.meshes.forEach((t=>{t.parent||e.addChild(t)})),this.meshes.unshift(e),e}mergeAnimationsTo(e=o.l.LastCreatedScene,t,s=null){if(!e)return a.Y.Error("No scene available to merge animations to"),[];const i=s||(t=>{let s=null;const i=t.animations.length?t.animations[0].targetProperty:"",r=t.name.split(".").join("").split("_primitive")[0];switch(i){case"position":case"rotationQuaternion":s=e.getTransformNodeByName(t.name)||e.getTransformNodeByName(r);break;case"influence":s=e.getMorphTargetByName(t.name)||e.getMorphTargetByName(r);break;default:s=e.getNodeByName(t.name)||e.getNodeByName(r)}return s});this.getNodes().forEach((e=>{const t=i(e);if(null!==t){for(const s of e.animations){const e=t.animations.filter((e=>e.targetProperty===s.targetProperty));for(const s of e){const e=t.animations.indexOf(s,0);e>-1&&t.animations.splice(e,1)}}t.animations=t.animations.concat(e.animations)}}));const r=new Array;return this.animationGroups.slice().forEach((e=>{r.push(e.clone(e.name,i)),e.animatables.forEach((e=>{e.stop()}))})),t.forEach((t=>{const s=i(t.target);s&&(e.beginAnimation(s,t.fromFrame,t.toFrame,t.loopAnimation,t.speedRatio,t.onAnimationEnd?t.onAnimationEnd:void 0,void 0,!0,void 0,t.onAnimationLoop?t.onAnimationLoop:void 0),e.stopAnimation(t.target))})),r}}},73737:(e,t,s)=>{s.d(t,{eWS:()=>i.eW,Jlu:()=>i.Jl});s(57755),s(58873),s(96088),s(7701),s(35716),s(82576),s(45647),s(95358),s(71927),s(94474),s(71218),s(93553),s(25235),s(67152),s(5185),s(53128),s(32050),s(26449),s(76239),s(78097),s(70127),s(48858),s(98878),s(25340),s(32664),s(86075),s(71312);var i=s(78821);s(82799),s(5257),s(17834),s(8820),s(1345),s(52311),s(34898),s(6044),s(98004),s(65273),s(85627),s(29318),s(16199),s(23626),s(65826),s(77840)},17834:(e,t,s)=>{s.d(t,{N:()=>d});var i=s(72433),r=s(58095),n=s(96969),a=s(62897),o=s(15210),h=s(77851);class l{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new a.y$,this._onClonedObservable=new a.y$}}class d{static AddNodeConstructor(e,t){this._NodeConstructors[e]=t}static Construct(e,t,s,i){const r=this._NodeConstructors[e];return r?r(t,s,i):null}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(e){this._nodeDataStorage._doNotSerialize=e}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(e){if(this._parentNode===e)return;const t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(e){e.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}getClassName(){return"Node"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(e,t=null){this._isDirty=!1,this._nodeDataStorage=new l,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new a.y$,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=r.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new a.y$,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||o.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(e,t=!1){return-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((()=>{e.attach(this)})):e.attach(this),this._behaviors.push(e)),this}removeBehavior(e){const t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(e){for(const t of this._behaviors)if(t.name===e)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={},this._cache.parent=void 0}updateCache(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())}_getActionManagerForTrigger(e,t=!0){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null}_updateCache(e){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(e=!1){return this._nodeDataStorage._isReady}markAsDirty(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(e=!0){return!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((e=>{e._syncParentEnabledState()}))}setEnabled(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e))}isDescendantOf(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))}_getDescendants(e,t=!1,s){if(this._children)for(let i=0;i<this._children.length;i++){const r=this._children[i];s&&!s(r)||e.push(r),t||r._getDescendants(e,!1,s)}}getDescendants(e,t){const s=new Array;return this._getDescendants(s,e,t),s}getChildMeshes(e,t){const s=[];return this._getDescendants(s,e,(e=>(!t||t(e))&&void 0!==e.cullingStrategy)),s}getChildren(e,t=!0){return this.getDescendants(t,e)}_setReady(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(e){for(let t=0;t<this.animations.length;t++){const s=this.animations[t];if(s.name===e)return s}return null}createAnimationRange(e,t,s){if(!this._ranges[e]){this._ranges[e]=d._AnimationRangeFactory(e,t,s);for(let i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].createRange(e,t,s)}}deleteAnimationRange(e,t=!0){for(let s=0,i=this.animations.length;s<i;s++)this.animations[s]&&this.animations[s].deleteRange(e,t);this._ranges[e]=null}getAnimationRange(e){return this._ranges[e]||null}getAnimationRanges(){const e=[];let t;for(t in this._ranges)e.push(this._ranges[t]);return e}beginAnimation(e,t,s,i){const r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,s,i):null}serializeAnimationRanges(){const e=[];for(const t in this._ranges){const s=this._ranges[t];if(!s)continue;const i={};i.name=t,i.from=s.from,i.to=s.to,e.push(i)}return e}computeWorldMatrix(e){return this._worldMatrix||(this._worldMatrix=r.y3.Identity()),this._worldMatrix}dispose(e,t=!1){if(this._nodeDataStorage._isDisposed=!0,!e){const s=this.getDescendants(!0);for(const i of s)i.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const e of this._behaviors)e.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(e,t,s){if(t.ranges)for(let s=0;s<t.ranges.length;s++){const i=t.ranges[s];e.createAnimationRange(i.name,i.from,i.to)}}getHierarchyBoundingVectors(e=!0,t=null){let s,i;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const n=this;if(n.getBoundingInfo&&n.subMeshes){const e=n.getBoundingInfo();s=e.boundingBox.minimumWorld.clone(),i=e.boundingBox.maximumWorld.clone()}else s=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const e=this.getDescendants(!1);for(const n of e){const e=n;if(e.computeWorldMatrix(!0),t&&!t(e))continue;if(!e.getBoundingInfo||0===e.getTotalVertices())continue;const a=e.getBoundingInfo().boundingBox,o=a.minimumWorld,h=a.maximumWorld;r.P.CheckExtends(o,s,i),r.P.CheckExtends(h,s,i)}}return{min:s,max:i}}}d._AnimationRangeFactory=(e,t,s)=>{throw(0,h.S)("AnimationRange")},d._NodeConstructors={},(0,i.gn)([(0,n.qC)()],d.prototype,"name",void 0),(0,i.gn)([(0,n.qC)()],d.prototype,"id",void 0),(0,i.gn)([(0,n.qC)()],d.prototype,"uniqueId",void 0),(0,i.gn)([(0,n.qC)()],d.prototype,"state",void 0),(0,i.gn)([(0,n.qC)()],d.prototype,"metadata",void 0)},65273:(e,t,s)=>{s.d(t,{a:()=>i,x:()=>N});var i,r=s(13514),n=s(29945),a=s(62897),o=s(7788),h=s(45008),l=s(20163),d=s(58095),c=s(57755),u=s(90622),_=s(83353),g=s(5292),p=s(23954),m=s(1421),f=s(70235),v=s(85627),b=s(80352),y=s(15210),C=s(77851),M=s(55526),R=s(82577),x=s(15631),T=s(84319),O=s(46310),I=s(79245),E=s(51011),A=s(48939);!function(e){e[e.BackwardCompatible=0]="BackwardCompatible",e[e.Intermediate=1]="Intermediate",e[e.Aggressive=2]="Aggressive"}(i||(i={}));class N extends c.p{static DefaultMaterialFactory(e){throw(0,C.S)("StandardMaterial")}static CollisionCoordinatorFactory(){throw(0,C.S)("DefaultCollisionCoordinator")}get environmentTexture(){return this._environmentTexture}set environmentTexture(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(e){if(e!==this._performancePriority)switch(this._performancePriority=e,e){case i.BackwardCompatible:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case i.Intermediate:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case i.Aggressive:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}}set forceWireframe(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(e){this._animationPropertiesOverride=e}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set beforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}set afterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}set beforeCameraRender(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}set afterCameraRender(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return M.$.DragMovementThreshold}static set DragMovementThreshold(e){M.$.DragMovementThreshold=e}static get LongPressDelay(){return M.$.LongPressDelay}static set LongPressDelay(e){M.$.LongPressDelay=e}static get DoubleClickDelay(){return M.$.DoubleClickDelay}static set DoubleClickDelay(e){M.$.DoubleClickDelay=e}static get ExclusiveDoubleClickMode(){return M.$.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(e){M.$.ExclusiveDoubleClickMode=e}bindEyePosition(e,t="vEyePosition",s=!1){var i;const r=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:null!==(i=this.activeCamera.globalPosition)&&void 0!==i?i:this.activeCamera.devicePosition,n=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return d.jp.Vector4[0].set(r.x,r.y,r.z,n?-1:1),e&&(s?e.setFloat3(t,d.jp.Vector4[0].x,d.jp.Vector4[0].y,d.jp.Vector4[0].z):e.setVector4(t,d.jp.Vector4[0])),d.jp.Vector4[0]}finalizeSceneUbo(){const e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}set useRightHandedSystem(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(e){this._currentStepId=e}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(e){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=(0,A.M)(e,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=e}get activeCamera(){return this._activeCamera}set activeCamera(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=N.DefaultMaterialFactory(this)),this._defaultMaterial}set defaultMaterial(e){this._defaultMaterial=e}set texturesEnabled(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}set skeletonsEnabled(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=N.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const e of this._transientComponents)e.register();this._transientComponents.length=0}}_addComponent(e){this._components.push(e),this._transientComponents.push(e);const t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}_getComponent(e){for(const t of this._components)if(t.name===e)return t;return null}constructor(e,t){super(),this._inputManager=new M.$(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new x.HE(.2,.2,.3,1),this.ambientColor=new x.Wo(0,0,0),this.environmentIntensity=1,this._performancePriority=i.BackwardCompatible,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=new Array,this.onDisposeObservable=new a.y$,this._onDisposeObserver=null,this.onBeforeRenderObservable=new a.y$,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new a.y$,this.onAfterRenderCameraObservable=new a.y$,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new a.y$,this.onAfterAnimationsObservable=new a.y$,this.onBeforeDrawPhaseObservable=new a.y$,this.onAfterDrawPhaseObservable=new a.y$,this.onReadyObservable=new a.y$,this.onBeforeCameraRenderObservable=new a.y$,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new a.y$,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new a.y$,this.onAfterActiveMeshesEvaluationObservable=new a.y$,this.onBeforeParticlesRenderingObservable=new a.y$,this.onAfterParticlesRenderingObservable=new a.y$,this.onDataLoadedObservable=new a.y$,this.onNewCameraAddedObservable=new a.y$,this.onCameraRemovedObservable=new a.y$,this.onNewLightAddedObservable=new a.y$,this.onLightRemovedObservable=new a.y$,this.onNewGeometryAddedObservable=new a.y$,this.onGeometryRemovedObservable=new a.y$,this.onNewTransformNodeAddedObservable=new a.y$,this.onTransformNodeRemovedObservable=new a.y$,this.onNewMeshAddedObservable=new a.y$,this.onMeshRemovedObservable=new a.y$,this.onNewSkeletonAddedObservable=new a.y$,this.onSkeletonRemovedObservable=new a.y$,this.onNewMaterialAddedObservable=new a.y$,this.onNewMultiMaterialAddedObservable=new a.y$,this.onMaterialRemovedObservable=new a.y$,this.onMultiMaterialRemovedObservable=new a.y$,this.onNewTextureAddedObservable=new a.y$,this.onTextureRemovedObservable=new a.y$,this.onBeforeRenderTargetsRenderObservable=new a.y$,this.onAfterRenderTargetsRenderObservable=new a.y$,this.onBeforeStepObservable=new a.y$,this.onAfterStepObservable=new a.y$,this.onActiveCameraChanged=new a.y$,this.onActiveCamerasChanged=new a.y$,this.onBeforeRenderingGroupObservable=new a.y$,this.onAfterRenderingGroupObservable=new a.y$,this.onMeshImportedObservable=new a.y$,this.onAnimationFileImportedObservable=new a.y$,this._registeredForLateAnimationBindings=new o.f(256),this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1,this.onPrePointerObservable=new a.y$,this.onPointerObservable=new a.y$,this.onPreKeyboardObservable=new a.y$,this.onKeyboardObservable=new a.y$,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=N.FOGMODE_NONE,this.fogColor=new x.Wo(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new d.P(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this.probesEnabled=!0,this._meshesForIntersections=new o.f(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new R.z,this._activeIndices=new R.z,this._activeParticles=new R.z,this._activeBones=new R.z,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new o.t(256),this._processedMaterials=new o.t(256),this._renderTargets=new o.f(256),this._materialsRenderTargets=new o.f(256),this._activeParticleSystems=new o.t(256),this._activeSkeletons=new o.f(32),this._softwareSkinnedMeshes=new o.f(32),this._activeAnimatables=new Array,this._transformMatrix=d.y3.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=v.H.Create(),this._beforeClearStage=v.H.Create(),this._beforeRenderTargetClearStage=v.H.Create(),this._gatherRenderTargetsStage=v.H.Create(),this._gatherActiveCameraRenderTargetsStage=v.H.Create(),this._isReadyForMeshStage=v.H.Create(),this._beforeEvaluateActiveMeshStage=v.H.Create(),this._evaluateSubMeshStage=v.H.Create(),this._preActiveMeshStage=v.H.Create(),this._cameraDrawRenderTargetStage=v.H.Create(),this._beforeCameraDrawStage=v.H.Create(),this._beforeRenderTargetDrawStage=v.H.Create(),this._beforeRenderingGroupDrawStage=v.H.Create(),this._beforeRenderingMeshStage=v.H.Create(),this._afterRenderingMeshStage=v.H.Create(),this._afterRenderingGroupDrawStage=v.H.Create(),this._afterCameraDrawStage=v.H.Create(),this._afterCameraPostProcessStage=v.H.Create(),this._afterRenderTargetDrawStage=v.H.Create(),this._afterRenderTargetPostProcessStage=v.H.Create(),this._afterRenderStage=v.H.Create(),this._pointerMoveStage=v.H.Create(),this._pointerDownStage=v.H.Create(),this._pointerUpStage=v.H.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=new Array;const s={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...t};this._engine=e||y.l.LastCreatedEngine,s.virtual?this._engine._virtualScenes.push(this):(y.l._LastCreatedScene=this,this._engine.scenes.push(this)),this._uid=null,this._renderingManager=new f.$(this),m.O&&(this.postProcessManager=new m.O(this)),(0,b.CG)()&&this.attachControl(),this._createUbo(),u.$&&(this._imageProcessingConfiguration=new u.$),this.setDefaultCandidateProviders(),s.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=s.useMaterialMeshMap,this.useClonedMeshMap=s.useClonedMeshMap,t&&t.virtual||this._engine.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(e){this._inputManager.pointerX=e}get pointerY(){return this._inputManager.pointerY}set pointerY(e){this._inputManager.pointerY=e}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(e,t,s=1){return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==s}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(e,t){return this._inputManager.simulatePointerMove(e,t),this}simulatePointerDown(e,t){return this._inputManager.simulatePointerDown(e,t),this}simulatePointerUp(e,t,s){return this._inputManager.simulatePointerUp(e,t,s),this}isPointerCaptured(e=0){return this._inputManager.isPointerCaptured(e)}attachControl(e=!0,t=!0,s=!0){this._inputManager.attachControl(e,t,s)}detachControl(){this._inputManager.detachControl()}isReady(e=!0){if(this._isDisposed)return!1;let t;const s=this.getEngine();let i=!0;for(this._pendingData.length>0&&(i=!1),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){const r=this.meshes[t];if(!r.subMeshes||0===r.subMeshes.length)continue;if(!r.isReady(!0)){i=!1;continue}const n=r.hasThinInstances||"InstancedMesh"===r.getClassName()||"InstancedLinesMesh"===r.getClassName()||s.getCaps().instancedArrays&&r.instances.length>0;for(const e of this._isReadyForMeshStage)e.action(r,n)||(i=!1);if(!e)continue;const a=r.material||this.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(const e of r.subMeshes){const t=e.getMaterial();t&&t.hasRenderTargetTextures&&null!=t.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(t)&&(this._processedMaterials.push(t),this._materialsRenderTargets.concatWithNoDuplicate(t.getRenderTargetTextures()))}else a.hasRenderTargetTextures&&null!=a.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(a)&&(this._processedMaterials.push(a),this._materialsRenderTargets.concatWithNoDuplicate(a.getRenderTargetTextures()))}if(!i)return!1;if(!s.areAllEffectsReady())return!1;if(e)for(t=0;t<this._materialsRenderTargets.length;++t){if(!this._materialsRenderTargets.data[t].isReadyForRendering())return!1}for(t=0;t<this.geometries.length;t++){if(2===this.geometries[t].delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0){for(const e of this.activeCameras)if(!e.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(const e of this.particleSystems)if(!e.isReady())return!1;return!0}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(e){this.onBeforeRenderObservable.add(e)}unregisterBeforeRender(e){this.onBeforeRenderObservable.removeCallback(e)}registerAfterRender(e){this.onAfterRenderObservable.add(e)}unregisterAfterRender(e){this.onAfterRenderObservable.removeCallback(e)}_executeOnceBeforeRender(e){const t=()=>{e(),setTimeout((()=>{this.unregisterBeforeRender(t)}))};this.registerBeforeRender(t)}executeOnceBeforeRender(e,t){void 0!==t?setTimeout((()=>{this._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)}addPendingData(e){this._pendingData.push(e)}removePendingData(e){const t=this.isLoading,s=this._pendingData.indexOf(e);-1!==s&&this._pendingData.splice(s,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(e,t=!1){this.onReadyObservable.addOnce(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)}whenReadyAsync(e=!1){return new Promise((t=>{this.executeWhenReady((()=>{t()}),e)}))}_checkIsReady(e=!1){return this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(e)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=n.F.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(e,t,s,i){s||i||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?T.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=T.i.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(s,i):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(e){const t=new _.M(this._engine,void 0,!1,null!=e?e:"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}setSceneUniformBuffer(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return O.K.UniqueId}addMesh(e,t=!1){this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.addMesh(e)})))}removeMesh(e,t=!1){const s=this.meshes.indexOf(e);return-1!==s&&(this.meshes[s]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((e=>{this.removeMesh(e)})),s}addTransformNode(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}removeTransformNode(e){const t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){const e=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=e,e._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}removeSkeleton(e){const t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeMorphTargetManager(e){const t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t}removeLight(e){const t=this.lights.indexOf(e);if(-1!==t){for(const t of this.meshes)t._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}removeCamera(e){const t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){const t=this.activeCameras.indexOf(e);-1!==t&&this.activeCameras.splice(t,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}removeParticleSystem(e){const t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}removeAnimation(e){const t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t}stopAnimation(e,t,s){}removeAnimationGroup(e){const t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t}removeMultiMaterial(e){const t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}removeMaterial(e){const t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){const e=this.materials[this.materials.length-1];this.materials[t]=e,e._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}removeActionManager(e){const t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t}removeTexture(e){const t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}addLight(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(const t of this.meshes)-1===t.lightSources.indexOf(e)&&(t.lightSources.push(e),t._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(e)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(E.m.CompareLightsPriority)}addCamera(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())}addSkeleton(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))}addParticleSystem(e){this._blockEntityCollection||this.particleSystems.push(e)}addAnimation(e){this._blockEntityCollection||this.animations.push(e)}addAnimationGroup(e){this._blockEntityCollection||this.animationGroups.push(e)}addMultiMaterial(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))}addMaterial(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))}addMorphTargetManager(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}addGeometry(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))}addActionManager(e){this.actionManagers.push(e)}addTexture(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}switchActiveCamera(e,t=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}setActiveCameraById(e){const t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}setActiveCameraByName(e){const t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}getAnimationGroupByName(e){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}_getMaterial(e,t){for(let e=0;e<this.materials.length;e++){const s=this.materials[e];if(t(s))return s}if(e)for(let e=0;e<this.multiMaterials.length;e++){const s=this.multiMaterials[e];if(t(s))return s}return null}getMaterialByUniqueID(e,t=!1){return this._getMaterial(t,(t=>t.uniqueId===e))}getMaterialById(e,t=!1){return this._getMaterial(t,(t=>t.id===e))}getMaterialByName(e,t=!1){return this._getMaterial(t,(t=>t.name===e))}getLastMaterialById(e,t=!1){for(let t=this.materials.length-1;t>=0;t--)if(this.materials[t].id===e)return this.materials[t];if(t)for(let t=this.multiMaterials.length-1;t>=0;t--)if(this.multiMaterials[t].id===e)return this.multiMaterials[t];return null}getTextureByUniqueId(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null}getTextureByName(e){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}getCameraById(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}getCameraByUniqueId(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null}getCameraByName(e){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}getBoneById(e){for(let t=0;t<this.skeletons.length;t++){const s=this.skeletons[t];for(let t=0;t<s.bones.length;t++)if(s.bones[t].id===e)return s.bones[t]}return null}getBoneByName(e){for(let t=0;t<this.skeletons.length;t++){const s=this.skeletons[t];for(let t=0;t<s.bones.length;t++)if(s.bones[t].name===e)return s.bones[t]}return null}getLightByName(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}getLightById(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}getLightByUniqueId(e){for(let t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null}getParticleSystemById(e){for(let t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}getGeometryById(e){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}_getGeometryByUniqueId(e){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null}pushGeometry(e,t){return!(!t&&this._getGeometryByUniqueId(e.uniqueId))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)}removeGeometry(e){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[e.uniqueId],void 0===t)return!1}else if(t=this.geometries.indexOf(e),t<0)return!1;if(t!==this.geometries.length-1){const e=this.geometries[this.geometries.length-1];e&&(this.geometries[t]=e,this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}getGeometries(){return this.geometries}getMeshById(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}getMeshesById(e){return this.meshes.filter((function(t){return t.id===e}))}getTransformNodeById(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}getTransformNodeByUniqueId(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null}getTransformNodesById(e){return this.transformNodes.filter((function(t){return t.id===e}))}getMeshByUniqueId(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null}getLastMeshById(e){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}getLastEntryById(e){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}getNodeById(e){const t=this.getMeshById(e);if(t)return t;const s=this.getTransformNodeById(e);if(s)return s;const i=this.getLightById(e);if(i)return i;const r=this.getCameraById(e);if(r)return r;const n=this.getBoneById(e);return n||null}getNodeByName(e){const t=this.getMeshByName(e);if(t)return t;const s=this.getTransformNodeByName(e);if(s)return s;const i=this.getLightByName(e);if(i)return i;const r=this.getCameraByName(e);if(r)return r;const n=this.getBoneByName(e);return n||null}getMeshByName(e){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}getTransformNodeByName(e){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}getLastSkeletonById(e){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByUniqueId(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null}getSkeletonById(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}getSkeletonByName(e){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}getMorphTargetManagerById(e){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null}getMorphTargetById(e){for(let t=0;t<this.morphTargetManagers.length;++t){const s=this.morphTargetManagers[t];for(let t=0;t<s.numTargets;++t){const i=s.getTarget(t);if(i.id===e)return i}}return null}getMorphTargetByName(e){for(let t=0;t<this.morphTargetManagers.length;++t){const s=this.morphTargetManagers[t];for(let t=0;t<s.numTargets;++t){const i=s.getTarget(t);if(i.name===e)return i}}return null}getPostProcessByName(e){for(let t=0;t<this.postProcesses.length;++t){const s=this.postProcesses[t];if(s.name===e)return s}return null}isActiveMesh(e){return-1!==this._activeMeshes.indexOf(e)}get uid(){return this._uid||(this._uid=r.w1.RandomId()),this._uid}addExternalData(e,t){return this._externalData||(this._externalData=new h.x),this._externalData.add(e,t)}getExternalData(e){return this._externalData?this._externalData.get(e):null}getOrAddExternalDataWithFactory(e,t){return this._externalData||(this._externalData=new h.x),this._externalData.getOrAddWithFactory(e,t)}removeExternalData(e){return this._externalData.remove(e)}_evaluateSubMesh(e,t,s,i){if(i||e.isInFrustum(this._frustumPlanes)){for(const s of this._evaluateSubMeshStage)s.action(t,e);const s=e.getMaterial();null!=s&&(s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,s))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let e=0;e<this.textures.length;e++){const t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(e=!1,t,s,i=!0,r=!1){return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=r,this._skipEvaluateActiveMeshesCompletely=e,i)for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._freeze();t&&t()}else s&&s("No active camera found")})),this}unfreezeActiveMeshes(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>e.dispose()))}_evaluateActiveMeshes(){var e;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)return void(this._activeMeshes.length>0&&(null===(e=this.activeCamera)||void 0===e||e._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset()));if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const e=this._activeMeshes.length;for(let t=0;t<e;t++){this._activeMeshes.data[t].computeWorldMatrix()}}if(this._activeParticleSystems){const e=this._activeParticleSystems.length;for(let t=0;t<e;t++)this._activeParticleSystems.data[t].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const e of this._beforeEvaluateActiveMeshStage)e.action();const t=this.getActiveMeshCandidates(),s=t.length;for(let e=0;e<s;e++){const s=t.data[e];if(s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,s.isBlocked)continue;if(this._totalVertices.addCount(s.getTotalVertices(),!1),!s.isReady()||!s.isEnabled()||s.scaling.hasAZeroComponent)continue;s.computeWorldMatrix(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s);let i=this.customLODSelector?this.customLODSelector(s,this.activeCamera):s.getLOD(this.activeCamera);if(s._internalAbstractMeshDataInfo._currentLOD=i,s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,null!=i&&(i!==s&&0!==i.billboardMode&&i.computeWorldMatrix(),s._preActivate(),s.isVisible&&s.visibility>0&&0!=(s.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||s.alwaysSelectAsActiveMesh||s.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),i!==s&&i._activate(this._renderId,!1);for(const e of this._preActiveMeshStage)e.action(s);s._activate(this._renderId,!1)&&(s.isAnInstance?s._internalAbstractMeshDataInfo._actAsRegularMesh&&(i=s):i._internalAbstractMeshDataInfo._onlyForInstances=!1,i._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(s,i)),s._postActivate()}}if(this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let e=0;e<this.particleSystems.length;e++){const t=this.particleSystems[e];if(!t.isStarted()||!t.emitter)continue;const s=t.emitter;s.position&&!s.isEnabled()||(this._activeParticleSystems.push(t),t.animate(),this._renderingManager.dispatchParticles(t))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_activeMesh(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));let s=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){const i=this.getActiveSubMeshCandidates(t),r=i.length;s=s||1===r;for(let n=0;n<r;n++){const r=i.data[n];this._evaluateSubMesh(r,t,e,s)}}}updateTransformMatrix(e){if(this.activeCamera)if(this.activeCamera._renderingMultiview){const t=this.activeCamera._rigCameras[0],s=this.activeCamera._rigCameras[1];this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e),s.getViewMatrix(),s.getProjectionMatrix(e))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))}_bindFrameBuffer(e,t=!0){e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)}_clearFrameBuffer(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget&&!e._renderingMultiview){const t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||(this.autoClear&&this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(e,t,s=!0){var i,n,a;if(e&&e._skipRendering)return;const o=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(o.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&s){let t=!0;e._renderingMultiview&&e.outputRenderTarget&&(t=e.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=t)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let e=0;e<this._softwareSkinnedMeshes.length;e++){const t=this._softwareSkinnedMeshes.data[e];t.applySkeleton(t.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const e of this._gatherActiveCameraRenderTargetsStage)e.action(this._renderTargets);let h=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){r.w1.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let e=0;e<this._renderTargets.length;e++){const t=this._renderTargets.data[e];if(t._shouldRender()){this._renderId++;const e=t.activeCamera&&t.activeCamera!==this.activeCamera;t.render(e,this.dumpNextRenderTargets),h=!0}}r.w1.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const e of this._cameraDrawRenderTargetStage)h=e.action(this.activeCamera)||h;this._intermediateRendering=!1}this._engine.currentRenderPassId=null!==(a=null!==(n=null===(i=e.outputRenderTarget)||void 0===i?void 0:i.renderPassId)&&void 0!==n?n:e.renderPassId)&&void 0!==a?a:0,h&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const e of this._beforeCameraDrawStage)e.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),o.snapshotRendering&&1===o.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const e of this._afterCameraDrawStage)e.action(this.activeCamera);if(this.postProcessManager&&!e._multiviewTexture){const t=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,t)}for(const e of this._afterCameraPostProcessStage)e.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(e,t=!0){if(0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(let t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}_checkIntersections(){for(let e=0;e<this._meshesForIntersections.length;e++){const t=this._meshesForIntersections.data[e];if(t.actionManager)for(let e=0;t.actionManager&&e<t.actionManager.actions.length;e++){const s=t.actionManager.actions[e];if(12===s.trigger||13===s.trigger){const e=s.getTriggerParameter(),i=e.mesh?e.mesh:e,r=i.intersectsMesh(t,e.usePreciseIntersection),n=t._intersectionsInProgress.indexOf(i);r&&-1===n?12===s.trigger?(s._executeCurrent(p.V.CreateNew(t,void 0,i)),t._intersectionsInProgress.push(i)):13===s.trigger&&t._intersectionsInProgress.push(i):!r&&n>-1&&(13===s.trigger&&s._executeCurrent(p.V.CreateNew(t,void 0,i)),t.actionManager.hasSpecificTrigger(13,(e=>{const t=e.mesh?e.mesh:e;return i===t}))&&13!==s.trigger||t._intersectionsInProgress.splice(n,1))}}}}_advancePhysicsEngineStep(e){}_animate(){}animate(){if(this._engine.isDeterministicLockStep()){let e=Math.max(N.MinDeltaTime,Math.min(this._engine.getDeltaTime(),N.MaxDeltaTime))+this._timeAccumulator;const t=this._engine.getTimeStep(),s=1e3/t/1e3;let i=0;const r=this._engine.getLockstepMaxSteps();let n=Math.floor(e/t);for(n=Math.min(n,r);e>0&&i<n;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*s,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,i++,e-=t;this._timeAccumulator=e<0?0:e}else{const e=this.useConstantAnimationDeltaTime?16:Math.max(N.MinDeltaTime,Math.min(this._engine.getDeltaTime(),N.MaxDeltaTime));this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(e){var t;if((null==e?void 0:e.outputRenderTarget)&&!(null==e?void 0:e.isRigCamera)&&(e.outputRenderTarget._cleared=!1),null===(t=null==e?void 0:e.rigCameras)||void 0===t?void 0:t.length)for(let t=0;t<e.rigCameras.length;++t){const s=e.rigCameras[t].outputRenderTarget;s&&(s._cleared=!1)}}resetDrawCache(e){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(e)}render(e=!0,t=!1){var s,i,n;if(this.isDisposed)return;this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(null===(s=this.activeCameras)||void 0===s?void 0:s.length)&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(const e of this._beforeCameraUpdateStage)e.action();if(e)if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++){const t=this.activeCameras[e];if(t.update(),0!==t.cameraRigMode)for(let e=0;e<t._rigCameras.length;e++)t._rigCameras[e].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let e=0;e<this.activeCamera._rigCameras.length;e++)this.activeCamera._rigCameras[e].update();this.onBeforeRenderObservable.notifyObservers(this);const a=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const o=(null===(i=this.activeCameras)||void 0===i?void 0:i.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){r.w1.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let e=0;e<this.customRenderTargets.length;e++){const t=this.customRenderTargets[e];if(t._shouldRender()){if(this._renderId++,this.activeCamera=t.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");a.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),t.render(o!==this.activeCamera,this.dumpNextRenderTargets)}}r.w1.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!==(n=null==o?void 0:o.renderPassId)&&void 0!==n?n:0,this.activeCamera=o,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const e of this._beforeClearStage)e.action();this._clearFrameBuffer(this.activeCamera);for(const e of this._gatherRenderTargetsStage)e.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++)this._processSubCameras(this.activeCameras[e],e>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(const e of this._afterRenderStage)e.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let e=0;e<this._toBeDisposed.length;e++){const t=this._toBeDisposed[e];t&&t.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}freezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].freeze()}unfreezeMaterials(){for(let e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const e=this._activeRequests.slice();for(const t of e)t.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(e){console.error("An error occurred while calling onDisposeObservable!",e)}this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();if(this._engine.getInputElement())for(let e=0;e<this.cameras.length;e++)this.cameras[e].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(e=>e.dispose(!0))),this._disposeList(this.transformNodes,(e=>e.dispose(!0)));const t=this.cameras;this._disposeList(t),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let s=this._engine.scenes.indexOf(this);s>-1&&this._engine.scenes.splice(s,1),y.l._LastCreatedScene===this&&(this._engine.scenes.length>0?y.l._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:y.l._LastCreatedScene=null),s=this._engine._virtualScenes.indexOf(this),s>-1&&this._engine._virtualScenes.splice(s,1),this._engine.wipeCaches(!0),this._isDisposed=!0}_disposeList(e,t){const s=e.slice(0);t=null!=t?t:e=>e.dispose();for(const e of s)t(e);e.length=0}get isDisposed(){return this._isDisposed}clearCachedVertexData(){for(let e=0;e<this.meshes.length;e++){const t=this.meshes[e].geometry;t&&t.clearCachedData()}}cleanCachedTextureBuffer(){for(const e of this.textures){e._buffer&&(e._buffer=null)}}getWorldExtends(e){const t=new d.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new d.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||(()=>!0),this.meshes.filter(e).forEach((e=>{if(e.computeWorldMatrix(!0),!e.subMeshes||0===e.subMeshes.length||e.infiniteDistance)return;const i=e.getBoundingInfo(),r=i.boundingBox.minimumWorld,n=i.boundingBox.maximumWorld;d.P.CheckExtends(r,t,s),d.P.CheckExtends(n,t,s)})),{min:t,max:s}}createPickingRay(e,t,s,i,r=!1){throw(0,C.S)("Ray")}createPickingRayToRef(e,t,s,i,r,n=!1,a=!1){throw(0,C.S)("Ray")}createPickingRayInCameraSpace(e,t,s){throw(0,C.S)("Ray")}createPickingRayInCameraSpaceToRef(e,t,s,i){throw(0,C.S)("Ray")}get _pickingAvailable(){return!1}pick(e,t,s,i,r,n){return new g.p}pickWithBoundingInfo(e,t,s,i,r){return new g.p}pickWithRay(e,t,s,i){throw(0,C.S)("Ray")}multiPick(e,t,s,i,r){throw(0,C.S)("Ray")}multiPickWithRay(e,t,s){throw(0,C.S)("Ray")}setPointerOverMesh(e,t,s){this._inputManager.setPointerOverMesh(e,t,s)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const e of this.geometries)e._rebuild();for(const e of this.meshes)e._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const e of this._components)e.rebuild();for(const e of this.particleSystems)e.rebuild();if(this.spriteManagers)for(const e of this.spriteManagers)e.rebuild()}_rebuildTextures(){for(const e of this.textures)e._rebuild();this.markAllMaterialsAsDirty(1)}_getByTags(e,t,s){if(void 0===t)return e;const i=[];s=s||(e=>{});for(const r in e){const n=e[r];l.$&&l.$.MatchesQuery(n,t)&&(i.push(n),s(n))}return i}getMeshesByTags(e,t){return this._getByTags(this.meshes,e,t)}getCamerasByTags(e,t){return this._getByTags(this.cameras,e,t)}getLightsByTags(e,t){return this._getByTags(this.lights,e,t)}getMaterialByTags(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}getTransformNodesByTags(e,t){return this._getByTags(this.transformNodes,e,t)}setRenderingOrder(e,t=null,s=null,i=null){this._renderingManager.setRenderingOrder(e,t,s,i)}setRenderingAutoClearDepthStencil(e,t,s=!0,i=!0){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,s,i)}getAutoClearDepthStencilSetup(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(e,t){if(!this._blockMaterialDirtyMechanism)for(const s of this.materials)t&&!t(s)||s.markAsDirty(e)}_loadFile(e,t,s,i,r,n,a){const o=(0,I.vP)(e,t,s,i?this.offlineProvider:void 0,r,n,a);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}_loadFileAsync(e,t,s,i,r){return new Promise(((n,a)=>{this._loadFile(e,(e=>{n(e)}),t,s,i,((e,t)=>{a(t)}),r)}))}_requestFile(e,t,s,i,r,n,a){const o=(0,I.FV)(e,t,s,i?this.offlineProvider:void 0,r,n,a);return this._activeRequests.push(o),o.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),o}_requestFileAsync(e,t,s,i,r){return new Promise(((n,a)=>{this._requestFile(e,(e=>{n(e)}),t,s,i,(e=>{a(e)}),r)}))}_readFile(e,t,s,i,r){const n=(0,I.Ip)(e,t,s,i,r);return this._activeRequests.push(n),n.onCompleteObservable.add((e=>{this._activeRequests.splice(this._activeRequests.indexOf(e),1)})),n}_readFileAsync(e,t,s){return new Promise(((i,r)=>{this._readFile(e,(e=>{i(e)}),t,s,(e=>{r(e)}))}))}getPerfCollector(){throw(0,C.S)("performanceViewerSceneExtension")}}N.FOGMODE_NONE=0,N.FOGMODE_EXP=1,N.FOGMODE_EXP2=2,N.FOGMODE_LINEAR=3,N.MinDeltaTime=1,N.MaxDeltaTime=1e3,N.prototype.setActiveCameraByID=function(e){return this.setActiveCameraById(e)},N.prototype.getLastMaterialByID=function(e){return this.getLastMaterialById(e)},N.prototype.getMaterialByID=function(e){return this.getMaterialById(e)},N.prototype.getTextureByUniqueID=function(e){return this.getTextureByUniqueId(e)},N.prototype.getCameraByID=function(e){return this.getCameraById(e)},N.prototype.getCameraByUniqueID=function(e){return this.getCameraByUniqueId(e)},N.prototype.getBoneByID=function(e){return this.getBoneById(e)},N.prototype.getLightByID=function(e){return this.getLightById(e)},N.prototype.getLightByUniqueID=function(e){return this.getLightByUniqueId(e)},N.prototype.getParticleSystemByID=function(e){return this.getParticleSystemById(e)},N.prototype.getGeometryByID=function(e){return this.getGeometryById(e)},N.prototype.getMeshByID=function(e){return this.getMeshById(e)},N.prototype.getMeshesByID=function(e){return this.getMeshesById(e)},N.prototype.getTransformNodeByID=function(e){return this.getTransformNodeById(e)},N.prototype.getTransformNodeByUniqueID=function(e){return this.getTransformNodeByUniqueId(e)},N.prototype.getTransformNodesByID=function(e){return this.getTransformNodesById(e)},N.prototype.getMeshByUniqueID=function(e){return this.getMeshByUniqueId(e)},N.prototype.getLastMeshByID=function(e){return this.getLastMeshById(e)},N.prototype.getLastEntryByID=function(e){return this.getLastEntryById(e)},N.prototype.getNodeByID=function(e){return this.getNodeById(e)},N.prototype.getLastSkeletonByID=function(e){return this.getLastSkeletonById(e)}},85627:(e,t,s)=>{s.d(t,{H:()=>r,l:()=>i});class i{}i.NAME_EFFECTLAYER="EffectLayer",i.NAME_LAYER="Layer",i.NAME_LENSFLARESYSTEM="LensFlareSystem",i.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",i.NAME_PARTICLESYSTEM="ParticleSystem",i.NAME_GAMEPAD="Gamepad",i.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",i.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",i.NAME_PREPASSRENDERER="PrePassRenderer",i.NAME_DEPTHRENDERER="DepthRenderer",i.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",i.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",i.NAME_SPRITE="Sprite",i.NAME_SUBSURFACE="SubSurface",i.NAME_OUTLINERENDERER="Outline",i.NAME_PROCEDURALTEXTURE="ProceduralTexture",i.NAME_SHADOWGENERATOR="ShadowGenerator",i.NAME_OCTREE="Octree",i.NAME_PHYSICSENGINE="PhysicsEngine",i.NAME_AUDIO="Audio",i.NAME_FLUIDRENDERER="FluidRenderer",i.STEP_ISREADYFORMESH_EFFECTLAYER=0,i.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,i.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,i.STEP_BEFORECAMERADRAW_PREPASS=0,i.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,i.STEP_BEFORECAMERADRAW_LAYER=2,i.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,i.STEP_BEFORERENDERTARGETDRAW_LAYER=1,i.STEP_BEFORERENDERINGMESH_PREPASS=0,i.STEP_BEFORERENDERINGMESH_OUTLINE=1,i.STEP_AFTERRENDERINGMESH_PREPASS=0,i.STEP_AFTERRENDERINGMESH_OUTLINE=1,i.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,i.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,i.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,i.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,i.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,i.STEP_BEFORECLEAR_PREPASS=1,i.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,i.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,i.STEP_AFTERRENDERTARGETDRAW_LAYER=1,i.STEP_AFTERCAMERADRAW_PREPASS=0,i.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,i.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,i.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,i.STEP_AFTERCAMERADRAW_LAYER=4,i.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,i.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,i.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,i.STEP_AFTERRENDER_AUDIO=0,i.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,i.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,i.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,i.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,i.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,i.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,i.STEP_POINTERMOVE_SPRITE=0,i.STEP_POINTERDOWN_SPRITE=0,i.STEP_POINTERUP_SPRITE=0;class r extends Array{constructor(e){super(...e)}static Create(){return Object.create(r.prototype)}registerStep(e,t,s){let i=0,r=Number.MAX_VALUE;for(;i<this.length;i++){if(r=this[i].index,e<r)break}this.splice(i,0,{index:e,component:t,action:s.bind(t)})}clear(){this.length=0}}},72433:(e,t,s)=>{s.d(t,{gn:()=>i});function i(e,t,s,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(n<3?r(a):n>3?r(t,s,a):r(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a}Object.create;Object.create},31652:(e,t,s)=>{s.d(t,{i:()=>x});var i=s(62897),r=s(58095),n=s(13514),a=s(76324),o=s(72693),h=s(63737),l=s(73803),d=s(93980),c=s(15772),u=s(90558),_=s(76728),g=s(55905);class p{constructor(e){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new g.s(18,g.s.UNITMODE_PIXEL,!1),this.onChangedObservable=new i.y$,this._host=e}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&this.onChangedObservable.notifyObservers(this)}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.onChangedObservable.notifyObservers(this))}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.onChangedObservable.notifyObservers(this))}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.onChangedObservable.notifyObservers(this))}dispose(){this.onChangedObservable.clear()}}var m=s(42238),f=s(34941),v=s(66513),b=s(15631),y=s(51912),C=s(54007),M=s(48620),R=s(29972);class x extends d.c{get numLayoutCalls(){return this._numLayoutCalls}get numRenderCalls(){return this._numRenderCalls}get renderScale(){return this._renderScale}set renderScale(e){e!==this._renderScale&&(this._renderScale=e,this._onResize())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this.markAsDirty())}get idealWidth(){return this._idealWidth}set idealWidth(e){this._idealWidth!==e&&(this._idealWidth=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get idealHeight(){return this._idealHeight}set idealHeight(e){this._idealHeight!==e&&(this._idealHeight=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get useSmallestIdeal(){return this._useSmallestIdeal}set useSmallestIdeal(e){this._useSmallestIdeal!==e&&(this._useSmallestIdeal=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())}get renderAtIdealSize(){return this._renderAtIdealSize}set renderAtIdealSize(e){this._renderAtIdealSize!==e&&(this._renderAtIdealSize=e,this._onResize())}get idealRatio(){let e=0,t=0;return this._idealWidth&&(e=this.getSize().width/this._idealWidth),this._idealHeight&&(t=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight?window.innerWidth<window.innerHeight?e:t:this._idealWidth?e:this._idealHeight?t:1}get layer(){return this._layerToDispose}get rootContainer(){return this._rootContainer}getChildren(){return[this._rootContainer]}getDescendants(e,t){return this._rootContainer.getDescendants(e,t)}getControlsByType(e){return this._rootContainer.getDescendants(!1,(t=>t.typeName===e))}getControlByName(e){return this._getControlByKey("name",e)}_getControlByKey(e,t){return this._rootContainer.getDescendants().find((s=>s[e]===t))||null}get focusedControl(){return this._focusedControl}set focusedControl(e){this._focusedControl!=e&&(this._focusedControl&&this._focusedControl.onBlur(),e&&e.onFocus(),this._focusedControl=e)}get isForeground(){return!this.layer||!this.layer.isBackground}set isForeground(e){this.layer&&this.layer.isBackground!==!e&&(this.layer.isBackground=!e)}get clipboardData(){return this._clipboardData}set clipboardData(e){this._clipboardData=e}constructor(e,t=0,s=0,r,n=!1,a=l.x.NEAREST_SAMPLINGMODE,d=!0){super(e,{width:t,height:s},r,n,a,f.g.TEXTUREFORMAT_RGBA,d),this.onGuiReadyObservable=new i.y$,this._isDirty=!1,this._rootContainer=new u.W("root"),this._lastControlOver={},this._lastControlDown={},this._capturingControl={},this._linkedControls=new Array,this._isFullscreen=!1,this._fullscreenViewport=new v.l(0,0,1,1),this._idealWidth=0,this._idealHeight=0,this._useSmallestIdeal=!1,this._renderAtIdealSize=!1,this._blockNextFocusCheck=!1,this._renderScale=1,this._cursorChanged=!1,this._defaultMousePointerId=0,this._rootChildrenHaveChanged=!1,this._capturedPointerIds=new Set,this._numLayoutCalls=0,this._numRenderCalls=0,this._clipboardData="",this.onClipboardObservable=new i.y$,this.onControlPickedObservable=new i.y$,this.onBeginLayoutObservable=new i.y$,this.onEndLayoutObservable=new i.y$,this.onBeginRenderObservable=new i.y$,this.onEndRenderObservable=new i.y$,this.premulAlpha=!1,this.applyYInversionOnUpdate=!0,this.checkPointerEveryFrame=!1,this._useInvalidateRectOptimization=!0,this._invalidatedRectangle=null,this._clearMeasure=new m.U(0,0,0,0),this._onClipboardCopy=e=>{const t=e,s=new o.o(o.p.COPY,t);this.onClipboardObservable.notifyObservers(s),t.preventDefault()},this._onClipboardCut=e=>{const t=e,s=new o.o(o.p.CUT,t);this.onClipboardObservable.notifyObservers(s),t.preventDefault()},this._onClipboardPaste=e=>{const t=e,s=new o.o(o.p.PASTE,t);this.onClipboardObservable.notifyObservers(s),t.preventDefault()},this.parseContent=this.parseSerializedObject,(r=this.getScene())&&this._texture&&(this.applyYInversionOnUpdate=d,this._rootElement=r.getEngine().getInputElement(),this._renderObserver=r.onBeforeCameraRenderObservable.add((e=>this._checkUpdate(e))),this._controlAddedObserver=this._rootContainer.onControlAddedObservable.add((e=>{e&&(this._rootChildrenHaveChanged=!0)})),this._controlRemovedObserver=this._rootContainer.onControlRemovedObservable.add((e=>{e&&(this._rootChildrenHaveChanged=!0)})),this._preKeyboardObserver=r.onPreKeyboardObservable.add((e=>{this._focusedControl&&(e.type===h.OG.KEYDOWN&&this._focusedControl.processKeyboard(e.event),e.skipOnPointerObservable=!0)})),this._rootContainer._link(this),this.hasAlpha=!0,t&&s||(this._resizeObserver=r.getEngine().onResizeObservable.add((()=>this._onResize())),this._onResize()),this._texture.isReady=!0)}getClassName(){return"AdvancedDynamicTexture"}executeOnAllControls(e,t){t||(t=this._rootContainer),e(t);for(const s of t.children)s.children?this.executeOnAllControls(e,s):e(s)}get useInvalidateRectOptimization(){return this._useInvalidateRectOptimization}set useInvalidateRectOptimization(e){this._useInvalidateRectOptimization=e}invalidateRect(e,t,s,i){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){const r=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,s)),n=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,i));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,e)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,t)),this._invalidatedRectangle.width=r-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=n-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new m.U(e,t,s-e+1,i-t+1)}markAsDirty(){this._isDirty=!0}createStyle(){return new p(this)}addControl(e){return this._rootContainer.addControl(e),this}removeControl(e){return this._rootContainer.removeControl(e),this}moveToNonOverlappedPosition(e,t=1,s=1){let i;if(Array.isArray(e))i=e;else{const t=this.getDescendants(!0);i=void 0===e?t.filter((e=>void 0!==e.overlapGroup)):t.filter((t=>t.overlapGroup===e))}i.forEach((e=>{var n;let a=r.FM.Zero();const o=new r.FM(e.centerX,e.centerY);i.forEach((t=>{if(e!==t&&x._Overlaps(e,t)){const e=o.subtract(new r.FM(t.centerX,t.centerY)),i=e.length();i>0&&(a=a.add(e.normalize().scale(s/i)))}})),a.length()>0&&(a=a.normalize().scale(t*(null!==(n=e.overlapDeltaMultiplier)&&void 0!==n?n:1)),e.linkOffsetXInPixels+=a.x,e.linkOffsetYInPixels+=a.y)}))}dispose(){const e=this.getScene();e&&(this._rootElement=null,e.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&e.getEngine().onResizeObservable.remove(this._resizeObserver),this._prePointerObserver&&e.onPrePointerObservable.remove(this._prePointerObserver),this._sceneRenderObserver&&e.onBeforeRenderObservable.remove(this._sceneRenderObserver),this._pointerObserver&&e.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&e.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&e.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._canvasBlurObserver&&e.getEngine().onCanvasBlurObservable.remove(this._canvasBlurObserver),this._controlAddedObserver&&this._rootContainer.onControlAddedObservable.remove(this._controlAddedObserver),this._controlRemovedObserver&&this._rootContainer.onControlRemovedObservable.remove(this._controlRemovedObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),this.onGuiReadyObservable.clear(),super.dispose())}_onResize(){const e=this.getScene();if(!e)return;const t=e.getEngine(),s=this.getSize();let i=t.getRenderWidth()*this._renderScale,r=t.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(r=r*this._idealWidth/i,i=this._idealWidth):this._idealHeight&&(i=i*this._idealHeight/r,r=this._idealHeight)),s.width===i&&s.height===r||(this.scaleTo(i,r),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,s.width-1,s.height-1)}_getGlobalViewport(){const e=this.getSize(),t=this._fullscreenViewport.toGlobal(e.width,e.height),s=Math.round(t.width*(1/this.rootContainer.scaleX)),i=Math.round(t.height*(1/this.rootContainer.scaleY));return t.x+=(t.width-s)/2,t.y+=(t.height-i)/2,t.width=s,t.height=i,t}getProjectedPosition(e,t){const s=this.getProjectedPositionWithZ(e,t);return new r.FM(s.x,s.y)}getProjectedPositionWithZ(e,t){const s=this.getScene();if(!s)return r.P.Zero();const i=this._getGlobalViewport(),n=r.P.Project(e,t,s.getTransformMatrix(),i);return new r.P(n.x,n.y,n.z)}_checkUpdate(e,t){if(!this._layerToDispose||0!=(e.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){const e=this.getScene();if(!e)return;const t=this._getGlobalViewport();for(const s of this._linkedControls){if(!s.isVisible)continue;const i=s._linkedMesh;if(!i||i.isDisposed()){n.w1.SetImmediate((()=>{s.linkWithMesh(null)}));continue}const a=i.getBoundingInfo?i.getBoundingInfo().boundingSphere.center:r.P.ZeroReadOnly,o=r.P.Project(a,i.getWorldMatrix(),e.getTransformMatrix(),t);o.z<0||o.z>1?s.notRenderable=!0:(s.notRenderable=!1,this.useInvalidateRectOptimization&&s.invalidateRect(),s._moveToProjectedPosition(o))}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(t),t||this.update(this.applyYInversionOnUpdate,this.premulAlpha,x.AllowGPUOptimizations))}}_render(e){var t;const s=this.getSize(),i=s.width,r=s.height,n=this.getContext();if(n.font="18px Arial",n.strokeStyle="white",this.onGuiReadyObservable.hasObservers()&&this._checkGuiIsReady(),this._rootChildrenHaveChanged){const e=null===(t=this.getScene())||void 0===t?void 0:t.activeCamera;e&&(this._rootChildrenHaveChanged=!1,this._checkUpdate(e,!0))}this.onBeginLayoutObservable.notifyObservers(this);const a=new m.U(0,0,i,r);this._numLayoutCalls=0,this._rootContainer._layout(a,n),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,e||(this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,i,r),n.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(n.save(),n.fillStyle=this._background,n.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),n.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(n,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null)}_changeCursor(e){this._rootElement&&(this._rootElement.style.cursor=e,this._cursorChanged=!0)}_registerLastControlDown(e,t){this._lastControlDown[t]=e,this.onControlPickedObservable.notifyObservers(e)}_doPicking(e,t,s,i,r,n,o,h){const l=this.getScene();if(!l)return;const d=l.getEngine(),c=this.getSize();if(this._isFullscreen){const s=l.cameraToUseForPointers||l.activeCamera;if(!s)return;const i=s.viewport;e*=c.width/(d.getRenderWidth()*i.width),t*=c.height/(d.getRenderHeight()*i.height)}if(this._capturingControl[r])return this._capturingControl[r].isPointerBlocker&&(this._shouldBlockPointer=!0),void this._capturingControl[r]._processObservables(i,e,t,s,r,n);this._cursorChanged=!1,this._rootContainer._processPicking(e,t,s,i,r,n,o,h)||(l.doNotHandleCursors||this._changeCursor(""),i===a.kD.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r],s),delete this._lastControlOver[r])),this._cursorChanged||l.doNotHandleCursors||this._changeCursor(""),this._manageFocus()}_cleanControlAfterRemovalFromList(e,t){for(const s in e){if(!Object.prototype.hasOwnProperty.call(e,s))continue;e[s]===t&&delete e[s]}}_cleanControlAfterRemoval(e){this._cleanControlAfterRemovalFromList(this._lastControlDown,e),this._cleanControlAfterRemovalFromList(this._lastControlOver,e)}pick(e,t,s=null){this._isFullscreen&&this._scene&&this._translateToPicking(this._scene,new v.l(0,0,0,0),s,e,t)}_translateToPicking(e,t,s,i=e.pointerX,r=e.pointerY){const n=e.cameraToUseForPointers||e.activeCamera,o=e.getEngine(),h=e.cameraToUseForPointers;if(n)if(n.rigCameras.length){const s=new v.l(0,0,1,1);n.rigCameras.forEach((n=>{n.viewport.toGlobalToRef(o.getRenderWidth(),o.getRenderHeight(),s);const a=i/o.getHardwareScalingLevel()-s.x,h=r/o.getHardwareScalingLevel()-(o.getRenderHeight()-s.y-s.height);a<0||h<0||i>s.width||r>s.height||(e.cameraToUseForPointers=n,t.x=s.x,t.y=s.y,t.width=s.width,t.height=s.height)}))}else n.viewport.toGlobalToRef(o.getRenderWidth(),o.getRenderHeight(),t);else t.x=0,t.y=0,t.width=o.getRenderWidth(),t.height=o.getRenderHeight();const l=i/o.getHardwareScalingLevel()-t.x,d=r/o.getHardwareScalingLevel()-(o.getRenderHeight()-t.y-t.height);if(this._shouldBlockPointer=!1,s){const e=s.event.pointerId||this._defaultMousePointerId;this._doPicking(l,d,s,s.type,e,s.event.button,s.event.deltaX,s.event.deltaY),(this._shouldBlockPointer||this._capturingControl[e])&&(s.skipOnPointerObservable=!0)}else this._doPicking(l,d,null,a.kD.POINTERMOVE,this._defaultMousePointerId,0);e.cameraToUseForPointers=h}attach(){const e=this.getScene();if(!e)return;const t=new v.l(0,0,0,0);this._prePointerObserver=e.onPrePointerObservable.add((s=>{if((!e.isPointerCaptured(s.event.pointerId)||s.type!==a.kD.POINTERUP||this._capturedPointerIds.has(s.event.pointerId))&&(s.type===a.kD.POINTERMOVE||s.type===a.kD.POINTERUP||s.type===a.kD.POINTERDOWN||s.type===a.kD.POINTERWHEEL)){if(s.type===a.kD.POINTERMOVE){if(e.isPointerCaptured(s.event.pointerId))return;s.event.pointerId&&(this._defaultMousePointerId=s.event.pointerId)}this._translateToPicking(e,t,s)}})),this._attachPickingToSceneRender(e,(()=>this._translateToPicking(e,t,null)),!1),this._attachToOnPointerOut(e),this._attachToOnBlur(e)}registerClipboardEvents(){self.addEventListener("copy",this._onClipboardCopy,!1),self.addEventListener("cut",this._onClipboardCut,!1),self.addEventListener("paste",this._onClipboardPaste,!1)}unRegisterClipboardEvents(){self.removeEventListener("copy",this._onClipboardCopy),self.removeEventListener("cut",this._onClipboardCut),self.removeEventListener("paste",this._onClipboardPaste)}_transformUvs(e){const t=this.getTextureMatrix();let s;if(t.isIdentityAs3x2())s=e;else{const i=r.jp.Matrix[0];t.getRowToRef(0,r.jp.Vector4[0]),t.getRowToRef(1,r.jp.Vector4[1]),t.getRowToRef(2,r.jp.Vector4[2]);const n=r.jp.Vector4[0],a=r.jp.Vector4[1],o=r.jp.Vector4[2];i.setRowFromFloats(0,n.x,n.y,0,0),i.setRowFromFloats(1,a.x,a.y,0,0),i.setRowFromFloats(2,0,0,1,0),i.setRowFromFloats(3,o.x,o.y,0,1),s=r.jp.Vector2[0],r.FM.TransformToRef(e,i,s)}if((this.wrapU===l.x.WRAP_ADDRESSMODE||this.wrapU===l.x.MIRROR_ADDRESSMODE)&&s.x>1){let e=s.x-Math.trunc(s.x);this.wrapU===l.x.MIRROR_ADDRESSMODE&&Math.trunc(s.x)%2==1&&(e=1-e),s.x=e}if((this.wrapV===l.x.WRAP_ADDRESSMODE||this.wrapV===l.x.MIRROR_ADDRESSMODE)&&s.y>1){let e=s.y-Math.trunc(s.y);this.wrapV===l.x.MIRROR_ADDRESSMODE&&Math.trunc(s.x)%2==1&&(e=1-e),s.y=e}return s}attachToMesh(e,t=!0){const s=this.getScene();s&&(this._pointerObserver&&s.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=s.onPointerObservable.add((t=>{if(t.type!==a.kD.POINTERMOVE&&t.type!==a.kD.POINTERUP&&t.type!==a.kD.POINTERDOWN&&t.type!==a.kD.POINTERWHEEL)return;t.type===a.kD.POINTERMOVE&&t.event.pointerId&&(this._defaultMousePointerId=t.event.pointerId);const s=t.event.pointerId||this._defaultMousePointerId;if(t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh===e){let e=t.pickInfo.getTextureCoordinates();if(e){e=this._transformUvs(e);const i=this.getSize();this._doPicking(e.x*i.width,(this.applyYInversionOnUpdate?1-e.y:e.y)*i.height,t,t.type,s,t.event.button,t.event.deltaX,t.event.deltaY)}}else if(t.type===a.kD.POINTERUP){if(this._lastControlDown[s]&&this._lastControlDown[s]._forcePointerUp(s),delete this._lastControlDown[s],this.focusedControl){const e=this.focusedControl.keepsFocusWith();let t=!0;if(e)for(const i of e){if(this===i._host)continue;const e=i._host;if(e._lastControlOver[s]&&e._lastControlOver[s].isAscendant(i)){t=!1;break}}t&&(this.focusedControl=null)}}else t.type===a.kD.POINTERMOVE&&(this._lastControlOver[s]&&this._lastControlOver[s]._onPointerOut(this._lastControlOver[s],t,!0),delete this._lastControlOver[s])})),e.enablePointerMoveEvents=t,this._attachPickingToSceneRender(s,(()=>{const t=this._defaultMousePointerId,i=null==s?void 0:s.pick(s.pointerX,s.pointerY);if(i&&i.hit&&i.pickedMesh===e){let e=i.getTextureCoordinates();if(e){e=this._transformUvs(e);const s=this.getSize();this._doPicking(e.x*s.width,(this.applyYInversionOnUpdate?1-e.y:e.y)*s.height,null,a.kD.POINTERMOVE,t,0)}}else this._lastControlOver[t]&&this._lastControlOver[t]._onPointerOut(this._lastControlOver[t],null,!0),delete this._lastControlOver[t]}),!0),this._attachToOnPointerOut(s),this._attachToOnBlur(s))}moveFocusToControl(e){this.focusedControl=e,this._lastPickedControl=e,this._blockNextFocusCheck=!0}_manageFocus(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}}_attachPickingToSceneRender(e,t,s){this._sceneRenderObserver=e.onBeforeRenderObservable.add((()=>{this.checkPointerEveryFrame&&(this._linkedControls.length>0||s)&&t()}))}_attachToOnPointerOut(e){this._canvasPointerOutObserver=e.getEngine().onCanvasPointerOutObservable.add((e=>{this._lastControlOver[e.pointerId]&&this._lastControlOver[e.pointerId]._onPointerOut(this._lastControlOver[e.pointerId],null),delete this._lastControlOver[e.pointerId],this._lastControlDown[e.pointerId]&&this._lastControlDown[e.pointerId]!==this._capturingControl[e.pointerId]&&(this._lastControlDown[e.pointerId]._forcePointerUp(e.pointerId),delete this._lastControlDown[e.pointerId])}))}_attachToOnBlur(e){this._canvasBlurObserver=e.getEngine().onCanvasBlurObservable.add((()=>{Object.entries(this._lastControlDown).forEach((([,e])=>{e._onCanvasBlur()})),this.focusedControl=null,this._lastControlDown={}}))}serializeContent(){const e=this.getSize(),t={root:{},width:e.width,height:e.height};return this._rootContainer.serialize(t.root),t}parseSerializedObject(e,t){if(this._rootContainer=_.o.Parse(e.root,this),t){const t=e.width,s=e.height;"number"==typeof t&&"number"==typeof s&&t>=0&&s>=0?this.scaleTo(t,s):this.scaleTo(1920,1080)}}clone(e){const t=this.getScene();if(!t)return this;const s=this.serializeContent(),i=x.CreateFullscreenUI(e||"Clone of "+this.name,this.isForeground,t,this.samplingMode);return i.parseSerializedObject(s),i}static async ParseFromSnippetAsync(e,t,s){const i=null!=s?s:x.CreateFullscreenUI("ADT from snippet");if("_BLANK"===e)return i;const r=await x._LoadURLContentAsync(x.SnippetUrl+"/"+e.replace(/#/g,"/"),!0);return i.parseSerializedObject(r,t),i}parseFromSnippetAsync(e,t){return x.ParseFromSnippetAsync(e,t,this)}static async ParseFromFileAsync(e,t,s){const i=null!=s?s:x.CreateFullscreenUI("ADT from URL"),r=await x._LoadURLContentAsync(e);return i.parseSerializedObject(r,t),i}parseFromURLAsync(e,t){return x.ParseFromFileAsync(e,t,this)}static _LoadURLContentAsync(e,t=!1){return""===e?Promise.reject("No URL provided"):new Promise(((s,i)=>{const r=new y.g;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){let e;if(t){const t=JSON.parse(JSON.parse(r.responseText).jsonPayload);e=t.encodedGui?new TextDecoder("utf-8").decode((0,R.HQ)(t.encodedGui)):t.gui}else e=r.responseText;const i=JSON.parse(e);s(i)}else i("Unable to load")})),r.open("GET",e),r.send()}))}static _Overlaps(e,t){return!(e.centerX>t.centerX+t.widthInPixels||e.centerX+e.widthInPixels<t.centerX||e.centerY+e.heightInPixels<t.centerY||e.centerY>t.centerY+t.heightInPixels)}static CreateForMesh(e,t=1024,s=1024,i=!0,r=!1,n,a=this._CreateMaterial){const o=(0,C.f)(),h=new x(`AdvancedDynamicTexture for ${e.name} [${o}]`,t,s,e.getScene(),!0,l.x.TRILINEAR_SAMPLINGMODE,n);return a(e,o,h,r),h.attachToMesh(e,i),h}static _CreateMaterial(e,t,s,i){const r=(0,M.q)("BABYLON.StandardMaterial");if(!r)throw"StandardMaterial needs to be imported before as it contains a side-effect required by your code.";const n=new r(`AdvancedDynamicTextureMaterial for ${e.name} [${t}]`,e.getScene());n.backFaceCulling=!1,n.diffuseColor=b.Wo.Black(),n.specularColor=b.Wo.Black(),i?(n.diffuseTexture=s,n.emissiveTexture=s,s.hasAlpha=!0):(n.emissiveTexture=s,n.opacityTexture=s),e.material=n}static CreateForMeshTexture(e,t=1024,s=1024,i=!0,r){const n=new x(e.name+" AdvancedDynamicTexture",t,s,e.getScene(),!0,l.x.TRILINEAR_SAMPLINGMODE,r);return n.attachToMesh(e,i),n}static CreateFullscreenUI(e,t=!0,s=null,i=l.x.BILINEAR_SAMPLINGMODE,r=!1){const n=new x(e,0,0,s,!1,i),a=n.getScene(),o=new c.m(e+"_layer",null,a,!t);if(o.texture=n,n._layerToDispose=o,n._isFullscreen=!0,r&&a){const e=1/a.getEngine().getHardwareScalingLevel();n._rootContainer.scaleX=e,n._rootContainer.scaleY=e}return n.attach(),n}scale(e){super.scale(e),this.markAsDirty()}scaleTo(e,t){super.scaleTo(e,t),this.markAsDirty()}_checkGuiIsReady(){this.guiIsReady()&&(this.onGuiReadyObservable.notifyObservers(this),this.onGuiReadyObservable.clear())}guiIsReady(){return this._rootContainer.isReady()}}x.SnippetUrl=f.g.SnippetUrl,x.AllowGPUOptimizations=!0},90558:(e,t,s)=>{s.d(t,{W:()=>g});var i=s(72433),r=s(84318),n=s(76728),a=s(42238),o=s(48620),h=s(96969),l=s(93980),d=s(73803),c=s(34941),u=s(62897),_=s(13514);class g extends n.o{get renderToIntermediateTexture(){return this._renderToIntermediateTexture}set renderToIntermediateTexture(e){this._renderToIntermediateTexture!==e&&(this._renderToIntermediateTexture=e,this._markAsDirty())}get adaptHeightToChildren(){return this._adaptHeightToChildren}set adaptHeightToChildren(e){this._adaptHeightToChildren!==e&&(this._adaptHeightToChildren=e,e&&(this.height="100%"),this._markAsDirty())}get adaptWidthToChildren(){return this._adaptWidthToChildren}set adaptWidthToChildren(e){this._adaptWidthToChildren!==e&&(this._adaptWidthToChildren=e,e&&(this.width="100%"),this._markAsDirty())}get background(){return this._background}set background(e){this._background!==e&&(this._background=e,this._markAsDirty())}get backgroundGradient(){return this._backgroundGradient}set backgroundGradient(e){this._backgroundGradient!==e&&(this._backgroundGradient=e,this._markAsDirty())}get children(){return this._children}get isReadOnly(){return this._isReadOnly}set isReadOnly(e){this._isReadOnly=e;for(const t of this._children)t.isReadOnly=e}constructor(e){super(e),this.name=e,this._children=new Array,this._measureForChildren=a.U.Empty(),this._background="",this._backgroundGradient=null,this._adaptWidthToChildren=!1,this._adaptHeightToChildren=!1,this._renderToIntermediateTexture=!1,this._intermediateTexture=null,this.logLayoutCycleErrors=!1,this.maxLayoutCycle=3,this.onControlAddedObservable=new u.y$,this.onControlRemovedObservable=new u.y$}_getTypeName(){return"Container"}_flagDescendantsAsMatrixDirty(){for(const e of this.children)e._isClipped=!1,e._markMatrixAsDirty()}getChildByName(e){for(const t of this.children)if(t.name===e)return t;return null}getChildByType(e,t){for(const e of this.children)if(e.typeName===t)return e;return null}containsControl(e){return-1!==this.children.indexOf(e)}addControl(e){if(!e)return this;return-1!==this._children.indexOf(e)||(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty(),this.onControlAddedObservable.notifyObservers(e)),this}clearControls(){const e=this.children.slice();for(const t of e)this.removeControl(t);return this}removeControl(e){const t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this.onControlRemovedObservable.notifyObservers(e),this}_reOrderControl(e){const t=e.linkedMesh;this.removeControl(e);let s=!1;for(let t=0;t<this._children.length;t++)if(this._children[t].zIndex>e.zIndex){this._children.splice(t,0,e),s=!0;break}s||this._children.push(e),e.parent=this,t&&e.linkWithMesh(t),this._markAsDirty()}_offsetLeft(e){super._offsetLeft(e);for(const t of this._children)t._offsetLeft(e)}_offsetTop(e){super._offsetTop(e);for(const t of this._children)t._offsetTop(e)}_markAllAsDirty(){super._markAllAsDirty();for(let e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()}_getBackgroundColor(e){return this._backgroundGradient?this._backgroundGradient.getCanvasGradient(e):this._background}_localDraw(e){(this._background||this._backgroundGradient)&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._getBackgroundColor(e),e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())}_link(e){super._link(e);for(const t of this._children)t._link(e)}_beforeLayout(){}_processMeasures(e,t){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(e)||(super._processMeasures(e,t),this._evaluateClippingState(e),this._renderToIntermediateTexture&&(this._intermediateTexture&&this._host.getScene()!=this._intermediateTexture.getScene()&&(this._intermediateTexture.dispose(),this._intermediateTexture=null),this._intermediateTexture?this._intermediateTexture.scaleTo(this._currentMeasure.width,this._currentMeasure.height):(this._intermediateTexture=new l.c("",{width:this._currentMeasure.width,height:this._currentMeasure.height},this._host.getScene(),!1,d.x.NEAREST_SAMPLINGMODE,c.g.TEXTUREFORMAT_RGBA,!1),this._intermediateTexture.hasAlpha=!0)))}_layout(e,t){var s,i;if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);let n=0;t.save(),this._applyStates(t),this._beforeLayout();do{let r=-1,a=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(const e of this._children)e._tempParentMeasure.copyFrom(this._measureForChildren),e._layout(this._measureForChildren,t)&&e.isVisible&&!e.notRenderable&&(this.adaptWidthToChildren&&e._width.isPixel&&(r=Math.max(r,e._currentMeasure.width+e._paddingLeftInPixels+e._paddingRightInPixels)),this.adaptHeightToChildren&&e._height.isPixel&&(a=Math.max(a,e._currentMeasure.height+e._paddingTopInPixels+e._paddingBottomInPixels)));this.adaptWidthToChildren&&r>=0&&(r+=this.paddingLeftInPixels+this.paddingRightInPixels,this.width!==r+"px"&&(null===(s=this.parent)||void 0===s||s._markAsDirty(),this.width=r+"px",this._width.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)),this.adaptHeightToChildren&&a>=0&&(a+=this.paddingTopInPixels+this.paddingBottomInPixels,this.height!==a+"px"&&(null===(i=this.parent)||void 0===i||i._markAsDirty(),this.height=a+"px",this._height.ignoreAdaptiveScaling=!0,this._rebuildLayout=!0)),this._postMeasure()}n++}while(this._rebuildLayout&&n<this.maxLayoutCycle);return n>=3&&this.logLayoutCycleErrors&&r.Y.Error(`Layout cycle detected in GUI (Container name=${this.name}, uniqueId=${this.uniqueId})`),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0}_postMeasure(){}_draw(e,t){const s=this._renderToIntermediateTexture&&this._intermediateTexture,i=s?this._intermediateTexture.getContext():e;s&&(i.save(),i.translate(-this._currentMeasure.left,-this._currentMeasure.top),t?i.clearRect(t.left,t.top,t.width,t.height):i.clearRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._localDraw(i),e.save(),this.clipChildren&&this._clipForChildren(i);for(const e of this._children)t&&!e._intersectsRect(t)||e._render(i,t);s&&(i.restore(),e.save(),e.globalAlpha=this.alpha,e.drawImage(i.canvas,this._currentMeasure.left,this._currentMeasure.top),e.restore()),e.restore()}getDescendantsToRef(e,t=!1,s){if(this.children)for(let i=0;i<this.children.length;i++){const r=this.children[i];s&&!s(r)||e.push(r),t||r.getDescendantsToRef(e,!1,s)}}_processPicking(e,t,s,i,r,n,a,o){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;const h=super.contains(e,t);if(!h&&this.clipChildren)return!1;for(let h=this._children.length-1;h>=0;h--){const l=this._children[h];if(l._processPicking(e,t,s,i,r,n,a,o))return l.hoverCursor&&this._host._changeCursor(l.hoverCursor),!0}return!!h&&(!!this.isHitTestVisible&&this._processObservables(i,e,t,s,r,n,a,o))}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.copyFrom(this._currentMeasure)}serialize(e){if(super.serialize(e),this.backgroundGradient&&(e.backgroundGradient={},this.backgroundGradient.serialize(e.backgroundGradient)),this.children.length){e.children=[];for(const t of this.children){const s={};t.serialize(s),e.children.push(s)}}}dispose(){var e;super.dispose();for(let e=this.children.length-1;e>=0;e--)this.children[e].dispose();null===(e=this._intermediateTexture)||void 0===e||e.dispose()}_parseFromContent(e,t){var s;if(super._parseFromContent(e,t),this._link(t),e.backgroundGradient){const t=_.w1.Instantiate("BABYLON.GUI."+e.backgroundGradient.className);this._backgroundGradient=new t,null===(s=this._backgroundGradient)||void 0===s||s.parse(e.backgroundGradient)}if(e.children)for(const s of e.children)this.addControl(n.o.Parse(s,t))}isReady(){for(const e of this.children)if(!e.isReady())return!1;return!0}}(0,i.gn)([(0,h.qC)()],g.prototype,"renderToIntermediateTexture",null),(0,i.gn)([(0,h.qC)()],g.prototype,"maxLayoutCycle",void 0),(0,i.gn)([(0,h.qC)()],g.prototype,"adaptHeightToChildren",null),(0,i.gn)([(0,h.qC)()],g.prototype,"adaptWidthToChildren",null),(0,i.gn)([(0,h.qC)()],g.prototype,"background",null),(0,i.gn)([(0,h.qC)()],g.prototype,"backgroundGradient",null),(0,o.H)("BABYLON.GUI.Container",g)},76728:(e,t,s)=>{s.d(t,{o:()=>v});var i=s(72433),r=s(62897),n=s(58095),a=s(76324),o=s(84318),h=s(13514),l=s(55905),d=s(42238),c=s(48154);class u extends n.FM{constructor(e,t=0){super(e.x,e.y),this.buttonIndex=t}}class _{constructor(e,t,s,i,r,n){this.m=new Float32Array(6),this.fromValues(e,t,s,i,r,n)}fromValues(e,t,s,i,r,n){return this.m[0]=e,this.m[1]=t,this.m[2]=s,this.m[3]=i,this.m[4]=r,this.m[5]=n,this}determinant(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]}invertToRef(e){const t=this.m[0],s=this.m[1],i=this.m[2],r=this.m[3],n=this.m[4],a=this.m[5],o=this.determinant();if(o<c.kn*c.kn)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;const h=1/o,l=i*a-r*n,d=s*n-t*a;return e.m[0]=r*h,e.m[1]=-s*h,e.m[2]=-i*h,e.m[3]=t*h,e.m[4]=l*h,e.m[5]=d*h,this}multiplyToRef(e,t){const s=this.m[0],i=this.m[1],r=this.m[2],n=this.m[3],a=this.m[4],o=this.m[5],h=e.m[0],l=e.m[1],d=e.m[2],c=e.m[3],u=e.m[4],_=e.m[5];return t.m[0]=s*h+i*d,t.m[1]=s*l+i*c,t.m[2]=r*h+n*d,t.m[3]=r*l+n*c,t.m[4]=a*h+o*d+u,t.m[5]=a*l+o*c+_,this}transformCoordinates(e,t,s){return s.x=e*this.m[0]+t*this.m[2]+this.m[4],s.y=e*this.m[1]+t*this.m[3]+this.m[5],this}static Identity(){return new _(1,0,0,1,0,0)}static IdentityToRef(e){e.m[0]=1,e.m[1]=0,e.m[2]=0,e.m[3]=1,e.m[4]=0,e.m[5]=0}static TranslationToRef(e,t,s){s.fromValues(1,0,0,1,e,t)}static ScalingToRef(e,t,s){s.fromValues(e,0,0,t,0,0)}static RotationToRef(e,t){const s=Math.sin(e),i=Math.cos(e);t.fromValues(i,s,-s,i,0,0)}static ComposeToRef(e,t,s,i,r,n,a){_.TranslationToRef(e,t,_._TempPreTranslationMatrix),_.ScalingToRef(i,r,_._TempScalingMatrix),_.RotationToRef(s,_._TempRotationMatrix),_.TranslationToRef(-e,-t,_._TempPostTranslationMatrix),_._TempPreTranslationMatrix.multiplyToRef(_._TempScalingMatrix,_._TempCompose0),_._TempCompose0.multiplyToRef(_._TempRotationMatrix,_._TempCompose1),n?(_._TempCompose1.multiplyToRef(_._TempPostTranslationMatrix,_._TempCompose2),_._TempCompose2.multiplyToRef(n,a)):_._TempCompose1.multiplyToRef(_._TempPostTranslationMatrix,a)}}_._TempPreTranslationMatrix=_.Identity(),_._TempPostTranslationMatrix=_.Identity(),_._TempRotationMatrix=_.Identity(),_._TempScalingMatrix=_.Identity(),_._TempCompose0=_.Identity(),_._TempCompose1=_.Identity(),_._TempCompose2=_.Identity();class g{static Round(e,t=g.DefaultRoundingPrecision){return Math.round(e*t)/t}}g.DefaultRoundingPrecision=100;var p=s(48620),m=s(96969),f=s(15210);class v{get isReadOnly(){return this._isReadOnly}set isReadOnly(e){this._isReadOnly=e}get transformedMeasure(){return this._evaluatedMeasure}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())}get shadowBlur(){return this._shadowBlur}set shadowBlur(e){this._shadowBlur!==e&&(this._previousShadowBlur=this._shadowBlur,this._shadowBlur=e,this._markAsDirty())}get shadowColor(){return this._shadowColor}set shadowColor(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())}get typeName(){return this._getTypeName()}getClassName(){return this._getTypeName()}set accessibilityTag(e){this._accessibilityTag=e,this.onAccessibilityTagChangedObservable.notifyObservers(e)}get accessibilityTag(){return this._accessibilityTag}get host(){return this._host}get fontOffset(){return this._fontOffset}set fontOffset(e){this._fontOffset=e}get alpha(){return this._alpha}set alpha(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())}get highlightLineWidth(){return this._highlightLineWidth}set highlightLineWidth(e){this._highlightLineWidth!==e&&(this._highlightLineWidth=e,this._markAsDirty())}get isHighlighted(){return this._isHighlighted}set isHighlighted(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())}get highlightColor(){return this._highlightColor}set highlightColor(e){this._highlightColor!==e&&(this._highlightColor=e,this._markAsDirty())}get scaleX(){return this._scaleX}set scaleX(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())}get scaleY(){return this._scaleY}set scaleY(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterY(){return this._transformCenterY}set transformCenterY(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())}get transformCenterX(){return this._transformCenterX}set transformCenterX(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())}get horizontalAlignment(){return this._horizontalAlignment}set horizontalAlignment(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())}get verticalAlignment(){return this._verticalAlignment}set verticalAlignment(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())}get width(){return this._width.toString(this._host)}set width(e){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()}get widthInPixels(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)}set widthInPixels(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!0,this.width=e+"px")}get height(){return this._height.toString(this._host)}set height(e){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()}get heightInPixels(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)}set heightInPixels(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!1,this.height=e+"px")}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())}get style(){return this._style}set style(e){this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add((()=>{this._markAsDirty(),this._resetFontCache()}))),this._markAsDirty(),this._resetFontCache()}get _isFontSizeInPercentage(){return this._fontSize.isPercentage}get fontSizeInPixels(){const e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)}set fontSizeInPixels(e){isNaN(e)||(this.fontSize=e+"px")}get fontSize(){return this._fontSize.toString(this._host)}set fontSize(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())}get color(){return this._color}set color(e){this._color!==e&&(this._color=e,this._markAsDirty())}get gradient(){return this._gradient}set gradient(e){this._gradient!==e&&(this._gradient=e,this._markAsDirty())}get zIndex(){return this._zIndex}set zIndex(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))}get notRenderable(){return this._doNotRender}set notRenderable(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0),this.onIsVisibleChangedObservable.notifyObservers(e))}get isDirty(){return this._isDirty}get linkedMesh(){return this._linkedMesh}get descendantsOnlyPadding(){return this._descendantsOnlyPadding}set descendantsOnlyPadding(e){this._descendantsOnlyPadding!==e&&(this._descendantsOnlyPadding=e,this._markAsDirty())}get paddingLeft(){return this._paddingLeft.toString(this._host)}set paddingLeft(e){this._paddingLeft.fromString(e)&&this._markAsDirty()}get paddingLeftInPixels(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingLeftInPixels(e){isNaN(e)||(this.paddingLeft=e+"px")}get _paddingLeftInPixels(){return this._descendantsOnlyPadding?0:this.paddingLeftInPixels}get paddingRight(){return this._paddingRight.toString(this._host)}set paddingRight(e){this._paddingRight.fromString(e)&&this._markAsDirty()}get paddingRightInPixels(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)}set paddingRightInPixels(e){isNaN(e)||(this.paddingRight=e+"px")}get _paddingRightInPixels(){return this._descendantsOnlyPadding?0:this.paddingRightInPixels}get paddingTop(){return this._paddingTop.toString(this._host)}set paddingTop(e){this._paddingTop.fromString(e)&&this._markAsDirty()}get paddingTopInPixels(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingTopInPixels(e){isNaN(e)||(this.paddingTop=e+"px")}get _paddingTopInPixels(){return this._descendantsOnlyPadding?0:this.paddingTopInPixels}get paddingBottom(){return this._paddingBottom.toString(this._host)}set paddingBottom(e){this._paddingBottom.fromString(e)&&this._markAsDirty()}get paddingBottomInPixels(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)}set paddingBottomInPixels(e){isNaN(e)||(this.paddingBottom=e+"px")}get _paddingBottomInPixels(){return this._descendantsOnlyPadding?0:this.paddingBottomInPixels}get left(){return this._left.toString(this._host)}set left(e){this._left.fromString(e)&&this._markAsDirty()}get leftInPixels(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)}set leftInPixels(e){isNaN(e)||(this.left=e+"px")}get top(){return this._top.toString(this._host)}set top(e){this._top.fromString(e)&&this._markAsDirty()}get topInPixels(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)}set topInPixels(e){isNaN(e)||(this.top=e+"px")}get linkOffsetX(){return this._linkOffsetX.toString(this._host)}set linkOffsetX(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()}get linkOffsetXInPixels(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)}set linkOffsetXInPixels(e){isNaN(e)||(this.linkOffsetX=e+"px")}get linkOffsetY(){return this._linkOffsetY.toString(this._host)}set linkOffsetY(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()}get linkOffsetYInPixels(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)}set linkOffsetYInPixels(e){isNaN(e)||(this.linkOffsetY=e+"px")}get centerX(){return this._currentMeasure.left+this._currentMeasure.width/2}get centerY(){return this._currentMeasure.top+this._currentMeasure.height/2}get isEnabled(){return this._isEnabled}set isEnabled(e){if(this._isEnabled===e)return;this._isEnabled=e,this._markAsDirty();const t=e=>{if(e.host){for(const t in e.host._lastControlOver)e===this.host._lastControlOver[t]&&(e._onPointerOut(e,null,!0),delete e.host._lastControlOver[t]);void 0!==e.children&&e.children.forEach(t)}};t(this)}get disabledColor(){return this._disabledColor}set disabledColor(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())}get disabledColorItem(){return this._disabledColorItem}set disabledColorItem(e){this._disabledColorItem!==e&&(this._disabledColorItem=e,this._markAsDirty())}constructor(e){this.name=e,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=d.U.Empty(),this._tempPaddingMeasure=d.U.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new l.s(18,l.s.UNITMODE_PIXEL,!1),this._width=new l.s(1,l.s.UNITMODE_PERCENTAGE,!1),this._height=new l.s(1,l.s.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=v.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=v.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=d.U.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=d.U.Empty(),this._cachedParentMeasure=d.U.Empty(),this._descendantsOnlyPadding=!1,this._paddingLeft=new l.s(0),this._paddingRight=new l.s(0),this._paddingTop=new l.s(0),this._paddingBottom=new l.s(0),this._left=new l.s(0),this._top=new l.s(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=_.Identity(),this._invertTransformMatrix=_.Identity(),this._transformedPosition=n.FM.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._highlightColor="#4affff",this._highlightLineWidth=2,this._fontSet=!1,this._dummyVector2=n.FM.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._evaluatedMeasure=new d.U(0,0,0,0),this._evaluatedParentMeasure=new d.U(0,0,0,0),this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._isReadOnly=!1,this._gradient=null,this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._previousShadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new l.s(0),this._linkOffsetY=new l.s(0),this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new r.y$,this.onWheelObservable=new r.y$,this.onPointerMoveObservable=new r.y$,this.onPointerOutObservable=new r.y$,this.onPointerDownObservable=new r.y$,this.onPointerUpObservable=new r.y$,this.onPointerClickObservable=new r.y$,this.onPointerEnterObservable=new r.y$,this.onDirtyObservable=new r.y$,this.onBeforeDrawObservable=new r.y$,this.onAfterDrawObservable=new r.y$,this.onDisposeObservable=new r.y$,this.onIsVisibleChangedObservable=new r.y$,this.fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this.animations=null,this._tmpMeasureA=new d.U(0,0,0,0)}_getTypeName(){return"Control"}getAscendantOfClass(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null}markAsDirty(e=!1){this._markAsDirty(e)}markAllAsDirty(){this._markAllAsDirty()}_resetFontCache(){this._fontSet=!0,this._markAsDirty()}isAscendant(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))}getLocalCoordinates(e){const t=n.FM.Zero();return this.getLocalCoordinatesToRef(e,t),t}getLocalCoordinatesToRef(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this}getParentLocalCoordinates(e){const t=n.FM.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t}moveToVector3(e,t){if(!this._host||this.parent!==this._host._rootContainer)return void h.w1.Error("Cannot move a control to a vector3 if the control is not at root level");this.horizontalAlignment=v.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=v.VERTICAL_ALIGNMENT_TOP;const s=this._host._getGlobalViewport(),i=n.P.Project(e,n.y3.Identity(),t.getTransformMatrix(),s);this._moveToProjectedPosition(i),i.z<0||i.z>1?this.notRenderable=!0:this.notRenderable=!1}getDescendantsToRef(e,t=!1,s){}getDescendants(e,t){const s=new Array;return this.getDescendantsToRef(s,e,t),s}linkWithMesh(e){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)return void(e&&h.w1.Error("Cannot link a control to a mesh if the control is not at root level"));const t=this._host._linkedControls.indexOf(this);if(-1!==t)return this._linkedMesh=e,void(e||this._host._linkedControls.splice(t,1));e&&(this.horizontalAlignment=v.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=v.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=e,this._host._linkedControls.push(this))}setPadding(e,t,s,i){const r=e,n=null!=t?t:r,a=null!=s?s:r,o=null!=i?i:n;this.paddingTop=r,this.paddingRight=n,this.paddingBottom=a,this.paddingLeft=o}setPaddingInPixels(e,t,s,i){const r=e,n=null!=t?t:r,a=null!=s?s:r,o=null!=i?i:n;this.paddingTopInPixels=r,this.paddingRightInPixels=n,this.paddingBottomInPixels=a,this.paddingLeftInPixels=o}_moveToProjectedPosition(e){var t;const s=this._left.getValue(this._host),i=this._top.getValue(this._host),r=null===(t=this.parent)||void 0===t?void 0:t._currentMeasure;r&&this._processMeasures(r,this._host.getContext());let n=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,a=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(n-s)<.5&&(n=s),Math.abs(a-i)<.5&&(a=i)),s===n&&i===a||(this.left=n+"px",this.top=a+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty())}_offsetLeft(e){this._isDirty=!0,this._currentMeasure.left+=e}_offsetTop(e){this._isDirty=!0,this._currentMeasure.top+=e}_markMatrixAsDirty(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()}_flagDescendantsAsMatrixDirty(){}_intersectsRect(e,t){return this._transform(t),!(this._evaluatedMeasure.left>=e.left+e.width)&&(!(this._evaluatedMeasure.top>=e.top+e.height)&&(!(this._evaluatedMeasure.left+this._evaluatedMeasure.width<=e.left)&&!(this._evaluatedMeasure.top+this._evaluatedMeasure.height<=e.top)))}_computeAdditionnalOffsetX(){return 0}_computeAdditionnalOffsetY(){return 0}invalidateRect(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization){this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),d.U.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA);const e=this.shadowOffsetX,t=this.shadowOffsetY,s=Math.max(this._previousShadowBlur,this.shadowBlur),i=Math.min(Math.min(e,0)-2*s,0),r=Math.max(Math.max(e,0)+2*s,0),n=Math.min(Math.min(t,0)-2*s,0),a=Math.max(Math.max(t,0)+2*s,0),o=this._computeAdditionnalOffsetX(),h=this._computeAdditionnalOffsetY();this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+i-o),Math.floor(this._tmpMeasureA.top+n-h),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+r+o),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+a+h))}}_markAsDirty(e=!1){(this._isVisible||e)&&(this._isDirty=!0,this._markMatrixAsDirty(),this._host&&this._host.markAsDirty())}_markAllAsDirty(){this._markAsDirty(),this._font&&this._prepareFont()}_link(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())}_transform(e){if(!this._isMatrixDirty&&1===this._scaleX&&1===this._scaleY&&0===this._rotation)return;const t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,s=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;e&&(e.translate(t,s),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-s)),(this._isMatrixDirty||this._cachedOffsetX!==t||this._cachedOffsetY!==s)&&(this._cachedOffsetX=t,this._cachedOffsetY=s,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),_.ComposeToRef(-t,-s,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure))}_renderHighlight(e){this.isHighlighted&&(e.save(),e.strokeStyle=this._highlightColor,e.lineWidth=this._highlightLineWidth,this._renderHighlightSpecific(e),e.restore())}_renderHighlightSpecific(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)}_getColor(e){return this.gradient?this.gradient.getCanvasGradient(e):this.color}_applyStates(e){this._isFontSizeInPercentage&&(this._fontSet=!0),this._host&&this._host.useSmallestIdeal&&!this._font&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(e.font=this._font),(this._color||this.gradient)&&(e.fillStyle=this._getColor(e)),v.AllowAlphaInheritance?e.globalAlpha*=this._alpha:this._alphaSet&&(e.globalAlpha=this.parent&&!this.parent.renderToIntermediateTexture?this.parent.alpha*this._alpha:this._alpha)}_layout(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,0|-this._paddingLeftInPixels,0|-this._paddingTopInPixels,0|this._paddingRightInPixels,0|this._paddingBottomInPixels,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save(),this._applyStates(t);let s=0;do{this._rebuildLayout=!1,this._processMeasures(e,t),s++}while(this._rebuildLayout&&s<3);s>=3&&o.Y.Error(`Layout cycle detected in GUI (Control name=${this.name}, uniqueId=${this.uniqueId})`),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0}_processMeasures(e,t){this._tempPaddingMeasure.copyFrom(e),this.parent&&this.parent.descendantsOnlyPadding&&(this._tempPaddingMeasure.left+=this.parent.paddingLeftInPixels,this._tempPaddingMeasure.top+=this.parent.paddingTopInPixels,this._tempPaddingMeasure.width-=this.parent.paddingLeftInPixels+this.parent.paddingRightInPixels,this._tempPaddingMeasure.height-=this.parent.paddingTopInPixels+this.parent.paddingBottomInPixels),this._currentMeasure.copyFrom(this._tempPaddingMeasure),this._preMeasure(this._tempPaddingMeasure,t),this._measure(),this._computeAlignment(this._tempPaddingMeasure,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(this._tempPaddingMeasure,t),this._cachedParentMeasure.copyFrom(this._tempPaddingMeasure),this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)}_evaluateClippingState(e){if(this._currentMeasure.transformToRef(this._transformMatrix,this._evaluatedMeasure),this.parent&&this.parent.clipChildren){if(e.transformToRef(this.parent._transformMatrix,this._evaluatedParentMeasure),this._evaluatedMeasure.left>this._evaluatedParentMeasure.left+this._evaluatedParentMeasure.width)return void(this._isClipped=!0);if(this._evaluatedMeasure.left+this._evaluatedMeasure.width<this._evaluatedParentMeasure.left)return void(this._isClipped=!0);if(this._evaluatedMeasure.top>this._evaluatedParentMeasure.top+this._evaluatedParentMeasure.height)return void(this._isClipped=!0);if(this._evaluatedMeasure.top+this._evaluatedMeasure.height<this._evaluatedParentMeasure.top)return void(this._isClipped=!0)}this._isClipped=!1}_measure(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),0!==this.fixedRatio&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this.fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this.fixedRatio)}_computeAlignment(e,t){const s=this._currentMeasure.width,i=this._currentMeasure.height,r=e.width,n=e.height;let a=0,o=0;switch(this.horizontalAlignment){case v.HORIZONTAL_ALIGNMENT_LEFT:a=0;break;case v.HORIZONTAL_ALIGNMENT_RIGHT:a=r-s;break;case v.HORIZONTAL_ALIGNMENT_CENTER:a=(r-s)/2}switch(this.verticalAlignment){case v.VERTICAL_ALIGNMENT_TOP:o=0;break;case v.VERTICAL_ALIGNMENT_BOTTOM:o=n-i;break;case v.VERTICAL_ALIGNMENT_CENTER:o=(n-i)/2}this.descendantsOnlyPadding||(this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=r*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=r*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=r*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=n*this._paddingTop.getValue(this._host),this._currentMeasure.height-=n*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=n*this._paddingBottom.getValue(this._host)),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=r*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=n*this._top.getValue(this._host),this._currentMeasure.left+=a,this._currentMeasure.top+=o}_preMeasure(e,t){}_additionalProcessing(e,t){}_clipForChildren(e){}_clip(e,t){if(e.beginPath(),v._ClipMeasure.copyFrom(this._currentMeasure),t){t.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);const e=new d.U(0,0,0,0);e.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),e.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),e.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-e.left,e.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-e.top,v._ClipMeasure.copyFrom(e)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){const t=this.shadowOffsetX,s=this.shadowOffsetY,i=this.shadowBlur,r=Math.min(Math.min(t,0)-2*i,0),n=Math.max(Math.max(t,0)+2*i,0),a=Math.min(Math.min(s,0)-2*i,0),o=Math.max(Math.max(s,0)+2*i,0);e.rect(v._ClipMeasure.left+r,v._ClipMeasure.top+a,v._ClipMeasure.width+n-r,v._ClipMeasure.height+o-a)}else e.rect(v._ClipMeasure.left,v._ClipMeasure.top,v._ClipMeasure.width,v._ClipMeasure.height);e.clip()}_render(e,t){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)}_draw(e,t){}contains(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y,!(e<this._currentMeasure.left)&&(!(e>this._currentMeasure.left+this._currentMeasure.width)&&(!(t<this._currentMeasure.top)&&(!(t>this._currentMeasure.top+this._currentMeasure.height)&&(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0))))}_processPicking(e,t,s,i,r,n,a,o){return!!this._isEnabled&&(!(!this.isHitTestVisible||!this.isVisible||this._doNotRender)&&(!!this.contains(e,t)&&(this._processObservables(i,e,t,s,r,n,a,o),!0)))}_onPointerMove(e,t,s,i){this.onPointerMoveObservable.notifyObservers(t,-1,e,this,i)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerMove(e,t,s,i)}_onPointerEnter(e,t){if(!this._isEnabled)return!1;if(this._enterCount>0)return!1;-1===this._enterCount&&(this._enterCount=0),this._enterCount++;return this.onPointerEnterObservable.notifyObservers(this,-1,e,this,t)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerEnter(e,t),!0}_onPointerOut(e,t,s=!1){if(!(s||this._isEnabled&&e!==this))return;this._enterCount=0;let i=!0;e.isAscendant(this)||(i=this.onPointerOutObservable.notifyObservers(this,-1,e,this,t)),i&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerOut(e,t,s)}_onPointerDown(e,t,s,i,r){if(this._onPointerEnter(this,r),0!==this._downCount)return!1;this._downCount++,this._downPointerIds[s]=!0;return this.onPointerDownObservable.notifyObservers(new u(t,i),-1,e,this,r)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerDown(e,t,s,i,r),r&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.add(r.event.pointerId),!0}_onPointerUp(e,t,s,i,r,n){if(!this._isEnabled)return;this._downCount=0,delete this._downPointerIds[s];let a=r;r&&(this._enterCount>0||-1===this._enterCount)&&(a=this.onPointerClickObservable.notifyObservers(new u(t,i),-1,e,this,n));this.onPointerUpObservable.notifyObservers(new u(t,i),-1,e,this,n)&&null!=this.parent&&!this.isPointerBlocker&&this.parent._onPointerUp(e,t,s,i,a,n),n&&this.uniqueId!==this._host.rootContainer.uniqueId&&this._host._capturedPointerIds.delete(n.event.pointerId)}_forcePointerUp(e=null){if(null!==e)this._onPointerUp(this,n.FM.Zero(),e,0,!0);else for(const e in this._downPointerIds)this._onPointerUp(this,n.FM.Zero(),+e,0,!0)}_onWheelScroll(e,t){if(!this._isEnabled)return;this.onWheelObservable.notifyObservers(new n.FM(e,t))&&null!=this.parent&&this.parent._onWheelScroll(e,t)}_onCanvasBlur(){}_processObservables(e,t,s,i,r,n,o,h){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,s),e===a.kD.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,r,i);const e=this._host._lastControlOver[r];return e&&e!==this&&e._onPointerOut(this,i),e!==this&&this._onPointerEnter(this,i),this._host._lastControlOver[r]=this,!0}return e===a.kD.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,r,n,i),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0):e===a.kD.POINTERUP?(this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,n,!0,i),delete this._host._lastControlDown[r],!0):!(e!==a.kD.POINTERWHEEL||!this._host._lastControlOver[r])&&(this._host._lastControlOver[r]._onWheelScroll(o,h),!0)}_prepareFont(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=v._GetFontOffset(this._font),this.getDescendants().forEach((e=>e._markAllAsDirty())))}clone(e){const t={};this.serialize(t);const s=new(h.w1.Instantiate("BABYLON.GUI."+t.className));return s.parse(t,e),s}parse(e,t){return m.p4.Parse((()=>this),e,null),this.name=e.name,this._parseFromContent(e,null!=t?t:this._host),this}serialize(e){m.p4.Serialize(this,e),e.name=this.name,e.className=this.getClassName(),this._font&&(e.fontFamily=this._fontFamily,e.fontSize=this.fontSize,e.fontWeight=this.fontWeight,e.fontStyle=this.fontStyle),this._gradient&&(e.gradient={},this._gradient.serialize(e.gradient)),m.p4.AppendSerializedAnimations(this,e)}_parseFromContent(e,t){var s;if(e.fontFamily&&(this.fontFamily=e.fontFamily),e.fontSize&&(this.fontSize=e.fontSize),e.fontWeight&&(this.fontWeight=e.fontWeight),e.fontStyle&&(this.fontStyle=e.fontStyle),e.gradient){const t=h.w1.Instantiate("BABYLON.GUI."+e.gradient.className);this._gradient=new t,null===(s=this._gradient)||void 0===s||s.parse(e.gradient)}if(e.animations){this.animations=[];for(let t=0;t<e.animations.length;t++){const s=e.animations[t],i=(0,p.q)("BABYLON.Animation");i&&this.animations.push(i.Parse(s))}e.autoAnimate&&this._host&&this._host.getScene()&&this._host.getScene().beginAnimation(this,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1)}}dispose(){if(this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host){this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null)}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}static get HORIZONTAL_ALIGNMENT_LEFT(){return v._HORIZONTAL_ALIGNMENT_LEFT}static get HORIZONTAL_ALIGNMENT_RIGHT(){return v._HORIZONTAL_ALIGNMENT_RIGHT}static get HORIZONTAL_ALIGNMENT_CENTER(){return v._HORIZONTAL_ALIGNMENT_CENTER}static get VERTICAL_ALIGNMENT_TOP(){return v._VERTICAL_ALIGNMENT_TOP}static get VERTICAL_ALIGNMENT_BOTTOM(){return v._VERTICAL_ALIGNMENT_BOTTOM}static get VERTICAL_ALIGNMENT_CENTER(){return v._VERTICAL_ALIGNMENT_CENTER}static _GetFontOffset(e){if(v._FontHeightSizes[e])return v._FontHeightSizes[e];const t=f.l.LastCreatedEngine;if(!t)throw new Error("Invalid engine. Unable to create a canvas.");const s=t.getFontOffset(e);return v._FontHeightSizes[e]=s,s}static Parse(e,t){const s=h.w1.Instantiate("BABYLON.GUI."+e.className),i=m.p4.Parse((()=>new s),e,null);return i.name=e.name,i._parseFromContent(e,t),i}static drawEllipse(e,t,s,i,r){r.translate(e,t),r.scale(s,i),r.beginPath(),r.arc(0,0,1,0,2*Math.PI),r.closePath(),r.scale(1/s,1/i),r.translate(-e,-t)}isReady(){return!0}}v.AllowAlphaInheritance=!1,v._ClipMeasure=new d.U(0,0,0,0),v._HORIZONTAL_ALIGNMENT_LEFT=0,v._HORIZONTAL_ALIGNMENT_RIGHT=1,v._HORIZONTAL_ALIGNMENT_CENTER=2,v._VERTICAL_ALIGNMENT_TOP=0,v._VERTICAL_ALIGNMENT_BOTTOM=1,v._VERTICAL_ALIGNMENT_CENTER=2,v._FontHeightSizes={},v.AddHeader=()=>{},(0,i.gn)([(0,m.qC)()],v.prototype,"metadata",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"isHitTestVisible",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"isPointerBlocker",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"isFocusInvisible",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"clipChildren",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"clipContent",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"useBitmapCache",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"shadowOffsetX",null),(0,i.gn)([(0,m.qC)()],v.prototype,"shadowOffsetY",null),(0,i.gn)([(0,m.qC)()],v.prototype,"shadowBlur",null),(0,i.gn)([(0,m.qC)()],v.prototype,"shadowColor",null),(0,i.gn)([(0,m.qC)()],v.prototype,"hoverCursor",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"fontOffset",null),(0,i.gn)([(0,m.qC)()],v.prototype,"alpha",null),(0,i.gn)([(0,m.qC)()],v.prototype,"scaleX",null),(0,i.gn)([(0,m.qC)()],v.prototype,"scaleY",null),(0,i.gn)([(0,m.qC)()],v.prototype,"rotation",null),(0,i.gn)([(0,m.qC)()],v.prototype,"transformCenterY",null),(0,i.gn)([(0,m.qC)()],v.prototype,"transformCenterX",null),(0,i.gn)([(0,m.qC)()],v.prototype,"horizontalAlignment",null),(0,i.gn)([(0,m.qC)()],v.prototype,"verticalAlignment",null),(0,i.gn)([(0,m.qC)()],v.prototype,"fixedRatio",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"width",null),(0,i.gn)([(0,m.qC)()],v.prototype,"height",null),(0,i.gn)([(0,m.qC)()],v.prototype,"style",null),(0,i.gn)([(0,m.qC)()],v.prototype,"color",null),(0,i.gn)([(0,m.qC)()],v.prototype,"gradient",null),(0,i.gn)([(0,m.qC)()],v.prototype,"zIndex",null),(0,i.gn)([(0,m.qC)()],v.prototype,"notRenderable",null),(0,i.gn)([(0,m.qC)()],v.prototype,"isVisible",null),(0,i.gn)([(0,m.qC)()],v.prototype,"descendantsOnlyPadding",null),(0,i.gn)([(0,m.qC)()],v.prototype,"paddingLeft",null),(0,i.gn)([(0,m.qC)()],v.prototype,"paddingRight",null),(0,i.gn)([(0,m.qC)()],v.prototype,"paddingTop",null),(0,i.gn)([(0,m.qC)()],v.prototype,"paddingBottom",null),(0,i.gn)([(0,m.qC)()],v.prototype,"left",null),(0,i.gn)([(0,m.qC)()],v.prototype,"top",null),(0,i.gn)([(0,m.qC)()],v.prototype,"linkOffsetX",null),(0,i.gn)([(0,m.qC)()],v.prototype,"linkOffsetY",null),(0,i.gn)([(0,m.qC)()],v.prototype,"isEnabled",null),(0,i.gn)([(0,m.qC)()],v.prototype,"disabledColor",null),(0,i.gn)([(0,m.qC)()],v.prototype,"disabledColorItem",null),(0,i.gn)([(0,m.qC)()],v.prototype,"overlapGroup",void 0),(0,i.gn)([(0,m.qC)()],v.prototype,"overlapDeltaMultiplier",void 0),(0,p.H)("BABYLON.GUI.Control",v)},16489:(e,t,s)=>{s.d(t,{P:()=>h});var i=s(72433),r=s(90558),n=s(76728),a=s(48620),o=s(96969);class h extends r.W{get thickness(){return this._thickness}set thickness(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())}constructor(e){super(e),this.name=e,this._thickness=1}_getTypeName(){return"Ellipse"}_localDraw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),n.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),(this._backgroundGradient||this._background)&&(e.fillStyle=this._getBackgroundColor(e),e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness}_clipForChildren(e){n.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,e),e.clip()}_renderHighlightSpecific(e){n.o.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._highlightLineWidth/2,this._currentMeasure.height/2-this._highlightLineWidth/2,e),e.stroke()}}(0,i.gn)([(0,o.qC)()],h.prototype,"thickness",null),(0,a.H)("BABYLON.GUI.Ellipse",h)},26633:(e,t,s)=>{s.d(t,{E:()=>d});var i=s(72433),r=s(62897),n=s(13514),a=s(76728),o=s(48620),h=s(96969),l=s(15210);class d extends a.o{get isLoaded(){return this._loaded}isReady(){return this.isLoaded}get detectPointerOnOpaqueOnly(){return this._detectPointerOnOpaqueOnly}set detectPointerOnOpaqueOnly(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)}get sliceLeft(){return this._sliceLeft}set sliceLeft(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())}get sliceRight(){return this._sliceRight}set sliceRight(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())}get sliceTop(){return this._sliceTop}set sliceTop(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())}get sliceBottom(){return this._sliceBottom}set sliceBottom(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())}get sourceLeft(){return this._sourceLeft}set sourceLeft(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())}get sourceTop(){return this._sourceTop}set sourceTop(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())}get sourceWidth(){return this._sourceWidth}set sourceWidth(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())}get sourceHeight(){return this._sourceHeight}set sourceHeight(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())}get imageWidth(){return this._imageWidth}get imageHeight(){return this._imageHeight}get populateNinePatchSlicesFromImage(){return this._populateNinePatchSlicesFromImage}set populateNinePatchSlicesFromImage(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())}get isSVG(){return this._isSVG}get svgAttributesComputationCompleted(){return this._svgAttributesComputationCompleted}get autoScale(){return this._autoScale}set autoScale(e){this._autoScale!==e&&(this._autoScale=e,e&&this._loaded&&this.synchronizeSizeWithContent())}get stretch(){return this._stretch}set stretch(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())}_rotate90(e,t=!1){var s,i;const r=this._domImage.width,n=this._domImage.height,a=(null===(i=null===(s=this._host)||void 0===s?void 0:s.getScene())||void 0===i?void 0:i.getEngine())||l.l.LastCreatedEngine;if(!a)throw new Error("Invalid engine. Unable to create a canvas.");const o=a.createCanvas(n,r),h=o.getContext("2d");h.translate(o.width/2,o.height/2),h.rotate(e*Math.PI/2),h.drawImage(this._domImage,0,0,r,n,-r/2,-n/2,r,n);const c=o.toDataURL("image/jpg"),u=new d(this.name+"rotated",c);return t&&(u._stretch=this._stretch,u._autoScale=this._autoScale,u._cellId=this._cellId,u._cellWidth=e%1?this._cellHeight:this._cellWidth,u._cellHeight=e%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,u,e),this._imageDataCache.data=null,u}_handleRotationForSVGImage(e,t,s){e._isSVG&&(e._svgAttributesComputationCompleted?(this._rotate90SourceProperties(e,t,s),this._markAsDirty()):e.onSVGAttributesComputedObservable.addOnce((()=>{this._rotate90SourceProperties(e,t,s),this._markAsDirty()})))}_rotate90SourceProperties(e,t,s){let i=e.sourceLeft,r=e.sourceTop,n=e.domImage.width,a=e.domImage.height,o=i,h=r,l=e.sourceWidth,d=e.sourceHeight;if(0!=s){const e=s<0?-1:1;s%=4;for(let t=0;t<Math.abs(s);++t)o=-(r-a/2)*e+a/2,h=(i-n/2)*e+n/2,[l,d]=[d,l],s<0?h-=d:o-=l,i=o,r=h,[n,a]=[a,n]}t.sourceLeft=o,t.sourceTop=h,t.sourceWidth=l,t.sourceHeight=d}_extractNinePatchSliceDataFromImage(){var e,t;const s=this._domImage.width,i=this._domImage.height;if(!this._workingCanvas){const r=(null===(t=null===(e=this._host)||void 0===e?void 0:e.getScene())||void 0===t?void 0:t.getEngine())||l.l.LastCreatedEngine;if(!r)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=r.createCanvas(s,i)}const r=this._workingCanvas.getContext("2d");r.drawImage(this._domImage,0,0,s,i);const n=r.getImageData(0,0,s,i);this._sliceLeft=-1,this._sliceRight=-1;for(let e=0;e<s;e++){const t=n.data[4*e+3];if(t>127&&-1===this._sliceLeft)this._sliceLeft=e;else if(t<127&&this._sliceLeft>-1){this._sliceRight=e;break}}this._sliceTop=-1,this._sliceBottom=-1;for(let e=0;e<i;e++){const t=n.data[e*s*4+3];if(t>127&&-1===this._sliceTop)this._sliceTop=e;else if(t<127&&this._sliceTop>-1){this._sliceBottom=e;break}}}set domImage(e){this._domImage=e,this._loaded=!1,this._imageDataCache.data=null,this._domImage.width?this._onImageLoaded():this._domImage.onload=()=>{this._onImageLoaded()}}get domImage(){return this._domImage}_onImageLoaded(){this._imageDataCache.data=null,this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()}get source(){return this._source}static ResetImageCache(){d.SourceImgCache.clear()}_removeCacheUsage(e){const t=e&&d.SourceImgCache.get(e);t&&(t.timesUsed-=1,0===t.timesUsed&&d.SourceImgCache.delete(e))}set source(e){var t,s;if(this._source===e)return;this._removeCacheUsage(this._source),this._loaded=!1,this._source=e,this._imageDataCache.data=null,e&&(e=this._svgCheck(e));const i=(null===(s=null===(t=this._host)||void 0===t?void 0:t.getScene())||void 0===s?void 0:s.getEngine())||l.l.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");if(e&&d.SourceImgCache.has(e)){const t=d.SourceImgCache.get(e);return this._domImage=t.img,t.timesUsed+=1,void(t.loaded?this._onImageLoaded():t.waitingForLoadCallback.push(this._onImageLoaded.bind(this)))}this._domImage=i.createCanvasImage(),e&&d.SourceImgCache.set(e,{img:this._domImage,timesUsed:1,loaded:!1,waitingForLoadCallback:[this._onImageLoaded.bind(this)]}),this._domImage.onload=()=>{if(e){const t=d.SourceImgCache.get(e);if(t){t.loaded=!0;for(const e of t.waitingForLoadCallback)e();return void(t.waitingForLoadCallback.length=0)}}this._onImageLoaded()},e&&(n.w1.SetCorsBehavior(e,this._domImage),n.w1.SetReferrerPolicyBehavior(this.referrerPolicy,this._domImage),this._domImage.src=e)}_svgCheck(e){if(window.SVGSVGElement&&-1!==e.search(/.svg#/gi)&&e.indexOf("#")===e.lastIndexOf("#")){this._isSVG=!0;const t=e.split("#")[0],s=e.split("#")[1],i=document.body.querySelector('object[data="'+t+'"]');if(i){const t=i.contentDocument;if(t&&t.documentElement){const r=t.documentElement.getAttribute("viewBox"),n=Number(t.documentElement.getAttribute("width")),a=Number(t.documentElement.getAttribute("height"));if(t.getElementById(s)&&r&&n&&a)return this._getSVGAttribs(i,s),e}i.addEventListener("load",(()=>{this._getSVGAttribs(i,s)}))}else{const e=document.createElement("object");e.data=t,e.type="image/svg+xml",e.width="0%",e.height="0%",document.body.appendChild(e),e.onload=()=>{const e=document.body.querySelector('object[data="'+t+'"]');e&&this._getSVGAttribs(e,s)}}return t}return e}_getSVGAttribs(e,t){const s=e.contentDocument;if(s&&s.documentElement){const e=s.documentElement.getAttribute("viewBox"),i=Number(s.documentElement.getAttribute("width")),r=Number(s.documentElement.getAttribute("height")),n=s.getElementById(t);if(e&&i&&r&&n){const t=Number(e.split(" ")[2]),s=Number(e.split(" ")[3]),a=n.getBBox();let o=1,h=1,l=0,d=0;const c=n.transform.baseVal.consolidate().matrix;n.transform&&n.transform.baseVal.consolidate()&&(o=c.a,h=c.d,l=c.e,d=c.f),this.sourceLeft=(o*a.x+l)*i/t,this.sourceTop=(h*a.y+d)*r/s,this.sourceWidth=a.width*o*(i/t),this.sourceHeight=a.height*h*(r/s),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}}get cellWidth(){return this._cellWidth}set cellWidth(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())}get cellHeight(){return this._cellHeight}set cellHeight(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())}get cellId(){return this._cellId}set cellId(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())}constructor(e,t=null){super(e),this.name=e,this._workingCanvas=null,this._loaded=!1,this._stretch=d.STRETCH_FILL,this._autoScale=!1,this._sourceLeft=0,this._sourceTop=0,this._sourceWidth=0,this._sourceHeight=0,this._svgAttributesComputationCompleted=!1,this._isSVG=!1,this._cellWidth=0,this._cellHeight=0,this._cellId=-1,this._populateNinePatchSlicesFromImage=!1,this._imageDataCache={data:null,key:""},this.onImageLoadedObservable=new r.y$,this.onSVGAttributesComputedObservable=new r.y$,this.source=t}contains(e,t){if(!super.contains(e,t))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;const s=0|this._currentMeasure.width,i=0|this._currentMeasure.height,r=s+"_"+i;let n=this._imageDataCache.data;if(!n||this._imageDataCache.key!==r){const e=this._workingCanvas.getContext("2d");this._imageDataCache.data=n=e.getImageData(0,0,s,i).data,this._imageDataCache.key=r}return n[4*((e=e-this._currentMeasure.left|0)+(t=t-this._currentMeasure.top|0)*s)+3]>0}_getTypeName(){return"Image"}synchronizeSizeWithContent(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")}_processMeasures(e,t){if(this._loaded)switch(this._stretch){case d.STRETCH_NONE:case d.STRETCH_FILL:case d.STRETCH_UNIFORM:case d.STRETCH_NINE_PATCH:break;case d.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}super._processMeasures(e,t)}_prepareWorkingCanvasForOpaqueDetection(){var e,t;if(!this._detectPointerOnOpaqueOnly)return;const s=this._currentMeasure.width,i=this._currentMeasure.height;if(!this._workingCanvas){const r=(null===(t=null===(e=this._host)||void 0===e?void 0:e.getScene())||void 0===t?void 0:t.getEngine())||l.l.LastCreatedEngine;if(!r)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=r.createCanvas(s,i)}this._workingCanvas.getContext("2d").clearRect(0,0,s,i)}_drawImage(e,t,s,i,r,n,a,o,h){if(e.drawImage(this._domImage,t,s,i,r,n,a,o,h),!this._detectPointerOnOpaqueOnly)return;(e=this._workingCanvas.getContext("2d")).drawImage(this._domImage,t,s,i,r,n-this._currentMeasure.left,a-this._currentMeasure.top,o,h)}_draw(e){let t,s,i,r;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)t=this._sourceLeft,s=this._sourceTop,i=this._sourceWidth?this._sourceWidth:this._imageWidth,r=this._sourceHeight?this._sourceHeight:this._imageHeight;else{const e=this._domImage.naturalWidth/this.cellWidth,n=this.cellId/e>>0,a=this.cellId%e;t=this.cellWidth*a,s=this.cellHeight*n,i=this.cellWidth,r=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case d.STRETCH_NONE:case d.STRETCH_FILL:this._drawImage(e,t,s,i,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case d.STRETCH_UNIFORM:{const n=this._currentMeasure.width/i,a=this._currentMeasure.height/r,o=Math.min(n,a),h=(this._currentMeasure.width-i*o)/2,l=(this._currentMeasure.height-r*o)/2;this._drawImage(e,t,s,i,r,this._currentMeasure.left+h,this._currentMeasure.top+l,i*o,r*o);break}case d.STRETCH_EXTEND:this._drawImage(e,t,s,i,r,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case d.STRETCH_NINE_PATCH:this._renderNinePatch(e)}e.restore()}_renderNinePatch(e){const t=this._sliceLeft,s=this._sliceTop,i=this._imageHeight-this._sliceBottom,r=this._imageWidth-this._sliceRight,n=this._sliceRight-this._sliceLeft,a=this._sliceBottom-this._sliceTop,o=this._currentMeasure.width-r-t+2,h=this._currentMeasure.height-i-s+2,l=this._currentMeasure.left+t-1,d=this._currentMeasure.top+s-1,c=this._currentMeasure.left+this._currentMeasure.width-r,u=this._currentMeasure.top+this._currentMeasure.height-i;this._drawImage(e,0,0,t,s,this._currentMeasure.left,this._currentMeasure.top,t,s),e.clearRect(l,this._currentMeasure.top,o,s),this._drawImage(e,this._sliceLeft,0,n,s,l,this._currentMeasure.top,o,s),e.clearRect(c,this._currentMeasure.top,r,s),this._drawImage(e,this._sliceRight,0,r,s,c,this._currentMeasure.top,r,s),e.clearRect(this._currentMeasure.left,d,t,h),this._drawImage(e,0,this._sliceTop,t,a,this._currentMeasure.left,d,t,h),e.clearRect(l,d,o,h),this._drawImage(e,this._sliceLeft,this._sliceTop,n,a,l,d,o,h),e.clearRect(c,d,r,h),this._drawImage(e,this._sliceRight,this._sliceTop,r,a,c,d,r,h),e.clearRect(this._currentMeasure.left,u,t,i),this._drawImage(e,0,this._sliceBottom,t,i,this._currentMeasure.left,u,t,i),e.clearRect(l,u,o,i),this._drawImage(e,this.sliceLeft,this._sliceBottom,n,i,l,u,o,i),e.clearRect(c,u,r,i),this._drawImage(e,this._sliceRight,this._sliceBottom,r,i,c,u,r,i)}dispose(){super.dispose(),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear(),this._removeCacheUsage(this._source)}}d.SourceImgCache=new Map,d.STRETCH_NONE=0,d.STRETCH_FILL=1,d.STRETCH_UNIFORM=2,d.STRETCH_EXTEND=3,d.STRETCH_NINE_PATCH=4,(0,i.gn)([(0,h.qC)()],d.prototype,"detectPointerOnOpaqueOnly",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sliceLeft",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sliceRight",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sliceTop",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sliceBottom",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sourceLeft",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sourceTop",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sourceWidth",null),(0,i.gn)([(0,h.qC)()],d.prototype,"sourceHeight",null),(0,i.gn)([(0,h.qC)()],d.prototype,"populateNinePatchSlicesFromImage",null),(0,i.gn)([(0,h.qC)()],d.prototype,"autoScale",null),(0,i.gn)([(0,h.qC)()],d.prototype,"stretch",null),(0,i.gn)([(0,h.qC)()],d.prototype,"source",null),(0,i.gn)([(0,h.qC)()],d.prototype,"cellWidth",null),(0,i.gn)([(0,h.qC)()],d.prototype,"cellHeight",null),(0,i.gn)([(0,h.qC)()],d.prototype,"cellId",null),(0,o.H)("BABYLON.GUI.Image",d)},71258:(e,t,s)=>{s.d(t,{g:()=>l});var i=s(72433),r=s(71419),n=s(76728),a=s(49083),o=s(48620),h=s(96969);class l extends n.o{constructor(e){super(e),this.name=e,this._lineWidth=1,this.onPointUpdate=()=>{this._markAsDirty()},this._automaticSize=!0,this.isHitTestVisible=!1,this._horizontalAlignment=n.o.HORIZONTAL_ALIGNMENT_LEFT,this._verticalAlignment=n.o.VERTICAL_ALIGNMENT_TOP,this._dash=[],this._points=[]}get dash(){return this._dash}set dash(e){this._dash!==e&&(this._dash=e,this._markAsDirty())}getAt(e){return this._points[e]||(this._points[e]=new a.s(this)),this._points[e]}add(...e){return e.map((e=>this.push(e)))}push(e){const t=this.getAt(this._points.length);return null==e||(e instanceof r.x?t.mesh=e:e instanceof n.o?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y)),t}remove(e){let t;if(e instanceof a.s){if(t=this._points.indexOf(e),-1===t)return}else t=e;const s=this._points[t];s&&(s.dispose(),this._points.splice(t,1))}reset(){for(;this._points.length>0;)this.remove(this._points.length-1)}resetLinks(){this._points.forEach((e=>{null!=e&&e.resetLinks()}))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())}set horizontalAlignment(e){}set verticalAlignment(e){}_getTypeName(){return"MultiLine"}_draw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath();let t,s=!0;this._points.forEach((i=>{i&&(s?(e.moveTo(i._point.x,i._point.y),s=!1):i._point.z<1&&t.z<1?e.lineTo(i._point.x,i._point.y):e.moveTo(i._point.x,i._point.y),t=i._point)})),e.stroke(),e.restore()}_additionalProcessing(){this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach((e=>{e&&(e.translate(),(null==this._minX||e._point.x<this._minX)&&(this._minX=e._point.x),(null==this._minY||e._point.y<this._minY)&&(this._minY=e._point.y),(null==this._maxX||e._point.x>this._maxX)&&(this._maxX=e._point.x),(null==this._maxY||e._point.y>this._maxY)&&(this._maxY=e._point.y))})),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)}_measure(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)}_computeAlignment(){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)}dispose(){this.reset(),super.dispose()}}(0,i.gn)([(0,h.qC)()],l.prototype,"dash",null),(0,o.H)("BABYLON.GUI.MultiLine",l)},99938:(e,t,s)=>{s.d(t,{e:()=>l});var i=s(72433),r=s(13514),n=s(90558),a=s(76728),o=s(48620),h=s(96969);class l extends n.W{get isVertical(){return this._isVertical}set isVertical(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())}get spacing(){return this._spacing}set spacing(e){this._spacing!==e&&(this._spacing=e,this._markAsDirty())}set width(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()}get width(){return this._width.toString(this._host)}set height(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()}get height(){return this._height.toString(this._host)}constructor(e){super(e),this.name=e,this._isVertical=!0,this._manualWidth=!1,this._manualHeight=!1,this._doNotTrackManualChanges=!1,this._spacing=0,this.ignoreLayoutWarnings=!1}_getTypeName(){return"StackPanel"}_preMeasure(e,t){for(const e of this._children)this._isVertical?e.verticalAlignment=a.o.VERTICAL_ALIGNMENT_TOP:e.horizontalAlignment=a.o.HORIZONTAL_ALIGNMENT_LEFT;super._preMeasure(e,t)}_additionalProcessing(e,t){super._additionalProcessing(e,t),this._measureForChildren.copyFrom(e),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)}_postMeasure(){let e=0,t=0;const s=this._children.length;for(let i=0;i<s;i++){const n=this._children[i];n.isVisible&&!n.notRenderable&&(this._isVertical?(n.top!==t+"px"&&(n.top=t+"px",this._rebuildLayout=!0,n._top.ignoreAdaptiveScaling=!0),n._height.isPercentage&&!n._automaticSize?this.ignoreLayoutWarnings||r.w1.Warn(`Control (Name:${n.name}, UniqueId:${n.uniqueId}) is using height in percentage mode inside a vertical StackPanel`):t+=n._currentMeasure.height+n._paddingTopInPixels+n._paddingBottomInPixels+(i<s-1?this._spacing:0)):(n.left!==e+"px"&&(n.left=e+"px",this._rebuildLayout=!0,n._left.ignoreAdaptiveScaling=!0),n._width.isPercentage&&!n._automaticSize?this.ignoreLayoutWarnings||r.w1.Warn(`Control (Name:${n.name}, UniqueId:${n.uniqueId}) is using width in percentage mode inside a horizontal StackPanel`):e+=n._currentMeasure.width+n._paddingLeftInPixels+n._paddingRightInPixels+(i<s-1?this._spacing:0)))}e+=this._paddingLeftInPixels+this._paddingRightInPixels,t+=this._paddingTopInPixels+this._paddingBottomInPixels,this._doNotTrackManualChanges=!0;let i=!1,n=!1;if((!this._manualHeight||this.adaptHeightToChildren)&&this._isVertical){const e=this.height;this.height=t+"px",n=e!==this.height||!this._height.ignoreAdaptiveScaling}if((!this._manualWidth||this.adaptWidthToChildren)&&!this._isVertical){const t=this.width;this.width=e+"px",i=t!==this.width||!this._width.ignoreAdaptiveScaling}n&&(this._height.ignoreAdaptiveScaling=!0),i&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(i||n)&&(this._rebuildLayout=!0),super._postMeasure()}serialize(e){super.serialize(e),e.manualWidth=this._manualWidth,e.manualHeight=this._manualHeight}_parseFromContent(e,t){this._manualWidth=e.manualWidth,this._manualHeight=e.manualHeight,super._parseFromContent(e,t)}}(0,i.gn)([(0,h.qC)()],l.prototype,"ignoreLayoutWarnings",void 0),(0,i.gn)([(0,h.qC)()],l.prototype,"isVertical",null),(0,i.gn)([(0,h.qC)()],l.prototype,"spacing",null),(0,i.gn)([(0,h.qC)()],l.prototype,"width",null),(0,i.gn)([(0,h.qC)()],l.prototype,"height",null),(0,o.H)("BABYLON.GUI.StackPanel",l)},90194:(e,t,s)=>{s.d(t,{a:()=>c});var i,r=s(72433),n=s(62897),a=s(55905),o=s(76728),h=s(48620),l=s(96969),d=s(15210);!function(e){e[e.Clip=0]="Clip",e[e.WordWrap=1]="WordWrap",e[e.Ellipsis=2]="Ellipsis",e[e.WordWrapEllipsis=3]="WordWrapEllipsis"}(i||(i={}));class c extends o.o{get lines(){return this._lines}get resizeToFit(){return this._resizeToFit}set resizeToFit(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())}get textWrapping(){return this._textWrapping}set textWrapping(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())}get text(){return this._text}set text(e){this._text!==e&&(this._text=e+"",this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))}get textHorizontalAlignment(){return this._textHorizontalAlignment}set textHorizontalAlignment(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())}get textVerticalAlignment(){return this._textVerticalAlignment}set textVerticalAlignment(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())}set lineSpacing(e){this._lineSpacing.fromString(e)&&this._markAsDirty()}get lineSpacing(){return this._lineSpacing.toString(this._host)}get outlineWidth(){return this._outlineWidth}set outlineWidth(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())}get underline(){return this._underline}set underline(e){this._underline!==e&&(this._underline=e,this._markAsDirty())}get lineThrough(){return this._lineThrough}set lineThrough(e){this._lineThrough!==e&&(this._lineThrough=e,this._markAsDirty())}get outlineColor(){return this._outlineColor}set outlineColor(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())}get wordDivider(){return this._wordDivider}set wordDivider(e){this._wordDivider!==e&&(this._wordDivider=e,this._markAsDirty())}get forceResizeWidth(){return this._forceResizeWidth}set forceResizeWidth(e){this._forceResizeWidth!==e&&(this._forceResizeWidth=e,this._markAsDirty())}constructor(e,t=""){super(e),this.name=e,this._text="",this._textWrapping=i.Clip,this._textHorizontalAlignment=o.o.HORIZONTAL_ALIGNMENT_CENTER,this._textVerticalAlignment=o.o.VERTICAL_ALIGNMENT_CENTER,this._resizeToFit=!1,this._lineSpacing=new a.s(0),this._outlineWidth=0,this._outlineColor="white",this._underline=!1,this._lineThrough=!1,this._wordDivider=" ",this._forceResizeWidth=!1,this.onTextChangedObservable=new n.y$,this.onLinesReadyObservable=new n.y$,this._linesTemp=[],this.text=t}_getTypeName(){return"TextBlock"}_processMeasures(e,t){this._fontOffset&&!this.isDirty||(this._fontOffset=o.o._GetFontOffset(t.font)),super._processMeasures(e,t),this._lines=this._breakLines(this._currentMeasure.width,this._currentMeasure.height,t),this.onLinesReadyObservable.notifyObservers(this);let s=0;for(let e=0;e<this._lines.length;e++){const t=this._lines[e];t.width>s&&(s=t.width)}if(this._resizeToFit){if(this._textWrapping===i.Clip||this._forceResizeWidth){const e=Math.ceil(this._paddingLeftInPixels+this._paddingRightInPixels+s);e!==this._width.getValueInPixel(this._host,this._tempParentMeasure.width)&&(this._width.updateInPlace(e,a.s.UNITMODE_PIXEL),this._rebuildLayout=!0)}let e=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){let t=0;t=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),e+=(this._lines.length-1)*t}e!==this._height.internalValue&&(this._height.updateInPlace(e,a.s.UNITMODE_PIXEL),this._rebuildLayout=!0)}}_drawText(e,t,s,i){const r=this._currentMeasure.width;let n=0;switch(this._textHorizontalAlignment){case o.o.HORIZONTAL_ALIGNMENT_LEFT:n=0;break;case o.o.HORIZONTAL_ALIGNMENT_RIGHT:n=r-t;break;case o.o.HORIZONTAL_ALIGNMENT_CENTER:n=(r-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur,i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&i.strokeText(e,this._currentMeasure.left+n,s),i.fillText(e,this._currentMeasure.left+n,s),this._underline&&(i.beginPath(),i.lineWidth=Math.round(.05*this.fontSizeInPixels),i.moveTo(this._currentMeasure.left+n,s+3),i.lineTo(this._currentMeasure.left+n+t,s+3),i.stroke(),i.closePath()),this._lineThrough&&(i.beginPath(),i.lineWidth=Math.round(.05*this.fontSizeInPixels),i.moveTo(this._currentMeasure.left+n,s-this.fontSizeInPixels/3),i.lineTo(this._currentMeasure.left+n+t,s-this.fontSizeInPixels/3),i.stroke(),i.closePath())}_draw(e){e.save(),this._applyStates(e),this._renderLines(e),e.restore()}_applyStates(e){super._applyStates(e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor,e.lineJoin="miter",e.miterLimit=2)}_breakLines(e,t,s){this._linesTemp.length=0;const r=this.text.split("\n");if(this._textWrapping===i.Ellipsis)for(const t of r)this._linesTemp.push(this._parseLineEllipsis(t,e,s));else if(this._textWrapping===i.WordWrap)for(const t of r)this._linesTemp.push(...this._parseLineWordWrap(t,e,s));else if(this._textWrapping===i.WordWrapEllipsis)for(const i of r)this._linesTemp.push(...this._parseLineWordWrapEllipsis(i,e,t,s));else for(const e of r)this._linesTemp.push(this._parseLine(e,s));return this._linesTemp}_parseLine(e="",t){return{text:e,width:this._getTextMetricsWidth(t.measureText(e))}}_getCharsToRemove(e,t,s){const i=e>t?e-t:0,r=e/s;return Math.max(Math.floor(i/r),1)}_parseLineEllipsis(e="",t,s){let i=this._getTextMetricsWidth(s.measureText(e)),r=this._getCharsToRemove(i,t,e.length);const n=Array.from&&Array.from(e);if(n)for(;n.length&&i>t;)n.splice(n.length-r,r),e=`${n.join("")}\u2026`,i=this._getTextMetricsWidth(s.measureText(e)),r=this._getCharsToRemove(i,t,e.length);else{for(;e.length>2&&i>t;)e=e.slice(0,-r),i=this._getTextMetricsWidth(s.measureText(e+"\u2026")),r=this._getCharsToRemove(i,t,e.length);e+="\u2026"}return{text:e,width:i}}_getTextMetricsWidth(e){return void 0!==e.actualBoundingBoxLeft?Math.abs(e.actualBoundingBoxLeft)+Math.abs(e.actualBoundingBoxRight):e.width}_parseLineWordWrap(e="",t,s){const i=[],r=this.wordSplittingFunction?this.wordSplittingFunction(e):e.split(this._wordDivider);let n=this._getTextMetricsWidth(s.measureText(e));for(let a=0;a<r.length;a++){const o=a>0?e+this._wordDivider+r[a]:r[0],h=this._getTextMetricsWidth(s.measureText(o));h>t&&a>0?(i.push({text:e,width:n}),e=r[a],n=this._getTextMetricsWidth(s.measureText(e))):(n=h,e=o)}return i.push({text:e,width:n}),i}_parseLineWordWrapEllipsis(e="",t,s,i){const r=this._parseLineWordWrap(e,t,i);for(let e=1;e<=r.length;e++){if(this._computeHeightForLinesOf(e)>s&&e>1){const s=r[e-2],n=r[e-1];r[e-2]=this._parseLineEllipsis(`${s.text+n.text}`,t,i);const a=r.length-e+1;for(let e=0;e<a;e++)r.pop();return r}}return r}_renderLines(e){if(!this._fontOffset||!this._lines)return;const t=this._currentMeasure.height;let s=0;switch(this._textVerticalAlignment){case o.o.VERTICAL_ALIGNMENT_TOP:s=this._fontOffset.ascent;break;case o.o.VERTICAL_ALIGNMENT_BOTTOM:s=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case o.o.VERTICAL_ALIGNMENT_CENTER:s=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}s+=this._currentMeasure.top;for(let t=0;t<this._lines.length;t++){const i=this._lines[t];0!==t&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?s+=this._lineSpacing.getValue(this._host):s+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(i.text,i.width,s,e),s+=this._fontOffset.height}}_computeHeightForLinesOf(e){let t=this._paddingTopInPixels+this._paddingBottomInPixels+this._fontOffset.height*e;if(e>0&&0!==this._lineSpacing.internalValue){let s=0;s=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),t+=(e-1)*s}return t}computeExpectedHeight(){var e;if(this.text&&this.widthInPixels){const t=null===(e=d.l.LastCreatedEngine)||void 0===e?void 0:e.createCanvas(0,0).getContext("2d");if(t){this._applyStates(t),this._fontOffset||(this._fontOffset=o.o._GetFontOffset(t.font));const e=this._lines?this._lines:this._breakLines(this.widthInPixels-this._paddingLeftInPixels-this._paddingRightInPixels,this.heightInPixels-this._paddingTopInPixels-this._paddingBottomInPixels,t);return this._computeHeightForLinesOf(e.length)}}return 0}dispose(){super.dispose(),this.onTextChangedObservable.clear()}}(0,r.gn)([(0,l.qC)()],c.prototype,"resizeToFit",null),(0,r.gn)([(0,l.qC)()],c.prototype,"textWrapping",null),(0,r.gn)([(0,l.qC)()],c.prototype,"text",null),(0,r.gn)([(0,l.qC)()],c.prototype,"textHorizontalAlignment",null),(0,r.gn)([(0,l.qC)()],c.prototype,"textVerticalAlignment",null),(0,r.gn)([(0,l.qC)()],c.prototype,"lineSpacing",null),(0,r.gn)([(0,l.qC)()],c.prototype,"outlineWidth",null),(0,r.gn)([(0,l.qC)()],c.prototype,"underline",null),(0,r.gn)([(0,l.qC)()],c.prototype,"lineThrough",null),(0,r.gn)([(0,l.qC)()],c.prototype,"outlineColor",null),(0,r.gn)([(0,l.qC)()],c.prototype,"wordDivider",null),(0,r.gn)([(0,l.qC)()],c.prototype,"forceResizeWidth",null),(0,h.H)("BABYLON.GUI.TextBlock",c)},42238:(e,t,s)=>{s.d(t,{U:()=>h});var i=s(58095);const r=[new i.FM(0,0),new i.FM(0,0),new i.FM(0,0),new i.FM(0,0)],n=[new i.FM(0,0),new i.FM(0,0),new i.FM(0,0),new i.FM(0,0)],a=new i.FM(0,0),o=new i.FM(0,0);class h{constructor(e,t,s,i){this.left=e,this.top=t,this.width=s,this.height=i}copyFrom(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height}copyFromFloats(e,t,s,i){this.left=e,this.top=t,this.width=s,this.height=i}static CombineToRef(e,t,s){const i=Math.min(e.left,t.left),r=Math.min(e.top,t.top),n=Math.max(e.left+e.width,t.left+t.width),a=Math.max(e.top+e.height,t.top+t.height);s.left=i,s.top=r,s.width=n-i,s.height=a-r}addAndTransformToRef(e,t,s,i,h,l){const d=this.left+t,c=this.top+s,u=this.width+i,_=this.height+h;r[0].copyFromFloats(d,c),r[1].copyFromFloats(d+u,c),r[2].copyFromFloats(d+u,c+_),r[3].copyFromFloats(d,c+_),a.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),o.copyFromFloats(0,0);for(let t=0;t<4;t++)e.transformCoordinates(r[t].x,r[t].y,n[t]),a.x=Math.floor(Math.min(a.x,n[t].x)),a.y=Math.floor(Math.min(a.y,n[t].y)),o.x=Math.ceil(Math.max(o.x,n[t].x)),o.y=Math.ceil(Math.max(o.y,n[t].y));l.left=a.x,l.top=a.y,l.width=o.x-a.x,l.height=o.y-a.y}transformToRef(e,t){this.addAndTransformToRef(e,0,0,0,0,t)}isEqualsTo(e){return this.left===e.left&&(this.top===e.top&&(this.width===e.width&&this.height===e.height))}static Empty(){return new h(0,0,0,0)}}},49083:(e,t,s)=>{s.d(t,{s:()=>a});var i=s(58095),r=s(48154),n=s(55905);class a{constructor(e){this._multiLine=e,this._x=new n.s(0),this._y=new n.s(0),this._point=new i.P(0,0,0)}get x(){return this._x.toString(this._multiLine._host)}set x(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()}get y(){return this._y.toString(this._multiLine._host)}set y(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()}get control(){return this._control}set control(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}get mesh(){return this._mesh}set mesh(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())}resetLinks(){this.control=null,this.mesh=null}translate(){return this._point=this._translatePoint(),this._point}_translatePoint(){if(null!=this._mesh)return this._multiLine._host.getProjectedPositionWithZ(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new i.P(this._control.centerX,this._control.centerY,1-r.kn);{const e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),s=this._y.getValueInPixel(e,Number(e._canvas.height));return new i.P(t,s,1-r.kn)}}dispose(){this.resetLinks()}}},55905:(e,t,s)=>{s.d(t,{s:()=>r});var i=s(62897);class r{constructor(e,t=r.UNITMODE_PIXEL,s=!0){this.negativeValueAllowed=s,this._value=1,this._unit=r.UNITMODE_PIXEL,this.ignoreAdaptiveScaling=!1,this.onChangedObservable=new i.y$,this._value=e,this._unit=t,this._originalUnit=t}get isPercentage(){return this._unit===r.UNITMODE_PERCENTAGE}get isPixel(){return this._unit===r.UNITMODE_PIXEL}get internalValue(){return this._value}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this.onChangedObservable.notifyObservers())}get unit(){return this._unit}set unit(e){e!==this._unit&&(this._unit=e,this.onChangedObservable.notifyObservers())}getValueInPixel(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t}updateInPlace(e,t=r.UNITMODE_PIXEL){return this.value===e&&this.unit===t||(this._value=e,this._unit=t,this.onChangedObservable.notifyObservers()),this}getValue(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==r.UNITMODE_PERCENTAGE){let t=0,s=0;if(e.idealWidth&&(t=this._value*e.getSize().width/e.idealWidth),e.idealHeight&&(s=this._value*e.getSize().height/e.idealHeight),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?t:s;if(e.idealWidth)return t;if(e.idealHeight)return s}return this._value}toString(e,t){switch(this._unit){case r.UNITMODE_PERCENTAGE:{const s=100*this.getValue(e);return(t?s.toFixed(t):s)+"%"}case r.UNITMODE_PIXEL:{const s=this.getValue(e);return(t?s.toFixed(t):s)+"px"}}return this._unit.toString()}fromString(e){const t=r._Regex.exec(e.toString());if(!t||0===t.length)return!1;let s=parseFloat(t[1]),i=this._originalUnit;if(this.negativeValueAllowed||s<0&&(s=0),4===t.length)switch(t[3]){case"px":i=r.UNITMODE_PIXEL;break;case"%":i=r.UNITMODE_PERCENTAGE,s/=100}return(s!==this._value||i!==this._unit)&&(this._value=s,this._unit=i,this.onChangedObservable.notifyObservers(),!0)}static get UNITMODE_PERCENTAGE(){return r._UNITMODE_PERCENTAGE}static get UNITMODE_PIXEL(){return r._UNITMODE_PIXEL}}r._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,r._UNITMODE_PERCENTAGE=0,r._UNITMODE_PIXEL=1}}]);