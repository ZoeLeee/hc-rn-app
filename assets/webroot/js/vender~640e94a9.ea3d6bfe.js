/*! For license information please see vender~640e94a9.ea3d6bfe.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[637],{55277:(e,t)=>{t.byteLength=function(e){var t=l(e),n=t[0],s=t[1];return 3*(n+s)/4-s},t.toByteArray=function(e){var t,n,i=l(e),o=i[0],a=i[1],c=new r(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),h=0,d=a>0?o-4:o;for(n=0;n<d;n+=4)t=s[e.charCodeAt(n)]<<18|s[e.charCodeAt(n+1)]<<12|s[e.charCodeAt(n+2)]<<6|s[e.charCodeAt(n+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=255&t;2===a&&(t=s[e.charCodeAt(n)]<<2|s[e.charCodeAt(n+1)]>>4,c[h++]=255&t);1===a&&(t=s[e.charCodeAt(n)]<<10|s[e.charCodeAt(n+1)]<<4|s[e.charCodeAt(n+2)]>>2,c[h++]=t>>8&255,c[h++]=255&t);return c},t.fromByteArray=function(e){for(var t,s=e.length,r=s%3,i=[],o=16383,a=0,l=s-r;a<l;a+=o)i.push(c(e,a,a+o>l?l:a+o));1===r?(t=e[s-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[s-2]<<8)+e[s-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],s=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=i.length;o<a;++o)n[o]=i[o],s[i.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,s){for(var r,i,o=[],a=t;a<s;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(i=r)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},75291:(e,t,n)=>{const s=n(55277),r=n(2608),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.lW=l,t.h2=50;const o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|_(e,t);let s=a(n);const r=s.write(e,t);r!==n&&(s=s.slice(0,r));return s}(e,t);if(ArrayBuffer.isView(e))return function(e){if(q(e,Uint8Array)){const t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return u(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(q(e,ArrayBuffer)||e&&q(e.buffer,ArrayBuffer))return f(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(q(e,SharedArrayBuffer)||e&&q(e.buffer,SharedArrayBuffer)))return f(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const s=e.valueOf&&e.valueOf();if(null!=s&&s!==e)return l.from(s,t,n);const r=function(e){if(l.isBuffer(e)){const t=0|p(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||X(e.length)?a(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return h(e),a(e<0?0:0|p(e))}function u(e){const t=e.length<0?0:0|p(e.length),n=a(t);for(let s=0;s<t;s+=1)n[s]=255&e[s];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let s;return s=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(s,l.prototype),s}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function _(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||q(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return Y(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K(e).length;default:if(r)return s?-1:Y(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){let s=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return M(this,t,n);case"latin1":case"binary":return P(this,t,n);case"base64":return O(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,n);default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function g(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function y(e,t,n,s,r){if(0===e.length)return-1;if("string"==typeof n?(s=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),X(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=l.from(t,s)),l.isBuffer(t))return 0===t.length?-1:b(e,t,n,s,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,s,r);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,s,r){let i,o=1,a=e.length,l=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return-1;o=2,a/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){let s=-1;for(i=n;i<a;i++)if(c(e,i)===c(t,-1===s?0:i-s)){if(-1===s&&(s=i),i-s+1===l)return s*o}else-1!==s&&(i-=i-s),s=-1}else for(n+l>a&&(n=a-l),i=n;i>=0;i--){let n=!0;for(let s=0;s<l;s++)if(c(e,i+s)!==c(t,s)){n=!1;break}if(n)return i}return-1}function A(e,t,n,s){n=Number(n)||0;const r=e.length-n;s?(s=Number(s))>r&&(s=r):s=r;const i=t.length;let o;for(s>i/2&&(s=i/2),o=0;o<s;++o){const s=parseInt(t.substr(2*o,2),16);if(X(s))return o;e[n+o]=s}return o}function T(e,t,n,s){return z(Y(t,e.length-n),e,n,s)}function E(e,t,n,s){return z(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,s)}function v(e,t,n,s){return z(K(t),e,n,s)}function x(e,t,n,s){return z(function(e,t){let n,s,r;const i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),s=n>>8,r=n%256,i.push(r),i.push(s);return i}(t,e.length-n),e,n,s)}function O(e,t,n){return 0===t&&n===e.length?s.fromByteArray(e):s.fromByteArray(e.slice(t,n))}function w(e,t,n){n=Math.min(e.length,n);const s=[];let r=t;for(;r<n;){const t=e[r];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(r+o<=n){let n,s,a,l;switch(o){case 1:t<128&&(i=t);break;case 2:n=e[r+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(i=l));break;case 3:n=e[r+1],s=e[r+2],128==(192&n)&&128==(192&s)&&(l=(15&t)<<12|(63&n)<<6|63&s,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:n=e[r+1],s=e[r+2],a=e[r+3],128==(192&n)&&128==(192&s)&&128==(192&a)&&(l=(15&t)<<18|(63&n)<<12|(63&s)<<6|63&a,l>65535&&l<1114112&&(i=l))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,s.push(i>>>10&1023|55296),i=56320|1023&i),s.push(i),r+=o}return function(e){const t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);let n="",s=0;for(;s<t;)n+=String.fromCharCode.apply(String,e.slice(s,s+=C));return n}(s)}l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return h(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(q(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),q(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,s=t.length;for(let r=0,i=Math.min(n,s);r<i;++r)if(e[r]!==t[r]){n=e[r],s=t[r];break}return n<s?-1:s<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const s=l.allocUnsafe(t);let r=0;for(n=0;n<e.length;++n){let t=e[n];if(q(t,Uint8Array))r+t.length>s.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(s,r)):Uint8Array.prototype.set.call(s,t,r);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(s,r)}r+=t.length}return s},l.byteLength=_,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):m.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const n=t.h2;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},i&&(l.prototype[i]=l.prototype.inspect),l.prototype.compare=function(e,t,n,s,r){if(q(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===s&&(s=0),void 0===r&&(r=this.length),t<0||n>e.length||s<0||r>this.length)throw new RangeError("out of range index");if(s>=r&&t>=n)return 0;if(s>=r)return-1;if(t>=n)return 1;if(this===e)return 0;let i=(r>>>=0)-(s>>>=0),o=(n>>>=0)-(t>>>=0);const a=Math.min(i,o),c=this.slice(s,r),h=e.slice(t,n);for(let e=0;e<a;++e)if(c[e]!==h[e]){i=c[e],o=h[e];break}return i<o?-1:o<i?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},l.prototype.write=function(e,t,n,s){if(void 0===t)s="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)s=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===s&&(s="utf8")):(s=n,n=void 0)}const r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let i=!1;for(;;)switch(s){case"hex":return A(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return v(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function M(e,t,n){let s="";n=Math.min(e.length,n);for(let r=t;r<n;++r)s+=String.fromCharCode(127&e[r]);return s}function P(e,t,n){let s="";n=Math.min(e.length,n);for(let r=t;r<n;++r)s+=String.fromCharCode(e[r]);return s}function R(e,t,n){const s=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>s)&&(n=s);let r="";for(let s=t;s<n;++s)r+=Z[e[s]];return r}function S(e,t,n){const s=e.slice(t,n);let r="";for(let e=0;e<s.length-1;e+=2)r+=String.fromCharCode(s[e]+256*s[e+1]);return r}function L(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,s,r,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+s>e.length)throw new RangeError("Index out of range")}function N(e,t,n,s,r){G(t,s,r,e,n,7);let i=Number(t&BigInt(4294967295));e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function F(e,t,n,s,r){G(t,s,r,e,n,7);let i=Number(t&BigInt(4294967295));e[n+7]=i,i>>=8,e[n+6]=i,i>>=8,e[n+5]=i,i>>=8,e[n+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function B(e,t,n,s,r,i){if(n+s>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(e,t,n,s,i){return t=+t,n>>>=0,i||B(e,0,n,4),r.write(e,t,n,s,23,4),n+4}function U(e,t,n,s,i){return t=+t,n>>>=0,i||B(e,0,n,8),r.write(e,t,n,s,52,8),n+8}l.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const s=this.subarray(e,t);return Object.setPrototypeOf(s,l.prototype),s},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let s=this[e],r=1,i=0;for(;++i<t&&(r*=256);)s+=this[e+i]*r;return s},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let s=this[e+--t],r=1;for(;t>0&&(r*=256);)s+=this[e+--t]*r;return s},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||L(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=J((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const s=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,r=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(s)+(BigInt(r)<<BigInt(32))})),l.prototype.readBigUInt64BE=J((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const s=t*2**24+65536*this[++e]+256*this[++e]+this[++e],r=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(s)<<BigInt(32))+BigInt(r)})),l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let s=this[e],r=1,i=0;for(;++i<t&&(r*=256);)s+=this[e+i]*r;return r*=128,s>=r&&(s-=Math.pow(2,8*t)),s},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||L(e,t,this.length);let s=t,r=1,i=this[e+--s];for(;s>0&&(r*=256);)i+=this[e+--s]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},l.prototype.readInt8=function(e,t){return e>>>=0,t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||L(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||L(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=J((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const s=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(s)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=J((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||j(e,this.length-8);const s=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(s)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||L(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||L(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||L(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||L(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,s){if(e=+e,t>>>=0,n>>>=0,!s){I(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=1,i=0;for(this[t]=255&e;++i<n&&(r*=256);)this[t+i]=e/r&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,s){if(e=+e,t>>>=0,n>>>=0,!s){I(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=n-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=J((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=J((function(e,t=0){return F(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,n,s){if(e=+e,t>>>=0,!s){const s=Math.pow(2,8*n-1);I(this,e,t,n,s-1,-s)}let r=0,i=1,o=0;for(this[t]=255&e;++r<n&&(i*=256);)e<0&&0===o&&0!==this[t+r-1]&&(o=1),this[t+r]=(e/i>>0)-o&255;return t+n},l.prototype.writeIntBE=function(e,t,n,s){if(e=+e,t>>>=0,!s){const s=Math.pow(2,8*n-1);I(this,e,t,n,s-1,-s)}let r=n-1,i=1,o=0;for(this[t+r]=255&e;--r>=0&&(i*=256);)e<0&&0===o&&0!==this[t+r+1]&&(o=1),this[t+r]=(e/i>>0)-o&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=J((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=J((function(e,t=0){return F(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,n){return D(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return D(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,s){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<n&&(s=n),s===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-n&&(s=e.length-t+n);const r=s-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,s):Uint8Array.prototype.set.call(e,this.subarray(n,s),t),r},l.prototype.fill=function(e,t,n,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,n=this.length):"string"==typeof n&&(s=n,n=this.length),void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("string"==typeof s&&!l.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(1===e.length){const t=e.charCodeAt(0);("utf8"===s&&t<128||"latin1"===s)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{const i=l.isBuffer(e)?e:l.from(e,s),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=i[r%o]}return this};const V={};function $(e,t,n){V[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function k(e){let t="",n=e.length;const s="-"===e[0]?1:0;for(;n>=s+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function G(e,t,n,s,r,i){if(e>n||e<t){const s="bigint"==typeof t?"n":"";let r;throw r=i>3?0===t||t===BigInt(0)?`>= 0${s} and < 2${s} ** ${8*(i+1)}${s}`:`>= -(2${s} ** ${8*(i+1)-1}${s}) and < 2 ** ${8*(i+1)-1}${s}`:`>= ${t}${s} and <= ${n}${s}`,new V.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){W(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||j(t,e.length-(n+1))}(s,r,i)}function W(e,t){if("number"!=typeof e)throw new V.ERR_INVALID_ARG_TYPE(t,"number",e)}function j(e,t,n){if(Math.floor(e)!==e)throw W(e,n),new V.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new V.ERR_BUFFER_OUT_OF_BOUNDS;throw new V.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}$("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),$("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),$("ERR_OUT_OF_RANGE",(function(e,t,n){let s=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>2**32?r=k(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=k(r)),r+="n"),s+=` It must be ${t}. Received ${r}`,s}),RangeError);const H=/[^+/0-9A-Za-z-_]/g;function Y(e,t){let n;t=t||1/0;const s=e.length;let r=null;const i=[];for(let o=0;o<s;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===s){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function K(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(H,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,s){let r;for(r=0;r<s&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const Z=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const s=16*n;for(let r=0;r<16;++r)t[s+r]=e[n]+e[r]}return t}();function J(e){return"undefined"==typeof BigInt?Q:e}function Q(){throw new Error("BigInt not supported")}},65301:(e,t,n)=>{n.d(t,{mp:()=>m});var s=n(15631),r=n(73803),i=n(3085);class o{constructor(){this.materials=[]}parseMTL(e,t,n,r){if(t instanceof ArrayBuffer)return;const a=t.split("\n"),l=/\s+/;let c,h=null;for(let t=0;t<a.length;t++){const d=a[t].trim();if(0===d.length||"#"===d.charAt(0))continue;const u=d.indexOf(" ");let f=u>=0?d.substring(0,u):d;f=f.toLowerCase();const p=u>=0?d.substring(u+1).trim():"";if("newmtl"===f)h&&this.materials.push(h),e._blockEntityCollection=!!r,h=new i.K(p,e),h._parentContainer=r,e._blockEntityCollection=!1;else if("kd"===f&&h)c=p.split(l,3).map(parseFloat),h.diffuseColor=s.Wo.FromArray(c);else if("ka"===f&&h)c=p.split(l,3).map(parseFloat),h.ambientColor=s.Wo.FromArray(c);else if("ks"===f&&h)c=p.split(l,3).map(parseFloat),h.specularColor=s.Wo.FromArray(c);else if("ke"===f&&h)c=p.split(l,3).map(parseFloat),h.emissiveColor=s.Wo.FromArray(c);else if("ns"===f&&h)h.specularPower=parseFloat(p);else if("d"===f&&h)h.alpha=parseFloat(p);else if("map_ka"===f&&h)h.ambientTexture=o._GetTexture(n,p,e);else if("map_kd"===f&&h)h.diffuseTexture=o._GetTexture(n,p,e);else if("map_ks"===f&&h)h.specularTexture=o._GetTexture(n,p,e);else if("map_ns"===f);else if("map_bump"===f&&h){const t=p.split(l),s=t.indexOf("-bm");let r=null;s>=0&&(r=t[s+1],t.splice(s,2)),h.bumpTexture=o._GetTexture(n,t.join(" "),e),h.bumpTexture&&null!==r&&(h.bumpTexture.level=parseFloat(r))}else"map_d"===f&&h&&(h.opacityTexture=o._GetTexture(n,p,e))}h&&this.materials.push(h)}static _GetTexture(e,t,n){if(!t)return null;let s=e;if("file:"===e){let e=t.lastIndexOf("\\");-1===e&&(e=t.lastIndexOf("/")),s+=e>-1?t.substr(e+1):t}else s+=t;return new r.x(s,n,!1,o.INVERT_TEXTURE_Y)}}o.INVERT_TEXTURE_Y=!0;var a=n(72208),l=n(58095),c=n(63946),h=n(91243),d=n(89209);class u{constructor(e,t,n){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new s.HE(.5,.5,.5,1),this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=n}_isInArray(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});const n=e[t[0]].normals.indexOf(t[1]);return-1===n?-1:e[t[0]].idx[n]}_isInArrayUV(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});const n=e[t[0]].normals.indexOf(t[1]);return 1!=n&&t[2]===e[t[0]].uv[n]?e[t[0]].idx[n]:-1}_setData(e,t,n,s,r,i,o){let a;a=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[e,n,t]):this._isInArray(this._tuplePosNorm,[e,n]),-1===a?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(s),this._wrappedUvsForBabylon.push(r),this._wrappedNormalsForBabylon.push(i),void 0!==o&&this._wrappedColorsForBabylon.push(o),this._tuplePosNorm[e].normals.push(n),this._tuplePosNorm[e].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e].uv.push(t)):this._indicesForBabylon.push(a)}_unwrapData(){for(let e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}_getTriangles(e,t){for(let n=t;n<e.length-1;n++)this._triangles.push(e[0],e[n],e[n+1])}_setDataForCurrentFaceWithPattern1(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=parseInt(this._triangles[e])-1;this._setData(t,0,0,this._positions[t],l.FM.Zero(),l.P.Up(),this._loadingOptions.importVertexColors?this._colors[t]:void 0)}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("/"),n=parseInt(t[0])-1,s=parseInt(t[1])-1;this._setData(n,s,0,this._positions[n],this._uvs[s],l.P.Up(),this._loadingOptions.importVertexColors?this._colors[n]:void 0)}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("/"),n=parseInt(t[0])-1,s=parseInt(t[1])-1,r=parseInt(t[2])-1;this._setData(n,s,r,this._positions[n],this._uvs[s],this._normals[r])}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("//"),n=parseInt(t[0])-1,s=parseInt(t[1])-1;this._setData(n,1,s,this._positions[n],l.FM.Zero(),this._normals[s],this._loadingOptions.importVertexColors?this._colors[n]:void 0)}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("/"),n=this._positions.length+parseInt(t[0]),s=this._uvs.length+parseInt(t[1]),r=this._normals.length+parseInt(t[2]);this._setData(n,s,r,this._positions[n],this._uvs[s],this._normals[r],this._loadingOptions.importVertexColors?this._colors[n]:void 0)}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0)}_optimizeNormals(e){const t=e.getVerticesData(a.o.PositionKind),n=e.getVerticesData(a.o.NormalKind),s={};if(!t||!n)return;for(let e=0;e<t.length/3;e++){const n=t[3*e+0]+"_"+t[3*e+1]+"_"+t[3*e+2];let r=s[n];r||(r=[],s[n]=r),r.push(e)}const r=new l.P;for(const e in s){const t=s[e];if(t.length<2)continue;const i=t[0];for(let e=1;e<t.length;++e){const s=t[e];n[3*i+0]+=n[3*s+0],n[3*i+1]+=n[3*s+1],n[3*i+2]+=n[3*s+2]}r.copyFromFloats(n[3*i+0],n[3*i+1],n[3*i+2]),r.normalize();for(let e=0;e<t.length;++e){const s=t[e];n[3*s+0]=r.x,n[3*s+1]=r.y,n[3*s+2]=r.z}}e.setVerticesData(a.o.NormalKind,n)}parse(e,t,n,r,o){var a;const f=t.split("\n");for(let e=0;e<f.length;e++){const t=f[e].trim().replace(/\s\s/g," ");let n;if(0!==t.length&&"#"!==t.charAt(0))if(u.VertexPattern.test(t)){if(n=t.match(/[^ ]+/g),this._positions.push(new l.P(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))),this._loadingOptions.importVertexColors)if(n.length>=7){const e=parseFloat(n[4]),t=parseFloat(n[5]),r=parseFloat(n[6]);this._colors.push(new s.HE(e>1?e/255:e,t>1?t/255:t,r>1?r/255:r,7===n.length||void 0===n[7]?1:parseFloat(n[7])))}else this._colors.push(this._grayColor)}else if(null!==(n=u.NormalPattern.exec(t)))this._normals.push(new l.P(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])));else if(null!==(n=u.UVPattern.exec(t)))this._uvs.push(new l.FM(parseFloat(n[1])*this._loadingOptions.UVScaling.x,parseFloat(n[2])*this._loadingOptions.UVScaling.y));else if(null!==(n=u.FacePattern3.exec(t)))this._setDataForCurrentFaceWithPattern3(n[1].trim().split(" "),1);else if(null!==(n=u.FacePattern4.exec(t)))this._setDataForCurrentFaceWithPattern4(n[1].trim().split(" "),1);else if(null!==(n=u.FacePattern5.exec(t)))this._setDataForCurrentFaceWithPattern5(n[1].trim().split(" "),1);else if(null!==(n=u.FacePattern2.exec(t)))this._setDataForCurrentFaceWithPattern2(n[1].trim().split(" "),1);else if(null!==(n=u.FacePattern1.exec(t)))this._setDataForCurrentFaceWithPattern1(n[1].trim().split(" "),1);else if(u.GroupDescriptor.test(t)||u.ObjectDescriptor.test(t)){const e={name:t.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:this._materialNameFromObj};this._addPreviousObjMesh(),this._meshesFromObj.push(e),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(u.UseMtlDescriptor.test(t)){if(this._materialNameFromObj=t.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();const e={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:this._materialNameFromObj};this._increment++,this._meshesFromObj.push(e),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else u.MtlLibGroupDescriptor.test(t)?o(t.substring(7).trim()):u.SmoothDescriptor.test(t)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){let e=null;if(this._indicesForBabylon.length)this._indicesForBabylon.reverse(),this._unwrapData();else{for(const e of this._positions)this._unwrappedPositionsForBabylon.push(e.x,e.y,e.z);if(this._normals.length)for(const e of this._normals)this._unwrappedNormalsForBabylon.push(e.x,e.y,e.z);if(this._uvs.length)for(const e of this._uvs)this._unwrappedUVForBabylon.push(e.x,e.y);if(this._colors.length)for(const e of this._colors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);this._materialNameFromObj||(e=new i.K(c.Z.RandomId(),n),e.pointsCloud=!0,this._materialNameFromObj=e.name,this._normals.length||(e.disableLighting=!0,e.emissiveColor=s.Wo.White()))}this._meshesFromObj.push({name:c.Z.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:e})}for(let t=0;t<this._meshesFromObj.length;t++){if(e&&this._meshesFromObj[t].name)if(e instanceof Array){if(-1===e.indexOf(this._meshesFromObj[t].name))continue}else if(this._meshesFromObj[t].name!==e)continue;this._handledMesh=this._meshesFromObj[t],n._blockEntityCollection=!!r;const s=new h.Kj(this._meshesFromObj[t].name,n);if(s._parentContainer=r,n._blockEntityCollection=!1,this._materialToUse.push(this._meshesFromObj[t].materialName),0===(null===(a=this._handledMesh.positions)||void 0===a?void 0:a.length)){this._babylonMeshesArray.push(s);continue}const i=new d.x;if(i.uvs=this._handledMesh.uvs,i.indices=this._handledMesh.indices,i.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){const e=new Array;d.x.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,e),i.normals=e}else i.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(i.colors=this._handledMesh.colors),i.applyToMesh(s),this._loadingOptions.invertY&&(s.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(s),this._babylonMeshesArray.push(s),this._handledMesh.directMaterial&&(s.material=this._handledMesh.directMaterial)}}}u.ObjectDescriptor=/^o/,u.GroupDescriptor=/^g/,u.MtlLibGroupDescriptor=/^mtllib /,u.UseMtlDescriptor=/^usemtl /,u.SmoothDescriptor=/^s /,u.VertexPattern=/v(\s+[\d|.|+|\-|e|E]+){3,7}/,u.NormalPattern=/vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,u.UVPattern=/vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,u.FacePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,u.FacePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,u.FacePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,u.FacePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,u.FacePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/;var f=n(13514),p=n(63407),_=n(7701);class m{static get INVERT_TEXTURE_Y(){return o.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(e){o.INVERT_TEXTURE_Y=e}constructor(e){this.name="obj",this.extensions=".obj",this._assetContainer=null,this._loadingOptions=e||m._DefaultLoadingOptions}static get _DefaultLoadingOptions(){return{computeNormals:m.COMPUTE_NORMALS,optimizeNormals:m.OPTIMIZE_NORMALS,importVertexColors:m.IMPORT_VERTEX_COLORS,invertY:m.INVERT_Y,invertTextureY:m.INVERT_TEXTURE_Y,UVScaling:m.UV_SCALING,materialLoadingFailsSilently:m.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:m.OPTIMIZE_WITH_UV,skipMaterials:m.SKIP_MATERIALS}}_loadMTL(e,t,n,s){const r=t+e;f.w1.LoadFile(r,n,void 0,void 0,!1,((e,t)=>{s(r,t)}))}createPlugin(){return new m(m._DefaultLoadingOptions)}canDirectLoad(){return!1}importMeshAsync(e,t,n,s){return this._parseSolid(e,t,n,s).then((e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]})))}loadAsync(e,t,n){return this.importMeshAsync(null,e,t,n).then((()=>{}))}loadAssetContainerAsync(e,t,n){const s=new _.TJ(e);return this._assetContainer=s,this.importMeshAsync(null,e,t,n).then((e=>(e.meshes.forEach((e=>s.meshes.push(e))),e.meshes.forEach((e=>{const t=e.material;if(t&&-1==s.materials.indexOf(t)){s.materials.push(t);t.getActiveTextures().forEach((e=>{-1==s.textures.indexOf(e)&&s.textures.push(e)}))}})),this._assetContainer=null,s))).catch((e=>{throw this._assetContainer=null,e}))}_parseSolid(e,t,n,s){let r="";const i=new o,a=new Array,l=[];new u(a,l,this._loadingOptions).parse(e,n,t,this._assetContainer,(e=>{r=e}));const c=[];return""===r||this._loadingOptions.skipMaterials||c.push(new Promise(((e,n)=>{this._loadMTL(r,s,(o=>{try{i.parseMTL(t,o,s,this._assetContainer);for(let e=0;e<i.materials.length;e++){let t=0;const n=[];let s;for(;(s=a.indexOf(i.materials[e].name,t))>-1;)n.push(s),t=s+1;if(-1===s&&0===n.length)i.materials[e].dispose();else for(let t=0;t<n.length;t++){const s=l[n[t]],r=i.materials[e];s.material=r,s.getTotalIndices()||(r.pointsCloud=!0)}}e()}catch(t){f.w1.Warn(`Error processing MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?e():n(t)}}),((t,s)=>{f.w1.Warn(`Error downloading MTL file: '${r}'`),this._loadingOptions.materialLoadingFailsSilently?e():n(s)}))}))),Promise.all(c).then((()=>l))}}m.OPTIMIZE_WITH_UV=!0,m.INVERT_Y=!1,m.IMPORT_VERTEX_COLORS=!1,m.COMPUTE_NORMALS=!1,m.OPTIMIZE_NORMALS=!1,m.UV_SCALING=new l.FM(1,1),m.SKIP_MATERIALS=!1,m.MATERIAL_LOADING_FAILS_SILENTLY=!0,p.n&&p.n.RegisterPlugin(new m)},5515:(e,t,n)=>{var s=n(13514),r=n(72208),i=n(91243),o=n(63407),a=n(7701);class l{constructor(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}importMesh(e,t,n,r,o){let a;if("string"!=typeof n){if(this._isBinary(n)){const e=new i.Kj("stlmesh",t);return this._parseBinary(e,n),o&&o.push(e),!0}const e=new Uint8Array(n);let s="";for(let t=0;t<n.byteLength;t++)s+=String.fromCharCode(e[t]);n=s}for(;a=this.solidPattern.exec(n);){let n=a[1];if(n!=a[3])return s.w1.Error("Error in STL, solid name != endsolid name"),!1;if(e&&n)if(e instanceof Array){if(!e.indexOf(n))continue}else if(n!==e)continue;n=n||"stlmesh";const r=new i.Kj(n,t);this._parseASCII(r,a[2]),o&&o.push(r)}return!0}load(e,t,n){return this.importMesh(null,e,t,n,null)}loadAssetContainer(e,t,n){const s=new a.TJ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,n,s.meshes),e._blockEntityCollection=!1,s}_isBinary(e){const t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const n=[115,111,108,105,100];for(let e=0;e<5;e++)if(t.getUint8(e)!==n[e])return!0;return!1}_parseBinary(e,t){const n=new DataView(t),s=n.getUint32(80,!0);let i=0;const o=new Float32Array(3*s*3),a=new Float32Array(3*s*3),c=new Uint32Array(3*s);let h=0;for(let e=0;e<s;e++){const t=84+50*e,s=n.getFloat32(t,!0),r=n.getFloat32(t+4,!0),d=n.getFloat32(t+8,!0);for(let e=1;e<=3;e++){const c=t+12*e;o[i]=n.getFloat32(c,!0),a[i]=s,l.DO_NOT_ALTER_FILE_COORDINATES?(o[i+1]=n.getFloat32(c+4,!0),o[i+2]=n.getFloat32(c+8,!0),a[i+1]=r,a[i+2]=d):(o[i+2]=n.getFloat32(c+4,!0),o[i+1]=n.getFloat32(c+8,!0),a[i+2]=r,a[i+1]=d),i+=3}l.DO_NOT_ALTER_FILE_COORDINATES?(c[h]=h,c[h+1]=h+2,c[h+2]=h+1,h+=3):(c[h]=h++,c[h]=h++,c[h]=h++)}e.setVerticesData(r.o.PositionKind,o),e.setVerticesData(r.o.NormalKind,a),e.setIndices(c),e.computeWorldMatrix(!0)}_parseASCII(e,t){const n=[],s=[],i=[];let o,a=0;for(;o=this.facetsPattern.exec(t);){const e=o[1],t=this.normalPattern.exec(e);if(this.normalPattern.lastIndex=0,!t)continue;const r=[Number(t[1]),Number(t[5]),Number(t[3])];let c;for(;c=this.vertexPattern.exec(e);)l.DO_NOT_ALTER_FILE_COORDINATES?(n.push(Number(c[1]),Number(c[3]),Number(c[5])),s.push(r[0],r[2],r[1])):(n.push(Number(c[1]),Number(c[5]),Number(c[3])),s.push(r[0],r[1],r[2]));l.DO_NOT_ALTER_FILE_COORDINATES?(i.push(a,a+2,a+1),a+=3):i.push(a++,a++,a++),this.vertexPattern.lastIndex=0}this.facetsPattern.lastIndex=0,e.setVerticesData(r.o.PositionKind,n),e.setVerticesData(r.o.NormalKind,s),e.setIndices(i),e.computeWorldMatrix(!0)}}l.DO_NOT_ALTER_FILE_COORDINATES=!1,o.n&&o.n.RegisterPlugin(new l)},76764:(e,t,n)=>{var s=n(94138),r=n(58095),i=n(15631),o=n(13514),a=n(2055),l=n(78098),c=n(45345),h=n(4849),d=n(48017),u=n(52106),f=n(98163),p=n(47914),_=n(73803),m=n(30700),g=n(72208),y=n(63946),b=n(91243),A=n(8471),T=n(27398),E=n(88862),v=n(79245),x=n(84318),O=n(91859),w=n(18770);function C(e,t,n,s){return r.P.FromArray(t,n).scaleInPlace(s)}class M{constructor(e,t,n,s){this.type=e,this.name=t,this.getValue=n,this.getStride=s}_buildAnimation(e,t,n){const s=new w.f(e,this.name,t,this.type);return s.setKeys(n),s}}class P extends M{buildAnimations(e,t,n,s,r){r(e._babylonTransformNode,this._buildAnimation(t,n,s))}}const R={translation:[new P(w.f.ANIMATIONTYPE_VECTOR3,"position",C,(()=>3))],rotation:[new P(w.f.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(e,t,n,s){return r._f.FromArray(t,n).scaleInPlace(s)}),(()=>4))],scale:[new P(w.f.ANIMATIONTYPE_VECTOR3,"scaling",C,(()=>3))],weights:[new class extends M{buildAnimations(e,t,n,s,r){if(e._numMorphTargets)for(let i=0;i<e._numMorphTargets;i++){const o=new w.f(`${t}_${i}`,this.name,n,this.type);if(o.setKeys(s.map((e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[i]:void 0,value:e.value[i],outTangent:e.outTangent?e.outTangent[i]:void 0,interpolation:e.interpolation})))),e._primitiveBabylonMeshes)for(const t of e._primitiveBabylonMeshes)if(t.morphTargetManager){const e=t.morphTargetManager.getTarget(i),n=o.clone();e.animations.push(n),r(e,n)}}}}(w.f.ANIMATIONTYPE_FLOAT,"influence",(function(e,t,n,s){const r=new Array(e._numMorphTargets);for(let e=0;e<r.length;e++)r[e]=t[n++]*s;return r}),(e=>e._numMorphTargets))]};function S(...e){const t=e=>e&&"object"==typeof e;return e.reduce(((e,n)=>(Object.keys(n).forEach((s=>{const r=e[s],i=n[s];Array.isArray(r)&&Array.isArray(i)?e[s]=r.concat(...i):t(r)&&t(i)?e[s]=S(r,i):e[s]=i})),e)),{})}class L{static Get(e,t,n){if(!t||null==n||!t[n])throw new Error(`${e}: Failed to find index (${n})`);return t[n]}static Assign(e){if(e)for(let t=0;t<e.length;t++)e[t].index=t}}class I{static RegisterExtension(e,t){I.UnregisterExtension(e)&&x.Y.Warn(`Extension with the name '${e}' already exists`),I._RegisteredExtensions[e]={factory:t}}static UnregisterExtension(e){return!!I._RegisteredExtensions[e]&&(delete I._RegisteredExtensions[e],!0)}get gltf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}constructor(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((e=>e.dispose&&e.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(e,t,n,s,r,i,o=""){return Promise.resolve().then((()=>{this._babylonScene=t,this._assetContainer=n,this._loadData(s);let i=null;if(e){const t={};if(this._gltf.nodes)for(const e of this._gltf.nodes)e.name&&(t[e.name]=e.index);i=(e instanceof Array?e:[e]).map((e=>{const n=t[e];if(void 0===n)throw new Error(`Failed to find node '${e}'`);return n}))}return this._loadAsync(r,o,i,(()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries()})))}))}loadAsync(e,t,n,s,r=""){return Promise.resolve().then((()=>(this._babylonScene=e,this._loadData(t),this._loadAsync(n,r,null,(()=>{})))))}_loadAsync(e,t,n,s){return Promise.resolve().then((()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:`${e}${Date.now()}/`,this._fileName=t,this._loadExtensions(),this._checkExtensions();const r=`${E.zA[E.zA.LOADING]} => ${E.zA[E.zA.READY]}`,i=`${E.zA[E.zA.LOADING]} => ${E.zA[E.zA.COMPLETE]}`;this._parent._startPerformanceCounter(r),this._parent._startPerformanceCounter(i),this._parent._setState(E.zA.LOADING),this._extensionsOnLoading();const a=new Array,l=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials)if(n)a.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(null!=this._gltf.scene||this._gltf.scenes&&this._gltf.scenes[0]){const e=L.Get("/scene",this._gltf.scenes,this._gltf.scene||0);a.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){const t=this._gltf.materials[e],n="/materials/"+e,s=f.F.TriangleFillMode;a.push(this._loadMaterialAsync(n,t,null,s,(()=>{})))}this._babylonScene.blockMaterialDirtyMechanism=l,this._parent.compileMaterials&&a.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&a.push(this._compileShadowGeneratorsAsync());return Promise.all(a).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh.setEnabled(!0),this._extensionsOnReady(),this._parent._setState(E.zA.READY),this._startAnimations(),s()))).then((e=>(this._parent._endPerformanceCounter(r),o.w1.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(i),this._parent._setState(E.zA.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()}))})),e)))})).catch((e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e}))}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){const t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){const n=t[0];(n.byteLength<e.bin.byteLength-3||n.byteLength>e.bin.byteLength)&&x.Y.Warn(`Binary buffer length (${n.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else x.Y.Warn("Unexpected BIN chunk")}}_setupData(){if(L.Assign(this._gltf.accessors),L.Assign(this._gltf.animations),L.Assign(this._gltf.buffers),L.Assign(this._gltf.bufferViews),L.Assign(this._gltf.cameras),L.Assign(this._gltf.images),L.Assign(this._gltf.materials),L.Assign(this._gltf.meshes),L.Assign(this._gltf.nodes),L.Assign(this._gltf.samplers),L.Assign(this._gltf.scenes),L.Assign(this._gltf.skins),L.Assign(this._gltf.textures),this._gltf.nodes){const e={};for(const t of this._gltf.nodes)if(t.children)for(const n of t.children)e[n]=t.index;const t=this._createRootNode();for(const n of this._gltf.nodes){const s=e[n.index];n.parent=void 0===s?t:this._gltf.nodes[s]}}}_loadExtensions(){for(const e in I._RegisteredExtensions){const t=I._RegisteredExtensions[e].factory(this);t.name!==e&&x.Y.Warn(`The name of the glTF loader extension instance does not match the registered name: ${t.name} !== ${e}`),this._extensions.push(t),this._parent.onExtensionLoadedObservable.notifyObservers(t)}this._extensions.sort(((e,t)=>(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear()}_checkExtensions(){if(this._gltf.extensionsRequired)for(const e of this._gltf.extensionsRequired){if(!this._extensions.some((t=>t.name===e&&t.enabled)))throw new Error(`Require extension ${e} is not available`)}}_createRootNode(){this._babylonScene._blockEntityCollection=!!this._assetContainer,this._rootBabylonMesh=new b.Kj("__root__",this._babylonScene),this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);const e={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case E.em.AUTO:this._babylonScene.useRightHandedSystem||(e.rotation=[0,1,0,0],e.scale=[1,1,-1],I._LoadTransform(e,this._rootBabylonMesh));break;case E.em.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),e}loadSceneAsync(e,t){const n=this._extensionsLoadSceneAsync(e,t);if(n)return n;const s=new Array;if(this.logOpen(`${e} ${t.name||""}`),t.nodes)for(const n of t.nodes){const t=L.Get(`${e}/nodes/${n}`,this._gltf.nodes,n);s.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(e=>{e.parent=this._rootBabylonMesh})))}for(const e of this._postSceneLoadActions)e();return s.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(s).then((()=>{}))}_forEachPrimitive(e,t){if(e._primitiveBabylonMeshes)for(const n of e._primitiveBabylonMeshes)t(n)}_getGeometries(){const e=new Array,t=this._gltf.nodes;if(t)for(const n of t)this._forEachPrimitive(n,(t=>{const n=t.geometry;n&&-1===e.indexOf(n)&&e.push(n)}));return e}_getMeshes(){const e=new Array;this._rootBabylonMesh&&e.push(this._rootBabylonMesh);const t=this._gltf.nodes;if(t)for(const n of t)this._forEachPrimitive(n,(t=>{e.push(t)}));return e}_getTransformNodes(){const e=new Array,t=this._gltf.nodes;if(t)for(const n of t)n._babylonTransformNode&&"TransformNode"===n._babylonTransformNode.getClassName()&&e.push(n._babylonTransformNode),n._babylonTransformNodeForSkin&&e.push(n._babylonTransformNodeForSkin);return e}_getSkeletons(){const e=new Array,t=this._gltf.skins;if(t)for(const n of t)n._data&&e.push(n._data.babylonSkeleton);return e}_getAnimationGroups(){const e=new Array,t=this._gltf.animations;if(t)for(const n of t)n._babylonAnimationGroup&&e.push(n._babylonAnimationGroup);return e}_startAnimations(){switch(this._parent.animationStartMode){case E.B2.NONE:break;case E.B2.FIRST:{const e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case E.B2.ALL:{const e=this._getAnimationGroups();for(const t of e)t.start(!0);break}default:return void x.Y.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(e,t,n=(()=>{})){const s=this._extensionsLoadNodeAsync(e,t,n);if(s)return s;if(t._babylonTransformNode)throw new Error(`${e}: Invalid recursive node hierarchy`);const r=new Array;this.logOpen(`${e} ${t.name||""}`);const i=s=>{if(I.AddPointerMetadata(s,e),I._LoadTransform(t,s),null!=t.camera){const n=L.Get(`${e}/camera`,this._gltf.cameras,t.camera);r.push(this.loadCameraAsync(`/cameras/${n.index}`,n,(e=>{e.parent=s})))}if(t.children)for(const n of t.children){const t=L.Get(`${e}/children/${n}`,this._gltf.nodes,n);r.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(e=>{e.parent=s})))}n(s)};if(null==t.mesh||null!=t.skin){const e=t.name||`node${t.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new m.Y(e,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,null==t.mesh?t._babylonTransformNode=n:t._babylonTransformNodeForSkin=n,i(n)}if(null!=t.mesh)if(null==t.skin){const n=L.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);r.push(this._loadMeshAsync(`/meshes/${n.index}`,t,n,i))}else{const n=L.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);r.push(this._loadMeshAsync(`/meshes/${n.index}`,t,n,(n=>{const s=t._babylonTransformNodeForSkin;n.metadata=S(s.metadata,n.metadata||{});const i=L.Get(`${e}/skin`,this._gltf.skins,t.skin);r.push(this._loadSkinAsync(`/skins/${i.index}`,t,i,(e=>{this._forEachPrimitive(t,(t=>{t.skeleton=e})),this._postSceneLoadActions.push((()=>{if(null!=i.skeleton){const e=L.Get(`/skins/${i.index}/skeleton`,this._gltf.nodes,i.skeleton).parent;t.index===e.index?n.parent=s.parent:n.parent=e._babylonTransformNode}else n.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:s,skinnedNode:n})}))})))})))}return this.logClose(),Promise.all(r).then((()=>(this._forEachPrimitive(t,(e=>{e.geometry&&e.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0)})),t._babylonTransformNode)))}_loadMeshAsync(e,t,n,s){const r=n.primitives;if(!r||!r.length)throw new Error(`${e}: Primitives are missing`);null==r[0].index&&L.Assign(r);const i=new Array;this.logOpen(`${e} ${n.name||""}`);const o=t.name||`node${t.index}`;if(1===r.length){const s=n.primitives[0];i.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${s.index}`,o,t,n,s,(e=>{t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new m.Y(o,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(const s of r)i.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${s.index}`,`${o}_primitive${s.index}`,t,n,s,(e=>{e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)})))}return s(t._babylonTransformNode),this.logClose(),Promise.all(i).then((()=>t._babylonTransformNode))}_loadMeshPrimitiveAsync(e,t,n,s,r,i){const o=this._extensionsLoadMeshPrimitiveAsync(e,t,n,s,r,i);if(o)return o;this.logOpen(`${e}`);const a=0===this._disableInstancedMesh&&this._parent.createInstances&&null==n.skin&&!s.primitives[0].targets;let l,c;if(a&&r._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=r._instanceData.babylonSourceMesh.createInstance(t),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c=r._instanceData.promise;else{const i=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new b.Kj(t,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?f.F.CounterClockWiseSideOrientation:f.F.ClockWiseSideOrientation,this._createMorphTargets(e,n,s,r,o),i.push(this._loadVertexDataAsync(e,r,o).then((t=>this._loadMorphTargetsAsync(e,r,o,t).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,t.applyToMesh(o),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=I._GetDrawMode(e,r.mode);if(null==r.material){let e=this._defaultBabylonMaterialData[h];e||(e=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[h]=e),o.material=e}else if(!this.parent.skipMaterials){const t=L.Get(`${e}/material`,this._gltf.materials,r.material);i.push(this._loadMaterialAsync(`/materials/${t.index}`,t,o,h,(e=>{o.material=e})))}c=Promise.all(i),a&&(r._instanceData={babylonSourceMesh:o,promise:c}),l=o}return I.AddPointerMetadata(l,e),this._parent.onMeshLoadedObservable.notifyObservers(l),i(l),this.logClose(),c.then((()=>l))}_loadVertexDataAsync(e,t,n){const s=this._extensionsLoadVertexDataAsync(e,t,n);if(s)return s;const i=t.attributes;if(!i)throw new Error(`${e}: Attributes are missing`);const o=new Array,a=new y.Z(n.name,this._babylonScene);if(null==t.indices)n.isUnIndexed=!0;else{const n=L.Get(`${e}/indices`,this._gltf.accessors,t.indices);o.push(this._loadIndicesAccessorAsync(`/accessors/${n.index}`,n).then((e=>{a.setIndices(e)})))}const l=(t,s,l)=>{if(null==i[t])return;n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(s)&&n._delayInfo.push(s);const c=L.Get(`${e}/attributes/${t}`,this._gltf.accessors,i[t]);o.push(this._loadVertexAccessorAsync(`/accessors/${c.index}`,c,s).then((e=>{if(e.getKind()===g.o.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!n.skeleton){const e=c.min,t=c.max;if(void 0!==e&&void 0!==t){if(c.normalized&&5126!==c.componentType){let n=1;switch(c.componentType){case 5120:n=127;break;case 5121:n=255;break;case 5122:n=32767;break;case 5123:n=65535}for(let s=0;s<3;++s)e[s]=Math.max(e[s]/n,-1),t[s]=Math.max(t[s]/n,-1)}const n=r.jp.Vector3[0],s=r.jp.Vector3[1];n.copyFromFloats(...e),s.copyFromFloats(...t),a._boundingInfo=new O.j(n,s),a.useBoundingInfoFromGeometry=!0}}a.setVerticesBuffer(e,c.count)}))),s==g.o.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),l&&l(c)};return l("POSITION",g.o.PositionKind),l("NORMAL",g.o.NormalKind),l("TANGENT",g.o.TangentKind),l("TEXCOORD_0",g.o.UVKind),l("TEXCOORD_1",g.o.UV2Kind),l("TEXCOORD_2",g.o.UV3Kind),l("TEXCOORD_3",g.o.UV4Kind),l("TEXCOORD_4",g.o.UV5Kind),l("TEXCOORD_5",g.o.UV6Kind),l("JOINTS_0",g.o.MatricesIndicesKind),l("WEIGHTS_0",g.o.MatricesWeightsKind),l("JOINTS_1",g.o.MatricesIndicesExtraKind),l("WEIGHTS_1",g.o.MatricesWeightsExtraKind),l("COLOR_0",g.o.ColorKind,(e=>{"VEC4"===e.type&&(n.hasVertexAlpha=!0)})),Promise.all(o).then((()=>a))}_createMorphTargets(e,t,n,s,r){if(!s.targets)return;if(null==t._numMorphTargets)t._numMorphTargets=s.targets.length;else if(s.targets.length!==t._numMorphTargets)throw new Error(`${e}: Primitives do not have the same number of targets`);const i=n.extras?n.extras.targetNames:null;r.morphTargetManager=new T.O(r.getScene()),r.morphTargetManager.areUpdatesFrozen=!0;for(let e=0;e<s.targets.length;e++){const s=t.weights?t.weights[e]:n.weights?n.weights[e]:0,o=i?i[e]:`morphTarget${e}`;r.morphTargetManager.addTarget(new A.Y(o,s,r.getScene()))}}_loadMorphTargetsAsync(e,t,n,s){if(!t.targets)return Promise.resolve();const r=new Array,i=n.morphTargetManager;for(let n=0;n<i.numTargets;n++){const o=i.getTarget(n);r.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${n}`,s,t.targets[n],o))}return Promise.all(r).then((()=>{i.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(e,t,n,s){const r=new Array,i=(s,i,o)=>{if(null==n[s])return;const a=t.getVertexBuffer(i);if(!a)return;const l=L.Get(`${e}/${s}`,this._gltf.accessors,n[s]);r.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then((e=>{o(a,e)})))};return i("POSITION",g.o.PositionKind,((e,t)=>{const n=new Float32Array(t.length);e.forEach(t.length,((e,s)=>{n[s]=t[s]+e})),s.setPositions(n)})),i("NORMAL",g.o.NormalKind,((e,t)=>{const n=new Float32Array(t.length);e.forEach(n.length,((e,s)=>{n[s]=t[s]+e})),s.setNormals(n)})),i("TANGENT",g.o.TangentKind,((e,t)=>{const n=new Float32Array(t.length/3*4);let r=0;e.forEach(t.length/3*4,((e,s)=>{(s+1)%4!=0&&(n[r]=t[r]+e,r++)})),s.setTangents(n)})),Promise.all(r).then((()=>{}))}static _LoadTransform(e,t){if(null!=e.skin)return;let n=r.P.Zero(),s=r._f.Identity(),i=r.P.One();if(e.matrix){r.y3.FromArray(e.matrix).decompose(i,s,n)}else e.translation&&(n=r.P.FromArray(e.translation)),e.rotation&&(s=r._f.FromArray(e.rotation)),e.scale&&(i=r.P.FromArray(e.scale));t.position=n,t.rotationQuaternion=s,t.scaling=i}_loadSkinAsync(e,t,n,s){const r=this._extensionsLoadSkinAsync(e,t,n);if(r)return r;if(n._data)return s(n._data.babylonSkeleton),n._data.promise;const i=`skeleton${n.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new u.O(n.name||i,i,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,n,o);const a=this._loadSkinInverseBindMatricesDataAsync(e,n).then((e=>{this._updateBoneMatrices(o,e)}));return n._data={babylonSkeleton:o,promise:a},s(o),a}_loadBones(e,t,n){if(null==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){const n=this._findSkeletonRootNode(`${e}/joints`,t.joints);if(n)if(void 0===t.skeleton)t.skeleton=n.index;else{const s=(e,t)=>{for(;t.parent;t=t.parent)if(t.parent===e)return!0;return!1},r=L.Get(`${e}/skeleton`,this._gltf.nodes,t.skeleton);r===n||s(r,n)||(x.Y.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=n.index)}else x.Y.Warn(`${e}: Failed to find common root`)}const s={};for(const r of t.joints){const i=L.Get(`${e}/joints/${r}`,this._gltf.nodes,r);this._loadBone(i,t,n,s)}}_findSkeletonRootNode(e,t){if(0===t.length)return null;const n={};for(const s of t){const t=new Array;let r=L.Get(`${e}/${s}`,this._gltf.nodes,s);for(;-1!==r.index;)t.unshift(r),r=r.parent;n[s]=t}let s=null;for(let e=0;;++e){let r=n[t[0]];if(e>=r.length)return s;const i=r[e];for(let o=1;o<t.length;++o)if(r=n[t[o]],e>=r.length||i!==r[e])return s;s=i}}_loadBone(e,t,n,s){let r=s[e.index];if(r)return r;let i=null;e.index!==t.skeleton&&(e.parent&&-1!==e.parent.index?i=this._loadBone(e.parent,t,n,s):void 0!==t.skeleton&&x.Y.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));const o=t.joints.indexOf(e.index);return r=new d.N(e.name||`joint${e.index}`,n,i,this._getNodeMatrix(e),null,null,o),s[e.index]=r,this._postSceneLoadActions.push((()=>{r.linkTransformNode(e._babylonTransformNode)})),r}_loadSkinInverseBindMatricesDataAsync(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);const n=L.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)}_updateBoneMatrices(e,t){for(const n of e.bones){const e=r.y3.Identity(),s=n._index;t&&-1!==s&&(r.y3.FromArrayToRef(t,16*s,e),e.invertToRef(e));const i=n.getParent();i&&e.multiplyToRef(i.getInvertedAbsoluteTransform(),e),n.updateMatrix(e,!1,!1),n._updateDifferenceMatrix(void 0,!1)}}_getNodeMatrix(e){return e.matrix?r.y3.FromArray(e.matrix):r.y3.Compose(e.scale?r.P.FromArray(e.scale):r.P.One(),e.rotation?r._f.FromArray(e.rotation):r._f.Identity(),e.translation?r.P.FromArray(e.translation):r.P.Zero())}loadCameraAsync(e,t,n=(()=>{})){const s=this._extensionsLoadCameraAsync(e,t,n);if(s)return s;const i=new Array;this.logOpen(`${e} ${t.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new l.c(t.name||`camera${t.index}`,r.P.Zero(),this._babylonScene,!1);switch(o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.ignoreParentScaling=!0,t._babylonCamera=o,o.rotation=new r.P(0,Math.PI,0),t.type){case"perspective":{const n=t.perspective;if(!n)throw new Error(`${e}: Camera perspective properties are missing`);o.fov=n.yfov,o.minZ=n.znear,o.maxZ=n.zfar||0;break}case"orthographic":if(!t.orthographic)throw new Error(`${e}: Camera orthographic properties are missing`);o.mode=a.V.ORTHOGRAPHIC_CAMERA,o.orthoLeft=-t.orthographic.xmag,o.orthoRight=t.orthographic.xmag,o.orthoBottom=-t.orthographic.ymag,o.orthoTop=t.orthographic.ymag,o.minZ=t.orthographic.znear,o.maxZ=t.orthographic.zfar;break;default:throw new Error(`${e}: Invalid camera type (${t.type})`)}return I.AddPointerMetadata(o,e),this._parent.onCameraLoadedObservable.notifyObservers(o),n(o),this.logClose(),Promise.all(i).then((()=>o))}_loadAnimationsAsync(){const e=this._gltf.animations;if(!e)return Promise.resolve();const t=new Array;for(let n=0;n<e.length;n++){const s=e[n];t.push(this.loadAnimationAsync(`/animations/${s.index}`,s).then((e=>{0===e.targetedAnimations.length&&e.dispose()})))}return Promise.all(t).then((()=>{}))}loadAnimationAsync(e,t){const n=this._extensionsLoadAnimationAsync(e,t);if(n)return n;this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new h.O(t.name||`animation${t.index}`,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=s;const r=new Array;L.Assign(t.channels),L.Assign(t.samplers);for(const n of t.channels)r.push(this._loadAnimationChannelAsync(`${e}/channels/${n.index}`,e,t,n,((e,t)=>{e.animations=e.animations||[],e.animations.push(t),s.addTargetedAnimation(t,e)})));return Promise.all(r).then((()=>(s.normalize(0),s)))}_loadAnimationChannelAsync(e,t,n,s,r){const i=this._extensionsLoadAnimationChannelAsync(e,t,n,s,r);if(i)return i;if(null==s.target.node)return Promise.resolve();const o=L.Get(`${e}/target/node`,this._gltf.nodes,s.target.node);if("weights"===s.target.path&&!o._numMorphTargets||"weights"!==s.target.path&&!o._babylonTransformNode)return Promise.resolve();let a;switch(s.target.path){case"translation":a=R.translation;break;case"rotation":a=R.rotation;break;case"scale":a=R.scale;break;case"weights":a=R.weights;break;default:throw new Error(`${e}/target/path: Invalid value (${s.target.path})`)}const l={target:o,properties:a};return this._loadAnimationChannelFromTargetInfoAsync(e,t,n,s,l,r)}_loadAnimationChannelFromTargetInfoAsync(e,t,n,s,r,i){const o=this.parent.targetFps,a=1/o,l=L.Get(`${e}/sampler`,n.samplers,s.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${s.sampler}`,l).then((e=>{let t=0;for(const l of r.properties){const h=l.getStride(r.target),d=e.input,u=e.output,f=new Array(d.length);let p=0;switch(e.interpolation){case"STEP":for(let e=0;e<d.length;e++){const t=l.getValue(r.target,u,p,1);p+=h,f[e]={frame:d[e]*o,value:t,interpolation:c.N.STEP}}break;case"CUBICSPLINE":for(let e=0;e<d.length;e++){const t=l.getValue(r.target,u,p,a);p+=h;const n=l.getValue(r.target,u,p,1);p+=h;const s=l.getValue(r.target,u,p,a);p+=h,f[e]={frame:d[e]*o,inTangent:t,value:n,outTangent:s}}break;case"LINEAR":for(let e=0;e<d.length;e++){const t=l.getValue(r.target,u,p,1);p+=h,f[e]={frame:d[e]*o,value:t}}}if(p>0){const e=`${n.name||`animation${n.index}`}_channel${s.index}_${t}`;l.buildAnimations(r.target,e,o,f,((e,n)=>{++t,i(e,n)}))}}}))}_loadAnimationSamplerAsync(e,t){if(t._data)return t._data;const n=t.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${e}/interpolation: Invalid value (${t.interpolation})`)}const s=L.Get(`${e}/input`,this._gltf.accessors,t.input),r=L.Get(`${e}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${s.index}`,s),this._loadFloatAccessorAsync(`/accessors/${r.index}`,r)]).then((([e,t])=>({input:e,interpolation:n,output:t}))),t._data}loadBufferAsync(e,t,n,s){const r=this._extensionsLoadBufferAsync(e,t,n,s);if(r)return r;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{if(!this._bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((t=>{try{return new Uint8Array(t.buffer,t.byteOffset+n,s)}catch(t){throw new Error(`${e}: ${t.message}`)}}))}loadBufferViewAsync(e,t){const n=this._extensionsLoadBufferViewAsync(e,t);if(n)return n;if(t._data)return t._data;const s=L.Get(`${e}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${s.index}`,s,t.byteOffset||0,t.byteLength),t._data}_loadAccessorAsync(e,t,n){if(t._data)return t._data;const s=I._GetNumComponents(e,t.type),r=s*g.o.GetTypeByteLength(t.componentType),i=s*t.count;if(null==t.bufferView)t._data=Promise.resolve(new n(i));else{const o=L.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((a=>{if(5126!==t.componentType||t.normalized||o.byteStride&&o.byteStride!==r){const e=new n(i);return g.o.ForEach(a,t.byteOffset||0,o.byteStride||r,s,t.componentType,e.length,t.normalized||!1,((t,n)=>{e[n]=t})),e}return I._GetTypedArray(e,t.componentType,a,t.byteOffset,i)}))}if(t.sparse){const i=t.sparse;t._data=t._data.then((o=>{const a=o,l=L.Get(`${e}/sparse/indices/bufferView`,this._gltf.bufferViews,i.indices.bufferView),c=L.Get(`${e}/sparse/values/bufferView`,this._gltf.bufferViews,i.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${l.index}`,l),this.loadBufferViewAsync(`/bufferViews/${c.index}`,c)]).then((([o,l])=>{const c=I._GetTypedArray(`${e}/sparse/indices`,i.indices.componentType,o,i.indices.byteOffset,i.count),h=s*i.count;let d;if(5126!==t.componentType||t.normalized){const o=I._GetTypedArray(`${e}/sparse/values`,t.componentType,l,i.values.byteOffset,h);d=new n(h),g.o.ForEach(o,0,r,s,t.componentType,d.length,t.normalized||!1,((e,t)=>{d[t]=e}))}else d=I._GetTypedArray(`${e}/sparse/values`,t.componentType,l,i.values.byteOffset,h);let u=0;for(let e=0;e<c.length;e++){let t=c[e]*s;for(let e=0;e<s;e++)a[t++]=d[u++]}return a}))}))}return t._data}_loadFloatAccessorAsync(e,t){return this._loadAccessorAsync(e,t,Float32Array)}_loadIndicesAccessorAsync(e,t){if("SCALAR"!==t.type)throw new Error(`${e}/type: Invalid value ${t.type}`);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw new Error(`${e}/componentType: Invalid value ${t.componentType}`);if(t._data)return t._data;if(t.sparse){const n=I._GetTypedArrayConstructor(`${e}/componentType`,t.componentType);t._data=this._loadAccessorAsync(e,t,n)}else{const n=L.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>I._GetTypedArray(e,t.componentType,n,t.byteOffset,t.count)))}return t._data}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;const t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>new g.l(t,e,!1))),e._babylonBuffer}_loadVertexAccessorAsync(e,t,n){var s;if(null===(s=t._babylonVertexBuffer)||void 0===s?void 0:s[n])return t._babylonVertexBuffer[n];t._babylonVertexBuffer||(t._babylonVertexBuffer={});const r=this._babylonScene.getEngine();if(t.sparse)t._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(e,t).then((e=>new g.o(r,e,n,!1)));else if(n===g.o.MatricesIndicesKind||n===g.o.MatricesIndicesExtraKind)t._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(e,t).then((e=>new g.o(r,e,n,!1)));else{const s=L.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(s).then((i=>{const o=I._GetNumComponents(e,t.type);return new g.o(r,i,n,!1,!1,s.byteStride,!1,t.byteOffset,o,t.componentType,t.normalized,!0,1,!0)}))}return t._babylonVertexBuffer[n]}_loadMaterialMetallicRoughnessPropertiesAsync(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;return t&&(t.baseColorFactor?(n.albedoColor=i.Wo.FromArray(t.baseColorFactor),n.alpha=t.baseColorFactor[3]):n.albedoColor=i.Wo.White(),n.metallic=null==t.metallicFactor?1:t.metallicFactor,n.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&s.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,t.baseColorTexture,(e=>{e.name=`${n.name} (Base Color)`,n.albedoTexture=e}))),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,t.metallicRoughnessTexture,(e=>{e.name=`${n.name} (Metallic Roughness)`,n.metallicTexture=e}))),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(s).then((()=>{}))}_loadMaterialAsync(e,t,n,s,r=(()=>{})){const i=this._extensionsLoadMaterialAsync(e,t,n,s,r);if(i)return i;t._data=t._data||{};let o=t._data[s];if(!o){this.logOpen(`${e} ${t.name||""}`);const n=this.createMaterial(e,t,s);o={babylonMaterial:n,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,t,n)},t._data[s]=o,I.AddPointerMetadata(n,e),this._parent.onMaterialLoadedObservable.notifyObservers(n),this.logClose()}return n&&(o.babylonMeshes.push(n),n.onDisposeObservable.addOnce((()=>{const e=o.babylonMeshes.indexOf(n);-1!==e&&o.babylonMeshes.splice(e,1)}))),r(o.babylonMaterial),o.promise.then((()=>o.babylonMaterial))}_createDefaultMaterial(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new p.Y(e,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=t,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=p.Y.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n}createMaterial(e,t,n){const s=this._extensionsCreateMaterial(e,t,n);if(s)return s;const r=t.name||`material${t.index}`;return this._createDefaultMaterial(r,n)}loadMaterialPropertiesAsync(e,t,n){const s=this._extensionsLoadMaterialPropertiesAsync(e,t,n);if(s)return s;const r=new Array;return r.push(this.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,t.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(e,t,n),Promise.all(r).then((()=>{}))}loadMaterialBasePropertiesAsync(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;return n.emissiveColor=t.emissiveFactor?i.Wo.FromArray(t.emissiveFactor):new i.Wo(0,0,0),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/normalTexture`,t.normalTexture,(e=>{e.name=`${n.name} (Normal)`,n.bumpTexture=e}))),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&n.bumpTexture&&(n.bumpTexture.level=t.normalTexture.scale),n.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,t.occlusionTexture,(e=>{e.name=`${n.name} (Occlusion)`,n.ambientTexture=e}))),n.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(n.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&s.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,t.emissiveTexture,(e=>{e.name=`${n.name} (Emissive)`,n.emissiveTexture=e}))),Promise.all(s).then((()=>{}))}loadMaterialAlphaProperties(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=p.Y.PBRMATERIAL_OPAQUE;break;case"MASK":n.transparencyMode=p.Y.PBRMATERIAL_ALPHATEST,n.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break;case"BLEND":n.transparencyMode=p.Y.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${e}/alphaMode: Invalid value (${t.alphaMode})`)}}loadTextureInfoAsync(e,t,n=(()=>{})){const s=this._extensionsLoadTextureInfoAsync(e,t,n);if(s)return s;if(this.logOpen(`${e}`),t.texCoord>=6)throw new Error(`${e}/texCoord: Invalid value (${t.texCoord})`);const r=L.Get(`${e}/index`,this._gltf.textures,t.index);r._textureInfo=t;const i=this._loadTextureAsync(`/textures/${t.index}`,r,(s=>{s.coordinatesIndex=t.texCoord||0,I.AddPointerMetadata(s,e),this._parent.onTextureLoadedObservable.notifyObservers(s),n(s)}));return this.logClose(),i}_loadTextureAsync(e,t,n=(()=>{})){const s=this._extensionsLoadTextureAsync(e,t,n);if(s)return s;this.logOpen(`${e} ${t.name||""}`);const r=null==t.sampler?I.DefaultSampler:L.Get(`${e}/sampler`,this._gltf.samplers,t.sampler),i=L.Get(`${e}/source`,this._gltf.images,t.source),o=this._createTextureAsync(e,r,i,n,void 0,!t._textureInfo.nonColorData);return this.logClose(),o}_createTextureAsync(e,t,n,r=(()=>{}),i,o){const a=this._loadSampler(`/samplers/${t.index}`,t),l=new Array,c=new s.B;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:a.noMipMaps,invertY:!1,samplingMode:a.samplingMode,onLoad:()=>{this._disposed||c.resolve()},onError:(t,n)=>{this._disposed||c.reject(new Error(`${e}: ${n&&n.message?n.message:t||"Failed to load texture"}`))},mimeType:n.mimeType,loaderOptions:i,useSRGBBuffer:!!o&&this._parent.useSRGBBuffers},d=new _.x(null,this._babylonScene,h);return d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.push(c.promise),l.push(this.loadImageAsync(`/images/${n.index}`,n).then((e=>{const t=n.uri||`${this._fileName}#image${n.index}`,s=`data:${this._uniqueRootUrl}${t}`;d.updateURL(s,e)}))),d.wrapU=a.wrapU,d.wrapV=a.wrapV,r(d),Promise.all(l).then((()=>d))}_loadSampler(e,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:I._GetTextureSamplingMode(e,t),wrapU:I._GetTextureWrapMode(`${e}/wrapS`,t.wrapS),wrapV:I._GetTextureWrapMode(`${e}/wrapT`,t.wrapT)}),t._data}loadImageAsync(e,t){if(!t._data){if(this.logOpen(`${e} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{const n=L.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}this.logClose()}return t._data}loadUriAsync(e,t,n){const s=this._extensionsLoadUriAsync(e,t,n);if(s)return s;if(!I._ValidateUri(n))throw new Error(`${e}: '${n}' is invalid`);if((0,v.VL)(n)){const t=new Uint8Array((0,v.$K)(n));return this.log(`${e}: Decoded ${n.substr(0,64)}... (${t.length} bytes)`),Promise.resolve(t)}return this.log(`${e}: Loading ${n}`),this._parent.preprocessUrlAsync(this._rootUrl+n).then((t=>new Promise(((s,r)=>{this._parent._loadFile(this._babylonScene,t,(t=>{this._disposed||(this.log(`${e}: Loaded ${n} (${t.byteLength} bytes)`),s(new Uint8Array(t)))}),!0,(t=>{r(new v.eh(`${e}: Failed to load '${n}'${t?": "+t.status+" "+t.statusText:""}`,t))}))}))))}static AddPointerMetadata(e,t){e.metadata=e.metadata||{};const n=e._internalMetadata=e._internalMetadata||{},s=n.gltf=n.gltf||{};(s.pointers=s.pointers||[]).push(t)}static _GetTextureWrapMode(e,t){switch(t=null==t?10497:t){case 33071:return _.x.CLAMP_ADDRESSMODE;case 33648:return _.x.MIRROR_ADDRESSMODE;case 10497:return _.x.WRAP_ADDRESSMODE;default:return x.Y.Warn(`${e}: Invalid value (${t})`),_.x.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(e,t){const n=null==t.magFilter?9729:t.magFilter,s=null==t.minFilter?9987:t.minFilter;if(9729===n)switch(s){case 9728:return _.x.LINEAR_NEAREST;case 9729:return _.x.LINEAR_LINEAR;case 9984:return _.x.LINEAR_NEAREST_MIPNEAREST;case 9985:return _.x.LINEAR_LINEAR_MIPNEAREST;case 9986:return _.x.LINEAR_NEAREST_MIPLINEAR;case 9987:return _.x.LINEAR_LINEAR_MIPLINEAR;default:return x.Y.Warn(`${e}/minFilter: Invalid value (${s})`),_.x.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&x.Y.Warn(`${e}/magFilter: Invalid value (${n})`),s){case 9728:return _.x.NEAREST_NEAREST;case 9729:return _.x.NEAREST_LINEAR;case 9984:return _.x.NEAREST_NEAREST_MIPNEAREST;case 9985:return _.x.NEAREST_LINEAR_MIPNEAREST;case 9986:return _.x.NEAREST_NEAREST_MIPLINEAR;case 9987:return _.x.NEAREST_LINEAR_MIPLINEAR;default:return x.Y.Warn(`${e}/minFilter: Invalid value (${s})`),_.x.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(e,t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${e}: Invalid component type ${t}`)}}static _GetTypedArray(e,t,n,s,r){const i=n.buffer;s=n.byteOffset+(s||0);const o=I._GetTypedArrayConstructor(`${e}/componentType`,t),a=g.o.GetTypeByteLength(t);return s%a!=0?(x.Y.Warn(`${e}: Copying buffer as byte offset (${s}) is not a multiple of component type byte length (${a})`),new o(i.slice(s,s+r*a),0)):new o(i,s,r)}static _GetNumComponents(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${e}: Invalid type (${t})`)}static _ValidateUri(e){return o.w1.IsBase64(e)||-1===e.indexOf("..")}static _GetDrawMode(e,t){switch(null==t&&(t=4),t){case 0:return f.F.PointListDrawMode;case 1:return f.F.LineListDrawMode;case 2:return f.F.LineLoopDrawMode;case 3:return f.F.LineStripDrawMode;case 4:return f.F.TriangleFillMode;case 5:return f.F.TriangleStripDrawMode;case 6:return f.F.TriangleFanDrawMode}throw new Error(`${e}: Invalid mesh primitive mode (${t})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const e=new Array;if(this._gltf.materials)for(const t of this._gltf.materials)if(t._data)for(const n in t._data){const s=t._data[n];for(const t of s.babylonMeshes){t.computeWorldMatrix(!0);const n=s.babylonMaterial;e.push(n.forceCompilationAsync(t)),e.push(n.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(e.push(n.forceCompilationAsync(t,{clipPlane:!0})),e.push(n.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const e=new Array,t=this._babylonScene.lights;for(const n of t){const t=n.getShadowGenerator();t&&e.push(t.forceCompilationAsync())}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(e){for(const t of this._extensions)t.enabled&&e(t)}_applyExtensions(e,t,n){for(const s of this._extensions)if(s.enabled){const r=`${s.name}.${t}`,i=e;i._activeLoaderExtensionFunctions=i._activeLoaderExtensionFunctions||{};const o=i._activeLoaderExtensionFunctions;if(!o[r]){o[r]=!0;try{const e=n(s);if(e)return e}finally{delete o[r]}}}return null}_extensionsOnLoading(){this._forEachExtensions((e=>e.onLoading&&e.onLoading()))}_extensionsOnReady(){this._forEachExtensions((e=>e.onReady&&e.onReady()))}_extensionsLoadSceneAsync(e,t){return this._applyExtensions(t,"loadScene",(n=>n.loadSceneAsync&&n.loadSceneAsync(e,t)))}_extensionsLoadNodeAsync(e,t,n){return this._applyExtensions(t,"loadNode",(s=>s.loadNodeAsync&&s.loadNodeAsync(e,t,n)))}_extensionsLoadCameraAsync(e,t,n){return this._applyExtensions(t,"loadCamera",(s=>s.loadCameraAsync&&s.loadCameraAsync(e,t,n)))}_extensionsLoadVertexDataAsync(e,t,n){return this._applyExtensions(t,"loadVertexData",(s=>s._loadVertexDataAsync&&s._loadVertexDataAsync(e,t,n)))}_extensionsLoadMeshPrimitiveAsync(e,t,n,s,r,i){return this._applyExtensions(r,"loadMeshPrimitive",(o=>o._loadMeshPrimitiveAsync&&o._loadMeshPrimitiveAsync(e,t,n,s,r,i)))}_extensionsLoadMaterialAsync(e,t,n,s,r){return this._applyExtensions(t,"loadMaterial",(i=>i._loadMaterialAsync&&i._loadMaterialAsync(e,t,n,s,r)))}_extensionsCreateMaterial(e,t,n){return this._applyExtensions(t,"createMaterial",(s=>s.createMaterial&&s.createMaterial(e,t,n)))}_extensionsLoadMaterialPropertiesAsync(e,t,n){return this._applyExtensions(t,"loadMaterialProperties",(s=>s.loadMaterialPropertiesAsync&&s.loadMaterialPropertiesAsync(e,t,n)))}_extensionsLoadTextureInfoAsync(e,t,n){return this._applyExtensions(t,"loadTextureInfo",(s=>s.loadTextureInfoAsync&&s.loadTextureInfoAsync(e,t,n)))}_extensionsLoadTextureAsync(e,t,n){return this._applyExtensions(t,"loadTexture",(s=>s._loadTextureAsync&&s._loadTextureAsync(e,t,n)))}_extensionsLoadAnimationAsync(e,t){return this._applyExtensions(t,"loadAnimation",(n=>n.loadAnimationAsync&&n.loadAnimationAsync(e,t)))}_extensionsLoadAnimationChannelAsync(e,t,n,s,r){return this._applyExtensions(n,"loadAnimationChannel",(i=>i._loadAnimationChannelAsync&&i._loadAnimationChannelAsync(e,t,n,s,r)))}_extensionsLoadSkinAsync(e,t,n){return this._applyExtensions(n,"loadSkin",(s=>s._loadSkinAsync&&s._loadSkinAsync(e,t,n)))}_extensionsLoadUriAsync(e,t,n){return this._applyExtensions(t,"loadUri",(s=>s._loadUriAsync&&s._loadUriAsync(e,t,n)))}_extensionsLoadBufferViewAsync(e,t){return this._applyExtensions(t,"loadBufferView",(n=>n.loadBufferViewAsync&&n.loadBufferViewAsync(e,t)))}_extensionsLoadBufferAsync(e,t,n,s){return this._applyExtensions(t,"loadBuffer",(r=>r.loadBufferAsync&&r.loadBufferAsync(e,t,n,s)))}static LoadExtensionAsync(e,t,n,s){if(!t.extensions)return null;const r=t.extensions[n];return r?s(`${e}/extensions/${n}`,r):null}static LoadExtraAsync(e,t,n,s){if(!t.extras)return null;const r=t.extras[n];return r?s(`${e}/extras/${n}`,r):null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}logOpen(e){this._parent._logOpen(e)}logClose(){this._parent._logClose()}log(e){this._parent._log(e)}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}}I._RegisteredExtensions={},I.DefaultSampler={index:-1},E.ey._CreateGLTF2Loader=e=>new I(e);var N=n(72739),F=n(69314),B=n(68254);const D="EXT_lights_image_based";class U{constructor(e){this.name=D,this._loader=e,this.enabled=this._loader.isExtensionUsed(D)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return I.LoadExtensionAsync(e,t,this.name,((n,s)=>{const r=new Array;r.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${n}`);const i=L.Get(`${n}/light`,this._lights,s.light);return r.push(this._loadLightAsync(`/extensions/${this.name}/lights/${s.light}`,i).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),Promise.all(r).then((()=>{}))}))}_loadLightAsync(e,t){if(!t._loaded){const n=new Array;this._loader.logOpen(`${e}`);const s=new Array(t.specularImages.length);for(let r=0;r<t.specularImages.length;r++){const i=t.specularImages[r];s[r]=new Array(i.length);for(let t=0;t<i.length;t++){const o=`${e}/specularImages/${r}/${t}`;this._loader.logOpen(`${o}`);const a=i[t],l=L.Get(o,this._loader.gltf.images,a);n.push(this._loader.loadImageAsync(`/images/${a}`,l).then((e=>{s[r][t]=e}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(n).then((()=>{const n=new B.N(this._loader.babylonScene,null,t.specularImageSize);if(n.name=t.name||"environment",t._babylonTexture=n,null!=t.intensity&&(n.level=t.intensity),t.rotation){let e=r._f.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=r._f.Inverse(e)),r.y3.FromQuaternionToRef(e,n.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const i=F._.FromArray(t.irradianceCoefficients);i.scaleInPlace(t.intensity),i.convertIrradianceToLambertianRadiance();const o=F.i.FromHarmonics(i),a=(s.length-1)/N.R.Log2(t.specularImageSize);return n.updateRGBDAsync(s,o,a)}))}return t._loaded.then((()=>t._babylonTexture))}}I.RegisterExtension(D,(e=>new U(e)));n(83236);const V="EXT_mesh_gpu_instancing";class ${constructor(e){this.name=V,this._loader=e,this.enabled=this._loader.isExtensionUsed(V)}dispose(){this._loader=null}loadNodeAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((e,s)=>{this._loader._disableInstancedMesh++;const i=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,n);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return i;const o=new Array;let a=0;const l=t=>{if(null==s.attributes[t])return void o.push(Promise.resolve(null));const n=L.Get(`${e}/attributes/${t}`,this._loader.gltf.accessors,s.attributes[t]);if(o.push(this._loader._loadFloatAccessorAsync(`/accessors/${n.bufferView}`,n)),0===a)a=n.count;else if(a!==n.count)throw new Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return l("TRANSLATION"),l("ROTATION"),l("SCALE"),i.then((e=>Promise.all(o).then((([n,s,i])=>{const o=new Float32Array(16*a);r.jp.Vector3[0].copyFromFloats(0,0,0),r.jp.Quaternion[0].copyFromFloats(0,0,0,1),r.jp.Vector3[1].copyFromFloats(1,1,1);for(let e=0;e<a;++e)n&&r.P.FromArrayToRef(n,3*e,r.jp.Vector3[0]),s&&r._f.FromArrayToRef(s,4*e,r.jp.Quaternion[0]),i&&r.P.FromArrayToRef(i,3*e,r.jp.Vector3[1]),r.y3.ComposeToRef(r.jp.Vector3[1],r.jp.Quaternion[0],r.jp.Vector3[0],r.jp.Matrix[0]),r.jp.Matrix[0].copyToArray(o,16*e);for(const e of t._primitiveBabylonMeshes)e.thinInstanceSetBuffer("matrix",o,16,!0);return e}))))}))}}I.RegisterExtension(V,(e=>new $(e)));var k=n(76304);const G="EXT_meshopt_compression";class W{constructor(e){this.name=G,this.enabled=e.isExtensionUsed(G),this._loader=e}dispose(){this._loader=null}loadBufferViewAsync(e,t){return I.LoadExtensionAsync(e,t,this.name,((n,s)=>{const r=t;if(r._meshOptData)return r._meshOptData;const i=L.Get(`${e}/buffer`,this._loader.gltf.buffers,s.buffer);return r._meshOptData=this._loader.loadBufferAsync(`/buffers/${i.index}`,i,s.byteOffset||0,s.byteLength).then((e=>k.K.Default.decodeGltfBufferAsync(e,s.count,s.byteStride,s.mode,s.filter))),r._meshOptData}))}}I.RegisterExtension(G,(e=>new W(e)));const j="EXT_texture_webp";class H{constructor(e){this.name=j,this._loader=e,this.enabled=e.isExtensionUsed(j)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=null==t.sampler?I.DefaultSampler:L.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),o=L.Get(`${s}/source`,this._loader.gltf.images,r.source);return this._loader._createTextureAsync(e,i,o,(e=>{n(e)}),void 0,!t._textureInfo.nonColorData)}))}}I.RegisterExtension(j,(e=>new H(e)));var Y=n(73848);const K="KHR_draco_mesh_compression";class z{constructor(e){this.name=K,this._loader=e,this.enabled=Y.J.DecoderAvailable&&this._loader.isExtensionUsed(K)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{if(null!=t.mode){if(5!==t.mode&&4!==t.mode)throw new Error(`${e}: Unsupported mode ${t.mode}`);if(5===t.mode)throw new Error(`${e}: Mode ${t.mode} is not currently supported`)}const i={},o={},a=(s,a)=>{const l=r.attributes[s];if(void 0===l||void 0===t.attributes[s])return;i[a]=l;const c=L.Get(`${e}/attributes/${s}`,this._loader.gltf.accessors,t.attributes[s]);if(c.normalized&&5126!==c.componentType){let e=1;switch(c.componentType){case 5120:e=127;break;case 5121:e=255;break;case 5122:e=32767;break;case 5123:e=65535}o[a]=e}n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(a)&&n._delayInfo.push(a)};a("POSITION",g.o.PositionKind),a("NORMAL",g.o.NormalKind),a("TANGENT",g.o.TangentKind),a("TEXCOORD_0",g.o.UVKind),a("TEXCOORD_1",g.o.UV2Kind),a("TEXCOORD_2",g.o.UV3Kind),a("TEXCOORD_3",g.o.UV4Kind),a("TEXCOORD_4",g.o.UV5Kind),a("TEXCOORD_5",g.o.UV6Kind),a("JOINTS_0",g.o.MatricesIndicesKind),a("WEIGHTS_0",g.o.MatricesWeightsKind),a("COLOR_0",g.o.ColorKind);const l=L.Get(s,this._loader.gltf.bufferViews,r.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((t=>(this.dracoCompression||Y.J.Default).decodeMeshAsync(t,i,o).then((e=>{const t=new y.Z(n.name,this._loader.babylonScene);return e.applyToGeometry(t),t})).catch((t=>{throw new Error(`${e}: ${t.message}`)}))))),l._dracoBabylonGeometry}))}}I.RegisterExtension(K,(e=>new z(e)));var q=n(258),X=n(65064),Z=n(96761),J=n(43812);const Q="KHR_lights_punctual";class ee{constructor(e){this.name=Q,this._loader=e,this.enabled=this._loader.isExtensionUsed(Q)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,L.Assign(this._lights)}}loadNodeAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,o)=>this._loader.loadNodeAsync(e,t,(e=>{let t;const a=L.Get(s,this._lights,o.light),l=a.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a.type){case"directional":t=new q.O(l,r.P.Backward(),this._loader.babylonScene);break;case"point":t=new X.c(l,r.P.Zero(),this._loader.babylonScene);break;case"spot":{const e=new Z.P(l,r.P.Zero(),r.P.Backward(),0,1,this._loader.babylonScene);e.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),t=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${s}: Invalid light type (${a.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=t,t.falloffType=J._.FALLOFF_GLTF,t.diffuse=a.color?i.Wo.FromArray(a.color):i.Wo.White(),t.intensity=null==a.intensity?1:a.intensity,t.range=null==a.range?Number.MAX_VALUE:a.range,t.parent=e,this._loader._babylonLights.push(t),I.AddPointerMetadata(t,s),n(e)}))))}}I.RegisterExtension(Q,(e=>new ee(e)));const te="KHR_materials_pbrSpecularGlossiness";class ne{constructor(e){this.name=te,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(te)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialBasePropertiesAsync(e,t,n)),i.push(this._loadSpecularGlossinessPropertiesAsync(s,t,r,n)),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(i).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(e,t,n,s){if(!(s instanceof p.Y))throw new Error(`${e}: Material type not supported`);const r=new Array;return s.metallic=null,s.roughness=null,n.diffuseFactor?(s.albedoColor=i.Wo.FromArray(n.diffuseFactor),s.alpha=n.diffuseFactor[3]):s.albedoColor=i.Wo.White(),s.reflectivityColor=n.specularFactor?i.Wo.FromArray(n.specularFactor):i.Wo.White(),s.microSurface=null==n.glossinessFactor?1:n.glossinessFactor,n.diffuseTexture&&r.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,n.diffuseTexture,(e=>{e.name=`${s.name} (Diffuse)`,s.albedoTexture=e}))),n.specularGlossinessTexture&&(r.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,n.specularGlossinessTexture,(e=>{e.name=`${s.name} (Specular Glossiness)`,s.reflectivityTexture=e,s.reflectivityTexture.hasAlpha=!0}))),s.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(r).then((()=>{}))}}I.RegisterExtension(te,(e=>new ne(e)));const se="KHR_materials_unlit";class re{constructor(e){this.name=se,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(se)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,(()=>this._loadUnlitPropertiesAsync(e,t,n)))}_loadUnlitPropertiesAsync(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;n.unlit=!0;const r=t.pbrMetallicRoughness;return r&&(r.baseColorFactor?(n.albedoColor=i.Wo.FromArray(r.baseColorFactor),n.alpha=r.baseColorFactor[3]):n.albedoColor=i.Wo.White(),r.baseColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,r.baseColorTexture,(e=>{e.name=`${n.name} (Base Color)`,n.albedoTexture=e})))),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(s).then((()=>{}))}}I.RegisterExtension(se,(e=>new re(e)));const ie="KHR_materials_clearcoat";class oe{constructor(e){this.name=ie,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(ie)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadClearCoatPropertiesAsync(s,r,n)),Promise.all(i).then((()=>{}))}))}_loadClearCoatPropertiesAsync(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,null!=t.clearcoatFactor?n.clearCoat.intensity=t.clearcoatFactor:n.clearCoat.intensity=0,t.clearcoatTexture&&s.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,t.clearcoatTexture,(e=>{e.name=`${n.name} (ClearCoat Intensity)`,n.clearCoat.texture=e}))),null!=t.clearcoatRoughnessFactor?n.clearCoat.roughness=t.clearcoatRoughnessFactor:n.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,(e=>{e.name=`${n.name} (ClearCoat Roughness)`,n.clearCoat.textureRoughness=e})))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,t.clearcoatNormalTexture,(e=>{e.name=`${n.name} (ClearCoat Normal)`,n.clearCoat.bumpTexture=e}))),n.invertNormalMapX=!n.getScene().useRightHandedSystem,n.invertNormalMapY=n.getScene().useRightHandedSystem,null!=t.clearcoatNormalTexture.scale&&(n.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(s).then((()=>{}))}}I.RegisterExtension(ie,(e=>new oe(e)));const ae="KHR_materials_iridescence";class le{constructor(e){this.name=ae,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(ae)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadIridescencePropertiesAsync(s,r,n)),Promise.all(i).then((()=>{}))}))}_loadIridescencePropertiesAsync(e,t,n){var s,r,i,o,a;if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const l=new Array;return n.iridescence.isEnabled=!0,n.iridescence.intensity=null!==(s=t.iridescenceFactor)&&void 0!==s?s:0,n.iridescence.indexOfRefraction=null!==(i=null!==(r=t.iridescenceIor)&&void 0!==r?r:t.iridescenceIOR)&&void 0!==i?i:1.3,n.iridescence.minimumThickness=null!==(o=t.iridescenceThicknessMinimum)&&void 0!==o?o:100,n.iridescence.maximumThickness=null!==(a=t.iridescenceThicknessMaximum)&&void 0!==a?a:400,t.iridescenceTexture&&l.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,t.iridescenceTexture,(e=>{e.name=`${n.name} (Iridescence Intensity)`,n.iridescence.texture=e}))),t.iridescenceThicknessTexture&&l.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,(e=>{e.name=`${n.name} (Iridescence Thickness)`,n.iridescence.thicknessTexture=e}))),Promise.all(l).then((()=>{}))}}I.RegisterExtension(ae,(e=>new le(e)));const ce="KHR_materials_emissive_strength";class he{constructor(e){this.name=ce,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(ce)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>this._loader.loadMaterialPropertiesAsync(e,t,n).then((()=>{this._loadEmissiveProperties(s,r,n)}))))}_loadEmissiveProperties(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);void 0!==t.emissiveStrength&&n.emissiveColor.scaleToRef(t.emissiveStrength,n.emissiveColor)}}I.RegisterExtension(ce,(e=>new he(e)));const de="KHR_materials_sheen";class ue{constructor(e){this.name=de,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(de)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadSheenPropertiesAsync(s,r,n)),Promise.all(i).then((()=>{}))}))}_loadSheenPropertiesAsync(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;return n.sheen.isEnabled=!0,n.sheen.intensity=1,null!=t.sheenColorFactor?n.sheen.color=i.Wo.FromArray(t.sheenColorFactor):n.sheen.color=i.Wo.Black(),t.sheenColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,t.sheenColorTexture,(e=>{e.name=`${n.name} (Sheen Color)`,n.sheen.texture=e}))),void 0!==t.sheenRoughnessFactor?n.sheen.roughness=t.sheenRoughnessFactor:n.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,t.sheenRoughnessTexture,(e=>{e.name=`${n.name} (Sheen Roughness)`,n.sheen.textureRoughness=e})))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(s).then((()=>{}))}}I.RegisterExtension(de,(e=>new ue(e)));const fe="KHR_materials_specular";class pe{constructor(e){this.name=fe,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(fe)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadSpecularPropertiesAsync(s,r,n)),Promise.all(i).then((()=>{}))}))}_loadSpecularPropertiesAsync(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;return void 0!==t.specularFactor&&(n.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(n.metallicReflectanceColor=i.Wo.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,t.specularTexture,(e=>{e.name=`${n.name} (Specular F0 Strength)`,n.metallicReflectanceTexture=e,n.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),t.specularColorTexture&&s.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,t.specularColorTexture,(e=>{e.name=`${n.name} (Specular F0 Color)`,n.reflectanceTexture=e}))),Promise.all(s).then((()=>{}))}}I.RegisterExtension(fe,(e=>new pe(e)));const _e="KHR_materials_ior";class me{constructor(e){this.name=_e,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(_e)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadIorPropertiesAsync(s,r,n)),Promise.all(i).then((()=>{}))}))}_loadIorPropertiesAsync(e,t,n){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);return void 0!==t.ior?n.indexOfRefraction=t.ior:n.indexOfRefraction=me._DEFAULT_IOR,Promise.resolve()}}me._DEFAULT_IOR=1.5,I.RegisterExtension(_e,(e=>new me(e)));const ge="KHR_materials_variants";class ye{constructor(e){this.name=ge,this._loader=e,this.enabled=this._loader.isExtensionUsed(ge)}dispose(){this._loader=null}static GetAvailableVariants(e){const t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]}getAvailableVariants(e){return ye.GetAvailableVariants(e)}static SelectVariant(e,t){const n=this._GetExtensionMetadata(e);if(!n)throw new Error("Cannot select variant on a glTF mesh that does not have the KHR_materials_variants extension");const s=e=>{const t=n.variants[e];if(t)for(const e of t)e.mesh.material=e.material};if(t instanceof Array)for(const e of t)s(e);else s(t);n.lastSelected=t}selectVariant(e,t){return ye.SelectVariant(e,t)}static Reset(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error("Cannot reset on a glTF mesh that does not have the KHR_materials_variants extension");for(const e of t.original)e.mesh.material=e.material;t.lastSelected=null}reset(e){return ye.Reset(e)}static GetLastSelectedVariant(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the KHR_materials_variants extension");return t.lastSelected}getLastSelectedVariant(e){return ye.GetLastSelectedVariant(e)}static _GetExtensionMetadata(e){var t,n;return(null===(n=null===(t=null==e?void 0:e._internalMetadata)||void 0===t?void 0:t.gltf)||void 0===n?void 0:n.KHR_materials_variants)||null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._variants=t.variants}}_loadMeshPrimitiveAsync(e,t,n,s,r,i){return I.LoadExtensionAsync(e,r,this.name,((o,a)=>{const l=new Array;return l.push(this._loader._loadMeshPrimitiveAsync(e,t,n,s,r,(t=>{if(i(t),t instanceof b.Kj){const n=I._GetDrawMode(e,r.mode),s=this._loader.rootBabylonMesh,i=s?s._internalMetadata=s._internalMetadata||{}:{},c=i.gltf=i.gltf||{},h=c.KHR_materials_variants=c.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:t,material:t.material});for(let e=0;e<a.mappings.length;++e){const r=a.mappings[e],i=L.Get(`${o}/mappings/${e}/material`,this._loader.gltf.materials,r.material);l.push(this._loader._loadMaterialAsync(`#/materials/${r.material}`,i,t,n,(e=>{for(let n=0;n<r.variants.length;++n){const i=r.variants[n],o=L.Get(`/extensions/KHR_materials_variants/variants/${i}`,this._variants,i);h.variants[o.name]=h.variants[o.name]||[],h.variants[o.name].push({mesh:t,material:e}),t.onClonedObservable.add((e=>{const n=e;let r=null,i=n;do{if(i=i.parent,!i)return;r=ye._GetExtensionMetadata(i)}while(null===r);if(s&&r===ye._GetExtensionMetadata(s)){i._internalMetadata={};for(const e in s._internalMetadata)i._internalMetadata[e]=s._internalMetadata[e];i._internalMetadata.gltf=[];for(const e in s._internalMetadata.gltf)i._internalMetadata.gltf[e]=s._internalMetadata.gltf[e];i._internalMetadata.gltf.KHR_materials_variants={lastSelected:null,original:[],variants:{}};for(const e of r.original)i._internalMetadata.gltf.KHR_materials_variants.original.push({mesh:e.mesh,material:e.material});for(const e in r.variants)if(Object.prototype.hasOwnProperty.call(r.variants,e)){i._internalMetadata.gltf.KHR_materials_variants.variants[e]=[];for(const t of r.variants[e])i._internalMetadata.gltf.KHR_materials_variants.variants[e].push({mesh:t.mesh,material:t.material})}r=i._internalMetadata.gltf.KHR_materials_variants}for(const e of r.original)e.mesh===t&&(e.mesh=n);for(const e of r.variants[o.name])e.mesh===t&&(e.mesh=n)}))}})))}}}))),Promise.all(l).then((([e])=>e))}))}}I.RegisterExtension(ge,(e=>new ye(e)));var be=n(63784),Ae=n(62897),Te=n(34941);class Ee{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Te.g.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(e,t){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ee._GetDefaultOptions(),...e},this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new Ae.y$,this._scene.onDisposeObservable.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter((t=>this._options[t]!==e[t])).length)return;const t={...this._options,...e},n=this._options;this._options=t,t.renderSize===n.renderSize&&t.renderTargetTextureType===n.renderTargetTextureType&&t.generateMipmaps===n.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(e){return!!e&&!!(e instanceof p.Y&&e.subSurface.isRefractionEnabled)}_addMesh(e){this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),o.w1.SetImmediate((()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,this._transparentMeshesCache.push(e)):this._opaqueMeshesCache.push(e)}))}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];let t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(e),-1!==t&&this._opaqueMeshesCache.splice(t,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(e){const t=this._transparentMeshesCache.indexOf(e),n=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof p.Y&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==n?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===n&&this._opaqueMeshesCache.push(e)}_setupRenderTargets(){var e,t;let n,s;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new be._("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(t=null===(e=this._options.clearColor)||void 0===e?void 0:e.clone())&&void 0!==t?t:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.onBeforeBindObservable.add((e=>{s=this._scene.environmentIntensity,this._scene.environmentIntensity=1,n=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?e.clearColor.copyFrom(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(e.clearColor),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=s,this._scene.imageProcessingConfiguration._applyByPostProcess=n})),this._transparentMeshesCache.forEach((e=>{this._shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ve="KHR_materials_transmission";class xe{constructor(e){this.name=ve,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(ve),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialBasePropertiesAsync(e,t,n)),i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadTransparentPropertiesAsync(s,t,n,r)),Promise.all(i).then((()=>{}))}))}_loadTransparentPropertiesAsync(e,t,n,s){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const r=n;if(r.subSurface.isRefractionEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.useAlbedoToTintRefraction=!0,void 0===s.transmissionFactor)return r.subSurface.refractionIntensity=0,r.subSurface.isRefractionEnabled=!1,Promise.resolve();{r.subSurface.refractionIntensity=s.transmissionFactor;const e=r.getScene();r.subSurface.refractionIntensity&&!e._transmissionHelper&&new Ee({},r.getScene())}return r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,s.transmissionTexture?(s.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,s.transmissionTexture,void 0).then((e=>{r.subSurface.refractionIntensityTexture=e,r.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I.RegisterExtension(ve,(e=>new xe(e)));const Oe="KHR_materials_translucency";class we{constructor(e){this.name=Oe,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(Oe),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialBasePropertiesAsync(e,t,n)),i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadTranslucentPropertiesAsync(s,t,n,r)),Promise.all(i).then((()=>{}))}))}_loadTranslucentPropertiesAsync(e,t,n,s){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);const r=n;return r.subSurface.isTranslucencyEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,r.subSurface.useAlbedoToTintTranslucency=!0,void 0===s.translucencyFactor?(r.subSurface.translucencyIntensity=0,r.subSurface.isTranslucencyEnabled=!1,Promise.resolve()):(r.subSurface.translucencyIntensity=s.translucencyFactor,s.translucencyTexture?(s.translucencyTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/translucencyTexture`,s.translucencyTexture).then((e=>{r.subSurface.translucencyIntensityTexture=e}))):Promise.resolve())}}I.RegisterExtension(Oe,(e=>new we(e)));const Ce="KHR_materials_volume";class Me{constructor(e){this.name=Ce,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ce),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=new Array;return i.push(this._loader.loadMaterialBasePropertiesAsync(e,t,n)),i.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadVolumePropertiesAsync(s,t,n,r)),Promise.all(i).then((()=>{}))}))}_loadVolumePropertiesAsync(e,t,n,s){if(!(n instanceof p.Y))throw new Error(`${e}: Material type not supported`);if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!s.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;const r=void 0!==s.attenuationDistance?s.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=r,void 0!==s.attenuationColor&&3==s.attenuationColor.length&&n.subSurface.tintColor.copyFromFloats(s.attenuationColor[0],s.attenuationColor[1],s.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=s.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,s.thicknessTexture?(s.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,s.thicknessTexture).then((e=>{n.subSurface.thicknessTexture=e,n.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I.RegisterExtension(Ce,(e=>new Me(e)));const Pe="KHR_mesh_quantization";class Re{constructor(e){this.name=Pe,this.enabled=e.isExtensionUsed(Pe)}dispose(){}}I.RegisterExtension(Pe,(e=>new Re(e)));const Se="KHR_texture_basisu";class Le{constructor(e){this.name=Se,this._loader=e,this.enabled=e.isExtensionUsed(Se)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>{const i=null==t.sampler?I.DefaultSampler:L.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),o=L.Get(`${s}/source`,this._loader.gltf.images,r.source);return this._loader._createTextureAsync(e,i,o,(e=>{n(e)}),t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)}))}}I.RegisterExtension(Se,(e=>new Le(e)));const Ie="KHR_texture_transform";class Ne{constructor(e){this.name=Ie,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ie)}dispose(){this._loader=null}loadTextureInfoAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((s,r)=>this._loader.loadTextureInfoAsync(e,t,(e=>{if(!(e instanceof _.x))throw new Error(`${s}: Texture type not supported`);r.offset&&(e.uOffset=r.offset[0],e.vOffset=r.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,r.rotation&&(e.wAng=-r.rotation),r.scale&&(e.uScale=r.scale[0],e.vScale=r.scale[1]),null!=r.texCoord&&(e.coordinatesIndex=r.texCoord),n(e)}))))}}I.RegisterExtension(Ie,(e=>new Ne(e)));const Fe="KHR_xmp_json_ld";class Be{constructor(e){this.name=Fe,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(Fe)}dispose(){this._loader=null}onLoading(){var e,t,n;if(null===this._loader.rootBabylonMesh)return;const s=null===(e=this._loader.gltf.extensions)||void 0===e?void 0:e.KHR_xmp_json_ld,r=null===(n=null===(t=this._loader.gltf.asset)||void 0===t?void 0:t.extensions)||void 0===n?void 0:n.KHR_xmp_json_ld;if(s&&r){const e=+r.packet;s.packets&&e<s.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=s.packets[e])}}}function De(e,t,n,s){return i.Wo.FromArray(t,n).scale(s)}function Ue(e,t,n,s){return t[n]*s}function Ve(e,t,n,s){return-t[n]*s}function $e(e,t,n,s){return t[n+1]*s}function ke(e,t,n,s){return t[n]*s*2}function Ge(e){return{scale:[new je(w.f.ANIMATIONTYPE_FLOAT,`${e}.uScale`,Ue,(()=>2)),new je(w.f.ANIMATIONTYPE_FLOAT,`${e}.vScale`,$e,(()=>2))],offset:[new je(w.f.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,Ue,(()=>2)),new je(w.f.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,$e,(()=>2))],rotation:[new je(w.f.ANIMATIONTYPE_FLOAT,`${e}.wAng`,Ve,(()=>1))]}}I.RegisterExtension(Fe,(e=>new Be(e)));class We extends M{buildAnimations(e,t,n,s,r){r(e._babylonCamera,this._buildAnimation(t,n,s))}}class je extends M{buildAnimations(e,t,n,s,r){for(const i in e._data)r(e._data[i].babylonMaterial,this._buildAnimation(t,n,s))}}class He extends M{buildAnimations(e,t,n,s,r){r(e._babylonLight,this._buildAnimation(t,n,s))}}const Ye={__array__:{__target__:!0,...R}},Ke={__array__:{__target__:!0,orthographic:{xmag:[new We(w.f.ANIMATIONTYPE_FLOAT,"orthoLeft",Ve,(()=>1)),new We(w.f.ANIMATIONTYPE_FLOAT,"orthoRight",$e,(()=>1))],ymag:[new We(w.f.ANIMATIONTYPE_FLOAT,"orthoBottom",Ve,(()=>1)),new We(w.f.ANIMATIONTYPE_FLOAT,"orthoTop",$e,(()=>1))],zfar:[new We(w.f.ANIMATIONTYPE_FLOAT,"maxZ",Ue,(()=>1))],znear:[new We(w.f.ANIMATIONTYPE_FLOAT,"minZ",Ue,(()=>1))]},perspective:{yfov:[new We(w.f.ANIMATIONTYPE_FLOAT,"fov",Ue,(()=>1))],zfar:[new We(w.f.ANIMATIONTYPE_FLOAT,"maxZ",Ue,(()=>1))],znear:[new We(w.f.ANIMATIONTYPE_FLOAT,"minZ",Ue,(()=>1))]}}},ze={nodes:Ye,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new je(w.f.ANIMATIONTYPE_COLOR3,"albedoColor",De,(()=>4)),new je(w.f.ANIMATIONTYPE_FLOAT,"alpha",(function(e,t,n,s){return t[n+3]*s}),(()=>4))],metallicFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"metallic",Ue,(()=>1))],roughnessFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"roughness",Ue,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Ge("albedoTexture")}}},emissiveFactor:[new je(w.f.ANIMATIONTYPE_COLOR3,"emissiveColor",De,(()=>3))],normalTexture:{scale:[new je(w.f.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Ue,(()=>1))]},occlusionTexture:{strength:[new je(w.f.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Ue,(()=>1))],extensions:{KHR_texture_transform:Ge("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Ge("emissiveTexture")}},extensions:{KHR_materials_ior:{ior:[new je(w.f.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Ue,(()=>1))]},KHR_materials_clearcoat:{clearcoatFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Ue,(()=>1))],clearcoatRoughnessFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Ue,(()=>1))]},KHR_materials_sheen:{sheenColorFactor:[new je(w.f.ANIMATIONTYPE_COLOR3,"sheen.color",De,(()=>3))],sheenRoughnessFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"sheen.roughness",Ue,(()=>1))]},KHR_materials_specular:{specularFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Ue,(()=>1))],specularColorFactor:[new je(w.f.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",De,(()=>3))]},KHR_materials_emissive_strength:{emissiveStrength:[new je(w.f.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Ue,(()=>1))]},KHR_materials_transmission:{transmissionFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Ue,(()=>1))]},KHR_materials_volume:{attenuationColor:[new je(w.f.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",De,(()=>3))],attenuationDistance:[new je(w.f.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Ue,(()=>1))],thicknessFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Ue,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new je(w.f.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Ue,(()=>1))],iridescenceIor:[new je(w.f.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Ue,(()=>1))],iridescenceThicknessMinimum:[new je(w.f.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Ue,(()=>1))],iridescenceThicknessMaximum:[new je(w.f.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Ue,(()=>1))]}}}},cameras:Ke,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new He(w.f.ANIMATIONTYPE_COLOR3,"diffuse",De,(()=>3))],intensity:[new He(w.f.ANIMATIONTYPE_FLOAT,"intensity",Ue,(()=>1))],range:[new He(w.f.ANIMATIONTYPE_FLOAT,"range",Ue,(()=>1))],spot:{innerConeAngle:[new He(w.f.ANIMATIONTYPE_FLOAT,"innerAngle",ke,(()=>1))],outerConeAngle:[new He(w.f.ANIMATIONTYPE_FLOAT,"angle",ke,(()=>1))]}}}}}},qe="KHR_animation_pointer";class Xe{constructor(e){this.name=qe,this._loader=e}get enabled(){return this._loader.isExtensionUsed(qe)}dispose(){this._loader=null}_loadAnimationChannelAsync(e,t,n,s,r){var i;const o=null===(i=s.target.extensions)||void 0===i?void 0:i.KHR_animation_pointer;if(!o)return null;"pointer"!==s.target.path&&x.Y.Warn(`${e}/target/path: Value (${s.target.path}) must be (pointer) when using the ${this.name} extension`),null!=s.target.node&&x.Y.Warn(`${e}/target/node: Value (${s.target.node}) must not be present when using the ${this.name} extension`);const a=`${e}/extensions/${this.name}`,l=o.pointer;if(!l)throw new Error(`${a}: Pointer is missing`);const c=this._parseAnimationPointer(`${a}/pointer`,l);return c?this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,n,s,c,r):(x.Y.Warn(`${a}/pointer: Invalid pointer (${l}) skipped`),null)}_parseAnimationPointer(e,t){if(!t.startsWith("/"))return x.Y.Warn(`${e}: Value (${t}) must start with a slash`),null;const n=t.split("/");n.shift();let s,r=ze,i=this._loader.gltf;for(const e of n){if(r.__array__)r=r.__array__;else if(r=r[e],!r)return null;i=i&&i[e],r.__target__&&(s=i)}return s&&Array.isArray(r)?{target:s,properties:r}:null}}I.RegisterExtension(qe,(e=>new Xe(e)));var Ze=n(80508),Je=n(5007),Qe=n(59020);const et="MSFT_audio_emitter";class tt{constructor(e){this.name=et,this._loader=e,this.enabled=this._loader.isExtensionUsed(et)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,L.Assign(this._clips),L.Assign(this._emitters)}}loadSceneAsync(e,t){return I.LoadExtensionAsync(e,t,this.name,((n,s)=>{const r=new Array;r.push(this._loader.loadSceneAsync(e,t));for(const e of s.emitters){const t=L.Get(`${n}/emitters`,this._emitters,e);if(null!=t.refDistance||null!=t.maxDistance||null!=t.rolloffFactor||null!=t.distanceModel||null!=t.innerAngle||null!=t.outerAngle)throw new Error(`${n}: Direction or Distance properties are not allowed on emitters attached to a scene`);r.push(this._loadEmitterAsync(`${n}/emitters/${t.index}`,t))}return Promise.all(r).then((()=>{}))}))}loadNodeAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((e,s)=>{const i=new Array;return this._loader.loadNodeAsync(e,t,(t=>{for(const n of s.emitters){const s=L.Get(`${e}/emitters`,this._emitters,n);i.push(this._loadEmitterAsync(`${e}/emitters/${s.index}`,s).then((()=>{for(const e of s._babylonSounds)e.attachToMesh(t),null==s.innerAngle&&null==s.outerAngle||(e.setLocalDirectionToMesh(r.P.Forward()),e.setDirectionalCone(2*o.w1.ToDegrees(null==s.innerAngle?Math.PI:s.innerAngle),2*o.w1.ToDegrees(null==s.outerAngle?Math.PI:s.outerAngle),0))})))}n(t)})).then((e=>Promise.all(i).then((()=>e))))}))}loadAnimationAsync(e,t){return I.LoadExtensionAsync(e,t,this.name,((n,s)=>this._loader.loadAnimationAsync(e,t).then((r=>{const i=new Array;L.Assign(s.events);for(const o of s.events)i.push(this._loadAnimationEventAsync(`${n}/events/${o.index}`,e,t,o,r));return Promise.all(i).then((()=>r))}))))}_loadClipAsync(e,t){if(t._objectURL)return t._objectURL;let n;if(t.uri)n=this._loader.loadUriAsync(e,t,t.uri);else{const s=L.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,t.bufferView);n=this._loader.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}return t._objectURL=n.then((e=>URL.createObjectURL(new Blob([e],{type:t.mimeType})))),t._objectURL}_loadEmitterAsync(e,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){const e=new Array,n=t.name||`emitter${t.index}`,s={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume};for(let r=0;r<t.clips.length;r++){const i=`/extensions/${this.name}/clips`,o=L.Get(i,this._clips,t.clips[r].clip);e.push(this._loadClipAsync(`${i}/${t.clips[r].clip}`,o).then((e=>{const i=t._babylonSounds[r]=new Je.$(n,e,this._loader.babylonScene,null,s);i.refDistance=t.refDistance||1,i.maxDistance=t.maxDistance||256,i.rolloffFactor=t.rolloffFactor||1,i.distanceModel=t.distanceModel||"exponential"})))}const r=Promise.all(e).then((()=>{const e=t.clips.map((e=>e.weight||1)),n=new Qe.s(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(n.directionalConeInnerAngle=2*o.w1.ToDegrees(t.innerAngle)),t.outerAngle&&(n.directionalConeOuterAngle=2*o.w1.ToDegrees(t.outerAngle)),t.volume&&(n.volume=t.volume),t._babylonData.sound=n}));t._babylonData={loaded:r}}return t._babylonData.loaded}_getEventAction(e,t,n,s,r){switch(n){case"play":return e=>{const n=(r||0)+(e-s);t.play(n)};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw new Error(`${e}: Unsupported action ${n}`)}}_loadAnimationEventAsync(e,t,n,s,r){if(0==r.targetedAnimations.length)return Promise.resolve();const i=r.targetedAnimations[0],o=s.emitter,a=L.Get(`/extensions/${this.name}/emitters`,this._emitters,o);return this._loadEmitterAsync(e,a).then((()=>{const t=a._babylonData.sound;if(t){const n=new Ze.O(s.time,this._getEventAction(e,t,s.action,s.time,s.startOffset));i.animation.addEvent(n),r.onAnimationGroupEndObservable.add((()=>{t.stop()})),r.onAnimationGroupPauseObservable.add((()=>{t.pause()}))}}))}}I.RegisterExtension(et,(e=>new tt(e)));const nt="MSFT_lod";class st{constructor(e){this.name=nt,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Ae.y$,this.onMaterialLODsLoadedObservable=new Ae.y$,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.enabled=this._loader.isExtensionUsed(nt)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){const t=Promise.all(this._nodePromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}for(let e=0;e<this._materialPromiseLODs.length;e++){const t=Promise.all(this._materialPromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}}loadSceneAsync(e,t){const n=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),n}loadNodeAsync(e,t,n){return I.LoadExtensionAsync(e,t,this.name,((e,r)=>{let i;const o=this._getLODs(e,t,this._loader.gltf.nodes,r.ids);this._loader.logOpen(`${e}`);for(let e=0;e<o.length;e++){const t=o[e];0!==e&&(this._nodeIndexLOD=e,this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new s.B);const r=e=>{n(e),e.setEnabled(!1)},a=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,r).then((t=>{if(0!==e){const t=o[e-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.setEnabled(!0),t}));this._nodePromiseLODs[e]=this._nodePromiseLODs[e]||[],0===e?i=a:(this._nodeIndexLOD=null,this._nodePromiseLODs[e].push(a))}return this._loader.logClose(),i}))}_loadMaterialAsync(e,t,n,s,r){return this._nodeIndexLOD?null:I.LoadExtensionAsync(e,t,this.name,((e,i)=>{let o;const a=this._getLODs(e,t,this._loader.gltf.materials,i.ids);this._loader.logOpen(`${e}`);for(let e=0;e<a.length;e++){const t=a[e];0!==e&&(this._materialIndexLOD=e);const i=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,n,s,(t=>{0===e&&r(t)})).then((t=>{if(0!==e){r(t);const n=a[e-1]._data;n[s]&&(this._disposeMaterials([n[s].babylonMaterial]),delete n[s])}return t}));this._materialPromiseLODs[e]=this._materialPromiseLODs[e]||[],0===e?o=i:(this._materialIndexLOD=null,this._materialPromiseLODs[e].push(i))}return this._loader.logClose(),o}))}_loadUriAsync(e,t,n){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const r=this._nodeIndexLOD-1;return this._nodeSignalLODs[r]=this._nodeSignalLODs[r]||new s.B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(e,t,n)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const r=this._materialIndexLOD-1;return this._materialSignalLODs[r]=this._materialSignalLODs[r]||new s.B,this._materialSignalLODs[r].promise.then((()=>this._loader.loadUriAsync(e,t,n)))}return null}loadBufferAsync(e,t,n,r){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);const t=(e,t)=>{const i=n,o=i+r-1;let a=e[t];return a?(a.start=Math.min(a.start,i),a.end=Math.max(a.end,o)):(a={start:i,end:o,loaded:new s.B},e[t]=a),a.loaded.promise.then((e=>new Uint8Array(e.buffer,e.byteOffset+n-a.start,r)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}_loadBufferLOD(e,t){const n=e[t];n&&(this._loader.log(`Loading buffer range [${n.start}-${n.end}]`),this._loader.bin.readAsync(n.start,n.end-n.start+1).then((e=>{n.loaded.resolve(e)}),(e=>{n.loaded.reject(e)})))}_getLODs(e,t,n,s){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const r=new Array;for(let t=s.length-1;t>=0;t--)if(r.push(L.Get(`${e}/ids/${s[t]}`,n,s[t])),r.length===this.maxLODsToLoad)return r;return r.push(t),r}_disposeTransformNode(e){const t=new Array,n=e.material;n&&t.push(n);for(const n of e.getChildMeshes())n.material&&t.push(n.material);e.dispose();const s=t.filter((e=>this._loader.babylonScene.meshes.every((t=>t.material!=e))));this._disposeMaterials(s)}_disposeMaterials(e){const t={};for(const n of e){for(const e of n.getActiveTextures())t[e.uniqueId]=e;n.dispose()}for(const e in t)for(const n of this._loader.babylonScene.materials)n.hasTexture(t[e])&&delete t[e];for(const e in t)t[e].dispose()}}I.RegisterExtension(nt,(e=>new st(e)));const rt="MSFT_minecraftMesh";class it{constructor(e){this.name=rt,this._loader=e,this.enabled=this._loader.isExtensionUsed(rt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtraAsync(e,t,this.name,((s,r)=>{if(r){if(!(n instanceof p.Y))throw new Error(`${s}: Material type not supported`);const r=this._loader.loadMaterialPropertiesAsync(e,t,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,r}return null}))}}I.RegisterExtension(rt,(e=>new it(e)));const ot="MSFT_sRGBFactors";class at{constructor(e){this.name=ot,this._loader=e,this.enabled=this._loader.isExtensionUsed(ot)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return I.LoadExtraAsync(e,t,this.name,((s,r)=>{if(r){if(!(n instanceof p.Y))throw new Error(`${s}: Material type not supported`);const r=this._loader.loadMaterialPropertiesAsync(e,t,n);return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor),r}return null}))}}I.RegisterExtension(ot,(e=>new at(e)));const lt="ExtrasAsMetadata";class ct{_assignExtras(e,t){if(t.extras&&Object.keys(t.extras).length>0){const n=e.metadata=e.metadata||{};(n.gltf=n.gltf||{}).extras=t.extras}}constructor(e){this.name=lt,this.enabled=!0,this._loader=e}dispose(){this._loader=null}loadNodeAsync(e,t,n){return this._loader.loadNodeAsync(e,t,(e=>{this._assignExtras(e,t),n(e)}))}loadCameraAsync(e,t,n){return this._loader.loadCameraAsync(e,t,(e=>{this._assignExtras(e,t),n(e)}))}createMaterial(e,t,n){const s=this._loader.createMaterial(e,t,n);return this._assignExtras(s,t),s}}I.RegisterExtension(lt,(e=>new ct(e)))},88862:(e,t,n)=>{n.d(t,{B2:()=>r,em:()=>s,ey:()=>m,zA:()=>i});var s,r,i,o=n(62897),a=n(13514),l=n(63407),c=n(7701),h=n(84318),d=n(21879),u=n(31461),f=n(79245),p=n(46223);function _(e,t,n){try{return Promise.resolve(new Uint8Array(e,t,n))}catch(e){return Promise.reject(e)}}!function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(s||(s={})),function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(r||(r={})),function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(i||(i={}));class m{constructor(){this.onParsedObservable=new o.y$,this.coordinateSystemMode=s.AUTO,this.animationStartMode=r.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable=new o.y$,this.onSkinLoadedObservable=new o.y$,this.onTextureLoadedObservable=new o.y$,this.onMaterialLoadedObservable=new o.y$,this.onCameraLoadedObservable=new o.y$,this.onCompleteObservable=new o.y$,this.onErrorObservable=new o.y$,this.onDisposeObservable=new o.y$,this.onExtensionLoadedObservable=new o.y$,this.validate=!1,this.onValidatedObservable=new o.y$,this._loader=null,this._state=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new o.y$,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const e of this._requests)e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}loadFile(e,t,n,s,r,i){this._progressCallback=s;const l=t.name?"file:":a.w1.GetFolderPath(t),c=t.name||a.w1.GetFilename(t);if(r){if(this.useRangeRequests){this.validate&&h.Y.Warn("glTF validation is not supported when range requests are enabled");const s={abort:()=>{},onCompleteObservable:new o.y$},r={readAsync:(n,s)=>new Promise(((r,i)=>{this._loadFile(e,t,(e=>{r(new Uint8Array(e))}),!0,(e=>{i(e)}),(e=>{e.setRequestHeader("Range",`bytes=${n}-${n+s-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new d.d(r)).then((e=>{s.onCompleteObservable.notifyObservers(s),n(e)}),i?e=>i(void 0,e):void 0),s}return this._loadFile(e,t,(t=>{this._validate(e,t,l,c),this._unpackBinaryAsync(new d.d({readAsync:(e,n)=>_(t,e,n),byteLength:t.byteLength})).then((e=>{n(e)}),i?e=>i(void 0,e):void 0)}),!0,i)}return this._loadFile(e,t,(t=>{this._validate(e,t,l,c),n({json:this._parseJson(t)})}),r,i)}importMeshAsync(e,t,n,s,r,i){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(n),this._loader.importMeshAsync(e,t,null,n,s,r,i))))}loadAsync(e,t,n,s,r){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(e,t,n,s,r))))}loadAssetContainerAsync(e,t,n,s,r){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(t);const i=new c.TJ(e),o=[];this.onMaterialLoadedObservable.add((e=>{o.push(e)}));const a=[];this.onTextureLoadedObservable.add((e=>{a.push(e)}));const l=[];return this.onCameraLoadedObservable.add((e=>{l.push(e)})),this._loader.importMeshAsync(null,e,i,t,n,s,r).then((e=>(Array.prototype.push.apply(i.geometries,e.geometries),Array.prototype.push.apply(i.meshes,e.meshes),Array.prototype.push.apply(i.particleSystems,e.particleSystems),Array.prototype.push.apply(i.skeletons,e.skeletons),Array.prototype.push.apply(i.animationGroups,e.animationGroups),Array.prototype.push.apply(i.materials,o),Array.prototype.push.apply(i.textures,a),Array.prototype.push.apply(i.lights,e.lights),Array.prototype.push.apply(i.transformNodes,e.transformNodes),Array.prototype.push.apply(i.cameras,l),i)))}))}canDirectLoad(e){return-1!==e.indexOf("asset")&&-1!==e.indexOf("version")||e.startsWith("data:base64,"+m._MagicBase64Encoded)||e.startsWith("data:;base64,"+m._MagicBase64Encoded)||e.startsWith("data:application/octet-stream;base64,"+m._MagicBase64Encoded)||e.startsWith("data:model/gltf-binary;base64,"+m._MagicBase64Encoded)}directLoad(e,t){if(t.startsWith("base64,"+m._MagicBase64Encoded)||t.startsWith(";base64,"+m._MagicBase64Encoded)||t.startsWith("application/octet-stream;base64,"+m._MagicBase64Encoded)||t.startsWith("model/gltf-binary;base64,"+m._MagicBase64Encoded)){const n=(0,f.$K)(t);return this._validate(e,n),this._unpackBinaryAsync(new d.d({readAsync:(e,t)=>_(n,e,t),byteLength:n.byteLength}))}return this._validate(e,t),Promise.resolve({json:this._parseJson(t)})}createPlugin(){return new m}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((e,t)=>{this.onCompleteObservable.addOnce((()=>{e()})),this.onErrorObservable.addOnce((e=>{t(e)}))}))}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(i[this._state]))}_loadFile(e,t,n,s,r,i){const o=e._loadFile(t,n,(e=>{this._onProgress(e,o)}),!0,s,r,i);return o.onCompleteObservable.add((e=>{this._requests.splice(this._requests.indexOf(e),1)})),this._requests.push(o),o}_onProgress(e,t){if(!this._progressCallback)return;t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;let n=!0,s=0,r=0;for(const e of this._requests){if(void 0===e._lengthComputable||void 0===e._loaded||void 0===e._total)return;n=n&&e._lengthComputable,s+=e._loaded,r+=e._total}this._progressCallback({lengthComputable:n,loaded:s,total:n?r:0})}_validate(e,t,n="",s=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),u.J.ValidateAsync(t,n,s,(t=>this.preprocessUrlAsync(n+t).then((t=>e._loadFileAsync(t,void 0,!0,!0))))).then((e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()}),(e=>{this._endPerformanceCounter("Validate JSON"),a.w1.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()})))}_getLoader(e){const t=e.json.asset||{};this._log(`Asset version: ${t.version}`),t.minVersion&&this._log(`Asset minimum version: ${t.minVersion}`),t.generator&&this._log(`Asset generator: ${t.generator}`);const n=m._parseVersion(t.version);if(!n)throw new Error("Invalid version: "+t.version);if(void 0!==t.minVersion){const e=m._parseVersion(t.minVersion);if(!e)throw new Error("Invalid minimum version: "+t.minVersion);if(m._compareVersion(e,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+t.minVersion)}const s={1:m._CreateGLTF1Loader,2:m._CreateGLTF2Loader}[n.major];if(!s)throw new Error("Unsupported version: "+t.version);return s(this)}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);const t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((()=>{const t=e.readUint32();if(1179937895!==t)throw new p.LH("Unexpected magic: "+t,p.SM.GLTFLoaderUnexpectedMagicError);const n=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);const s=e.readUint32();let r;switch(this.useRangeRequests||s===e.buffer.byteLength||h.Y.Warn(`Length in header does not match actual data length: ${s} != ${e.buffer.byteLength}`),n){case 1:r=this._unpackBinaryV1Async(e,s);break;case 2:r=this._unpackBinaryV2Async(e,s);break;default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),r}))}_unpackBinaryV1Async(e,t){const n=e.readUint32(),s=e.readUint32();if(0!==s)throw new Error(`Unexpected content format: ${s}`);const r=t-e.byteOffset,i={json:this._parseJson(e.readString(n)),bin:null};if(0!==r){const t=e.byteOffset;i.bin={readAsync:(n,s)=>e.buffer.readAsync(t+n,s),byteLength:r}}return Promise.resolve(i)}_unpackBinaryV2Async(e,t){const n=1313821514,s=5130562,r=e.readUint32();if(e.readUint32()!==n)throw new Error("First chunk format is not JSON");return e.byteOffset+r===t?e.loadAsync(r).then((()=>({json:this._parseJson(e.readString(r)),bin:null}))):e.loadAsync(r+8).then((()=>{const i={json:this._parseJson(e.readString(r)),bin:null},o=()=>{const r=e.readUint32();switch(e.readUint32()){case n:throw new Error("Unexpected JSON chunk");case s:{const t=e.byteOffset;i.bin={readAsync:(n,s)=>e.buffer.readAsync(t+n,s),byteLength:r},e.skipBytes(r);break}default:e.skipBytes(r)}return e.byteOffset!==t?e.loadAsync(8).then(o):Promise.resolve(i)};return o()}))}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};const t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}static _compareVersion(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0}_logOpen(e){this._log(e),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(e){const t=m._logSpaces.substr(0,2*this._logIndentLevel);h.Y.Log(`${t}${e}`)}_logDisabled(e){}_startPerformanceCounterEnabled(e){a.w1.StartPerformanceCounter(e)}_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){a.w1.EndPerformanceCounter(e)}_endPerformanceCounterDisabled(e){}}m.IncrementalLoading=!0,m.HomogeneousCoordinates=!1,m._MagicBase64Encoded="Z2xURg",m._logSpaces="                                ",l.n&&l.n.RegisterPlugin(new m)},31461:(e,t,n)=>{n.d(t,{J:()=>o});var s=n(13514);function r(e,t,n,s){const r={externalResourceFunction:e=>s(e).then((e=>new Uint8Array(e)))};return n&&(r.uri="file:"===t?n:t+n),e instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(e),r):GLTFValidator.validateString(e,r)}function i(){const e=[];onmessage=t=>{const n=t.data;switch(n.id){case"init":importScripts(n.url);break;case"validate":r(n.data,n.rootUrl,n.fileName,(t=>new Promise(((n,s)=>{const r=e.length;e.push({resolve:n,reject:s}),postMessage({id:"getExternalResource",index:r,uri:t})})))).then((e=>{postMessage({id:"validate.resolve",value:e})}),(e=>{postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[n.index].resolve(n.value);break;case"getExternalResource.reject":e[n.index].reject(n.reason)}}}class o{static ValidateAsync(e,t,n,o){return"function"==typeof Worker?new Promise(((s,a)=>{const l=`${r}(${i})()`,c=URL.createObjectURL(new Blob([l],{type:"application/javascript"})),h=new Worker(c),d=e=>{h.removeEventListener("error",d),h.removeEventListener("message",u),a(e)},u=e=>{const t=e.data;switch(t.id){case"getExternalResource":o(t.uri).then((e=>{h.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e])}),(e=>{h.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})}));break;case"validate.resolve":h.removeEventListener("error",d),h.removeEventListener("message",u),s(t.value),h.terminate();break;case"validate.reject":h.removeEventListener("error",d),h.removeEventListener("message",u),a(t.reason),h.terminate()}};h.addEventListener("error",d),h.addEventListener("message",u),h.postMessage({id:"init",url:this.Configuration.url}),h.postMessage({id:"validate",data:e,rootUrl:t,fileName:n})})):(this._LoadScriptPromise||(this._LoadScriptPromise=s.w1.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>r(e,t,n,o))))}}o.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"}},21055:(e,t,n)=>{n.d(t,{mp:()=>he.mp});var s,r,i,o,a,l,c,h,d=n(88862);n(31461);!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.FLOAT=5126]="FLOAT"}(s||(s={})),function(e){e[e.FRAGMENT=35632]="FRAGMENT",e[e.VERTEX=35633]="VERTEX"}(r||(r={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D"}(i||(i={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"}(o||(o={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9728]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(a||(a={})),function(e){e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(l||(l={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(c||(c={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(h||(h={}));var u=n(58095),f=n(15631),p=n(13514),_=n(2055),m=n(78098),g=n(18770),y=n(48017),b=n(52106),A=n(58445),T=n(98163),E=n(91855),v=n(3085),x=n(54067),O=n(73803),w=n(89209),C=n(72208),M=n(63946),P=n(68345),R=n(71419),S=n(91243),L=n(51356),I=n(258),N=n(65064),F=n(96761);class B{static SetMatrix(e,t,n,s,r){let o=null;if("MODEL"===n.semantic?o=t.getWorldMatrix():"PROJECTION"===n.semantic?o=e.getProjectionMatrix():"VIEW"===n.semantic?o=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===n.semantic?o=u.y3.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===n.semantic?o=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===n.semantic?o=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===n.semantic?o=t.getWorldMatrix().invert():"VIEWINVERSE"===n.semantic?o=e.getViewMatrix().invert():"PROJECTIONINVERSE"===n.semantic?o=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===n.semantic?o=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===n.semantic?o=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===n.semantic&&(o=u.y3.Transpose(t.getWorldMatrix().invert())),o)switch(n.type){case i.FLOAT_MAT2:r.setMatrix2x2(s,u.y3.GetAsMatrix2x2(o));break;case i.FLOAT_MAT3:r.setMatrix3x3(s,u.y3.GetAsMatrix3x3(o));break;case i.FLOAT_MAT4:r.setMatrix(s,o)}}static SetUniform(e,t,n,s){switch(s){case i.FLOAT:return e.setFloat(t,n),!0;case i.FLOAT_VEC2:return e.setVector2(t,u.FM.FromArray(n)),!0;case i.FLOAT_VEC3:return e.setVector3(t,u.P.FromArray(n)),!0;case i.FLOAT_VEC4:return e.setVector4(t,u.Lt.FromArray(n)),!0;default:return!1}}static GetWrapMode(e){switch(e){case o.CLAMP_TO_EDGE:return O.x.CLAMP_ADDRESSMODE;case o.MIRRORED_REPEAT:return O.x.MIRROR_ADDRESSMODE;case o.REPEAT:default:return O.x.WRAP_ADDRESSMODE}}static GetByteStrideFromType(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}}static GetTextureFilterMode(e){switch(e){case a.LINEAR:case a.LINEAR_MIPMAP_NEAREST:case a.LINEAR_MIPMAP_LINEAR:return O.x.TRILINEAR_SAMPLINGMODE;case a.NEAREST:case a.NEAREST_MIPMAP_NEAREST:return O.x.NEAREST_SAMPLINGMODE;default:return O.x.BILINEAR_SAMPLINGMODE}}static GetBufferFromBufferView(e,t,n,r,i){n=t.byteOffset+n;const o=e.loadedBufferViews[t.buffer];if(n+r>o.byteLength)throw new Error("Buffer access is out of range");const a=o.buffer;switch(n+=o.byteOffset,i){case s.BYTE:return new Int8Array(a,n,r);case s.UNSIGNED_BYTE:return new Uint8Array(a,n,r);case s.SHORT:return new Int16Array(a,n,r);case s.UNSIGNED_SHORT:return new Uint16Array(a,n,r);default:return new Float32Array(a,n,r)}}static GetBufferFromAccessor(e,t){const n=e.bufferViews[t.bufferView],s=t.count*B.GetByteStrideFromType(t);return B.GetBufferFromBufferView(e,n,t.byteOffset,s,t.componentType)}static DecodeBufferToText(e){let t="";const n=e.byteLength;for(let s=0;s<n;++s)t+=String.fromCharCode(e[s]);return t}static GetDefaultMaterial(e){if(!B._DefaultMaterial){A.Q.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),A.Q.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join("\n");const t={vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},n={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};B._DefaultMaterial=new x.j("GLTFDefaultMaterial",e,t,n),B._DefaultMaterial.setColor4("u_emission",new f.HE(.5,.5,.5,1))}return B._DefaultMaterial}}B._DefaultMaterial=null;var D,U=n(34941);!function(e){e[e.IDENTIFIER=1]="IDENTIFIER",e[e.UNKNOWN=2]="UNKNOWN",e[e.END_OF_INPUT=3]="END_OF_INPUT"}(D||(D={}));class V{constructor(e){this._pos=0,this.currentToken=D.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}getNextToken(){if(this.isEnd())return D.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=D.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=D.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken}peek(){return this._toParse[this._pos]}read(){return this._toParse[this._pos++]}forward(){this._pos++}isEnd(){return this._pos>=this._maxPos}}const $=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],k=["world","view","projection","worldView","worldViewProjection","mBones"],G=["translation","rotation","scale"],W=["position","rotationQuaternion","scaling"],j=(e,t,n)=>{for(const s in e){const r=e[s];n[t][s]=r}},H=e=>{if(e)for(let t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},Y=e=>{if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){const t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},K=e=>{let t=null;if(e.translation||e.rotation||e.scale){const n=u.P.FromArray(e.scale||[1,1,1]),s=u._f.FromArray(e.rotation||[0,0,0,1]),r=u.P.FromArray(e.translation||[0,0,0]);t=u.y3.Compose(n,s,r)}else t=u.y3.FromArray(e.matrix);return t},z=(e,t,n,s)=>{for(let e=0;e<s.bones.length;e++)if(s.bones[e].name===n)return s.bones[e];const r=e.nodes;for(const i in r){const o=r[i];if(!o.jointName)continue;const a=o.children;for(let r=0;r<a.length;r++){const l=e.nodes[a[r]];if(l.jointName&&l.jointName===n){const n=K(o),r=new y.N(o.name||"",s,z(e,t,o.jointName,s),n);return r.id=i,r}}}return null},q=(e,t)=>{for(let n=0;n<e.length;n++){const s=e[n];for(let e=0;e<s.node.children.length;e++){if(s.node.children[e]===t)return s.bone}}return null},X=(e,t)=>{const n=e.nodes;let s=n[t];if(s)return{node:s,id:t};for(const e in n)if(s=n[e],s.jointName===t)return{node:s,id:e};return null},Z=(e,t)=>{for(let n=0;n<e.jointNames.length;n++)if(e.jointNames[n]===t)return!0;return!1},J=(e,t,n,s)=>{if(s||(s=new b.O(t.name||"","",e.scene)),!t.babylonSkeleton)return s;const r=[],i=[];((e,t,n,s)=>{for(const r in e.nodes){const i=e.nodes[r],o=r;if(!i.jointName||Z(n,i.jointName))continue;const a=K(i),l=new y.N(i.name||"",t,null,a);l.id=o,s.push({bone:l,node:i,id:o})}for(let e=0;e<s.length;e++){const t=s[e],n=t.node.children;for(let e=0;e<n.length;e++){let r=null;for(let t=0;t<s.length;t++)if(s[t].id===n[e]){r=s[t];break}r&&(r.bone._parent=t.bone,t.bone.children.push(r.bone))}}})(e,s,t,r),s.bones=[];for(let n=0;n<t.jointNames.length;n++){const o=X(e,t.jointNames[n]);if(!o)continue;const a=o.node;if(!a){p.w1.Warn("Joint named "+t.jointNames[n]+" does not exist");continue}const l=o.id,c=e.scene.getBoneById(l);if(c){s.bones.push(c);continue}let h=!1,d=null;for(let r=0;r<n;r++){const n=X(e,t.jointNames[r]);if(!n)continue;const i=n.node;if(!i){p.w1.Warn("Joint named "+t.jointNames[r]+" does not exist when looking for parent");continue}const o=i.children;if(o){h=!1;for(let n=0;n<o.length;n++)if(o[n]===l){d=z(e,t,t.jointNames[r],s),h=!0;break}if(h)break}}const u=K(a);!d&&r.length>0&&(d=q(r,l),d&&-1===i.indexOf(d)&&i.push(d));new y.N(a.jointName||"",s,d,u).id=l}const o=s.bones;s.bones=[];for(let n=0;n<t.jointNames.length;n++){const r=X(e,t.jointNames[n]);if(r)for(let e=0;e<o.length;e++)if(o[e].id===r.id){s.bones.push(o[e]);break}}s.prepare();for(let e=0;e<i.length;e++)s.bones.push(i[e]);return s},Q=(e,t,n,s,r)=>{if(r||(e.scene._blockEntityCollection=!!e.assetContainer,(r=new S.Kj(t.name||"",e.scene))._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,r.id=s),!t.babylonNode)return r;const i=[];let o=null;const a=new Array,l=new Array,c=new Array,h=new Array;for(let t=0;t<n.length;t++){const s=n[t],r=e.meshes[s];if(r)for(let t=0;t<r.primitives.length;t++){const n=new w.x,s=r.primitives[t];s.mode;const u=s.attributes;let f=null,p=null;for(const t in u)if(f=e.accessors[u[t]],p=B.GetBufferFromAccessor(e,f),"NORMAL"===t)n.normals=new Float32Array(p.length),n.normals.set(p);else if("POSITION"===t){if(d.ey.HomogeneousCoordinates){n.positions=new Float32Array(p.length-p.length/4);for(let e=0;e<p.length;e+=4)n.positions[e]=p[e],n.positions[e+1]=p[e+1],n.positions[e+2]=p[e+2]}else n.positions=new Float32Array(p.length),n.positions.set(p);l.push(n.positions.length)}else if(-1!==t.indexOf("TEXCOORD_")){const e=Number(t.split("_")[1]),s=C.o.UVKind+(0===e?"":e+1),r=new Float32Array(p.length);r.set(p),H(r),n.set(r,s)}else"JOINT"===t?(n.matricesIndices=new Float32Array(p.length),n.matricesIndices.set(p)):"WEIGHT"===t?(n.matricesWeights=new Float32Array(p.length),n.matricesWeights.set(p)):"COLOR"===t&&(n.colors=new Float32Array(p.length),n.colors.set(p));if(f=e.accessors[s.indices],f)p=B.GetBufferFromAccessor(e,f),n.indices=new Int32Array(p.length),n.indices.set(p),h.push(n.indices.length);else{const e=[];for(let t=0;t<n.positions.length/3;t++)e.push(t);n.indices=new Int32Array(e),h.push(n.indices.length)}o?o.merge(n):o=n;const _=e.scene.getMaterialById(s.material);i.push(null===_?B.GetDefaultMaterial(e.scene):_),a.push(0===a.length?0:a[a.length-1]+l[l.length-2]),c.push(0===c.length?0:c[c.length-1]+h[h.length-2])}}let u;e.scene._blockEntityCollection=!!e.assetContainer,i.length>1?(u=new E.G("multimat"+s,e.scene),u.subMaterials=i):u=new v.K("multimat"+s,e.scene),1===i.length&&(u=i[0]),u._parentContainer=e.assetContainer,r.material||(r.material=u),new M.Z(s,e.scene,o,!1,r),r.computeWorldMatrix(!0),e.scene._blockEntityCollection=!1,r.subMeshes=[];let f=0;for(let t=0;t<n.length;t++){const s=n[t],i=e.meshes[s];if(i)for(let e=0;e<i.primitives.length;e++)i.primitives[e].mode,P.P.AddToMesh(f,a[f],l[f],c[f],h[f],r,r,!0),f++}return r},ee=(e,t,n,s)=>{e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=n),e.scaling&&(e.scaling=s)},te=(e,t,n)=>{let s=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){const r=e.skins[t.skin],i=Q(e,t,t.meshes,n,t.babylonNode);i.skeleton=e.scene.getLastSkeletonById(t.skin),null===i.skeleton&&(i.skeleton=J(e,r,0,r.babylonSkeleton),r.babylonSkeleton||(r.babylonSkeleton=i.skeleton)),s=i}}else if(t.meshes){s=Q(e,t,t.mesh?[t.mesh]:t.meshes,n,t.babylonNode)}else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){const n=e.cameras[t.camera];if(n){if(e.scene._blockEntityCollection=!!e.assetContainer,"orthographic"===n.type){const n=new m.c(t.camera,u.P.Zero(),e.scene,!1);n.name=t.name||"",n.mode=_.V.ORTHOGRAPHIC_CAMERA,n.attachControl(),s=n,n._parentContainer=e.assetContainer}else if("perspective"===n.type){const r=n[n.type],i=new m.c(t.camera,u.P.Zero(),e.scene,!1);i.name=t.name||"",i.attachControl(),r.aspectRatio||(r.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),r.znear&&r.zfar&&(i.maxZ=r.zfar,i.minZ=r.znear),s=i,i._parentContainer=e.assetContainer}e.scene._blockEntityCollection=!1}}}else{const n=e.lights[t.light];if(n)if("ambient"===n.type){const r=n[n.type],i=new L.e(t.light,u.P.Zero(),e.scene);i.name=t.name||"",r.color&&(i.diffuse=f.Wo.FromArray(r.color)),s=i}else if("directional"===n.type){const r=n[n.type],i=new I.O(t.light,u.P.Zero(),e.scene);i.name=t.name||"",r.color&&(i.diffuse=f.Wo.FromArray(r.color)),s=i}else if("point"===n.type){const r=n[n.type],i=new N.c(t.light,u.P.Zero(),e.scene);i.name=t.name||"",r.color&&(i.diffuse=f.Wo.FromArray(r.color)),s=i}else if("spot"===n.type){const r=n[n.type],i=new F.P(t.light,u.P.Zero(),u.P.Zero(),0,0,e.scene);i.name=t.name||"",r.color&&(i.diffuse=f.Wo.FromArray(r.color)),r.fallOfAngle&&(i.angle=r.fallOfAngle),r.fallOffExponent&&(i.exponent=r.fallOffExponent),s=i}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;if(null===s){e.scene._blockEntityCollection=!!e.assetContainer;const n=new S.Kj(t.name||"",e.scene);n._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,t.babylonNode=n,s=n}}if(null!==s){if(t.matrix&&s instanceof S.Kj)((e,t)=>{if(t.matrix){const n=new u.P(0,0,0),s=new u._f,r=new u.P(0,0,0);u.y3.FromArray(t.matrix).decompose(r,s,n),ee(e,n,s,r)}else t.translation&&t.rotation&&t.scale&&ee(e,u.P.FromArray(t.translation),u._f.FromArray(t.rotation),u.P.FromArray(t.scale));e.computeWorldMatrix(!0)})(s,t);else{const e=t.translation||[0,0,0],n=t.rotation||[0,0,0,1],r=t.scale||[1,1,1];ee(s,u.P.FromArray(e),u._f.FromArray(n),u.P.FromArray(r))}s.updateCache(!0),t.babylonNode=s}return s},ne=(e,t,n,s=!1)=>{const r=e.nodes[t];let i=null;if(s=!(e.importOnlyMeshes&&!s&&e.importMeshesNames)||(-1!==e.importMeshesNames.indexOf(r.name||"")||0===e.importMeshesNames.length),!r.jointName&&s&&(i=te(e,r,t),null!==i&&(i.id=t,i.parent=n)),r.children)for(let t=0;t<r.children.length;t++)ne(e,r.children[t],i,s)},se=e=>{let t=e.currentScene;if(t)for(let n=0;n<t.nodes.length;n++)ne(e,t.nodes[n],null);else for(const n in e.scenes){t=e.scenes[n];for(let n=0;n<t.nodes.length;n++)ne(e,t.nodes[n],null)}(e=>{for(const t in e.animations){const n=e.animations[t];if(!n.channels||!n.samplers)continue;let s=null;for(let r=0;r<n.channels.length;r++){const i=n.channels[r],o=n.samplers[i.sampler];if(!o)continue;let a=null,l=null;n.parameters?(a=n.parameters[o.input],l=n.parameters[o.output]):(a=o.input,l=o.output);const c=B.GetBufferFromAccessor(e,e.accessors[a]),h=B.GetBufferFromAccessor(e,e.accessors[l]),d=i.target.id;let f=e.scene.getNodeById(d);if(null===f&&(f=e.scene.getNodeByName(d)),null===f){p.w1.Warn("Creating animation named "+t+". But cannot find node named "+d+" to attach to");continue}const _=f instanceof y.N;let m=i.target.path;const b=G.indexOf(m);-1!==b&&(m=W[b]);let A=g.f.ANIMATIONTYPE_MATRIX;_||("rotationQuaternion"===m?(A=g.f.ANIMATIONTYPE_QUATERNION,f.rotationQuaternion=new u._f):A=g.f.ANIMATIONTYPE_VECTOR3);let T=null;const E=[];let v=0,x=!1;_&&s&&s.getKeys().length===c.length&&(T=s,x=!0),x||(e.scene._blockEntityCollection=!!e.assetContainer,T=new g.f(t,_?"_matrix":m,1,A,g.f.ANIMATIONLOOPMODE_CYCLE),e.scene._blockEntityCollection=!1);for(let e=0;e<c.length;e++){let t=null;if("rotationQuaternion"===m?(t=u._f.FromArray([h[v],h[v+1],h[v+2],h[v+3]]),v+=4):(t=u.P.FromArray([h[v],h[v+1],h[v+2]]),v+=3),_){const n=f;let r=u.P.Zero(),i=new u._f,o=u.P.Zero(),a=n.getBaseMatrix();x&&s&&(a=s.getKeys()[e].value),a.decompose(o,i,r),"position"===m?r=t:"rotationQuaternion"===m?i=t:o=t,t=u.y3.Compose(o,i,r)}x?s&&(s.getKeys()[e].value=t):E.push({frame:c[e],value:t})}!x&&T&&(T.setKeys(E),f.animations.push(T)),s=T,e.scene.stopAnimation(f),e.scene.beginAnimation(f,0,c[c.length-1],!0,1)}}})(e);for(let t=0;t<e.scene.skeletons.length;t++){const n=e.scene.skeletons[t];e.scene.beginAnimation(n,0,Number.MAX_VALUE,!0,1)}},re=(e,t,n,s,r,o)=>a=>{((e,t,n,s,r)=>{const o=s.values||n.parameters,a=n.uniforms;for(const n in r){const l=r[n],c=l.type;let h=o[a[n]];if(void 0===h&&(h=l.value),!h)continue;const d=e=>n=>{l.value&&e&&(t.setTexture(e,n),delete r[e])};c===i.SAMPLER_2D?ce.LoadTextureAsync(e,s.values?h:l.value,d(n),(()=>d(null))):l.value&&B.SetUniform(t,n,s.values?h:l.value,c)&&delete r[n]}})(e,t,n,s,r),t.onBind=a=>{((e,t,n,s,r,o,a)=>{const l=o.values||r.parameters;for(const a in n){const c=n[a],h=c.type;if(h===i.FLOAT_MAT2||h===i.FLOAT_MAT3||h===i.FLOAT_MAT4)if(!c.semantic||c.source||c.node){if(c.semantic&&(c.source||c.node)){let e=t.scene.getNodeByName(c.source||c.node||"");if(null===e&&(e=t.scene.getNodeById(c.source||c.node||"")),null===e)continue;B.SetMatrix(t.scene,e,c,a,s.getEffect())}}else B.SetMatrix(t.scene,e,c,a,s.getEffect());else{const e=l[r.uniforms[a]];if(!e)continue;if(h===i.SAMPLER_2D){const n=t.textures[o.values?e:c.value].babylonTexture;if(null==n)continue;s.getEffect().setTexture(a,n)}else B.SetUniform(s.getEffect(),a,e,h)}}a(s)})(a,e,r,t,n,s,o)}},ie=(e,t,n)=>{for(const s in t.uniforms){const r=t.uniforms[s],i=t.parameters[r];if(e.currentIdentifier===s&&i.semantic&&!i.source&&!i.node){const e=$.indexOf(i.semantic);if(-1!==e)return delete n[s],k[e]}}return e.currentIdentifier},oe=e=>{for(const t in e.materials)ce.LoadMaterialAsync(e,t,(()=>{}),(()=>{}))};class ae{static CreateRuntime(e,t,n){const s={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:n,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&j(e.extensions,"extensions",s),e.extensionsUsed&&j(e.extensionsUsed,"extensionsUsed",s),e.buffers&&((e,t)=>{for(const n in e){const s=e[n];t.buffers[n]=s,t.buffersCount++}})(e.buffers,s),e.bufferViews&&j(e.bufferViews,"bufferViews",s),e.accessors&&j(e.accessors,"accessors",s),e.meshes&&j(e.meshes,"meshes",s),e.lights&&j(e.lights,"lights",s),e.cameras&&j(e.cameras,"cameras",s),e.nodes&&j(e.nodes,"nodes",s),e.images&&j(e.images,"images",s),e.textures&&j(e.textures,"textures",s),e.shaders&&((e,t)=>{for(const n in e){const s=e[n];t.shaders[n]=s,t.shaderscount++}})(e.shaders,s),e.programs&&j(e.programs,"programs",s),e.samplers&&j(e.samplers,"samplers",s),e.techniques&&j(e.techniques,"techniques",s),e.materials&&j(e.materials,"materials",s),e.animations&&j(e.animations,"animations",s),e.skins&&j(e.skins,"skins",s),e.scenes&&(s.scenes=e.scenes),e.scene&&e.scenes&&(s.currentScene=e.scenes[e.scene]),s}static LoadBufferAsync(e,t,n,s,r){const i=e.buffers[t];p.w1.IsBase64(i.uri)?setTimeout((()=>n(new Uint8Array(p.w1.DecodeBase64(i.uri))))):p.w1.LoadFile(e.rootUrl+i.uri,(e=>n(new Uint8Array(e))),r,void 0,!0,(e=>{e&&s(e.status+" "+e.statusText)}))}static LoadTextureBufferAsync(e,t,n,s){const r=e.textures[t];if(!r||!r.source)return void s("");if(r.babylonTexture)return void n(null);const i=e.images[r.source];p.w1.IsBase64(i.uri)?setTimeout((()=>n(new Uint8Array(p.w1.DecodeBase64(i.uri))))):p.w1.LoadFile(e.rootUrl+i.uri,(e=>n(new Uint8Array(e))),void 0,void 0,!0,(e=>{e&&s(e.status+" "+e.statusText)}))}static CreateTextureAsync(e,t,n,s){const r=e.textures[t];if(r.babylonTexture)return void s(r.babylonTexture);const i=e.samplers[r.sampler],o=i.minFilter===a.NEAREST_MIPMAP_NEAREST||i.minFilter===a.NEAREST_MIPMAP_LINEAR||i.minFilter===a.LINEAR_MIPMAP_NEAREST||i.minFilter===a.LINEAR_MIPMAP_LINEAR,l=O.x.BILINEAR_SAMPLINGMODE,c=null==n?new Blob:new Blob([n]),h=URL.createObjectURL(c),d=()=>URL.revokeObjectURL(h),u=new O.x(h,e.scene,!o,!0,l,d,d);void 0!==i.wrapS&&(u.wrapU=B.GetWrapMode(i.wrapS)),void 0!==i.wrapT&&(u.wrapV=B.GetWrapMode(i.wrapT)),u.name=t,r.babylonTexture=u,s(u)}static LoadShaderStringAsync(e,t,n,s){const r=e.shaders[t];if(p.w1.IsBase64(r.uri)){const e=atob(r.uri.split(",")[1]);n&&n(e)}else p.w1.LoadFile(e.rootUrl+r.uri,n,void 0,void 0,!1,(e=>{e&&s&&s(e.status+" "+e.statusText)}))}static LoadMaterialAsync(e,t,n,s){const r=e.materials[t];if(!r.technique)return void(s&&s("No technique found."));const o=e.techniques[r.technique];if(!o){e.scene._blockEntityCollection=!!e.assetContainer;const s=new v.K(t,e.scene);return s._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,s.diffuseColor=new f.Wo(.5,.5,.5),s.sideOrientation=T.F.CounterClockWiseSideOrientation,void n(s)}const a=e.programs[o.program],l=o.states,d=A.Q.ShadersStore[a.vertexShader+"VertexShader"],u=A.Q.ShadersStore[a.fragmentShader+"PixelShader"];let p="",_="";const m=new V(d),g=new V(u),y={},b=[],E=[],O=[];for(const e in o.uniforms){const t=o.uniforms[e],n=o.parameters[t];if(y[e]=n,!n.semantic||n.node||n.source)n.type===i.SAMPLER_2D?O.push(e):b.push(e);else{const t=$.indexOf(n.semantic);-1!==t?(b.push(k[t]),delete y[e]):b.push(e)}}for(const e in o.attributes){const t=o.attributes[e],n=o.parameters[t];if(n.semantic){const e=Y(n);e&&E.push(e)}}for(;!m.isEnd()&&m.getNextToken();){if(m.currentToken!==D.IDENTIFIER){p+=m.currentString;continue}let e=!1;for(const t in o.attributes){const n=o.attributes[t],s=o.parameters[n];if(m.currentIdentifier===t&&s.semantic){p+=Y(s),e=!0;break}}e||(p+=ie(m,o,y))}for(;!g.isEnd()&&g.getNextToken();){g.currentToken===D.IDENTIFIER?_+=ie(g,o,y):_+=g.currentString}const w={vertex:a.vertexShader+t,fragment:a.fragmentShader+t},C={attributes:E,uniforms:b,samplers:O,needAlphaBlending:l&&l.enable&&-1!==l.enable.indexOf(3042)};A.Q.ShadersStore[a.vertexShader+t+"VertexShader"]=p,A.Q.ShadersStore[a.fragmentShader+t+"PixelShader"]=_;const M=new x.j(t,e.scene,w,C);if(M.onError=((e,t,n)=>(s,r)=>{t.dispose(!0),n("Cannot compile program named "+e.name+". Error: "+r+". Default material will be applied")})(a,M,s),M.onCompiled=re(e,M,o,r,y,n),M.sideOrientation=T.F.CounterClockWiseSideOrientation,l&&l.functions){const e=l.functions;e.cullFace&&e.cullFace[0]!==c.BACK&&(M.backFaceCulling=!1);const t=e.blendFuncSeparate;t&&(t[0]===h.SRC_ALPHA&&t[1]===h.ONE_MINUS_SRC_ALPHA&&t[2]===h.ONE&&t[3]===h.ONE?M.alphaMode=U.g.ALPHA_COMBINE:t[0]===h.ONE&&t[1]===h.ONE&&t[2]===h.ZERO&&t[3]===h.ONE?M.alphaMode=U.g.ALPHA_ONEONE:t[0]===h.SRC_ALPHA&&t[1]===h.ONE&&t[2]===h.ZERO&&t[3]===h.ONE?M.alphaMode=U.g.ALPHA_ADD:t[0]===h.ZERO&&t[1]===h.ONE_MINUS_SRC_COLOR&&t[2]===h.ONE&&t[3]===h.ONE?M.alphaMode=U.g.ALPHA_SUBTRACT:t[0]===h.DST_COLOR&&t[1]===h.ZERO&&t[2]===h.ONE&&t[3]===h.ONE?M.alphaMode=U.g.ALPHA_MULTIPLY:t[0]===h.SRC_ALPHA&&t[1]===h.ONE_MINUS_SRC_COLOR&&t[2]===h.ONE&&t[3]===h.ONE&&(M.alphaMode=U.g.ALPHA_MAXIMIZED))}}}class le{static RegisterExtension(e){le.Extensions[e.name]?p.w1.Error('Tool with the same name "'+e.name+'" already exists'):le.Extensions[e.name]=e}dispose(){}_importMeshAsync(e,t,n,s,r,i,o,a){return t.useRightHandedSystem=!0,ce.LoadRuntimeAsync(t,n,s,(t=>{t.assetContainer=r,t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],p.w1.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],this._createNodes(t);const n=new Array,s=new Array;for(const e in t.nodes){const s=t.nodes[e];s.babylonNode instanceof R.x&&n.push(s.babylonNode)}for(const e in t.skins){const n=t.skins[e];n.babylonSkeleton instanceof b.O&&s.push(n.babylonSkeleton)}this._loadBuffersAsync(t,(()=>{this._loadShadersAsync(t,(()=>{oe(t),se(t),!d.ey.IncrementalLoading&&i&&i(n,s)}))})),d.ey.IncrementalLoading&&i&&i(n,s)}),a),!0}importMeshAsync(e,t,n,s,r,i){return new Promise(((o,a)=>{this._importMeshAsync(e,t,s,r,n,((e,t)=>{o({meshes:e,particleSystems:[],skeletons:t,animationGroups:[],lights:[],transformNodes:[],geometries:[]})}),i,(e=>{a(new Error(e))}))}))}_loadAsync(e,t,n,s,r,i){e.useRightHandedSystem=!0,ce.LoadRuntimeAsync(e,t,n,(e=>{ce.LoadRuntimeExtensionsAsync(e,(()=>{this._createNodes(e),this._loadBuffersAsync(e,(()=>{this._loadShadersAsync(e,(()=>{oe(e),se(e),d.ey.IncrementalLoading||s()}))})),d.ey.IncrementalLoading&&s()}),i)}),i)}loadAsync(e,t,n,s){return new Promise(((r,i)=>{this._loadAsync(e,t,n,(()=>{r()}),s,(e=>{i(new Error(e))}))}))}_loadShadersAsync(e,t){let n=!1;const s=(n,s)=>{ce.LoadShaderStringAsync(e,n,(i=>{i instanceof ArrayBuffer||(e.loadedShaderCount++,i&&(A.Q.ShadersStore[n+(s.type===r.VERTEX?"VertexShader":"PixelShader")]=i),e.loadedShaderCount===e.shaderscount&&t())}),(()=>{p.w1.Error("Error when loading shader program named "+n+" located at "+s.uri)}))};for(const t in e.shaders){n=!0;const r=e.shaders[t];r?s.bind(this,t,r)():p.w1.Error("No shader named: "+t)}n||t()}_loadBuffersAsync(e,t){let n=!1;const s=(n,s)=>{ce.LoadBufferAsync(e,n,(r=>{e.loadedBufferCount++,r&&(r.byteLength!=e.buffers[n].byteLength&&p.w1.Error("Buffer named "+n+" is length "+r.byteLength+". Expected: "+s.byteLength),e.loadedBufferViews[n]=r),e.loadedBufferCount===e.buffersCount&&t()}),(()=>{p.w1.Error("Error when loading buffer named "+n+" located at "+s.uri)}))};for(const t in e.buffers){n=!0;const r=e.buffers[t];r?s.bind(this,t,r)():p.w1.Error("No buffer named: "+t)}n||t()}_createNodes(e){let t=e.currentScene;if(t)for(let n=0;n<t.nodes.length;n++)ne(e,t.nodes[n],null);else for(const n in e.scenes){t=e.scenes[n];for(let n=0;n<t.nodes.length;n++)ne(e,t.nodes[n],null)}}}le.Extensions={};class ce{constructor(e){this._name=e}get name(){return this._name}loadRuntimeAsync(e,t,n,s,r){return!1}loadRuntimeExtensionsAsync(e,t,n){return!1}loadBufferAsync(e,t,n,s,r){return!1}loadTextureBufferAsync(e,t,n,s){return!1}createTextureAsync(e,t,n,s,r){return!1}loadShaderStringAsync(e,t,n,s){return!1}loadMaterialAsync(e,t,n,s){return!1}static LoadRuntimeAsync(e,t,n,s,r){ce._ApplyExtensions((i=>i.loadRuntimeAsync(e,t,n,s,r)),(()=>{setTimeout((()=>{s&&s(ae.CreateRuntime(t.json,e,n))}))}))}static LoadRuntimeExtensionsAsync(e,t,n){ce._ApplyExtensions((s=>s.loadRuntimeExtensionsAsync(e,t,n)),(()=>{setTimeout((()=>{t()}))}))}static LoadBufferAsync(e,t,n,s,r){ce._ApplyExtensions((i=>i.loadBufferAsync(e,t,n,s,r)),(()=>{ae.LoadBufferAsync(e,t,n,s,r)}))}static LoadTextureAsync(e,t,n,s){ce._LoadTextureBufferAsync(e,t,(r=>{r&&ce._CreateTextureAsync(e,t,r,n,s)}),s)}static LoadShaderStringAsync(e,t,n,s){ce._ApplyExtensions((r=>r.loadShaderStringAsync(e,t,n,s)),(()=>{ae.LoadShaderStringAsync(e,t,n,s)}))}static LoadMaterialAsync(e,t,n,s){ce._ApplyExtensions((r=>r.loadMaterialAsync(e,t,n,s)),(()=>{ae.LoadMaterialAsync(e,t,n,s)}))}static _LoadTextureBufferAsync(e,t,n,s){ce._ApplyExtensions((r=>r.loadTextureBufferAsync(e,t,n,s)),(()=>{ae.LoadTextureBufferAsync(e,t,n,s)}))}static _CreateTextureAsync(e,t,n,s,r){ce._ApplyExtensions((i=>i.createTextureAsync(e,t,n,s,r)),(()=>{ae.CreateTextureAsync(e,t,n,s)}))}static _ApplyExtensions(e,t){for(const t in le.Extensions){if(e(le.Extensions[t]))return}t()}}d.ey._CreateGLTF1Loader=()=>new le;le.RegisterExtension(new class extends ce{constructor(){super("KHR_binary_glTF")}loadRuntimeAsync(e,t,n,s){const r=t.json.extensionsUsed;return!(!r||-1===r.indexOf(this.name)||!t.bin)&&(this._bin=t.bin,s(ae.CreateRuntime(t.json,e,n)),!0)}loadBufferAsync(e,t,n,s){return-1!==e.extensionsUsed.indexOf(this.name)&&("binary_glTF"===t&&(this._bin.readAsync(0,this._bin.byteLength).then(n,(e=>s(e.message))),!0))}loadTextureBufferAsync(e,t,n){const r=e.textures[t],i=e.images[r.source];if(!i.extensions||!(this.name in i.extensions))return!1;const o=i.extensions[this.name],a=e.bufferViews[o.bufferView];return n(B.GetBufferFromBufferView(e,a,0,a.byteLength,s.UNSIGNED_BYTE)),!0}loadShaderStringAsync(e,t,n){const r=e.shaders[t];if(!r.extensions||!(this.name in r.extensions))return!1;const i=r.extensions[this.name],o=e.bufferViews[i.bufferView],a=B.GetBufferFromBufferView(e,o,0,o.byteLength,s.UNSIGNED_BYTE);return setTimeout((()=>{const e=B.DecodeBufferToText(a);n(e)})),!0}});le.RegisterExtension(new class extends ce{constructor(){super("KHR_materials_common")}loadRuntimeExtensionsAsync(e){if(!e.extensions)return!1;const t=e.extensions[this.name];if(!t)return!1;const n=t.lights;if(n)for(const t in n){const s=n[t];switch(s.type){case"ambient":{const t=new L.e(s.name,new u.P(0,1,0),e.scene),n=s.ambient;n&&(t.diffuse=f.Wo.FromArray(n.color||[1,1,1]));break}case"point":{const t=new N.c(s.name,new u.P(10,10,10),e.scene),n=s.point;n&&(t.diffuse=f.Wo.FromArray(n.color||[1,1,1]));break}case"directional":{const t=new I.O(s.name,new u.P(0,-1,0),e.scene),n=s.directional;n&&(t.diffuse=f.Wo.FromArray(n.color||[1,1,1]));break}case"spot":{const t=s.spot;if(t){new F.P(s.name,new u.P(0,10,0),new u.P(0,-1,0),t.fallOffAngle||Math.PI,t.fallOffExponent||0,e.scene).diffuse=f.Wo.FromArray(t.color||[1,1,1])}break}default:p.w1.Warn('GLTF Material Common extension: light type "'+s.type+"\u201d not supported")}}return!1}loadMaterialAsync(e,t,n,s){const r=e.materials[t];if(!r||!r.extensions)return!1;const i=r.extensions[this.name];if(!i)return!1;const o=new v.K(t,e.scene);return o.sideOrientation=T.F.CounterClockWiseSideOrientation,"CONSTANT"===i.technique&&(o.disableLighting=!0),o.backFaceCulling=void 0!==i.doubleSided&&!i.doubleSided,o.alpha=void 0===i.values.transparency?1:i.values.transparency,o.specularPower=void 0===i.values.shininess?0:i.values.shininess,"string"==typeof i.values.ambient?this._loadTexture(e,i.values.ambient,o,"ambientTexture",s):o.ambientColor=f.Wo.FromArray(i.values.ambient||[0,0,0]),"string"==typeof i.values.diffuse?this._loadTexture(e,i.values.diffuse,o,"diffuseTexture",s):o.diffuseColor=f.Wo.FromArray(i.values.diffuse||[0,0,0]),"string"==typeof i.values.emission?this._loadTexture(e,i.values.emission,o,"emissiveTexture",s):o.emissiveColor=f.Wo.FromArray(i.values.emission||[0,0,0]),"string"==typeof i.values.specular?this._loadTexture(e,i.values.specular,o,"specularTexture",s):o.specularColor=f.Wo.FromArray(i.values.specular||[0,0,0]),!0}_loadTexture(e,t,n,s,r){ae.LoadTextureBufferAsync(e,t,(r=>{ae.CreateTextureAsync(e,t,r,(e=>n[s]=e))}),r)}});n(76764);var he=n(65301);n(5515)},66453:(e,t,n)=>{n.d(t,{D:()=>g});var s=n(72433),r=n(96969),i=n(58095),o=n(15631),a=n(64849),l=n(90360),c=n(74375),h=n(46110),d=n(72208),u=n(48620),f=n(69543);n(62495),n(85019),n(34140);const p="#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform float visibility;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\nfloat getDynamicVisibility(float position) {\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5)==floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n} \nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5); \nfractionPartOfPosition/=differentialLength; \nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI); \nreturn result; \n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2; \nfloat result=isPointOnLine(position,differentialLength);\nfloat dynamicVisibility=getDynamicVisibility(position);\nresult*=dynamicVisibility;\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n#ifdef MAX_LINE \nfloat grid=clamp(max(max(x,y),z),0.,1.);\n#else\nfloat grid=clamp(x+y+z,0.,1.);\n#endif\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\nfloat opacity=1.0;\n#ifdef TRANSPARENT\nopacity=clamp(grid,0.08,gridControl.w*grid);\n#endif \n#ifdef OPACITY\nopacity*=texture2D(opacitySampler,vOpacityUV).a;\n#endif \ngl_FragColor=vec4(color.rgb,opacity*visibility);\n#ifdef TRANSPARENT\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else \n#endif\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";f.v.ShadersStore.gridPixelShader=p;n(4511),n(74255),n(97236),n(97220);const _="precision highp float;\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#include<instancesDeclaration>\nuniform mat4 projection;\nuniform mat4 view;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#include<fogVertex>\nvec4 cameraSpacePosition=view*worldPos;\ngl_Position=projection*cameraSpacePosition;\n#ifdef OPACITY\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\nif (vOpacityInfos.x==0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif \nvPosition=position;\nvNormal=normal;\n#define CUSTOM_VERTEX_MAIN_END\n}";f.v.ShadersStore.gridVertexShader=_;class m extends a.H{constructor(){super(),this.OPACITY=!1,this.TRANSPARENT=!1,this.FOG=!1,this.PREMULTIPLYALPHA=!1,this.MAX_LINE=!1,this.UV1=!1,this.UV2=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}class g extends c.a{constructor(e,t){super(e,t),this.mainColor=o.Wo.Black(),this.lineColor=o.Wo.Teal(),this.gridRatio=1,this.gridOffset=i.P.Zero(),this.majorUnitFrequency=10,this.minorUnitVisibility=.33,this.opacity=1,this.preMultiplyAlpha=!1,this.useMaxLine=!1,this._gridControl=new i.Lt(this.gridRatio,this.majorUnitFrequency,this.minorUnitVisibility,this.opacity)}needAlphaBlending(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()}needAlphaBlendingForMesh(e){return e.visibility<1||this.needAlphaBlending()}isReadyForSubMesh(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady&&t.effect._wasPreviouslyUsingInstances===n)return!0;t.materialDefines||(t.materialDefines=new m);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(s.TRANSPARENT!==this.opacity<1&&(s.TRANSPARENT=!s.TRANSPARENT,s.markAsUnprocessed()),s.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(s.PREMULTIPLYALPHA=!s.PREMULTIPLYALPHA,s.markAsUnprocessed()),s.MAX_LINE!==this.useMaxLine&&(s.MAX_LINE=!s.MAX_LINE,s.markAsUnprocessed()),s._areTexturesDirty&&(s._needUVs=!1,r.texturesEnabled&&this._opacityTexture&&h.k.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;s._needUVs=!0,s.OPACITY=!0}if(l.G.PrepareDefinesForMisc(e,r,!1,!1,this.fogEnabled,!1,s),l.G.PrepareDefinesForFrameBoundValues(r,r.getEngine(),this,s,!!n),s.isDirty){s.markAsProcessed(),r.resetCachedMaterial(),l.G.PrepareDefinesForAttributes(e,s,!1,!1);const n=[d.o.PositionKind,d.o.NormalKind];s.UV1&&n.push(d.o.UVKind),s.UV2&&n.push(d.o.UV2Kind),s.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess,l.G.PrepareAttributesForInstances(n,s);const i=s.toString();t.setEffect(r.getEngine().createEffect("grid",n,["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos","visibility"],["opacitySampler"],i,void 0,this.onCompiled,this.onError),s,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(s._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,t.effect._wasPreviouslyUsingInstances=!!n,!0)}bindForSubMesh(e,t,n){const s=this.getScene(),r=n.materialDefines;if(!r)return;const i=n.effect;i&&(this._activeEffect=i,this._activeEffect.setFloat("visibility",t.visibility),r.INSTANCES&&!r.THIN_INSTANCE||this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("view",s.getViewMatrix()),this._activeEffect.setMatrix("projection",s.getProjectionMatrix()),this._mustRebind(s,i)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&h.k.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),l.G.BindFogParameters(s,t,this._activeEffect),this._afterBind(t,this._activeEffect))}dispose(e){super.dispose(e)}clone(e){return r.p4.Clone((()=>new g(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.GridMaterial",e}getClassName(){return"GridMaterial"}static Parse(e,t,n){return r.p4.Parse((()=>new g(e.name,t)),e,t,n)}}(0,s.gn)([(0,r.n9)()],g.prototype,"mainColor",void 0),(0,s.gn)([(0,r.n9)()],g.prototype,"lineColor",void 0),(0,s.gn)([(0,r.qC)()],g.prototype,"gridRatio",void 0),(0,s.gn)([(0,r.hd)()],g.prototype,"gridOffset",void 0),(0,s.gn)([(0,r.qC)()],g.prototype,"majorUnitFrequency",void 0),(0,s.gn)([(0,r.qC)()],g.prototype,"minorUnitVisibility",void 0),(0,s.gn)([(0,r.qC)()],g.prototype,"opacity",void 0),(0,s.gn)([(0,r.qC)()],g.prototype,"preMultiplyAlpha",void 0),(0,s.gn)([(0,r.qC)()],g.prototype,"useMaxLine",void 0),(0,s.gn)([(0,r.oU)("opacityTexture")],g.prototype,"_opacityTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"opacityTexture",void 0),(0,u.H)("BABYLON.GridMaterial",g)},87813:(e,t,n)=>{n.d(t,{f:()=>y});var s=n(72433),r=n(96969),i=n(58095),o=n(64849),a=n(90360),l=n(74375),c=n(72208),h=n(65273),d=n(48620),u=n(69543);n(67528),n(62495),n(54081),n(37513),n(85019),n(34140);const f="precision highp float;\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform vec3 up;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\nvec3 retColor=curr*whiteScale;\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";u.v.ShadersStore.skyPixelShader=f;n(52974),n(74255),n(95441),n(97220);const p="precision highp float;\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";u.v.ShadersStore.skyVertexShader=p;var _=n(38309),m=n(77633);class g extends o.H{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.rebuild()}}class y extends l.a{constructor(e,t){super(e,t),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new i.P(0,100,0),this.useSunPosition=!1,this.cameraOffset=i.P.Zero(),this.up=i.P.Up(),this.dithering=!1,this._cameraPosition=i.P.Zero(),this._skyOrientation=new i._f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new g);const n=t.materialDefines,s=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(a.G.PrepareDefinesForMisc(e,s,!1,this.pointsCloud,this.fogEnabled,!1,n),a.G.PrepareDefinesForAttributes(e,n,!0,!1),n.IMAGEPROCESSINGPOSTPROCESS!==s.imageProcessingConfiguration.applyByPostProcess&&n.markAsMiscDirty(),n.DITHER!==this.dithering&&n.markAsMiscDirty(),n.isDirty){n.markAsProcessed(),s.resetCachedMaterial();const e=new _.L;n.FOG&&e.addFallback(1,"FOG"),n.IMAGEPROCESSINGPOSTPROCESS=s.imageProcessingConfiguration.applyByPostProcess,n.DITHER=this.dithering;const r=[c.o.PositionKind];n.VERTEXCOLOR&&r.push(c.o.ColorKind);const i="sky",o=["world","viewProjection","view","vFogInfos","vFogColor","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,m.qx)(o);const a=n.toString();t.setEffect(s.getEngine().createEffect(i,r,o,[],a,e,this.onCompiled,this.onError),n,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(n._renderId=s.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)}bindForSubMesh(e,t,n){const s=this.getScene();if(!n.materialDefines)return;const r=n.effect;if(!r)return;this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._mustRebind(s,r)&&((0,m.an)(r,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),s.fogEnabled&&t.applyFog&&s.fogMode!==h.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),a.G.BindFogParameters(s,t,this._activeEffect);const o=s.activeCamera;if(o){const e=o.getWorldMatrix();this._cameraPosition.x=e.m[12],this._cameraPosition.y=e.m[13],this._cameraPosition.z=e.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const e=Math.PI*(this.inclination-.5),t=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(t)*Math.cos(e),this.sunPosition.y=this.distance*Math.sin(-e),this.sunPosition.z=this.distance*Math.sin(t)*Math.cos(e),i._f.FromUnitVectorsToRef(i.P.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect)}getAnimatables(){return[]}dispose(e){super.dispose(e)}clone(e){return r.p4.Clone((()=>new y(e,this.getScene())),this)}serialize(){const e=super.serialize();return e.customType="BABYLON.SkyMaterial",e}getClassName(){return"SkyMaterial"}static Parse(e,t,n){return r.p4.Parse((()=>new y(e.name,t)),e,t,n)}}(0,s.gn)([(0,r.qC)()],y.prototype,"luminance",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"turbidity",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"rayleigh",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"mieCoefficient",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"mieDirectionalG",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"distance",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"inclination",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"azimuth",void 0),(0,s.gn)([(0,r.hd)()],y.prototype,"sunPosition",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"useSunPosition",void 0),(0,s.gn)([(0,r.hd)()],y.prototype,"cameraOffset",void 0),(0,s.gn)([(0,r.hd)()],y.prototype,"up",void 0),(0,s.gn)([(0,r.qC)()],y.prototype,"dithering",void 0),(0,d.H)("BABYLON.SkyMaterial",y)},17724:(e,t,n)=>{n.d(t,{H:()=>w});var s=n(72433),r=n(96969),i=n(58095),o=n(15631),a=n(62464),l=n(34941),c=n(7788),h=n(63784),d=n(64849),u=n(90622),f=n(90360),p=n(74375),_=n(46110),m=n(72208),g=n(65273),y=n(48620),b=n(69543);n(54081),n(69464),n(47157),n(46545),n(46462),n(43921),n(6506),n(67528),n(55371),n(62495),n(37513),n(87954),n(32860),n(85019);const A="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform sampler2D normalSampler;\nuniform vec2 vNormalInfos;\n#endif\nuniform sampler2D refractionSampler;\nuniform sampler2D reflectionSampler;\nconst float LOG2=1.442695;\nuniform vec3 cameraPosition;\nuniform vec4 waterColor;\nuniform float colorBlendFactor;\nuniform vec4 waterColor2;\nuniform float colorBlendFactor2;\nuniform float bumpHeight;\nuniform float time;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvarying vec3 vPosition;\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef BUMP\n#ifdef BUMPSUPERIMPOSE\nbaseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));\n#else\nbaseColor=texture2D(normalSampler,vNormalUV);\n#endif\nvec3 bumpColor=baseColor.rgb;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vNormalInfos.y;\n#else\nvec3 bumpColor=vec3(1.0);\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef NORMAL\nvec2 perturbation=bumpHeight*(baseColor.rg-0.5);\n#ifdef BUMPAFFECTSREFLECTION\nvec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));\nif (normalW.y<0.0) {\nnormalW.y=-normalW.y;\n}\n#else\nvec3 normalW=normalize(vNormalW);\n#endif\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\nvec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);\n#endif\n#ifdef FRESNELSEPARATE\n#ifdef REFLECTION\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vec2(\nvReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,\nvReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y\n),0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);\nfloat IfresnelTerm=1.0-fresnelTerm;\nrefractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;\nreflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;\nbaseColor=combinedColor;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#else \n#ifdef REFLECTION\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=max(dot(viewDirectionW,upVector),0.0);\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);\nbaseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#endif\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#elif defined(IMAGEPROCESSING)\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\ngl_FragColor=color;\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";b.v.ShadersStore.waterPixelShader=A;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035),n(45983);const T="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform mat4 normalMatrix;\nuniform vec2 vNormalInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<logDepthDeclaration>\nuniform mat4 worldReflectionViewProjection;\nuniform vec2 windDirection;\nuniform float waveLength;\nuniform float time;\nuniform float windForce;\nuniform float waveHeight;\nuniform float waveSpeed;\nuniform float waveCount;\nvarying vec3 vPosition;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef BUMP\nif (vNormalInfos.x==0.)\n{\nvNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));\n#endif\n}\nelse\n{\nvNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));\n#endif\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\nfloat finalWaveCount=1.0/(waveCount*0.5);\nvec3 p=position;\nfloat newY=(sin(((p.x/finalWaveCount)+time*waveSpeed))*waveHeight*windDirection.x*5.0)\n+ (cos(((p.z/finalWaveCount)+ time*waveSpeed))*waveHeight*windDirection.y*5.0);\np.y+=abs(newY);\ngl_Position=viewProjection*finalWorld*vec4(p,1.0);\n#ifdef REFLECTION\nworldPos=viewProjection*finalWorld*vec4(p,1.0);\nvPosition=position;\nvRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvRefractionMapTexCoord.z=worldPos.w;\nworldPos=worldReflectionViewProjection*vec4(position,1.0);\nvReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvReflectionMapTexCoord.z=worldPos.w;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";b.v.ShadersStore.waterVertexShader=T;var E=n(38309),v=n(41525),x=n(77633);class O extends d.H{constructor(){super(),this.BUMP=!1,this.REFLECTION=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.INSTANCESCOLOR=!1,this.SPECULARTERM=!1,this.LOGARITHMICDEPTH=!1,this.USE_REVERSE_DEPTHBUFFER=!1,this.FRESNELSEPARATE=!1,this.BUMPSUPERIMPOSE=!1,this.BUMPAFFECTSREFLECTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=!1,this.TONEMAPPING_ACES=!1,this.CONTRAST=!1,this.EXPOSURE=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}class w extends p.a{get hasRenderTargetTextures(){return!0}constructor(e,t,n=new i.FM(512,512)){super(e,t),this.renderTargetSize=n,this.diffuseColor=new o.Wo(1,1,1),this.specularColor=new o.Wo(0,0,0),this.specularPower=64,this._disableLighting=!1,this._maxSimultaneousLights=4,this.windForce=6,this.windDirection=new i.FM(0,1),this.waveHeight=.4,this.bumpHeight=.4,this._bumpSuperimpose=!1,this._fresnelSeparate=!1,this._bumpAffectsReflection=!1,this.waterColor=new o.Wo(.1,.1,.6),this.colorBlendFactor=.2,this.waterColor2=new o.Wo(.1,.1,.6),this.colorBlendFactor2=.2,this.waveLength=.1,this.waveSpeed=1,this.waveCount=20,this.disableClipPlane=!1,this._renderTargets=new c.t(16),this._mesh=null,this._reflectionTransform=i.y3.Zero(),this._lastTime=0,this._lastDeltaTime=0,this._createRenderTargets(this.getScene(),n),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),this._renderTargets.push(this._reflectionRTT),this._renderTargets.push(this._refractionRTT),this._renderTargets),this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()})))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()}get refractionTexture(){return this._refractionRTT}get reflectionTexture(){return this._reflectionRTT}addToRenderList(e){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(e),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(e)}enableRenderTargets(e){const t=e?1:0;this._refractionRTT&&(this._refractionRTT.refreshRate=t),this._reflectionRTT&&(this._reflectionRTT.refreshRate=t)}getRenderList(){return this._refractionRTT?this._refractionRTT.renderList:[]}get renderTargetsEnabled(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady&&t.effect._wasPreviouslyUsingInstances===n)return!0;t.materialDefines||(t.materialDefines=new O);const s=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;const i=r.getEngine();if(s._areTexturesDirty&&(s._needUVs=!1,r.texturesEnabled)){if(this.bumpTexture&&_.k.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;s._needUVs=!0,s.BUMP=!0}_.k.ReflectionTextureEnabled&&(s.REFLECTION=!0)}if(f.G.PrepareDefinesForFrameBoundValues(r,i,this,s,!!n),f.G.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),s),s._areMiscDirty&&(this._fresnelSeparate&&(s.FRESNELSEPARATE=!0),this._bumpSuperimpose&&(s.BUMPSUPERIMPOSE=!0),this._bumpAffectsReflection&&(s.BUMPAFFECTSREFLECTION=!0)),s._needNormals=f.G.PrepareDefinesForLights(r,e,s,!0,this._maxSimultaneousLights,this._disableLighting),s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s),s.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,s.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(f.G.PrepareDefinesForAttributes(e,s,!0,!0),this._mesh=e,this._waitingRenderList){for(let e=0;e<this._waitingRenderList.length;e++)this.addToRenderList(r.getNodeById(this._waitingRenderList[e]));this._waitingRenderList=null}if(s.isDirty){s.markAsProcessed(),r.resetCachedMaterial();const n=new E.L;s.FOG&&n.addFallback(1,"FOG"),s.LOGARITHMICDEPTH&&n.addFallback(0,"LOGARITHMICDEPTH"),f.G.HandleFallbacksForShadows(s,n,this.maxSimultaneousLights),s.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,e);const o=[m.o.PositionKind];s.NORMAL&&o.push(m.o.NormalKind),s.UV1&&o.push(m.o.UVKind),s.UV2&&o.push(m.o.UV2Kind),s.VERTEXCOLOR&&o.push(m.o.ColorKind),f.G.PrepareAttributesForBones(o,e,s,n),f.G.PrepareAttributesForInstances(o,s);const a="water",l=s.toString(),c=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","normalMatrix","logarithmicDepthConstant","worldReflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed","waveCount"],h=["normalSampler","refractionSampler","reflectionSampler"],d=new Array;u.$&&(u.$.PrepareUniforms(c,s),u.$.PrepareSamplers(h,s)),(0,x.qx)(c),f.G.PrepareUniformsAndSamplersList({uniformsNames:c,uniformBuffersNames:d,samplers:h,defines:s,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect(a,{attributes:o,uniformsNames:c,uniformBuffersNames:d,samplers:h,defines:l,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},i),s,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(s._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,t.effect._wasPreviouslyUsingInstances=!!n,!0)}bindForSubMesh(e,t,n){const s=this.getScene(),r=n.materialDefines;if(!r)return;const i=n.effect;if(!i||!this._mesh)return;this._activeEffect=i,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",s.getTransformMatrix()),f.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(s,i)&&(this.bumpTexture&&_.k.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),(0,x.an)(i,this,s),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),s.bindEyePosition(i)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),s.lightsEnabled&&!this.disableLighting&&f.G.BindLights(s,t,this._activeEffect,r,this.maxSimultaneousLights),s.fogEnabled&&t.applyFog&&s.fogMode!==g.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",s.getViewMatrix()),f.G.BindFogParameters(s,t,this._activeEffect),f.G.BindLogDepth(r,this._activeEffect,s),_.k.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));const o=this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(s.getProjectionMatrix()),a=s.getEngine().getDeltaTime();a!==this._lastDeltaTime&&(this._lastDeltaTime=a,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("worldReflectionViewProjection",o),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/1e5),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._activeEffect.setFloat("waveCount",this.waveCount),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect),this._afterBind(t,this._activeEffect)}_createRenderTargets(e,t){let n;this._refractionRTT=new h._(name+"_refraction",{width:t.x,height:t.y},e,!1,!0),this._refractionRTT.wrapU=l.g.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=l.g.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0,this._reflectionRTT=new h._(name+"_reflection",{width:t.x,height:t.y},e,!1,!0),this._reflectionRTT.wrapU=l.g.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=l.g.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;let s,r=null;const o=i.y3.Zero();this._refractionRTT.onBeforeRender=()=>{if(this._mesh&&(n=this._mesh.isVisible,this._mesh.isVisible=!1),!this.disableClipPlane){r=e.clipPlane;const t=this._mesh?this._mesh.absolutePosition.y:0;e.clipPlane=a.J.FromPositionAndNormal(new i.P(0,t+.05,0),new i.P(0,1,0))}},this._refractionRTT.onAfterRender=()=>{this._mesh&&(this._mesh.isVisible=n),this.disableClipPlane||(e.clipPlane=r)},this._reflectionRTT.onBeforeRender=()=>{if(this._mesh&&(n=this._mesh.isVisible,this._mesh.isVisible=!1),!this.disableClipPlane){r=e.clipPlane;const t=this._mesh?this._mesh.absolutePosition.y:0;e.clipPlane=a.J.FromPositionAndNormal(new i.P(0,t-.05,0),new i.P(0,-1,0)),i.y3.ReflectionToRef(e.clipPlane,o)}s=e.getViewMatrix(),o.multiplyToRef(s,this._reflectionTransform),e.setTransformMatrix(this._reflectionTransform,e.getProjectionMatrix()),e._mirroredCameraPosition=i.P.TransformCoordinates(e.activeCamera.position,o)},this._reflectionRTT.onAfterRender=()=>{this._mesh&&(this._mesh.isVisible=n),e.clipPlane=r,e.setTransformMatrix(s,e.getProjectionMatrix()),e._mirroredCameraPosition=null}}getAnimatables(){const e=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&e.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&e.push(this._refractionRTT),e}getActiveTextures(){const e=super.getActiveTextures();return this._bumpTexture&&e.push(this._bumpTexture),e}hasTexture(e){return!!super.hasTexture(e)||this._bumpTexture===e}dispose(e){this.bumpTexture&&this.bumpTexture.dispose();let t=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=t&&this.getScene().customRenderTargets.splice(t,1),t=-1,t=this.getScene().customRenderTargets.indexOf(this._reflectionRTT),-1!=t&&this.getScene().customRenderTargets.splice(t,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e)}clone(e){return r.p4.Clone((()=>new w(e,this.getScene())),this)}serialize(){const e=super.serialize();if(e.customType="BABYLON.WaterMaterial",e.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(let t=0;t<this._refractionRTT.renderList.length;t++)e.renderList.push(this._refractionRTT.renderList[t].id);return e}getClassName(){return"WaterMaterial"}static Parse(e,t,n){const s=r.p4.Parse((()=>new w(e.name,t)),e,t,n);return s._waitingRenderList=e.renderList,s}static CreateDefaultMesh(e,t){return(0,v.$6)(e,{width:512,height:512,subdivisions:32,updatable:!1},t)}}(0,s.gn)([(0,r.oU)("bumpTexture")],w.prototype,"_bumpTexture",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"bumpTexture",void 0),(0,s.gn)([(0,r.n9)()],w.prototype,"diffuseColor",void 0),(0,s.gn)([(0,r.n9)()],w.prototype,"specularColor",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"specularPower",void 0),(0,s.gn)([(0,r.qC)("disableLighting")],w.prototype,"_disableLighting",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],w.prototype,"disableLighting",void 0),(0,s.gn)([(0,r.qC)("maxSimultaneousLights")],w.prototype,"_maxSimultaneousLights",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],w.prototype,"maxSimultaneousLights",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"windForce",void 0),(0,s.gn)([(0,r.QC)()],w.prototype,"windDirection",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"waveHeight",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"bumpHeight",void 0),(0,s.gn)([(0,r.qC)("bumpSuperimpose")],w.prototype,"_bumpSuperimpose",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],w.prototype,"bumpSuperimpose",void 0),(0,s.gn)([(0,r.qC)("fresnelSeparate")],w.prototype,"_fresnelSeparate",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],w.prototype,"fresnelSeparate",void 0),(0,s.gn)([(0,r.qC)("bumpAffectsReflection")],w.prototype,"_bumpAffectsReflection",void 0),(0,s.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],w.prototype,"bumpAffectsReflection",void 0),(0,s.gn)([(0,r.n9)()],w.prototype,"waterColor",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"colorBlendFactor",void 0),(0,s.gn)([(0,r.n9)()],w.prototype,"waterColor2",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"colorBlendFactor2",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"waveLength",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"waveSpeed",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"waveCount",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"disableClipPlane",void 0),(0,s.gn)([(0,r.qC)()],w.prototype,"useLogarithmicDepth",null),(0,y.H)("BABYLON.WaterMaterial",w)}}]);