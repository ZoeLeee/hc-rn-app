{"version":3,"file":"js/vender~b7062d65.5ce52e0a.js","mappings":"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","sources":["webpack:///../../../node_modules/@babylonjs/core/Engines/nativeEngine.js","webpack:///../../../node_modules/@babylonjs/core/Engines/performanceConfigurator.js","webpack:///../../../node_modules/@babylonjs/core/Engines/renderTargetWrapper.js","webpack:///../../../node_modules/@babylonjs/core/Engines/shaderStore.js","webpack:///../../../node_modules/@babylonjs/core/Engines/thinEngine.js","webpack:///../../../node_modules/@babylonjs/core/Engines/webgpuEngine.js","webpack:///../../../node_modules/@babylonjs/core/Events/clipboardEvents.js","webpack:///../../../node_modules/@babylonjs/core/Events/deviceInputEvents.js","webpack:///../../../node_modules/@babylonjs/core/Events/keyboardEvents.js","webpack:///../../../node_modules/@babylonjs/core/Events/pointerEvents.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/poseEnabledController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/webVRController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/dualShockGamepad.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/gamepad.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/gamepadManager.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/gamepadSceneComponent.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/daydreamController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/gearVRController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/genericController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/oculusTouchController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/viveController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/Controllers/windowsMotionController.js","webpack:///../../../node_modules/@babylonjs/core/Gamepads/xboxGamepad.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/axisDragGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/axisScaleGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/boundingBoxGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/gizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/lightGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/cameraGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/planeDragGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/planeRotationGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/positionGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/rotationGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Gizmos/scaleGizmo.js","webpack:///../../../node_modules/@babylonjs/core/Helpers/environmentHelper.js","webpack:///../../../node_modules/@babylonjs/core/Helpers/textureDome.js","webpack:///../../../node_modules/@babylonjs/core/Helpers/photoDome.js","webpack:///../../../node_modules/@babylonjs/core/Helpers/videoDome.js","webpack:///../../../node_modules/@babylonjs/core/Helpers/sceneHelpers.js","webpack:///../../../node_modules/@babylonjs/core/Inputs/scene.inputManager.js","webpack:///../../../node_modules/@babylonjs/core/Instrumentation/timeToken.js","webpack:///../../../node_modules/@babylonjs/core/Layers/effectLayer.js","webpack:///../../../node_modules/@babylonjs/core/Layers/effectLayerSceneComponent.js","webpack:///../../../node_modules/@babylonjs/core/Layers/glowLayer.js","webpack:///../../../node_modules/@babylonjs/core/Layers/highlightLayer.js","webpack:///../../../node_modules/@babylonjs/core/Layers/layer.js","webpack:///../../../node_modules/@babylonjs/core/Layers/layerSceneComponent.js"],"sourcesContent":["import { Engine } from \"../Engines/engine.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { DataBuffer } from \"../Buffers/dataBuffer.js\";\nimport { Tools } from \"../Misc/tools.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { CreateImageDataArrayBufferViews, GetEnvInfo, UploadEnvSpherical } from \"../Misc/environmentTextureTools.js\";\nimport { Logger } from \"../Misc/logger.js\";\n\nimport { ThinEngine } from \"./thinEngine.js\";\nimport { EngineStore } from \"./engineStore.js\";\nimport { ShaderCodeInliner } from \"./Processors/shaderCodeInliner.js\";\nimport { WebGL2ShaderProcessor } from \"../Engines/WebGL/webGL2ShaderProcessors.js\";\nimport { NativeDataStream } from \"./Native/nativeDataStream.js\";\nimport { RuntimeError, ErrorCodes } from \"../Misc/error.js\";\nimport { NativePipelineContext } from \"./Native/nativePipelineContext.js\";\nimport { NativeRenderTargetWrapper } from \"./Native/nativeRenderTargetWrapper.js\";\nimport { NativeHardwareTexture } from \"./Native/nativeHardwareTexture.js\";\nconst onNativeObjectInitialized = new Observable();\nif (typeof self !== \"undefined\" && !Object.prototype.hasOwnProperty.call(self, \"_native\")) {\n    let __native;\n    Object.defineProperty(self, \"_native\", {\n        get: () => __native,\n        set: (value) => {\n            __native = value;\n            if (__native) {\n                onNativeObjectInitialized.notifyObservers(__native);\n            }\n        },\n    });\n}\n/**\n * Returns _native only after it has been defined by BabylonNative.\n * @internal\n */\nexport function AcquireNativeObjectAsync() {\n    return new Promise((resolve) => {\n        if (typeof _native === \"undefined\") {\n            onNativeObjectInitialized.addOnce((nativeObject) => resolve(nativeObject));\n        }\n        else {\n            resolve(_native);\n        }\n    });\n}\n/**\n * Registers a constructor on the _native object. See NativeXRFrame for an example.\n * @internal\n */\nexport async function RegisterNativeTypeAsync(typeName, constructor) {\n    (await AcquireNativeObjectAsync())[typeName] = constructor;\n}\n/**\n * Container for accessors for natively-stored mesh data buffers.\n */\nclass NativeDataBuffer extends DataBuffer {\n}\n/** @internal */\nclass CommandBufferEncoder {\n    constructor(_engine) {\n        this._engine = _engine;\n        this._pending = new Array();\n        this._isCommandBufferScopeActive = false;\n        this._commandStream = NativeEngine._createNativeDataStream();\n        this._engine.setCommandDataStream(this._commandStream);\n    }\n    beginCommandScope() {\n        if (this._isCommandBufferScopeActive) {\n            throw new Error(\"Command scope already active.\");\n        }\n        this._isCommandBufferScopeActive = true;\n    }\n    endCommandScope() {\n        if (!this._isCommandBufferScopeActive) {\n            throw new Error(\"Command scope is not active.\");\n        }\n        this._isCommandBufferScopeActive = false;\n        this._submit();\n    }\n    startEncodingCommand(command) {\n        this._commandStream.writeNativeData(command);\n    }\n    encodeCommandArgAsUInt32(commandArg) {\n        this._commandStream.writeUint32(commandArg);\n    }\n    encodeCommandArgAsUInt32s(commandArg) {\n        this._commandStream.writeUint32Array(commandArg);\n    }\n    encodeCommandArgAsInt32(commandArg) {\n        this._commandStream.writeInt32(commandArg);\n    }\n    encodeCommandArgAsInt32s(commandArg) {\n        this._commandStream.writeInt32Array(commandArg);\n    }\n    encodeCommandArgAsFloat32(commandArg) {\n        this._commandStream.writeFloat32(commandArg);\n    }\n    encodeCommandArgAsFloat32s(commandArg) {\n        this._commandStream.writeFloat32Array(commandArg);\n    }\n    encodeCommandArgAsNativeData(commandArg) {\n        this._commandStream.writeNativeData(commandArg);\n        this._pending.push(commandArg);\n    }\n    finishEncodingCommand() {\n        if (!this._isCommandBufferScopeActive) {\n            this._submit();\n        }\n    }\n    _submit() {\n        this._engine.submitCommands();\n        this._pending.length = 0;\n    }\n}\n/** @internal */\nexport class NativeEngine extends Engine {\n    getHardwareScalingLevel() {\n        return this._engine.getHardwareScalingLevel();\n    }\n    setHardwareScalingLevel(level) {\n        this._engine.setHardwareScalingLevel(level);\n    }\n    constructor(options = {}) {\n        super(null, false, undefined, options.adaptToDeviceRatio);\n        this._engine = new _native.Engine();\n        this._camera = _native.Camera ? new _native.Camera() : null;\n        this._commandBufferEncoder = new CommandBufferEncoder(this._engine);\n        this._boundBuffersVertexArray = null;\n        this._currentDepthTest = _native.Engine.DEPTH_TEST_LEQUAL;\n        this._stencilTest = false;\n        this._stencilMask = 255;\n        this._stencilFunc = 519;\n        this._stencilFuncRef = 0;\n        this._stencilFuncMask = 255;\n        this._stencilOpStencilFail = 7680;\n        this._stencilOpDepthFail = 7680;\n        this._stencilOpStencilDepthPass = 7681;\n        this._zOffset = 0;\n        this._zOffsetUnits = 0;\n        this._depthWrite = true;\n        if (_native.Engine.PROTOCOL_VERSION !== NativeEngine.PROTOCOL_VERSION) {\n            throw new Error(`Protocol version mismatch: ${_native.Engine.PROTOCOL_VERSION} (Native) !== ${NativeEngine.PROTOCOL_VERSION} (JS)`);\n        }\n        this._webGLVersion = 2;\n        this.disableUniformBuffers = true;\n        this._shaderPlatformName = \"NATIVE\";\n        // TODO: Initialize this more correctly based on the hardware capabilities.\n        // Init caps\n        this._caps = {\n            maxTexturesImageUnits: 16,\n            maxVertexTextureImageUnits: 16,\n            maxCombinedTexturesImageUnits: 32,\n            maxTextureSize: _native.Engine.CAPS_LIMITS_MAX_TEXTURE_SIZE,\n            maxCubemapTextureSize: 512,\n            maxRenderTextureSize: 512,\n            maxVertexAttribs: 16,\n            maxVaryingVectors: 16,\n            maxFragmentUniformVectors: 16,\n            maxVertexUniformVectors: 16,\n            standardDerivatives: true,\n            astc: null,\n            pvrtc: null,\n            etc1: null,\n            etc2: null,\n            bptc: null,\n            maxAnisotropy: 16,\n            uintIndices: true,\n            fragmentDepthSupported: false,\n            highPrecisionShaderSupported: true,\n            colorBufferFloat: false,\n            textureFloat: true,\n            textureFloatLinearFiltering: false,\n            textureFloatRender: false,\n            textureHalfFloat: false,\n            textureHalfFloatLinearFiltering: false,\n            textureHalfFloatRender: false,\n            textureLOD: true,\n            drawBuffersExtension: false,\n            depthTextureExtension: false,\n            vertexArrayObject: true,\n            instancedArrays: true,\n            supportOcclusionQuery: false,\n            canUseTimestampForTimerQuery: false,\n            blendMinMax: false,\n            maxMSAASamples: 1,\n            canUseGLInstanceID: true,\n            canUseGLVertexID: true,\n            supportComputeShaders: false,\n            supportSRGBBuffers: true,\n            supportTransformFeedbacks: false,\n            textureMaxLevel: false,\n            texture2DArrayMaxLayerCount: _native.Engine.CAPS_LIMITS_MAX_TEXTURE_LAYERS,\n        };\n        this._features = {\n            forceBitmapOverHTMLImageElement: false,\n            supportRenderAndCopyToLodForFloatTextures: false,\n            supportDepthStencilTexture: false,\n            supportShadowSamplers: false,\n            uniformBufferHardCheckMatrix: false,\n            allowTexturePrefiltering: false,\n            trackUbosInFrame: false,\n            checkUbosContentBeforeUpload: false,\n            supportCSM: false,\n            basisNeedsPOT: false,\n            support3DTextures: false,\n            needTypeSuffixInShaderConstants: false,\n            supportMSAA: false,\n            supportSSAO2: false,\n            supportExtendedTextureFormats: false,\n            supportSwitchCaseInShader: false,\n            supportSyncTextureRead: false,\n            needsInvertingBitmap: true,\n            useUBOBindingCache: true,\n            needShaderCodeInlining: true,\n            needToAlwaysBindUniformBuffers: false,\n            supportRenderPasses: true,\n            supportSpriteInstancing: false,\n            _collectUbosUpdatedInFrame: false,\n        };\n        Tools.Log(\"Babylon Native (v\" + Engine.Version + \") launched\");\n        Tools.LoadScript = function (scriptUrl, onSuccess, onError, scriptId) {\n            Tools.LoadFile(scriptUrl, (data) => {\n                Function(data).apply(null);\n                if (onSuccess) {\n                    onSuccess();\n                }\n            }, undefined, undefined, false, (request, exception) => {\n                if (onError) {\n                    onError(\"LoadScript Error\", exception);\n                }\n            });\n        };\n        // Wrappers\n        if (typeof URL === \"undefined\") {\n            window.URL = {\n                createObjectURL: function () { },\n                revokeObjectURL: function () { },\n            };\n        }\n        if (typeof Blob === \"undefined\") {\n            window.Blob = function (v) {\n                return v;\n            };\n        }\n        // polyfill for Chakra\n        if (!Array.prototype.flat) {\n            Object.defineProperty(Array.prototype, \"flat\", {\n                configurable: true,\n                value: function flat() {\n                    const depth = isNaN(arguments[0]) ? 1 : Number(arguments[0]);\n                    return depth\n                        ? Array.prototype.reduce.call(this, function (acc, cur) {\n                            if (Array.isArray(cur)) {\n                                acc.push.apply(acc, flat.call(cur, depth - 1));\n                            }\n                            else {\n                                acc.push(cur);\n                            }\n                            return acc;\n                        }, [])\n                        : Array.prototype.slice.call(this);\n                },\n                writable: true,\n            });\n        }\n        // Currently we do not fully configure the ThinEngine on construction of NativeEngine.\n        // Setup resolution scaling based on display settings.\n        const devicePixelRatio = window ? window.devicePixelRatio || 1.0 : 1.0;\n        this._hardwareScalingLevel = options.adaptToDeviceRatio ? devicePixelRatio : 1.0;\n        this.resize();\n        const currentDepthFunction = this.getDepthFunction();\n        if (currentDepthFunction) {\n            this.setDepthFunction(currentDepthFunction);\n        }\n        // Shader processor\n        this._shaderProcessor = new WebGL2ShaderProcessor();\n        this.onNewSceneAddedObservable.add((scene) => {\n            const originalRender = scene.render;\n            scene.render = (...args) => {\n                this._commandBufferEncoder.beginCommandScope();\n                originalRender.apply(scene, args);\n                this._commandBufferEncoder.endCommandScope();\n            };\n        });\n    }\n    dispose() {\n        super.dispose();\n        if (this._boundBuffersVertexArray) {\n            this._deleteVertexArray(this._boundBuffersVertexArray);\n        }\n        this._engine.dispose();\n    }\n    /** @internal */\n    static _createNativeDataStream() {\n        return new NativeDataStream();\n    }\n    /**\n     * Can be used to override the current requestAnimationFrame requester.\n     * @internal\n     */\n    _queueNewFrame(bindedRenderFunction, requester) {\n        // Use the provided requestAnimationFrame, unless the requester is the window. In that case, we will default to the Babylon Native version of requestAnimationFrame.\n        if (requester.requestAnimationFrame && requester !== window) {\n            requester.requestAnimationFrame(bindedRenderFunction);\n        }\n        else {\n            this._engine.requestAnimationFrame(bindedRenderFunction);\n        }\n        return 0;\n    }\n    /**\n     * Override default engine behavior.\n     * @param framebuffer\n     */\n    _bindUnboundFramebuffer(framebuffer) {\n        if (this._currentFramebuffer !== framebuffer) {\n            if (this._currentFramebuffer) {\n                this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_UNBINDFRAMEBUFFER);\n                this._commandBufferEncoder.encodeCommandArgAsNativeData(this._currentFramebuffer);\n                this._commandBufferEncoder.finishEncodingCommand();\n            }\n            if (framebuffer) {\n                this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_BINDFRAMEBUFFER);\n                this._commandBufferEncoder.encodeCommandArgAsNativeData(framebuffer);\n                this._commandBufferEncoder.finishEncodingCommand();\n            }\n            this._currentFramebuffer = framebuffer;\n        }\n    }\n    /**\n     * Gets host document\n     * @returns the host document object\n     */\n    getHostDocument() {\n        return null;\n    }\n    clear(color, backBuffer, depth, stencil = false) {\n        if (this.useReverseDepthBuffer) {\n            throw new Error(\"reverse depth buffer is not currently implemented\");\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_CLEAR);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(backBuffer && color ? 1 : 0);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(color ? color.r : 0);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(color ? color.g : 0);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(color ? color.b : 0);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(color ? color.a : 1);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(depth ? 1 : 0);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(1);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(stencil ? 1 : 0);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(0);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    createIndexBuffer(indices, updateable) {\n        const data = this._normalizeIndexData(indices);\n        const buffer = new NativeDataBuffer();\n        buffer.references = 1;\n        buffer.is32Bits = data.BYTES_PER_ELEMENT === 4;\n        if (data.byteLength) {\n            buffer.nativeIndexBuffer = this._engine.createIndexBuffer(data.buffer, data.byteOffset, data.byteLength, buffer.is32Bits, updateable !== null && updateable !== void 0 ? updateable : false);\n        }\n        return buffer;\n    }\n    createVertexBuffer(vertices, updateable) {\n        const data = ArrayBuffer.isView(vertices) ? vertices : new Float32Array(vertices);\n        const buffer = new NativeDataBuffer();\n        buffer.references = 1;\n        if (data.byteLength) {\n            buffer.nativeVertexBuffer = this._engine.createVertexBuffer(data.buffer, data.byteOffset, data.byteLength, updateable !== null && updateable !== void 0 ? updateable : false);\n        }\n        return buffer;\n    }\n    _recordVertexArrayObject(vertexArray, vertexBuffers, indexBuffer, effect, overrideVertexBuffers) {\n        if (indexBuffer) {\n            this._engine.recordIndexBuffer(vertexArray, indexBuffer.nativeIndexBuffer);\n        }\n        const attributes = effect.getAttributesNames();\n        for (let index = 0; index < attributes.length; index++) {\n            const location = effect.getAttributeLocation(index);\n            if (location >= 0) {\n                const kind = attributes[index];\n                let vertexBuffer = null;\n                if (overrideVertexBuffers) {\n                    vertexBuffer = overrideVertexBuffers[kind];\n                }\n                if (!vertexBuffer) {\n                    vertexBuffer = vertexBuffers[kind];\n                }\n                if (vertexBuffer) {\n                    const buffer = vertexBuffer.getBuffer();\n                    if (buffer && buffer.nativeVertexBuffer) {\n                        this._engine.recordVertexBuffer(vertexArray, buffer.nativeVertexBuffer, location, vertexBuffer.byteOffset, vertexBuffer.byteStride, vertexBuffer.getSize(), this._getNativeAttribType(vertexBuffer.type), vertexBuffer.normalized, vertexBuffer.getInstanceDivisor());\n                    }\n                }\n            }\n        }\n    }\n    bindBuffers(vertexBuffers, indexBuffer, effect) {\n        if (this._boundBuffersVertexArray) {\n            this._deleteVertexArray(this._boundBuffersVertexArray);\n        }\n        this._boundBuffersVertexArray = this._engine.createVertexArray();\n        this._recordVertexArrayObject(this._boundBuffersVertexArray, vertexBuffers, indexBuffer, effect);\n        this.bindVertexArrayObject(this._boundBuffersVertexArray);\n    }\n    recordVertexArrayObject(vertexBuffers, indexBuffer, effect, overrideVertexBuffers) {\n        const vertexArray = this._engine.createVertexArray();\n        this._recordVertexArrayObject(vertexArray, vertexBuffers, indexBuffer, effect, overrideVertexBuffers);\n        return vertexArray;\n    }\n    _deleteVertexArray(vertexArray) {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEVERTEXARRAY);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(vertexArray);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    bindVertexArrayObject(vertexArray) {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_BINDVERTEXARRAY);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(vertexArray);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    releaseVertexArrayObject(vertexArray) {\n        this._deleteVertexArray(vertexArray);\n    }\n    getAttributes(pipelineContext, attributesNames) {\n        const nativePipelineContext = pipelineContext;\n        return this._engine.getAttributes(nativePipelineContext.nativeProgram, attributesNames);\n    }\n    /**\n     * Draw a list of indexed primitives\n     * @param fillMode defines the primitive to use\n     * @param indexStart defines the starting index\n     * @param indexCount defines the number of index to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawElementsType(fillMode, indexStart, indexCount, instancesCount) {\n        // Apply states\n        this._drawCalls.addCount(1, false);\n        // TODO: Make this implementation more robust like core Engine version.\n        // Render\n        //var indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\n        //var mult = this._uintIndicesCurrentlySet ? 4 : 2;\n        // if (instancesCount) {\n        //     this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\n        // } else {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DRAWINDEXED);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(fillMode);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(indexStart);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(indexCount);\n        this._commandBufferEncoder.finishEncodingCommand();\n        // }\n    }\n    /**\n     * Draw a list of unindexed primitives\n     * @param fillMode defines the primitive to use\n     * @param verticesStart defines the index of first vertex to draw\n     * @param verticesCount defines the count of vertices to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawArraysType(fillMode, verticesStart, verticesCount, instancesCount) {\n        // Apply states\n        this._drawCalls.addCount(1, false);\n        // TODO: Make this implementation more robust like core Engine version.\n        // if (instancesCount) {\n        //     this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\n        // } else {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DRAW);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(fillMode);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(verticesStart);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(verticesCount);\n        this._commandBufferEncoder.finishEncodingCommand();\n        // }\n    }\n    createPipelineContext() {\n        return new NativePipelineContext(this);\n    }\n    createMaterialContext() {\n        return undefined;\n    }\n    createDrawContext() {\n        return undefined;\n    }\n    _preparePipelineContext(pipelineContext, vertexSourceCode, fragmentSourceCode, createAsRaw, _rawVertexSourceCode, _rawFragmentSourceCode, _rebuildRebind, defines) {\n        const nativePipelineContext = pipelineContext;\n        if (createAsRaw) {\n            nativePipelineContext.nativeProgram = this.createRawShaderProgram();\n        }\n        else {\n            nativePipelineContext.nativeProgram = this.createShaderProgram(pipelineContext, vertexSourceCode, fragmentSourceCode, defines);\n        }\n    }\n    /**\n     * @internal\n     */\n    _isRenderingStateCompiled(pipelineContext) {\n        // TODO: support async shader compilcation\n        return true;\n    }\n    /**\n     * @internal\n     */\n    _executeWhenRenderingStateIsCompiled(pipelineContext, action) {\n        // TODO: support async shader compilcation\n        action();\n    }\n    createRawShaderProgram() {\n        throw new Error(\"Not Supported\");\n    }\n    createShaderProgram(_pipelineContext, vertexCode, fragmentCode, defines) {\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\n        const vertexInliner = new ShaderCodeInliner(vertexCode);\n        vertexInliner.processCode();\n        vertexCode = vertexInliner.code;\n        const fragmentInliner = new ShaderCodeInliner(fragmentCode);\n        fragmentInliner.processCode();\n        fragmentCode = fragmentInliner.code;\n        vertexCode = ThinEngine._ConcatenateShader(vertexCode, defines);\n        fragmentCode = ThinEngine._ConcatenateShader(fragmentCode, defines);\n        const program = this._engine.createProgram(vertexCode, fragmentCode);\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\n        return program;\n    }\n    /**\n     * Inline functions in shader code that are marked to be inlined\n     * @param code code to inline\n     * @returns inlined code\n     */\n    inlineShaderCode(code) {\n        const sci = new ShaderCodeInliner(code);\n        sci.debug = false;\n        sci.processCode();\n        return sci.code;\n    }\n    _setProgram(program) {\n        if (this._currentProgram !== program) {\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETPROGRAM);\n            this._commandBufferEncoder.encodeCommandArgAsNativeData(program);\n            this._commandBufferEncoder.finishEncodingCommand();\n            this._currentProgram = program;\n        }\n    }\n    _deletePipelineContext(pipelineContext) {\n        const nativePipelineContext = pipelineContext;\n        if (nativePipelineContext && nativePipelineContext.nativeProgram) {\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEPROGRAM);\n            this._commandBufferEncoder.encodeCommandArgAsNativeData(nativePipelineContext.nativeProgram);\n            this._commandBufferEncoder.finishEncodingCommand();\n        }\n    }\n    getUniforms(pipelineContext, uniformsNames) {\n        const nativePipelineContext = pipelineContext;\n        return this._engine.getUniforms(nativePipelineContext.nativeProgram, uniformsNames);\n    }\n    bindUniformBlock(pipelineContext, blockName, index) {\n        // TODO\n        throw new Error(\"Not Implemented\");\n    }\n    bindSamplers(effect) {\n        const nativePipelineContext = effect.getPipelineContext();\n        this._setProgram(nativePipelineContext.nativeProgram);\n        // TODO: share this with engine?\n        const samplers = effect.getSamplers();\n        for (let index = 0; index < samplers.length; index++) {\n            const uniform = effect.getUniform(samplers[index]);\n            if (uniform) {\n                this._boundUniforms[index] = uniform;\n            }\n        }\n        this._currentEffect = null;\n    }\n    getRenderWidth(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.width;\n        }\n        return this._engine.getRenderWidth();\n    }\n    getRenderHeight(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.height;\n        }\n        return this._engine.getRenderHeight();\n    }\n    setViewport(viewport, requiredWidth, requiredHeight) {\n        this._cachedViewport = viewport;\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETVIEWPORT);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(viewport.x);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(viewport.y);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(viewport.width);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(viewport.height);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    setState(culling, zOffset = 0, force, reverseSide = false, cullBackFaces, stencil, zOffsetUnits = 0) {\n        var _a, _b;\n        this._zOffset = zOffset;\n        this._zOffsetUnits = zOffsetUnits;\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETSTATE);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(culling ? 1 : 0);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(zOffset);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(zOffsetUnits);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(((_b = (_a = this.cullBackFaces) !== null && _a !== void 0 ? _a : cullBackFaces) !== null && _b !== void 0 ? _b : true) ? 1 : 0);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(reverseSide ? 1 : 0);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    /**\n     * Gets the client rect of native canvas.  Needed for InputManager.\n     * @returns a client rectangle\n     */\n    getInputElementClientRect() {\n        const rect = {\n            bottom: this.getRenderHeight(),\n            height: this.getRenderHeight(),\n            left: 0,\n            right: this.getRenderWidth(),\n            top: 0,\n            width: this.getRenderWidth(),\n            x: 0,\n            y: 0,\n            toJSON: () => { },\n        };\n        return rect;\n    }\n    /**\n     * Set the z offset Factor to apply to current rendering\n     * @param value defines the offset to apply\n     */\n    setZOffset(value) {\n        if (value !== this._zOffset) {\n            this._zOffset = value;\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETZOFFSET);\n            this._commandBufferEncoder.encodeCommandArgAsFloat32(this.useReverseDepthBuffer ? -value : value);\n            this._commandBufferEncoder.finishEncodingCommand();\n        }\n    }\n    /**\n     * Gets the current value of the zOffset Factor\n     * @returns the current zOffset Factor state\n     */\n    getZOffset() {\n        return this._zOffset;\n    }\n    /**\n     * Set the z offset Units to apply to current rendering\n     * @param value defines the offset to apply\n     */\n    setZOffsetUnits(value) {\n        if (value !== this._zOffsetUnits) {\n            this._zOffsetUnits = value;\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETZOFFSETUNITS);\n            this._commandBufferEncoder.encodeCommandArgAsFloat32(this.useReverseDepthBuffer ? -value : value);\n            this._commandBufferEncoder.finishEncodingCommand();\n        }\n    }\n    /**\n     * Gets the current value of the zOffset Units\n     * @returns the current zOffset Units state\n     */\n    getZOffsetUnits() {\n        return this._zOffsetUnits;\n    }\n    /**\n     * Enable or disable depth buffering\n     * @param enable defines the state to set\n     */\n    setDepthBuffer(enable) {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETDEPTHTEST);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(enable ? this._currentDepthTest : _native.Engine.DEPTH_TEST_ALWAYS);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    /**\n     * Gets a boolean indicating if depth writing is enabled\n     * @returns the current depth writing state\n     */\n    getDepthWrite() {\n        return this._depthWrite;\n    }\n    getDepthFunction() {\n        switch (this._currentDepthTest) {\n            case _native.Engine.DEPTH_TEST_NEVER:\n                return 512;\n            case _native.Engine.DEPTH_TEST_ALWAYS:\n                return 519;\n            case _native.Engine.DEPTH_TEST_GREATER:\n                return 516;\n            case _native.Engine.DEPTH_TEST_GEQUAL:\n                return 518;\n            case _native.Engine.DEPTH_TEST_NOTEQUAL:\n                return 517;\n            case _native.Engine.DEPTH_TEST_EQUAL:\n                return 514;\n            case _native.Engine.DEPTH_TEST_LESS:\n                return 513;\n            case _native.Engine.DEPTH_TEST_LEQUAL:\n                return 515;\n        }\n        return null;\n    }\n    setDepthFunction(depthFunc) {\n        let nativeDepthFunc = 0;\n        switch (depthFunc) {\n            case 512:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_NEVER;\n                break;\n            case 519:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_ALWAYS;\n                break;\n            case 516:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_GREATER;\n                break;\n            case 518:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_GEQUAL;\n                break;\n            case 517:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_NOTEQUAL;\n                break;\n            case 514:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_EQUAL;\n                break;\n            case 513:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_LESS;\n                break;\n            case 515:\n                nativeDepthFunc = _native.Engine.DEPTH_TEST_LEQUAL;\n                break;\n        }\n        this._currentDepthTest = nativeDepthFunc;\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETDEPTHTEST);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(this._currentDepthTest);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    /**\n     * Enable or disable depth writing\n     * @param enable defines the state to set\n     */\n    setDepthWrite(enable) {\n        this._depthWrite = enable;\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETDEPTHWRITE);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(Number(enable));\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    /**\n     * Enable or disable color writing\n     * @param enable defines the state to set\n     */\n    setColorWrite(enable) {\n        this._colorWrite = enable;\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETCOLORWRITE);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(Number(enable));\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    /**\n     * Gets a boolean indicating if color writing is enabled\n     * @returns the current color writing state\n     */\n    getColorWrite() {\n        return this._colorWrite;\n    }\n    applyStencil() {\n        this._setStencil(this._stencilMask, this._getStencilOpFail(this._stencilOpStencilFail), this._getStencilDepthFail(this._stencilOpDepthFail), this._getStencilDepthPass(this._stencilOpStencilDepthPass), this._getStencilFunc(this._stencilFunc), this._stencilFuncRef);\n    }\n    _setStencil(mask, stencilOpFail, depthOpFail, depthOpPass, func, ref) {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETSTENCIL);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(mask);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(stencilOpFail);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(depthOpFail);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(depthOpPass);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(func);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(ref);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    /**\n     * Enable or disable the stencil buffer\n     * @param enable defines if the stencil buffer must be enabled or disabled\n     */\n    setStencilBuffer(enable) {\n        this._stencilTest = enable;\n        if (enable) {\n            this.applyStencil();\n        }\n        else {\n            this._setStencil(255, _native.Engine.STENCIL_OP_FAIL_S_KEEP, _native.Engine.STENCIL_OP_FAIL_Z_KEEP, _native.Engine.STENCIL_OP_PASS_Z_KEEP, _native.Engine.STENCIL_TEST_ALWAYS, 0);\n        }\n    }\n    /**\n     * Gets a boolean indicating if stencil buffer is enabled\n     * @returns the current stencil buffer state\n     */\n    getStencilBuffer() {\n        return this._stencilTest;\n    }\n    /**\n     * Gets the current stencil operation when stencil passes\n     * @returns a number defining stencil operation to use when stencil passes\n     */\n    getStencilOperationPass() {\n        return this._stencilOpStencilDepthPass;\n    }\n    /**\n     * Sets the stencil operation to use when stencil passes\n     * @param operation defines the stencil operation to use when stencil passes\n     */\n    setStencilOperationPass(operation) {\n        this._stencilOpStencilDepthPass = operation;\n        this.applyStencil();\n    }\n    /**\n     * Sets the current stencil mask\n     * @param mask defines the new stencil mask to use\n     */\n    setStencilMask(mask) {\n        this._stencilMask = mask;\n        this.applyStencil();\n    }\n    /**\n     * Sets the current stencil function\n     * @param stencilFunc defines the new stencil function to use\n     */\n    setStencilFunction(stencilFunc) {\n        this._stencilFunc = stencilFunc;\n        this.applyStencil();\n    }\n    /**\n     * Sets the current stencil reference\n     * @param reference defines the new stencil reference to use\n     */\n    setStencilFunctionReference(reference) {\n        this._stencilFuncRef = reference;\n        this.applyStencil();\n    }\n    /**\n     * Sets the current stencil mask\n     * @param mask defines the new stencil mask to use\n     */\n    setStencilFunctionMask(mask) {\n        this._stencilFuncMask = mask;\n    }\n    /**\n     * Sets the stencil operation to use when stencil fails\n     * @param operation defines the stencil operation to use when stencil fails\n     */\n    setStencilOperationFail(operation) {\n        this._stencilOpStencilFail = operation;\n        this.applyStencil();\n    }\n    /**\n     * Sets the stencil operation to use when depth fails\n     * @param operation defines the stencil operation to use when depth fails\n     */\n    setStencilOperationDepthFail(operation) {\n        this._stencilOpDepthFail = operation;\n        this.applyStencil();\n    }\n    /**\n     * Gets the current stencil mask\n     * @returns a number defining the new stencil mask to use\n     */\n    getStencilMask() {\n        return this._stencilMask;\n    }\n    /**\n     * Gets the current stencil function\n     * @returns a number defining the stencil function to use\n     */\n    getStencilFunction() {\n        return this._stencilFunc;\n    }\n    /**\n     * Gets the current stencil reference value\n     * @returns a number defining the stencil reference value to use\n     */\n    getStencilFunctionReference() {\n        return this._stencilFuncRef;\n    }\n    /**\n     * Gets the current stencil mask\n     * @returns a number defining the stencil mask to use\n     */\n    getStencilFunctionMask() {\n        return this._stencilFuncMask;\n    }\n    /**\n     * Gets the current stencil operation when stencil fails\n     * @returns a number defining stencil operation to use when stencil fails\n     */\n    getStencilOperationFail() {\n        return this._stencilOpStencilFail;\n    }\n    /**\n     * Gets the current stencil operation when depth fails\n     * @returns a number defining stencil operation to use when depth fails\n     */\n    getStencilOperationDepthFail() {\n        return this._stencilOpDepthFail;\n    }\n    /**\n     * Sets alpha constants used by some alpha blending modes\n     * @param r defines the red component\n     * @param g defines the green component\n     * @param b defines the blue component\n     * @param a defines the alpha component\n     */\n    setAlphaConstants(r, g, b, a) {\n        throw new Error(\"Setting alpha blend constant color not yet implemented.\");\n    }\n    /**\n     * Sets the current alpha mode\n     * @param mode defines the mode to use (one of the BABYLON.undefined)\n     * @param noDepthWriteChange defines if depth writing state should remains unchanged (false by default)\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/materials/advanced/transparent_rendering\n     */\n    setAlphaMode(mode, noDepthWriteChange = false) {\n        if (this._alphaMode === mode) {\n            return;\n        }\n        const nativeMode = this._getNativeAlphaMode(mode);\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETBLENDMODE);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(nativeMode);\n        this._commandBufferEncoder.finishEncodingCommand();\n        if (!noDepthWriteChange) {\n            this.setDepthWrite(mode === 0);\n        }\n        this._alphaMode = mode;\n    }\n    /**\n     * Gets the current alpha mode\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/materials/advanced/transparent_rendering\n     * @returns the current alpha mode\n     */\n    getAlphaMode() {\n        return this._alphaMode;\n    }\n    setInt(uniform, int) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINT);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsInt32(int);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setIntArray(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsInt32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setIntArray2(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY2);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsInt32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setIntArray3(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY3);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsInt32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setIntArray4(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY4);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsInt32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloatArray(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloatArray2(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY2);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloatArray3(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY3);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloatArray4(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY4);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32s(array);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setArray(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        return this.setFloatArray(uniform, new Float32Array(array));\n    }\n    setArray2(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        return this.setFloatArray2(uniform, new Float32Array(array));\n    }\n    setArray3(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        return this.setFloatArray3(uniform, new Float32Array(array));\n    }\n    setArray4(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        return this.setFloatArray4(uniform, new Float32Array(array));\n    }\n    setMatrices(uniform, matrices) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETMATRICES);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32s(matrices);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setMatrix3x3(uniform, matrix) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETMATRIX3X3);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32s(matrix);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setMatrix2x2(uniform, matrix) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETMATRIX2X2);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32s(matrix);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloat(uniform, value) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(value);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloat2(uniform, x, y) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT2);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(x);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(y);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloat3(uniform, x, y, z) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT3);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(x);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(y);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(z);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setFloat4(uniform, x, y, z, w) {\n        if (!uniform) {\n            return false;\n        }\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT4);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(x);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(y);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(z);\n        this._commandBufferEncoder.encodeCommandArgAsFloat32(w);\n        this._commandBufferEncoder.finishEncodingCommand();\n        return true;\n    }\n    setColor3(uniform, color3) {\n        if (!uniform) {\n            return false;\n        }\n        this.setFloat3(uniform, color3.r, color3.g, color3.b);\n        return true;\n    }\n    setColor4(uniform, color3, alpha) {\n        if (!uniform) {\n            return false;\n        }\n        this.setFloat4(uniform, color3.r, color3.g, color3.b, alpha);\n        return true;\n    }\n    wipeCaches(bruteForce) {\n        if (this.preventCacheWipeBetweenFrames) {\n            return;\n        }\n        this.resetTextureCache();\n        this._currentEffect = null;\n        if (bruteForce) {\n            this._currentProgram = null;\n            this._stencilStateComposer.reset();\n            this._depthCullingState.reset();\n            this._alphaState.reset();\n        }\n        this._cachedVertexBuffers = null;\n        this._cachedIndexBuffer = null;\n        this._cachedEffectForVertexBuffers = null;\n    }\n    _createTexture() {\n        return this._engine.createTexture();\n    }\n    _deleteTexture(texture) {\n        if (texture) {\n            this._engine.deleteTexture(texture);\n        }\n    }\n    /**\n     * Update the content of a dynamic texture\n     * @param texture defines the texture to update\n     * @param canvas defines the canvas containing the source\n     * @param invertY defines if data must be stored with Y axis inverted\n     * @param premulAlpha defines if alpha is stored as premultiplied\n     * @param format defines the format of the data\n     */\n    updateDynamicTexture(texture, canvas, invertY, premulAlpha = false, format) {\n        if (premulAlpha === void 0) {\n            premulAlpha = false;\n        }\n        if (!!texture && !!texture._hardwareTexture) {\n            const source = canvas.getCanvasTexture();\n            const destination = texture._hardwareTexture.underlyingResource;\n            this._engine.copyTexture(destination, source);\n            texture.isReady = true;\n        }\n    }\n    createDynamicTexture(width, height, generateMipMaps, samplingMode) {\n        // it's not possible to create 0x0 texture sized. Many bgfx methods assume texture size is at least 1x1(best case).\n        // Worst case is getting a crash/assert.\n        width = Math.max(width, 1);\n        height = Math.max(height, 1);\n        return this.createRawTexture(new Uint8Array(width * height * 4), width, height, 5, false, false, samplingMode);\n    }\n    createVideoElement(constraints) {\n        // create native object depending on stream. Only NativeCamera is supported for now.\n        if (this._camera) {\n            return this._camera.createVideo(constraints);\n        }\n        return null;\n    }\n    updateVideoTexture(texture, video, invertY) {\n        if (texture && texture._hardwareTexture && this._camera) {\n            const webGLTexture = texture._hardwareTexture.underlyingResource;\n            this._camera.updateVideoTexture(webGLTexture, video, invertY);\n        }\n    }\n    createRawTexture(data, width, height, format, generateMipMaps, invertY, samplingMode, compression = null, type = 0, creationFlags = 0, useSRGBBuffer = false) {\n        const texture = new InternalTexture(this, InternalTextureSource.Raw);\n        texture.format = format;\n        texture.generateMipMaps = generateMipMaps;\n        texture.samplingMode = samplingMode;\n        texture.invertY = invertY;\n        texture.baseWidth = width;\n        texture.baseHeight = height;\n        texture.width = texture.baseWidth;\n        texture.height = texture.baseHeight;\n        texture._compression = compression;\n        texture.type = type;\n        texture._useSRGBBuffer = this._getUseSRGBBuffer(useSRGBBuffer, !generateMipMaps);\n        this.updateRawTexture(texture, data, format, invertY, compression, type, texture._useSRGBBuffer);\n        if (texture._hardwareTexture) {\n            const webGLTexture = texture._hardwareTexture.underlyingResource;\n            const filter = this._getNativeSamplingMode(samplingMode);\n            this._setTextureSampling(webGLTexture, filter);\n        }\n        this._internalTexturesCache.push(texture);\n        return texture;\n    }\n    createRawTexture2DArray(data, width, height, depth, format, generateMipMaps, invertY, samplingMode, compression = null, textureType = 0) {\n        const texture = new InternalTexture(this, InternalTextureSource.Raw2DArray);\n        texture.baseWidth = width;\n        texture.baseHeight = height;\n        texture.baseDepth = depth;\n        texture.width = width;\n        texture.height = height;\n        texture.depth = depth;\n        texture.format = format;\n        texture.type = textureType;\n        texture.generateMipMaps = generateMipMaps;\n        texture.samplingMode = samplingMode;\n        texture.is2DArray = true;\n        if (texture._hardwareTexture) {\n            const nativeTexture = texture._hardwareTexture.underlyingResource;\n            this._engine.loadRawTexture2DArray(nativeTexture, data, width, height, depth, this._getNativeTextureFormat(format, textureType), generateMipMaps, invertY);\n            const filter = this._getNativeSamplingMode(samplingMode);\n            this._setTextureSampling(nativeTexture, filter);\n        }\n        texture.isReady = true;\n        this._internalTexturesCache.push(texture);\n        return texture;\n    }\n    updateRawTexture(texture, bufferView, format, invertY, compression = null, type = 0, useSRGBBuffer = false) {\n        if (!texture) {\n            return;\n        }\n        if (bufferView && texture._hardwareTexture) {\n            const underlyingResource = texture._hardwareTexture.underlyingResource;\n            this._engine.loadRawTexture(underlyingResource, bufferView, texture.width, texture.height, this._getNativeTextureFormat(format, type), texture.generateMipMaps, texture.invertY);\n        }\n        texture.isReady = true;\n    }\n    // TODO: Refactor to share more logic with babylon.engine.ts version.\n    /**\n     * Usually called from Texture.ts.\n     * Passed information to create a NativeTexture\n     * @param url defines a value which contains one of the following:\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\n     * @param scene needed for loading to the correct scene\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\n     * @param onLoad optional callback to be called upon successful completion\n     * @param onError optional callback to be called upon failure\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\n     * @param forcedExtension defines the extension to use to pick the right loader\n     * @param mimeType defines an optional mime type\n     * @param loaderOptions options to be passed to the loader\n     * @param creationFlags specific flags to use when creating the texture (1 for storage textures, for eg)\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\n     */\n    createTexture(url, noMipmap, invertY, scene, samplingMode = 3, onLoad = null, onError = null, buffer = null, fallback = null, format = null, forcedExtension = null, mimeType, loaderOptions, creationFlags, useSRGBBuffer = false) {\n        url = url || \"\";\n        const fromData = url.substr(0, 5) === \"data:\";\n        //const fromBlob = url.substr(0, 5) === \"blob:\";\n        const isBase64 = fromData && url.indexOf(\";base64,\") !== -1;\n        const texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Url);\n        const originalUrl = url;\n        if (this._transformTextureUrl && !isBase64 && !fallback && !buffer) {\n            url = this._transformTextureUrl(url);\n        }\n        // establish the file extension, if possible\n        const lastDot = url.lastIndexOf(\".\");\n        const extension = forcedExtension ? forcedExtension : lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\";\n        let loader = null;\n        for (const availableLoader of Engine._TextureLoaders) {\n            if (availableLoader.canLoad(extension)) {\n                loader = availableLoader;\n                break;\n            }\n        }\n        if (scene) {\n            scene.addPendingData(texture);\n        }\n        texture.url = url;\n        texture.generateMipMaps = !noMipmap;\n        texture.samplingMode = samplingMode;\n        texture.invertY = invertY;\n        texture._useSRGBBuffer = this._getUseSRGBBuffer(useSRGBBuffer, noMipmap);\n        if (!this.doNotHandleContextLost) {\n            // Keep a link to the buffer only if we plan to handle context lost\n            texture._buffer = buffer;\n        }\n        let onLoadObserver = null;\n        if (onLoad && !fallback) {\n            onLoadObserver = texture.onLoadedObservable.add(onLoad);\n        }\n        if (!fallback) {\n            this._internalTexturesCache.push(texture);\n        }\n        const onInternalError = (message, exception) => {\n            if (scene) {\n                scene.removePendingData(texture);\n            }\n            if (url === originalUrl) {\n                if (onLoadObserver) {\n                    texture.onLoadedObservable.remove(onLoadObserver);\n                }\n                if (EngineStore.UseFallbackTexture) {\n                    this.createTexture(EngineStore.FallbackTexture, noMipmap, texture.invertY, scene, samplingMode, null, onError, buffer, texture);\n                }\n                if (onError) {\n                    onError((message || \"Unknown error\") + (EngineStore.UseFallbackTexture ? \" - Fallback texture was used\" : \"\"), exception);\n                }\n            }\n            else {\n                // fall back to the original url if the transformed url fails to load\n                Logger.Warn(`Failed to load ${url}, falling back to ${originalUrl}`);\n                this.createTexture(originalUrl, noMipmap, texture.invertY, scene, samplingMode, onLoad, onError, buffer, texture, format, forcedExtension, mimeType, loaderOptions);\n            }\n        };\n        // processing for non-image formats\n        if (loader) {\n            throw new Error(\"Loading textures from IInternalTextureLoader not yet implemented.\");\n        }\n        else {\n            const onload = (data) => {\n                if (!texture._hardwareTexture) {\n                    if (scene) {\n                        scene.removePendingData(texture);\n                    }\n                    return;\n                }\n                const underlyingResource = texture._hardwareTexture.underlyingResource;\n                this._engine.loadTexture(underlyingResource, data, !noMipmap, invertY, useSRGBBuffer, () => {\n                    texture.baseWidth = this._engine.getTextureWidth(underlyingResource);\n                    texture.baseHeight = this._engine.getTextureHeight(underlyingResource);\n                    texture.width = texture.baseWidth;\n                    texture.height = texture.baseHeight;\n                    texture.isReady = true;\n                    const filter = this._getNativeSamplingMode(samplingMode);\n                    this._setTextureSampling(underlyingResource, filter);\n                    if (scene) {\n                        scene.removePendingData(texture);\n                    }\n                    texture.onLoadedObservable.notifyObservers(texture);\n                    texture.onLoadedObservable.clear();\n                }, () => {\n                    throw new Error(\"Could not load a native texture.\");\n                });\n            };\n            if (fromData && buffer) {\n                if (buffer instanceof ArrayBuffer) {\n                    onload(new Uint8Array(buffer));\n                }\n                else if (ArrayBuffer.isView(buffer)) {\n                    onload(buffer);\n                }\n                else if (typeof buffer === \"string\") {\n                    onload(new Uint8Array(Tools.DecodeBase64(buffer)));\n                }\n                else {\n                    throw new Error(\"Unsupported buffer type\");\n                }\n            }\n            else {\n                if (isBase64) {\n                    onload(new Uint8Array(Tools.DecodeBase64(url)));\n                }\n                else {\n                    this._loadFile(url, (data) => onload(new Uint8Array(data)), undefined, undefined, true, (request, exception) => {\n                        onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\n                    });\n                }\n            }\n        }\n        return texture;\n    }\n    /**\n     * Wraps an external native texture in a Babylon texture.\n     * @param texture defines the external texture\n     * @returns the babylon internal texture\n     */\n    wrapNativeTexture(texture) {\n        const hardwareTexture = new NativeHardwareTexture(texture, this._engine);\n        const internalTexture = new InternalTexture(this, InternalTextureSource.Unknown, true);\n        internalTexture._hardwareTexture = hardwareTexture;\n        internalTexture.isReady = true;\n        return internalTexture;\n    }\n    /**\n     * Wraps an external web gl texture in a Babylon texture.\n     * @returns the babylon internal texture\n     */\n    wrapWebGLTexture() {\n        throw new Error(\"wrapWebGLTexture is not supported, use wrapNativeTexture instead.\");\n    }\n    _createDepthStencilTexture(size, options, rtWrapper) {\n        // TODO: options?\n        const nativeRTWrapper = rtWrapper;\n        const texture = new InternalTexture(this, InternalTextureSource.DepthStencil);\n        const width = size.width || size;\n        const height = size.height || size;\n        const framebuffer = this._engine.createFrameBuffer(texture._hardwareTexture.underlyingResource, width, height, true, true);\n        nativeRTWrapper._framebufferDepthStencil = framebuffer;\n        return texture;\n    }\n    /**\n     * @internal\n     */\n    _releaseFramebufferObjects(framebuffer) {\n        if (framebuffer) {\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEFRAMEBUFFER);\n            this._commandBufferEncoder.encodeCommandArgAsNativeData(framebuffer);\n            this._commandBufferEncoder.finishEncodingCommand();\n        }\n    }\n    /**\n     * @internal Engine abstraction for loading and creating an image bitmap from a given source string.\n     * @param imageSource source to load the image from.\n     * @param options An object that sets options for the image's extraction.\n     * @returns ImageBitmap\n     */\n    _createImageBitmapFromSource(imageSource, options) {\n        const promise = new Promise((resolve, reject) => {\n            const image = this.createCanvasImage();\n            image.onload = () => {\n                try {\n                    const imageBitmap = this._engine.createImageBitmap(image);\n                    resolve(imageBitmap);\n                }\n                catch (error) {\n                    reject(`Error loading image ${image.src} with exception: ${error}`);\n                }\n            };\n            image.onerror = (error) => {\n                reject(`Error loading image ${image.src} with exception: ${error}`);\n            };\n            image.src = imageSource;\n        });\n        return promise;\n    }\n    /**\n     * Engine abstraction for createImageBitmap\n     * @param image source for image\n     * @param options An object that sets options for the image's extraction.\n     * @returns ImageBitmap\n     */\n    createImageBitmap(image, options) {\n        return new Promise((resolve, reject) => {\n            if (Array.isArray(image)) {\n                const arr = image;\n                if (arr.length) {\n                    const image = this._engine.createImageBitmap(arr[0]);\n                    if (image) {\n                        resolve(image);\n                        return;\n                    }\n                }\n            }\n            reject(`Unsupported data for createImageBitmap.`);\n        });\n    }\n    /**\n     * Resize an image and returns the image data as an uint8array\n     * @param image image to resize\n     * @param bufferWidth destination buffer width\n     * @param bufferHeight destination buffer height\n     * @returns an uint8array containing RGBA values of bufferWidth * bufferHeight size\n     */\n    resizeImageBitmap(image, bufferWidth, bufferHeight) {\n        return this._engine.resizeImageBitmap(image, bufferWidth, bufferHeight);\n    }\n    /**\n     * Creates a cube texture\n     * @param rootUrl defines the url where the files to load is located\n     * @param scene defines the current scene\n     * @param files defines the list of files to load (1 per face)\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated (false by default)\n     * @param onLoad defines an optional callback raised when the texture is loaded\n     * @param onError defines an optional callback raised if there is an issue to load the texture\n     * @param format defines the format of the data\n     * @param forcedExtension defines the extension to use to pick the right loader\n     * @param createPolynomials if a polynomial sphere should be created for the cube texture\n     * @param lodScale defines the scale applied to environment texture. This manages the range of LOD level used for IBL according to the roughness\n     * @param lodOffset defines the offset applied to environment texture. This manages first LOD level used for IBL according to the roughness\n     * @param fallback defines texture to use while falling back when (compressed) texture file not found.\n     * @param loaderOptions options to be passed to the loader\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\n     * @returns the cube texture as an InternalTexture\n     */\n    createCubeTexture(rootUrl, scene, files, noMipmap, onLoad = null, onError = null, format, forcedExtension = null, createPolynomials = false, lodScale = 0, lodOffset = 0, fallback = null, loaderOptions, useSRGBBuffer = false) {\n        const texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Cube);\n        texture.isCube = true;\n        texture.url = rootUrl;\n        texture.generateMipMaps = !noMipmap;\n        texture._lodGenerationScale = lodScale;\n        texture._lodGenerationOffset = lodOffset;\n        if (!this._doNotHandleContextLost) {\n            texture._extension = forcedExtension;\n            texture._files = files;\n        }\n        const lastDot = rootUrl.lastIndexOf(\".\");\n        const extension = forcedExtension ? forcedExtension : lastDot > -1 ? rootUrl.substring(lastDot).toLowerCase() : \"\";\n        // TODO: use texture loader to load env files?\n        if (extension === \".env\") {\n            const onloaddata = (data) => {\n                const info = GetEnvInfo(data);\n                texture.width = info.width;\n                texture.height = info.width;\n                UploadEnvSpherical(texture, info);\n                const specularInfo = info.specular;\n                if (!specularInfo) {\n                    throw new Error(`Nothing else parsed so far`);\n                }\n                texture._lodGenerationScale = specularInfo.lodGenerationScale;\n                const imageData = CreateImageDataArrayBufferViews(data, info);\n                texture.format = 5;\n                texture.type = 0;\n                texture.generateMipMaps = true;\n                texture.getEngine().updateTextureSamplingMode(Texture.TRILINEAR_SAMPLINGMODE, texture);\n                texture._isRGBD = true;\n                texture.invertY = true;\n                this._engine.loadCubeTextureWithMips(texture._hardwareTexture.underlyingResource, imageData, false, useSRGBBuffer, () => {\n                    texture.isReady = true;\n                    if (onLoad) {\n                        onLoad();\n                    }\n                }, () => {\n                    throw new Error(\"Could not load a native cube texture.\");\n                });\n            };\n            if (files && files.length === 6) {\n                throw new Error(`Multi-file loading not allowed on env files.`);\n            }\n            else {\n                const onInternalError = (request, exception) => {\n                    if (onError && request) {\n                        onError(request.status + \" \" + request.statusText, exception);\n                    }\n                };\n                this._loadFile(rootUrl, (data) => onloaddata(new Uint8Array(data)), undefined, undefined, true, onInternalError);\n            }\n        }\n        else {\n            if (!files || files.length !== 6) {\n                throw new Error(\"Cannot load cubemap because 6 files were not defined\");\n            }\n            // Reorder from [+X, +Y, +Z, -X, -Y, -Z] to [+X, -X, +Y, -Y, +Z, -Z].\n            const reorderedFiles = [files[0], files[3], files[1], files[4], files[2], files[5]];\n            Promise.all(reorderedFiles.map((file) => Tools.LoadFileAsync(file).then((data) => new Uint8Array(data))))\n                .then((data) => {\n                return new Promise((resolve, reject) => {\n                    this._engine.loadCubeTexture(texture._hardwareTexture.underlyingResource, data, !noMipmap, true, useSRGBBuffer, resolve, reject);\n                });\n            })\n                .then(() => {\n                texture.isReady = true;\n                if (onLoad) {\n                    onLoad();\n                }\n            }, (error) => {\n                if (onError) {\n                    onError(`Failed to load cubemap: ${error.message}`, error);\n                }\n            });\n        }\n        this._internalTexturesCache.push(texture);\n        return texture;\n    }\n    /** @internal */\n    _createHardwareTexture() {\n        return new NativeHardwareTexture(this._createTexture(), this._engine);\n    }\n    /** @internal */\n    _createHardwareRenderTargetWrapper(isMulti, isCube, size) {\n        const rtWrapper = new NativeRenderTargetWrapper(isMulti, isCube, size, this);\n        this._renderTargetWrapperCache.push(rtWrapper);\n        return rtWrapper;\n    }\n    /** @internal */\n    _createInternalTexture(size, options, _delayGPUTextureCreation = true, source = InternalTextureSource.Unknown) {\n        var _a;\n        let generateMipMaps = false;\n        let type = 0;\n        let samplingMode = 3;\n        let format = 5;\n        let useSRGBBuffer = false;\n        let samples = 1;\n        if (options !== undefined && typeof options === \"object\") {\n            generateMipMaps = !!options.generateMipMaps;\n            type = options.type === undefined ? 0 : options.type;\n            samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\n            format = options.format === undefined ? 5 : options.format;\n            useSRGBBuffer = options.useSRGBBuffer === undefined ? false : options.useSRGBBuffer;\n            samples = (_a = options.samples) !== null && _a !== void 0 ? _a : 1;\n        }\n        else {\n            generateMipMaps = !!options;\n        }\n        useSRGBBuffer && (useSRGBBuffer = this._caps.supportSRGBBuffers && (this.webGLVersion > 1 || this.isWebGPU));\n        if (type === 1 && !this._caps.textureFloatLinearFiltering) {\n            // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\n            samplingMode = 1;\n        }\n        else if (type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\n            // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\n            samplingMode = 1;\n        }\n        if (type === 1 && !this._caps.textureFloat) {\n            type = 0;\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\n        }\n        const texture = new InternalTexture(this, source);\n        const width = size.width || size;\n        const height = size.height || size;\n        const layers = size.layers || 0;\n        if (layers !== 0) {\n            throw new Error(\"Texture layers are not supported in Babylon Native\");\n        }\n        const nativeTexture = texture._hardwareTexture.underlyingResource;\n        const nativeTextureFormat = this._getNativeTextureFormat(format, type);\n        // REVIEW: We are always setting the renderTarget flag as we don't know whether the texture will be used as a render target.\n        this._engine.initializeTexture(nativeTexture, width, height, generateMipMaps, nativeTextureFormat, true, useSRGBBuffer);\n        this._setTextureSampling(nativeTexture, this._getNativeSamplingMode(samplingMode));\n        texture._useSRGBBuffer = useSRGBBuffer;\n        texture.baseWidth = width;\n        texture.baseHeight = height;\n        texture.width = width;\n        texture.height = height;\n        texture.depth = layers;\n        texture.isReady = true;\n        texture.samples = samples;\n        texture.generateMipMaps = generateMipMaps;\n        texture.samplingMode = samplingMode;\n        texture.type = type;\n        texture.format = format;\n        this._internalTexturesCache.push(texture);\n        return texture;\n    }\n    createRenderTargetTexture(size, options) {\n        var _a;\n        const rtWrapper = this._createHardwareRenderTargetWrapper(false, false, size);\n        let generateDepthBuffer = true;\n        let generateStencilBuffer = false;\n        let noColorAttachment = false;\n        let colorAttachment = undefined;\n        //let samples = 1;\n        if (options !== undefined && typeof options === \"object\") {\n            generateDepthBuffer = (_a = options.generateDepthBuffer) !== null && _a !== void 0 ? _a : true;\n            generateStencilBuffer = !!options.generateStencilBuffer;\n            noColorAttachment = !!options.noColorAttachment;\n            colorAttachment = options.colorAttachment;\n            //samples = options.samples ?? 1;\n        }\n        const texture = colorAttachment || (noColorAttachment ? null : this._createInternalTexture(size, options, true, InternalTextureSource.RenderTarget));\n        const width = size.width || size;\n        const height = size.height || size;\n        const framebuffer = this._engine.createFrameBuffer(texture ? texture._hardwareTexture.underlyingResource : null, width, height, generateStencilBuffer, generateDepthBuffer);\n        rtWrapper._framebuffer = framebuffer;\n        rtWrapper._generateDepthBuffer = generateDepthBuffer;\n        rtWrapper._generateStencilBuffer = generateStencilBuffer;\n        rtWrapper.setTextures(texture);\n        // TODO: handle this in native\n        //this.updateRenderTargetTextureSampleCount(rtWrapper, samples);\n        return rtWrapper;\n    }\n    updateTextureSamplingMode(samplingMode, texture) {\n        if (texture._hardwareTexture) {\n            const filter = this._getNativeSamplingMode(samplingMode);\n            this._setTextureSampling(texture._hardwareTexture.underlyingResource, filter);\n        }\n        texture.samplingMode = samplingMode;\n    }\n    bindFramebuffer(texture, faceIndex, requiredWidth, requiredHeight, forceFullscreenViewport) {\n        const nativeRTWrapper = texture;\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        this._currentRenderTarget = texture;\n        if (faceIndex) {\n            throw new Error(\"Cuboid frame buffers are not yet supported in NativeEngine.\");\n        }\n        if (requiredWidth || requiredHeight) {\n            throw new Error(\"Required width/height for frame buffers not yet supported in NativeEngine.\");\n        }\n        if (forceFullscreenViewport) {\n            //Not supported yet but don't stop rendering\n        }\n        if (nativeRTWrapper._framebufferDepthStencil) {\n            this._bindUnboundFramebuffer(nativeRTWrapper._framebufferDepthStencil);\n        }\n        else {\n            this._bindUnboundFramebuffer(nativeRTWrapper._framebuffer);\n        }\n    }\n    unBindFramebuffer(texture, disableGenerateMipMaps = false, onBeforeUnbind) {\n        // NOTE: Disabling mipmap generation is not yet supported in NativeEngine.\n        this._currentRenderTarget = null;\n        if (onBeforeUnbind) {\n            onBeforeUnbind();\n        }\n        this._bindUnboundFramebuffer(null);\n    }\n    createDynamicVertexBuffer(data) {\n        return this.createVertexBuffer(data, true);\n    }\n    updateDynamicIndexBuffer(indexBuffer, indices, offset = 0) {\n        const buffer = indexBuffer;\n        const data = this._normalizeIndexData(indices);\n        buffer.is32Bits = data.BYTES_PER_ELEMENT === 4;\n        this._engine.updateDynamicIndexBuffer(buffer.nativeIndexBuffer, data.buffer, data.byteOffset, data.byteLength, offset);\n    }\n    updateDynamicVertexBuffer(vertexBuffer, verticies, byteOffset, byteLength) {\n        const buffer = vertexBuffer;\n        const data = ArrayBuffer.isView(verticies) ? verticies : new Float32Array(verticies);\n        this._engine.updateDynamicVertexBuffer(buffer.nativeVertexBuffer, data.buffer, data.byteOffset + (byteOffset !== null && byteOffset !== void 0 ? byteOffset : 0), byteLength !== null && byteLength !== void 0 ? byteLength : data.byteLength);\n    }\n    // TODO: Refactor to share more logic with base Engine implementation.\n    _setTexture(channel, texture, isPartOfTextureArray = false, depthStencilTexture = false) {\n        const uniform = this._boundUniforms[channel];\n        if (!uniform) {\n            return false;\n        }\n        // Not ready?\n        if (!texture) {\n            if (this._boundTexturesCache[channel] != null) {\n                this._activeChannel = channel;\n                this._boundTexturesCache[channel] = null;\n            }\n            return false;\n        }\n        // Video\n        if (texture.video) {\n            this._activeChannel = channel;\n            texture.update();\n        }\n        else if (texture.delayLoadState === 4) {\n            // Delay loading\n            texture.delayLoad();\n            return false;\n        }\n        let internalTexture;\n        if (depthStencilTexture) {\n            internalTexture = texture.depthStencilTexture;\n        }\n        else if (texture.isReady()) {\n            internalTexture = texture.getInternalTexture();\n        }\n        else if (texture.isCube) {\n            internalTexture = this.emptyCubeTexture;\n        }\n        else if (texture.is3D) {\n            internalTexture = this.emptyTexture3D;\n        }\n        else if (texture.is2DArray) {\n            internalTexture = this.emptyTexture2DArray;\n        }\n        else {\n            internalTexture = this.emptyTexture;\n        }\n        this._activeChannel = channel;\n        if (!internalTexture || !internalTexture._hardwareTexture) {\n            return false;\n        }\n        this._setTextureWrapMode(internalTexture._hardwareTexture.underlyingResource, this._getAddressMode(texture.wrapU), this._getAddressMode(texture.wrapV), this._getAddressMode(texture.wrapR));\n        this._updateAnisotropicLevel(texture);\n        this._setTextureCore(uniform, internalTexture._hardwareTexture.underlyingResource);\n        return true;\n    }\n    // filter is a NativeFilter.XXXX value.\n    _setTextureSampling(texture, filter) {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTURESAMPLING);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(texture);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(filter);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    // addressModes are NativeAddressMode.XXXX values.\n    _setTextureWrapMode(texture, addressModeU, addressModeV, addressModeW) {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTUREWRAPMODE);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(texture);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(addressModeU);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(addressModeV);\n        this._commandBufferEncoder.encodeCommandArgAsUInt32(addressModeW);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    _setTextureCore(uniform, texture) {\n        this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTURE);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(uniform);\n        this._commandBufferEncoder.encodeCommandArgAsNativeData(texture);\n        this._commandBufferEncoder.finishEncodingCommand();\n    }\n    // TODO: Share more of this logic with the base implementation.\n    // TODO: Rename to match naming in base implementation once refactoring allows different parameters.\n    _updateAnisotropicLevel(texture) {\n        const internalTexture = texture.getInternalTexture();\n        const value = texture.anisotropicFilteringLevel;\n        if (!internalTexture || !internalTexture._hardwareTexture) {\n            return;\n        }\n        if (internalTexture._cachedAnisotropicFilteringLevel !== value) {\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTUREANISOTROPICLEVEL);\n            this._commandBufferEncoder.encodeCommandArgAsNativeData(internalTexture._hardwareTexture.underlyingResource);\n            this._commandBufferEncoder.encodeCommandArgAsUInt32(value);\n            this._commandBufferEncoder.finishEncodingCommand();\n            internalTexture._cachedAnisotropicFilteringLevel = value;\n        }\n    }\n    // Returns a NativeAddressMode.XXX value.\n    _getAddressMode(wrapMode) {\n        switch (wrapMode) {\n            case 1:\n                return _native.Engine.ADDRESS_MODE_WRAP;\n            case 0:\n                return _native.Engine.ADDRESS_MODE_CLAMP;\n            case 2:\n                return _native.Engine.ADDRESS_MODE_MIRROR;\n            default:\n                throw new Error(\"Unexpected wrap mode: \" + wrapMode + \".\");\n        }\n    }\n    /**\n     * @internal\n     */\n    _bindTexture(channel, texture) {\n        const uniform = this._boundUniforms[channel];\n        if (!uniform) {\n            return;\n        }\n        if (texture && texture._hardwareTexture) {\n            const underlyingResource = texture._hardwareTexture.underlyingResource;\n            this._setTextureCore(uniform, underlyingResource);\n        }\n    }\n    _deleteBuffer(buffer) {\n        if (buffer.nativeIndexBuffer) {\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEINDEXBUFFER);\n            this._commandBufferEncoder.encodeCommandArgAsNativeData(buffer.nativeIndexBuffer);\n            this._commandBufferEncoder.finishEncodingCommand();\n            delete buffer.nativeIndexBuffer;\n        }\n        if (buffer.nativeVertexBuffer) {\n            this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEVERTEXBUFFER);\n            this._commandBufferEncoder.encodeCommandArgAsNativeData(buffer.nativeVertexBuffer);\n            this._commandBufferEncoder.finishEncodingCommand();\n            delete buffer.nativeVertexBuffer;\n        }\n    }\n    /**\n     * Create a canvas\n     * @param width width\n     * @param height height\n     * @returns ICanvas interface\n     */\n    createCanvas(width, height) {\n        if (!_native.Canvas) {\n            throw new Error(\"Native Canvas plugin not available.\");\n        }\n        const canvas = new _native.Canvas();\n        canvas.width = width;\n        canvas.height = height;\n        return canvas;\n    }\n    /**\n     * Create an image to use with canvas\n     * @returns IImage interface\n     */\n    createCanvasImage() {\n        if (!_native.Canvas) {\n            throw new Error(\"Native Canvas plugin not available.\");\n        }\n        const image = new _native.Image();\n        return image;\n    }\n    /**\n     * Update a portion of an internal texture\n     * @param texture defines the texture to update\n     * @param imageData defines the data to store into the texture\n     * @param xOffset defines the x coordinates of the update rectangle\n     * @param yOffset defines the y coordinates of the update rectangle\n     * @param width defines the width of the update rectangle\n     * @param height defines the height of the update rectangle\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\n     * @param lod defines the lod level to update (0 by default)\n     * @param generateMipMaps defines whether to generate mipmaps or not\n     */\n    updateTextureData(texture, imageData, xOffset, yOffset, width, height, faceIndex = 0, lod = 0, generateMipMaps = false) {\n        throw new Error(\"updateTextureData not implemented.\");\n    }\n    /**\n     * @internal\n     */\n    _uploadCompressedDataToTextureDirectly(texture, internalFormat, width, height, data, faceIndex = 0, lod = 0) {\n        throw new Error(\"_uploadCompressedDataToTextureDirectly not implemented.\");\n    }\n    /**\n     * @internal\n     */\n    _uploadDataToTextureDirectly(texture, imageData, faceIndex = 0, lod = 0) {\n        throw new Error(\"_uploadDataToTextureDirectly not implemented.\");\n    }\n    /**\n     * @internal\n     */\n    _uploadArrayBufferViewToTexture(texture, imageData, faceIndex = 0, lod = 0) {\n        throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\n    }\n    /**\n     * @internal\n     */\n    _uploadImageToTexture(texture, image, faceIndex = 0, lod = 0) {\n        throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\n    }\n    // JavaScript-to-Native conversion helper functions.\n    _getNativeSamplingMode(samplingMode) {\n        switch (samplingMode) {\n            case 1:\n                return _native.Engine.TEXTURE_NEAREST_NEAREST;\n            case 2:\n                return _native.Engine.TEXTURE_LINEAR_LINEAR;\n            case 3:\n                return _native.Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR;\n            case 4:\n                return _native.Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST;\n            case 5:\n                return _native.Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST;\n            case 6:\n                return _native.Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR;\n            case 7:\n                return _native.Engine.TEXTURE_NEAREST_LINEAR;\n            case 8:\n                return _native.Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR;\n            case 9:\n                return _native.Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST;\n            case 10:\n                return _native.Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR;\n            case 11:\n                return _native.Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST;\n            case 12:\n                return _native.Engine.TEXTURE_LINEAR_NEAREST;\n            default:\n                throw new Error(`Unsupported sampling mode: ${samplingMode}.`);\n        }\n    }\n    _getStencilFunc(func) {\n        switch (func) {\n            case 513:\n                return _native.Engine.STENCIL_TEST_LESS;\n            case 515:\n                return _native.Engine.STENCIL_TEST_LEQUAL;\n            case 514:\n                return _native.Engine.STENCIL_TEST_EQUAL;\n            case 518:\n                return _native.Engine.STENCIL_TEST_GEQUAL;\n            case 516:\n                return _native.Engine.STENCIL_TEST_GREATER;\n            case 517:\n                return _native.Engine.STENCIL_TEST_NOTEQUAL;\n            case 512:\n                return _native.Engine.STENCIL_TEST_NEVER;\n            case 519:\n                return _native.Engine.STENCIL_TEST_ALWAYS;\n            default:\n                throw new Error(`Unsupported stencil func mode: ${func}.`);\n        }\n    }\n    _getStencilOpFail(opFail) {\n        switch (opFail) {\n            case 7680:\n                return _native.Engine.STENCIL_OP_FAIL_S_KEEP;\n            case 0:\n                return _native.Engine.STENCIL_OP_FAIL_S_ZERO;\n            case 7681:\n                return _native.Engine.STENCIL_OP_FAIL_S_REPLACE;\n            case 7682:\n                return _native.Engine.STENCIL_OP_FAIL_S_INCR;\n            case 7683:\n                return _native.Engine.STENCIL_OP_FAIL_S_DECR;\n            case 5386:\n                return _native.Engine.STENCIL_OP_FAIL_S_INVERT;\n            case 34055:\n                return _native.Engine.STENCIL_OP_FAIL_S_INCRSAT;\n            case 34056:\n                return _native.Engine.STENCIL_OP_FAIL_S_DECRSAT;\n            default:\n                throw new Error(`Unsupported stencil OpFail mode: ${opFail}.`);\n        }\n    }\n    _getStencilDepthFail(depthFail) {\n        switch (depthFail) {\n            case 7680:\n                return _native.Engine.STENCIL_OP_FAIL_Z_KEEP;\n            case 0:\n                return _native.Engine.STENCIL_OP_FAIL_Z_ZERO;\n            case 7681:\n                return _native.Engine.STENCIL_OP_FAIL_Z_REPLACE;\n            case 7682:\n                return _native.Engine.STENCIL_OP_FAIL_Z_INCR;\n            case 7683:\n                return _native.Engine.STENCIL_OP_FAIL_Z_DECR;\n            case 5386:\n                return _native.Engine.STENCIL_OP_FAIL_Z_INVERT;\n            case 34055:\n                return _native.Engine.STENCIL_OP_FAIL_Z_INCRSAT;\n            case 34056:\n                return _native.Engine.STENCIL_OP_FAIL_Z_DECRSAT;\n            default:\n                throw new Error(`Unsupported stencil depthFail mode: ${depthFail}.`);\n        }\n    }\n    _getStencilDepthPass(opPass) {\n        switch (opPass) {\n            case 7680:\n                return _native.Engine.STENCIL_OP_PASS_Z_KEEP;\n            case 0:\n                return _native.Engine.STENCIL_OP_PASS_Z_ZERO;\n            case 7681:\n                return _native.Engine.STENCIL_OP_PASS_Z_REPLACE;\n            case 7682:\n                return _native.Engine.STENCIL_OP_PASS_Z_INCR;\n            case 7683:\n                return _native.Engine.STENCIL_OP_PASS_Z_DECR;\n            case 5386:\n                return _native.Engine.STENCIL_OP_PASS_Z_INVERT;\n            case 34055:\n                return _native.Engine.STENCIL_OP_PASS_Z_INCRSAT;\n            case 34056:\n                return _native.Engine.STENCIL_OP_PASS_Z_DECRSAT;\n            default:\n                throw new Error(`Unsupported stencil opPass mode: ${opPass}.`);\n        }\n    }\n    _getNativeTextureFormat(format, type) {\n        if (format == 4 && type == 0) {\n            return _native.Engine.TEXTURE_FORMAT_RGB8;\n        }\n        else if (format == 5 && type == 0) {\n            return _native.Engine.TEXTURE_FORMAT_RGBA8;\n        }\n        else if (format == 5 && type == 2) {\n            return _native.Engine.TEXTURE_FORMAT_RGBA16F;\n        }\n        else if (format == 5 && type == 1) {\n            return _native.Engine.TEXTURE_FORMAT_RGBA32F;\n        }\n        else {\n            throw new RuntimeError(`Unsupported texture format or type: format ${format}, type ${type}.`, ErrorCodes.UnsupportedTextureError);\n        }\n    }\n    _getNativeAlphaMode(mode) {\n        switch (mode) {\n            case 0:\n                return _native.Engine.ALPHA_DISABLE;\n            case 1:\n                return _native.Engine.ALPHA_ADD;\n            case 2:\n                return _native.Engine.ALPHA_COMBINE;\n            case 3:\n                return _native.Engine.ALPHA_SUBTRACT;\n            case 4:\n                return _native.Engine.ALPHA_MULTIPLY;\n            case 5:\n                return _native.Engine.ALPHA_MAXIMIZED;\n            case 6:\n                return _native.Engine.ALPHA_ONEONE;\n            case 7:\n                return _native.Engine.ALPHA_PREMULTIPLIED;\n            case 8:\n                return _native.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF;\n            case 9:\n                return _native.Engine.ALPHA_INTERPOLATE;\n            case 10:\n                return _native.Engine.ALPHA_SCREENMODE;\n            default:\n                throw new Error(`Unsupported alpha mode: ${mode}.`);\n        }\n    }\n    _getNativeAttribType(type) {\n        switch (type) {\n            case VertexBuffer.BYTE:\n                return _native.Engine.ATTRIB_TYPE_INT8;\n            case VertexBuffer.UNSIGNED_BYTE:\n                return _native.Engine.ATTRIB_TYPE_UINT8;\n            case VertexBuffer.SHORT:\n                return _native.Engine.ATTRIB_TYPE_INT16;\n            case VertexBuffer.UNSIGNED_SHORT:\n                return _native.Engine.ATTRIB_TYPE_UINT16;\n            case VertexBuffer.FLOAT:\n                return _native.Engine.ATTRIB_TYPE_FLOAT;\n            default:\n                throw new Error(`Unsupported attribute type: ${type}.`);\n        }\n    }\n    getFontOffset(font) {\n        // TODO\n        const result = { ascent: 0, height: 0, descent: 0 };\n        return result;\n    }\n    _readTexturePixels(texture, width, height, faceIndex, level, buffer, _flushRenderer, _noDataConversion, x, y) {\n        var _a, _b, _c, _d;\n        if (faceIndex !== undefined && faceIndex !== -1) {\n            throw new Error(`Reading cubemap faces is not supported, but faceIndex is ${faceIndex}.`);\n        }\n        return this._engine\n            .readTexture((_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource, level !== null && level !== void 0 ? level : 0, x !== null && x !== void 0 ? x : 0, y !== null && y !== void 0 ? y : 0, width, height, (_b = buffer === null || buffer === void 0 ? void 0 : buffer.buffer) !== null && _b !== void 0 ? _b : null, (_c = buffer === null || buffer === void 0 ? void 0 : buffer.byteOffset) !== null && _c !== void 0 ? _c : 0, (_d = buffer === null || buffer === void 0 ? void 0 : buffer.byteLength) !== null && _d !== void 0 ? _d : 0)\n            .then((rawBuffer) => {\n            if (!buffer) {\n                buffer = new Uint8Array(rawBuffer);\n            }\n            return buffer;\n        });\n    }\n}\n// This must match the protocol version in NativeEngine.cpp\nNativeEngine.PROTOCOL_VERSION = 8;\n//# sourceMappingURL=nativeEngine.js.map","/** @internal */\nexport class PerformanceConfigurator {\n    /**\n     * @internal\n     */\n    static SetMatrixPrecision(use64bits) {\n        PerformanceConfigurator.MatrixTrackPrecisionChange = false;\n        if (use64bits && !PerformanceConfigurator.MatrixUse64Bits) {\n            if (PerformanceConfigurator.MatrixTrackedMatrices) {\n                for (let m = 0; m < PerformanceConfigurator.MatrixTrackedMatrices.length; ++m) {\n                    const matrix = PerformanceConfigurator.MatrixTrackedMatrices[m];\n                    const values = matrix._m;\n                    matrix._m = new Array(16);\n                    for (let i = 0; i < 16; ++i) {\n                        matrix._m[i] = values[i];\n                    }\n                }\n            }\n        }\n        PerformanceConfigurator.MatrixUse64Bits = use64bits;\n        PerformanceConfigurator.MatrixCurrentType = PerformanceConfigurator.MatrixUse64Bits ? Array : Float32Array;\n        PerformanceConfigurator.MatrixTrackedMatrices = null; // reclaim some memory, as we don't need _TrackedMatrices anymore\n    }\n}\n/** @internal */\nPerformanceConfigurator.MatrixUse64Bits = false;\n/** @internal */\nPerformanceConfigurator.MatrixTrackPrecisionChange = true;\n/** @internal */\nPerformanceConfigurator.MatrixCurrentType = Float32Array;\n/** @internal */\nPerformanceConfigurator.MatrixTrackedMatrices = [];\n//# sourceMappingURL=performanceConfigurator.js.map","import { InternalTextureSource } from \"../Materials/Textures/internalTexture.js\";\n\n/**\n * Wrapper around a render target (either single or multi textures)\n */\nexport class RenderTargetWrapper {\n    /**\n     * Gets the depth/stencil texture (if created by a createDepthStencilTexture() call)\n     */\n    get depthStencilTexture() {\n        return this._depthStencilTexture;\n    }\n    /**\n     * Indicates if the depth/stencil texture has a stencil aspect\n     */\n    get depthStencilTextureWithStencil() {\n        return this._depthStencilTextureWithStencil;\n    }\n    /**\n     * Defines if the render target wrapper is for a cube texture or if false a 2d texture\n     */\n    get isCube() {\n        return this._isCube;\n    }\n    /**\n     * Defines if the render target wrapper is for a single or multi target render wrapper\n     */\n    get isMulti() {\n        return this._isMulti;\n    }\n    /**\n     * Defines if the render target wrapper is for a single or an array of textures\n     */\n    get is2DArray() {\n        return this.layers > 0;\n    }\n    /**\n     * Gets the size of the render target wrapper (used for cubes, as width=height in this case)\n     */\n    get size() {\n        return this.width;\n    }\n    /**\n     * Gets the width of the render target wrapper\n     */\n    get width() {\n        return this._size.width || this._size;\n    }\n    /**\n     * Gets the height of the render target wrapper\n     */\n    get height() {\n        return this._size.height || this._size;\n    }\n    /**\n     * Gets the number of layers of the render target wrapper (only used if is2DArray is true)\n     */\n    get layers() {\n        return this._size.layers || 0;\n    }\n    /**\n     * Gets the render texture. If this is a multi render target, gets the first texture\n     */\n    get texture() {\n        var _a, _b;\n        return (_b = (_a = this._textures) === null || _a === void 0 ? void 0 : _a[0]) !== null && _b !== void 0 ? _b : null;\n    }\n    /**\n     * Gets the list of render textures. If we are not in a multi render target, the list will be null (use the texture getter instead)\n     */\n    get textures() {\n        return this._textures;\n    }\n    /**\n     * Gets the sample count of the render target\n     */\n    get samples() {\n        return this._samples;\n    }\n    /**\n     * Sets the sample count of the render target\n     * @param value sample count\n     * @param initializeBuffers If set to true, the engine will make an initializing call to drawBuffers (only used when isMulti=true).\n     * @param force true to force calling the update sample count engine function even if the current sample count is equal to value\n     * @returns the sample count that has been set\n     */\n    setSamples(value, initializeBuffers = true, force = false) {\n        if (this.samples === value && !force) {\n            return value;\n        }\n        const result = this._isMulti\n            ? this._engine.updateMultipleRenderTargetTextureSampleCount(this, value, initializeBuffers)\n            : this._engine.updateRenderTargetTextureSampleCount(this, value);\n        this._samples = value;\n        return result;\n    }\n    /**\n     * Initializes the render target wrapper\n     * @param isMulti true if the wrapper is a multi render target\n     * @param isCube true if the wrapper should render to a cube texture\n     * @param size size of the render target (width/height/layers)\n     * @param engine engine used to create the render target\n     */\n    constructor(isMulti, isCube, size, engine) {\n        this._textures = null;\n        /** @internal */\n        this._samples = 1;\n        /** @internal */\n        this._attachments = null;\n        /** @internal */\n        this._generateStencilBuffer = false;\n        /** @internal */\n        this._generateDepthBuffer = false;\n        /** @internal */\n        this._depthStencilTextureWithStencil = false;\n        this._isMulti = isMulti;\n        this._isCube = isCube;\n        this._size = size;\n        this._engine = engine;\n        this._depthStencilTexture = null;\n    }\n    /**\n     * Sets the render target texture(s)\n     * @param textures texture(s) to set\n     */\n    setTextures(textures) {\n        if (Array.isArray(textures)) {\n            this._textures = textures;\n        }\n        else if (textures) {\n            this._textures = [textures];\n        }\n        else {\n            this._textures = null;\n        }\n    }\n    /**\n     * Set a texture in the textures array\n     * @param texture the texture to set\n     * @param index the index in the textures array to set\n     * @param disposePrevious If this function should dispose the previous texture\n     */\n    setTexture(texture, index = 0, disposePrevious = true) {\n        if (!this._textures) {\n            this._textures = [];\n        }\n        if (this._textures[index] && disposePrevious) {\n            this._textures[index].dispose();\n        }\n        this._textures[index] = texture;\n    }\n    /**\n     * Creates the depth/stencil texture\n     * @param comparisonFunction Comparison function to use for the texture\n     * @param bilinearFiltering true if bilinear filtering should be used when sampling the texture\n     * @param generateStencil true if the stencil aspect should also be created\n     * @param samples sample count to use when creating the texture\n     * @param format format of the depth texture\n     * @returns the depth/stencil created texture\n     */\n    createDepthStencilTexture(comparisonFunction = 0, bilinearFiltering = true, generateStencil = false, samples = 1, format = 14) {\n        var _a;\n        (_a = this._depthStencilTexture) === null || _a === void 0 ? void 0 : _a.dispose();\n        this._depthStencilTextureWithStencil = generateStencil;\n        this._depthStencilTexture = this._engine.createDepthStencilTexture(this._size, {\n            bilinearFiltering,\n            comparisonFunction,\n            generateStencil,\n            isCube: this._isCube,\n            samples,\n            depthTextureFormat: format,\n        }, this);\n        return this._depthStencilTexture;\n    }\n    /**\n     * Shares the depth buffer of this render target with another render target.\n     * @internal\n     * @param renderTarget Destination renderTarget\n     */\n    _shareDepth(renderTarget) {\n        if (this._depthStencilTexture) {\n            if (renderTarget._depthStencilTexture) {\n                renderTarget._depthStencilTexture.dispose();\n            }\n            renderTarget._depthStencilTexture = this._depthStencilTexture;\n            this._depthStencilTexture.incrementReferences();\n        }\n    }\n    /**\n     * @internal\n     */\n    _swapAndDie(target) {\n        if (this.texture) {\n            this.texture._swapAndDie(target);\n        }\n        this._textures = null;\n        this.dispose(true);\n    }\n    _cloneRenderTargetWrapper() {\n        var _a, _b, _c, _d, _e, _f;\n        let rtw = null;\n        if (this._isMulti) {\n            const textureArray = this.textures;\n            if (textureArray && textureArray.length > 0) {\n                let generateDepthTexture = false;\n                let textureCount = textureArray.length;\n                const lastTextureSource = textureArray[textureArray.length - 1]._source;\n                if (lastTextureSource === InternalTextureSource.Depth || lastTextureSource === InternalTextureSource.DepthStencil) {\n                    generateDepthTexture = true;\n                    textureCount--;\n                }\n                const samplingModes = [];\n                const types = [];\n                for (let i = 0; i < textureCount; ++i) {\n                    const texture = textureArray[i];\n                    samplingModes.push(texture.samplingMode);\n                    types.push(texture.type);\n                }\n                const optionsMRT = {\n                    samplingModes,\n                    generateMipMaps: textureArray[0].generateMipMaps,\n                    generateDepthBuffer: this._generateDepthBuffer,\n                    generateStencilBuffer: this._generateStencilBuffer,\n                    generateDepthTexture,\n                    types,\n                    textureCount,\n                };\n                const size = {\n                    width: this.width,\n                    height: this.height,\n                };\n                rtw = this._engine.createMultipleRenderTarget(size, optionsMRT);\n            }\n        }\n        else {\n            const options = {};\n            options.generateDepthBuffer = this._generateDepthBuffer;\n            options.generateMipMaps = (_b = (_a = this.texture) === null || _a === void 0 ? void 0 : _a.generateMipMaps) !== null && _b !== void 0 ? _b : false;\n            options.generateStencilBuffer = this._generateStencilBuffer;\n            options.samplingMode = (_c = this.texture) === null || _c === void 0 ? void 0 : _c.samplingMode;\n            options.type = (_d = this.texture) === null || _d === void 0 ? void 0 : _d.type;\n            options.format = (_e = this.texture) === null || _e === void 0 ? void 0 : _e.format;\n            if (this.isCube) {\n                rtw = this._engine.createRenderTargetCubeTexture(this.width, options);\n            }\n            else {\n                const size = {\n                    width: this.width,\n                    height: this.height,\n                    layers: this.is2DArray ? (_f = this.texture) === null || _f === void 0 ? void 0 : _f.depth : undefined,\n                };\n                rtw = this._engine.createRenderTargetTexture(size, options);\n            }\n            rtw.texture.isReady = true;\n        }\n        return rtw;\n    }\n    _swapRenderTargetWrapper(target) {\n        if (this._textures && target._textures) {\n            for (let i = 0; i < this._textures.length; ++i) {\n                this._textures[i]._swapAndDie(target._textures[i], false);\n                target._textures[i].isReady = true;\n            }\n        }\n        if (this._depthStencilTexture && target._depthStencilTexture) {\n            this._depthStencilTexture._swapAndDie(target._depthStencilTexture);\n            target._depthStencilTexture.isReady = true;\n        }\n        this._textures = null;\n        this._depthStencilTexture = null;\n    }\n    /** @internal */\n    _rebuild() {\n        const rtw = this._cloneRenderTargetWrapper();\n        if (!rtw) {\n            return;\n        }\n        if (this._depthStencilTexture) {\n            const samplingMode = this._depthStencilTexture.samplingMode;\n            const bilinear = samplingMode === 2 ||\n                samplingMode === 3 ||\n                samplingMode === 11;\n            rtw.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction, bilinear, this._depthStencilTextureWithStencil, this._depthStencilTexture.samples);\n        }\n        if (this.samples > 1) {\n            rtw.setSamples(this.samples);\n        }\n        rtw._swapRenderTargetWrapper(this);\n        rtw.dispose();\n    }\n    /**\n     * Releases the internal render textures\n     */\n    releaseTextures() {\n        var _a, _b;\n        if (this._textures) {\n            for (let i = 0; (_b = i < ((_a = this._textures) === null || _a === void 0 ? void 0 : _a.length)) !== null && _b !== void 0 ? _b : 0; ++i) {\n                this._textures[i].dispose();\n            }\n        }\n        this._textures = null;\n    }\n    /**\n     * Disposes the whole render target wrapper\n     * @param disposeOnlyFramebuffers true if only the frame buffers should be released (used for the WebGL engine). If false, all the textures will also be released\n     */\n    dispose(disposeOnlyFramebuffers = false) {\n        var _a;\n        if (!disposeOnlyFramebuffers) {\n            (_a = this._depthStencilTexture) === null || _a === void 0 ? void 0 : _a.dispose();\n            this._depthStencilTexture = null;\n            this.releaseTextures();\n        }\n        this._engine._releaseRenderTargetWrapper(this);\n    }\n}\n//# sourceMappingURL=renderTargetWrapper.js.map","import { ShaderLanguage } from \"../Materials/shaderLanguage.js\";\n/**\n * Defines the shader related stores and directory\n */\nexport class ShaderStore {\n    /**\n     * Gets the shaders repository path for a given shader language\n     * @param shaderLanguage the shader language\n     * @returns the path to the shaders repository\n     */\n    static GetShadersRepository(shaderLanguage = ShaderLanguage.GLSL) {\n        return shaderLanguage === ShaderLanguage.GLSL ? ShaderStore.ShadersRepository : ShaderStore.ShadersRepositoryWGSL;\n    }\n    /**\n     * Gets the shaders store of a given shader language\n     * @param shaderLanguage the shader language\n     * @returns the shaders store\n     */\n    static GetShadersStore(shaderLanguage = ShaderLanguage.GLSL) {\n        return shaderLanguage === ShaderLanguage.GLSL ? ShaderStore.ShadersStore : ShaderStore.ShadersStoreWGSL;\n    }\n    /**\n     * Gets the include shaders store of a given shader language\n     * @param shaderLanguage the shader language\n     * @returns the include shaders store\n     */\n    static GetIncludesShadersStore(shaderLanguage = ShaderLanguage.GLSL) {\n        return shaderLanguage === ShaderLanguage.GLSL ? ShaderStore.IncludesShadersStore : ShaderStore.IncludesShadersStoreWGSL;\n    }\n}\n/**\n * Gets or sets the relative url used to load shaders if using the engine in non-minified mode\n */\nShaderStore.ShadersRepository = \"src/Shaders/\";\n/**\n * Store of each shader (The can be looked up using effect.key)\n */\nShaderStore.ShadersStore = {};\n/**\n * Store of each included file for a shader (The can be looked up using effect.key)\n */\nShaderStore.IncludesShadersStore = {};\n/**\n * Gets or sets the relative url used to load shaders (WGSL) if using the engine in non-minified mode\n */\nShaderStore.ShadersRepositoryWGSL = \"src/ShadersWGSL/\";\n/**\n * Store of each shader  (WGSL)\n */\nShaderStore.ShadersStoreWGSL = {};\n/**\n * Store of each included file for a shader (WGSL)\n */\nShaderStore.IncludesShadersStoreWGSL = {};\n//# sourceMappingURL=shaderStore.js.map","/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { EngineStore } from \"./engineStore.js\";\nimport { Effect } from \"../Materials/effect.js\";\nimport { _WarnImport } from \"../Misc/devTools.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { DepthCullingState } from \"../States/depthCullingState.js\";\nimport { StencilState } from \"../States/stencilState.js\";\nimport { AlphaState } from \"../States/alphaCullingState.js\";\n\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture.js\";\nimport { Logger } from \"../Misc/logger.js\";\nimport { IsDocumentAvailable, IsWindowObjectExist } from \"../Misc/domManagement.js\";\nimport { WebGLShaderProcessor } from \"./WebGL/webGLShaderProcessors.js\";\nimport { WebGL2ShaderProcessor } from \"./WebGL/webGL2ShaderProcessors.js\";\nimport { WebGLDataBuffer } from \"../Meshes/WebGL/webGLDataBuffer.js\";\nimport { WebGLPipelineContext } from \"./WebGL/webGLPipelineContext.js\";\nimport { PerformanceConfigurator } from \"./performanceConfigurator.js\";\nimport { WebGLHardwareTexture } from \"./WebGL/webGLHardwareTexture.js\";\nimport { DrawWrapper } from \"../Materials/drawWrapper.js\";\nimport { StencilStateComposer } from \"../States/stencilStateComposer.js\";\nimport { ShaderLanguage } from \"../Materials/shaderLanguage.js\";\nimport { PrecisionDate } from \"../Misc/precisionDate.js\";\n/**\n * Keeps track of all the buffer info used in engine.\n */\nclass BufferPointer {\n}\n/**\n * The base engine class (root of all engines)\n */\nexport class ThinEngine {\n    /**\n     * Returns the current npm package of the sdk\n     */\n    // Not mixed with Version for tooling purpose.\n    static get NpmPackage() {\n        return \"babylonjs@5.48.0\";\n    }\n    /**\n     * Returns the current version of the framework\n     */\n    static get Version() {\n        return \"5.48.0\";\n    }\n    /**\n     * Returns a string describing the current engine\n     */\n    get description() {\n        let description = this.name + this.webGLVersion;\n        if (this._caps.parallelShaderCompile) {\n            description += \" - Parallel shader compilation\";\n        }\n        return description;\n    }\n    /**\n     * Gets or sets the name of the engine\n     */\n    get name() {\n        return this._name;\n    }\n    set name(value) {\n        this._name = value;\n    }\n    /**\n     * Returns the version of the engine\n     */\n    get version() {\n        return this._webGLVersion;\n    }\n    /**\n     * Gets or sets the relative url used to load shaders if using the engine in non-minified mode\n     */\n    static get ShadersRepository() {\n        return Effect.ShadersRepository;\n    }\n    static set ShadersRepository(value) {\n        Effect.ShadersRepository = value;\n    }\n    /**\n     * @internal\n     */\n    _getShaderProcessor(shaderLanguage) {\n        return this._shaderProcessor;\n    }\n    /**\n     * Gets or sets a boolean indicating if depth buffer should be reverse, going from far to near.\n     * This can provide greater z depth for distant objects.\n     */\n    get useReverseDepthBuffer() {\n        return this._useReverseDepthBuffer;\n    }\n    set useReverseDepthBuffer(useReverse) {\n        if (useReverse === this._useReverseDepthBuffer) {\n            return;\n        }\n        this._useReverseDepthBuffer = useReverse;\n        if (useReverse) {\n            this._depthCullingState.depthFunc = 518;\n        }\n        else {\n            this._depthCullingState.depthFunc = 515;\n        }\n    }\n    /**\n     * Gets the current frame id\n     */\n    get frameId() {\n        return this._frameId;\n    }\n    /**\n     * Gets a boolean indicating that the engine supports uniform buffers\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\n     */\n    get supportsUniformBuffers() {\n        return this.webGLVersion > 1 && !this.disableUniformBuffers;\n    }\n    /**\n     * Gets the options used for engine creation\n     * @returns EngineOptions object\n     */\n    getCreationOptions() {\n        return this._creationOptions;\n    }\n    /** @internal */\n    get _shouldUseHighPrecisionShader() {\n        return !!(this._caps.highPrecisionShaderSupported && this._highPrecisionShadersAllowed);\n    }\n    /**\n     * Gets a boolean indicating that only power of 2 textures are supported\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\n     */\n    get needPOTTextures() {\n        return this._webGLVersion < 2 || this.forcePOTTextures;\n    }\n    /**\n     * Gets the list of current active render loop functions\n     * @returns an array with the current render loop functions\n     */\n    get activeRenderLoops() {\n        return this._activeRenderLoops;\n    }\n    /**\n     * Gets or sets a boolean indicating if resources should be retained to be able to handle context lost events\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/optimize_your_scene#handling-webgl-context-lost\n     */\n    get doNotHandleContextLost() {\n        return this._doNotHandleContextLost;\n    }\n    set doNotHandleContextLost(value) {\n        this._doNotHandleContextLost = value;\n    }\n    get _supportsHardwareTextureRescaling() {\n        return false;\n    }\n    /**\n     * sets the object from which width and height will be taken from when getting render width and height\n     * Will fallback to the gl object\n     * @param dimensions the framebuffer width and height that will be used.\n     */\n    set framebufferDimensionsObject(dimensions) {\n        this._framebufferDimensionsObject = dimensions;\n    }\n    /**\n     * Gets the current viewport\n     */\n    get currentViewport() {\n        return this._cachedViewport;\n    }\n    /**\n     * Gets the default empty texture\n     */\n    get emptyTexture() {\n        if (!this._emptyTexture) {\n            this._emptyTexture = this.createRawTexture(new Uint8Array(4), 1, 1, 5, false, false, 1);\n        }\n        return this._emptyTexture;\n    }\n    /**\n     * Gets the default empty 3D texture\n     */\n    get emptyTexture3D() {\n        if (!this._emptyTexture3D) {\n            this._emptyTexture3D = this.createRawTexture3D(new Uint8Array(4), 1, 1, 1, 5, false, false, 1);\n        }\n        return this._emptyTexture3D;\n    }\n    /**\n     * Gets the default empty 2D array texture\n     */\n    get emptyTexture2DArray() {\n        if (!this._emptyTexture2DArray) {\n            this._emptyTexture2DArray = this.createRawTexture2DArray(new Uint8Array(4), 1, 1, 1, 5, false, false, 1);\n        }\n        return this._emptyTexture2DArray;\n    }\n    /**\n     * Gets the default empty cube texture\n     */\n    get emptyCubeTexture() {\n        if (!this._emptyCubeTexture) {\n            const faceData = new Uint8Array(4);\n            const cubeData = [faceData, faceData, faceData, faceData, faceData, faceData];\n            this._emptyCubeTexture = this.createRawCubeTexture(cubeData, 1, 5, 0, false, false, 1);\n        }\n        return this._emptyCubeTexture;\n    }\n    /**\n     * Gets a boolean indicating if the engine runs in WebGPU or not.\n     */\n    get isWebGPU() {\n        return this._isWebGPU;\n    }\n    /**\n     * Gets the shader platform name used by the effects.\n     */\n    get shaderPlatformName() {\n        return this._shaderPlatformName;\n    }\n    /**\n     * Enables or disables the snapshot rendering mode\n     * Note that the WebGL engine does not support snapshot rendering so setting the value won't have any effect for this engine\n     */\n    get snapshotRendering() {\n        return false;\n    }\n    set snapshotRendering(activate) {\n        // WebGL engine does not support snapshot rendering\n    }\n    /**\n     * Gets or sets the snapshot rendering mode\n     */\n    get snapshotRenderingMode() {\n        return this._snapshotRenderingMode;\n    }\n    set snapshotRenderingMode(mode) {\n        this._snapshotRenderingMode = mode;\n    }\n    /**\n     * Gets a boolean indicating if the exact sRGB conversions or faster approximations are used for converting to and from linear space.\n     */\n    get useExactSrgbConversions() {\n        return this._useExactSrgbConversions;\n    }\n    /**\n     * Creates a new snapshot at the next frame using the current snapshotRenderingMode\n     */\n    snapshotRenderingReset() {\n        this.snapshotRendering = false;\n    }\n    static _CreateCanvas(width, height) {\n        if (typeof document === \"undefined\") {\n            return new OffscreenCanvas(width, height);\n        }\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = width;\n        canvas.height = height;\n        return canvas;\n    }\n    /**\n     * Create a canvas. This method is overridden by other engines\n     * @param width width\n     * @param height height\n     * @returns ICanvas interface\n     */\n    createCanvas(width, height) {\n        return ThinEngine._CreateCanvas(width, height);\n    }\n    /**\n     * Create an image to use with canvas\n     * @returns IImage interface\n     */\n    createCanvasImage() {\n        return document.createElement(\"img\");\n    }\n    /**\n     * Creates a new engine\n     * @param canvasOrContext defines the canvas or WebGL context to use for rendering. If you provide a WebGL context, Babylon.js will not hook events on the canvas (like pointers, keyboards, etc...) so no event observables will be available. This is mostly used when Babylon.js is used as a plugin on a system which already used the WebGL context\n     * @param antialias defines enable antialiasing (default: false)\n     * @param options defines further options to be sent to the getContext() function\n     * @param adaptToDeviceRatio defines whether to adapt to the device's viewport characteristics (default: false)\n     */\n    constructor(canvasOrContext, antialias, options, adaptToDeviceRatio) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;\n        /** @internal */\n        this._name = \"WebGL\";\n        /**\n         * Gets or sets a boolean that indicates if textures must be forced to power of 2 size even if not required\n         */\n        this.forcePOTTextures = false;\n        /**\n         * Gets a boolean indicating if the engine is currently rendering in fullscreen mode\n         */\n        this.isFullscreen = false;\n        /**\n         * Gets or sets a boolean indicating if back faces must be culled. If false, front faces are culled instead (true by default)\n         * If non null, this takes precedence over the value from the material\n         */\n        this.cullBackFaces = null;\n        /**\n         * Gets or sets a boolean indicating if the engine must keep rendering even if the window is not in foreground\n         */\n        this.renderEvenInBackground = true;\n        /**\n         * Gets or sets a boolean indicating that cache can be kept between frames\n         */\n        this.preventCacheWipeBetweenFrames = false;\n        /** Gets or sets a boolean indicating if the engine should validate programs after compilation */\n        this.validateShaderPrograms = false;\n        this._useReverseDepthBuffer = false;\n        /**\n         * Indicates if the z range in NDC space is 0..1 (value: true) or -1..1 (value: false)\n         */\n        this.isNDCHalfZRange = false;\n        /**\n         * Indicates that the origin of the texture/framebuffer space is the bottom left corner. If false, the origin is top left\n         */\n        this.hasOriginBottomLeft = true;\n        /**\n         * Gets or sets a boolean indicating that uniform buffers must be disabled even if they are supported\n         */\n        this.disableUniformBuffers = false;\n        /**\n         * An event triggered when the engine is disposed.\n         */\n        this.onDisposeObservable = new Observable();\n        this._frameId = 0;\n        /** @internal */\n        this._uniformBuffers = new Array();\n        /** @internal */\n        this._storageBuffers = new Array();\n        /** @internal */\n        this._webGLVersion = 1.0;\n        this._windowIsBackground = false;\n        this._highPrecisionShadersAllowed = true;\n        /** @internal */\n        this._badOS = false;\n        /** @internal */\n        this._badDesktopOS = false;\n        this._renderingQueueLaunched = false;\n        this._activeRenderLoops = new Array();\n        // Lost context\n        /**\n         * Observable signaled when a context lost event is raised\n         */\n        this.onContextLostObservable = new Observable();\n        /**\n         * Observable signaled when a context restored event is raised\n         */\n        this.onContextRestoredObservable = new Observable();\n        this._contextWasLost = false;\n        /** @internal */\n        this._doNotHandleContextLost = false;\n        /**\n         * Gets or sets a boolean indicating that vertex array object must be disabled even if they are supported\n         */\n        this.disableVertexArrayObjects = false;\n        // States\n        /** @internal */\n        this._colorWrite = true;\n        /** @internal */\n        this._colorWriteChanged = true;\n        /** @internal */\n        this._depthCullingState = new DepthCullingState();\n        /** @internal */\n        this._stencilStateComposer = new StencilStateComposer();\n        /** @internal */\n        this._stencilState = new StencilState();\n        /** @internal */\n        this._alphaState = new AlphaState();\n        /** @internal */\n        this._alphaMode = 1;\n        /** @internal */\n        this._alphaEquation = 0;\n        // Cache\n        /** @internal */\n        this._internalTexturesCache = new Array();\n        /** @internal */\n        this._renderTargetWrapperCache = new Array();\n        /** @internal */\n        this._activeChannel = 0;\n        this._currentTextureChannel = -1;\n        /** @internal */\n        this._boundTexturesCache = {};\n        this._compiledEffects = {};\n        this._vertexAttribArraysEnabled = [];\n        this._uintIndicesCurrentlySet = false;\n        this._currentBoundBuffer = new Array();\n        /** @internal */\n        this._currentFramebuffer = null;\n        /** @internal */\n        this._dummyFramebuffer = null;\n        this._currentBufferPointers = new Array();\n        this._currentInstanceLocations = new Array();\n        this._currentInstanceBuffers = new Array();\n        this._vaoRecordInProgress = false;\n        this._mustWipeVertexAttributes = false;\n        this._nextFreeTextureSlots = new Array();\n        this._maxSimultaneousTextures = 0;\n        this._maxMSAASamplesOverride = null;\n        this._activeRequests = new Array();\n        /**\n         * If set to true zooming in and out in the browser will rescale the hardware-scaling correctly.\n         */\n        this.adaptToDeviceRatio = false;\n        /** @internal */\n        this._lastDevicePixelRatio = 1.0;\n        /** @internal */\n        this._transformTextureUrl = null;\n        /**\n         * Gets information about the current host\n         */\n        this.hostInformation = {\n            isMobile: false,\n        };\n        /**\n         * Defines whether the engine has been created with the premultipliedAlpha option on or not.\n         */\n        this.premultipliedAlpha = true;\n        /**\n         * Observable event triggered before each texture is initialized\n         */\n        this.onBeforeTextureInitObservable = new Observable();\n        /** @internal */\n        this._isWebGPU = false;\n        this._snapshotRenderingMode = 0;\n        this._useExactSrgbConversions = false;\n        this._viewportCached = { x: 0, y: 0, z: 0, w: 0 };\n        this._unpackFlipYCached = null;\n        /**\n         * In case you are sharing the context with other applications, it might\n         * be interested to not cache the unpack flip y state to ensure a consistent\n         * value would be set.\n         */\n        this.enableUnpackFlipYCached = true;\n        this._boundUniforms = {};\n        this.startTime = PrecisionDate.Now;\n        let canvas = null;\n        options = options || {};\n        this._creationOptions = options;\n        // Save this off for use in resize().\n        this.adaptToDeviceRatio = adaptToDeviceRatio !== null && adaptToDeviceRatio !== void 0 ? adaptToDeviceRatio : false;\n        this._stencilStateComposer.stencilGlobal = this._stencilState;\n        PerformanceConfigurator.SetMatrixPrecision(!!options.useHighPrecisionMatrix);\n        options.antialias = antialias !== null && antialias !== void 0 ? antialias : options.antialias;\n        options.deterministicLockstep = (_a = options.deterministicLockstep) !== null && _a !== void 0 ? _a : false;\n        options.lockstepMaxSteps = (_b = options.lockstepMaxSteps) !== null && _b !== void 0 ? _b : 4;\n        options.timeStep = (_c = options.timeStep) !== null && _c !== void 0 ? _c : 1 / 60;\n        options.audioEngine = (_d = options.audioEngine) !== null && _d !== void 0 ? _d : true;\n        options.stencil = (_e = options.stencil) !== null && _e !== void 0 ? _e : true;\n        this._audioContext = (_g = (_f = options.audioEngineOptions) === null || _f === void 0 ? void 0 : _f.audioContext) !== null && _g !== void 0 ? _g : null;\n        this._audioDestination = (_j = (_h = options.audioEngineOptions) === null || _h === void 0 ? void 0 : _h.audioDestination) !== null && _j !== void 0 ? _j : null;\n        this.premultipliedAlpha = (_k = options.premultipliedAlpha) !== null && _k !== void 0 ? _k : true;\n        this._useExactSrgbConversions = (_l = options.useExactSrgbConversions) !== null && _l !== void 0 ? _l : false;\n        this._doNotHandleContextLost = !!options.doNotHandleContextLost;\n        this._isStencilEnable = options.stencil ? true : false;\n        // Viewport\n        adaptToDeviceRatio = adaptToDeviceRatio || options.adaptToDeviceRatio || false;\n        const devicePixelRatio = IsWindowObjectExist() ? window.devicePixelRatio || 1.0 : 1.0;\n        const limitDeviceRatio = options.limitDeviceRatio || devicePixelRatio;\n        this._hardwareScalingLevel = adaptToDeviceRatio ? 1.0 / Math.min(limitDeviceRatio, devicePixelRatio) : 1.0;\n        this._lastDevicePixelRatio = devicePixelRatio;\n        if (!canvasOrContext) {\n            return;\n        }\n        if (canvasOrContext.getContext) {\n            canvas = canvasOrContext;\n            this._renderingCanvas = canvas;\n            if (options.preserveDrawingBuffer === undefined) {\n                options.preserveDrawingBuffer = false;\n            }\n            if (options.xrCompatible === undefined) {\n                options.xrCompatible = true;\n            }\n            // Exceptions\n            if (navigator && navigator.userAgent) {\n                this._setupMobileChecks();\n                const ua = navigator.userAgent;\n                for (const exception of ThinEngine.ExceptionList) {\n                    const key = exception.key;\n                    const targets = exception.targets;\n                    const check = new RegExp(key);\n                    if (check.test(ua)) {\n                        if (exception.capture && exception.captureConstraint) {\n                            const capture = exception.capture;\n                            const constraint = exception.captureConstraint;\n                            const regex = new RegExp(capture);\n                            const matches = regex.exec(ua);\n                            if (matches && matches.length > 0) {\n                                const capturedValue = parseInt(matches[matches.length - 1]);\n                                if (capturedValue >= constraint) {\n                                    continue;\n                                }\n                            }\n                        }\n                        for (const target of targets) {\n                            switch (target) {\n                                case \"uniformBuffer\":\n                                    this.disableUniformBuffers = true;\n                                    break;\n                                case \"vao\":\n                                    this.disableVertexArrayObjects = true;\n                                    break;\n                                case \"antialias\":\n                                    options.antialias = false;\n                                    break;\n                                case \"maxMSAASamples\":\n                                    this._maxMSAASamplesOverride = 1;\n                                    break;\n                            }\n                        }\n                    }\n                }\n            }\n            // Context lost\n            if (!this._doNotHandleContextLost) {\n                this._onContextLost = (evt) => {\n                    evt.preventDefault();\n                    this._contextWasLost = true;\n                    Logger.Warn(\"WebGL context lost.\");\n                    this.onContextLostObservable.notifyObservers(this);\n                };\n                this._onContextRestored = () => {\n                    this._restoreEngineAfterContextLost(this._initGLContext.bind(this));\n                };\n                canvas.addEventListener(\"webglcontextlost\", this._onContextLost, false);\n                canvas.addEventListener(\"webglcontextrestored\", this._onContextRestored, false);\n                options.powerPreference = \"high-performance\";\n            }\n            // Detect if we are running on a faulty buggy desktop OS.\n            this._badDesktopOS = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n            if (this._badDesktopOS) {\n                options.xrCompatible = false;\n            }\n            // GL\n            if (!options.disableWebGL2Support) {\n                try {\n                    this._gl = (canvas.getContext(\"webgl2\", options) || canvas.getContext(\"experimental-webgl2\", options));\n                    if (this._gl) {\n                        this._webGLVersion = 2.0;\n                        this._shaderPlatformName = \"WEBGL2\";\n                        // Prevent weird browsers to lie (yeah that happens!)\n                        if (!this._gl.deleteQuery) {\n                            this._webGLVersion = 1.0;\n                            this._shaderPlatformName = \"WEBGL1\";\n                        }\n                    }\n                }\n                catch (e) {\n                    // Do nothing\n                }\n            }\n            if (!this._gl) {\n                if (!canvas) {\n                    throw new Error(\"The provided canvas is null or undefined.\");\n                }\n                try {\n                    this._gl = (canvas.getContext(\"webgl\", options) || canvas.getContext(\"experimental-webgl\", options));\n                }\n                catch (e) {\n                    throw new Error(\"WebGL not supported\");\n                }\n            }\n            if (!this._gl) {\n                throw new Error(\"WebGL not supported\");\n            }\n        }\n        else {\n            this._gl = canvasOrContext;\n            this._renderingCanvas = this._gl.canvas;\n            if (this._gl.renderbufferStorageMultisample) {\n                this._webGLVersion = 2.0;\n                this._shaderPlatformName = \"WEBGL2\";\n            }\n            else {\n                this._shaderPlatformName = \"WEBGL1\";\n            }\n            const attributes = this._gl.getContextAttributes();\n            if (attributes) {\n                options.stencil = attributes.stencil;\n            }\n        }\n        // Ensures a consistent color space unpacking of textures cross browser.\n        this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE);\n        if (options.useHighPrecisionFloats !== undefined) {\n            this._highPrecisionShadersAllowed = options.useHighPrecisionFloats;\n        }\n        this.resize();\n        this._initGLContext();\n        this._initFeatures();\n        // Prepare buffer pointers\n        for (let i = 0; i < this._caps.maxVertexAttribs; i++) {\n            this._currentBufferPointers[i] = new BufferPointer();\n        }\n        // Shader processor\n        this._shaderProcessor = this.webGLVersion > 1 ? new WebGL2ShaderProcessor() : new WebGLShaderProcessor();\n        // Detect if we are running on a faulty buggy OS.\n        this._badOS = /iPad/i.test(navigator.userAgent) || /iPhone/i.test(navigator.userAgent);\n        // Starting with iOS 14, we can trust the browser\n        // let matches = navigator.userAgent.match(/Version\\/(\\d+)/);\n        // if (matches && matches.length === 2) {\n        //     if (parseInt(matches[1]) >= 14) {\n        //         this._badOS = false;\n        //     }\n        // }\n        const versionToLog = `Babylon.js v${ThinEngine.Version}`;\n        console.log(versionToLog + ` - ${this.description}`);\n        // Check setAttribute in case of workers\n        if (this._renderingCanvas && this._renderingCanvas.setAttribute) {\n            this._renderingCanvas.setAttribute(\"data-engine\", versionToLog);\n        }\n    }\n    _setupMobileChecks() {\n        if (!(navigator && navigator.userAgent)) {\n            return;\n        }\n        // Function to check if running on mobile device\n        this._checkForMobile = () => {\n            const currentUA = navigator.userAgent;\n            this.hostInformation.isMobile =\n                currentUA.indexOf(\"Mobile\") !== -1 ||\n                    // Needed for iOS 13+ detection on iPad (inspired by solution from https://stackoverflow.com/questions/9038625/detect-if-device-is-ios)\n                    (currentUA.indexOf(\"Mac\") !== -1 && IsDocumentAvailable() && \"ontouchend\" in document);\n        };\n        // Set initial isMobile value\n        this._checkForMobile();\n        // Set up event listener to check when window is resized (used to get emulator activation to work properly)\n        if (IsWindowObjectExist()) {\n            window.addEventListener(\"resize\", this._checkForMobile);\n        }\n    }\n    _restoreEngineAfterContextLost(initEngine) {\n        // Adding a timeout to avoid race condition at browser level\n        setTimeout(async () => {\n            var _a;\n            this._dummyFramebuffer = null;\n            const depthTest = this._depthCullingState.depthTest; // backup those values because the call to initEngine / wipeCaches will reset them\n            const depthFunc = this._depthCullingState.depthFunc;\n            const depthMask = this._depthCullingState.depthMask;\n            const stencilTest = this._stencilState.stencilTest;\n            // Rebuild context\n            await initEngine();\n            // Ensure webgl and engine states are matching\n            this.wipeCaches(true);\n            // Rebuild effects\n            this._rebuildEffects();\n            (_a = this._rebuildComputeEffects) === null || _a === void 0 ? void 0 : _a.call(this);\n            // Note:\n            //  The call to _rebuildBuffers must be made before the call to _rebuildInternalTextures because in the process of _rebuildBuffers the buffers used by the post process managers will be rebuilt\n            //  and we may need to use the post process manager of the scene during _rebuildInternalTextures (in WebGL1, non-POT textures are rescaled using a post process + post process manager of the scene)\n            // Rebuild buffers\n            this._rebuildBuffers();\n            // Rebuild textures\n            this._rebuildInternalTextures();\n            // Rebuild textures\n            this._rebuildRenderTargetWrappers();\n            // Reset engine states after all the buffer/textures/... have been rebuilt\n            this.wipeCaches(true);\n            this._depthCullingState.depthTest = depthTest;\n            this._depthCullingState.depthFunc = depthFunc;\n            this._depthCullingState.depthMask = depthMask;\n            this._stencilState.stencilTest = stencilTest;\n            Logger.Warn(this.name + \" context successfully restored.\");\n            this.onContextRestoredObservable.notifyObservers(this);\n            this._contextWasLost = false;\n        }, 0);\n    }\n    /**\n     * Shared initialization across engines types.\n     * @param canvas The canvas associated with this instance of the engine.\n     */\n    _sharedInit(canvas) {\n        this._renderingCanvas = canvas;\n    }\n    /**\n     * @internal\n     */\n    _getShaderProcessingContext(shaderLanguage) {\n        return null;\n    }\n    _rebuildInternalTextures() {\n        const currentState = this._internalTexturesCache.slice(); // Do a copy because the rebuild will add proxies\n        for (const internalTexture of currentState) {\n            internalTexture._rebuild();\n        }\n    }\n    _rebuildRenderTargetWrappers() {\n        const currentState = this._renderTargetWrapperCache.slice(); // Do a copy because the rebuild will add proxies\n        for (const renderTargetWrapper of currentState) {\n            renderTargetWrapper._rebuild();\n        }\n    }\n    _rebuildEffects() {\n        for (const key in this._compiledEffects) {\n            const effect = this._compiledEffects[key];\n            effect._pipelineContext = null; // because _prepareEffect will try to dispose this pipeline before recreating it and that would lead to webgl errors\n            effect._wasPreviouslyReady = false;\n            effect._prepareEffect();\n        }\n        Effect.ResetCache();\n    }\n    /**\n     * Gets a boolean indicating if all created effects are ready\n     * @returns true if all effects are ready\n     */\n    areAllEffectsReady() {\n        for (const key in this._compiledEffects) {\n            const effect = this._compiledEffects[key];\n            if (!effect.isReady()) {\n                return false;\n            }\n        }\n        return true;\n    }\n    _rebuildBuffers() {\n        // Uniforms\n        for (const uniformBuffer of this._uniformBuffers) {\n            uniformBuffer._rebuild();\n        }\n        // Storage buffers\n        for (const storageBuffer of this._storageBuffers) {\n            storageBuffer._rebuild();\n        }\n    }\n    _initGLContext() {\n        var _a;\n        // Caps\n        this._caps = {\n            maxTexturesImageUnits: this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),\n            maxCombinedTexturesImageUnits: this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),\n            maxVertexTextureImageUnits: this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),\n            maxTextureSize: this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),\n            maxSamples: this._webGLVersion > 1 ? this._gl.getParameter(this._gl.MAX_SAMPLES) : 1,\n            maxCubemapTextureSize: this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),\n            maxRenderTextureSize: this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),\n            maxVertexAttribs: this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),\n            maxVaryingVectors: this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),\n            maxFragmentUniformVectors: this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),\n            maxVertexUniformVectors: this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),\n            parallelShaderCompile: this._gl.getExtension(\"KHR_parallel_shader_compile\") || undefined,\n            standardDerivatives: this._webGLVersion > 1 || this._gl.getExtension(\"OES_standard_derivatives\") !== null,\n            maxAnisotropy: 1,\n            astc: this._gl.getExtension(\"WEBGL_compressed_texture_astc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_astc\"),\n            bptc: this._gl.getExtension(\"EXT_texture_compression_bptc\") || this._gl.getExtension(\"WEBKIT_EXT_texture_compression_bptc\"),\n            s3tc: this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\"),\n            // eslint-disable-next-line @typescript-eslint/naming-convention\n            s3tc_srgb: this._gl.getExtension(\"WEBGL_compressed_texture_s3tc_srgb\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc_srgb\"),\n            pvrtc: this._gl.getExtension(\"WEBGL_compressed_texture_pvrtc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\"),\n            etc1: this._gl.getExtension(\"WEBGL_compressed_texture_etc1\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_etc1\"),\n            etc2: this._gl.getExtension(\"WEBGL_compressed_texture_etc\") ||\n                this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_etc\") ||\n                this._gl.getExtension(\"WEBGL_compressed_texture_es3_0\"),\n            textureAnisotropicFilterExtension: this._gl.getExtension(\"EXT_texture_filter_anisotropic\") ||\n                this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\") ||\n                this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),\n            uintIndices: this._webGLVersion > 1 || this._gl.getExtension(\"OES_element_index_uint\") !== null,\n            fragmentDepthSupported: this._webGLVersion > 1 || this._gl.getExtension(\"EXT_frag_depth\") !== null,\n            highPrecisionShaderSupported: false,\n            timerQuery: this._gl.getExtension(\"EXT_disjoint_timer_query_webgl2\") || this._gl.getExtension(\"EXT_disjoint_timer_query\"),\n            supportOcclusionQuery: this._webGLVersion > 1,\n            canUseTimestampForTimerQuery: false,\n            drawBuffersExtension: false,\n            maxMSAASamples: 1,\n            colorBufferFloat: !!(this._webGLVersion > 1 && this._gl.getExtension(\"EXT_color_buffer_float\")),\n            textureFloat: this._webGLVersion > 1 || this._gl.getExtension(\"OES_texture_float\") ? true : false,\n            textureHalfFloat: this._webGLVersion > 1 || this._gl.getExtension(\"OES_texture_half_float\") ? true : false,\n            textureHalfFloatRender: false,\n            textureFloatLinearFiltering: false,\n            textureFloatRender: false,\n            textureHalfFloatLinearFiltering: false,\n            vertexArrayObject: false,\n            instancedArrays: false,\n            textureLOD: this._webGLVersion > 1 || this._gl.getExtension(\"EXT_shader_texture_lod\") ? true : false,\n            blendMinMax: false,\n            multiview: this._gl.getExtension(\"OVR_multiview2\"),\n            oculusMultiview: this._gl.getExtension(\"OCULUS_multiview\"),\n            depthTextureExtension: false,\n            canUseGLInstanceID: this._webGLVersion > 1,\n            canUseGLVertexID: this._webGLVersion > 1,\n            supportComputeShaders: false,\n            supportSRGBBuffers: false,\n            supportTransformFeedbacks: this._webGLVersion > 1,\n            textureMaxLevel: this._webGLVersion > 1,\n            texture2DArrayMaxLayerCount: this._webGLVersion > 1 ? this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS) : 128,\n        };\n        // Infos\n        this._glVersion = this._gl.getParameter(this._gl.VERSION);\n        const rendererInfo = this._gl.getExtension(\"WEBGL_debug_renderer_info\");\n        if (rendererInfo != null) {\n            this._glRenderer = this._gl.getParameter(rendererInfo.UNMASKED_RENDERER_WEBGL);\n            this._glVendor = this._gl.getParameter(rendererInfo.UNMASKED_VENDOR_WEBGL);\n        }\n        if (!this._glVendor) {\n            this._glVendor = this._gl.getParameter(this._gl.VENDOR) || \"Unknown vendor\";\n        }\n        if (!this._glRenderer) {\n            this._glRenderer = this._gl.getParameter(this._gl.RENDERER) || \"Unknown renderer\";\n        }\n        // Constants\n        if (this._gl.HALF_FLOAT_OES !== 0x8d61) {\n            this._gl.HALF_FLOAT_OES = 0x8d61; // Half floating-point type (16-bit).\n        }\n        if (this._gl.RGBA16F !== 0x881a) {\n            this._gl.RGBA16F = 0x881a; // RGBA 16-bit floating-point color-renderable internal sized format.\n        }\n        if (this._gl.RGBA32F !== 0x8814) {\n            this._gl.RGBA32F = 0x8814; // RGBA 32-bit floating-point color-renderable internal sized format.\n        }\n        if (this._gl.DEPTH24_STENCIL8 !== 35056) {\n            this._gl.DEPTH24_STENCIL8 = 35056;\n        }\n        // Extensions\n        if (this._caps.timerQuery) {\n            if (this._webGLVersion === 1) {\n                this._gl.getQuery = this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery);\n            }\n            this._caps.canUseTimestampForTimerQuery = ((_a = this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT, this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)) !== null && _a !== void 0 ? _a : 0) > 0;\n        }\n        this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension\n            ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)\n            : 0;\n        this._caps.textureFloatLinearFiltering = this._caps.textureFloat && this._gl.getExtension(\"OES_texture_float_linear\") ? true : false;\n        this._caps.textureFloatRender = this._caps.textureFloat && this._canRenderToFloatFramebuffer() ? true : false;\n        this._caps.textureHalfFloatLinearFiltering =\n            this._webGLVersion > 1 || (this._caps.textureHalfFloat && this._gl.getExtension(\"OES_texture_half_float_linear\")) ? true : false;\n        // Compressed formats\n        if (this._caps.astc) {\n            this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR = this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;\n        }\n        if (this._caps.bptc) {\n            this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT = this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;\n        }\n        if (this._caps.s3tc_srgb) {\n            this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT;\n            this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\n            this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\n        }\n        if (this._caps.etc2) {\n            this._gl.COMPRESSED_SRGB8_ETC2 = this._caps.etc2.COMPRESSED_SRGB8_ETC2;\n            this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC = this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;\n        }\n        // Checks if some of the format renders first to allow the use of webgl inspector.\n        if (this._webGLVersion > 1) {\n            if (this._gl.HALF_FLOAT_OES !== 0x140b) {\n                this._gl.HALF_FLOAT_OES = 0x140b;\n            }\n        }\n        this._caps.textureHalfFloatRender = this._caps.textureHalfFloat && this._canRenderToHalfFloatFramebuffer();\n        // Draw buffers\n        if (this._webGLVersion > 1) {\n            this._caps.drawBuffersExtension = true;\n            this._caps.maxMSAASamples = this._maxMSAASamplesOverride !== null ? this._maxMSAASamplesOverride : this._gl.getParameter(this._gl.MAX_SAMPLES);\n        }\n        else {\n            const drawBuffersExtension = this._gl.getExtension(\"WEBGL_draw_buffers\");\n            if (drawBuffersExtension !== null) {\n                this._caps.drawBuffersExtension = true;\n                this._gl.drawBuffers = drawBuffersExtension.drawBuffersWEBGL.bind(drawBuffersExtension);\n                this._gl.DRAW_FRAMEBUFFER = this._gl.FRAMEBUFFER;\n                for (let i = 0; i < 16; i++) {\n                    this._gl[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"] = drawBuffersExtension[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"];\n                }\n            }\n        }\n        // Depth Texture\n        if (this._webGLVersion > 1) {\n            this._caps.depthTextureExtension = true;\n        }\n        else {\n            const depthTextureExtension = this._gl.getExtension(\"WEBGL_depth_texture\");\n            if (depthTextureExtension != null) {\n                this._caps.depthTextureExtension = true;\n                this._gl.UNSIGNED_INT_24_8 = depthTextureExtension.UNSIGNED_INT_24_8_WEBGL;\n            }\n        }\n        // Vertex array object\n        if (this.disableVertexArrayObjects) {\n            this._caps.vertexArrayObject = false;\n        }\n        else if (this._webGLVersion > 1) {\n            this._caps.vertexArrayObject = true;\n        }\n        else {\n            const vertexArrayObjectExtension = this._gl.getExtension(\"OES_vertex_array_object\");\n            if (vertexArrayObjectExtension != null) {\n                this._caps.vertexArrayObject = true;\n                this._gl.createVertexArray = vertexArrayObjectExtension.createVertexArrayOES.bind(vertexArrayObjectExtension);\n                this._gl.bindVertexArray = vertexArrayObjectExtension.bindVertexArrayOES.bind(vertexArrayObjectExtension);\n                this._gl.deleteVertexArray = vertexArrayObjectExtension.deleteVertexArrayOES.bind(vertexArrayObjectExtension);\n            }\n        }\n        // Instances count\n        if (this._webGLVersion > 1) {\n            this._caps.instancedArrays = true;\n        }\n        else {\n            const instanceExtension = this._gl.getExtension(\"ANGLE_instanced_arrays\");\n            if (instanceExtension != null) {\n                this._caps.instancedArrays = true;\n                this._gl.drawArraysInstanced = instanceExtension.drawArraysInstancedANGLE.bind(instanceExtension);\n                this._gl.drawElementsInstanced = instanceExtension.drawElementsInstancedANGLE.bind(instanceExtension);\n                this._gl.vertexAttribDivisor = instanceExtension.vertexAttribDivisorANGLE.bind(instanceExtension);\n            }\n            else {\n                this._caps.instancedArrays = false;\n            }\n        }\n        if (this._gl.getShaderPrecisionFormat) {\n            const vertexhighp = this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER, this._gl.HIGH_FLOAT);\n            const fragmenthighp = this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER, this._gl.HIGH_FLOAT);\n            if (vertexhighp && fragmenthighp) {\n                this._caps.highPrecisionShaderSupported = vertexhighp.precision !== 0 && fragmenthighp.precision !== 0;\n            }\n        }\n        if (this._webGLVersion > 1) {\n            this._caps.blendMinMax = true;\n        }\n        else {\n            const blendMinMaxExtension = this._gl.getExtension(\"EXT_blend_minmax\");\n            if (blendMinMaxExtension != null) {\n                this._caps.blendMinMax = true;\n                this._gl.MAX = blendMinMaxExtension.MAX_EXT;\n                this._gl.MIN = blendMinMaxExtension.MIN_EXT;\n            }\n        }\n        // sRGB buffers\n        // only run this if not already set to true (in the constructor, for example)\n        if (!this._caps.supportSRGBBuffers) {\n            if (this._webGLVersion > 1) {\n                this._caps.supportSRGBBuffers = true;\n            }\n            else {\n                const sRGBExtension = this._gl.getExtension(\"EXT_sRGB\");\n                if (sRGBExtension != null) {\n                    this._caps.supportSRGBBuffers = true;\n                    this._gl.SRGB = sRGBExtension.SRGB_EXT;\n                    this._gl.SRGB8 = sRGBExtension.SRGB_ALPHA_EXT;\n                    this._gl.SRGB8_ALPHA8 = sRGBExtension.SRGB_ALPHA_EXT;\n                }\n            }\n            // take into account the forced state that was provided in options\n            // When the issue in angle/chrome is fixed the flag should be taken into account only when it is explicitly defined\n            this._caps.supportSRGBBuffers = this._caps.supportSRGBBuffers && !!(this._creationOptions && this._creationOptions.forceSRGBBufferSupportState);\n        }\n        // Depth buffer\n        this._depthCullingState.depthTest = true;\n        this._depthCullingState.depthFunc = this._gl.LEQUAL;\n        this._depthCullingState.depthMask = true;\n        // Texture maps\n        this._maxSimultaneousTextures = this._caps.maxCombinedTexturesImageUnits;\n        for (let slot = 0; slot < this._maxSimultaneousTextures; slot++) {\n            this._nextFreeTextureSlots.push(slot);\n        }\n    }\n    _initFeatures() {\n        this._features = {\n            forceBitmapOverHTMLImageElement: false,\n            supportRenderAndCopyToLodForFloatTextures: this._webGLVersion !== 1,\n            supportDepthStencilTexture: this._webGLVersion !== 1,\n            supportShadowSamplers: this._webGLVersion !== 1,\n            uniformBufferHardCheckMatrix: false,\n            allowTexturePrefiltering: this._webGLVersion !== 1,\n            trackUbosInFrame: false,\n            checkUbosContentBeforeUpload: false,\n            supportCSM: this._webGLVersion !== 1,\n            basisNeedsPOT: this._webGLVersion === 1,\n            support3DTextures: this._webGLVersion !== 1,\n            needTypeSuffixInShaderConstants: this._webGLVersion !== 1,\n            supportMSAA: this._webGLVersion !== 1,\n            supportSSAO2: this._webGLVersion !== 1,\n            supportExtendedTextureFormats: this._webGLVersion !== 1,\n            supportSwitchCaseInShader: this._webGLVersion !== 1,\n            supportSyncTextureRead: true,\n            needsInvertingBitmap: true,\n            useUBOBindingCache: true,\n            needShaderCodeInlining: false,\n            needToAlwaysBindUniformBuffers: false,\n            supportRenderPasses: false,\n            supportSpriteInstancing: true,\n            _collectUbosUpdatedInFrame: false,\n        };\n    }\n    /**\n     * Gets version of the current webGL context\n     * Keep it for back compat - use version instead\n     */\n    get webGLVersion() {\n        return this._webGLVersion;\n    }\n    /**\n     * Gets a string identifying the name of the class\n     * @returns \"Engine\" string\n     */\n    getClassName() {\n        return \"ThinEngine\";\n    }\n    /**\n     * Returns true if the stencil buffer has been enabled through the creation option of the context.\n     */\n    get isStencilEnable() {\n        return this._isStencilEnable;\n    }\n    /** @internal */\n    _prepareWorkingCanvas() {\n        if (this._workingCanvas) {\n            return;\n        }\n        this._workingCanvas = this.createCanvas(1, 1);\n        const context = this._workingCanvas.getContext(\"2d\");\n        if (context) {\n            this._workingContext = context;\n        }\n    }\n    /**\n     * Reset the texture cache to empty state\n     */\n    resetTextureCache() {\n        for (const key in this._boundTexturesCache) {\n            if (!Object.prototype.hasOwnProperty.call(this._boundTexturesCache, key)) {\n                continue;\n            }\n            this._boundTexturesCache[key] = null;\n        }\n        this._currentTextureChannel = -1;\n    }\n    /**\n     * Gets an object containing information about the current engine context\n     * @returns an object containing the vendor, the renderer and the version of the current engine context\n     */\n    getInfo() {\n        return this.getGlInfo();\n    }\n    /**\n     * Gets an object containing information about the current webGL context\n     * @returns an object containing the vendor, the renderer and the version of the current webGL context\n     */\n    getGlInfo() {\n        return {\n            vendor: this._glVendor,\n            renderer: this._glRenderer,\n            version: this._glVersion,\n        };\n    }\n    /**\n     * Defines the hardware scaling level.\n     * By default the hardware scaling level is computed from the window device ratio.\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\n     * @param level defines the level to use\n     */\n    setHardwareScalingLevel(level) {\n        this._hardwareScalingLevel = level;\n        this.resize();\n    }\n    /**\n     * Gets the current hardware scaling level.\n     * By default the hardware scaling level is computed from the window device ratio.\n     * if level = 1 then the engine will render at the exact resolution of the canvas. If level = 0.5 then the engine will render at twice the size of the canvas.\n     * @returns a number indicating the current hardware scaling level\n     */\n    getHardwareScalingLevel() {\n        return this._hardwareScalingLevel;\n    }\n    /**\n     * Gets the list of loaded textures\n     * @returns an array containing all loaded textures\n     */\n    getLoadedTexturesCache() {\n        return this._internalTexturesCache;\n    }\n    /**\n     * Gets the object containing all engine capabilities\n     * @returns the EngineCapabilities object\n     */\n    getCaps() {\n        return this._caps;\n    }\n    /**\n     * stop executing a render loop function and remove it from the execution array\n     * @param renderFunction defines the function to be removed. If not provided all functions will be removed.\n     */\n    stopRenderLoop(renderFunction) {\n        if (!renderFunction) {\n            this._activeRenderLoops = [];\n            return;\n        }\n        const index = this._activeRenderLoops.indexOf(renderFunction);\n        if (index >= 0) {\n            this._activeRenderLoops.splice(index, 1);\n        }\n    }\n    /** @internal */\n    _renderLoop() {\n        if (!this._contextWasLost) {\n            let shouldRender = true;\n            if (!this.renderEvenInBackground && this._windowIsBackground) {\n                shouldRender = false;\n            }\n            if (shouldRender) {\n                // Start new frame\n                this.beginFrame();\n                for (let index = 0; index < this._activeRenderLoops.length; index++) {\n                    const renderFunction = this._activeRenderLoops[index];\n                    renderFunction();\n                }\n                // Present\n                this.endFrame();\n            }\n        }\n        if (this._activeRenderLoops.length > 0) {\n            this._frameHandler = this._queueNewFrame(this._boundRenderFunction, this.getHostWindow());\n        }\n        else {\n            this._renderingQueueLaunched = false;\n        }\n    }\n    /**\n     * Gets the HTML canvas attached with the current webGL context\n     * @returns a HTML canvas\n     */\n    getRenderingCanvas() {\n        return this._renderingCanvas;\n    }\n    /**\n     * Gets the audio context specified in engine initialization options\n     * @returns an Audio Context\n     */\n    getAudioContext() {\n        return this._audioContext;\n    }\n    /**\n     * Gets the audio destination specified in engine initialization options\n     * @returns an audio destination node\n     */\n    getAudioDestination() {\n        return this._audioDestination;\n    }\n    /**\n     * Gets host window\n     * @returns the host window object\n     */\n    getHostWindow() {\n        if (!IsWindowObjectExist()) {\n            return null;\n        }\n        if (this._renderingCanvas && this._renderingCanvas.ownerDocument && this._renderingCanvas.ownerDocument.defaultView) {\n            return this._renderingCanvas.ownerDocument.defaultView;\n        }\n        return window;\n    }\n    /**\n     * Gets the current render width\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render width\n     */\n    getRenderWidth(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.width;\n        }\n        return this._framebufferDimensionsObject ? this._framebufferDimensionsObject.framebufferWidth : this._gl.drawingBufferWidth;\n    }\n    /**\n     * Gets the current render height\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render height\n     */\n    getRenderHeight(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.height;\n        }\n        return this._framebufferDimensionsObject ? this._framebufferDimensionsObject.framebufferHeight : this._gl.drawingBufferHeight;\n    }\n    /**\n     * Can be used to override the current requestAnimationFrame requester.\n     * @internal\n     */\n    _queueNewFrame(bindedRenderFunction, requester) {\n        return ThinEngine.QueueNewFrame(bindedRenderFunction, requester);\n    }\n    /**\n     * Register and execute a render loop. The engine can have more than one render function\n     * @param renderFunction defines the function to continuously execute\n     */\n    runRenderLoop(renderFunction) {\n        if (this._activeRenderLoops.indexOf(renderFunction) !== -1) {\n            return;\n        }\n        this._activeRenderLoops.push(renderFunction);\n        if (!this._renderingQueueLaunched) {\n            this._renderingQueueLaunched = true;\n            this._boundRenderFunction = this._renderLoop.bind(this);\n            this._frameHandler = this._queueNewFrame(this._boundRenderFunction, this.getHostWindow());\n        }\n    }\n    /**\n     * Clear the current render buffer or the current render target (if any is set up)\n     * @param color defines the color to use\n     * @param backBuffer defines if the back buffer must be cleared\n     * @param depth defines if the depth buffer must be cleared\n     * @param stencil defines if the stencil buffer must be cleared\n     */\n    clear(color, backBuffer, depth, stencil = false) {\n        const useStencilGlobalOnly = this.stencilStateComposer.useStencilGlobalOnly;\n        this.stencilStateComposer.useStencilGlobalOnly = true; // make sure the stencil mask is coming from the global stencil and not from a material (effect) which would currently be in effect\n        this.applyStates();\n        this.stencilStateComposer.useStencilGlobalOnly = useStencilGlobalOnly;\n        let mode = 0;\n        if (backBuffer && color) {\n            this._gl.clearColor(color.r, color.g, color.b, color.a !== undefined ? color.a : 1.0);\n            mode |= this._gl.COLOR_BUFFER_BIT;\n        }\n        if (depth) {\n            if (this.useReverseDepthBuffer) {\n                this._depthCullingState.depthFunc = this._gl.GEQUAL;\n                this._gl.clearDepth(0.0);\n            }\n            else {\n                this._gl.clearDepth(1.0);\n            }\n            mode |= this._gl.DEPTH_BUFFER_BIT;\n        }\n        if (stencil) {\n            this._gl.clearStencil(0);\n            mode |= this._gl.STENCIL_BUFFER_BIT;\n        }\n        this._gl.clear(mode);\n    }\n    /**\n     * @internal\n     */\n    _viewport(x, y, width, height) {\n        if (x !== this._viewportCached.x || y !== this._viewportCached.y || width !== this._viewportCached.z || height !== this._viewportCached.w) {\n            this._viewportCached.x = x;\n            this._viewportCached.y = y;\n            this._viewportCached.z = width;\n            this._viewportCached.w = height;\n            this._gl.viewport(x, y, width, height);\n        }\n    }\n    /**\n     * Set the WebGL's viewport\n     * @param viewport defines the viewport element to be used\n     * @param requiredWidth defines the width required for rendering. If not provided the rendering canvas' width is used\n     * @param requiredHeight defines the height required for rendering. If not provided the rendering canvas' height is used\n     */\n    setViewport(viewport, requiredWidth, requiredHeight) {\n        const width = requiredWidth || this.getRenderWidth();\n        const height = requiredHeight || this.getRenderHeight();\n        const x = viewport.x || 0;\n        const y = viewport.y || 0;\n        this._cachedViewport = viewport;\n        this._viewport(x * width, y * height, width * viewport.width, height * viewport.height);\n    }\n    /**\n     * Begin a new frame\n     */\n    beginFrame() { }\n    /**\n     * Enf the current frame\n     */\n    endFrame() {\n        // Force a flush in case we are using a bad OS.\n        if (this._badOS) {\n            this.flushFramebuffer();\n        }\n        this._frameId++;\n    }\n    /**\n     * Resize the view according to the canvas' size\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\n     */\n    resize(forceSetSize = false) {\n        let width;\n        let height;\n        // Requery hardware scaling level to handle zoomed-in resizing.\n        if (this.adaptToDeviceRatio) {\n            const devicePixelRatio = IsWindowObjectExist() ? window.devicePixelRatio || 1.0 : 1.0;\n            const changeRatio = this._lastDevicePixelRatio / devicePixelRatio;\n            this._lastDevicePixelRatio = devicePixelRatio;\n            this._hardwareScalingLevel *= changeRatio;\n        }\n        if (IsWindowObjectExist()) {\n            width = this._renderingCanvas ? this._renderingCanvas.clientWidth || this._renderingCanvas.width : window.innerWidth;\n            height = this._renderingCanvas ? this._renderingCanvas.clientHeight || this._renderingCanvas.height : window.innerHeight;\n        }\n        else {\n            width = this._renderingCanvas ? this._renderingCanvas.width : 100;\n            height = this._renderingCanvas ? this._renderingCanvas.height : 100;\n        }\n        this.setSize(width / this._hardwareScalingLevel, height / this._hardwareScalingLevel, forceSetSize);\n    }\n    /**\n     * Force a specific size of the canvas\n     * @param width defines the new canvas' width\n     * @param height defines the new canvas' height\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\n     * @returns true if the size was changed\n     */\n    setSize(width, height, forceSetSize = false) {\n        if (!this._renderingCanvas) {\n            return false;\n        }\n        width = width | 0;\n        height = height | 0;\n        if (!forceSetSize && this._renderingCanvas.width === width && this._renderingCanvas.height === height) {\n            return false;\n        }\n        this._renderingCanvas.width = width;\n        this._renderingCanvas.height = height;\n        return true;\n    }\n    /**\n     * Binds the frame buffer to the specified texture.\n     * @param texture The render target wrapper to render to\n     * @param faceIndex The face of the texture to render to in case of cube texture\n     * @param requiredWidth The width of the target to render to\n     * @param requiredHeight The height of the target to render to\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\n     * @param lodLevel defines the lod level to bind to the frame buffer\n     * @param layer defines the 2d array index to bind to frame buffer to\n     */\n    bindFramebuffer(texture, faceIndex = 0, requiredWidth, requiredHeight, forceFullscreenViewport, lodLevel = 0, layer = 0) {\n        var _a, _b, _c, _d, _e;\n        const webglRTWrapper = texture;\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        this._currentRenderTarget = texture;\n        this._bindUnboundFramebuffer(webglRTWrapper._MSAAFramebuffer ? webglRTWrapper._MSAAFramebuffer : webglRTWrapper._framebuffer);\n        const gl = this._gl;\n        if (texture.is2DArray) {\n            gl.framebufferTextureLayer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, (_a = texture.texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource, lodLevel, layer);\n        }\n        else if (texture.isCube) {\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, (_b = texture.texture._hardwareTexture) === null || _b === void 0 ? void 0 : _b.underlyingResource, lodLevel);\n        }\n        const depthStencilTexture = texture._depthStencilTexture;\n        if (depthStencilTexture) {\n            const attachment = texture._depthStencilTextureWithStencil ? gl.DEPTH_STENCIL_ATTACHMENT : gl.DEPTH_ATTACHMENT;\n            if (texture.is2DArray) {\n                gl.framebufferTextureLayer(gl.FRAMEBUFFER, attachment, (_c = depthStencilTexture._hardwareTexture) === null || _c === void 0 ? void 0 : _c.underlyingResource, lodLevel, layer);\n            }\n            else if (texture.isCube) {\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, (_d = depthStencilTexture._hardwareTexture) === null || _d === void 0 ? void 0 : _d.underlyingResource, lodLevel);\n            }\n            else {\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, (_e = depthStencilTexture._hardwareTexture) === null || _e === void 0 ? void 0 : _e.underlyingResource, lodLevel);\n            }\n        }\n        if (this._cachedViewport && !forceFullscreenViewport) {\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\n        }\n        else {\n            if (!requiredWidth) {\n                requiredWidth = texture.width;\n                if (lodLevel) {\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\n                }\n            }\n            if (!requiredHeight) {\n                requiredHeight = texture.height;\n                if (lodLevel) {\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\n                }\n            }\n            this._viewport(0, 0, requiredWidth, requiredHeight);\n        }\n        this.wipeCaches();\n    }\n    /**\n     * Set various states to the webGL context\n     * @param culling defines culling state: true to enable culling, false to disable it\n     * @param zOffset defines the value to apply to zOffset (0 by default)\n     * @param force defines if states must be applied even if cache is up to date\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\n     * @param stencil stencil states to set\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\n     */\n    setState(culling, zOffset = 0, force, reverseSide = false, cullBackFaces, stencil, zOffsetUnits = 0) {\n        var _a, _b;\n        // Culling\n        if (this._depthCullingState.cull !== culling || force) {\n            this._depthCullingState.cull = culling;\n        }\n        // Cull face\n        const cullFace = ((_b = (_a = this.cullBackFaces) !== null && _a !== void 0 ? _a : cullBackFaces) !== null && _b !== void 0 ? _b : true) ? this._gl.BACK : this._gl.FRONT;\n        if (this._depthCullingState.cullFace !== cullFace || force) {\n            this._depthCullingState.cullFace = cullFace;\n        }\n        // Z offset\n        this.setZOffset(zOffset);\n        this.setZOffsetUnits(zOffsetUnits);\n        // Front face\n        const frontFace = reverseSide ? this._gl.CW : this._gl.CCW;\n        if (this._depthCullingState.frontFace !== frontFace || force) {\n            this._depthCullingState.frontFace = frontFace;\n        }\n        this._stencilStateComposer.stencilMaterial = stencil;\n    }\n    /**\n     * Gets a boolean indicating if depth testing is enabled\n     * @returns the current state\n     */\n    getDepthBuffer() {\n        return this._depthCullingState.depthTest;\n    }\n    /**\n     * Enable or disable depth buffering\n     * @param enable defines the state to set\n     */\n    setDepthBuffer(enable) {\n        this._depthCullingState.depthTest = enable;\n    }\n    /**\n     * Set the z offset Factor to apply to current rendering\n     * @param value defines the offset to apply\n     */\n    setZOffset(value) {\n        this._depthCullingState.zOffset = this.useReverseDepthBuffer ? -value : value;\n    }\n    /**\n     * Gets the current value of the zOffset Factor\n     * @returns the current zOffset Factor state\n     */\n    getZOffset() {\n        const zOffset = this._depthCullingState.zOffset;\n        return this.useReverseDepthBuffer ? -zOffset : zOffset;\n    }\n    /**\n     * Set the z offset Units to apply to current rendering\n     * @param value defines the offset to apply\n     */\n    setZOffsetUnits(value) {\n        this._depthCullingState.zOffsetUnits = this.useReverseDepthBuffer ? -value : value;\n    }\n    /**\n     * Gets the current value of the zOffset Units\n     * @returns the current zOffset Units state\n     */\n    getZOffsetUnits() {\n        const zOffsetUnits = this._depthCullingState.zOffsetUnits;\n        return this.useReverseDepthBuffer ? -zOffsetUnits : zOffsetUnits;\n    }\n    /**\n     * @internal\n     */\n    _bindUnboundFramebuffer(framebuffer) {\n        if (this._currentFramebuffer !== framebuffer) {\n            this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, framebuffer);\n            this._currentFramebuffer = framebuffer;\n        }\n    }\n    /** @internal */\n    _currentFrameBufferIsDefaultFrameBuffer() {\n        return this._currentFramebuffer === null;\n    }\n    /**\n     * Generates the mipmaps for a texture\n     * @param texture texture to generate the mipmaps for\n     */\n    generateMipmaps(texture) {\n        this._bindTextureDirectly(this._gl.TEXTURE_2D, texture, true);\n        this._gl.generateMipmap(this._gl.TEXTURE_2D);\n        this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\n    }\n    /**\n     * Unbind the current render target texture from the webGL context\n     * @param texture defines the render target wrapper to unbind\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\n     */\n    unBindFramebuffer(texture, disableGenerateMipMaps = false, onBeforeUnbind) {\n        var _a;\n        const webglRTWrapper = texture;\n        this._currentRenderTarget = null;\n        // If MSAA, we need to bitblt back to main texture\n        const gl = this._gl;\n        if (webglRTWrapper._MSAAFramebuffer) {\n            if (texture.isMulti) {\n                // This texture is part of a MRT texture, we need to treat all attachments\n                this.unBindMultiColorAttachmentFramebuffer(texture, disableGenerateMipMaps, onBeforeUnbind);\n                return;\n            }\n            gl.bindFramebuffer(gl.READ_FRAMEBUFFER, webglRTWrapper._MSAAFramebuffer);\n            gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, webglRTWrapper._framebuffer);\n            gl.blitFramebuffer(0, 0, texture.width, texture.height, 0, 0, texture.width, texture.height, gl.COLOR_BUFFER_BIT, gl.NEAREST);\n        }\n        if (((_a = texture.texture) === null || _a === void 0 ? void 0 : _a.generateMipMaps) && !disableGenerateMipMaps && !texture.isCube) {\n            this.generateMipmaps(texture.texture);\n        }\n        if (onBeforeUnbind) {\n            if (webglRTWrapper._MSAAFramebuffer) {\n                // Bind the correct framebuffer\n                this._bindUnboundFramebuffer(webglRTWrapper._framebuffer);\n            }\n            onBeforeUnbind();\n        }\n        this._bindUnboundFramebuffer(null);\n    }\n    /**\n     * Force a webGL flush (ie. a flush of all waiting webGL commands)\n     */\n    flushFramebuffer() {\n        this._gl.flush();\n    }\n    /**\n     * Unbind the current render target and bind the default framebuffer\n     */\n    restoreDefaultFramebuffer() {\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        else {\n            this._bindUnboundFramebuffer(null);\n        }\n        if (this._cachedViewport) {\n            this.setViewport(this._cachedViewport);\n        }\n        this.wipeCaches();\n    }\n    // VBOs\n    /** @internal */\n    _resetVertexBufferBinding() {\n        this.bindArrayBuffer(null);\n        this._cachedVertexBuffers = null;\n    }\n    /**\n     * Creates a vertex buffer\n     * @param data the data for the vertex buffer\n     * @returns the new WebGL static buffer\n     */\n    createVertexBuffer(data) {\n        return this._createVertexBuffer(data, this._gl.STATIC_DRAW);\n    }\n    _createVertexBuffer(data, usage) {\n        const vbo = this._gl.createBuffer();\n        if (!vbo) {\n            throw new Error(\"Unable to create vertex buffer\");\n        }\n        const dataBuffer = new WebGLDataBuffer(vbo);\n        this.bindArrayBuffer(dataBuffer);\n        if (data instanceof Array) {\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(data), usage);\n        }\n        else {\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, data, usage);\n        }\n        this._resetVertexBufferBinding();\n        dataBuffer.references = 1;\n        return dataBuffer;\n    }\n    /**\n     * Creates a dynamic vertex buffer\n     * @param data the data for the dynamic vertex buffer\n     * @returns the new WebGL dynamic buffer\n     */\n    createDynamicVertexBuffer(data) {\n        return this._createVertexBuffer(data, this._gl.DYNAMIC_DRAW);\n    }\n    _resetIndexBufferBinding() {\n        this.bindIndexBuffer(null);\n        this._cachedIndexBuffer = null;\n    }\n    /**\n     * Creates a new index buffer\n     * @param indices defines the content of the index buffer\n     * @param updatable defines if the index buffer must be updatable\n     * @returns a new webGL buffer\n     */\n    createIndexBuffer(indices, updatable) {\n        const vbo = this._gl.createBuffer();\n        const dataBuffer = new WebGLDataBuffer(vbo);\n        if (!vbo) {\n            throw new Error(\"Unable to create index buffer\");\n        }\n        this.bindIndexBuffer(dataBuffer);\n        const data = this._normalizeIndexData(indices);\n        this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, data, updatable ? this._gl.DYNAMIC_DRAW : this._gl.STATIC_DRAW);\n        this._resetIndexBufferBinding();\n        dataBuffer.references = 1;\n        dataBuffer.is32Bits = data.BYTES_PER_ELEMENT === 4;\n        return dataBuffer;\n    }\n    _normalizeIndexData(indices) {\n        const bytesPerElement = indices.BYTES_PER_ELEMENT;\n        if (bytesPerElement === 2) {\n            return indices;\n        }\n        // Check 32 bit support\n        if (this._caps.uintIndices) {\n            if (indices instanceof Uint32Array) {\n                return indices;\n            }\n            else {\n                // number[] or Int32Array, check if 32 bit is necessary\n                for (let index = 0; index < indices.length; index++) {\n                    if (indices[index] >= 65535) {\n                        return new Uint32Array(indices);\n                    }\n                }\n                return new Uint16Array(indices);\n            }\n        }\n        // No 32 bit support, force conversion to 16 bit (values greater 16 bit are lost)\n        return new Uint16Array(indices);\n    }\n    /**\n     * Bind a webGL buffer to the webGL context\n     * @param buffer defines the buffer to bind\n     */\n    bindArrayBuffer(buffer) {\n        if (!this._vaoRecordInProgress) {\n            this._unbindVertexArrayObject();\n        }\n        this._bindBuffer(buffer, this._gl.ARRAY_BUFFER);\n    }\n    /**\n     * Bind a specific block at a given index in a specific shader program\n     * @param pipelineContext defines the pipeline context to use\n     * @param blockName defines the block name\n     * @param index defines the index where to bind the block\n     */\n    bindUniformBlock(pipelineContext, blockName, index) {\n        const program = pipelineContext.program;\n        const uniformLocation = this._gl.getUniformBlockIndex(program, blockName);\n        this._gl.uniformBlockBinding(program, uniformLocation, index);\n    }\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    bindIndexBuffer(buffer) {\n        if (!this._vaoRecordInProgress) {\n            this._unbindVertexArrayObject();\n        }\n        this._bindBuffer(buffer, this._gl.ELEMENT_ARRAY_BUFFER);\n    }\n    _bindBuffer(buffer, target) {\n        if (this._vaoRecordInProgress || this._currentBoundBuffer[target] !== buffer) {\n            this._gl.bindBuffer(target, buffer ? buffer.underlyingResource : null);\n            this._currentBoundBuffer[target] = buffer;\n        }\n    }\n    /**\n     * update the bound buffer with the given data\n     * @param data defines the data to update\n     */\n    updateArrayBuffer(data) {\n        this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\n    }\n    _vertexAttribPointer(buffer, indx, size, type, normalized, stride, offset) {\n        const pointer = this._currentBufferPointers[indx];\n        if (!pointer) {\n            return;\n        }\n        let changed = false;\n        if (!pointer.active) {\n            changed = true;\n            pointer.active = true;\n            pointer.index = indx;\n            pointer.size = size;\n            pointer.type = type;\n            pointer.normalized = normalized;\n            pointer.stride = stride;\n            pointer.offset = offset;\n            pointer.buffer = buffer;\n        }\n        else {\n            if (pointer.buffer !== buffer) {\n                pointer.buffer = buffer;\n                changed = true;\n            }\n            if (pointer.size !== size) {\n                pointer.size = size;\n                changed = true;\n            }\n            if (pointer.type !== type) {\n                pointer.type = type;\n                changed = true;\n            }\n            if (pointer.normalized !== normalized) {\n                pointer.normalized = normalized;\n                changed = true;\n            }\n            if (pointer.stride !== stride) {\n                pointer.stride = stride;\n                changed = true;\n            }\n            if (pointer.offset !== offset) {\n                pointer.offset = offset;\n                changed = true;\n            }\n        }\n        if (changed || this._vaoRecordInProgress) {\n            this.bindArrayBuffer(buffer);\n            if (type === this._gl.UNSIGNED_INT || type === this._gl.INT) {\n                this._gl.vertexAttribIPointer(indx, size, type, stride, offset);\n            }\n            else {\n                this._gl.vertexAttribPointer(indx, size, type, normalized, stride, offset);\n            }\n        }\n    }\n    /**\n     * @internal\n     */\n    _bindIndexBufferWithCache(indexBuffer) {\n        if (indexBuffer == null) {\n            return;\n        }\n        if (this._cachedIndexBuffer !== indexBuffer) {\n            this._cachedIndexBuffer = indexBuffer;\n            this.bindIndexBuffer(indexBuffer);\n            this._uintIndicesCurrentlySet = indexBuffer.is32Bits;\n        }\n    }\n    _bindVertexBuffersAttributes(vertexBuffers, effect, overrideVertexBuffers) {\n        const attributes = effect.getAttributesNames();\n        if (!this._vaoRecordInProgress) {\n            this._unbindVertexArrayObject();\n        }\n        this.unbindAllAttributes();\n        for (let index = 0; index < attributes.length; index++) {\n            const order = effect.getAttributeLocation(index);\n            if (order >= 0) {\n                const ai = attributes[index];\n                let vertexBuffer = null;\n                if (overrideVertexBuffers) {\n                    vertexBuffer = overrideVertexBuffers[ai];\n                }\n                if (!vertexBuffer) {\n                    vertexBuffer = vertexBuffers[ai];\n                }\n                if (!vertexBuffer) {\n                    continue;\n                }\n                this._gl.enableVertexAttribArray(order);\n                if (!this._vaoRecordInProgress) {\n                    this._vertexAttribArraysEnabled[order] = true;\n                }\n                const buffer = vertexBuffer.getBuffer();\n                if (buffer) {\n                    this._vertexAttribPointer(buffer, order, vertexBuffer.getSize(), vertexBuffer.type, vertexBuffer.normalized, vertexBuffer.byteStride, vertexBuffer.byteOffset);\n                    if (vertexBuffer.getIsInstanced()) {\n                        this._gl.vertexAttribDivisor(order, vertexBuffer.getInstanceDivisor());\n                        if (!this._vaoRecordInProgress) {\n                            this._currentInstanceLocations.push(order);\n                            this._currentInstanceBuffers.push(buffer);\n                        }\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Records a vertex array object\n     * @see https://doc.babylonjs.com/setup/support/webGL2#vertex-array-objects\n     * @param vertexBuffers defines the list of vertex buffers to store\n     * @param indexBuffer defines the index buffer to store\n     * @param effect defines the effect to store\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\n     * @returns the new vertex array object\n     */\n    recordVertexArrayObject(vertexBuffers, indexBuffer, effect, overrideVertexBuffers) {\n        const vao = this._gl.createVertexArray();\n        if (!vao) {\n            throw new Error(\"Unable to create VAO\");\n        }\n        this._vaoRecordInProgress = true;\n        this._gl.bindVertexArray(vao);\n        this._mustWipeVertexAttributes = true;\n        this._bindVertexBuffersAttributes(vertexBuffers, effect, overrideVertexBuffers);\n        this.bindIndexBuffer(indexBuffer);\n        this._vaoRecordInProgress = false;\n        this._gl.bindVertexArray(null);\n        return vao;\n    }\n    /**\n     * Bind a specific vertex array object\n     * @see https://doc.babylonjs.com/setup/support/webGL2#vertex-array-objects\n     * @param vertexArrayObject defines the vertex array object to bind\n     * @param indexBuffer defines the index buffer to bind\n     */\n    bindVertexArrayObject(vertexArrayObject, indexBuffer) {\n        if (this._cachedVertexArrayObject !== vertexArrayObject) {\n            this._cachedVertexArrayObject = vertexArrayObject;\n            this._gl.bindVertexArray(vertexArrayObject);\n            this._cachedVertexBuffers = null;\n            this._cachedIndexBuffer = null;\n            this._uintIndicesCurrentlySet = indexBuffer != null && indexBuffer.is32Bits;\n            this._mustWipeVertexAttributes = true;\n        }\n    }\n    /**\n     * Bind webGl buffers directly to the webGL context\n     * @param vertexBuffer defines the vertex buffer to bind\n     * @param indexBuffer defines the index buffer to bind\n     * @param vertexDeclaration defines the vertex declaration to use with the vertex buffer\n     * @param vertexStrideSize defines the vertex stride of the vertex buffer\n     * @param effect defines the effect associated with the vertex buffer\n     */\n    bindBuffersDirectly(vertexBuffer, indexBuffer, vertexDeclaration, vertexStrideSize, effect) {\n        if (this._cachedVertexBuffers !== vertexBuffer || this._cachedEffectForVertexBuffers !== effect) {\n            this._cachedVertexBuffers = vertexBuffer;\n            this._cachedEffectForVertexBuffers = effect;\n            const attributesCount = effect.getAttributesCount();\n            this._unbindVertexArrayObject();\n            this.unbindAllAttributes();\n            let offset = 0;\n            for (let index = 0; index < attributesCount; index++) {\n                if (index < vertexDeclaration.length) {\n                    const order = effect.getAttributeLocation(index);\n                    if (order >= 0) {\n                        this._gl.enableVertexAttribArray(order);\n                        this._vertexAttribArraysEnabled[order] = true;\n                        this._vertexAttribPointer(vertexBuffer, order, vertexDeclaration[index], this._gl.FLOAT, false, vertexStrideSize, offset);\n                    }\n                    offset += vertexDeclaration[index] * 4;\n                }\n            }\n        }\n        this._bindIndexBufferWithCache(indexBuffer);\n    }\n    _unbindVertexArrayObject() {\n        if (!this._cachedVertexArrayObject) {\n            return;\n        }\n        this._cachedVertexArrayObject = null;\n        this._gl.bindVertexArray(null);\n    }\n    /**\n     * Bind a list of vertex buffers to the webGL context\n     * @param vertexBuffers defines the list of vertex buffers to bind\n     * @param indexBuffer defines the index buffer to bind\n     * @param effect defines the effect associated with the vertex buffers\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\n     */\n    bindBuffers(vertexBuffers, indexBuffer, effect, overrideVertexBuffers) {\n        if (this._cachedVertexBuffers !== vertexBuffers || this._cachedEffectForVertexBuffers !== effect) {\n            this._cachedVertexBuffers = vertexBuffers;\n            this._cachedEffectForVertexBuffers = effect;\n            this._bindVertexBuffersAttributes(vertexBuffers, effect, overrideVertexBuffers);\n        }\n        this._bindIndexBufferWithCache(indexBuffer);\n    }\n    /**\n     * Unbind all instance attributes\n     */\n    unbindInstanceAttributes() {\n        let boundBuffer;\n        for (let i = 0, ul = this._currentInstanceLocations.length; i < ul; i++) {\n            const instancesBuffer = this._currentInstanceBuffers[i];\n            if (boundBuffer != instancesBuffer && instancesBuffer.references) {\n                boundBuffer = instancesBuffer;\n                this.bindArrayBuffer(instancesBuffer);\n            }\n            const offsetLocation = this._currentInstanceLocations[i];\n            this._gl.vertexAttribDivisor(offsetLocation, 0);\n        }\n        this._currentInstanceBuffers.length = 0;\n        this._currentInstanceLocations.length = 0;\n    }\n    /**\n     * Release and free the memory of a vertex array object\n     * @param vao defines the vertex array object to delete\n     */\n    releaseVertexArrayObject(vao) {\n        this._gl.deleteVertexArray(vao);\n    }\n    /**\n     * @internal\n     */\n    _releaseBuffer(buffer) {\n        buffer.references--;\n        if (buffer.references === 0) {\n            this._deleteBuffer(buffer);\n            return true;\n        }\n        return false;\n    }\n    _deleteBuffer(buffer) {\n        this._gl.deleteBuffer(buffer.underlyingResource);\n    }\n    /**\n     * Update the content of a webGL buffer used with instantiation and bind it to the webGL context\n     * @param instancesBuffer defines the webGL buffer to update and bind\n     * @param data defines the data to store in the buffer\n     * @param offsetLocations defines the offsets or attributes information used to determine where data must be stored in the buffer\n     */\n    updateAndBindInstancesBuffer(instancesBuffer, data, offsetLocations) {\n        this.bindArrayBuffer(instancesBuffer);\n        if (data) {\n            this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\n        }\n        if (offsetLocations[0].index !== undefined) {\n            this.bindInstancesBuffer(instancesBuffer, offsetLocations, true);\n        }\n        else {\n            for (let index = 0; index < 4; index++) {\n                const offsetLocation = offsetLocations[index];\n                if (!this._vertexAttribArraysEnabled[offsetLocation]) {\n                    this._gl.enableVertexAttribArray(offsetLocation);\n                    this._vertexAttribArraysEnabled[offsetLocation] = true;\n                }\n                this._vertexAttribPointer(instancesBuffer, offsetLocation, 4, this._gl.FLOAT, false, 64, index * 16);\n                this._gl.vertexAttribDivisor(offsetLocation, 1);\n                this._currentInstanceLocations.push(offsetLocation);\n                this._currentInstanceBuffers.push(instancesBuffer);\n            }\n        }\n    }\n    /**\n     * Bind the content of a webGL buffer used with instantiation\n     * @param instancesBuffer defines the webGL buffer to bind\n     * @param attributesInfo defines the offsets or attributes information used to determine where data must be stored in the buffer\n     * @param computeStride defines Whether to compute the strides from the info or use the default 0\n     */\n    bindInstancesBuffer(instancesBuffer, attributesInfo, computeStride = true) {\n        this.bindArrayBuffer(instancesBuffer);\n        let stride = 0;\n        if (computeStride) {\n            for (let i = 0; i < attributesInfo.length; i++) {\n                const ai = attributesInfo[i];\n                stride += ai.attributeSize * 4;\n            }\n        }\n        for (let i = 0; i < attributesInfo.length; i++) {\n            const ai = attributesInfo[i];\n            if (ai.index === undefined) {\n                ai.index = this._currentEffect.getAttributeLocationByName(ai.attributeName);\n            }\n            if (ai.index < 0) {\n                continue;\n            }\n            if (!this._vertexAttribArraysEnabled[ai.index]) {\n                this._gl.enableVertexAttribArray(ai.index);\n                this._vertexAttribArraysEnabled[ai.index] = true;\n            }\n            this._vertexAttribPointer(instancesBuffer, ai.index, ai.attributeSize, ai.attributeType || this._gl.FLOAT, ai.normalized || false, stride, ai.offset);\n            this._gl.vertexAttribDivisor(ai.index, ai.divisor === undefined ? 1 : ai.divisor);\n            this._currentInstanceLocations.push(ai.index);\n            this._currentInstanceBuffers.push(instancesBuffer);\n        }\n    }\n    /**\n     * Disable the instance attribute corresponding to the name in parameter\n     * @param name defines the name of the attribute to disable\n     */\n    disableInstanceAttributeByName(name) {\n        if (!this._currentEffect) {\n            return;\n        }\n        const attributeLocation = this._currentEffect.getAttributeLocationByName(name);\n        this.disableInstanceAttribute(attributeLocation);\n    }\n    /**\n     * Disable the instance attribute corresponding to the location in parameter\n     * @param attributeLocation defines the attribute location of the attribute to disable\n     */\n    disableInstanceAttribute(attributeLocation) {\n        let shouldClean = false;\n        let index;\n        while ((index = this._currentInstanceLocations.indexOf(attributeLocation)) !== -1) {\n            this._currentInstanceLocations.splice(index, 1);\n            this._currentInstanceBuffers.splice(index, 1);\n            shouldClean = true;\n            index = this._currentInstanceLocations.indexOf(attributeLocation);\n        }\n        if (shouldClean) {\n            this._gl.vertexAttribDivisor(attributeLocation, 0);\n            this.disableAttributeByIndex(attributeLocation);\n        }\n    }\n    /**\n     * Disable the attribute corresponding to the location in parameter\n     * @param attributeLocation defines the attribute location of the attribute to disable\n     */\n    disableAttributeByIndex(attributeLocation) {\n        this._gl.disableVertexAttribArray(attributeLocation);\n        this._vertexAttribArraysEnabled[attributeLocation] = false;\n        this._currentBufferPointers[attributeLocation].active = false;\n    }\n    /**\n     * Send a draw order\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\n     * @param indexStart defines the starting index\n     * @param indexCount defines the number of index to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    draw(useTriangles, indexStart, indexCount, instancesCount) {\n        this.drawElementsType(useTriangles ? 0 : 1, indexStart, indexCount, instancesCount);\n    }\n    /**\n     * Draw a list of points\n     * @param verticesStart defines the index of first vertex to draw\n     * @param verticesCount defines the count of vertices to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawPointClouds(verticesStart, verticesCount, instancesCount) {\n        this.drawArraysType(2, verticesStart, verticesCount, instancesCount);\n    }\n    /**\n     * Draw a list of unindexed primitives\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\n     * @param verticesStart defines the index of first vertex to draw\n     * @param verticesCount defines the count of vertices to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawUnIndexed(useTriangles, verticesStart, verticesCount, instancesCount) {\n        this.drawArraysType(useTriangles ? 0 : 1, verticesStart, verticesCount, instancesCount);\n    }\n    /**\n     * Draw a list of indexed primitives\n     * @param fillMode defines the primitive to use\n     * @param indexStart defines the starting index\n     * @param indexCount defines the number of index to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawElementsType(fillMode, indexStart, indexCount, instancesCount) {\n        // Apply states\n        this.applyStates();\n        this._reportDrawCall();\n        // Render\n        const drawMode = this._drawMode(fillMode);\n        const indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\n        const mult = this._uintIndicesCurrentlySet ? 4 : 2;\n        if (instancesCount) {\n            this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\n        }\n        else {\n            this._gl.drawElements(drawMode, indexCount, indexFormat, indexStart * mult);\n        }\n    }\n    /**\n     * Draw a list of unindexed primitives\n     * @param fillMode defines the primitive to use\n     * @param verticesStart defines the index of first vertex to draw\n     * @param verticesCount defines the count of vertices to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawArraysType(fillMode, verticesStart, verticesCount, instancesCount) {\n        // Apply states\n        this.applyStates();\n        this._reportDrawCall();\n        const drawMode = this._drawMode(fillMode);\n        if (instancesCount) {\n            this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\n        }\n        else {\n            this._gl.drawArrays(drawMode, verticesStart, verticesCount);\n        }\n    }\n    _drawMode(fillMode) {\n        switch (fillMode) {\n            // Triangle views\n            case 0:\n                return this._gl.TRIANGLES;\n            case 2:\n                return this._gl.POINTS;\n            case 1:\n                return this._gl.LINES;\n            // Draw modes\n            case 3:\n                return this._gl.POINTS;\n            case 4:\n                return this._gl.LINES;\n            case 5:\n                return this._gl.LINE_LOOP;\n            case 6:\n                return this._gl.LINE_STRIP;\n            case 7:\n                return this._gl.TRIANGLE_STRIP;\n            case 8:\n                return this._gl.TRIANGLE_FAN;\n            default:\n                return this._gl.TRIANGLES;\n        }\n    }\n    /** @internal */\n    _reportDrawCall() {\n        // Will be implemented by children\n    }\n    // Shaders\n    /**\n     * @internal\n     */\n    _releaseEffect(effect) {\n        if (this._compiledEffects[effect._key]) {\n            delete this._compiledEffects[effect._key];\n        }\n        const pipelineContext = effect.getPipelineContext();\n        if (pipelineContext) {\n            this._deletePipelineContext(pipelineContext);\n        }\n    }\n    /**\n     * @internal\n     */\n    _deletePipelineContext(pipelineContext) {\n        const webGLPipelineContext = pipelineContext;\n        if (webGLPipelineContext && webGLPipelineContext.program) {\n            webGLPipelineContext.program.__SPECTOR_rebuildProgram = null;\n            this._gl.deleteProgram(webGLPipelineContext.program);\n        }\n    }\n    /** @internal */\n    _getGlobalDefines(defines) {\n        if (defines) {\n            if (this.isNDCHalfZRange) {\n                defines[\"IS_NDC_HALF_ZRANGE\"] = \"\";\n            }\n            else {\n                delete defines[\"IS_NDC_HALF_ZRANGE\"];\n            }\n            if (this.useReverseDepthBuffer) {\n                defines[\"USE_REVERSE_DEPTHBUFFER\"] = \"\";\n            }\n            else {\n                delete defines[\"USE_REVERSE_DEPTHBUFFER\"];\n            }\n            if (this.useExactSrgbConversions) {\n                defines[\"USE_EXACT_SRGB_CONVERSIONS\"] = \"\";\n            }\n            else {\n                delete defines[\"USE_EXACT_SRGB_CONVERSIONS\"];\n            }\n            return;\n        }\n        else {\n            let s = \"\";\n            if (this.isNDCHalfZRange) {\n                s += \"#define IS_NDC_HALF_ZRANGE\";\n            }\n            if (this.useReverseDepthBuffer) {\n                if (s) {\n                    s += \"\\n\";\n                }\n                s += \"#define USE_REVERSE_DEPTHBUFFER\";\n            }\n            if (this.useExactSrgbConversions) {\n                if (s) {\n                    s += \"\\n\";\n                }\n                s += \"#define USE_EXACT_SRGB_CONVERSIONS\";\n            }\n            return s;\n        }\n    }\n    /**\n     * Create a new effect (used to store vertex/fragment shaders)\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\n     * @param samplers defines an array of string used to represent textures\n     * @param defines defines the string containing the defines to use to compile the shaders\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\n     * @param onCompiled defines a function to call when the effect creation is successful\n     * @param onError defines a function to call when the effect creation has failed\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\n     * @returns the new Effect\n     */\n    createEffect(baseName, attributesNamesOrOptions, uniformsNamesOrEngine, samplers, defines, fallbacks, onCompiled, onError, indexParameters, shaderLanguage = ShaderLanguage.GLSL) {\n        var _a;\n        const vertex = baseName.vertexElement || baseName.vertex || baseName.vertexToken || baseName.vertexSource || baseName;\n        const fragment = baseName.fragmentElement || baseName.fragment || baseName.fragmentToken || baseName.fragmentSource || baseName;\n        const globalDefines = this._getGlobalDefines();\n        let fullDefines = (_a = defines !== null && defines !== void 0 ? defines : attributesNamesOrOptions.defines) !== null && _a !== void 0 ? _a : \"\";\n        if (globalDefines) {\n            fullDefines += globalDefines;\n        }\n        const name = vertex + \"+\" + fragment + \"@\" + fullDefines;\n        if (this._compiledEffects[name]) {\n            const compiledEffect = this._compiledEffects[name];\n            if (onCompiled && compiledEffect.isReady()) {\n                onCompiled(compiledEffect);\n            }\n            return compiledEffect;\n        }\n        const effect = new Effect(baseName, attributesNamesOrOptions, uniformsNamesOrEngine, samplers, this, defines, fallbacks, onCompiled, onError, indexParameters, name, shaderLanguage);\n        this._compiledEffects[name] = effect;\n        return effect;\n    }\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    static _ConcatenateShader(source, defines, shaderVersion = \"\") {\n        return shaderVersion + (defines ? defines + \"\\n\" : \"\") + source;\n    }\n    _compileShader(source, type, defines, shaderVersion) {\n        return this._compileRawShader(ThinEngine._ConcatenateShader(source, defines, shaderVersion), type);\n    }\n    _compileRawShader(source, type) {\n        const gl = this._gl;\n        const shader = gl.createShader(type === \"vertex\" ? gl.VERTEX_SHADER : gl.FRAGMENT_SHADER);\n        if (!shader) {\n            let error = gl.NO_ERROR;\n            let tempError = gl.NO_ERROR;\n            while ((tempError = gl.getError()) !== gl.NO_ERROR) {\n                error = tempError;\n            }\n            throw new Error(`Something went wrong while creating a gl ${type} shader object. gl error=${error}, gl isContextLost=${gl.isContextLost()}, _contextWasLost=${this._contextWasLost}`);\n        }\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n        return shader;\n    }\n    /**\n     * @internal\n     */\n    _getShaderSource(shader) {\n        return this._gl.getShaderSource(shader);\n    }\n    /**\n     * Directly creates a webGL program\n     * @param pipelineContext  defines the pipeline context to attach to\n     * @param vertexCode defines the vertex shader code to use\n     * @param fragmentCode defines the fragment shader code to use\n     * @param context defines the webGL context to use (if not set, the current one will be used)\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\n     * @returns the new webGL program\n     */\n    createRawShaderProgram(pipelineContext, vertexCode, fragmentCode, context, transformFeedbackVaryings = null) {\n        context = context || this._gl;\n        const vertexShader = this._compileRawShader(vertexCode, \"vertex\");\n        const fragmentShader = this._compileRawShader(fragmentCode, \"fragment\");\n        return this._createShaderProgram(pipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings);\n    }\n    /**\n     * Creates a webGL program\n     * @param pipelineContext  defines the pipeline context to attach to\n     * @param vertexCode  defines the vertex shader code to use\n     * @param fragmentCode defines the fragment shader code to use\n     * @param defines defines the string containing the defines to use to compile the shaders\n     * @param context defines the webGL context to use (if not set, the current one will be used)\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\n     * @returns the new webGL program\n     */\n    createShaderProgram(pipelineContext, vertexCode, fragmentCode, defines, context, transformFeedbackVaryings = null) {\n        context = context || this._gl;\n        const shaderVersion = this._webGLVersion > 1 ? \"#version 300 es\\n#define WEBGL2 \\n\" : \"\";\n        const vertexShader = this._compileShader(vertexCode, \"vertex\", defines, shaderVersion);\n        const fragmentShader = this._compileShader(fragmentCode, \"fragment\", defines, shaderVersion);\n        return this._createShaderProgram(pipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings);\n    }\n    /**\n     * Inline functions in shader code that are marked to be inlined\n     * @param code code to inline\n     * @returns inlined code\n     */\n    inlineShaderCode(code) {\n        // no inlining needed in the WebGL engine\n        return code;\n    }\n    /**\n     * Creates a new pipeline context\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\n     * @returns the new pipeline\n     */\n    createPipelineContext(shaderProcessingContext) {\n        const pipelineContext = new WebGLPipelineContext();\n        pipelineContext.engine = this;\n        if (this._caps.parallelShaderCompile) {\n            pipelineContext.isParallelCompiled = true;\n        }\n        return pipelineContext;\n    }\n    /**\n     * Creates a new material context\n     * @returns the new context\n     */\n    createMaterialContext() {\n        return undefined;\n    }\n    /**\n     * Creates a new draw context\n     * @returns the new context\n     */\n    createDrawContext() {\n        return undefined;\n    }\n    _createShaderProgram(pipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings = null) {\n        const shaderProgram = context.createProgram();\n        pipelineContext.program = shaderProgram;\n        if (!shaderProgram) {\n            throw new Error(\"Unable to create program\");\n        }\n        context.attachShader(shaderProgram, vertexShader);\n        context.attachShader(shaderProgram, fragmentShader);\n        context.linkProgram(shaderProgram);\n        pipelineContext.context = context;\n        pipelineContext.vertexShader = vertexShader;\n        pipelineContext.fragmentShader = fragmentShader;\n        if (!pipelineContext.isParallelCompiled) {\n            this._finalizePipelineContext(pipelineContext);\n        }\n        return shaderProgram;\n    }\n    _finalizePipelineContext(pipelineContext) {\n        const context = pipelineContext.context;\n        const vertexShader = pipelineContext.vertexShader;\n        const fragmentShader = pipelineContext.fragmentShader;\n        const program = pipelineContext.program;\n        const linked = context.getProgramParameter(program, context.LINK_STATUS);\n        if (!linked) {\n            // Get more info\n            // Vertex\n            if (!this._gl.getShaderParameter(vertexShader, this._gl.COMPILE_STATUS)) {\n                const log = this._gl.getShaderInfoLog(vertexShader);\n                if (log) {\n                    pipelineContext.vertexCompilationError = log;\n                    throw new Error(\"VERTEX SHADER \" + log);\n                }\n            }\n            // Fragment\n            if (!this._gl.getShaderParameter(fragmentShader, this._gl.COMPILE_STATUS)) {\n                const log = this._gl.getShaderInfoLog(fragmentShader);\n                if (log) {\n                    pipelineContext.fragmentCompilationError = log;\n                    throw new Error(\"FRAGMENT SHADER \" + log);\n                }\n            }\n            const error = context.getProgramInfoLog(program);\n            if (error) {\n                pipelineContext.programLinkError = error;\n                throw new Error(error);\n            }\n        }\n        if (this.validateShaderPrograms) {\n            context.validateProgram(program);\n            const validated = context.getProgramParameter(program, context.VALIDATE_STATUS);\n            if (!validated) {\n                const error = context.getProgramInfoLog(program);\n                if (error) {\n                    pipelineContext.programValidationError = error;\n                    throw new Error(error);\n                }\n            }\n        }\n        context.deleteShader(vertexShader);\n        context.deleteShader(fragmentShader);\n        pipelineContext.vertexShader = undefined;\n        pipelineContext.fragmentShader = undefined;\n        if (pipelineContext.onCompiled) {\n            pipelineContext.onCompiled();\n            pipelineContext.onCompiled = undefined;\n        }\n    }\n    /**\n     * @internal\n     */\n    _preparePipelineContext(pipelineContext, vertexSourceCode, fragmentSourceCode, createAsRaw, rawVertexSourceCode, rawFragmentSourceCode, rebuildRebind, defines, transformFeedbackVaryings, key) {\n        const webGLRenderingState = pipelineContext;\n        if (createAsRaw) {\n            webGLRenderingState.program = this.createRawShaderProgram(webGLRenderingState, vertexSourceCode, fragmentSourceCode, undefined, transformFeedbackVaryings);\n        }\n        else {\n            webGLRenderingState.program = this.createShaderProgram(webGLRenderingState, vertexSourceCode, fragmentSourceCode, defines, undefined, transformFeedbackVaryings);\n        }\n        webGLRenderingState.program.__SPECTOR_rebuildProgram = rebuildRebind;\n    }\n    /**\n     * @internal\n     */\n    _isRenderingStateCompiled(pipelineContext) {\n        const webGLPipelineContext = pipelineContext;\n        if (this._gl.getProgramParameter(webGLPipelineContext.program, this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)) {\n            this._finalizePipelineContext(webGLPipelineContext);\n            return true;\n        }\n        return false;\n    }\n    /**\n     * @internal\n     */\n    _executeWhenRenderingStateIsCompiled(pipelineContext, action) {\n        const webGLPipelineContext = pipelineContext;\n        if (!webGLPipelineContext.isParallelCompiled) {\n            action();\n            return;\n        }\n        const oldHandler = webGLPipelineContext.onCompiled;\n        if (oldHandler) {\n            webGLPipelineContext.onCompiled = () => {\n                oldHandler();\n                action();\n            };\n        }\n        else {\n            webGLPipelineContext.onCompiled = action;\n        }\n    }\n    /**\n     * Gets the list of webGL uniform locations associated with a specific program based on a list of uniform names\n     * @param pipelineContext defines the pipeline context to use\n     * @param uniformsNames defines the list of uniform names\n     * @returns an array of webGL uniform locations\n     */\n    getUniforms(pipelineContext, uniformsNames) {\n        const results = new Array();\n        const webGLPipelineContext = pipelineContext;\n        for (let index = 0; index < uniformsNames.length; index++) {\n            results.push(this._gl.getUniformLocation(webGLPipelineContext.program, uniformsNames[index]));\n        }\n        return results;\n    }\n    /**\n     * Gets the list of active attributes for a given webGL program\n     * @param pipelineContext defines the pipeline context to use\n     * @param attributesNames defines the list of attribute names to get\n     * @returns an array of indices indicating the offset of each attribute\n     */\n    getAttributes(pipelineContext, attributesNames) {\n        const results = [];\n        const webGLPipelineContext = pipelineContext;\n        for (let index = 0; index < attributesNames.length; index++) {\n            try {\n                results.push(this._gl.getAttribLocation(webGLPipelineContext.program, attributesNames[index]));\n            }\n            catch (e) {\n                results.push(-1);\n            }\n        }\n        return results;\n    }\n    /**\n     * Activates an effect, making it the current one (ie. the one used for rendering)\n     * @param effect defines the effect to activate\n     */\n    enableEffect(effect) {\n        effect = effect !== null && DrawWrapper.IsWrapper(effect) ? effect.effect : effect; // get only the effect, we don't need a Wrapper in the WebGL engine\n        if (!effect || effect === this._currentEffect) {\n            return;\n        }\n        this._stencilStateComposer.stencilMaterial = undefined;\n        effect = effect;\n        // Use program\n        this.bindSamplers(effect);\n        this._currentEffect = effect;\n        if (effect.onBind) {\n            effect.onBind(effect);\n        }\n        if (effect._onBindObservable) {\n            effect._onBindObservable.notifyObservers(effect);\n        }\n    }\n    /**\n     * Set the value of an uniform to a number (int)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param value defines the int number to store\n     * @returns true if the value was set\n     */\n    setInt(uniform, value) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform1i(uniform, value);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a int2\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @returns true if the value was set\n     */\n    setInt2(uniform, x, y) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform2i(uniform, x, y);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a int3\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @param z defines the 3rd component of the value\n     * @returns true if the value was set\n     */\n    setInt3(uniform, x, y, z) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform3i(uniform, x, y, z);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a int4\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @param z defines the 3rd component of the value\n     * @param w defines the 4th component of the value\n     * @returns true if the value was set\n     */\n    setInt4(uniform, x, y, z, w) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform4i(uniform, x, y, z, w);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of int32\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of int32 to store\n     * @returns true if the value was set\n     */\n    setIntArray(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform1iv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of int32 (stored as vec2)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of int32 to store\n     * @returns true if the value was set\n     */\n    setIntArray2(uniform, array) {\n        if (!uniform || array.length % 2 !== 0) {\n            return false;\n        }\n        this._gl.uniform2iv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of int32 (stored as vec3)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of int32 to store\n     * @returns true if the value was set\n     */\n    setIntArray3(uniform, array) {\n        if (!uniform || array.length % 3 !== 0) {\n            return false;\n        }\n        this._gl.uniform3iv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of int32 (stored as vec4)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of int32 to store\n     * @returns true if the value was set\n     */\n    setIntArray4(uniform, array) {\n        if (!uniform || array.length % 4 !== 0) {\n            return false;\n        }\n        this._gl.uniform4iv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a number (unsigned int)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param value defines the unsigned int number to store\n     * @returns true if the value was set\n     */\n    setUInt(uniform, value) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform1ui(uniform, value);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a unsigned int2\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @returns true if the value was set\n     */\n    setUInt2(uniform, x, y) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform2ui(uniform, x, y);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a unsigned int3\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @param z defines the 3rd component of the value\n     * @returns true if the value was set\n     */\n    setUInt3(uniform, x, y, z) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform3ui(uniform, x, y, z);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a unsigned int4\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @param z defines the 3rd component of the value\n     * @param w defines the 4th component of the value\n     * @returns true if the value was set\n     */\n    setUInt4(uniform, x, y, z, w) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform4ui(uniform, x, y, z, w);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of unsigned int32\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of unsigned int32 to store\n     * @returns true if the value was set\n     */\n    setUIntArray(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform1uiv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec2)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of unsigned int32 to store\n     * @returns true if the value was set\n     */\n    setUIntArray2(uniform, array) {\n        if (!uniform || array.length % 2 !== 0) {\n            return false;\n        }\n        this._gl.uniform2uiv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec3)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of unsigned int32 to store\n     * @returns true if the value was set\n     */\n    setUIntArray3(uniform, array) {\n        if (!uniform || array.length % 3 !== 0) {\n            return false;\n        }\n        this._gl.uniform3uiv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec4)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of unsigned int32 to store\n     * @returns true if the value was set\n     */\n    setUIntArray4(uniform, array) {\n        if (!uniform || array.length % 4 !== 0) {\n            return false;\n        }\n        this._gl.uniform4uiv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of number\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of number to store\n     * @returns true if the value was set\n     */\n    setArray(uniform, array) {\n        if (!uniform) {\n            return false;\n        }\n        if (array.length < 1) {\n            return false;\n        }\n        this._gl.uniform1fv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of number (stored as vec2)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of number to store\n     * @returns true if the value was set\n     */\n    setArray2(uniform, array) {\n        if (!uniform || array.length % 2 !== 0) {\n            return false;\n        }\n        this._gl.uniform2fv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of number (stored as vec3)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of number to store\n     * @returns true if the value was set\n     */\n    setArray3(uniform, array) {\n        if (!uniform || array.length % 3 !== 0) {\n            return false;\n        }\n        this._gl.uniform3fv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of number (stored as vec4)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param array defines the array of number to store\n     * @returns true if the value was set\n     */\n    setArray4(uniform, array) {\n        if (!uniform || array.length % 4 !== 0) {\n            return false;\n        }\n        this._gl.uniform4fv(uniform, array);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to an array of float32 (stored as matrices)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param matrices defines the array of float32 to store\n     * @returns true if the value was set\n     */\n    setMatrices(uniform, matrices) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniformMatrix4fv(uniform, false, matrices);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a matrix (3x3)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param matrix defines the Float32Array representing the 3x3 matrix to store\n     * @returns true if the value was set\n     */\n    setMatrix3x3(uniform, matrix) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniformMatrix3fv(uniform, false, matrix);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a matrix (2x2)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param matrix defines the Float32Array representing the 2x2 matrix to store\n     * @returns true if the value was set\n     */\n    setMatrix2x2(uniform, matrix) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniformMatrix2fv(uniform, false, matrix);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a number (float)\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param value defines the float number to store\n     * @returns true if the value was transferred\n     */\n    setFloat(uniform, value) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform1f(uniform, value);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a vec2\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @returns true if the value was set\n     */\n    setFloat2(uniform, x, y) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform2f(uniform, x, y);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a vec3\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @param z defines the 3rd component of the value\n     * @returns true if the value was set\n     */\n    setFloat3(uniform, x, y, z) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform3f(uniform, x, y, z);\n        return true;\n    }\n    /**\n     * Set the value of an uniform to a vec4\n     * @param uniform defines the webGL uniform location where to store the value\n     * @param x defines the 1st component of the value\n     * @param y defines the 2nd component of the value\n     * @param z defines the 3rd component of the value\n     * @param w defines the 4th component of the value\n     * @returns true if the value was set\n     */\n    setFloat4(uniform, x, y, z, w) {\n        if (!uniform) {\n            return false;\n        }\n        this._gl.uniform4f(uniform, x, y, z, w);\n        return true;\n    }\n    // States\n    /**\n     * Apply all cached states (depth, culling, stencil and alpha)\n     */\n    applyStates() {\n        this._depthCullingState.apply(this._gl);\n        this._stencilStateComposer.apply(this._gl);\n        this._alphaState.apply(this._gl);\n        if (this._colorWriteChanged) {\n            this._colorWriteChanged = false;\n            const enable = this._colorWrite;\n            this._gl.colorMask(enable, enable, enable, enable);\n        }\n    }\n    /**\n     * Enable or disable color writing\n     * @param enable defines the state to set\n     */\n    setColorWrite(enable) {\n        if (enable !== this._colorWrite) {\n            this._colorWriteChanged = true;\n            this._colorWrite = enable;\n        }\n    }\n    /**\n     * Gets a boolean indicating if color writing is enabled\n     * @returns the current color writing state\n     */\n    getColorWrite() {\n        return this._colorWrite;\n    }\n    /**\n     * Gets the depth culling state manager\n     */\n    get depthCullingState() {\n        return this._depthCullingState;\n    }\n    /**\n     * Gets the alpha state manager\n     */\n    get alphaState() {\n        return this._alphaState;\n    }\n    /**\n     * Gets the stencil state manager\n     */\n    get stencilState() {\n        return this._stencilState;\n    }\n    /**\n     * Gets the stencil state composer\n     */\n    get stencilStateComposer() {\n        return this._stencilStateComposer;\n    }\n    // Textures\n    /**\n     * Clears the list of texture accessible through engine.\n     * This can help preventing texture load conflict due to name collision.\n     */\n    clearInternalTexturesCache() {\n        this._internalTexturesCache.length = 0;\n    }\n    /**\n     * Force the entire cache to be cleared\n     * You should not have to use this function unless your engine needs to share the webGL context with another engine\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\n     */\n    wipeCaches(bruteForce) {\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\n            return;\n        }\n        this._currentEffect = null;\n        this._viewportCached.x = 0;\n        this._viewportCached.y = 0;\n        this._viewportCached.z = 0;\n        this._viewportCached.w = 0;\n        // Done before in case we clean the attributes\n        this._unbindVertexArrayObject();\n        if (bruteForce) {\n            this._currentProgram = null;\n            this.resetTextureCache();\n            this._stencilStateComposer.reset();\n            this._depthCullingState.reset();\n            this._depthCullingState.depthFunc = this._gl.LEQUAL;\n            this._alphaState.reset();\n            this._alphaMode = 1;\n            this._alphaEquation = 0;\n            this._colorWrite = true;\n            this._colorWriteChanged = true;\n            this._unpackFlipYCached = null;\n            this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE);\n            this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\n            this._mustWipeVertexAttributes = true;\n            this.unbindAllAttributes();\n        }\n        this._resetVertexBufferBinding();\n        this._cachedIndexBuffer = null;\n        this._cachedEffectForVertexBuffers = null;\n        this.bindIndexBuffer(null);\n    }\n    /**\n     * @internal\n     */\n    _getSamplingParameters(samplingMode, generateMipMaps) {\n        const gl = this._gl;\n        let magFilter = gl.NEAREST;\n        let minFilter = gl.NEAREST;\n        switch (samplingMode) {\n            case 11:\n                magFilter = gl.LINEAR;\n                if (generateMipMaps) {\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\n                }\n                else {\n                    minFilter = gl.LINEAR;\n                }\n                break;\n            case 3:\n                magFilter = gl.LINEAR;\n                if (generateMipMaps) {\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\n                }\n                else {\n                    minFilter = gl.LINEAR;\n                }\n                break;\n            case 8:\n                magFilter = gl.NEAREST;\n                if (generateMipMaps) {\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\n                }\n                else {\n                    minFilter = gl.NEAREST;\n                }\n                break;\n            case 4:\n                magFilter = gl.NEAREST;\n                if (generateMipMaps) {\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\n                }\n                else {\n                    minFilter = gl.NEAREST;\n                }\n                break;\n            case 5:\n                magFilter = gl.NEAREST;\n                if (generateMipMaps) {\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\n                }\n                else {\n                    minFilter = gl.LINEAR;\n                }\n                break;\n            case 6:\n                magFilter = gl.NEAREST;\n                if (generateMipMaps) {\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\n                }\n                else {\n                    minFilter = gl.LINEAR;\n                }\n                break;\n            case 7:\n                magFilter = gl.NEAREST;\n                minFilter = gl.LINEAR;\n                break;\n            case 1:\n                magFilter = gl.NEAREST;\n                minFilter = gl.NEAREST;\n                break;\n            case 9:\n                magFilter = gl.LINEAR;\n                if (generateMipMaps) {\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\n                }\n                else {\n                    minFilter = gl.NEAREST;\n                }\n                break;\n            case 10:\n                magFilter = gl.LINEAR;\n                if (generateMipMaps) {\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\n                }\n                else {\n                    minFilter = gl.NEAREST;\n                }\n                break;\n            case 2:\n                magFilter = gl.LINEAR;\n                minFilter = gl.LINEAR;\n                break;\n            case 12:\n                magFilter = gl.LINEAR;\n                minFilter = gl.NEAREST;\n                break;\n        }\n        return {\n            min: minFilter,\n            mag: magFilter,\n        };\n    }\n    /** @internal */\n    _createTexture() {\n        const texture = this._gl.createTexture();\n        if (!texture) {\n            throw new Error(\"Unable to create texture\");\n        }\n        return texture;\n    }\n    /** @internal */\n    _createHardwareTexture() {\n        return new WebGLHardwareTexture(this._createTexture(), this._gl);\n    }\n    /**\n     * Creates an internal texture without binding it to a framebuffer\n     * @internal\n     * @param size defines the size of the texture\n     * @param options defines the options used to create the texture\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\n     * @param source source type of the texture\n     * @returns a new internal texture\n     */\n    _createInternalTexture(size, options, delayGPUTextureCreation = true, source = InternalTextureSource.Unknown) {\n        var _a;\n        let generateMipMaps = false;\n        let type = 0;\n        let samplingMode = 3;\n        let format = 5;\n        let useSRGBBuffer = false;\n        let samples = 1;\n        if (options !== undefined && typeof options === \"object\") {\n            generateMipMaps = !!options.generateMipMaps;\n            type = options.type === undefined ? 0 : options.type;\n            samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\n            format = options.format === undefined ? 5 : options.format;\n            useSRGBBuffer = options.useSRGBBuffer === undefined ? false : options.useSRGBBuffer;\n            samples = (_a = options.samples) !== null && _a !== void 0 ? _a : 1;\n        }\n        else {\n            generateMipMaps = !!options;\n        }\n        useSRGBBuffer && (useSRGBBuffer = this._caps.supportSRGBBuffers && (this.webGLVersion > 1 || this.isWebGPU));\n        if (type === 1 && !this._caps.textureFloatLinearFiltering) {\n            // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\n            samplingMode = 1;\n        }\n        else if (type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\n            // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\n            samplingMode = 1;\n        }\n        if (type === 1 && !this._caps.textureFloat) {\n            type = 0;\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\n        }\n        const gl = this._gl;\n        const texture = new InternalTexture(this, source);\n        const width = size.width || size;\n        const height = size.height || size;\n        const layers = size.layers || 0;\n        const filters = this._getSamplingParameters(samplingMode, generateMipMaps);\n        const target = layers !== 0 ? gl.TEXTURE_2D_ARRAY : gl.TEXTURE_2D;\n        const sizedFormat = this._getRGBABufferInternalSizedFormat(type, format, useSRGBBuffer);\n        const internalFormat = this._getInternalFormat(format);\n        const textureType = this._getWebGLTextureType(type);\n        // Bind\n        this._bindTextureDirectly(target, texture);\n        if (layers !== 0) {\n            texture.is2DArray = true;\n            gl.texImage3D(target, 0, sizedFormat, width, height, layers, 0, internalFormat, textureType, null);\n        }\n        else {\n            gl.texImage2D(target, 0, sizedFormat, width, height, 0, internalFormat, textureType, null);\n        }\n        gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, filters.mag);\n        gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, filters.min);\n        gl.texParameteri(target, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(target, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        // MipMaps\n        if (generateMipMaps) {\n            this._gl.generateMipmap(target);\n        }\n        this._bindTextureDirectly(target, null);\n        texture._useSRGBBuffer = useSRGBBuffer;\n        texture.baseWidth = width;\n        texture.baseHeight = height;\n        texture.width = width;\n        texture.height = height;\n        texture.depth = layers;\n        texture.isReady = true;\n        texture.samples = samples;\n        texture.generateMipMaps = generateMipMaps;\n        texture.samplingMode = samplingMode;\n        texture.type = type;\n        texture.format = format;\n        this._internalTexturesCache.push(texture);\n        return texture;\n    }\n    /**\n     * @internal\n     */\n    _getUseSRGBBuffer(useSRGBBuffer, noMipmap) {\n        // Generating mipmaps for sRGB textures is not supported in WebGL1 so we must disable the support if mipmaps is enabled\n        return useSRGBBuffer && this._caps.supportSRGBBuffers && (this.webGLVersion > 1 || this.isWebGPU || noMipmap);\n    }\n    _createTextureBase(url, noMipmap, invertY, scene, samplingMode = 3, onLoad = null, onError = null, prepareTexture, prepareTextureProcessFunction, buffer = null, fallback = null, format = null, forcedExtension = null, mimeType, loaderOptions, useSRGBBuffer) {\n        url = url || \"\";\n        const fromData = url.substr(0, 5) === \"data:\";\n        const fromBlob = url.substr(0, 5) === \"blob:\";\n        const isBase64 = fromData && url.indexOf(\";base64,\") !== -1;\n        const texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Url);\n        const originalUrl = url;\n        if (this._transformTextureUrl && !isBase64 && !fallback && !buffer) {\n            url = this._transformTextureUrl(url);\n        }\n        if (originalUrl !== url) {\n            texture._originalUrl = originalUrl;\n        }\n        // establish the file extension, if possible\n        const lastDot = url.lastIndexOf(\".\");\n        let extension = forcedExtension ? forcedExtension : lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\";\n        let loader = null;\n        // Remove query string\n        const queryStringIndex = extension.indexOf(\"?\");\n        if (queryStringIndex > -1) {\n            extension = extension.split(\"?\")[0];\n        }\n        for (const availableLoader of ThinEngine._TextureLoaders) {\n            if (availableLoader.canLoad(extension, mimeType)) {\n                loader = availableLoader;\n                break;\n            }\n        }\n        if (scene) {\n            scene.addPendingData(texture);\n        }\n        texture.url = url;\n        texture.generateMipMaps = !noMipmap;\n        texture.samplingMode = samplingMode;\n        texture.invertY = invertY;\n        texture._useSRGBBuffer = this._getUseSRGBBuffer(!!useSRGBBuffer, noMipmap);\n        if (!this._doNotHandleContextLost) {\n            // Keep a link to the buffer only if we plan to handle context lost\n            texture._buffer = buffer;\n        }\n        let onLoadObserver = null;\n        if (onLoad && !fallback) {\n            onLoadObserver = texture.onLoadedObservable.add(onLoad);\n        }\n        if (!fallback) {\n            this._internalTexturesCache.push(texture);\n        }\n        const onInternalError = (message, exception) => {\n            if (scene) {\n                scene.removePendingData(texture);\n            }\n            if (url === originalUrl) {\n                if (onLoadObserver) {\n                    texture.onLoadedObservable.remove(onLoadObserver);\n                }\n                if (EngineStore.UseFallbackTexture) {\n                    this._createTextureBase(EngineStore.FallbackTexture, noMipmap, texture.invertY, scene, samplingMode, null, onError, prepareTexture, prepareTextureProcessFunction, buffer, texture);\n                }\n                message = (message || \"Unknown error\") + (EngineStore.UseFallbackTexture ? \" - Fallback texture was used\" : \"\");\n                texture.onErrorObservable.notifyObservers({ message, exception });\n                if (onError) {\n                    onError(message, exception);\n                }\n            }\n            else {\n                // fall back to the original url if the transformed url fails to load\n                Logger.Warn(`Failed to load ${url}, falling back to ${originalUrl}`);\n                this._createTextureBase(originalUrl, noMipmap, texture.invertY, scene, samplingMode, onLoad, onError, prepareTexture, prepareTextureProcessFunction, buffer, texture, format, forcedExtension, mimeType, loaderOptions, useSRGBBuffer);\n            }\n        };\n        // processing for non-image formats\n        if (loader) {\n            const callback = (data) => {\n                loader.loadData(data, texture, (width, height, loadMipmap, isCompressed, done, loadFailed) => {\n                    if (loadFailed) {\n                        onInternalError(\"TextureLoader failed to load data\");\n                    }\n                    else {\n                        prepareTexture(texture, extension, scene, { width, height }, texture.invertY, !loadMipmap, isCompressed, () => {\n                            done();\n                            return false;\n                        }, samplingMode);\n                    }\n                }, loaderOptions);\n            };\n            if (!buffer) {\n                this._loadFile(url, (data) => callback(new Uint8Array(data)), undefined, scene ? scene.offlineProvider : undefined, true, (request, exception) => {\n                    onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\n                });\n            }\n            else {\n                if (buffer instanceof ArrayBuffer) {\n                    callback(new Uint8Array(buffer));\n                }\n                else if (ArrayBuffer.isView(buffer)) {\n                    callback(buffer);\n                }\n                else {\n                    if (onError) {\n                        onError(\"Unable to load: only ArrayBuffer or ArrayBufferView is supported\", null);\n                    }\n                }\n            }\n        }\n        else {\n            const onload = (img) => {\n                if (fromBlob && !this._doNotHandleContextLost) {\n                    // We need to store the image if we need to rebuild the texture\n                    // in case of a webgl context lost\n                    texture._buffer = img;\n                }\n                prepareTexture(texture, extension, scene, img, texture.invertY, noMipmap, false, prepareTextureProcessFunction, samplingMode);\n            };\n            // According to the WebGL spec section 6.10, ImageBitmaps must be inverted on creation.\n            // So, we pass imageOrientation to _FileToolsLoadImage() as it may create an ImageBitmap.\n            if (!fromData || isBase64) {\n                if (buffer && (typeof buffer.decoding === \"string\" || buffer.close)) {\n                    onload(buffer);\n                }\n                else {\n                    ThinEngine._FileToolsLoadImage(url, onload, onInternalError, scene ? scene.offlineProvider : null, mimeType, texture.invertY && this._features.needsInvertingBitmap ? { imageOrientation: \"flipY\" } : undefined);\n                }\n            }\n            else if (typeof buffer === \"string\" || buffer instanceof ArrayBuffer || ArrayBuffer.isView(buffer) || buffer instanceof Blob) {\n                ThinEngine._FileToolsLoadImage(buffer, onload, onInternalError, scene ? scene.offlineProvider : null, mimeType, texture.invertY && this._features.needsInvertingBitmap ? { imageOrientation: \"flipY\" } : undefined);\n            }\n            else if (buffer) {\n                onload(buffer);\n            }\n        }\n        return texture;\n    }\n    /**\n     * Usually called from Texture.ts.\n     * Passed information to create a WebGLTexture\n     * @param url defines a value which contains one of the following:\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\n     * @param scene needed for loading to the correct scene\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\n     * @param onLoad optional callback to be called upon successful completion\n     * @param onError optional callback to be called upon failure\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\n     * @param forcedExtension defines the extension to use to pick the right loader\n     * @param mimeType defines an optional mime type\n     * @param loaderOptions options to be passed to the loader\n     * @param creationFlags specific flags to use when creating the texture (1 for storage textures, for eg)\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\n     */\n    createTexture(url, noMipmap, invertY, scene, samplingMode = 3, onLoad = null, onError = null, buffer = null, fallback = null, format = null, forcedExtension = null, mimeType, loaderOptions, creationFlags, useSRGBBuffer) {\n        return this._createTextureBase(url, noMipmap, invertY, scene, samplingMode, onLoad, onError, this._prepareWebGLTexture.bind(this), (potWidth, potHeight, img, extension, texture, continuationCallback) => {\n            const gl = this._gl;\n            const isPot = img.width === potWidth && img.height === potHeight;\n            const internalFormat = format\n                ? this._getInternalFormat(format, texture._useSRGBBuffer)\n                : extension === \".jpg\" && !texture._useSRGBBuffer\n                    ? gl.RGB\n                    : texture._useSRGBBuffer\n                        ? gl.SRGB8_ALPHA8\n                        : gl.RGBA;\n            let texelFormat = format ? this._getInternalFormat(format) : extension === \".jpg\" && !texture._useSRGBBuffer ? gl.RGB : gl.RGBA;\n            if (texture._useSRGBBuffer && this.webGLVersion === 1) {\n                texelFormat = internalFormat;\n            }\n            if (isPot) {\n                gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, texelFormat, gl.UNSIGNED_BYTE, img);\n                return false;\n            }\n            const maxTextureSize = this._caps.maxTextureSize;\n            if (img.width > maxTextureSize || img.height > maxTextureSize || !this._supportsHardwareTextureRescaling) {\n                this._prepareWorkingCanvas();\n                if (!this._workingCanvas || !this._workingContext) {\n                    return false;\n                }\n                this._workingCanvas.width = potWidth;\n                this._workingCanvas.height = potHeight;\n                this._workingContext.drawImage(img, 0, 0, img.width, img.height, 0, 0, potWidth, potHeight);\n                gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, texelFormat, gl.UNSIGNED_BYTE, this._workingCanvas);\n                texture.width = potWidth;\n                texture.height = potHeight;\n                return false;\n            }\n            else {\n                // Using shaders when possible to rescale because canvas.drawImage is lossy\n                const source = new InternalTexture(this, InternalTextureSource.Temp);\n                this._bindTextureDirectly(gl.TEXTURE_2D, source, true);\n                gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, texelFormat, gl.UNSIGNED_BYTE, img);\n                this._rescaleTexture(source, texture, scene, internalFormat, () => {\n                    this._releaseTexture(source);\n                    this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\n                    continuationCallback();\n                });\n            }\n            return true;\n        }, buffer, fallback, format, forcedExtension, mimeType, loaderOptions, useSRGBBuffer);\n    }\n    /**\n     * Loads an image as an HTMLImageElement.\n     * @param input url string, ArrayBuffer, or Blob to load\n     * @param onLoad callback called when the image successfully loads\n     * @param onError callback called when the image fails to load\n     * @param offlineProvider offline provider for caching\n     * @param mimeType optional mime type\n     * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\n     * @returns the HTMLImageElement of the loaded image\n     * @internal\n     */\n    static _FileToolsLoadImage(input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions) {\n        throw _WarnImport(\"FileTools\");\n    }\n    /**\n     * @internal\n     */\n    _rescaleTexture(source, destination, scene, internalFormat, onComplete) { }\n    /**\n     * Creates a raw texture\n     * @param data defines the data to store in the texture\n     * @param width defines the width of the texture\n     * @param height defines the height of the texture\n     * @param format defines the format of the data\n     * @param generateMipMaps defines if the engine should generate the mip levels\n     * @param invertY defines if data must be stored with Y axis inverted\n     * @param samplingMode defines the required sampling mode (Texture.NEAREST_SAMPLINGMODE by default)\n     * @param compression defines the compression used (null by default)\n     * @param type defines the type fo the data (Engine.TEXTURETYPE_UNSIGNED_INT by default)\n     * @param creationFlags specific flags to use when creating the texture (1 for storage textures, for eg)\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\n     * @returns the raw texture inside an InternalTexture\n     */\n    createRawTexture(data, width, height, format, generateMipMaps, invertY, samplingMode, compression = null, type = 0, creationFlags = 0, useSRGBBuffer = false) {\n        throw _WarnImport(\"Engine.RawTexture\");\n    }\n    /**\n     * Creates a new raw cube texture\n     * @param data defines the array of data to use to create each face\n     * @param size defines the size of the textures\n     * @param format defines the format of the data\n     * @param type defines the type of the data (like Engine.TEXTURETYPE_UNSIGNED_INT)\n     * @param generateMipMaps  defines if the engine should generate the mip levels\n     * @param invertY defines if data must be stored with Y axis inverted\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\n     * @param compression defines the compression used (null by default)\n     * @returns the cube texture as an InternalTexture\n     */\n    createRawCubeTexture(data, size, format, type, generateMipMaps, invertY, samplingMode, compression = null) {\n        throw _WarnImport(\"Engine.RawTexture\");\n    }\n    /**\n     * Creates a new raw 3D texture\n     * @param data defines the data used to create the texture\n     * @param width defines the width of the texture\n     * @param height defines the height of the texture\n     * @param depth defines the depth of the texture\n     * @param format defines the format of the texture\n     * @param generateMipMaps defines if the engine must generate mip levels\n     * @param invertY defines if data must be stored with Y axis inverted\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\n     * @param compression defines the compressed used (can be null)\n     * @param textureType defines the compressed used (can be null)\n     * @returns a new raw 3D texture (stored in an InternalTexture)\n     */\n    createRawTexture3D(data, width, height, depth, format, generateMipMaps, invertY, samplingMode, compression = null, textureType = 0) {\n        throw _WarnImport(\"Engine.RawTexture\");\n    }\n    /**\n     * Creates a new raw 2D array texture\n     * @param data defines the data used to create the texture\n     * @param width defines the width of the texture\n     * @param height defines the height of the texture\n     * @param depth defines the number of layers of the texture\n     * @param format defines the format of the texture\n     * @param generateMipMaps defines if the engine must generate mip levels\n     * @param invertY defines if data must be stored with Y axis inverted\n     * @param samplingMode defines the required sampling mode (like Texture.NEAREST_SAMPLINGMODE)\n     * @param compression defines the compressed used (can be null)\n     * @param textureType defines the compressed used (can be null)\n     * @returns a new raw 2D array texture (stored in an InternalTexture)\n     */\n    createRawTexture2DArray(data, width, height, depth, format, generateMipMaps, invertY, samplingMode, compression = null, textureType = 0) {\n        throw _WarnImport(\"Engine.RawTexture\");\n    }\n    /**\n     * @internal\n     */\n    _unpackFlipY(value) {\n        if (this._unpackFlipYCached !== value) {\n            this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, value ? 1 : 0);\n            if (this.enableUnpackFlipYCached) {\n                this._unpackFlipYCached = value;\n            }\n        }\n    }\n    /** @internal */\n    _getUnpackAlignement() {\n        return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT);\n    }\n    _getTextureTarget(texture) {\n        if (texture.isCube) {\n            return this._gl.TEXTURE_CUBE_MAP;\n        }\n        else if (texture.is3D) {\n            return this._gl.TEXTURE_3D;\n        }\n        else if (texture.is2DArray || texture.isMultiview) {\n            return this._gl.TEXTURE_2D_ARRAY;\n        }\n        return this._gl.TEXTURE_2D;\n    }\n    /**\n     * Update the sampling mode of a given texture\n     * @param samplingMode defines the required sampling mode\n     * @param texture defines the texture to update\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\n     */\n    updateTextureSamplingMode(samplingMode, texture, generateMipMaps = false) {\n        const target = this._getTextureTarget(texture);\n        const filters = this._getSamplingParameters(samplingMode, texture.generateMipMaps || generateMipMaps);\n        this._setTextureParameterInteger(target, this._gl.TEXTURE_MAG_FILTER, filters.mag, texture);\n        this._setTextureParameterInteger(target, this._gl.TEXTURE_MIN_FILTER, filters.min);\n        if (generateMipMaps) {\n            texture.generateMipMaps = true;\n            this._gl.generateMipmap(target);\n        }\n        this._bindTextureDirectly(target, null);\n        texture.samplingMode = samplingMode;\n    }\n    /**\n     * Update the dimensions of a texture\n     * @param texture texture to update\n     * @param width new width of the texture\n     * @param height new height of the texture\n     * @param depth new depth of the texture\n     */\n    updateTextureDimensions(texture, width, height, depth = 1) { }\n    /**\n     * Update the sampling mode of a given texture\n     * @param texture defines the texture to update\n     * @param wrapU defines the texture wrap mode of the u coordinates\n     * @param wrapV defines the texture wrap mode of the v coordinates\n     * @param wrapR defines the texture wrap mode of the r coordinates\n     */\n    updateTextureWrappingMode(texture, wrapU, wrapV = null, wrapR = null) {\n        const target = this._getTextureTarget(texture);\n        if (wrapU !== null) {\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(wrapU), texture);\n            texture._cachedWrapU = wrapU;\n        }\n        if (wrapV !== null) {\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(wrapV), texture);\n            texture._cachedWrapV = wrapV;\n        }\n        if ((texture.is2DArray || texture.is3D) && wrapR !== null) {\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(wrapR), texture);\n            texture._cachedWrapR = wrapR;\n        }\n        this._bindTextureDirectly(target, null);\n    }\n    /**\n     * @internal\n     */\n    _setupDepthStencilTexture(internalTexture, size, generateStencil, bilinearFiltering, comparisonFunction, samples = 1) {\n        const width = size.width || size;\n        const height = size.height || size;\n        const layers = size.layers || 0;\n        internalTexture.baseWidth = width;\n        internalTexture.baseHeight = height;\n        internalTexture.width = width;\n        internalTexture.height = height;\n        internalTexture.is2DArray = layers > 0;\n        internalTexture.depth = layers;\n        internalTexture.isReady = true;\n        internalTexture.samples = samples;\n        internalTexture.generateMipMaps = false;\n        internalTexture.samplingMode = bilinearFiltering ? 2 : 1;\n        internalTexture.type = 0;\n        internalTexture._comparisonFunction = comparisonFunction;\n        const gl = this._gl;\n        const target = this._getTextureTarget(internalTexture);\n        const samplingParameters = this._getSamplingParameters(internalTexture.samplingMode, false);\n        gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, samplingParameters.mag);\n        gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, samplingParameters.min);\n        gl.texParameteri(target, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(target, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        // TEXTURE_COMPARE_FUNC/MODE are only availble in WebGL2.\n        if (this.webGLVersion > 1) {\n            if (comparisonFunction === 0) {\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, 515);\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.NONE);\n            }\n            else {\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, comparisonFunction);\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\n            }\n        }\n    }\n    /**\n     * @internal\n     */\n    _uploadCompressedDataToTextureDirectly(texture, internalFormat, width, height, data, faceIndex = 0, lod = 0) {\n        const gl = this._gl;\n        let target = gl.TEXTURE_2D;\n        if (texture.isCube) {\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\n        }\n        if (texture._useSRGBBuffer) {\n            switch (internalFormat) {\n                case 37492:\n                case 36196:\n                    // Note, if using ETC1 and sRGB is requested, this will use ETC2 if available.\n                    if (this._caps.etc2) {\n                        internalFormat = gl.COMPRESSED_SRGB8_ETC2;\n                    }\n                    else {\n                        texture._useSRGBBuffer = false;\n                    }\n                    break;\n                case 37496:\n                    if (this._caps.etc2) {\n                        internalFormat = gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;\n                    }\n                    else {\n                        texture._useSRGBBuffer = false;\n                    }\n                    break;\n                case 36492:\n                    internalFormat = gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;\n                    break;\n                case 37808:\n                    internalFormat = gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;\n                    break;\n                case 33776:\n                    if (this._caps.s3tc_srgb) {\n                        internalFormat = gl.COMPRESSED_SRGB_S3TC_DXT1_EXT;\n                    }\n                    else {\n                        // S3TC sRGB extension not supported\n                        texture._useSRGBBuffer = false;\n                    }\n                    break;\n                case 33777:\n                    if (this._caps.s3tc_srgb) {\n                        internalFormat = gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\n                    }\n                    else {\n                        // S3TC sRGB extension not supported\n                        texture._useSRGBBuffer = false;\n                    }\n                    break;\n                case 33779:\n                    if (this._caps.s3tc_srgb) {\n                        internalFormat = gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\n                    }\n                    else {\n                        // S3TC sRGB extension not supported\n                        texture._useSRGBBuffer = false;\n                    }\n                    break;\n                default:\n                    // We don't support a sRGB format corresponding to internalFormat, so revert to non sRGB format\n                    texture._useSRGBBuffer = false;\n                    break;\n            }\n        }\n        this._gl.compressedTexImage2D(target, lod, internalFormat, width, height, 0, data);\n    }\n    /**\n     * @internal\n     */\n    _uploadDataToTextureDirectly(texture, imageData, faceIndex = 0, lod = 0, babylonInternalFormat, useTextureWidthAndHeight = false) {\n        const gl = this._gl;\n        const textureType = this._getWebGLTextureType(texture.type);\n        const format = this._getInternalFormat(texture.format);\n        const internalFormat = babylonInternalFormat === undefined\n            ? this._getRGBABufferInternalSizedFormat(texture.type, texture.format, texture._useSRGBBuffer)\n            : this._getInternalFormat(babylonInternalFormat, texture._useSRGBBuffer);\n        this._unpackFlipY(texture.invertY);\n        let target = gl.TEXTURE_2D;\n        if (texture.isCube) {\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\n        }\n        const lodMaxWidth = Math.round(Math.log(texture.width) * Math.LOG2E);\n        const lodMaxHeight = Math.round(Math.log(texture.height) * Math.LOG2E);\n        const width = useTextureWidthAndHeight ? texture.width : Math.pow(2, Math.max(lodMaxWidth - lod, 0));\n        const height = useTextureWidthAndHeight ? texture.height : Math.pow(2, Math.max(lodMaxHeight - lod, 0));\n        gl.texImage2D(target, lod, internalFormat, width, height, 0, format, textureType, imageData);\n    }\n    /**\n     * Update a portion of an internal texture\n     * @param texture defines the texture to update\n     * @param imageData defines the data to store into the texture\n     * @param xOffset defines the x coordinates of the update rectangle\n     * @param yOffset defines the y coordinates of the update rectangle\n     * @param width defines the width of the update rectangle\n     * @param height defines the height of the update rectangle\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\n     * @param lod defines the lod level to update (0 by default)\n     * @param generateMipMaps defines whether to generate mipmaps or not\n     */\n    updateTextureData(texture, imageData, xOffset, yOffset, width, height, faceIndex = 0, lod = 0, generateMipMaps = false) {\n        const gl = this._gl;\n        const textureType = this._getWebGLTextureType(texture.type);\n        const format = this._getInternalFormat(texture.format);\n        this._unpackFlipY(texture.invertY);\n        let targetForBinding = gl.TEXTURE_2D;\n        let target = gl.TEXTURE_2D;\n        if (texture.isCube) {\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\n            targetForBinding = gl.TEXTURE_CUBE_MAP;\n        }\n        this._bindTextureDirectly(targetForBinding, texture, true);\n        gl.texSubImage2D(target, lod, xOffset, yOffset, width, height, format, textureType, imageData);\n        if (generateMipMaps) {\n            this._gl.generateMipmap(target);\n        }\n        this._bindTextureDirectly(targetForBinding, null);\n    }\n    /**\n     * @internal\n     */\n    _uploadArrayBufferViewToTexture(texture, imageData, faceIndex = 0, lod = 0) {\n        const gl = this._gl;\n        const bindTarget = texture.isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\n        this._bindTextureDirectly(bindTarget, texture, true);\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\n        this._bindTextureDirectly(bindTarget, null, true);\n    }\n    _prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode) {\n        const gl = this._gl;\n        if (!gl) {\n            return;\n        }\n        const filters = this._getSamplingParameters(samplingMode, !noMipmap);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filters.mag);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filters.min);\n        if (!noMipmap && !isCompressed) {\n            gl.generateMipmap(gl.TEXTURE_2D);\n        }\n        this._bindTextureDirectly(gl.TEXTURE_2D, null);\n        // this.resetTextureCache();\n        if (scene) {\n            scene.removePendingData(texture);\n        }\n        texture.onLoadedObservable.notifyObservers(texture);\n        texture.onLoadedObservable.clear();\n    }\n    _prepareWebGLTexture(texture, extension, scene, img, invertY, noMipmap, isCompressed, processFunction, samplingMode = 3) {\n        const maxTextureSize = this.getCaps().maxTextureSize;\n        const potWidth = Math.min(maxTextureSize, this.needPOTTextures ? ThinEngine.GetExponentOfTwo(img.width, maxTextureSize) : img.width);\n        const potHeight = Math.min(maxTextureSize, this.needPOTTextures ? ThinEngine.GetExponentOfTwo(img.height, maxTextureSize) : img.height);\n        const gl = this._gl;\n        if (!gl) {\n            return;\n        }\n        if (!texture._hardwareTexture) {\n            //  this.resetTextureCache();\n            if (scene) {\n                scene.removePendingData(texture);\n            }\n            return;\n        }\n        this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\n        this._unpackFlipY(invertY === undefined ? true : invertY ? true : false);\n        texture.baseWidth = img.width;\n        texture.baseHeight = img.height;\n        texture.width = potWidth;\n        texture.height = potHeight;\n        texture.isReady = true;\n        if (processFunction(potWidth, potHeight, img, extension, texture, () => {\n            this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\n        })) {\n            // Returning as texture needs extra async steps\n            return;\n        }\n        this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\n    }\n    /**\n     * @internal\n     */\n    _setupFramebufferDepthAttachments(generateStencilBuffer, generateDepthBuffer, width, height, samples = 1) {\n        const gl = this._gl;\n        // Create the depth/stencil buffer\n        if (generateStencilBuffer && generateDepthBuffer) {\n            return this._createRenderBuffer(width, height, samples, gl.DEPTH_STENCIL, gl.DEPTH24_STENCIL8, gl.DEPTH_STENCIL_ATTACHMENT);\n        }\n        if (generateDepthBuffer) {\n            let depthFormat = gl.DEPTH_COMPONENT16;\n            if (this._webGLVersion > 1) {\n                depthFormat = gl.DEPTH_COMPONENT32F;\n            }\n            return this._createRenderBuffer(width, height, samples, depthFormat, depthFormat, gl.DEPTH_ATTACHMENT);\n        }\n        if (generateStencilBuffer) {\n            return this._createRenderBuffer(width, height, samples, gl.STENCIL_INDEX8, gl.STENCIL_INDEX8, gl.STENCIL_ATTACHMENT);\n        }\n        return null;\n    }\n    /**\n     * @internal\n     */\n    _createRenderBuffer(width, height, samples, internalFormat, msInternalFormat, attachment, unbindBuffer = true) {\n        const gl = this._gl;\n        const renderBuffer = gl.createRenderbuffer();\n        return this._updateRenderBuffer(renderBuffer, width, height, samples, internalFormat, msInternalFormat, attachment, unbindBuffer);\n    }\n    _updateRenderBuffer(renderBuffer, width, height, samples, internalFormat, msInternalFormat, attachment, unbindBuffer = true) {\n        const gl = this._gl;\n        gl.bindRenderbuffer(gl.RENDERBUFFER, renderBuffer);\n        if (samples > 1 && gl.renderbufferStorageMultisample) {\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, msInternalFormat, width, height);\n        }\n        else {\n            gl.renderbufferStorage(gl.RENDERBUFFER, internalFormat, width, height);\n        }\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, renderBuffer);\n        if (unbindBuffer) {\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n        }\n        return renderBuffer;\n    }\n    /**\n     * @internal\n     */\n    _releaseTexture(texture) {\n        var _a;\n        this._deleteTexture((_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource);\n        // Unbind channels\n        this.unbindAllTextures();\n        const index = this._internalTexturesCache.indexOf(texture);\n        if (index !== -1) {\n            this._internalTexturesCache.splice(index, 1);\n        }\n        // Integrated fixed lod samplers.\n        if (texture._lodTextureHigh) {\n            texture._lodTextureHigh.dispose();\n        }\n        if (texture._lodTextureMid) {\n            texture._lodTextureMid.dispose();\n        }\n        if (texture._lodTextureLow) {\n            texture._lodTextureLow.dispose();\n        }\n        // Integrated irradiance map.\n        if (texture._irradianceTexture) {\n            texture._irradianceTexture.dispose();\n        }\n    }\n    /**\n     * @internal\n     */\n    _releaseRenderTargetWrapper(rtWrapper) {\n        const index = this._renderTargetWrapperCache.indexOf(rtWrapper);\n        if (index !== -1) {\n            this._renderTargetWrapperCache.splice(index, 1);\n        }\n    }\n    _deleteTexture(texture) {\n        if (texture) {\n            this._gl.deleteTexture(texture);\n        }\n    }\n    _setProgram(program) {\n        if (this._currentProgram !== program) {\n            this._gl.useProgram(program);\n            this._currentProgram = program;\n        }\n    }\n    /**\n     * Binds an effect to the webGL context\n     * @param effect defines the effect to bind\n     */\n    bindSamplers(effect) {\n        const webGLPipelineContext = effect.getPipelineContext();\n        this._setProgram(webGLPipelineContext.program);\n        const samplers = effect.getSamplers();\n        for (let index = 0; index < samplers.length; index++) {\n            const uniform = effect.getUniform(samplers[index]);\n            if (uniform) {\n                this._boundUniforms[index] = uniform;\n            }\n        }\n        this._currentEffect = null;\n    }\n    _activateCurrentTexture() {\n        if (this._currentTextureChannel !== this._activeChannel) {\n            this._gl.activeTexture(this._gl.TEXTURE0 + this._activeChannel);\n            this._currentTextureChannel = this._activeChannel;\n        }\n    }\n    /**\n     * @internal\n     */\n    _bindTextureDirectly(target, texture, forTextureDataUpdate = false, force = false) {\n        var _a, _b;\n        let wasPreviouslyBound = false;\n        const isTextureForRendering = texture && texture._associatedChannel > -1;\n        if (forTextureDataUpdate && isTextureForRendering) {\n            this._activeChannel = texture._associatedChannel;\n        }\n        const currentTextureBound = this._boundTexturesCache[this._activeChannel];\n        if (currentTextureBound !== texture || force) {\n            this._activateCurrentTexture();\n            if (texture && texture.isMultiview) {\n                //this._gl.bindTexture(target, texture ? texture._colorTextureArray : null);\n                console.error(target, texture);\n                throw \"_bindTextureDirectly called with a multiview texture!\";\n            }\n            else {\n                this._gl.bindTexture(target, (_b = (_a = texture === null || texture === void 0 ? void 0 : texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource) !== null && _b !== void 0 ? _b : null);\n            }\n            this._boundTexturesCache[this._activeChannel] = texture;\n            if (texture) {\n                texture._associatedChannel = this._activeChannel;\n            }\n        }\n        else if (forTextureDataUpdate) {\n            wasPreviouslyBound = true;\n            this._activateCurrentTexture();\n        }\n        if (isTextureForRendering && !forTextureDataUpdate) {\n            this._bindSamplerUniformToChannel(texture._associatedChannel, this._activeChannel);\n        }\n        return wasPreviouslyBound;\n    }\n    /**\n     * @internal\n     */\n    _bindTexture(channel, texture, name) {\n        if (channel === undefined) {\n            return;\n        }\n        if (texture) {\n            texture._associatedChannel = channel;\n        }\n        this._activeChannel = channel;\n        const target = texture ? this._getTextureTarget(texture) : this._gl.TEXTURE_2D;\n        this._bindTextureDirectly(target, texture);\n    }\n    /**\n     * Unbind all textures from the webGL context\n     */\n    unbindAllTextures() {\n        for (let channel = 0; channel < this._maxSimultaneousTextures; channel++) {\n            this._activeChannel = channel;\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\n            this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\n            if (this.webGLVersion > 1) {\n                this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\n                this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, null);\n            }\n        }\n    }\n    /**\n     * Sets a texture to the according uniform.\n     * @param channel The texture channel\n     * @param uniform The uniform to set\n     * @param texture The texture to apply\n     * @param name The name of the uniform in the effect\n     */\n    setTexture(channel, uniform, texture, name) {\n        if (channel === undefined) {\n            return;\n        }\n        if (uniform) {\n            this._boundUniforms[channel] = uniform;\n        }\n        this._setTexture(channel, texture);\n    }\n    _bindSamplerUniformToChannel(sourceSlot, destination) {\n        const uniform = this._boundUniforms[sourceSlot];\n        if (!uniform || uniform._currentState === destination) {\n            return;\n        }\n        this._gl.uniform1i(uniform, destination);\n        uniform._currentState = destination;\n    }\n    _getTextureWrapMode(mode) {\n        switch (mode) {\n            case 1:\n                return this._gl.REPEAT;\n            case 0:\n                return this._gl.CLAMP_TO_EDGE;\n            case 2:\n                return this._gl.MIRRORED_REPEAT;\n        }\n        return this._gl.REPEAT;\n    }\n    _setTexture(channel, texture, isPartOfTextureArray = false, depthStencilTexture = false, name = \"\") {\n        // Not ready?\n        if (!texture) {\n            if (this._boundTexturesCache[channel] != null) {\n                this._activeChannel = channel;\n                this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\n                this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\n                if (this.webGLVersion > 1) {\n                    this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\n                    this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, null);\n                }\n            }\n            return false;\n        }\n        // Video\n        if (texture.video) {\n            this._activeChannel = channel;\n            texture.update();\n        }\n        else if (texture.delayLoadState === 4) {\n            // Delay loading\n            texture.delayLoad();\n            return false;\n        }\n        let internalTexture;\n        if (depthStencilTexture) {\n            internalTexture = texture.depthStencilTexture;\n        }\n        else if (texture.isReady()) {\n            internalTexture = texture.getInternalTexture();\n        }\n        else if (texture.isCube) {\n            internalTexture = this.emptyCubeTexture;\n        }\n        else if (texture.is3D) {\n            internalTexture = this.emptyTexture3D;\n        }\n        else if (texture.is2DArray) {\n            internalTexture = this.emptyTexture2DArray;\n        }\n        else {\n            internalTexture = this.emptyTexture;\n        }\n        if (!isPartOfTextureArray && internalTexture) {\n            internalTexture._associatedChannel = channel;\n        }\n        let needToBind = true;\n        if (this._boundTexturesCache[channel] === internalTexture) {\n            if (!isPartOfTextureArray) {\n                this._bindSamplerUniformToChannel(internalTexture._associatedChannel, channel);\n            }\n            needToBind = false;\n        }\n        this._activeChannel = channel;\n        const target = this._getTextureTarget(internalTexture);\n        if (needToBind) {\n            this._bindTextureDirectly(target, internalTexture, isPartOfTextureArray);\n        }\n        if (internalTexture && !internalTexture.isMultiview) {\n            // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\n            if (internalTexture.isCube && internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\n                internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\n                const textureWrapMode = texture.coordinatesMode !== 3 && texture.coordinatesMode !== 5\n                    ? 1\n                    : 0;\n                texture.wrapU = textureWrapMode;\n                texture.wrapV = textureWrapMode;\n            }\n            if (internalTexture._cachedWrapU !== texture.wrapU) {\n                internalTexture._cachedWrapU = texture.wrapU;\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(texture.wrapU), internalTexture);\n            }\n            if (internalTexture._cachedWrapV !== texture.wrapV) {\n                internalTexture._cachedWrapV = texture.wrapV;\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(texture.wrapV), internalTexture);\n            }\n            if (internalTexture.is3D && internalTexture._cachedWrapR !== texture.wrapR) {\n                internalTexture._cachedWrapR = texture.wrapR;\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(texture.wrapR), internalTexture);\n            }\n            this._setAnisotropicLevel(target, internalTexture, texture.anisotropicFilteringLevel);\n        }\n        return true;\n    }\n    /**\n     * Sets an array of texture to the webGL context\n     * @param channel defines the channel where the texture array must be set\n     * @param uniform defines the associated uniform location\n     * @param textures defines the array of textures to bind\n     * @param name name of the channel\n     */\n    setTextureArray(channel, uniform, textures, name) {\n        if (channel === undefined || !uniform) {\n            return;\n        }\n        if (!this._textureUnits || this._textureUnits.length !== textures.length) {\n            this._textureUnits = new Int32Array(textures.length);\n        }\n        for (let i = 0; i < textures.length; i++) {\n            const texture = textures[i].getInternalTexture();\n            if (texture) {\n                this._textureUnits[i] = channel + i;\n                texture._associatedChannel = channel + i;\n            }\n            else {\n                this._textureUnits[i] = -1;\n            }\n        }\n        this._gl.uniform1iv(uniform, this._textureUnits);\n        for (let index = 0; index < textures.length; index++) {\n            this._setTexture(this._textureUnits[index], textures[index], true);\n        }\n    }\n    /**\n     * @internal\n     */\n    _setAnisotropicLevel(target, internalTexture, anisotropicFilteringLevel) {\n        const anisotropicFilterExtension = this._caps.textureAnisotropicFilterExtension;\n        if (internalTexture.samplingMode !== 11 &&\n            internalTexture.samplingMode !== 3 &&\n            internalTexture.samplingMode !== 2) {\n            anisotropicFilteringLevel = 1; // Forcing the anisotropic to 1 because else webgl will force filters to linear\n        }\n        if (anisotropicFilterExtension && internalTexture._cachedAnisotropicFilteringLevel !== anisotropicFilteringLevel) {\n            this._setTextureParameterFloat(target, anisotropicFilterExtension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(anisotropicFilteringLevel, this._caps.maxAnisotropy), internalTexture);\n            internalTexture._cachedAnisotropicFilteringLevel = anisotropicFilteringLevel;\n        }\n    }\n    _setTextureParameterFloat(target, parameter, value, texture) {\n        this._bindTextureDirectly(target, texture, true, true);\n        this._gl.texParameterf(target, parameter, value);\n    }\n    _setTextureParameterInteger(target, parameter, value, texture) {\n        if (texture) {\n            this._bindTextureDirectly(target, texture, true, true);\n        }\n        this._gl.texParameteri(target, parameter, value);\n    }\n    /**\n     * Unbind all vertex attributes from the webGL context\n     */\n    unbindAllAttributes() {\n        if (this._mustWipeVertexAttributes) {\n            this._mustWipeVertexAttributes = false;\n            for (let i = 0; i < this._caps.maxVertexAttribs; i++) {\n                this.disableAttributeByIndex(i);\n            }\n            return;\n        }\n        for (let i = 0, ul = this._vertexAttribArraysEnabled.length; i < ul; i++) {\n            if (i >= this._caps.maxVertexAttribs || !this._vertexAttribArraysEnabled[i]) {\n                continue;\n            }\n            this.disableAttributeByIndex(i);\n        }\n    }\n    /**\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\n     */\n    releaseEffects() {\n        for (const name in this._compiledEffects) {\n            const webGLPipelineContext = this._compiledEffects[name].getPipelineContext();\n            this._deletePipelineContext(webGLPipelineContext);\n        }\n        this._compiledEffects = {};\n    }\n    /**\n     * Dispose and release all associated resources\n     */\n    dispose() {\n        var _a;\n        this.stopRenderLoop();\n        // Clear observables\n        if (this.onBeforeTextureInitObservable) {\n            this.onBeforeTextureInitObservable.clear();\n        }\n        // Empty texture\n        if (this._emptyTexture) {\n            this._releaseTexture(this._emptyTexture);\n            this._emptyTexture = null;\n        }\n        if (this._emptyCubeTexture) {\n            this._releaseTexture(this._emptyCubeTexture);\n            this._emptyCubeTexture = null;\n        }\n        if (this._dummyFramebuffer) {\n            this._gl.deleteFramebuffer(this._dummyFramebuffer);\n        }\n        // Release effects\n        this.releaseEffects();\n        (_a = this.releaseComputeEffects) === null || _a === void 0 ? void 0 : _a.call(this);\n        // Unbind\n        this.unbindAllAttributes();\n        this._boundUniforms = {};\n        // Events\n        if (IsWindowObjectExist()) {\n            if (this._renderingCanvas) {\n                if (!this._doNotHandleContextLost) {\n                    this._renderingCanvas.removeEventListener(\"webglcontextlost\", this._onContextLost);\n                    this._renderingCanvas.removeEventListener(\"webglcontextrestored\", this._onContextRestored);\n                }\n                window.removeEventListener(\"resize\", this._checkForMobile);\n            }\n        }\n        this._workingCanvas = null;\n        this._workingContext = null;\n        this._currentBufferPointers.length = 0;\n        this._renderingCanvas = null;\n        this._currentProgram = null;\n        this._boundRenderFunction = null;\n        Effect.ResetCache();\n        // Abort active requests\n        for (const request of this._activeRequests) {\n            request.abort();\n        }\n        this.onDisposeObservable.notifyObservers(this);\n        this.onDisposeObservable.clear();\n    }\n    /**\n     * Attach a new callback raised when context lost event is fired\n     * @param callback defines the callback to call\n     */\n    attachContextLostEvent(callback) {\n        if (this._renderingCanvas) {\n            this._renderingCanvas.addEventListener(\"webglcontextlost\", callback, false);\n        }\n    }\n    /**\n     * Attach a new callback raised when context restored event is fired\n     * @param callback defines the callback to call\n     */\n    attachContextRestoredEvent(callback) {\n        if (this._renderingCanvas) {\n            this._renderingCanvas.addEventListener(\"webglcontextrestored\", callback, false);\n        }\n    }\n    /**\n     * Get the current error code of the webGL context\n     * @returns the error code\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/getError\n     */\n    getError() {\n        return this._gl.getError();\n    }\n    _canRenderToFloatFramebuffer() {\n        if (this._webGLVersion > 1) {\n            return this._caps.colorBufferFloat;\n        }\n        return this._canRenderToFramebuffer(1);\n    }\n    _canRenderToHalfFloatFramebuffer() {\n        if (this._webGLVersion > 1) {\n            return this._caps.colorBufferFloat;\n        }\n        return this._canRenderToFramebuffer(2);\n    }\n    // Thank you : http://stackoverflow.com/questions/28827511/webgl-ios-render-to-floating-point-texture\n    _canRenderToFramebuffer(type) {\n        const gl = this._gl;\n        //clear existing errors\n        // eslint-disable-next-line no-empty\n        while (gl.getError() !== gl.NO_ERROR) { }\n        let successful = true;\n        const texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(type), 1, 1, 0, gl.RGBA, this._getWebGLTextureType(type), null);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        const fb = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        successful = successful && status === gl.FRAMEBUFFER_COMPLETE;\n        successful = successful && gl.getError() === gl.NO_ERROR;\n        //try render by clearing frame buffer's color buffer\n        if (successful) {\n            gl.clear(gl.COLOR_BUFFER_BIT);\n            successful = successful && gl.getError() === gl.NO_ERROR;\n        }\n        //try reading from frame to ensure render occurs (just creating the FBO is not sufficient to determine if rendering is supported)\n        if (successful) {\n            //in practice it's sufficient to just read from the backbuffer rather than handle potentially issues reading from the texture\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            const readFormat = gl.RGBA;\n            const readType = gl.UNSIGNED_BYTE;\n            const buffer = new Uint8Array(4);\n            gl.readPixels(0, 0, 1, 1, readFormat, readType, buffer);\n            successful = successful && gl.getError() === gl.NO_ERROR;\n        }\n        //clean up\n        gl.deleteTexture(texture);\n        gl.deleteFramebuffer(fb);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        //clear accumulated errors\n        // eslint-disable-next-line no-empty\n        while (!successful && gl.getError() !== gl.NO_ERROR) { }\n        return successful;\n    }\n    /**\n     * @internal\n     */\n    _getWebGLTextureType(type) {\n        if (this._webGLVersion === 1) {\n            switch (type) {\n                case 1:\n                    return this._gl.FLOAT;\n                case 2:\n                    return this._gl.HALF_FLOAT_OES;\n                case 0:\n                    return this._gl.UNSIGNED_BYTE;\n                case 8:\n                    return this._gl.UNSIGNED_SHORT_4_4_4_4;\n                case 9:\n                    return this._gl.UNSIGNED_SHORT_5_5_5_1;\n                case 10:\n                    return this._gl.UNSIGNED_SHORT_5_6_5;\n            }\n            return this._gl.UNSIGNED_BYTE;\n        }\n        switch (type) {\n            case 3:\n                return this._gl.BYTE;\n            case 0:\n                return this._gl.UNSIGNED_BYTE;\n            case 4:\n                return this._gl.SHORT;\n            case 5:\n                return this._gl.UNSIGNED_SHORT;\n            case 6:\n                return this._gl.INT;\n            case 7: // Refers to UNSIGNED_INT\n                return this._gl.UNSIGNED_INT;\n            case 1:\n                return this._gl.FLOAT;\n            case 2:\n                return this._gl.HALF_FLOAT;\n            case 8:\n                return this._gl.UNSIGNED_SHORT_4_4_4_4;\n            case 9:\n                return this._gl.UNSIGNED_SHORT_5_5_5_1;\n            case 10:\n                return this._gl.UNSIGNED_SHORT_5_6_5;\n            case 11:\n                return this._gl.UNSIGNED_INT_2_10_10_10_REV;\n            case 12:\n                return this._gl.UNSIGNED_INT_24_8;\n            case 13:\n                return this._gl.UNSIGNED_INT_10F_11F_11F_REV;\n            case 14:\n                return this._gl.UNSIGNED_INT_5_9_9_9_REV;\n            case 15:\n                return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV;\n        }\n        return this._gl.UNSIGNED_BYTE;\n    }\n    /**\n     * @internal\n     */\n    _getInternalFormat(format, useSRGBBuffer = false) {\n        let internalFormat = useSRGBBuffer ? this._gl.SRGB8_ALPHA8 : this._gl.RGBA;\n        switch (format) {\n            case 0:\n                internalFormat = this._gl.ALPHA;\n                break;\n            case 1:\n                internalFormat = this._gl.LUMINANCE;\n                break;\n            case 2:\n                internalFormat = this._gl.LUMINANCE_ALPHA;\n                break;\n            case 6:\n                internalFormat = this._gl.RED;\n                break;\n            case 7:\n                internalFormat = this._gl.RG;\n                break;\n            case 4:\n                internalFormat = useSRGBBuffer ? this._gl.SRGB : this._gl.RGB;\n                break;\n            case 5:\n                internalFormat = useSRGBBuffer ? this._gl.SRGB8_ALPHA8 : this._gl.RGBA;\n                break;\n        }\n        if (this._webGLVersion > 1) {\n            switch (format) {\n                case 8:\n                    internalFormat = this._gl.RED_INTEGER;\n                    break;\n                case 9:\n                    internalFormat = this._gl.RG_INTEGER;\n                    break;\n                case 10:\n                    internalFormat = this._gl.RGB_INTEGER;\n                    break;\n                case 11:\n                    internalFormat = this._gl.RGBA_INTEGER;\n                    break;\n            }\n        }\n        return internalFormat;\n    }\n    /**\n     * @internal\n     */\n    _getRGBABufferInternalSizedFormat(type, format, useSRGBBuffer = false) {\n        if (this._webGLVersion === 1) {\n            if (format !== undefined) {\n                switch (format) {\n                    case 0:\n                        return this._gl.ALPHA;\n                    case 1:\n                        return this._gl.LUMINANCE;\n                    case 2:\n                        return this._gl.LUMINANCE_ALPHA;\n                    case 4:\n                        return useSRGBBuffer ? this._gl.SRGB : this._gl.RGB;\n                }\n            }\n            return this._gl.RGBA;\n        }\n        switch (type) {\n            case 3:\n                switch (format) {\n                    case 6:\n                        return this._gl.R8_SNORM;\n                    case 7:\n                        return this._gl.RG8_SNORM;\n                    case 4:\n                        return this._gl.RGB8_SNORM;\n                    case 8:\n                        return this._gl.R8I;\n                    case 9:\n                        return this._gl.RG8I;\n                    case 10:\n                        return this._gl.RGB8I;\n                    case 11:\n                        return this._gl.RGBA8I;\n                    default:\n                        return this._gl.RGBA8_SNORM;\n                }\n            case 0:\n                switch (format) {\n                    case 6:\n                        return this._gl.R8;\n                    case 7:\n                        return this._gl.RG8;\n                    case 4:\n                        return useSRGBBuffer ? this._gl.SRGB8 : this._gl.RGB8; // By default. Other possibilities are RGB565, SRGB8.\n                    case 5:\n                        return useSRGBBuffer ? this._gl.SRGB8_ALPHA8 : this._gl.RGBA8; // By default. Other possibilities are RGB5_A1, RGBA4, SRGB8_ALPHA8.\n                    case 8:\n                        return this._gl.R8UI;\n                    case 9:\n                        return this._gl.RG8UI;\n                    case 10:\n                        return this._gl.RGB8UI;\n                    case 11:\n                        return this._gl.RGBA8UI;\n                    case 0:\n                        return this._gl.ALPHA;\n                    case 1:\n                        return this._gl.LUMINANCE;\n                    case 2:\n                        return this._gl.LUMINANCE_ALPHA;\n                    default:\n                        return this._gl.RGBA8;\n                }\n            case 4:\n                switch (format) {\n                    case 8:\n                        return this._gl.R16I;\n                    case 9:\n                        return this._gl.RG16I;\n                    case 10:\n                        return this._gl.RGB16I;\n                    case 11:\n                        return this._gl.RGBA16I;\n                    default:\n                        return this._gl.RGBA16I;\n                }\n            case 5:\n                switch (format) {\n                    case 8:\n                        return this._gl.R16UI;\n                    case 9:\n                        return this._gl.RG16UI;\n                    case 10:\n                        return this._gl.RGB16UI;\n                    case 11:\n                        return this._gl.RGBA16UI;\n                    default:\n                        return this._gl.RGBA16UI;\n                }\n            case 6:\n                switch (format) {\n                    case 8:\n                        return this._gl.R32I;\n                    case 9:\n                        return this._gl.RG32I;\n                    case 10:\n                        return this._gl.RGB32I;\n                    case 11:\n                        return this._gl.RGBA32I;\n                    default:\n                        return this._gl.RGBA32I;\n                }\n            case 7: // Refers to UNSIGNED_INT\n                switch (format) {\n                    case 8:\n                        return this._gl.R32UI;\n                    case 9:\n                        return this._gl.RG32UI;\n                    case 10:\n                        return this._gl.RGB32UI;\n                    case 11:\n                        return this._gl.RGBA32UI;\n                    default:\n                        return this._gl.RGBA32UI;\n                }\n            case 1:\n                switch (format) {\n                    case 6:\n                        return this._gl.R32F; // By default. Other possibility is R16F.\n                    case 7:\n                        return this._gl.RG32F; // By default. Other possibility is RG16F.\n                    case 4:\n                        return this._gl.RGB32F; // By default. Other possibilities are RGB16F, R11F_G11F_B10F, RGB9_E5.\n                    case 5:\n                        return this._gl.RGBA32F; // By default. Other possibility is RGBA16F.\n                    default:\n                        return this._gl.RGBA32F;\n                }\n            case 2:\n                switch (format) {\n                    case 6:\n                        return this._gl.R16F;\n                    case 7:\n                        return this._gl.RG16F;\n                    case 4:\n                        return this._gl.RGB16F; // By default. Other possibilities are R11F_G11F_B10F, RGB9_E5.\n                    case 5:\n                        return this._gl.RGBA16F;\n                    default:\n                        return this._gl.RGBA16F;\n                }\n            case 10:\n                return this._gl.RGB565;\n            case 13:\n                return this._gl.R11F_G11F_B10F;\n            case 14:\n                return this._gl.RGB9_E5;\n            case 8:\n                return this._gl.RGBA4;\n            case 9:\n                return this._gl.RGB5_A1;\n            case 11:\n                switch (format) {\n                    case 5:\n                        return this._gl.RGB10_A2; // By default. Other possibility is RGB5_A1.\n                    case 11:\n                        return this._gl.RGB10_A2UI;\n                    default:\n                        return this._gl.RGB10_A2;\n                }\n        }\n        return useSRGBBuffer ? this._gl.SRGB8_ALPHA8 : this._gl.RGBA8;\n    }\n    /**\n     * @internal\n     */\n    _getRGBAMultiSampleBufferFormat(type) {\n        if (type === 1) {\n            return this._gl.RGBA32F;\n        }\n        else if (type === 2) {\n            return this._gl.RGBA16F;\n        }\n        return this._gl.RGBA8;\n    }\n    /**\n     * @internal\n     */\n    _loadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError) {\n        const request = ThinEngine._FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\n        this._activeRequests.push(request);\n        request.onCompleteObservable.add((request) => {\n            this._activeRequests.splice(this._activeRequests.indexOf(request), 1);\n        });\n        return request;\n    }\n    /**\n     * Loads a file from a url\n     * @param url url to load\n     * @param onSuccess callback called when the file successfully loads\n     * @param onProgress callback called while file is loading (if the server supports this mode)\n     * @param offlineProvider defines the offline provider for caching\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\n     * @param onError callback called when the file fails to load\n     * @returns a file request object\n     * @internal\n     */\n    static _FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError) {\n        throw _WarnImport(\"FileTools\");\n    }\n    /**\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\n     * @param x defines the x coordinate of the rectangle where pixels must be read\n     * @param y defines the y coordinate of the rectangle where pixels must be read\n     * @param width defines the width of the rectangle where pixels must be read\n     * @param height defines the height of the rectangle where pixels must be read\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\n     */\n    readPixels(x, y, width, height, hasAlpha = true, flushRenderer = true) {\n        const numChannels = hasAlpha ? 4 : 3;\n        const format = hasAlpha ? this._gl.RGBA : this._gl.RGB;\n        const data = new Uint8Array(height * width * numChannels);\n        if (flushRenderer) {\n            this.flushFramebuffer();\n        }\n        this._gl.readPixels(x, y, width, height, format, this._gl.UNSIGNED_BYTE, data);\n        return Promise.resolve(data);\n    }\n    /**\n     * Gets a Promise<boolean> indicating if the engine can be instantiated (ie. if a webGL context can be found)\n     */\n    static get IsSupportedAsync() {\n        return Promise.resolve(this.isSupported());\n    }\n    /**\n     * Gets a boolean indicating if the engine can be instantiated (ie. if a webGL context can be found)\n     */\n    static get IsSupported() {\n        return this.isSupported(); // Backward compat\n    }\n    /**\n     * Gets a boolean indicating if the engine can be instantiated (ie. if a webGL context can be found)\n     * @returns true if the engine can be created\n     * @ignorenaming\n     */\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    static isSupported() {\n        if (this._HasMajorPerformanceCaveat !== null) {\n            return !this._HasMajorPerformanceCaveat; // We know it is performant so WebGL is supported\n        }\n        if (this._IsSupported === null) {\n            try {\n                const tempcanvas = this._CreateCanvas(1, 1);\n                const gl = tempcanvas.getContext(\"webgl\") || tempcanvas.getContext(\"experimental-webgl\");\n                this._IsSupported = gl != null && !!window.WebGLRenderingContext;\n            }\n            catch (e) {\n                this._IsSupported = false;\n            }\n        }\n        return this._IsSupported;\n    }\n    /**\n     * Gets a boolean indicating if the engine can be instantiated on a performant device (ie. if a webGL context can be found and it does not use a slow implementation)\n     */\n    static get HasMajorPerformanceCaveat() {\n        if (this._HasMajorPerformanceCaveat === null) {\n            try {\n                const tempcanvas = this._CreateCanvas(1, 1);\n                const gl = tempcanvas.getContext(\"webgl\", { failIfMajorPerformanceCaveat: true }) ||\n                    tempcanvas.getContext(\"experimental-webgl\", { failIfMajorPerformanceCaveat: true });\n                this._HasMajorPerformanceCaveat = !gl;\n            }\n            catch (e) {\n                this._HasMajorPerformanceCaveat = false;\n            }\n        }\n        return this._HasMajorPerformanceCaveat;\n    }\n    /**\n     * Find the next highest power of two.\n     * @param x Number to start search from.\n     * @returns Next highest power of two.\n     */\n    static CeilingPOT(x) {\n        x--;\n        x |= x >> 1;\n        x |= x >> 2;\n        x |= x >> 4;\n        x |= x >> 8;\n        x |= x >> 16;\n        x++;\n        return x;\n    }\n    /**\n     * Find the next lowest power of two.\n     * @param x Number to start search from.\n     * @returns Next lowest power of two.\n     */\n    static FloorPOT(x) {\n        x = x | (x >> 1);\n        x = x | (x >> 2);\n        x = x | (x >> 4);\n        x = x | (x >> 8);\n        x = x | (x >> 16);\n        return x - (x >> 1);\n    }\n    /**\n     * Find the nearest power of two.\n     * @param x Number to start search from.\n     * @returns Next nearest power of two.\n     */\n    static NearestPOT(x) {\n        const c = ThinEngine.CeilingPOT(x);\n        const f = ThinEngine.FloorPOT(x);\n        return c - x > x - f ? f : c;\n    }\n    /**\n     * Get the closest exponent of two\n     * @param value defines the value to approximate\n     * @param max defines the maximum value to return\n     * @param mode defines how to define the closest value\n     * @returns closest exponent of two of the given value\n     */\n    static GetExponentOfTwo(value, max, mode = 2) {\n        let pot;\n        switch (mode) {\n            case 1:\n                pot = ThinEngine.FloorPOT(value);\n                break;\n            case 2:\n                pot = ThinEngine.NearestPOT(value);\n                break;\n            case 3:\n            default:\n                pot = ThinEngine.CeilingPOT(value);\n                break;\n        }\n        return Math.min(pot, max);\n    }\n    /**\n     * Queue a new function into the requested animation frame pool (ie. this function will be executed by the browser (or the javascript engine) for the next frame)\n     * @param func - the function to be called\n     * @param requester - the object that will request the next frame. Falls back to window.\n     * @returns frame number\n     */\n    static QueueNewFrame(func, requester) {\n        // Note that there is kind of a typing issue here, as `setTimeout` might return something else than a number (NodeJs returns a NodeJS.Timeout object).\n        // Also if the global `requestAnimationFrame`'s returnType is number, `requester.requestPostAnimationFrame` and `requester.requestAnimationFrame` types\n        // are `any`.\n        if (!IsWindowObjectExist()) {\n            if (typeof requestAnimationFrame === \"function\") {\n                return requestAnimationFrame(func);\n            }\n        }\n        else {\n            const { requestPostAnimationFrame, requestAnimationFrame } = requester || window;\n            if (typeof requestPostAnimationFrame === \"function\") {\n                return requestPostAnimationFrame(func);\n            }\n            if (typeof requestAnimationFrame === \"function\") {\n                return requestAnimationFrame(func);\n            }\n        }\n        // fallback to the global `setTimeout`.\n        // In most cases (aka in the browser), `window` is the global object, so instead of calling `window.setTimeout` we could call the global `setTimeout`.\n        return setTimeout(func, 16);\n    }\n    /**\n     * Gets host document\n     * @returns the host document object\n     */\n    getHostDocument() {\n        if (this._renderingCanvas && this._renderingCanvas.ownerDocument) {\n            return this._renderingCanvas.ownerDocument;\n        }\n        return IsDocumentAvailable() ? document : null;\n    }\n}\n/** Use this array to turn off some WebGL2 features on known buggy browsers version */\nThinEngine.ExceptionList = [\n    { key: \"Chrome/63.0\", capture: \"63\\\\.0\\\\.3239\\\\.(\\\\d+)\", captureConstraint: 108, targets: [\"uniformBuffer\"] },\n    { key: \"Firefox/58\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\n    { key: \"Firefox/59\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\n    { key: \"Chrome/72.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\n    { key: \"Chrome/73.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\n    { key: \"Chrome/74.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\n    { key: \"Mac OS.+Chrome/71\", capture: null, captureConstraint: null, targets: [\"vao\"] },\n    { key: \"Mac OS.+Chrome/72\", capture: null, captureConstraint: null, targets: [\"vao\"] },\n    { key: \"Mac OS.+Chrome\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\n    // desktop osx safari 15.4\n    { key: \".*AppleWebKit.*(15.4).*Safari\", capture: null, captureConstraint: null, targets: [\"antialias\", \"maxMSAASamples\"] },\n    // mobile browsers using safari 15.4 on ios\n    { key: \".*(15.4).*AppleWebKit.*Safari\", capture: null, captureConstraint: null, targets: [\"antialias\", \"maxMSAASamples\"] },\n];\n/** @internal */\nThinEngine._TextureLoaders = [];\n// Updatable statics so stick with vars here\n/**\n * Gets or sets the epsilon value used by collision engine\n */\nThinEngine.CollisionsEpsilon = 0.001;\n// Statics\nThinEngine._IsSupported = null;\nThinEngine._HasMajorPerformanceCaveat = null;\n//# sourceMappingURL=thinEngine.js.map","import { Logger } from \"../Misc/logger.js\";\nimport { IsWindowObjectExist } from \"../Misc/domManagement.js\";\nimport { Color4 } from \"../Maths/math.js\";\nimport { Engine } from \"../Engines/engine.js\";\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture.js\";\nimport { Effect } from \"../Materials/effect.js\";\n\nimport * as WebGPUConstants from \"./WebGPU/webgpuConstants.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { WebGPUPipelineContext } from \"./WebGPU/webgpuPipelineContext.js\";\nimport { WebGPUShaderProcessorGLSL } from \"./WebGPU/webgpuShaderProcessorsGLSL.js\";\nimport { WebGPUShaderProcessorWGSL } from \"./WebGPU/webgpuShaderProcessorsWGSL.js\";\nimport { WebGPUShaderProcessingContext } from \"./WebGPU/webgpuShaderProcessingContext.js\";\nimport { Tools } from \"../Misc/tools.js\";\nimport { WebGPUTextureHelper } from \"./WebGPU/webgpuTextureHelper.js\";\nimport { WebGPUBufferManager } from \"./WebGPU/webgpuBufferManager.js\";\nimport { WebGPUHardwareTexture } from \"./WebGPU/webgpuHardwareTexture.js\";\nimport { UniformBuffer } from \"../Materials/uniformBuffer.js\";\nimport { WebGPURenderPassWrapper } from \"./WebGPU/webgpuRenderPassWrapper.js\";\nimport { WebGPUCacheSampler } from \"./WebGPU/webgpuCacheSampler.js\";\nimport { WebGPUCacheRenderPipelineTree } from \"./WebGPU/webgpuCacheRenderPipelineTree.js\";\nimport { WebGPUStencilStateComposer } from \"./WebGPU/webgpuStencilStateComposer.js\";\nimport { WebGPUDepthCullingState } from \"./WebGPU/webgpuDepthCullingState.js\";\nimport { DrawWrapper } from \"../Materials/drawWrapper.js\";\nimport { WebGPUMaterialContext } from \"./WebGPU/webgpuMaterialContext.js\";\nimport { WebGPUDrawContext } from \"./WebGPU/webgpuDrawContext.js\";\nimport { WebGPUCacheBindGroups } from \"./WebGPU/webgpuCacheBindGroups.js\";\nimport { WebGPUClearQuad } from \"./WebGPU/webgpuClearQuad.js\";\nimport { WebGPURenderItemBlendColor, WebGPURenderItemScissor, WebGPURenderItemStencilRef, WebGPURenderItemViewport, WebGPUBundleList } from \"./WebGPU/webgpuBundleList.js\";\nimport { WebGPUTimestampQuery } from \"./WebGPU/webgpuTimestampQuery.js\";\nimport { WebGPUOcclusionQuery } from \"./WebGPU/webgpuOcclusionQuery.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { ShaderCodeInliner } from \"./Processors/shaderCodeInliner.js\";\nimport { WebGPUTintWASM } from \"./WebGPU/webgpuTintWASM.js\";\nimport { WebGPUShaderProcessor } from \"./WebGPU/webgpuShaderProcessor.js\";\nimport { ShaderLanguage } from \"../Materials/shaderLanguage.js\";\nimport { WebGPUSnapshotRendering } from \"./WebGPU/webgpuSnapshotRendering.js\";\n/**\n * The web GPU engine class provides support for WebGPU version of babylon.js.\n * @since 5.0.0\n */\nexport class WebGPUEngine extends Engine {\n    /**\n     * Gets or sets the snapshot rendering mode\n     */\n    get snapshotRenderingMode() {\n        return this._snapshotRendering.mode;\n    }\n    set snapshotRenderingMode(mode) {\n        this._snapshotRendering.mode = mode;\n    }\n    /**\n     * Creates a new snapshot at the next frame using the current snapshotRenderingMode\n     */\n    snapshotRenderingReset() {\n        this._snapshotRendering.reset();\n    }\n    /**\n     * Enables or disables the snapshot rendering mode\n     * Note that the WebGL engine does not support snapshot rendering so setting the value won't have any effect for this engine\n     */\n    get snapshotRendering() {\n        return this._snapshotRendering.enabled;\n    }\n    set snapshotRendering(activate) {\n        this._snapshotRendering.enabled = activate;\n    }\n    /**\n     * Sets this to true to disable the cache for the samplers. You should do it only for testing purpose!\n     */\n    get disableCacheSamplers() {\n        return this._cacheSampler ? this._cacheSampler.disabled : false;\n    }\n    set disableCacheSamplers(disable) {\n        if (this._cacheSampler) {\n            this._cacheSampler.disabled = disable;\n        }\n    }\n    /**\n     * Sets this to true to disable the cache for the render pipelines. You should do it only for testing purpose!\n     */\n    get disableCacheRenderPipelines() {\n        return this._cacheRenderPipeline ? this._cacheRenderPipeline.disabled : false;\n    }\n    set disableCacheRenderPipelines(disable) {\n        if (this._cacheRenderPipeline) {\n            this._cacheRenderPipeline.disabled = disable;\n        }\n    }\n    /**\n     * Sets this to true to disable the cache for the bind groups. You should do it only for testing purpose!\n     */\n    get disableCacheBindGroups() {\n        return this._cacheBindGroups ? this._cacheBindGroups.disabled : false;\n    }\n    set disableCacheBindGroups(disable) {\n        if (this._cacheBindGroups) {\n            this._cacheBindGroups.disabled = disable;\n        }\n    }\n    /**\n     * Gets a Promise<boolean> indicating if the engine can be instantiated (ie. if a WebGPU context can be found)\n     */\n    static get IsSupportedAsync() {\n        return !navigator.gpu\n            ? Promise.resolve(false)\n            : navigator.gpu\n                .requestAdapter()\n                .then((adapter) => !!adapter, () => false)\n                .catch(() => false);\n    }\n    /**\n     * Not supported by WebGPU, you should call IsSupportedAsync instead!\n     */\n    static get IsSupported() {\n        Logger.Warn(\"You must call IsSupportedAsync for WebGPU!\");\n        return false;\n    }\n    /**\n     * Gets a boolean indicating that the engine supports uniform buffers\n     */\n    get supportsUniformBuffers() {\n        return true;\n    }\n    /** Gets the supported extensions by the WebGPU adapter */\n    get supportedExtensions() {\n        return this._adapterSupportedExtensions;\n    }\n    /** Gets the currently enabled extensions on the WebGPU device */\n    get enabledExtensions() {\n        return this._deviceEnabledExtensions;\n    }\n    /**\n     * Returns a string describing the current engine\n     */\n    get description() {\n        const description = this.name + this.version;\n        return description;\n    }\n    /**\n     * Returns the version of the engine\n     */\n    get version() {\n        return 1;\n    }\n    /**\n     * Gets an object containing information about the current engine context\n     * @returns an object containing the vendor, the renderer and the version of the current engine context\n     */\n    getInfo() {\n        return {\n            vendor: \"unknown vendor\",\n            renderer: \"unknown renderer\",\n            version: \"unknown version\",\n        };\n    }\n    /**\n     * (WebGPU only) True (default) to be in compatibility mode, meaning rendering all existing scenes without artifacts (same rendering than WebGL).\n     * Setting the property to false will improve performances but may not work in some scenes if some precautions are not taken.\n     * See https://doc.babylonjs.com/setup/support/webGPU/webGPUOptimization/webGPUNonCompatibilityMode for more details\n     */\n    get compatibilityMode() {\n        return this._compatibilityMode;\n    }\n    set compatibilityMode(mode) {\n        this._compatibilityMode = mode;\n    }\n    /** @internal */\n    get currentSampleCount() {\n        return this._currentRenderTarget ? this._currentRenderTarget.samples : this._mainPassSampleCount;\n    }\n    /**\n     * Create a new instance of the gpu engine asynchronously\n     * @param canvas Defines the canvas to use to display the result\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\n     * @returns a promise that resolves with the created engine\n     */\n    static CreateAsync(canvas, options = {}) {\n        const engine = new WebGPUEngine(canvas, options);\n        return new Promise((resolve) => {\n            engine.initAsync(options.glslangOptions, options.twgslOptions).then(() => resolve(engine));\n        });\n    }\n    /**\n     * Create a new instance of the gpu engine.\n     * @param canvas Defines the canvas to use to display the result\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\n     */\n    constructor(canvas, options = {}) {\n        var _a, _b;\n        super(null, (_a = options.antialias) !== null && _a !== void 0 ? _a : true, options);\n        // Page Life cycle and constants\n        this._uploadEncoderDescriptor = { label: \"upload\" };\n        this._renderEncoderDescriptor = { label: \"render\" };\n        this._renderTargetEncoderDescriptor = { label: \"renderTarget\" };\n        /** @internal */\n        this._clearDepthValue = 1;\n        /** @internal */\n        this._clearReverseDepthValue = 0;\n        /** @internal */\n        this._clearStencilValue = 0;\n        this._defaultSampleCount = 4; // Only supported value for now.\n        this._glslang = null;\n        this._tintWASM = null;\n        /** @internal */\n        this._compiledComputeEffects = {};\n        /** @internal */\n        this._counters = {\n            numEnableEffects: 0,\n            numEnableDrawWrapper: 0,\n            numBundleCreationNonCompatMode: 0,\n            numBundleReuseNonCompatMode: 0,\n        };\n        /**\n         * Counters from last frame\n         */\n        this.countersLastFrame = {\n            numEnableEffects: 0,\n            numEnableDrawWrapper: 0,\n            numBundleCreationNonCompatMode: 0,\n            numBundleReuseNonCompatMode: 0,\n        };\n        /**\n         * Max number of uncaptured error messages to log\n         */\n        this.numMaxUncapturedErrors = 20;\n        this._commandBuffers = [null, null, null];\n        // Frame Buffer Life Cycle (recreated for each render target pass)\n        /** @internal */\n        this._currentRenderPass = null;\n        /** @internal */\n        this._mainRenderPassWrapper = new WebGPURenderPassWrapper();\n        /** @internal */\n        this._rttRenderPassWrapper = new WebGPURenderPassWrapper();\n        /** @internal */\n        this._pendingDebugCommands = [];\n        /** @internal */\n        this._onAfterUnbindFrameBufferObservable = new Observable();\n        this._currentOverrideVertexBuffers = null;\n        this._currentIndexBuffer = null;\n        this._colorWriteLocal = true;\n        this._forceEnableEffect = false;\n        // TODO WEBGPU remove those variables when code stabilized\n        /** @internal */\n        this.dbgShowShaderCode = false;\n        /** @internal */\n        this.dbgSanityChecks = true;\n        /** @internal */\n        this.dbgVerboseLogsForFirstFrames = false;\n        /** @internal */\n        this.dbgVerboseLogsNumFrames = 10;\n        /** @internal */\n        this.dbgLogIfNotDrawWrapper = true;\n        /** @internal */\n        this.dbgShowEmptyEnableEffectCalls = true;\n        /**\n         * Indicates if the z range in NDC space is 0..1 (value: true) or -1..1 (value: false)\n         */\n        this.isNDCHalfZRange = true;\n        /**\n         * Indicates that the origin of the texture/framebuffer space is the bottom left corner. If false, the origin is top left\n         */\n        this.hasOriginBottomLeft = false;\n        //------------------------------------------------------------------------------\n        //                              Dynamic WebGPU States\n        //------------------------------------------------------------------------------\n        // index 0 is for main render pass, 1 for RTT render pass\n        this._viewportsCurrent = [\n            { x: 0, y: 0, w: 0, h: 0 },\n            { x: 0, y: 0, w: 0, h: 0 },\n        ];\n        this._scissorsCurrent = [\n            { x: 0, y: 0, w: 0, h: 0 },\n            { x: 0, y: 0, w: 0, h: 0 },\n        ];\n        this._scissorCached = { x: 0, y: 0, z: 0, w: 0 };\n        this._stencilRefsCurrent = [-1, -1];\n        this._blendColorsCurrent = [\n            [null, null, null, null],\n            [null, null, null, null],\n        ];\n        this._name = \"WebGPU\";\n        options.deviceDescriptor = options.deviceDescriptor || {};\n        options.enableGPUDebugMarkers = (_b = options.enableGPUDebugMarkers) !== null && _b !== void 0 ? _b : false;\n        Logger.Log(`Babylon.js v${Engine.Version} - ${this.description} engine`);\n        if (!navigator.gpu) {\n            Logger.Error(\"WebGPU is not supported by your browser.\");\n            return;\n        }\n        options.swapChainFormat = options.swapChainFormat || navigator.gpu.getPreferredCanvasFormat();\n        this._isWebGPU = true;\n        this._shaderPlatformName = \"WEBGPU\";\n        this._canvas = canvas;\n        this._options = options;\n        this._mainPassSampleCount = options.antialias ? this._defaultSampleCount : 1;\n        this._setupMobileChecks();\n        this._sharedInit(canvas);\n        this._shaderProcessor = new WebGPUShaderProcessorGLSL();\n        this._shaderProcessorWGSL = new WebGPUShaderProcessorWGSL();\n    }\n    //------------------------------------------------------------------------------\n    //                              Initialization\n    //------------------------------------------------------------------------------\n    /**\n     * Initializes the WebGPU context and dependencies.\n     * @param glslangOptions Defines the GLSLang compiler options if necessary\n     * @param twgslOptions Defines the Twgsl compiler options if necessary\n     * @returns a promise notifying the readiness of the engine.\n     */\n    initAsync(glslangOptions, twgslOptions) {\n        var _a;\n        return this._initGlslang(glslangOptions !== null && glslangOptions !== void 0 ? glslangOptions : (_a = this._options) === null || _a === void 0 ? void 0 : _a.glslangOptions)\n            .then((glslang) => {\n            var _a;\n            this._glslang = glslang;\n            this._tintWASM = WebGPUEngine.UseTWGSL ? new WebGPUTintWASM() : null;\n            return this._tintWASM\n                ? this._tintWASM.initTwgsl(twgslOptions !== null && twgslOptions !== void 0 ? twgslOptions : (_a = this._options) === null || _a === void 0 ? void 0 : _a.twgslOptions).then(() => {\n                    return navigator.gpu.requestAdapter(this._options);\n                }, (msg) => {\n                    Logger.Error(\"Can not initialize twgsl!\");\n                    Logger.Error(msg);\n                    throw Error(\"WebGPU initializations stopped.\");\n                })\n                : navigator.gpu.requestAdapter(this._options);\n        }, (msg) => {\n            Logger.Error(\"Can not initialize glslang!\");\n            Logger.Error(msg);\n            throw Error(\"WebGPU initializations stopped.\");\n        })\n            .then((adapter) => {\n            var _a;\n            if (!adapter) {\n                throw \"Could not retrieve a WebGPU adapter (adapter is null).\";\n            }\n            else {\n                this._adapter = adapter;\n                this._adapterSupportedExtensions = [];\n                (_a = this._adapter.features) === null || _a === void 0 ? void 0 : _a.forEach((feature) => this._adapterSupportedExtensions.push(feature));\n                const deviceDescriptor = this._options.deviceDescriptor;\n                if (deviceDescriptor === null || deviceDescriptor === void 0 ? void 0 : deviceDescriptor.requiredFeatures) {\n                    const requestedExtensions = deviceDescriptor.requiredFeatures;\n                    const validExtensions = [];\n                    for (const extension of requestedExtensions) {\n                        if (this._adapterSupportedExtensions.indexOf(extension) !== -1) {\n                            validExtensions.push(extension);\n                        }\n                    }\n                    deviceDescriptor.requiredFeatures = validExtensions;\n                }\n                return this._adapter.requestDevice(this._options.deviceDescriptor);\n            }\n        })\n            .then((device) => {\n            var _a, _b;\n            this._device = device;\n            this._deviceEnabledExtensions = [];\n            (_a = this._device.features) === null || _a === void 0 ? void 0 : _a.forEach((feature) => this._deviceEnabledExtensions.push(feature));\n            let numUncapturedErrors = -1;\n            this._device.addEventListener(\"uncapturederror\", (event) => {\n                if (++numUncapturedErrors < this.numMaxUncapturedErrors) {\n                    Logger.Warn(`WebGPU uncaptured error (${numUncapturedErrors + 1}): ${event.error} - ${event.error.message}`);\n                }\n                else if (numUncapturedErrors++ === this.numMaxUncapturedErrors) {\n                    Logger.Warn(`WebGPU uncaptured error: too many warnings (${this.numMaxUncapturedErrors}), no more warnings will be reported to the console for this engine.`);\n                }\n            });\n            if (!this._doNotHandleContextLost) {\n                (_b = this._device.lost) === null || _b === void 0 ? void 0 : _b.then((info) => {\n                    this._contextWasLost = true;\n                    Logger.Warn(\"WebGPU context lost. \" + info);\n                    this.onContextLostObservable.notifyObservers(this);\n                    this._restoreEngineAfterContextLost(this.initAsync.bind(this));\n                });\n            }\n        }, (e) => {\n            Logger.Error(\"Could not retrieve a WebGPU device.\");\n            Logger.Error(e);\n        })\n            .then(() => {\n            this._bufferManager = new WebGPUBufferManager(this._device);\n            this._textureHelper = new WebGPUTextureHelper(this._device, this._glslang, this._tintWASM, this._bufferManager);\n            this._cacheSampler = new WebGPUCacheSampler(this._device);\n            this._cacheBindGroups = new WebGPUCacheBindGroups(this._device, this._cacheSampler, this);\n            this._timestampQuery = new WebGPUTimestampQuery(this._device, this._bufferManager);\n            this._occlusionQuery = this._device.createQuerySet ? new WebGPUOcclusionQuery(this, this._device, this._bufferManager) : undefined;\n            this._bundleList = new WebGPUBundleList(this._device);\n            this._bundleListRenderTarget = new WebGPUBundleList(this._device);\n            this._snapshotRendering = new WebGPUSnapshotRendering(this, this._snapshotRenderingMode, this._bundleList, this._bundleListRenderTarget);\n            this._ubInvertY = this._bufferManager.createBuffer(new Float32Array([-1, 0]), WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst);\n            this._ubDontInvertY = this._bufferManager.createBuffer(new Float32Array([1, 0]), WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst);\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                    console.log(\"%c frame #\" + this._count + \" - begin\", \"background: #ffff00\");\n                }\n            }\n            this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\n            this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\n            this._renderTargetEncoder = this._device.createCommandEncoder(this._renderTargetEncoderDescriptor);\n            this._emptyVertexBuffer = new VertexBuffer(this, [0], \"\", false, false, 1, false, 0, 1);\n            this._initializeLimits();\n            this._cacheRenderPipeline = new WebGPUCacheRenderPipelineTree(this._device, this._emptyVertexBuffer, !this._caps.textureFloatLinearFiltering);\n            this._depthCullingState = new WebGPUDepthCullingState(this._cacheRenderPipeline);\n            this._stencilStateComposer = new WebGPUStencilStateComposer(this._cacheRenderPipeline);\n            this._stencilStateComposer.stencilGlobal = this._stencilState;\n            this._depthCullingState.depthTest = true;\n            this._depthCullingState.depthFunc = 515;\n            this._depthCullingState.depthMask = true;\n            this._textureHelper.setCommandEncoder(this._uploadEncoder);\n            this._clearQuad = new WebGPUClearQuad(this._device, this, this._emptyVertexBuffer);\n            this._defaultDrawContext = this.createDrawContext();\n            this._currentDrawContext = this._defaultDrawContext;\n            this._defaultMaterialContext = this.createMaterialContext();\n            this._currentMaterialContext = this._defaultMaterialContext;\n            this._initializeContextAndSwapChain();\n            this._initializeMainAttachments();\n            this.resize();\n        })\n            .catch((e) => {\n            Logger.Error(\"Can not create WebGPU Device and/or context.\");\n            Logger.Error(e);\n            if (console.trace) {\n                console.trace();\n            }\n        });\n    }\n    _initGlslang(glslangOptions) {\n        glslangOptions = glslangOptions || {};\n        glslangOptions = {\n            ...WebGPUEngine._GLSLslangDefaultOptions,\n            ...glslangOptions,\n        };\n        if (glslangOptions.glslang) {\n            return Promise.resolve(glslangOptions.glslang);\n        }\n        if (self.glslang) {\n            return self.glslang(glslangOptions.wasmPath);\n        }\n        if (glslangOptions.jsPath && glslangOptions.wasmPath) {\n            if (IsWindowObjectExist()) {\n                return Tools.LoadScriptAsync(glslangOptions.jsPath).then(() => {\n                    return self.glslang(glslangOptions.wasmPath);\n                });\n            }\n            else {\n                importScripts(glslangOptions.jsPath);\n                return self.glslang(glslangOptions.wasmPath);\n            }\n        }\n        return Promise.reject(\"gslang is not available.\");\n    }\n    _initializeLimits() {\n        // Init caps\n        // TODO WEBGPU Real Capability check once limits will be working.\n        this._caps = {\n            maxTexturesImageUnits: 16,\n            maxVertexTextureImageUnits: 16,\n            maxCombinedTexturesImageUnits: 32,\n            maxTextureSize: 8192,\n            maxCubemapTextureSize: 2048,\n            maxRenderTextureSize: 8192,\n            maxVertexAttribs: 16,\n            maxVaryingVectors: 15,\n            maxFragmentUniformVectors: 1024,\n            maxVertexUniformVectors: 1024,\n            standardDerivatives: true,\n            astc: (this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionASTC) >= 0 ? true : undefined),\n            s3tc: (this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionBC) >= 0 ? true : undefined),\n            pvrtc: null,\n            etc1: null,\n            etc2: (this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionETC2) >= 0 ? true : undefined),\n            bptc: this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionBC) >= 0 ? true : undefined,\n            maxAnisotropy: 4,\n            uintIndices: true,\n            fragmentDepthSupported: true,\n            highPrecisionShaderSupported: true,\n            colorBufferFloat: true,\n            textureFloat: true,\n            textureFloatLinearFiltering: false,\n            textureFloatRender: true,\n            textureHalfFloat: true,\n            textureHalfFloatLinearFiltering: true,\n            textureHalfFloatRender: true,\n            textureLOD: true,\n            drawBuffersExtension: true,\n            depthTextureExtension: true,\n            vertexArrayObject: false,\n            instancedArrays: true,\n            timerQuery: typeof BigUint64Array !== \"undefined\" && this.enabledExtensions.indexOf(WebGPUConstants.FeatureName.TimestampQuery) !== -1 ? true : undefined,\n            supportOcclusionQuery: typeof BigUint64Array !== \"undefined\",\n            canUseTimestampForTimerQuery: true,\n            multiview: false,\n            oculusMultiview: false,\n            parallelShaderCompile: undefined,\n            blendMinMax: true,\n            maxMSAASamples: 4,\n            canUseGLInstanceID: true,\n            canUseGLVertexID: true,\n            supportComputeShaders: true,\n            supportSRGBBuffers: true,\n            supportTransformFeedbacks: false,\n            textureMaxLevel: true,\n            texture2DArrayMaxLayerCount: 2048,\n        };\n        this._caps.parallelShaderCompile = null;\n        this._features = {\n            forceBitmapOverHTMLImageElement: true,\n            supportRenderAndCopyToLodForFloatTextures: true,\n            supportDepthStencilTexture: true,\n            supportShadowSamplers: true,\n            uniformBufferHardCheckMatrix: false,\n            allowTexturePrefiltering: true,\n            trackUbosInFrame: true,\n            checkUbosContentBeforeUpload: true,\n            supportCSM: true,\n            basisNeedsPOT: false,\n            support3DTextures: true,\n            needTypeSuffixInShaderConstants: true,\n            supportMSAA: true,\n            supportSSAO2: true,\n            supportExtendedTextureFormats: true,\n            supportSwitchCaseInShader: true,\n            supportSyncTextureRead: false,\n            needsInvertingBitmap: false,\n            useUBOBindingCache: false,\n            needShaderCodeInlining: true,\n            needToAlwaysBindUniformBuffers: true,\n            supportRenderPasses: true,\n            supportSpriteInstancing: true,\n            _collectUbosUpdatedInFrame: false,\n        };\n    }\n    _initializeContextAndSwapChain() {\n        this._context = this._canvas.getContext(\"webgpu\");\n        this._configureContext();\n        this._colorFormat = this._options.swapChainFormat;\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures = [new WebGPUHardwareTexture()];\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format = this._colorFormat;\n    }\n    // Set default values as WebGL with depth and stencil attachment for the broadest Compat.\n    _initializeMainAttachments() {\n        if (!this._bufferManager) {\n            return;\n        }\n        this.flushFramebuffer(false);\n        this._mainTextureExtends = {\n            width: this.getRenderWidth(),\n            height: this.getRenderHeight(),\n            depthOrArrayLayers: 1,\n        };\n        const bufferDataUpdate = new Float32Array([this.getRenderHeight()]);\n        this._bufferManager.setSubData(this._ubInvertY, 4, bufferDataUpdate);\n        this._bufferManager.setSubData(this._ubDontInvertY, 4, bufferDataUpdate);\n        let mainColorAttachments;\n        if (this._options.antialias) {\n            const mainTextureDescriptor = {\n                label: \"Texture_MainColor_antialiasing\",\n                size: this._mainTextureExtends,\n                mipLevelCount: 1,\n                sampleCount: this._mainPassSampleCount,\n                dimension: WebGPUConstants.TextureDimension.E2d,\n                format: this._options.swapChainFormat,\n                usage: WebGPUConstants.TextureUsage.RenderAttachment,\n            };\n            if (this._mainTexture) {\n                this._textureHelper.releaseTexture(this._mainTexture);\n            }\n            this._mainTexture = this._device.createTexture(mainTextureDescriptor);\n            mainColorAttachments = [\n                {\n                    view: this._mainTexture.createView(),\n                    clearValue: new Color4(0, 0, 0, 1),\n                    loadOp: WebGPUConstants.LoadOp.Clear,\n                    storeOp: WebGPUConstants.StoreOp.Store, // don't use StoreOp.Discard, else using several cameras with different viewports or using scissors will fail because we call beginRenderPass / endPass several times for the same color attachment!\n                },\n            ];\n        }\n        else {\n            mainColorAttachments = [\n                {\n                    view: undefined,\n                    clearValue: new Color4(0, 0, 0, 1),\n                    loadOp: WebGPUConstants.LoadOp.Clear,\n                    storeOp: WebGPUConstants.StoreOp.Store,\n                },\n            ];\n        }\n        this._mainRenderPassWrapper.depthTextureFormat = this.isStencilEnable ? WebGPUConstants.TextureFormat.Depth24PlusStencil8 : WebGPUConstants.TextureFormat.Depth32Float;\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\n        const depthTextureDescriptor = {\n            label: \"Texture_MainDepthStencil\",\n            size: this._mainTextureExtends,\n            mipLevelCount: 1,\n            sampleCount: this._mainPassSampleCount,\n            dimension: WebGPUConstants.TextureDimension.E2d,\n            format: this._mainRenderPassWrapper.depthTextureFormat,\n            usage: WebGPUConstants.TextureUsage.RenderAttachment,\n        };\n        if (this._depthTexture) {\n            this._textureHelper.releaseTexture(this._depthTexture);\n        }\n        this._depthTexture = this._device.createTexture(depthTextureDescriptor);\n        const mainDepthAttachment = {\n            view: this._depthTexture.createView(),\n            depthClearValue: this._clearDepthValue,\n            depthLoadOp: WebGPUConstants.LoadOp.Clear,\n            depthStoreOp: WebGPUConstants.StoreOp.Store,\n            stencilClearValue: this._clearStencilValue,\n            stencilLoadOp: !this.isStencilEnable ? undefined : WebGPUConstants.LoadOp.Clear,\n            stencilStoreOp: !this.isStencilEnable ? undefined : WebGPUConstants.StoreOp.Store,\n        };\n        this._mainRenderPassWrapper.renderPassDescriptor = {\n            colorAttachments: mainColorAttachments,\n            depthStencilAttachment: mainDepthAttachment,\n        };\n    }\n    _configureContext() {\n        this._context.configure({\n            device: this._device,\n            format: this._options.swapChainFormat,\n            usage: WebGPUConstants.TextureUsage.RenderAttachment | WebGPUConstants.TextureUsage.CopySrc,\n            alphaMode: this.premultipliedAlpha ? WebGPUConstants.CanvasAlphaMode.Premultiplied : WebGPUConstants.CanvasAlphaMode.Opaque,\n        });\n    }\n    /**\n     * Force a specific size of the canvas\n     * @param width defines the new canvas' width\n     * @param height defines the new canvas' height\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\n     * @returns true if the size was changed\n     */\n    setSize(width, height, forceSetSize = false) {\n        if (!super.setSize(width, height, forceSetSize)) {\n            return false;\n        }\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - setSize called -\", width, height);\n            }\n        }\n        this._initializeMainAttachments();\n        if (this.snapshotRendering) {\n            // reset snapshot rendering so that the next frame will record a new list of bundles\n            this.snapshotRenderingReset();\n        }\n        return true;\n    }\n    /**\n     * @internal\n     */\n    _getShaderProcessor(shaderLanguage) {\n        if (shaderLanguage === ShaderLanguage.WGSL) {\n            return this._shaderProcessorWGSL;\n        }\n        return this._shaderProcessor;\n    }\n    /**\n     * @internal\n     */\n    _getShaderProcessingContext(shaderLanguage) {\n        return new WebGPUShaderProcessingContext(shaderLanguage);\n    }\n    //------------------------------------------------------------------------------\n    //                          Static Pipeline WebGPU States\n    //------------------------------------------------------------------------------\n    /** @internal */\n    applyStates() {\n        this._stencilStateComposer.apply();\n        this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend);\n    }\n    /**\n     * Force the entire cache to be cleared\n     * You should not have to use this function unless your engine needs to share the WebGPU context with another engine\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\n     */\n    wipeCaches(bruteForce) {\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\n            return;\n        }\n        //this._currentEffect = null; // can't reset _currentEffect, else some crashes can occur (for eg in ProceduralTexture which calls bindFrameBuffer (which calls wipeCaches) after having called enableEffect and before drawing into the texture)\n        // _forceEnableEffect = true assumes the role of _currentEffect = null\n        this._forceEnableEffect = true;\n        this._currentIndexBuffer = null;\n        this._currentOverrideVertexBuffers = null;\n        this._cacheRenderPipeline.setBuffers(null, null, null);\n        if (bruteForce) {\n            this._stencilStateComposer.reset();\n            this._depthCullingState.reset();\n            this._depthCullingState.depthFunc = 515;\n            this._alphaState.reset();\n            this._alphaMode = 1;\n            this._alphaEquation = 0;\n            this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters, this._alphaState._blendEquationParameters);\n            this._cacheRenderPipeline.setAlphaBlendEnabled(false);\n            this.setColorWrite(true);\n        }\n        this._cachedVertexBuffers = null;\n        this._cachedIndexBuffer = null;\n        this._cachedEffectForVertexBuffers = null;\n    }\n    /**\n     * Enable or disable color writing\n     * @param enable defines the state to set\n     */\n    setColorWrite(enable) {\n        this._colorWriteLocal = enable;\n        this._cacheRenderPipeline.setWriteMask(enable ? 0xf : 0);\n    }\n    /**\n     * Gets a boolean indicating if color writing is enabled\n     * @returns the current color writing state\n     */\n    getColorWrite() {\n        return this._colorWriteLocal;\n    }\n    _resetCurrentViewport(index) {\n        this._viewportsCurrent[index].x = 0;\n        this._viewportsCurrent[index].y = 0;\n        this._viewportsCurrent[index].w = 0;\n        this._viewportsCurrent[index].h = 0;\n        if (index === 1) {\n            this._viewportCached.x = 0;\n            this._viewportCached.y = 0;\n            this._viewportCached.z = 0;\n            this._viewportCached.w = 0;\n        }\n    }\n    _mustUpdateViewport(renderPass) {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n        const x = this._viewportCached.x, y = this._viewportCached.y, w = this._viewportCached.z, h = this._viewportCached.w;\n        const update = this._viewportsCurrent[index].x !== x || this._viewportsCurrent[index].y !== y || this._viewportsCurrent[index].w !== w || this._viewportsCurrent[index].h !== h;\n        if (update) {\n            this._viewportsCurrent[index].x = this._viewportCached.x;\n            this._viewportsCurrent[index].y = this._viewportCached.y;\n            this._viewportsCurrent[index].w = this._viewportCached.z;\n            this._viewportsCurrent[index].h = this._viewportCached.w;\n        }\n        return update;\n    }\n    _applyViewport(renderPass) {\n        let y = Math.floor(this._viewportCached.y);\n        const h = Math.floor(this._viewportCached.w);\n        if (!this._currentRenderTarget) {\n            y = this.getRenderHeight() - y - h;\n        }\n        renderPass.setViewport(Math.floor(this._viewportCached.x), y, Math.floor(this._viewportCached.z), h, 0, 1);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - viewport applied - (\", this._viewportCached.x, this._viewportCached.y, this._viewportCached.z, this._viewportCached.w, \") current pass is main pass=\" + (renderPass === this._mainRenderPassWrapper.renderPass));\n            }\n        }\n    }\n    /**\n     * @internal\n     */\n    _viewport(x, y, width, height) {\n        this._viewportCached.x = x;\n        this._viewportCached.y = y;\n        this._viewportCached.z = width;\n        this._viewportCached.w = height;\n    }\n    _resetCurrentScissor(index) {\n        this._scissorsCurrent[index].x = 0;\n        this._scissorsCurrent[index].y = 0;\n        this._scissorsCurrent[index].w = 0;\n        this._scissorsCurrent[index].h = 0;\n    }\n    _mustUpdateScissor(renderPass) {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n        const x = this._scissorCached.x, y = this._scissorCached.y, w = this._scissorCached.z, h = this._scissorCached.w;\n        const update = this._scissorsCurrent[index].x !== x || this._scissorsCurrent[index].y !== y || this._scissorsCurrent[index].w !== w || this._scissorsCurrent[index].h !== h;\n        if (update) {\n            this._scissorsCurrent[index].x = this._scissorCached.x;\n            this._scissorsCurrent[index].y = this._scissorCached.y;\n            this._scissorsCurrent[index].w = this._scissorCached.z;\n            this._scissorsCurrent[index].h = this._scissorCached.w;\n        }\n        return update;\n    }\n    _applyScissor(renderPass) {\n        renderPass.setScissorRect(this._scissorCached.x, this._currentRenderTarget ? this._scissorCached.y : this.getRenderHeight() - this._scissorCached.w - this._scissorCached.y, this._scissorCached.z, this._scissorCached.w);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - scissor applied - (\", this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w, \") current pass is main pass=\" + (renderPass === this._mainRenderPassWrapper.renderPass));\n            }\n        }\n    }\n    _scissorIsActive() {\n        return this._scissorCached.x !== 0 || this._scissorCached.y !== 0 || this._scissorCached.z !== 0 || this._scissorCached.w !== 0;\n    }\n    enableScissor(x, y, width, height) {\n        this._scissorCached.x = x;\n        this._scissorCached.y = y;\n        this._scissorCached.z = width;\n        this._scissorCached.w = height;\n    }\n    disableScissor() {\n        this._scissorCached.x = 0;\n        this._scissorCached.y = 0;\n        this._scissorCached.z = 0;\n        this._scissorCached.w = 0;\n        this._resetCurrentScissor(0);\n        this._resetCurrentScissor(1);\n    }\n    _resetCurrentStencilRef(index) {\n        this._stencilRefsCurrent[index] = -1;\n    }\n    _mustUpdateStencilRef(renderPass) {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n        const update = this._stencilStateComposer.funcRef !== this._stencilRefsCurrent[index];\n        if (update) {\n            this._stencilRefsCurrent[index] = this._stencilStateComposer.funcRef;\n        }\n        return update;\n    }\n    /**\n     * @internal\n     */\n    _applyStencilRef(renderPass) {\n        var _a;\n        renderPass.setStencilReference((_a = this._stencilStateComposer.funcRef) !== null && _a !== void 0 ? _a : 0);\n    }\n    _resetCurrentColorBlend(index) {\n        this._blendColorsCurrent[index][0] = this._blendColorsCurrent[index][1] = this._blendColorsCurrent[index][2] = this._blendColorsCurrent[index][3] = null;\n    }\n    _mustUpdateBlendColor(renderPass) {\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n        const colorBlend = this._alphaState._blendConstants;\n        const update = colorBlend[0] !== this._blendColorsCurrent[index][0] ||\n            colorBlend[1] !== this._blendColorsCurrent[index][1] ||\n            colorBlend[2] !== this._blendColorsCurrent[index][2] ||\n            colorBlend[3] !== this._blendColorsCurrent[index][3];\n        if (update) {\n            this._blendColorsCurrent[index][0] = colorBlend[0];\n            this._blendColorsCurrent[index][1] = colorBlend[1];\n            this._blendColorsCurrent[index][2] = colorBlend[2];\n            this._blendColorsCurrent[index][3] = colorBlend[3];\n        }\n        return update;\n    }\n    _applyBlendColor(renderPass) {\n        renderPass.setBlendConstant(this._alphaState._blendConstants);\n    }\n    /**\n     * Clear the current render buffer or the current render target (if any is set up)\n     * @param color defines the color to use\n     * @param backBuffer defines if the back buffer must be cleared\n     * @param depth defines if the depth buffer must be cleared\n     * @param stencil defines if the stencil buffer must be cleared\n     */\n    clear(color, backBuffer, depth, stencil = false) {\n        // Some PGs are using color3...\n        if (color && color.a === undefined) {\n            color.a = 1;\n        }\n        const hasScissor = this._scissorIsActive();\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - clear called - backBuffer=\", backBuffer, \" depth=\", depth, \" stencil=\", stencil, \" scissor is active=\", hasScissor);\n            }\n        }\n        // We need to recreate the render pass so that the new parameters for clear color / depth / stencil are taken into account\n        if (this._currentRenderTarget) {\n            if (hasScissor) {\n                if (!this._rttRenderPassWrapper.renderPass) {\n                    this._startRenderTargetRenderPass(this._currentRenderTarget, false, backBuffer ? color : null, depth, stencil);\n                }\n                if (!this.compatibilityMode) {\n                    this._bundleListRenderTarget.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\n                }\n                else {\n                    this._applyScissor(this._currentRenderPass);\n                }\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\n            }\n            else {\n                if (this._currentRenderPass) {\n                    this._endRenderTargetRenderPass();\n                }\n                this._startRenderTargetRenderPass(this._currentRenderTarget, true, backBuffer ? color : null, depth, stencil);\n            }\n        }\n        else {\n            if (!this._mainRenderPassWrapper.renderPass || !hasScissor) {\n                this._startMainRenderPass(!hasScissor, backBuffer ? color : null, depth, stencil);\n            }\n            if (hasScissor) {\n                if (!this.compatibilityMode) {\n                    this._bundleList.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\n                }\n                else {\n                    this._applyScissor(this._currentRenderPass);\n                }\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\n            }\n        }\n    }\n    _clearFullQuad(clearColor, clearDepth, clearStencil) {\n        var _a, _b, _c;\n        const renderPass = !this.compatibilityMode ? null : this._getCurrentRenderPass();\n        const renderPassIndex = this._getCurrentRenderPassIndex();\n        const bundleList = renderPassIndex === 0 ? this._bundleList : this._bundleListRenderTarget;\n        this._clearQuad.setColorFormat(this._colorFormat);\n        this._clearQuad.setDepthStencilFormat(this._depthTextureFormat);\n        this._clearQuad.setMRTAttachments((_a = this._cacheRenderPipeline.mrtAttachments) !== null && _a !== void 0 ? _a : [], (_b = this._cacheRenderPipeline.mrtTextureArray) !== null && _b !== void 0 ? _b : [], this._cacheRenderPipeline.mrtTextureCount);\n        if (!this.compatibilityMode) {\n            bundleList.addItem(new WebGPURenderItemStencilRef(this._clearStencilValue));\n        }\n        else {\n            renderPass.setStencilReference(this._clearStencilValue);\n        }\n        const bundle = this._clearQuad.clear(renderPass, clearColor, clearDepth, clearStencil, this.currentSampleCount);\n        if (!this.compatibilityMode) {\n            bundleList.addBundle(bundle);\n            bundleList.addItem(new WebGPURenderItemStencilRef((_c = this._stencilStateComposer.funcRef) !== null && _c !== void 0 ? _c : 0));\n            this._reportDrawCall();\n        }\n        else {\n            this._applyStencilRef(renderPass);\n        }\n    }\n    //------------------------------------------------------------------------------\n    //                              Vertex/Index/Storage Buffers\n    //------------------------------------------------------------------------------\n    /**\n     * Creates a vertex buffer\n     * @param data the data for the vertex buffer\n     * @returns the new buffer\n     */\n    createVertexBuffer(data) {\n        let view;\n        if (data instanceof Array) {\n            view = new Float32Array(data);\n        }\n        else if (data instanceof ArrayBuffer) {\n            view = new Uint8Array(data);\n        }\n        else {\n            view = data;\n        }\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Vertex | WebGPUConstants.BufferUsage.CopyDst);\n        return dataBuffer;\n    }\n    /**\n     * Creates a vertex buffer\n     * @param data the data for the dynamic vertex buffer\n     * @returns the new buffer\n     */\n    createDynamicVertexBuffer(data) {\n        return this.createVertexBuffer(data);\n    }\n    /**\n     * Creates a new index buffer\n     * @param indices defines the content of the index buffer\n     * @returns a new buffer\n     */\n    createIndexBuffer(indices) {\n        let is32Bits = true;\n        let view;\n        if (indices instanceof Uint32Array || indices instanceof Int32Array) {\n            view = indices;\n        }\n        else if (indices instanceof Uint16Array) {\n            view = indices;\n            is32Bits = false;\n        }\n        else {\n            if (indices.length > 65535) {\n                view = new Uint32Array(indices);\n            }\n            else {\n                view = new Uint16Array(indices);\n                is32Bits = false;\n            }\n        }\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Index | WebGPUConstants.BufferUsage.CopyDst);\n        dataBuffer.is32Bits = is32Bits;\n        return dataBuffer;\n    }\n    /**\n     * @internal\n     */\n    _createBuffer(data, creationFlags) {\n        let view;\n        if (data instanceof Array) {\n            view = new Float32Array(data);\n        }\n        else if (data instanceof ArrayBuffer) {\n            view = new Uint8Array(data);\n        }\n        else {\n            view = data;\n        }\n        let flags = 0;\n        if (creationFlags & 1) {\n            flags |= WebGPUConstants.BufferUsage.CopySrc;\n        }\n        if (creationFlags & 2) {\n            flags |= WebGPUConstants.BufferUsage.CopyDst;\n        }\n        if (creationFlags & 4) {\n            flags |= WebGPUConstants.BufferUsage.Uniform;\n        }\n        if (creationFlags & 8) {\n            flags |= WebGPUConstants.BufferUsage.Vertex;\n        }\n        if (creationFlags & 16) {\n            flags |= WebGPUConstants.BufferUsage.Index;\n        }\n        if (creationFlags & 32) {\n            flags |= WebGPUConstants.BufferUsage.Storage;\n        }\n        return this._bufferManager.createBuffer(view, flags);\n    }\n    /**\n     * @internal\n     */\n    bindBuffersDirectly() {\n        throw \"Not implemented on WebGPU\";\n    }\n    /**\n     * @internal\n     */\n    updateAndBindInstancesBuffer() {\n        throw \"Not implemented on WebGPU\";\n    }\n    /**\n     * Bind a list of vertex buffers with the engine\n     * @param vertexBuffers defines the list of vertex buffers to bind\n     * @param indexBuffer defines the index buffer to bind\n     * @param effect defines the effect associated with the vertex buffers\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\n     */\n    bindBuffers(vertexBuffers, indexBuffer, effect, overrideVertexBuffers) {\n        this._currentIndexBuffer = indexBuffer;\n        this._currentOverrideVertexBuffers = overrideVertexBuffers !== null && overrideVertexBuffers !== void 0 ? overrideVertexBuffers : null;\n        this._cacheRenderPipeline.setBuffers(vertexBuffers, indexBuffer, this._currentOverrideVertexBuffers);\n    }\n    /**\n     * @internal\n     */\n    _releaseBuffer(buffer) {\n        return this._bufferManager.releaseBuffer(buffer);\n    }\n    //------------------------------------------------------------------------------\n    //                              Effects\n    //------------------------------------------------------------------------------\n    /**\n     * Create a new effect (used to store vertex/fragment shaders)\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\n     * @param samplers defines an array of string used to represent textures\n     * @param defines defines the string containing the defines to use to compile the shaders\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\n     * @param onCompiled defines a function to call when the effect creation is successful\n     * @param onError defines a function to call when the effect creation has failed\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\n     * @returns the new Effect\n     */\n    createEffect(baseName, attributesNamesOrOptions, uniformsNamesOrEngine, samplers, defines, fallbacks, onCompiled, onError, indexParameters, shaderLanguage = ShaderLanguage.GLSL) {\n        var _a;\n        const vertex = baseName.vertexElement || baseName.vertex || baseName.vertexToken || baseName.vertexSource || baseName;\n        const fragment = baseName.fragmentElement || baseName.fragment || baseName.fragmentToken || baseName.fragmentSource || baseName;\n        const globalDefines = this._getGlobalDefines();\n        let fullDefines = (_a = defines !== null && defines !== void 0 ? defines : attributesNamesOrOptions.defines) !== null && _a !== void 0 ? _a : \"\";\n        if (globalDefines) {\n            fullDefines += \"\\n\" + globalDefines;\n        }\n        const name = vertex + \"+\" + fragment + \"@\" + fullDefines;\n        if (this._compiledEffects[name]) {\n            const compiledEffect = this._compiledEffects[name];\n            if (onCompiled && compiledEffect.isReady()) {\n                onCompiled(compiledEffect);\n            }\n            return compiledEffect;\n        }\n        const effect = new Effect(baseName, attributesNamesOrOptions, uniformsNamesOrEngine, samplers, this, defines, fallbacks, onCompiled, onError, indexParameters, name, shaderLanguage);\n        this._compiledEffects[name] = effect;\n        return effect;\n    }\n    _compileRawShaderToSpirV(source, type) {\n        return this._glslang.compileGLSL(source, type);\n    }\n    _compileShaderToSpirV(source, type, defines, shaderVersion) {\n        return this._compileRawShaderToSpirV(shaderVersion + (defines ? defines + \"\\n\" : \"\") + source, type);\n    }\n    _getWGSLShader(source, type, defines) {\n        if (defines) {\n            defines = \"//\" + defines.split(\"\\n\").join(\"\\n//\") + \"\\n\";\n        }\n        else {\n            defines = \"\";\n        }\n        return defines + source;\n    }\n    _createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage) {\n        if (this._tintWASM && shaderLanguage === ShaderLanguage.GLSL) {\n            vertexShader = this._tintWASM.convertSpirV2WGSL(vertexShader);\n            fragmentShader = this._tintWASM.convertSpirV2WGSL(fragmentShader);\n        }\n        return {\n            vertexStage: {\n                module: this._device.createShaderModule({\n                    code: vertexShader,\n                }),\n                entryPoint: \"main\",\n            },\n            fragmentStage: {\n                module: this._device.createShaderModule({\n                    code: fragmentShader,\n                }),\n                entryPoint: \"main\",\n            },\n        };\n    }\n    _compileRawPipelineStageDescriptor(vertexCode, fragmentCode, shaderLanguage) {\n        const vertexShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileRawShaderToSpirV(vertexCode, \"vertex\") : vertexCode;\n        const fragmentShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileRawShaderToSpirV(fragmentCode, \"fragment\") : fragmentCode;\n        return this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage);\n    }\n    _compilePipelineStageDescriptor(vertexCode, fragmentCode, defines, shaderLanguage) {\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\n        const shaderVersion = \"#version 450\\n\";\n        const vertexShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileShaderToSpirV(vertexCode, \"vertex\", defines, shaderVersion) : this._getWGSLShader(vertexCode, \"vertex\", defines);\n        const fragmentShader = shaderLanguage === ShaderLanguage.GLSL\n            ? this._compileShaderToSpirV(fragmentCode, \"fragment\", defines, shaderVersion)\n            : this._getWGSLShader(fragmentCode, \"fragment\", defines);\n        const program = this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage);\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\n        return program;\n    }\n    /**\n     * @internal\n     */\n    createRawShaderProgram() {\n        throw \"Not available on WebGPU\";\n    }\n    /**\n     * @internal\n     */\n    createShaderProgram() {\n        throw \"Not available on WebGPU\";\n    }\n    /**\n     * Inline functions in shader code that are marked to be inlined\n     * @param code code to inline\n     * @returns inlined code\n     */\n    inlineShaderCode(code) {\n        const sci = new ShaderCodeInliner(code);\n        sci.debug = false;\n        sci.processCode();\n        return sci.code;\n    }\n    /**\n     * Creates a new pipeline context\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\n     * @returns the new pipeline\n     */\n    createPipelineContext(shaderProcessingContext) {\n        return new WebGPUPipelineContext(shaderProcessingContext, this);\n    }\n    /**\n     * Creates a new material context\n     * @returns the new context\n     */\n    createMaterialContext() {\n        return new WebGPUMaterialContext();\n    }\n    /**\n     * Creates a new draw context\n     * @returns the new context\n     */\n    createDrawContext() {\n        return new WebGPUDrawContext(this._bufferManager);\n    }\n    /**\n     * @internal\n     */\n    _preparePipelineContext(pipelineContext, vertexSourceCode, fragmentSourceCode, createAsRaw, rawVertexSourceCode, rawFragmentSourceCode, rebuildRebind, defines) {\n        const webGpuContext = pipelineContext;\n        const shaderLanguage = webGpuContext.shaderProcessingContext.shaderLanguage;\n        if (this.dbgShowShaderCode) {\n            console.log(defines);\n            console.log(vertexSourceCode);\n            console.log(fragmentSourceCode);\n            console.log(\"***********************************************\");\n        }\n        webGpuContext.sources = {\n            fragment: fragmentSourceCode,\n            vertex: vertexSourceCode,\n            rawVertex: rawVertexSourceCode,\n            rawFragment: rawFragmentSourceCode,\n        };\n        if (createAsRaw) {\n            webGpuContext.stages = this._compileRawPipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, shaderLanguage);\n        }\n        else {\n            webGpuContext.stages = this._compilePipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, defines, shaderLanguage);\n        }\n    }\n    /**\n     * Gets the list of active attributes for a given WebGPU program\n     * @param pipelineContext defines the pipeline context to use\n     * @param attributesNames defines the list of attribute names to get\n     * @returns an array of indices indicating the offset of each attribute\n     */\n    getAttributes(pipelineContext, attributesNames) {\n        const results = new Array(attributesNames.length);\n        const gpuPipelineContext = pipelineContext;\n        for (let i = 0; i < attributesNames.length; i++) {\n            const attributeName = attributesNames[i];\n            const attributeLocation = gpuPipelineContext.shaderProcessingContext.availableAttributes[attributeName];\n            if (attributeLocation === undefined) {\n                continue;\n            }\n            results[i] = attributeLocation;\n        }\n        return results;\n    }\n    /**\n     * Activates an effect, making it the current one (ie. the one used for rendering)\n     * @param effect defines the effect to activate\n     */\n    enableEffect(effect) {\n        if (!effect) {\n            return;\n        }\n        let isNewEffect = true;\n        if (!DrawWrapper.IsWrapper(effect)) {\n            isNewEffect = effect !== this._currentEffect;\n            this._currentEffect = effect;\n            this._currentMaterialContext = this._defaultMaterialContext;\n            this._currentDrawContext = this._defaultDrawContext;\n            this._counters.numEnableEffects++;\n            if (this.dbgLogIfNotDrawWrapper) {\n                Logger.Warn(`enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId=${effect.uniqueId}, effect.name=${effect.name}, effect.name.vertex=${effect.name.vertex}, effect.name.fragment=${effect.name.fragment}`, 10);\n            }\n        }\n        else if (!effect.effect ||\n            (effect.effect === this._currentEffect &&\n                effect.materialContext === this._currentMaterialContext &&\n                effect.drawContext === this._currentDrawContext &&\n                !this._forceEnableEffect)) {\n            if (!effect.effect && this.dbgShowEmptyEnableEffectCalls) {\n                console.error(\"drawWrapper=\", effect);\n                throw \"Invalid call to enableEffect: the effect property is empty!\";\n            }\n            return;\n        }\n        else {\n            isNewEffect = effect.effect !== this._currentEffect;\n            this._currentEffect = effect.effect;\n            this._currentMaterialContext = effect.materialContext;\n            this._currentDrawContext = effect.drawContext;\n            this._counters.numEnableDrawWrapper++;\n            if (!this._currentMaterialContext) {\n                console.error(\"drawWrapper=\", effect);\n                throw `Invalid call to enableEffect: the materialContext property is empty!`;\n            }\n        }\n        this._stencilStateComposer.stencilMaterial = undefined;\n        this._forceEnableEffect = isNewEffect || this._forceEnableEffect ? false : this._forceEnableEffect;\n        if (isNewEffect) {\n            if (this._currentEffect.onBind) {\n                this._currentEffect.onBind(this._currentEffect);\n            }\n            if (this._currentEffect._onBindObservable) {\n                this._currentEffect._onBindObservable.notifyObservers(this._currentEffect);\n            }\n        }\n    }\n    /**\n     * @internal\n     */\n    _releaseEffect(effect) {\n        if (this._compiledEffects[effect._key]) {\n            delete this._compiledEffects[effect._key];\n            this._deletePipelineContext(effect.getPipelineContext());\n        }\n    }\n    /**\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\n     */\n    releaseEffects() {\n        for (const name in this._compiledEffects) {\n            const webGPUPipelineContext = this._compiledEffects[name].getPipelineContext();\n            this._deletePipelineContext(webGPUPipelineContext);\n        }\n        this._compiledEffects = {};\n    }\n    _deletePipelineContext(pipelineContext) {\n        const webgpuPipelineContext = pipelineContext;\n        if (webgpuPipelineContext) {\n            pipelineContext.dispose();\n        }\n    }\n    //------------------------------------------------------------------------------\n    //                              Textures\n    //------------------------------------------------------------------------------\n    /**\n     * Gets a boolean indicating that only power of 2 textures are supported\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\n     */\n    get needPOTTextures() {\n        return false;\n    }\n    /** @internal */\n    _createHardwareTexture() {\n        return new WebGPUHardwareTexture();\n    }\n    /**\n     * @internal\n     */\n    _releaseTexture(texture) {\n        const index = this._internalTexturesCache.indexOf(texture);\n        if (index !== -1) {\n            this._internalTexturesCache.splice(index, 1);\n        }\n        this._textureHelper.releaseTexture(texture);\n    }\n    /**\n     * @internal\n     */\n    _getRGBABufferInternalSizedFormat() {\n        return 5;\n    }\n    updateTextureComparisonFunction(texture, comparisonFunction) {\n        texture._comparisonFunction = comparisonFunction;\n    }\n    /**\n     * Creates an internal texture without binding it to a framebuffer\n     * @internal\n     * @param size defines the size of the texture\n     * @param options defines the options used to create the texture\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\n     * @param source source type of the texture\n     * @returns a new internal texture\n     */\n    _createInternalTexture(size, options, delayGPUTextureCreation = true, source = InternalTextureSource.Unknown) {\n        var _a, _b, _c;\n        const fullOptions = {};\n        if (options !== undefined && typeof options === \"object\") {\n            fullOptions.generateMipMaps = options.generateMipMaps;\n            fullOptions.type = options.type === undefined ? 0 : options.type;\n            fullOptions.samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\n            fullOptions.format = options.format === undefined ? 5 : options.format;\n            fullOptions.samples = (_a = options.samples) !== null && _a !== void 0 ? _a : 1;\n            fullOptions.creationFlags = (_b = options.creationFlags) !== null && _b !== void 0 ? _b : 0;\n            fullOptions.useSRGBBuffer = (_c = options.useSRGBBuffer) !== null && _c !== void 0 ? _c : false;\n        }\n        else {\n            fullOptions.generateMipMaps = options;\n            fullOptions.type = 0;\n            fullOptions.samplingMode = 3;\n            fullOptions.format = 5;\n            fullOptions.samples = 1;\n            fullOptions.creationFlags = 0;\n            fullOptions.useSRGBBuffer = false;\n        }\n        if (fullOptions.type === 1 && !this._caps.textureFloatLinearFiltering) {\n            fullOptions.samplingMode = 1;\n        }\n        else if (fullOptions.type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\n            fullOptions.samplingMode = 1;\n        }\n        if (fullOptions.type === 1 && !this._caps.textureFloat) {\n            fullOptions.type = 0;\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\n        }\n        const texture = new InternalTexture(this, source);\n        const width = size.width || size;\n        const height = size.height || size;\n        const layers = size.layers || 0;\n        texture.baseWidth = width;\n        texture.baseHeight = height;\n        texture.width = width;\n        texture.height = height;\n        texture.depth = layers;\n        texture.isReady = true;\n        texture.samples = fullOptions.samples;\n        texture.generateMipMaps = fullOptions.generateMipMaps ? true : false;\n        texture.samplingMode = fullOptions.samplingMode;\n        texture.type = fullOptions.type;\n        texture.format = fullOptions.format;\n        texture.is2DArray = layers > 0;\n        texture._cachedWrapU = 0;\n        texture._cachedWrapV = 0;\n        texture._useSRGBBuffer = fullOptions.useSRGBBuffer;\n        this._internalTexturesCache.push(texture);\n        if (!delayGPUTextureCreation) {\n            this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, layers || 1, fullOptions.creationFlags);\n        }\n        return texture;\n    }\n    /**\n     * Usually called from Texture.ts.\n     * Passed information to create a hardware texture\n     * @param url defines a value which contains one of the following:\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\n     * @param scene needed for loading to the correct scene\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\n     * @param onLoad optional callback to be called upon successful completion\n     * @param onError optional callback to be called upon failure\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\n     * @param forcedExtension defines the extension to use to pick the right loader\n     * @param mimeType defines an optional mime type\n     * @param loaderOptions options to be passed to the loader\n     * @param creationFlags specific flags to use when creating the texture (1 for storage textures, for eg)\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\n     */\n    createTexture(url, noMipmap, invertY, scene, samplingMode = 3, onLoad = null, onError = null, buffer = null, fallback = null, format = null, forcedExtension = null, mimeType, loaderOptions, creationFlags, useSRGBBuffer) {\n        return this._createTextureBase(url, noMipmap, invertY, scene, samplingMode, onLoad, onError, (texture, extension, scene, img, invertY, noMipmap, isCompressed, processFunction) => {\n            var _a;\n            const imageBitmap = img; // we will never get an HTMLImageElement in WebGPU\n            texture.baseWidth = imageBitmap.width;\n            texture.baseHeight = imageBitmap.height;\n            texture.width = imageBitmap.width;\n            texture.height = imageBitmap.height;\n            texture.format = format !== null && format !== void 0 ? format : -1;\n            processFunction(texture.width, texture.height, imageBitmap, extension, texture, () => { });\n            if (!((_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource)) {\n                // the texture could have been created before reaching this point so don't recreate it if already existing\n                const gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, imageBitmap.width, imageBitmap.height, undefined, creationFlags);\n                if (WebGPUTextureHelper.IsImageBitmap(imageBitmap)) {\n                    this._textureHelper.updateTexture(imageBitmap, texture, imageBitmap.width, imageBitmap.height, texture.depth, gpuTextureWrapper.format, 0, 0, invertY, false, 0, 0);\n                    if (!noMipmap && !isCompressed) {\n                        this._generateMipmaps(texture, this._uploadEncoder);\n                    }\n                }\n            }\n            else if (!noMipmap && !isCompressed) {\n                this._generateMipmaps(texture, this._uploadEncoder);\n            }\n            if (scene) {\n                scene.removePendingData(texture);\n            }\n            texture.isReady = true;\n            texture.onLoadedObservable.notifyObservers(texture);\n            texture.onLoadedObservable.clear();\n        }, () => false, buffer, fallback, format, forcedExtension, mimeType, loaderOptions, useSRGBBuffer);\n    }\n    /**\n     * Wraps an external web gpu texture in a Babylon texture.\n     * @param texture defines the external texture\n     * @returns the babylon internal texture\n     */\n    wrapWebGPUTexture(texture) {\n        const hardwareTexture = new WebGPUHardwareTexture(texture);\n        const internalTexture = new InternalTexture(this, InternalTextureSource.Unknown, true);\n        internalTexture._hardwareTexture = hardwareTexture;\n        internalTexture.isReady = true;\n        return internalTexture;\n    }\n    /**\n     * Wraps an external web gl texture in a Babylon texture.\n     * @returns the babylon internal texture\n     */\n    wrapWebGLTexture() {\n        throw new Error(\"wrapWebGLTexture is not supported, use wrapWebGPUTexture instead.\");\n    }\n    generateMipMapsForCubemap(texture) {\n        var _a;\n        if (texture.generateMipMaps) {\n            const gpuTexture = (_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource;\n            if (!gpuTexture) {\n                this._textureHelper.createGPUTextureForInternalTexture(texture);\n            }\n            this._generateMipmaps(texture, texture.source === InternalTextureSource.RenderTarget || texture.source === InternalTextureSource.MultiRenderTarget ? this._renderTargetEncoder : undefined);\n        }\n    }\n    /**\n     * Update the sampling mode of a given texture\n     * @param samplingMode defines the required sampling mode\n     * @param texture defines the texture to update\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\n     */\n    updateTextureSamplingMode(samplingMode, texture, generateMipMaps = false) {\n        if (generateMipMaps) {\n            texture.generateMipMaps = true;\n            this._generateMipmaps(texture);\n        }\n        texture.samplingMode = samplingMode;\n    }\n    /**\n     * Update the sampling mode of a given texture\n     * @param texture defines the texture to update\n     * @param wrapU defines the texture wrap mode of the u coordinates\n     * @param wrapV defines the texture wrap mode of the v coordinates\n     * @param wrapR defines the texture wrap mode of the r coordinates\n     */\n    updateTextureWrappingMode(texture, wrapU, wrapV = null, wrapR = null) {\n        if (wrapU !== null) {\n            texture._cachedWrapU = wrapU;\n        }\n        if (wrapV !== null) {\n            texture._cachedWrapV = wrapV;\n        }\n        if ((texture.is2DArray || texture.is3D) && wrapR !== null) {\n            texture._cachedWrapR = wrapR;\n        }\n    }\n    /**\n     * Update the dimensions of a texture\n     * @param texture texture to update\n     * @param width new width of the texture\n     * @param height new height of the texture\n     * @param depth new depth of the texture\n     */\n    updateTextureDimensions(texture, width, height, depth = 1) {\n        if (!texture._hardwareTexture) {\n            // the gpu texture is not created yet, so when it is it will be created with the right dimensions\n            return;\n        }\n        if (texture.width === width && texture.height === height && texture.depth === depth) {\n            return;\n        }\n        const additionalUsages = texture._hardwareTexture.textureAdditionalUsages;\n        texture._hardwareTexture.release(); // don't defer the releasing! Else we will release at the end of this frame the gpu texture we are about to create in the next line...\n        this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, depth, additionalUsages);\n    }\n    /**\n     * @internal\n     */\n    _setInternalTexture(name, texture, baseName) {\n        baseName = baseName !== null && baseName !== void 0 ? baseName : name;\n        if (this._currentEffect) {\n            const webgpuPipelineContext = this._currentEffect._pipelineContext;\n            const availableTexture = webgpuPipelineContext.shaderProcessingContext.availableTextures[baseName];\n            this._currentMaterialContext.setTexture(name, texture);\n            if (availableTexture && availableTexture.autoBindSampler) {\n                const samplerName = baseName + WebGPUShaderProcessor.AutoSamplerSuffix;\n                this._currentMaterialContext.setSampler(samplerName, texture); // we can safely cast to InternalTexture because ExternalTexture always has autoBindSampler = false\n            }\n        }\n    }\n    /**\n     * Sets a texture to the according uniform.\n     * @param channel The texture channel\n     * @param unused unused parameter\n     * @param texture The texture to apply\n     * @param name The name of the uniform in the effect\n     */\n    setTexture(channel, unused, texture, name) {\n        this._setTexture(channel, texture, false, false, name, name);\n    }\n    /**\n     * Sets an array of texture to the WebGPU context\n     * @param channel defines the channel where the texture array must be set\n     * @param unused unused parameter\n     * @param textures defines the array of textures to bind\n     * @param name name of the channel\n     */\n    setTextureArray(channel, unused, textures, name) {\n        for (let index = 0; index < textures.length; index++) {\n            this._setTexture(-1, textures[index], true, false, name + index.toString(), name);\n        }\n    }\n    _setTexture(channel, texture, \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    isPartOfTextureArray = false, depthStencilTexture = false, name = \"\", baseName) {\n        // name == baseName for a texture that is not part of a texture array\n        // Else, name is something like 'myTexture0' / 'myTexture1' / ... and baseName is 'myTexture'\n        // baseName is used to look up the texture in the shaderProcessingContext.availableTextures map\n        // name is used to look up the texture in the _currentMaterialContext.textures map\n        baseName = baseName !== null && baseName !== void 0 ? baseName : name;\n        if (this._currentEffect) {\n            if (!texture) {\n                this._currentMaterialContext.setTexture(name, null);\n                return false;\n            }\n            // Video\n            if (texture.video) {\n                texture.update();\n            }\n            else if (texture.delayLoadState === 4) {\n                // Delay loading\n                texture.delayLoad();\n                return false;\n            }\n            let internalTexture = null;\n            if (depthStencilTexture) {\n                internalTexture = texture.depthStencilTexture;\n            }\n            else if (texture.isReady()) {\n                internalTexture = texture.getInternalTexture();\n            }\n            else if (texture.isCube) {\n                internalTexture = this.emptyCubeTexture;\n            }\n            else if (texture.is3D) {\n                internalTexture = this.emptyTexture3D;\n            }\n            else if (texture.is2DArray) {\n                internalTexture = this.emptyTexture2DArray;\n            }\n            else {\n                internalTexture = this.emptyTexture;\n            }\n            if (internalTexture && !internalTexture.isMultiview) {\n                // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\n                if (internalTexture.isCube && internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\n                    internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\n                    const textureWrapMode = texture.coordinatesMode !== 3 && texture.coordinatesMode !== 5\n                        ? 1\n                        : 0;\n                    texture.wrapU = textureWrapMode;\n                    texture.wrapV = textureWrapMode;\n                }\n                internalTexture._cachedWrapU = texture.wrapU;\n                internalTexture._cachedWrapV = texture.wrapV;\n                if (internalTexture.is3D) {\n                    internalTexture._cachedWrapR = texture.wrapR;\n                }\n                this._setAnisotropicLevel(0, internalTexture, texture.anisotropicFilteringLevel);\n            }\n            this._setInternalTexture(name, internalTexture, baseName);\n        }\n        else {\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                }\n                if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                    console.log(\"frame #\" + this._count + \" - _setTexture called with a null _currentEffect! texture=\", texture);\n                }\n            }\n        }\n        return true;\n    }\n    /**\n     * @internal\n     */\n    _setAnisotropicLevel(target, internalTexture, anisotropicFilteringLevel) {\n        if (internalTexture._cachedAnisotropicFilteringLevel !== anisotropicFilteringLevel) {\n            internalTexture._cachedAnisotropicFilteringLevel = Math.min(anisotropicFilteringLevel, this._caps.maxAnisotropy);\n        }\n    }\n    /**\n     * @internal\n     */\n    _bindTexture(channel, texture, name) {\n        if (channel === undefined) {\n            return;\n        }\n        this._setInternalTexture(name, texture);\n    }\n    /**\n     * Generates the mipmaps for a texture\n     * @param texture texture to generate the mipmaps for\n     */\n    generateMipmaps(texture) {\n        this._generateMipmaps(texture, this._renderTargetEncoder);\n    }\n    /**\n     * @internal\n     */\n    _generateMipmaps(texture, commandEncoder) {\n        const gpuHardwareTexture = texture._hardwareTexture;\n        if (!gpuHardwareTexture) {\n            return;\n        }\n        // try as much as possible to use the command encoder corresponding to the current pass.\n        // If not possible (because the pass is started - generateMipmaps itself creates a pass and it's not allowed to have a pass inside a pass), use _uploadEncoder\n        commandEncoder =\n            commandEncoder !== null && commandEncoder !== void 0 ? commandEncoder : (this._currentRenderTarget && !this._currentRenderPass ? this._renderTargetEncoder : !this._currentRenderPass ? this._renderEncoder : this._uploadEncoder);\n        const format = texture._hardwareTexture.format;\n        const mipmapCount = WebGPUTextureHelper.ComputeNumMipmapLevels(texture.width, texture.height);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - generate mipmaps called - width=\", texture.width, \"height=\", texture.height, \"isCube=\", texture.isCube);\n            }\n        }\n        if (texture.isCube) {\n            this._textureHelper.generateCubeMipmaps(gpuHardwareTexture, format, mipmapCount, commandEncoder);\n        }\n        else {\n            this._textureHelper.generateMipmaps(gpuHardwareTexture, format, mipmapCount, 0, commandEncoder);\n        }\n    }\n    /**\n     * Update a portion of an internal texture\n     * @param texture defines the texture to update\n     * @param imageData defines the data to store into the texture\n     * @param xOffset defines the x coordinates of the update rectangle\n     * @param yOffset defines the y coordinates of the update rectangle\n     * @param width defines the width of the update rectangle\n     * @param height defines the height of the update rectangle\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\n     * @param lod defines the lod level to update (0 by default)\n     * @param generateMipMaps defines whether to generate mipmaps or not\n     */\n    updateTextureData(texture, imageData, xOffset, yOffset, width, height, faceIndex = 0, lod = 0, generateMipMaps = false) {\n        var _a;\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!((_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource)) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\n        }\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, xOffset, yOffset);\n        if (generateMipMaps) {\n            this._generateMipmaps(texture, this._renderTargetEncoder);\n        }\n    }\n    /**\n     * @internal\n     */\n    _uploadCompressedDataToTextureDirectly(texture, internalFormat, width, height, imageData, faceIndex = 0, lod = 0) {\n        var _a;\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!((_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource)) {\n            texture.format = internalFormat;\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\n        }\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, false, false, 0, 0);\n    }\n    /**\n     * @internal\n     */\n    _uploadDataToTextureDirectly(texture, imageData, faceIndex = 0, lod = 0, babylonInternalFormat, useTextureWidthAndHeight = false) {\n        var _a;\n        const lodMaxWidth = Math.round(Math.log(texture.width) * Math.LOG2E);\n        const lodMaxHeight = Math.round(Math.log(texture.height) * Math.LOG2E);\n        const width = useTextureWidthAndHeight ? texture.width : Math.pow(2, Math.max(lodMaxWidth - lod, 0));\n        const height = useTextureWidthAndHeight ? texture.height : Math.pow(2, Math.max(lodMaxHeight - lod, 0));\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!((_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource)) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\n        }\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0);\n    }\n    /**\n     * @internal\n     */\n    _uploadArrayBufferViewToTexture(texture, imageData, faceIndex = 0, lod = 0) {\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\n    }\n    /**\n     * @internal\n     */\n    _uploadImageToTexture(texture, image, faceIndex = 0, lod = 0) {\n        var _a;\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!((_a = texture._hardwareTexture) === null || _a === void 0 ? void 0 : _a.underlyingResource)) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\n        }\n        if (image instanceof HTMLImageElement) {\n            throw \"WebGPU engine: HTMLImageElement not supported in _uploadImageToTexture!\";\n        }\n        const bitmap = image; // in WebGPU we will always get an ImageBitmap, not an HTMLImageElement\n        const width = Math.ceil(texture.width / (1 << lod));\n        const height = Math.ceil(texture.height / (1 << lod));\n        this._textureHelper.updateTexture(bitmap, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0);\n    }\n    /**\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\n     * @param x defines the x coordinate of the rectangle where pixels must be read\n     * @param y defines the y coordinate of the rectangle where pixels must be read\n     * @param width defines the width of the rectangle where pixels must be read\n     * @param height defines the height of the rectangle where pixels must be read\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    readPixels(x, y, width, height, hasAlpha = true, flushRenderer = true) {\n        const renderPassWrapper = this._rttRenderPassWrapper.renderPass ? this._rttRenderPassWrapper : this._mainRenderPassWrapper;\n        const hardwareTexture = renderPassWrapper.colorAttachmentGPUTextures[0];\n        if (!hardwareTexture) {\n            // we are calling readPixels for a render pass with no color texture bound\n            return Promise.resolve(new Uint8Array(0));\n        }\n        const gpuTexture = hardwareTexture.underlyingResource;\n        const gpuTextureFormat = hardwareTexture.format;\n        if (!gpuTexture) {\n            // we are calling readPixels before startMainRenderPass has been called and no RTT is bound, so swapChainTexture is not setup yet!\n            return Promise.resolve(new Uint8Array(0));\n        }\n        if (flushRenderer) {\n            this.flushFramebuffer();\n        }\n        return this._textureHelper.readPixels(gpuTexture, x, y, width, height, gpuTextureFormat);\n    }\n    //------------------------------------------------------------------------------\n    //                              Frame management\n    //------------------------------------------------------------------------------\n    /**\n     * Begin a new frame\n     */\n    beginFrame() {\n        super.beginFrame();\n    }\n    /**\n     * End the current frame\n     */\n    endFrame() {\n        this._snapshotRendering.endFrame(this._mainRenderPassWrapper.renderPass);\n        this._endMainRenderPass();\n        this._timestampQuery.endFrame(this._renderEncoder);\n        this.flushFramebuffer(false);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - counters\");\n            }\n        }\n        this._textureHelper.destroyDeferredTextures();\n        this._bufferManager.destroyDeferredBuffers();\n        if (this._features._collectUbosUpdatedInFrame) {\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                }\n                if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                    const list = [];\n                    for (const name in UniformBuffer._UpdatedUbosInFrame) {\n                        list.push(name + \":\" + UniformBuffer._UpdatedUbosInFrame[name]);\n                    }\n                    console.log(\"frame #\" + this._count + \" - updated ubos -\", list.join(\", \"));\n                }\n            }\n            UniformBuffer._UpdatedUbosInFrame = {};\n        }\n        this.countersLastFrame.numEnableEffects = this._counters.numEnableEffects;\n        this.countersLastFrame.numEnableDrawWrapper = this._counters.numEnableDrawWrapper;\n        this.countersLastFrame.numBundleCreationNonCompatMode = this._counters.numBundleCreationNonCompatMode;\n        this.countersLastFrame.numBundleReuseNonCompatMode = this._counters.numBundleReuseNonCompatMode;\n        this._counters.numEnableEffects = 0;\n        this._counters.numEnableDrawWrapper = 0;\n        this._counters.numBundleCreationNonCompatMode = 0;\n        this._counters.numBundleReuseNonCompatMode = 0;\n        this._cacheRenderPipeline.endFrame();\n        this._cacheBindGroups.endFrame();\n        this._pendingDebugCommands.length = 0;\n        super.endFrame();\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"%c frame #\" + this._count + \" - end\", \"background: #ffff00\");\n            }\n            if (this._count < this.dbgVerboseLogsNumFrames) {\n                this._count++;\n                if (this._count !== this.dbgVerboseLogsNumFrames) {\n                    console.log(\"%c frame #\" + this._count + \" - begin\", \"background: #ffff00\");\n                }\n            }\n        }\n    }\n    /**\n     * Force a WebGPU flush (ie. a flush of all waiting commands)\n     * @param reopenPass true to reopen at the end of the function the pass that was active when entering the function\n     */\n    flushFramebuffer(reopenPass = true) {\n        // we need to end the current render pass (main or rtt) if any as we are not allowed to submit the command buffers when being in a pass\n        const currentRenderPassIsNULL = !this._currentRenderPass;\n        let currentPasses = 0; // 0 if no pass, 1 for rtt, 2 for main pass\n        if (this._currentRenderPass && this._currentRenderTarget) {\n            currentPasses |= 1;\n            this._endRenderTargetRenderPass();\n        }\n        if (this._mainRenderPassWrapper.renderPass) {\n            currentPasses |= 2;\n            this._endMainRenderPass();\n        }\n        this._commandBuffers[0] = this._uploadEncoder.finish();\n        this._commandBuffers[1] = this._renderTargetEncoder.finish();\n        this._commandBuffers[2] = this._renderEncoder.finish();\n        this._device.queue.submit(this._commandBuffers);\n        this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\n        this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\n        this._renderTargetEncoder = this._device.createCommandEncoder(this._renderTargetEncoderDescriptor);\n        this._timestampQuery.startFrame(this._uploadEncoder);\n        this._textureHelper.setCommandEncoder(this._uploadEncoder);\n        this._bundleList.reset();\n        this._bundleListRenderTarget.reset();\n        // restart the render pass\n        if (reopenPass) {\n            if (currentPasses & 2) {\n                this._startMainRenderPass(false);\n            }\n            if (currentPasses & 1) {\n                this._startRenderTargetRenderPass(this._currentRenderTarget, false, null, false, false);\n            }\n            if (currentRenderPassIsNULL && this._currentRenderTarget) {\n                this._currentRenderPass = null;\n            }\n        }\n    }\n    /** @internal */\n    _currentFrameBufferIsDefaultFrameBuffer() {\n        return this._currentRenderTarget === null;\n    }\n    //------------------------------------------------------------------------------\n    //                              Render Pass\n    //------------------------------------------------------------------------------\n    _startRenderTargetRenderPass(renderTargetWrapper, setClearStates, clearColor, clearDepth, clearStencil) {\n        var _a, _b, _c;\n        const rtWrapper = renderTargetWrapper;\n        const depthStencilTexture = rtWrapper._depthStencilTexture;\n        const gpuDepthStencilWrapper = depthStencilTexture === null || depthStencilTexture === void 0 ? void 0 : depthStencilTexture._hardwareTexture;\n        const gpuDepthStencilTexture = gpuDepthStencilWrapper === null || gpuDepthStencilWrapper === void 0 ? void 0 : gpuDepthStencilWrapper.underlyingResource;\n        const gpuDepthStencilMSAATexture = gpuDepthStencilWrapper === null || gpuDepthStencilWrapper === void 0 ? void 0 : gpuDepthStencilWrapper.msaaTexture;\n        const depthTextureView = gpuDepthStencilTexture === null || gpuDepthStencilTexture === void 0 ? void 0 : gpuDepthStencilTexture.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor);\n        const depthMSAATextureView = gpuDepthStencilMSAATexture === null || gpuDepthStencilMSAATexture === void 0 ? void 0 : gpuDepthStencilMSAATexture.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor);\n        const depthTextureHasStencil = gpuDepthStencilWrapper ? WebGPUTextureHelper.HasStencilAspect(gpuDepthStencilWrapper.format) : false;\n        const colorAttachments = [];\n        if (this.useReverseDepthBuffer) {\n            this.setDepthFunctionToGreaterOrEqual();\n        }\n        const mustClearColor = setClearStates && clearColor;\n        const mustClearDepth = setClearStates && clearDepth;\n        const mustClearStencil = setClearStates && clearStencil;\n        if (rtWrapper._attachments && rtWrapper.isMulti) {\n            // multi render targets\n            if (!this._mrtAttachments || this._mrtAttachments.length === 0) {\n                this._mrtAttachments = rtWrapper._defaultAttachments;\n            }\n            for (let i = 0; i < this._mrtAttachments.length; ++i) {\n                const index = this._mrtAttachments[i]; // if index == 0 it means the texture should not be written to => at render pass creation time, it means we should not clear it\n                const mrtTexture = rtWrapper.textures[i];\n                const gpuMRTWrapper = mrtTexture === null || mrtTexture === void 0 ? void 0 : mrtTexture._hardwareTexture;\n                const gpuMRTTexture = gpuMRTWrapper === null || gpuMRTWrapper === void 0 ? void 0 : gpuMRTWrapper.underlyingResource;\n                if (gpuMRTWrapper && gpuMRTTexture) {\n                    const viewDescriptor = {\n                        ...this._rttRenderPassWrapper.colorAttachmentViewDescriptor,\n                        format: gpuMRTWrapper.format,\n                    };\n                    const gpuMSAATexture = gpuMRTWrapper.msaaTexture;\n                    const colorTextureView = gpuMRTTexture.createView(viewDescriptor);\n                    const colorMSAATextureView = gpuMSAATexture === null || gpuMSAATexture === void 0 ? void 0 : gpuMSAATexture.createView(viewDescriptor);\n                    colorAttachments.push({\n                        view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\n                        resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\n                        clearValue: index !== 0 && mustClearColor ? clearColor : undefined,\n                        loadOp: index !== 0 && mustClearColor ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load,\n                        storeOp: WebGPUConstants.StoreOp.Store,\n                    });\n                }\n            }\n            this._cacheRenderPipeline.setMRT(rtWrapper.textures, this._mrtAttachments.length);\n            this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments);\n        }\n        else {\n            // single render target\n            const internalTexture = rtWrapper.texture;\n            if (internalTexture) {\n                const gpuWrapper = internalTexture._hardwareTexture;\n                const gpuTexture = gpuWrapper.underlyingResource;\n                const gpuMSAATexture = gpuWrapper.msaaTexture;\n                const colorTextureView = gpuTexture.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor);\n                const colorMSAATextureView = gpuMSAATexture === null || gpuMSAATexture === void 0 ? void 0 : gpuMSAATexture.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor);\n                colorAttachments.push({\n                    view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\n                    resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\n                    clearValue: mustClearColor ? clearColor : undefined,\n                    loadOp: mustClearColor ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load,\n                    storeOp: WebGPUConstants.StoreOp.Store,\n                });\n            }\n            else {\n                colorAttachments.push(null);\n            }\n        }\n        (_a = this._debugPushGroup) === null || _a === void 0 ? void 0 : _a.call(this, \"render target pass\", 1);\n        this._rttRenderPassWrapper.renderPassDescriptor = {\n            colorAttachments,\n            depthStencilAttachment: depthStencilTexture && gpuDepthStencilTexture\n                ? {\n                    view: depthMSAATextureView ? depthMSAATextureView : depthTextureView,\n                    depthClearValue: mustClearDepth ? (this.useReverseDepthBuffer ? this._clearReverseDepthValue : this._clearDepthValue) : undefined,\n                    depthLoadOp: mustClearDepth ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load,\n                    depthStoreOp: WebGPUConstants.StoreOp.Store,\n                    stencilClearValue: rtWrapper._depthStencilTextureWithStencil && mustClearStencil ? this._clearStencilValue : undefined,\n                    stencilLoadOp: !depthTextureHasStencil\n                        ? undefined\n                        : rtWrapper._depthStencilTextureWithStencil && mustClearStencil\n                            ? WebGPUConstants.LoadOp.Clear\n                            : WebGPUConstants.LoadOp.Load,\n                    stencilStoreOp: !depthTextureHasStencil ? undefined : WebGPUConstants.StoreOp.Store,\n                }\n                : undefined,\n            occlusionQuerySet: ((_b = this._occlusionQuery) === null || _b === void 0 ? void 0 : _b.hasQueries) ? this._occlusionQuery.querySet : undefined,\n        };\n        this._rttRenderPassWrapper.renderPass = this._renderTargetEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                const internalTexture = rtWrapper.texture;\n                console.log(\"frame #\" + this._count + \" - render target begin pass - internalTexture.uniqueId=\", internalTexture.uniqueId, \"width=\", internalTexture.width, \"height=\", internalTexture.height, this._rttRenderPassWrapper.renderPassDescriptor);\n            }\n        }\n        this._currentRenderPass = this._rttRenderPassWrapper.renderPass;\n        (_c = this._debugFlushPendingCommands) === null || _c === void 0 ? void 0 : _c.call(this);\n        this._resetCurrentViewport(1);\n        this._resetCurrentScissor(1);\n        this._resetCurrentStencilRef(1);\n        this._resetCurrentColorBlend(1);\n        if (!gpuDepthStencilWrapper || !WebGPUTextureHelper.HasStencilAspect(gpuDepthStencilWrapper.format)) {\n            this._stencilStateComposer.enabled = false;\n        }\n    }\n    /** @internal */\n    _endRenderTargetRenderPass() {\n        var _a, _b, _c, _d;\n        if (this._currentRenderPass) {\n            const gpuWrapper = (_a = this._currentRenderTarget.texture) === null || _a === void 0 ? void 0 : _a._hardwareTexture;\n            if (gpuWrapper && !this._snapshotRendering.endRenderTargetPass(this._currentRenderPass, gpuWrapper) && !this.compatibilityMode) {\n                this._bundleListRenderTarget.run(this._currentRenderPass);\n                this._bundleListRenderTarget.reset();\n            }\n            this._currentRenderPass.end();\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                }\n                if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                    console.log(\"frame #\" + this._count + \" - render target end pass - internalTexture.uniqueId=\", (_c = (_b = this._currentRenderTarget) === null || _b === void 0 ? void 0 : _b.texture) === null || _c === void 0 ? void 0 : _c.uniqueId);\n                }\n            }\n            (_d = this._debugPopGroup) === null || _d === void 0 ? void 0 : _d.call(this, 1);\n            this._resetCurrentViewport(1);\n            this._resetCurrentScissor(1);\n            this._resetCurrentStencilRef(1);\n            this._resetCurrentColorBlend(1);\n            this._currentRenderPass = null;\n            this._rttRenderPassWrapper.reset();\n        }\n    }\n    _getCurrentRenderPass() {\n        if (this._currentRenderTarget && !this._currentRenderPass) {\n            // delayed creation of the render target pass, but we now need to create it as we are requested the render pass\n            this._startRenderTargetRenderPass(this._currentRenderTarget, false, null, false, false);\n        }\n        else if (!this._currentRenderPass) {\n            this._startMainRenderPass(false);\n        }\n        return this._currentRenderPass;\n    }\n    /** @internal */\n    _getCurrentRenderPassIndex() {\n        return this._currentRenderPass === null ? -1 : this._currentRenderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\n    }\n    _startMainRenderPass(setClearStates, clearColor, clearDepth, clearStencil) {\n        var _a, _b, _c;\n        if (this._mainRenderPassWrapper.renderPass) {\n            this.flushFramebuffer(false);\n        }\n        if (this.useReverseDepthBuffer) {\n            this.setDepthFunctionToGreaterOrEqual();\n        }\n        const mustClearColor = setClearStates && clearColor;\n        const mustClearDepth = setClearStates && clearDepth;\n        const mustClearStencil = setClearStates && clearStencil;\n        this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].clearValue = mustClearColor ? clearColor : undefined;\n        this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].loadOp = mustClearColor ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthClearValue = mustClearDepth\n            ? this.useReverseDepthBuffer\n                ? this._clearReverseDepthValue\n                : this._clearDepthValue\n            : undefined;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthLoadOp = mustClearDepth ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilClearValue = mustClearStencil ? this._clearStencilValue : undefined;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilLoadOp = !this.isStencilEnable\n            ? undefined\n            : mustClearStencil\n                ? WebGPUConstants.LoadOp.Clear\n                : WebGPUConstants.LoadOp.Load;\n        this._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet = ((_a = this._occlusionQuery) === null || _a === void 0 ? void 0 : _a.hasQueries) ? this._occlusionQuery.querySet : undefined;\n        const swapChainTexture = this._context.getCurrentTexture();\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].set(swapChainTexture);\n        // Resolve in case of MSAA\n        if (this._options.antialias) {\n            this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].resolveTarget = swapChainTexture.createView();\n        }\n        else {\n            this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].view = swapChainTexture.createView();\n        }\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - main begin pass - texture width=\" + this._mainTextureExtends.width, \" height=\" + this._mainTextureExtends.height, this._mainRenderPassWrapper.renderPassDescriptor);\n            }\n        }\n        (_b = this._debugPushGroup) === null || _b === void 0 ? void 0 : _b.call(this, \"main pass\", 0);\n        this._currentRenderPass = this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor);\n        this._mainRenderPassWrapper.renderPass = this._currentRenderPass;\n        (_c = this._debugFlushPendingCommands) === null || _c === void 0 ? void 0 : _c.call(this);\n        this._resetCurrentViewport(0);\n        this._resetCurrentScissor(0);\n        this._resetCurrentStencilRef(0);\n        this._resetCurrentColorBlend(0);\n        if (!this._isStencilEnable) {\n            this._stencilStateComposer.enabled = false;\n        }\n    }\n    _endMainRenderPass() {\n        var _a;\n        if (this._mainRenderPassWrapper.renderPass !== null) {\n            this._snapshotRendering.endMainRenderPass();\n            if (!this.compatibilityMode && !this._snapshotRendering.play) {\n                this._bundleList.run(this._mainRenderPassWrapper.renderPass);\n                this._bundleList.reset();\n            }\n            this._mainRenderPassWrapper.renderPass.end();\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                }\n                if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                    console.log(\"frame #\" + this._count + \" - main end pass\");\n                }\n            }\n            (_a = this._debugPopGroup) === null || _a === void 0 ? void 0 : _a.call(this, 0);\n            this._resetCurrentViewport(0);\n            this._resetCurrentScissor(0);\n            this._resetCurrentStencilRef(0);\n            this._resetCurrentColorBlend(0);\n            if (this._mainRenderPassWrapper.renderPass === this._currentRenderPass) {\n                this._currentRenderPass = null;\n            }\n            this._mainRenderPassWrapper.reset(false);\n        }\n    }\n    /**\n     * Binds the frame buffer to the specified texture.\n     * @param texture The render target wrapper to render to\n     * @param faceIndex The face of the texture to render to in case of cube texture\n     * @param requiredWidth The width of the target to render to\n     * @param requiredHeight The height of the target to render to\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\n     * @param lodLevel defines the lod level to bind to the frame buffer\n     * @param layer defines the 2d array index to bind to frame buffer to\n     */\n    bindFramebuffer(texture, faceIndex = 0, requiredWidth, requiredHeight, forceFullscreenViewport, lodLevel = 0, layer = 0) {\n        var _a, _b;\n        const hardwareTexture = (_a = texture.texture) === null || _a === void 0 ? void 0 : _a._hardwareTexture;\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        this._currentRenderTarget = texture;\n        if (hardwareTexture) {\n            hardwareTexture._currentLayer = texture.isCube ? layer * 6 + faceIndex : layer;\n        }\n        this._rttRenderPassWrapper.colorAttachmentGPUTextures[0] = hardwareTexture;\n        this._rttRenderPassWrapper.depthTextureFormat = this._currentRenderTarget._depthStencilTexture\n            ? WebGPUTextureHelper.GetWebGPUTextureFormat(-1, this._currentRenderTarget._depthStencilTexture.format)\n            : undefined;\n        this._setDepthTextureFormat(this._rttRenderPassWrapper);\n        this._setColorFormat(this._rttRenderPassWrapper);\n        this._rttRenderPassWrapper.colorAttachmentViewDescriptor = {\n            format: this._colorFormat,\n            dimension: WebGPUConstants.TextureViewDimension.E2d,\n            mipLevelCount: 1,\n            baseArrayLayer: texture.isCube ? layer * 6 + faceIndex : layer,\n            baseMipLevel: lodLevel,\n            arrayLayerCount: 1,\n            aspect: WebGPUConstants.TextureAspect.All,\n        };\n        this._rttRenderPassWrapper.depthAttachmentViewDescriptor = {\n            format: this._depthTextureFormat,\n            dimension: WebGPUConstants.TextureViewDimension.E2d,\n            mipLevelCount: 1,\n            baseArrayLayer: texture.isCube ? layer * 6 + faceIndex : layer,\n            baseMipLevel: 0,\n            arrayLayerCount: 1,\n            aspect: WebGPUConstants.TextureAspect.All,\n        };\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - bindFramebuffer called - internalTexture.uniqueId=\", (_b = texture.texture) === null || _b === void 0 ? void 0 : _b.uniqueId, \"face=\", faceIndex, \"lodLevel=\", lodLevel, \"layer=\", layer, this._rttRenderPassWrapper.colorAttachmentViewDescriptor, this._rttRenderPassWrapper.depthAttachmentViewDescriptor);\n            }\n        }\n        this._currentRenderPass = null; // lazy creation of the render pass, hoping the render pass will be created by a call to clear()...\n        if (this.snapshotRendering && this.snapshotRenderingMode === 1) {\n            // force the creation of the render pass as we know in fast snapshot rendering mode clear() won't be called\n            this._getCurrentRenderPass();\n        }\n        if (this._cachedViewport && !forceFullscreenViewport) {\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\n        }\n        else {\n            if (!requiredWidth) {\n                requiredWidth = texture.width;\n                if (lodLevel) {\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\n                }\n            }\n            if (!requiredHeight) {\n                requiredHeight = texture.height;\n                if (lodLevel) {\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\n                }\n            }\n            this._viewport(0, 0, requiredWidth, requiredHeight);\n        }\n        this.wipeCaches();\n    }\n    /**\n     * Unbind the current render target texture from the WebGPU context\n     * @param texture defines the render target wrapper to unbind\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\n     */\n    unBindFramebuffer(texture, disableGenerateMipMaps = false, onBeforeUnbind) {\n        var _a, _b;\n        const saveCRT = this._currentRenderTarget;\n        this._currentRenderTarget = null; // to be iso with thinEngine, this._currentRenderTarget must be null when onBeforeUnbind is called\n        if (onBeforeUnbind) {\n            onBeforeUnbind();\n        }\n        this._currentRenderTarget = saveCRT;\n        if (this._currentRenderPass && this._currentRenderPass !== this._mainRenderPassWrapper.renderPass) {\n            this._endRenderTargetRenderPass();\n        }\n        if (((_a = texture.texture) === null || _a === void 0 ? void 0 : _a.generateMipMaps) && !disableGenerateMipMaps && !texture.isCube) {\n            this._generateMipmaps(texture.texture);\n        }\n        this._currentRenderTarget = null;\n        this._onAfterUnbindFrameBufferObservable.notifyObservers(this);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                console.log(\"frame #\" + this._count + \" - unBindFramebuffer called - internalTexture.uniqueId=\", (_b = texture.texture) === null || _b === void 0 ? void 0 : _b.uniqueId);\n            }\n        }\n        this._mrtAttachments = [];\n        this._cacheRenderPipeline.setMRT([]);\n        this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments);\n        this._currentRenderPass = this._mainRenderPassWrapper.renderPass;\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\n        this._setColorFormat(this._mainRenderPassWrapper);\n    }\n    /**\n     * Unbind the current render target and bind the default framebuffer\n     */\n    restoreDefaultFramebuffer() {\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        else {\n            this._currentRenderPass = this._mainRenderPassWrapper.renderPass;\n            this._setDepthTextureFormat(this._mainRenderPassWrapper);\n            this._setColorFormat(this._mainRenderPassWrapper);\n        }\n        if (this._currentRenderPass) {\n            if (this._cachedViewport) {\n                this.setViewport(this._cachedViewport);\n            }\n        }\n        this.wipeCaches();\n    }\n    //------------------------------------------------------------------------------\n    //                              Render\n    //------------------------------------------------------------------------------\n    /**\n     * @internal\n     */\n    _setColorFormat(wrapper) {\n        var _a, _b;\n        const format = (_b = (_a = wrapper.colorAttachmentGPUTextures[0]) === null || _a === void 0 ? void 0 : _a.format) !== null && _b !== void 0 ? _b : null;\n        this._cacheRenderPipeline.setColorFormat(format);\n        if (this._colorFormat === format) {\n            return;\n        }\n        this._colorFormat = format;\n    }\n    /**\n     * @internal\n     */\n    _setDepthTextureFormat(wrapper) {\n        this._cacheRenderPipeline.setDepthStencilFormat(wrapper.depthTextureFormat);\n        if (this._depthTextureFormat === wrapper.depthTextureFormat) {\n            return;\n        }\n        this._depthTextureFormat = wrapper.depthTextureFormat;\n    }\n    setDitheringState() {\n        // Does not exist in WebGPU\n    }\n    setRasterizerState() {\n        // Does not exist in WebGPU\n    }\n    /**\n     * Set various states to the webGL context\n     * @param culling defines culling state: true to enable culling, false to disable it\n     * @param zOffset defines the value to apply to zOffset (0 by default)\n     * @param force defines if states must be applied even if cache is up to date\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\n     * @param stencil stencil states to set\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\n     */\n    setState(culling, zOffset = 0, force, reverseSide = false, cullBackFaces, stencil, zOffsetUnits = 0) {\n        var _a, _b;\n        // Culling\n        if (this._depthCullingState.cull !== culling || force) {\n            this._depthCullingState.cull = culling;\n        }\n        // Cull face\n        const cullFace = ((_b = (_a = this.cullBackFaces) !== null && _a !== void 0 ? _a : cullBackFaces) !== null && _b !== void 0 ? _b : true) ? 1 : 2;\n        if (this._depthCullingState.cullFace !== cullFace || force) {\n            this._depthCullingState.cullFace = cullFace;\n        }\n        // Z offset\n        this.setZOffset(zOffset);\n        this.setZOffsetUnits(zOffsetUnits);\n        // Front face\n        const frontFace = reverseSide ? (this._currentRenderTarget ? 1 : 2) : this._currentRenderTarget ? 2 : 1;\n        if (this._depthCullingState.frontFace !== frontFace || force) {\n            this._depthCullingState.frontFace = frontFace;\n        }\n        this._stencilStateComposer.stencilMaterial = stencil;\n    }\n    _applyRenderPassChanges(renderPass, bundleList) {\n        var _a;\n        const mustUpdateViewport = this._mustUpdateViewport(renderPass);\n        const mustUpdateScissor = this._mustUpdateScissor(renderPass);\n        const mustUpdateStencilRef = !this._stencilStateComposer.enabled ? false : this._mustUpdateStencilRef(renderPass);\n        const mustUpdateBlendColor = !this._alphaState.alphaBlend ? false : this._mustUpdateBlendColor(renderPass);\n        if (bundleList) {\n            if (mustUpdateViewport) {\n                bundleList.addItem(new WebGPURenderItemViewport(this._viewportCached.x, this._viewportCached.y, this._viewportCached.z, this._viewportCached.w));\n            }\n            if (mustUpdateScissor) {\n                bundleList.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\n            }\n            if (mustUpdateStencilRef) {\n                bundleList.addItem(new WebGPURenderItemStencilRef((_a = this._stencilStateComposer.funcRef) !== null && _a !== void 0 ? _a : 0));\n            }\n            if (mustUpdateBlendColor) {\n                bundleList.addItem(new WebGPURenderItemBlendColor(this._alphaState._blendConstants.slice()));\n            }\n        }\n        else {\n            if (mustUpdateViewport) {\n                this._applyViewport(renderPass);\n            }\n            if (mustUpdateScissor) {\n                this._applyScissor(renderPass);\n            }\n            if (mustUpdateStencilRef) {\n                this._applyStencilRef(renderPass);\n            }\n            if (mustUpdateBlendColor) {\n                this._applyBlendColor(renderPass);\n            }\n        }\n    }\n    _draw(drawType, fillMode, start, count, instancesCount) {\n        var _a;\n        const renderPass = this._getCurrentRenderPass();\n        const renderPassIndex = this._getCurrentRenderPassIndex();\n        const bundleList = renderPassIndex === 0 ? this._bundleList : this._bundleListRenderTarget;\n        this.applyStates();\n        const webgpuPipelineContext = this._currentEffect._pipelineContext;\n        this.bindUniformBufferBase(this._currentRenderTarget ? this._ubInvertY : this._ubDontInvertY, 0, WebGPUShaderProcessor.InternalsUBOName);\n        if (webgpuPipelineContext.uniformBuffer) {\n            webgpuPipelineContext.uniformBuffer.update();\n            this.bindUniformBufferBase(webgpuPipelineContext.uniformBuffer.getBuffer(), 0, WebGPUShaderProcessor.LeftOvertUBOName);\n        }\n        if (this._snapshotRendering.play) {\n            this._reportDrawCall();\n            return;\n        }\n        if (!this.compatibilityMode &&\n            (this._currentDrawContext.isDirty(this._currentMaterialContext.updateId) || this._currentMaterialContext.isDirty || this._currentMaterialContext.forceBindGroupCreation)) {\n            this._currentDrawContext.fastBundle = undefined;\n        }\n        const useFastPath = !this.compatibilityMode && this._currentDrawContext.fastBundle;\n        let renderPass2 = renderPass;\n        if (useFastPath || this._snapshotRendering.record) {\n            this._applyRenderPassChanges(renderPass, bundleList);\n            if (!this._snapshotRendering.record) {\n                this._counters.numBundleReuseNonCompatMode++;\n                if (this._currentDrawContext.indirectDrawBuffer) {\n                    this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\n                }\n                bundleList.addBundle(this._currentDrawContext.fastBundle);\n                this._reportDrawCall();\n                return;\n            }\n            renderPass2 = bundleList.getBundleEncoder(this._cacheRenderPipeline.colorFormats, this._depthTextureFormat, this.currentSampleCount); // for snapshot recording mode\n            bundleList.numDrawCalls++;\n        }\n        let textureState = 0;\n        if (!this._caps.textureFloatLinearFiltering && this._currentMaterialContext.hasFloatTextures) {\n            let bitVal = 1;\n            for (let i = 0; i < webgpuPipelineContext.shaderProcessingContext.textureNames.length; ++i) {\n                const textureName = webgpuPipelineContext.shaderProcessingContext.textureNames[i];\n                const texture = (_a = this._currentMaterialContext.textures[textureName]) === null || _a === void 0 ? void 0 : _a.texture;\n                if ((texture === null || texture === void 0 ? void 0 : texture.type) === 1) {\n                    textureState |= bitVal;\n                }\n                bitVal = bitVal << 1;\n            }\n        }\n        const pipeline = this._cacheRenderPipeline.getRenderPipeline(fillMode, this._currentEffect, this.currentSampleCount, textureState);\n        const bindGroups = this._cacheBindGroups.getBindGroups(webgpuPipelineContext, this._currentDrawContext, this._currentMaterialContext);\n        if (!this._snapshotRendering.record) {\n            this._applyRenderPassChanges(renderPass, !this.compatibilityMode ? bundleList : null);\n            if (!this.compatibilityMode) {\n                this._counters.numBundleCreationNonCompatMode++;\n                renderPass2 = this._device.createRenderBundleEncoder({\n                    colorFormats: this._cacheRenderPipeline.colorFormats,\n                    depthStencilFormat: this._depthTextureFormat,\n                    sampleCount: this.currentSampleCount,\n                });\n            }\n        }\n        // bind pipeline\n        renderPass2.setPipeline(pipeline);\n        // bind index/vertex buffers\n        if (this._currentIndexBuffer) {\n            renderPass2.setIndexBuffer(this._currentIndexBuffer.underlyingResource, this._currentIndexBuffer.is32Bits ? WebGPUConstants.IndexFormat.Uint32 : WebGPUConstants.IndexFormat.Uint16, 0);\n        }\n        const vertexBuffers = this._cacheRenderPipeline.vertexBuffers;\n        for (let index = 0; index < vertexBuffers.length; index++) {\n            const vertexBuffer = vertexBuffers[index];\n            const buffer = vertexBuffer.getBuffer();\n            if (buffer) {\n                renderPass2.setVertexBuffer(index, buffer.underlyingResource, vertexBuffer._validOffsetRange ? 0 : vertexBuffer.byteOffset);\n            }\n        }\n        // bind bind groups\n        for (let i = 0; i < bindGroups.length; i++) {\n            renderPass2.setBindGroup(i, bindGroups[i]);\n        }\n        // draw\n        const nonCompatMode = !this.compatibilityMode && !this._snapshotRendering.record;\n        if (nonCompatMode && this._currentDrawContext.indirectDrawBuffer) {\n            this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\n            if (drawType === 0) {\n                renderPass2.drawIndexedIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\n            }\n            else {\n                renderPass2.drawIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\n            }\n        }\n        else if (drawType === 0) {\n            renderPass2.drawIndexed(count, instancesCount || 1, start, 0, 0);\n        }\n        else {\n            renderPass2.draw(count, instancesCount || 1, start, 0);\n        }\n        if (nonCompatMode) {\n            this._currentDrawContext.fastBundle = renderPass2.finish();\n            bundleList.addBundle(this._currentDrawContext.fastBundle);\n        }\n        this._reportDrawCall();\n    }\n    /**\n     * Draw a list of indexed primitives\n     * @param fillMode defines the primitive to use\n     * @param indexStart defines the starting index\n     * @param indexCount defines the number of index to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawElementsType(fillMode, indexStart, indexCount, instancesCount = 1) {\n        this._draw(0, fillMode, indexStart, indexCount, instancesCount);\n    }\n    /**\n     * Draw a list of unindexed primitives\n     * @param fillMode defines the primitive to use\n     * @param verticesStart defines the index of first vertex to draw\n     * @param verticesCount defines the count of vertices to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawArraysType(fillMode, verticesStart, verticesCount, instancesCount = 1) {\n        this._currentIndexBuffer = null;\n        this._draw(1, fillMode, verticesStart, verticesCount, instancesCount);\n    }\n    //------------------------------------------------------------------------------\n    //                              Dispose\n    //------------------------------------------------------------------------------\n    /**\n     * Dispose and release all associated resources\n     */\n    dispose() {\n        var _a, _b;\n        (_a = this._mainTexture) === null || _a === void 0 ? void 0 : _a.destroy();\n        (_b = this._depthTexture) === null || _b === void 0 ? void 0 : _b.destroy();\n        super.dispose();\n    }\n    //------------------------------------------------------------------------------\n    //                              Misc\n    //------------------------------------------------------------------------------\n    /**\n     * Gets the current render width\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render width\n     */\n    getRenderWidth(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.width;\n        }\n        return this._canvas.width;\n    }\n    /**\n     * Gets the current render height\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render height\n     */\n    getRenderHeight(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.height;\n        }\n        return this._canvas.height;\n    }\n    /**\n     * Gets the HTML canvas attached with the current WebGPU context\n     * @returns a HTML canvas\n     */\n    getRenderingCanvas() {\n        return this._canvas;\n    }\n    //------------------------------------------------------------------------------\n    //                              Errors\n    //------------------------------------------------------------------------------\n    /**\n     * Get the current error code of the WebGPU context\n     * @returns the error code\n     */\n    getError() {\n        // TODO WEBGPU. from the webgpu errors.\n        return 0;\n    }\n    //------------------------------------------------------------------------------\n    //                              Unused WebGPU\n    //------------------------------------------------------------------------------\n    /**\n     * @internal\n     */\n    bindSamplers() { }\n    /**\n     * @internal\n     */\n    _bindTextureDirectly() {\n        return false;\n    }\n    /**\n     * Gets a boolean indicating if all created effects are ready\n     * @returns always true - No parallel shader compilation\n     */\n    areAllEffectsReady() {\n        return true;\n    }\n    /**\n     * @internal\n     */\n    _executeWhenRenderingStateIsCompiled(pipelineContext, action) {\n        // No parallel shader compilation.\n        // No Async, so direct launch\n        action();\n    }\n    /**\n     * @internal\n     */\n    _isRenderingStateCompiled() {\n        // No parallel shader compilation.\n        return true;\n    }\n    /** @internal */\n    _getUnpackAlignement() {\n        return 1;\n    }\n    /**\n     * @internal\n     */\n    _unpackFlipY() { }\n    /**\n     * @internal\n     */\n    _bindUnboundFramebuffer() {\n        throw \"_bindUnboundFramebuffer is not implementedin WebGPU! You probably want to use restoreDefaultFramebuffer or unBindFramebuffer instead\";\n    }\n    // TODO WEBGPU. All of the below should go once engine split with baseEngine.\n    /**\n     * @internal\n     */\n    _getSamplingParameters() {\n        throw \"_getSamplingParameters is not available in WebGPU\";\n    }\n    /**\n     * @internal\n     */\n    getUniforms() {\n        return [];\n    }\n    /**\n     * @internal\n     */\n    setIntArray() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setIntArray2() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setIntArray3() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setIntArray4() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setArray() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setArray2() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setArray3() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setArray4() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setMatrices() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setMatrix3x3() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setMatrix2x2() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setFloat() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setFloat2() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setFloat3() {\n        return false;\n    }\n    /**\n     * @internal\n     */\n    setFloat4() {\n        return false;\n    }\n}\n// Default glslang options.\nWebGPUEngine._GLSLslangDefaultOptions = {\n    jsPath: \"https://preview.babylonjs.com/glslang/glslang.js\",\n    wasmPath: \"https://preview.babylonjs.com/glslang/glslang.wasm\",\n};\n/** true to enable using TintWASM to convert Spir-V to WGSL */\nWebGPUEngine.UseTWGSL = true;\n//# sourceMappingURL=webgpuEngine.js.map","/**\n * Gather the list of clipboard event types as constants.\n */\nexport class ClipboardEventTypes {\n}\n/**\n * The clipboard event is fired when a copy command is active (pressed).\n */\nClipboardEventTypes.COPY = 0x01; //\n/**\n *  The clipboard event is fired when a cut command is active (pressed).\n */\nClipboardEventTypes.CUT = 0x02;\n/**\n * The clipboard event is fired when a paste command is active (pressed).\n */\nClipboardEventTypes.PASTE = 0x03;\n/**\n * This class is used to store clipboard related info for the onClipboardObservable event.\n */\nexport class ClipboardInfo {\n    /**\n     *Creates an instance of ClipboardInfo.\n     * @param type Defines the type of event (BABYLON.ClipboardEventTypes)\n     * @param event Defines the related dom event\n     */\n    constructor(\n    /**\n     * Defines the type of event (BABYLON.ClipboardEventTypes)\n     */\n    type, \n    /**\n     * Defines the related dom event\n     */\n    event) {\n        this.type = type;\n        this.event = event;\n    }\n    /**\n     *  Get the clipboard event's type from the keycode.\n     * @param keyCode Defines the keyCode for the current keyboard event.\n     * @returns {number}\n     */\n    static GetTypeFromCharacter(keyCode) {\n        const charCode = keyCode;\n        //TODO: add codes for extended ASCII\n        switch (charCode) {\n            case 67:\n                return ClipboardEventTypes.COPY;\n            case 86:\n                return ClipboardEventTypes.PASTE;\n            case 88:\n                return ClipboardEventTypes.CUT;\n            default:\n                return -1;\n        }\n    }\n}\n//# sourceMappingURL=clipboardEvents.js.map","/**\n * Event Types\n */\nexport var DeviceInputEventType;\n(function (DeviceInputEventType) {\n    // Pointers\n    /** PointerMove */\n    DeviceInputEventType[DeviceInputEventType[\"PointerMove\"] = 0] = \"PointerMove\";\n    /** PointerDown */\n    DeviceInputEventType[DeviceInputEventType[\"PointerDown\"] = 1] = \"PointerDown\";\n    /** PointerUp */\n    DeviceInputEventType[DeviceInputEventType[\"PointerUp\"] = 2] = \"PointerUp\";\n})(DeviceInputEventType || (DeviceInputEventType = {}));\n/**\n * Constants used for Events\n */\nexport class EventConstants {\n}\n/**\n * Pixel delta for Wheel Events (Default)\n */\nEventConstants.DOM_DELTA_PIXEL = 0x00;\n/**\n * Line delta for Wheel Events\n */\nEventConstants.DOM_DELTA_LINE = 0x01;\n/**\n * Page delta for Wheel Events\n */\nEventConstants.DOM_DELTA_PAGE = 0x02;\n//# sourceMappingURL=deviceInputEvents.js.map","/**\n * Gather the list of keyboard event types as constants.\n */\nexport class KeyboardEventTypes {\n}\n/**\n * The keydown event is fired when a key becomes active (pressed).\n */\nKeyboardEventTypes.KEYDOWN = 0x01;\n/**\n * The keyup event is fired when a key has been released.\n */\nKeyboardEventTypes.KEYUP = 0x02;\n/**\n * This class is used to store keyboard related info for the onKeyboardObservable event.\n */\nexport class KeyboardInfo {\n    /**\n     * Instantiates a new keyboard info.\n     * This class is used to store keyboard related info for the onKeyboardObservable event.\n     * @param type Defines the type of event (KeyboardEventTypes)\n     * @param event Defines the related dom event\n     */\n    constructor(\n    /**\n     * Defines the type of event (KeyboardEventTypes)\n     */\n    type, \n    /**\n     * Defines the related dom event\n     */\n    event) {\n        this.type = type;\n        this.event = event;\n    }\n}\n/**\n * This class is used to store keyboard related info for the onPreKeyboardObservable event.\n * Set the skipOnKeyboardObservable property to true if you want the engine to stop any process after this event is triggered, even not calling onKeyboardObservable\n */\nexport class KeyboardInfoPre extends KeyboardInfo {\n    /**\n     * Defines whether the engine should skip the next onKeyboardObservable associated to this pre.\n     * @deprecated use skipOnKeyboardObservable property instead\n     */\n    get skipOnPointerObservable() {\n        return this.skipOnKeyboardObservable;\n    }\n    set skipOnPointerObservable(value) {\n        this.skipOnKeyboardObservable = value;\n    }\n    /**\n     * Instantiates a new keyboard pre info.\n     * This class is used to store keyboard related info for the onPreKeyboardObservable event.\n     * @param type Defines the type of event (KeyboardEventTypes)\n     * @param event Defines the related dom event\n     */\n    constructor(\n    /**\n     * Defines the type of event (KeyboardEventTypes)\n     */\n    type, \n    /**\n     * Defines the related dom event\n     */\n    event) {\n        super(type, event);\n        this.type = type;\n        this.event = event;\n        this.skipOnKeyboardObservable = false;\n    }\n}\n//# sourceMappingURL=keyboardEvents.js.map","import { Vector2 } from \"../Maths/math.vector.js\";\n/**\n * Gather the list of pointer event types as constants.\n */\nexport class PointerEventTypes {\n}\n/**\n * The pointerdown event is fired when a pointer becomes active. For mouse, it is fired when the device transitions from no buttons depressed to at least one button depressed. For touch, it is fired when physical contact is made with the digitizer. For pen, it is fired when the stylus makes physical contact with the digitizer.\n */\nPointerEventTypes.POINTERDOWN = 0x01;\n/**\n * The pointerup event is fired when a pointer is no longer active.\n */\nPointerEventTypes.POINTERUP = 0x02;\n/**\n * The pointermove event is fired when a pointer changes coordinates.\n */\nPointerEventTypes.POINTERMOVE = 0x04;\n/**\n * The pointerwheel event is fired when a mouse wheel has been rotated.\n */\nPointerEventTypes.POINTERWHEEL = 0x08;\n/**\n * The pointerpick event is fired when a mesh or sprite has been picked by the pointer.\n */\nPointerEventTypes.POINTERPICK = 0x10;\n/**\n * The pointertap event is fired when a the object has been touched and released without drag.\n */\nPointerEventTypes.POINTERTAP = 0x20;\n/**\n * The pointerdoubletap event is fired when a the object has been touched and released twice without drag.\n */\nPointerEventTypes.POINTERDOUBLETAP = 0x40;\n/**\n * Base class of pointer info types.\n */\nexport class PointerInfoBase {\n    /**\n     * Instantiates the base class of pointers info.\n     * @param type Defines the type of event (PointerEventTypes)\n     * @param event Defines the related dom event\n     */\n    constructor(\n    /**\n     * Defines the type of event (PointerEventTypes)\n     */\n    type, \n    /**\n     * Defines the related dom event\n     */\n    event) {\n        this.type = type;\n        this.event = event;\n    }\n}\n/**\n * This class is used to store pointer related info for the onPrePointerObservable event.\n * Set the skipOnPointerObservable property to true if you want the engine to stop any process after this event is triggered, even not calling onPointerObservable\n */\nexport class PointerInfoPre extends PointerInfoBase {\n    /**\n     * Instantiates a PointerInfoPre to store pointer related info to the onPrePointerObservable event.\n     * @param type Defines the type of event (PointerEventTypes)\n     * @param event Defines the related dom event\n     * @param localX Defines the local x coordinates of the pointer when the event occured\n     * @param localY Defines the local y coordinates of the pointer when the event occured\n     */\n    constructor(type, event, localX, localY) {\n        super(type, event);\n        /**\n         * Ray from a pointer if available (eg. 6dof controller)\n         */\n        this.ray = null;\n        /**\n         * The original picking info that was used to trigger the pointer event\n         */\n        this.originalPickingInfo = null;\n        this.skipOnPointerObservable = false;\n        this.localPosition = new Vector2(localX, localY);\n    }\n}\n/**\n * This type contains all the data related to a pointer event in Babylon.js.\n * The event member is an instance of PointerEvent for all types except PointerWheel and is of type MouseWheelEvent when type equals PointerWheel. The different event types can be found in the PointerEventTypes class.\n */\nexport class PointerInfo extends PointerInfoBase {\n    /**\n     * Defines the picking info associated with this PointerInfo object (if applicable)\n     */\n    get pickInfo() {\n        if (!this._pickInfo) {\n            this._generatePickInfo();\n        }\n        return this._pickInfo;\n    }\n    /**\n     * Instantiates a PointerInfo to store pointer related info to the onPointerObservable event.\n     * @param type Defines the type of event (PointerEventTypes)\n     * @param event Defines the related dom event\n     * @param pickInfo Defines the picking info associated to the info (if any)\n     * @param inputManager Defines the InputManager to use if there is no pickInfo\n     */\n    constructor(type, event, pickInfo, inputManager = null) {\n        super(type, event);\n        this._pickInfo = pickInfo;\n        this._inputManager = inputManager;\n    }\n    /**\n     * Generates the picking info if needed\n     */\n    /** @internal */\n    _generatePickInfo() {\n        if (this._inputManager) {\n            this._pickInfo = this._inputManager._pickMove(this.event);\n            this._inputManager._setRayOnPointerInfo(this._pickInfo, this.event);\n            this._inputManager = null;\n        }\n    }\n}\n//# sourceMappingURL=pointerEvents.js.map","import { Observable } from \"../../Misc/observable.js\";\nimport { Quaternion, Matrix, Vector3, TmpVectors } from \"../../Maths/math.vector.js\";\nimport { Ray } from \"../../Culling/ray.js\";\nimport { EngineStore } from \"../../Engines/engineStore.js\";\nimport { Gamepad } from \"../../Gamepads/gamepad.js\";\n/**\n * Defines the types of pose enabled controllers that are supported\n */\nexport var PoseEnabledControllerType;\n(function (PoseEnabledControllerType) {\n    /**\n     * HTC Vive\n     */\n    PoseEnabledControllerType[PoseEnabledControllerType[\"VIVE\"] = 0] = \"VIVE\";\n    /**\n     * Oculus Rift\n     */\n    PoseEnabledControllerType[PoseEnabledControllerType[\"OCULUS\"] = 1] = \"OCULUS\";\n    /**\n     * Windows mixed reality\n     */\n    PoseEnabledControllerType[PoseEnabledControllerType[\"WINDOWS\"] = 2] = \"WINDOWS\";\n    /**\n     * Samsung gear VR\n     */\n    PoseEnabledControllerType[PoseEnabledControllerType[\"GEAR_VR\"] = 3] = \"GEAR_VR\";\n    /**\n     * Google Daydream\n     */\n    PoseEnabledControllerType[PoseEnabledControllerType[\"DAYDREAM\"] = 4] = \"DAYDREAM\";\n    /**\n     * Generic\n     */\n    PoseEnabledControllerType[PoseEnabledControllerType[\"GENERIC\"] = 5] = \"GENERIC\";\n})(PoseEnabledControllerType || (PoseEnabledControllerType = {}));\n/**\n * Defines the PoseEnabledControllerHelper object that is used initialize a gamepad as the controller type it is specified as (eg. windows mixed reality controller)\n */\nexport class PoseEnabledControllerHelper {\n    /**\n     * Initializes a gamepad as the controller type it is specified as (eg. windows mixed reality controller)\n     * @param vrGamepad the gamepad to initialized\n     * @returns a vr controller of the type the gamepad identified as\n     */\n    static InitiateController(vrGamepad) {\n        for (const factory of this._ControllerFactories) {\n            if (factory.canCreate(vrGamepad)) {\n                return factory.create(vrGamepad);\n            }\n        }\n        if (this._DefaultControllerFactory) {\n            return this._DefaultControllerFactory(vrGamepad);\n        }\n        throw \"The type of gamepad you are trying to load needs to be imported first or is not supported.\";\n    }\n}\n/** @internal */\nPoseEnabledControllerHelper._ControllerFactories = [];\n/** @internal */\nPoseEnabledControllerHelper._DefaultControllerFactory = null;\n/**\n * Defines the PoseEnabledController object that contains state of a vr capable controller\n */\nexport class PoseEnabledController extends Gamepad {\n    /**\n     * @internal\n     */\n    _disableTrackPosition(fixedPosition) {\n        if (this._trackPosition) {\n            this._calculatedPosition.copyFrom(fixedPosition);\n            this._trackPosition = false;\n        }\n    }\n    /**\n     * Creates a new PoseEnabledController from a gamepad\n     * @param browserGamepad the gamepad that the PoseEnabledController should be created from\n     */\n    constructor(browserGamepad) {\n        super(browserGamepad.id, browserGamepad.index, browserGamepad);\n        /**\n         * If the controller is used in a webXR session\n         */\n        this.isXR = false;\n        // Represents device position and rotation in room space. Should only be used to help calculate babylon space values\n        this._deviceRoomPosition = Vector3.Zero();\n        this._deviceRoomRotationQuaternion = new Quaternion();\n        /**\n         * The device position in babylon space\n         */\n        this.devicePosition = Vector3.Zero();\n        /**\n         * The device rotation in babylon space\n         */\n        this.deviceRotationQuaternion = new Quaternion();\n        /**\n         * The scale factor of the device in babylon space\n         */\n        this.deviceScaleFactor = 1;\n        // Used to convert 6dof controllers to 3dof\n        this._trackPosition = true;\n        this._maxRotationDistFromHeadset = Math.PI / 5;\n        this._draggedRoomRotation = 0;\n        this._leftHandSystemQuaternion = new Quaternion();\n        /**\n         * Internal, matrix used to convert room space to babylon space\n         * @internal\n         */\n        this._deviceToWorld = Matrix.Identity();\n        /**\n         * Node to be used when casting a ray from the controller\n         * @internal\n         */\n        this._pointingPoseNode = null;\n        this._workingMatrix = Matrix.Identity();\n        /**\n         * @internal\n         */\n        this._meshAttachedObservable = new Observable();\n        this.type = Gamepad.POSE_ENABLED;\n        this.controllerType = PoseEnabledControllerType.GENERIC;\n        this.position = Vector3.Zero();\n        this.rotationQuaternion = new Quaternion();\n        this._calculatedPosition = Vector3.Zero();\n        this._calculatedRotation = new Quaternion();\n        Quaternion.RotationYawPitchRollToRef(Math.PI, 0, 0, this._leftHandSystemQuaternion);\n    }\n    /**\n     * Updates the state of the pose enabled controller and mesh based on the current position and rotation of the controller\n     */\n    update() {\n        super.update();\n        this._updatePoseAndMesh();\n    }\n    /**\n     * Updates only the pose device and mesh without doing any button event checking\n     */\n    _updatePoseAndMesh() {\n        if (this.isXR) {\n            return;\n        }\n        const pose = this.browserGamepad.pose;\n        this.updateFromDevice(pose);\n        if (!this._trackPosition &&\n            EngineStore.LastCreatedScene &&\n            EngineStore.LastCreatedScene.activeCamera &&\n            EngineStore.LastCreatedScene.activeCamera.devicePosition) {\n            const camera = EngineStore.LastCreatedScene.activeCamera;\n            camera._computeDevicePosition();\n            this._deviceToWorld.setTranslation(camera.devicePosition);\n            if (camera.deviceRotationQuaternion) {\n                camera._deviceRoomRotationQuaternion.toEulerAnglesToRef(TmpVectors.Vector3[0]);\n                // Find the radian distance away that the headset is from the controllers rotation\n                const distanceAway = Math.atan2(Math.sin(TmpVectors.Vector3[0].y - this._draggedRoomRotation), Math.cos(TmpVectors.Vector3[0].y - this._draggedRoomRotation));\n                if (Math.abs(distanceAway) > this._maxRotationDistFromHeadset) {\n                    // Only rotate enouph to be within the _maxRotationDistFromHeadset\n                    const rotationAmount = distanceAway - (distanceAway < 0 ? -this._maxRotationDistFromHeadset : this._maxRotationDistFromHeadset);\n                    this._draggedRoomRotation += rotationAmount;\n                    // Rotate controller around headset\n                    const sin = Math.sin(-rotationAmount);\n                    const cos = Math.cos(-rotationAmount);\n                    this._calculatedPosition.x = this._calculatedPosition.x * cos - this._calculatedPosition.z * sin;\n                    this._calculatedPosition.z = this._calculatedPosition.x * sin + this._calculatedPosition.z * cos;\n                }\n            }\n        }\n        Vector3.TransformCoordinatesToRef(this._calculatedPosition, this._deviceToWorld, this.devicePosition);\n        this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix);\n        Quaternion.FromRotationMatrixToRef(this._workingMatrix, this.deviceRotationQuaternion);\n        this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation);\n        if (this._mesh) {\n            this._mesh.position.copyFrom(this.devicePosition);\n            if (this._mesh.rotationQuaternion) {\n                this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion);\n            }\n        }\n    }\n    /**\n     * Updates the state of the pose enbaled controller based on the raw pose data from the device\n     * @param poseData raw pose fromthe device\n     */\n    updateFromDevice(poseData) {\n        if (this.isXR) {\n            return;\n        }\n        if (poseData) {\n            this.rawPose = poseData;\n            if (poseData.position) {\n                this._deviceRoomPosition.copyFromFloats(poseData.position[0], poseData.position[1], -poseData.position[2]);\n                if (this._mesh && this._mesh.getScene().useRightHandedSystem) {\n                    this._deviceRoomPosition.z *= -1;\n                }\n                if (this._trackPosition) {\n                    this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor, this._calculatedPosition);\n                }\n                this._calculatedPosition.addInPlace(this.position);\n            }\n            const pose = this.rawPose;\n            if (poseData.orientation && pose.orientation && pose.orientation.length === 4) {\n                this._deviceRoomRotationQuaternion.copyFromFloats(pose.orientation[0], pose.orientation[1], -pose.orientation[2], -pose.orientation[3]);\n                if (this._mesh) {\n                    if (this._mesh.getScene().useRightHandedSystem) {\n                        this._deviceRoomRotationQuaternion.z *= -1;\n                        this._deviceRoomRotationQuaternion.w *= -1;\n                    }\n                    else {\n                        this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion, this._deviceRoomRotationQuaternion);\n                    }\n                }\n                // if the camera is set, rotate to the camera's rotation\n                this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion, this._calculatedRotation);\n            }\n        }\n    }\n    /**\n     * Attaches a mesh to the controller\n     * @param mesh the mesh to be attached\n     */\n    attachToMesh(mesh) {\n        if (this._mesh) {\n            this._mesh.parent = null;\n        }\n        this._mesh = mesh;\n        if (this._poseControlledCamera) {\n            this._mesh.parent = this._poseControlledCamera;\n        }\n        if (!this._mesh.rotationQuaternion) {\n            this._mesh.rotationQuaternion = new Quaternion();\n        }\n        // Sync controller mesh and pointing pose node's state with controller, this is done to avoid a frame where position is 0,0,0 when attaching mesh\n        if (!this.isXR) {\n            this._updatePoseAndMesh();\n            if (this._pointingPoseNode) {\n                const parents = [];\n                let obj = this._pointingPoseNode;\n                while (obj.parent) {\n                    parents.push(obj.parent);\n                    obj = obj.parent;\n                }\n                parents.reverse().forEach((p) => {\n                    p.computeWorldMatrix(true);\n                });\n            }\n        }\n        this._meshAttachedObservable.notifyObservers(mesh);\n    }\n    /**\n     * Attaches the controllers mesh to a camera\n     * @param camera the camera the mesh should be attached to\n     */\n    attachToPoseControlledCamera(camera) {\n        this._poseControlledCamera = camera;\n        if (this._mesh) {\n            this._mesh.parent = this._poseControlledCamera;\n        }\n    }\n    /**\n     * Disposes of the controller\n     */\n    dispose() {\n        if (this._mesh) {\n            this._mesh.dispose();\n        }\n        this._mesh = null;\n        super.dispose();\n    }\n    /**\n     * The mesh that is attached to the controller\n     */\n    get mesh() {\n        return this._mesh;\n    }\n    /**\n     * Gets the ray of the controller in the direction the controller is pointing\n     * @param length the length the resulting ray should be\n     * @returns a ray in the direction the controller is pointing\n     */\n    getForwardRay(length = 100) {\n        if (!this.mesh) {\n            return new Ray(Vector3.Zero(), new Vector3(0, 0, 1), length);\n        }\n        const m = this._pointingPoseNode ? this._pointingPoseNode.getWorldMatrix() : this.mesh.getWorldMatrix();\n        const origin = m.getTranslation();\n        const forward = new Vector3(0, 0, -1);\n        const forwardWorld = Vector3.TransformNormal(forward, m);\n        const direction = Vector3.Normalize(forwardWorld);\n        return new Ray(origin, direction, length);\n    }\n}\n/**\n * Name of the child mesh that can be used to cast a ray from the controller\n */\nPoseEnabledController.POINTING_POSE = \"POINTING_POSE\";\n//# sourceMappingURL=poseEnabledController.js.map","import { Observable } from \"../../Misc/observable.js\";\nimport { PoseEnabledController } from \"./poseEnabledController.js\";\n/**\n * Defines the WebVRController object that represents controllers tracked in 3D space\n * @deprecated Use WebXR instead\n */\nexport class WebVRController extends PoseEnabledController {\n    /**\n     * Fired when a controller button's state has changed\n     * @param callback the callback containing the button that was modified\n     */\n    onButtonStateChange(callback) {\n        this._onButtonStateChange = callback;\n    }\n    /**\n     * The default controller model for the controller\n     */\n    get defaultModel() {\n        return this._defaultModel;\n    }\n    /**\n     * Creates a new WebVRController from a gamepad\n     * @param vrGamepad the gamepad that the WebVRController should be created from\n     */\n    constructor(vrGamepad) {\n        super(vrGamepad);\n        // Observables\n        /**\n         * Fired when the trigger state has changed\n         */\n        this.onTriggerStateChangedObservable = new Observable();\n        /**\n         * Fired when the main button state has changed\n         */\n        this.onMainButtonStateChangedObservable = new Observable();\n        /**\n         * Fired when the secondary button state has changed\n         */\n        this.onSecondaryButtonStateChangedObservable = new Observable();\n        /**\n         * Fired when the pad state has changed\n         */\n        this.onPadStateChangedObservable = new Observable();\n        /**\n         * Fired when controllers stick values have changed\n         */\n        this.onPadValuesChangedObservable = new Observable();\n        /**\n         * X and Y axis corresponding to the controllers joystick\n         */\n        this.pad = { x: 0, y: 0 };\n        // avoid GC, store state in a tmp object\n        this._changes = {\n            pressChanged: false,\n            touchChanged: false,\n            valueChanged: false,\n            changed: false,\n        };\n        this._buttons = new Array(vrGamepad.buttons.length);\n        this.hand = vrGamepad.hand;\n    }\n    /**\n     * Updates the state of the controller and mesh based on the current position and rotation of the controller\n     */\n    update() {\n        super.update();\n        for (let index = 0; index < this._buttons.length; index++) {\n            this._setButtonValue(this.browserGamepad.buttons[index], this._buttons[index], index);\n        }\n        if (this.leftStick.x !== this.pad.x || this.leftStick.y !== this.pad.y) {\n            this.pad.x = this.leftStick.x;\n            this.pad.y = this.leftStick.y;\n            this.onPadValuesChangedObservable.notifyObservers(this.pad);\n        }\n    }\n    _setButtonValue(newState, currentState, buttonIndex) {\n        if (!newState) {\n            newState = {\n                pressed: false,\n                touched: false,\n                value: 0,\n            };\n        }\n        if (!currentState) {\n            this._buttons[buttonIndex] = {\n                pressed: newState.pressed,\n                touched: newState.touched,\n                value: newState.value,\n            };\n            return;\n        }\n        this._checkChanges(newState, currentState);\n        if (this._changes.changed) {\n            this._onButtonStateChange && this._onButtonStateChange(this.index, buttonIndex, newState);\n            this._handleButtonChange(buttonIndex, newState, this._changes);\n        }\n        this._buttons[buttonIndex].pressed = newState.pressed;\n        this._buttons[buttonIndex].touched = newState.touched;\n        // oculus triggers are never 0, thou not touched.\n        this._buttons[buttonIndex].value = newState.value < 0.00000001 ? 0 : newState.value;\n    }\n    _checkChanges(newState, currentState) {\n        this._changes.pressChanged = newState.pressed !== currentState.pressed;\n        this._changes.touchChanged = newState.touched !== currentState.touched;\n        this._changes.valueChanged = newState.value !== currentState.value;\n        this._changes.changed = this._changes.pressChanged || this._changes.touchChanged || this._changes.valueChanged;\n        return this._changes;\n    }\n    /**\n     * Disposes of th webVRController\n     */\n    dispose() {\n        super.dispose();\n        this._defaultModel = null;\n        this.onTriggerStateChangedObservable.clear();\n        this.onMainButtonStateChangedObservable.clear();\n        this.onSecondaryButtonStateChangedObservable.clear();\n        this.onPadStateChangedObservable.clear();\n        this.onPadValuesChangedObservable.clear();\n    }\n}\n//# sourceMappingURL=webVRController.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { Gamepad } from \"./gamepad.js\";\n/**\n * Defines supported buttons for DualShock compatible gamepads\n */\nexport var DualShockButton;\n(function (DualShockButton) {\n    /** Cross */\n    DualShockButton[DualShockButton[\"Cross\"] = 0] = \"Cross\";\n    /** Circle */\n    DualShockButton[DualShockButton[\"Circle\"] = 1] = \"Circle\";\n    /** Square */\n    DualShockButton[DualShockButton[\"Square\"] = 2] = \"Square\";\n    /** Triangle */\n    DualShockButton[DualShockButton[\"Triangle\"] = 3] = \"Triangle\";\n    /** L1 */\n    DualShockButton[DualShockButton[\"L1\"] = 4] = \"L1\";\n    /** R1 */\n    DualShockButton[DualShockButton[\"R1\"] = 5] = \"R1\";\n    /** Share */\n    DualShockButton[DualShockButton[\"Share\"] = 8] = \"Share\";\n    /** Options */\n    DualShockButton[DualShockButton[\"Options\"] = 9] = \"Options\";\n    /** Left stick */\n    DualShockButton[DualShockButton[\"LeftStick\"] = 10] = \"LeftStick\";\n    /** Right stick */\n    DualShockButton[DualShockButton[\"RightStick\"] = 11] = \"RightStick\";\n})(DualShockButton || (DualShockButton = {}));\n/** Defines values for DualShock DPad  */\nexport var DualShockDpad;\n(function (DualShockDpad) {\n    /** Up */\n    DualShockDpad[DualShockDpad[\"Up\"] = 12] = \"Up\";\n    /** Down */\n    DualShockDpad[DualShockDpad[\"Down\"] = 13] = \"Down\";\n    /** Left */\n    DualShockDpad[DualShockDpad[\"Left\"] = 14] = \"Left\";\n    /** Right */\n    DualShockDpad[DualShockDpad[\"Right\"] = 15] = \"Right\";\n})(DualShockDpad || (DualShockDpad = {}));\n/**\n * Defines a DualShock gamepad\n */\nexport class DualShockPad extends Gamepad {\n    /**\n     * Creates a new DualShock gamepad object\n     * @param id defines the id of this gamepad\n     * @param index defines its index\n     * @param gamepad defines the internal HTML gamepad object\n     */\n    constructor(id, index, gamepad) {\n        super(id.replace(\"STANDARD GAMEPAD\", \"SONY PLAYSTATION DUALSHOCK\"), index, gamepad, 0, 1, 2, 3);\n        this._leftTrigger = 0;\n        this._rightTrigger = 0;\n        /** Observable raised when a button is pressed */\n        this.onButtonDownObservable = new Observable();\n        /** Observable raised when a button is released */\n        this.onButtonUpObservable = new Observable();\n        /** Observable raised when a pad is pressed */\n        this.onPadDownObservable = new Observable();\n        /** Observable raised when a pad is released */\n        this.onPadUpObservable = new Observable();\n        this._buttonCross = 0;\n        this._buttonCircle = 0;\n        this._buttonSquare = 0;\n        this._buttonTriangle = 0;\n        this._buttonShare = 0;\n        this._buttonOptions = 0;\n        this._buttonL1 = 0;\n        this._buttonR1 = 0;\n        this._buttonLeftStick = 0;\n        this._buttonRightStick = 0;\n        this._dPadUp = 0;\n        this._dPadDown = 0;\n        this._dPadLeft = 0;\n        this._dPadRight = 0;\n        this.type = Gamepad.DUALSHOCK;\n    }\n    /**\n     * Defines the callback to call when left trigger is pressed\n     * @param callback defines the callback to use\n     */\n    onlefttriggerchanged(callback) {\n        this._onlefttriggerchanged = callback;\n    }\n    /**\n     * Defines the callback to call when right trigger is pressed\n     * @param callback defines the callback to use\n     */\n    onrighttriggerchanged(callback) {\n        this._onrighttriggerchanged = callback;\n    }\n    /**\n     * Gets the left trigger value\n     */\n    get leftTrigger() {\n        return this._leftTrigger;\n    }\n    /**\n     * Sets the left trigger value\n     */\n    set leftTrigger(newValue) {\n        if (this._onlefttriggerchanged && this._leftTrigger !== newValue) {\n            this._onlefttriggerchanged(newValue);\n        }\n        this._leftTrigger = newValue;\n    }\n    /**\n     * Gets the right trigger value\n     */\n    get rightTrigger() {\n        return this._rightTrigger;\n    }\n    /**\n     * Sets the right trigger value\n     */\n    set rightTrigger(newValue) {\n        if (this._onrighttriggerchanged && this._rightTrigger !== newValue) {\n            this._onrighttriggerchanged(newValue);\n        }\n        this._rightTrigger = newValue;\n    }\n    /**\n     * Defines the callback to call when a button is pressed\n     * @param callback defines the callback to use\n     */\n    onbuttondown(callback) {\n        this._onbuttondown = callback;\n    }\n    /**\n     * Defines the callback to call when a button is released\n     * @param callback defines the callback to use\n     */\n    onbuttonup(callback) {\n        this._onbuttonup = callback;\n    }\n    /**\n     * Defines the callback to call when a pad is pressed\n     * @param callback defines the callback to use\n     */\n    ondpaddown(callback) {\n        this._ondpaddown = callback;\n    }\n    /**\n     * Defines the callback to call when a pad is released\n     * @param callback defines the callback to use\n     */\n    ondpadup(callback) {\n        this._ondpadup = callback;\n    }\n    _setButtonValue(newValue, currentValue, buttonType) {\n        if (newValue !== currentValue) {\n            if (newValue === 1) {\n                if (this._onbuttondown) {\n                    this._onbuttondown(buttonType);\n                }\n                this.onButtonDownObservable.notifyObservers(buttonType);\n            }\n            if (newValue === 0) {\n                if (this._onbuttonup) {\n                    this._onbuttonup(buttonType);\n                }\n                this.onButtonUpObservable.notifyObservers(buttonType);\n            }\n        }\n        return newValue;\n    }\n    _setDPadValue(newValue, currentValue, buttonType) {\n        if (newValue !== currentValue) {\n            if (newValue === 1) {\n                if (this._ondpaddown) {\n                    this._ondpaddown(buttonType);\n                }\n                this.onPadDownObservable.notifyObservers(buttonType);\n            }\n            if (newValue === 0) {\n                if (this._ondpadup) {\n                    this._ondpadup(buttonType);\n                }\n                this.onPadUpObservable.notifyObservers(buttonType);\n            }\n        }\n        return newValue;\n    }\n    /**\n     * Gets the value of the `Cross` button\n     */\n    get buttonCross() {\n        return this._buttonCross;\n    }\n    /**\n     * Sets the value of the `Cross` button\n     */\n    set buttonCross(value) {\n        this._buttonCross = this._setButtonValue(value, this._buttonCross, DualShockButton.Cross);\n    }\n    /**\n     * Gets the value of the `Circle` button\n     */\n    get buttonCircle() {\n        return this._buttonCircle;\n    }\n    /**\n     * Sets the value of the `Circle` button\n     */\n    set buttonCircle(value) {\n        this._buttonCircle = this._setButtonValue(value, this._buttonCircle, DualShockButton.Circle);\n    }\n    /**\n     * Gets the value of the `Square` button\n     */\n    get buttonSquare() {\n        return this._buttonSquare;\n    }\n    /**\n     * Sets the value of the `Square` button\n     */\n    set buttonSquare(value) {\n        this._buttonSquare = this._setButtonValue(value, this._buttonSquare, DualShockButton.Square);\n    }\n    /**\n     * Gets the value of the `Triangle` button\n     */\n    get buttonTriangle() {\n        return this._buttonTriangle;\n    }\n    /**\n     * Sets the value of the `Triangle` button\n     */\n    set buttonTriangle(value) {\n        this._buttonTriangle = this._setButtonValue(value, this._buttonTriangle, DualShockButton.Triangle);\n    }\n    /**\n     * Gets the value of the `Options` button\n     */\n    get buttonOptions() {\n        return this._buttonOptions;\n    }\n    /**\n     * Sets the value of the `Options` button\n     */\n    set buttonOptions(value) {\n        this._buttonOptions = this._setButtonValue(value, this._buttonOptions, DualShockButton.Options);\n    }\n    /**\n     * Gets the value of the `Share` button\n     */\n    get buttonShare() {\n        return this._buttonShare;\n    }\n    /**\n     * Sets the value of the `Share` button\n     */\n    set buttonShare(value) {\n        this._buttonShare = this._setButtonValue(value, this._buttonShare, DualShockButton.Share);\n    }\n    /**\n     * Gets the value of the `L1` button\n     */\n    get buttonL1() {\n        return this._buttonL1;\n    }\n    /**\n     * Sets the value of the `L1` button\n     */\n    set buttonL1(value) {\n        this._buttonL1 = this._setButtonValue(value, this._buttonL1, DualShockButton.L1);\n    }\n    /**\n     * Gets the value of the `R1` button\n     */\n    get buttonR1() {\n        return this._buttonR1;\n    }\n    /**\n     * Sets the value of the `R1` button\n     */\n    set buttonR1(value) {\n        this._buttonR1 = this._setButtonValue(value, this._buttonR1, DualShockButton.R1);\n    }\n    /**\n     * Gets the value of the Left joystick\n     */\n    get buttonLeftStick() {\n        return this._buttonLeftStick;\n    }\n    /**\n     * Sets the value of the Left joystick\n     */\n    set buttonLeftStick(value) {\n        this._buttonLeftStick = this._setButtonValue(value, this._buttonLeftStick, DualShockButton.LeftStick);\n    }\n    /**\n     * Gets the value of the Right joystick\n     */\n    get buttonRightStick() {\n        return this._buttonRightStick;\n    }\n    /**\n     * Sets the value of the Right joystick\n     */\n    set buttonRightStick(value) {\n        this._buttonRightStick = this._setButtonValue(value, this._buttonRightStick, DualShockButton.RightStick);\n    }\n    /**\n     * Gets the value of D-pad up\n     */\n    get dPadUp() {\n        return this._dPadUp;\n    }\n    /**\n     * Sets the value of D-pad up\n     */\n    set dPadUp(value) {\n        this._dPadUp = this._setDPadValue(value, this._dPadUp, DualShockDpad.Up);\n    }\n    /**\n     * Gets the value of D-pad down\n     */\n    get dPadDown() {\n        return this._dPadDown;\n    }\n    /**\n     * Sets the value of D-pad down\n     */\n    set dPadDown(value) {\n        this._dPadDown = this._setDPadValue(value, this._dPadDown, DualShockDpad.Down);\n    }\n    /**\n     * Gets the value of D-pad left\n     */\n    get dPadLeft() {\n        return this._dPadLeft;\n    }\n    /**\n     * Sets the value of D-pad left\n     */\n    set dPadLeft(value) {\n        this._dPadLeft = this._setDPadValue(value, this._dPadLeft, DualShockDpad.Left);\n    }\n    /**\n     * Gets the value of D-pad right\n     */\n    get dPadRight() {\n        return this._dPadRight;\n    }\n    /**\n     * Sets the value of D-pad right\n     */\n    set dPadRight(value) {\n        this._dPadRight = this._setDPadValue(value, this._dPadRight, DualShockDpad.Right);\n    }\n    /**\n     * Force the gamepad to synchronize with device values\n     */\n    update() {\n        super.update();\n        this.buttonCross = this.browserGamepad.buttons[0].value;\n        this.buttonCircle = this.browserGamepad.buttons[1].value;\n        this.buttonSquare = this.browserGamepad.buttons[2].value;\n        this.buttonTriangle = this.browserGamepad.buttons[3].value;\n        this.buttonL1 = this.browserGamepad.buttons[4].value;\n        this.buttonR1 = this.browserGamepad.buttons[5].value;\n        this.leftTrigger = this.browserGamepad.buttons[6].value;\n        this.rightTrigger = this.browserGamepad.buttons[7].value;\n        this.buttonShare = this.browserGamepad.buttons[8].value;\n        this.buttonOptions = this.browserGamepad.buttons[9].value;\n        this.buttonLeftStick = this.browserGamepad.buttons[10].value;\n        this.buttonRightStick = this.browserGamepad.buttons[11].value;\n        this.dPadUp = this.browserGamepad.buttons[12].value;\n        this.dPadDown = this.browserGamepad.buttons[13].value;\n        this.dPadLeft = this.browserGamepad.buttons[14].value;\n        this.dPadRight = this.browserGamepad.buttons[15].value;\n    }\n    /**\n     * Disposes the gamepad\n     */\n    dispose() {\n        super.dispose();\n        this.onButtonDownObservable.clear();\n        this.onButtonUpObservable.clear();\n        this.onPadDownObservable.clear();\n        this.onPadUpObservable.clear();\n    }\n}\n//# sourceMappingURL=dualShockGamepad.js.map","import { Observable } from \"../Misc/observable.js\";\n/**\n * Represents a gamepad control stick position\n */\nexport class StickValues {\n    /**\n     * Initializes the gamepad x and y control stick values\n     * @param x The x component of the gamepad control stick value\n     * @param y The y component of the gamepad control stick value\n     */\n    constructor(\n    /**\n     * The x component of the control stick\n     */\n    x, \n    /**\n     * The y component of the control stick\n     */\n    y) {\n        this.x = x;\n        this.y = y;\n    }\n}\n/**\n * Represents a gamepad\n */\nexport class Gamepad {\n    /**\n     * Specifies if the gamepad has been connected\n     */\n    get isConnected() {\n        return this._isConnected;\n    }\n    /**\n     * Initializes the gamepad\n     * @param id The id of the gamepad\n     * @param index The index of the gamepad\n     * @param browserGamepad The browser gamepad\n     * @param leftStickX The x component of the left joystick\n     * @param leftStickY The y component of the left joystick\n     * @param rightStickX The x component of the right joystick\n     * @param rightStickY The y component of the right joystick\n     */\n    constructor(\n    /**\n     * The id of the gamepad\n     */\n    id, \n    /**\n     * The index of the gamepad\n     */\n    index, \n    /**\n     * The browser gamepad\n     */\n    browserGamepad, leftStickX = 0, leftStickY = 1, rightStickX = 2, rightStickY = 3) {\n        this.id = id;\n        this.index = index;\n        this.browserGamepad = browserGamepad;\n        this._leftStick = { x: 0, y: 0 };\n        this._rightStick = { x: 0, y: 0 };\n        /** @internal */\n        this._isConnected = true;\n        /**\n         * Specifies whether the left control stick should be Y-inverted\n         */\n        this._invertLeftStickY = false;\n        this.type = Gamepad.GAMEPAD;\n        this._leftStickAxisX = leftStickX;\n        this._leftStickAxisY = leftStickY;\n        this._rightStickAxisX = rightStickX;\n        this._rightStickAxisY = rightStickY;\n        if (this.browserGamepad.axes.length >= 2) {\n            this._leftStick = { x: this.browserGamepad.axes[this._leftStickAxisX], y: this.browserGamepad.axes[this._leftStickAxisY] };\n        }\n        if (this.browserGamepad.axes.length >= 4) {\n            this._rightStick = { x: this.browserGamepad.axes[this._rightStickAxisX], y: this.browserGamepad.axes[this._rightStickAxisY] };\n        }\n    }\n    /**\n     * Callback triggered when the left joystick has changed\n     * @param callback\n     */\n    onleftstickchanged(callback) {\n        this._onleftstickchanged = callback;\n    }\n    /**\n     * Callback triggered when the right joystick has changed\n     * @param callback\n     */\n    onrightstickchanged(callback) {\n        this._onrightstickchanged = callback;\n    }\n    /**\n     * Gets the left joystick\n     */\n    get leftStick() {\n        return this._leftStick;\n    }\n    /**\n     * Sets the left joystick values\n     */\n    set leftStick(newValues) {\n        if (this._onleftstickchanged && (this._leftStick.x !== newValues.x || this._leftStick.y !== newValues.y)) {\n            this._onleftstickchanged(newValues);\n        }\n        this._leftStick = newValues;\n    }\n    /**\n     * Gets the right joystick\n     */\n    get rightStick() {\n        return this._rightStick;\n    }\n    /**\n     * Sets the right joystick value\n     */\n    set rightStick(newValues) {\n        if (this._onrightstickchanged && (this._rightStick.x !== newValues.x || this._rightStick.y !== newValues.y)) {\n            this._onrightstickchanged(newValues);\n        }\n        this._rightStick = newValues;\n    }\n    /**\n     * Updates the gamepad joystick positions\n     */\n    update() {\n        if (this._leftStick) {\n            this.leftStick = { x: this.browserGamepad.axes[this._leftStickAxisX], y: this.browserGamepad.axes[this._leftStickAxisY] };\n            if (this._invertLeftStickY) {\n                this.leftStick.y *= -1;\n            }\n        }\n        if (this._rightStick) {\n            this.rightStick = { x: this.browserGamepad.axes[this._rightStickAxisX], y: this.browserGamepad.axes[this._rightStickAxisY] };\n        }\n    }\n    /**\n     * Disposes the gamepad\n     */\n    dispose() { }\n}\n/**\n * Represents a gamepad controller\n */\nGamepad.GAMEPAD = 0;\n/**\n * Represents a generic controller\n */\nGamepad.GENERIC = 1;\n/**\n * Represents an XBox controller\n */\nGamepad.XBOX = 2;\n/**\n * Represents a pose-enabled controller\n */\nGamepad.POSE_ENABLED = 3;\n/**\n * Represents an Dual Shock controller\n */\nGamepad.DUALSHOCK = 4;\n/**\n * Represents a generic gamepad\n */\nexport class GenericPad extends Gamepad {\n    /**\n     * Callback triggered when a button has been pressed\n     * @param callback Called when a button has been pressed\n     */\n    onbuttondown(callback) {\n        this._onbuttondown = callback;\n    }\n    /**\n     * Callback triggered when a button has been released\n     * @param callback Called when a button has been released\n     */\n    onbuttonup(callback) {\n        this._onbuttonup = callback;\n    }\n    /**\n     * Initializes the generic gamepad\n     * @param id The id of the generic gamepad\n     * @param index The index of the generic gamepad\n     * @param browserGamepad The browser gamepad\n     */\n    constructor(id, index, browserGamepad) {\n        super(id, index, browserGamepad);\n        /**\n         * Observable triggered when a button has been pressed\n         */\n        this.onButtonDownObservable = new Observable();\n        /**\n         * Observable triggered when a button has been released\n         */\n        this.onButtonUpObservable = new Observable();\n        this.type = Gamepad.GENERIC;\n        this._buttons = new Array(browserGamepad.buttons.length);\n    }\n    _setButtonValue(newValue, currentValue, buttonIndex) {\n        if (newValue !== currentValue) {\n            if (newValue === 1) {\n                if (this._onbuttondown) {\n                    this._onbuttondown(buttonIndex);\n                }\n                this.onButtonDownObservable.notifyObservers(buttonIndex);\n            }\n            if (newValue === 0) {\n                if (this._onbuttonup) {\n                    this._onbuttonup(buttonIndex);\n                }\n                this.onButtonUpObservable.notifyObservers(buttonIndex);\n            }\n        }\n        return newValue;\n    }\n    /**\n     * Updates the generic gamepad\n     */\n    update() {\n        super.update();\n        for (let index = 0; index < this._buttons.length; index++) {\n            this._buttons[index] = this._setButtonValue(this.browserGamepad.buttons[index].value, this._buttons[index], index);\n        }\n    }\n    /**\n     * Disposes the generic gamepad\n     */\n    dispose() {\n        super.dispose();\n        this.onButtonDownObservable.clear();\n        this.onButtonUpObservable.clear();\n    }\n}\n//# sourceMappingURL=gamepad.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { IsWindowObjectExist } from \"../Misc/domManagement.js\";\nimport { PoseEnabledControllerHelper } from \"../Gamepads/Controllers/poseEnabledController.js\";\nimport { Xbox360Pad } from \"./xboxGamepad.js\";\nimport { Gamepad, GenericPad } from \"./gamepad.js\";\nimport { Engine } from \"../Engines/engine.js\";\nimport { DualShockPad } from \"./dualShockGamepad.js\";\nimport { Tools } from \"../Misc/tools.js\";\n/**\n * Manager for handling gamepads\n */\nexport class GamepadManager {\n    /**\n     * Initializes the gamepad manager\n     * @param _scene BabylonJS scene\n     */\n    constructor(_scene) {\n        this._scene = _scene;\n        this._babylonGamepads = [];\n        this._oneGamepadConnected = false;\n        /** @internal */\n        this._isMonitoring = false;\n        /**\n         * observable to be triggered when the gamepad controller has been disconnected\n         */\n        this.onGamepadDisconnectedObservable = new Observable();\n        if (!IsWindowObjectExist()) {\n            this._gamepadEventSupported = false;\n        }\n        else {\n            this._gamepadEventSupported = \"GamepadEvent\" in window;\n            this._gamepadSupport = navigator && navigator.getGamepads;\n        }\n        this.onGamepadConnectedObservable = new Observable((observer) => {\n            // This will be used to raise the onGamepadConnected for all gamepads ALREADY connected\n            for (const i in this._babylonGamepads) {\n                const gamepad = this._babylonGamepads[i];\n                if (gamepad && gamepad._isConnected) {\n                    this.onGamepadConnectedObservable.notifyObserver(observer, gamepad);\n                }\n            }\n        });\n        this._onGamepadConnectedEvent = (evt) => {\n            const gamepad = evt.gamepad;\n            if (gamepad.index in this._babylonGamepads) {\n                if (this._babylonGamepads[gamepad.index].isConnected) {\n                    return;\n                }\n            }\n            let newGamepad;\n            if (this._babylonGamepads[gamepad.index]) {\n                newGamepad = this._babylonGamepads[gamepad.index];\n                newGamepad.browserGamepad = gamepad;\n                newGamepad._isConnected = true;\n            }\n            else {\n                newGamepad = this._addNewGamepad(gamepad);\n            }\n            this.onGamepadConnectedObservable.notifyObservers(newGamepad);\n            this._startMonitoringGamepads();\n        };\n        this._onGamepadDisconnectedEvent = (evt) => {\n            const gamepad = evt.gamepad;\n            // Remove the gamepad from the list of gamepads to monitor.\n            for (const i in this._babylonGamepads) {\n                if (this._babylonGamepads[i].index === gamepad.index) {\n                    const disconnectedGamepad = this._babylonGamepads[i];\n                    disconnectedGamepad._isConnected = false;\n                    this.onGamepadDisconnectedObservable.notifyObservers(disconnectedGamepad);\n                    disconnectedGamepad.dispose && disconnectedGamepad.dispose();\n                    break;\n                }\n            }\n        };\n        if (this._gamepadSupport) {\n            //first add already-connected gamepads\n            this._updateGamepadObjects();\n            if (this._babylonGamepads.length) {\n                this._startMonitoringGamepads();\n            }\n            // Checking if the gamepad connected event is supported (like in Firefox)\n            if (this._gamepadEventSupported) {\n                const hostWindow = this._scene ? this._scene.getEngine().getHostWindow() : window;\n                if (hostWindow) {\n                    hostWindow.addEventListener(\"gamepadconnected\", this._onGamepadConnectedEvent, false);\n                    hostWindow.addEventListener(\"gamepaddisconnected\", this._onGamepadDisconnectedEvent, false);\n                }\n            }\n            else {\n                this._startMonitoringGamepads();\n            }\n        }\n    }\n    /**\n     * The gamepads in the game pad manager\n     */\n    get gamepads() {\n        return this._babylonGamepads;\n    }\n    /**\n     * Get the gamepad controllers based on type\n     * @param type The type of gamepad controller\n     * @returns Nullable gamepad\n     */\n    getGamepadByType(type = Gamepad.XBOX) {\n        for (const gamepad of this._babylonGamepads) {\n            if (gamepad && gamepad.type === type) {\n                return gamepad;\n            }\n        }\n        return null;\n    }\n    /**\n     * Disposes the gamepad manager\n     */\n    dispose() {\n        if (this._gamepadEventSupported) {\n            if (this._onGamepadConnectedEvent) {\n                window.removeEventListener(\"gamepadconnected\", this._onGamepadConnectedEvent);\n            }\n            if (this._onGamepadDisconnectedEvent) {\n                window.removeEventListener(\"gamepaddisconnected\", this._onGamepadDisconnectedEvent);\n            }\n            this._onGamepadConnectedEvent = null;\n            this._onGamepadDisconnectedEvent = null;\n        }\n        this._babylonGamepads.forEach((gamepad) => {\n            gamepad.dispose();\n        });\n        this.onGamepadConnectedObservable.clear();\n        this.onGamepadDisconnectedObservable.clear();\n        this._oneGamepadConnected = false;\n        this._stopMonitoringGamepads();\n        this._babylonGamepads = [];\n    }\n    _addNewGamepad(gamepad) {\n        if (!this._oneGamepadConnected) {\n            this._oneGamepadConnected = true;\n        }\n        let newGamepad;\n        const dualShock = gamepad.id.search(\"054c\") !== -1 && gamepad.id.search(\"0ce6\") === -1;\n        const xboxOne = gamepad.id.search(\"Xbox One\") !== -1;\n        if (xboxOne ||\n            gamepad.id.search(\"Xbox 360\") !== -1 ||\n            gamepad.id.search(\"xinput\") !== -1 ||\n            (gamepad.id.search(\"045e\") !== -1 && gamepad.id.search(\"Surface Dock\") === -1)) {\n            // make sure the Surface Dock Extender is not detected as an xbox controller\n            newGamepad = new Xbox360Pad(gamepad.id, gamepad.index, gamepad, xboxOne);\n        }\n        else if (dualShock) {\n            newGamepad = new DualShockPad(gamepad.id, gamepad.index, gamepad);\n        }\n        // if pose is supported, use the (WebVR) pose enabled controller\n        else if (gamepad.pose) {\n            newGamepad = PoseEnabledControllerHelper.InitiateController(gamepad);\n        }\n        else {\n            newGamepad = new GenericPad(gamepad.id, gamepad.index, gamepad);\n        }\n        this._babylonGamepads[newGamepad.index] = newGamepad;\n        return newGamepad;\n    }\n    _startMonitoringGamepads() {\n        if (!this._isMonitoring) {\n            this._isMonitoring = true;\n            //back-comp\n            if (!this._scene) {\n                this._checkGamepadsStatus();\n            }\n        }\n    }\n    _stopMonitoringGamepads() {\n        this._isMonitoring = false;\n    }\n    /** @internal */\n    _checkGamepadsStatus() {\n        // Hack to be compatible Chrome\n        this._updateGamepadObjects();\n        for (const i in this._babylonGamepads) {\n            const gamepad = this._babylonGamepads[i];\n            if (!gamepad || !gamepad.isConnected) {\n                continue;\n            }\n            try {\n                gamepad.update();\n            }\n            catch (_a) {\n                if (this._loggedErrors.indexOf(gamepad.index) === -1) {\n                    Tools.Warn(`Error updating gamepad ${gamepad.id}`);\n                    this._loggedErrors.push(gamepad.index);\n                }\n            }\n        }\n        if (this._isMonitoring && !this._scene) {\n            Engine.QueueNewFrame(() => {\n                this._checkGamepadsStatus();\n            });\n        }\n    }\n    // This function is called only on Chrome, which does not properly support\n    // connection/disconnection events and forces you to recopy again the gamepad object\n    _updateGamepadObjects() {\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\n        for (let i = 0; i < gamepads.length; i++) {\n            const gamepad = gamepads[i];\n            if (gamepad) {\n                if (!this._babylonGamepads[gamepad.index]) {\n                    const newGamepad = this._addNewGamepad(gamepad);\n                    this.onGamepadConnectedObservable.notifyObservers(newGamepad);\n                }\n                else {\n                    // Forced to copy again this object for Chrome for unknown reason\n                    this._babylonGamepads[i].browserGamepad = gamepad;\n                    if (!this._babylonGamepads[i].isConnected) {\n                        this._babylonGamepads[i]._isConnected = true;\n                        this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[i]);\n                    }\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=gamepadManager.js.map","import { Scene } from \"../scene.js\";\nimport { SceneComponentConstants } from \"../sceneComponent.js\";\nimport { GamepadManager } from \"./gamepadManager.js\";\nimport { FreeCameraInputsManager } from \"../Cameras/freeCameraInputsManager.js\";\nimport { FreeCameraGamepadInput } from \"../Cameras/Inputs/freeCameraGamepadInput.js\";\nimport { ArcRotateCameraInputsManager } from \"../Cameras/arcRotateCameraInputsManager.js\";\nimport { ArcRotateCameraGamepadInput } from \"../Cameras/Inputs/arcRotateCameraGamepadInput.js\";\nObject.defineProperty(Scene.prototype, \"gamepadManager\", {\n    get: function () {\n        if (!this._gamepadManager) {\n            this._gamepadManager = new GamepadManager(this);\n            let component = this._getComponent(SceneComponentConstants.NAME_GAMEPAD);\n            if (!component) {\n                component = new GamepadSystemSceneComponent(this);\n                this._addComponent(component);\n            }\n        }\n        return this._gamepadManager;\n    },\n    enumerable: true,\n    configurable: true,\n});\n/**\n * Adds a gamepad to the free camera inputs manager\n */\nFreeCameraInputsManager.prototype.addGamepad = function () {\n    this.add(new FreeCameraGamepadInput());\n    return this;\n};\n/**\n * Adds a gamepad to the arc rotate camera inputs manager\n */\nArcRotateCameraInputsManager.prototype.addGamepad = function () {\n    this.add(new ArcRotateCameraGamepadInput());\n    return this;\n};\n/**\n * Defines the gamepad scene component responsible to manage gamepads in a given scene\n */\nexport class GamepadSystemSceneComponent {\n    /**\n     * Creates a new instance of the component for the given scene\n     * @param scene Defines the scene to register the component in\n     */\n    constructor(scene) {\n        /**\n         * The component name helpfull to identify the component in the list of scene components.\n         */\n        this.name = SceneComponentConstants.NAME_GAMEPAD;\n        this.scene = scene;\n    }\n    /**\n     * Registers the component in a given scene\n     */\n    register() {\n        this.scene._beforeCameraUpdateStage.registerStep(SceneComponentConstants.STEP_BEFORECAMERAUPDATE_GAMEPAD, this, this._beforeCameraUpdate);\n    }\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    rebuild() {\n        // Nothing to do for gamepads\n    }\n    /**\n     * Disposes the component and the associated resources\n     */\n    dispose() {\n        const gamepadManager = this.scene._gamepadManager;\n        if (gamepadManager) {\n            gamepadManager.dispose();\n            this.scene._gamepadManager = null;\n        }\n    }\n    _beforeCameraUpdate() {\n        const gamepadManager = this.scene._gamepadManager;\n        if (gamepadManager && gamepadManager._isMonitoring) {\n            gamepadManager._checkGamepadsStatus();\n        }\n    }\n}\n//# sourceMappingURL=gamepadSceneComponent.js.map","import { Logger } from \"../../Misc/logger.js\";\nimport { SceneLoader } from \"../../Loading/sceneLoader.js\";\nimport { WebVRController } from \"./webVRController.js\";\nimport { PoseEnabledControllerType, PoseEnabledControllerHelper } from \"./poseEnabledController.js\";\n/**\n * Google Daydream controller\n */\nexport class DaydreamController extends WebVRController {\n    /**\n     * Creates a new DaydreamController from a gamepad\n     * @param vrGamepad the gamepad that the controller should be created from\n     */\n    constructor(vrGamepad) {\n        super(vrGamepad);\n        this.controllerType = PoseEnabledControllerType.DAYDREAM;\n    }\n    /**\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\n     * @param scene scene in which to add meshes\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\n     */\n    initControllerMesh(scene, meshLoaded) {\n        SceneLoader.ImportMesh(\"\", DaydreamController.MODEL_BASE_URL, DaydreamController.MODEL_FILENAME, scene, (newMeshes) => {\n            this._defaultModel = newMeshes[1];\n            this.attachToMesh(this._defaultModel);\n            if (meshLoaded) {\n                meshLoaded(this._defaultModel);\n            }\n        });\n    }\n    /**\n     * Called once for each button that changed state since the last frame\n     * @param buttonIdx Which button index changed\n     * @param state New state of the button\n     */\n    _handleButtonChange(buttonIdx, state) {\n        // Daydream controller only has 1 GamepadButton (on the trackpad).\n        if (buttonIdx === 0) {\n            const observable = this.onTriggerStateChangedObservable;\n            if (observable) {\n                observable.notifyObservers(state);\n            }\n        }\n        else {\n            // If the app or home buttons are ever made available\n            Logger.Warn(`Unrecognized Daydream button index: ${buttonIdx}`);\n        }\n    }\n}\n/**\n * Base Url for the controller model.\n */\nDaydreamController.MODEL_BASE_URL = \"https://controllers.babylonjs.com/generic/\";\n/**\n * File name for the controller model.\n */\nDaydreamController.MODEL_FILENAME = \"generic.babylon\";\n/**\n * Gamepad Id prefix used to identify Daydream Controller.\n */\nDaydreamController.GAMEPAD_ID_PREFIX = \"Daydream\"; // id is 'Daydream Controller'\nPoseEnabledControllerHelper._ControllerFactories.push({\n    canCreate: (gamepadInfo) => {\n        return gamepadInfo.id.indexOf(DaydreamController.GAMEPAD_ID_PREFIX) === 0;\n    },\n    create: (gamepadInfo) => {\n        return new DaydreamController(gamepadInfo);\n    },\n});\n//# sourceMappingURL=daydreamController.js.map","import { Vector3 } from \"../../Maths/math.vector.js\";\nimport { Mesh } from \"../../Meshes/mesh.js\";\nimport { SceneLoader } from \"../../Loading/sceneLoader.js\";\nimport { WebVRController } from \"./webVRController.js\";\nimport { PoseEnabledControllerType, PoseEnabledControllerHelper } from \"./poseEnabledController.js\";\n/**\n * Gear VR Controller\n */\nexport class GearVRController extends WebVRController {\n    /**\n     * Creates a new GearVRController from a gamepad\n     * @param vrGamepad the gamepad that the controller should be created from\n     */\n    constructor(vrGamepad) {\n        super(vrGamepad);\n        this._buttonIndexToObservableNameMap = [\n            \"onPadStateChangedObservable\",\n            \"onTriggerStateChangedObservable\", // Trigger\n        ];\n        this.controllerType = PoseEnabledControllerType.GEAR_VR;\n        // Initial starting position defaults to where hand would be (incase of only 3dof controller)\n        this._calculatedPosition = new Vector3(this.hand == \"left\" ? -0.15 : 0.15, -0.5, 0.25);\n        this._disableTrackPosition(this._calculatedPosition);\n    }\n    /**\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\n     * @param scene scene in which to add meshes\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\n     */\n    initControllerMesh(scene, meshLoaded) {\n        SceneLoader.ImportMesh(\"\", GearVRController.MODEL_BASE_URL, GearVRController.MODEL_FILENAME, scene, (newMeshes) => {\n            // Offset the controller so it will rotate around the users wrist\n            const mesh = new Mesh(\"\", scene);\n            newMeshes[1].parent = mesh;\n            newMeshes[1].position.z = -0.15;\n            this._defaultModel = mesh;\n            this.attachToMesh(this._defaultModel);\n            if (meshLoaded) {\n                meshLoaded(this._defaultModel);\n            }\n        });\n    }\n    /**\n     * Called once for each button that changed state since the last frame\n     * @param buttonIdx Which button index changed\n     * @param state New state of the button\n     */\n    _handleButtonChange(buttonIdx, state) {\n        if (buttonIdx < this._buttonIndexToObservableNameMap.length) {\n            const observableName = this._buttonIndexToObservableNameMap[buttonIdx];\n            // Only emit events for buttons that we know how to map from index to observable\n            const observable = this[observableName];\n            if (observable) {\n                observable.notifyObservers(state);\n            }\n        }\n    }\n}\n/**\n * Base Url for the controller model.\n */\nGearVRController.MODEL_BASE_URL = \"https://controllers.babylonjs.com/generic/\";\n/**\n * File name for the controller model.\n */\nGearVRController.MODEL_FILENAME = \"generic.babylon\";\n/**\n * Gamepad Id prefix used to identify this controller.\n */\nGearVRController.GAMEPAD_ID_PREFIX = \"Gear VR\"; // id is 'Gear VR Controller'\nPoseEnabledControllerHelper._ControllerFactories.push({\n    canCreate: (gamepadInfo) => {\n        return gamepadInfo.id.indexOf(GearVRController.GAMEPAD_ID_PREFIX) === 0 || gamepadInfo.id.indexOf(\"Oculus Go\") !== -1 || gamepadInfo.id.indexOf(\"Vive Focus\") !== -1;\n    },\n    create: (gamepadInfo) => {\n        return new GearVRController(gamepadInfo);\n    },\n});\n//# sourceMappingURL=gearVRController.js.map","import { SceneLoader } from \"../../Loading/sceneLoader.js\";\nimport { WebVRController } from \"./webVRController.js\";\nimport { PoseEnabledControllerHelper } from \"./poseEnabledController.js\";\n/**\n * Generic Controller\n */\nexport class GenericController extends WebVRController {\n    /**\n     * Creates a new GenericController from a gamepad\n     * @param vrGamepad the gamepad that the controller should be created from\n     */\n    constructor(vrGamepad) {\n        super(vrGamepad);\n    }\n    /**\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\n     * @param scene scene in which to add meshes\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\n     */\n    initControllerMesh(scene, meshLoaded) {\n        SceneLoader.ImportMesh(\"\", GenericController.MODEL_BASE_URL, GenericController.MODEL_FILENAME, scene, (newMeshes) => {\n            this._defaultModel = newMeshes[1];\n            this.attachToMesh(this._defaultModel);\n            if (meshLoaded) {\n                meshLoaded(this._defaultModel);\n            }\n        });\n    }\n    /**\n     * Called once for each button that changed state since the last frame\n     * @param buttonIdx Which button index changed\n     * @param state New state of the button\n     */\n    _handleButtonChange(buttonIdx, state) {\n        console.log(\"Button id: \" + buttonIdx + \"state: \");\n        console.dir(state);\n    }\n}\n/**\n * Base Url for the controller model.\n */\nGenericController.MODEL_BASE_URL = \"https://controllers.babylonjs.com/generic/\";\n/**\n * File name for the controller model.\n */\nGenericController.MODEL_FILENAME = \"generic.babylon\";\nPoseEnabledControllerHelper._DefaultControllerFactory = (gamepadInfo) => new GenericController(gamepadInfo);\n//# sourceMappingURL=genericController.js.map","import { Observable } from \"../../Misc/observable.js\";\nimport { SceneLoader } from \"../../Loading/sceneLoader.js\";\nimport { WebVRController } from \"./webVRController.js\";\nimport { PoseEnabledControllerType, PoseEnabledControllerHelper } from \"./poseEnabledController.js\";\nimport { EngineStore } from \"../../Engines/engineStore.js\";\n/**\n * Oculus Touch Controller\n */\nexport class OculusTouchController extends WebVRController {\n    /**\n     * Creates a new OculusTouchController from a gamepad\n     * @param vrGamepad the gamepad that the controller should be created from\n     */\n    constructor(vrGamepad) {\n        super(vrGamepad);\n        /**\n         * Fired when the secondary trigger on this controller is modified\n         */\n        this.onSecondaryTriggerStateChangedObservable = new Observable();\n        /**\n         * Fired when the thumb rest on this controller is modified\n         */\n        this.onThumbRestChangedObservable = new Observable();\n        this.controllerType = PoseEnabledControllerType.OCULUS;\n    }\n    /**\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\n     * @param scene scene in which to add meshes\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\n     */\n    initControllerMesh(scene, meshLoaded) {\n        let meshName;\n        // Hand\n        if (this.hand === \"left\") {\n            meshName = OculusTouchController.MODEL_LEFT_FILENAME;\n        }\n        else {\n            // Right is the default if no hand is specified\n            meshName = OculusTouchController.MODEL_RIGHT_FILENAME;\n        }\n        SceneLoader.ImportMesh(\"\", OculusTouchController._IsQuest ? OculusTouchController.QUEST_MODEL_BASE_URL : OculusTouchController.MODEL_BASE_URL, meshName, scene, (newMeshes) => {\n            /*\n        Parent Mesh name: oculus_touch_left\n        - body\n        - trigger\n        - thumbstick\n        - grip\n        - button_y\n        - button_x\n        - button_enter\n        */\n            this._defaultModel = OculusTouchController._IsQuest ? newMeshes[0] : newMeshes[1];\n            this.attachToMesh(this._defaultModel);\n            if (meshLoaded) {\n                meshLoaded(this._defaultModel);\n            }\n        });\n    }\n    /**\n     * Fired when the A button on this controller is modified\n     */\n    get onAButtonStateChangedObservable() {\n        if (this.hand === \"right\") {\n            return this.onMainButtonStateChangedObservable;\n        }\n        else {\n            throw new Error(\"No A button on left hand\");\n        }\n    }\n    /**\n     * Fired when the B button on this controller is modified\n     */\n    get onBButtonStateChangedObservable() {\n        if (this.hand === \"right\") {\n            return this.onSecondaryButtonStateChangedObservable;\n        }\n        else {\n            throw new Error(\"No B button on left hand\");\n        }\n    }\n    /**\n     * Fired when the X button on this controller is modified\n     */\n    get onXButtonStateChangedObservable() {\n        if (this.hand === \"left\") {\n            return this.onMainButtonStateChangedObservable;\n        }\n        else {\n            throw new Error(\"No X button on right hand\");\n        }\n    }\n    /**\n     * Fired when the Y button on this controller is modified\n     */\n    get onYButtonStateChangedObservable() {\n        if (this.hand === \"left\") {\n            return this.onSecondaryButtonStateChangedObservable;\n        }\n        else {\n            throw new Error(\"No Y button on right hand\");\n        }\n    }\n    /**\n     * Called once for each button that changed state since the last frame\n     * 0) thumb stick (touch, press, value = pressed (0,1)). value is in this.leftStick\n     * 1) index trigger (touch (?), press (only when value > 0.1), value 0 to 1)\n     * 2) secondary trigger (same)\n     * 3) A (right) X (left), touch, pressed = value\n     * 4) B / Y\n     * 5) thumb rest\n     * @param buttonIdx Which button index changed\n     * @param state New state of the button\n     */\n    _handleButtonChange(buttonIdx, state) {\n        const notifyObject = state; //{ state: state, changes: changes };\n        const triggerDirection = this.hand === \"right\" ? -1 : 1;\n        switch (buttonIdx) {\n            case 0:\n                this.onPadStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 1: // index trigger\n                if (!OculusTouchController._IsQuest && this._defaultModel) {\n                    this._defaultModel.getChildren()[3].rotation.x = -notifyObject.value * 0.2;\n                    this._defaultModel.getChildren()[3].position.y = -notifyObject.value * 0.005;\n                    this._defaultModel.getChildren()[3].position.z = -notifyObject.value * 0.005;\n                }\n                this.onTriggerStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 2: // secondary trigger\n                if (!OculusTouchController._IsQuest && this._defaultModel) {\n                    this._defaultModel.getChildren()[4].position.x = triggerDirection * notifyObject.value * 0.0035;\n                }\n                this.onSecondaryTriggerStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 3:\n                if (!OculusTouchController._IsQuest && this._defaultModel) {\n                    if (notifyObject.pressed) {\n                        this._defaultModel.getChildren()[1].position.y = -0.001;\n                    }\n                    else {\n                        this._defaultModel.getChildren()[1].position.y = 0;\n                    }\n                }\n                this.onMainButtonStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 4:\n                if (!OculusTouchController._IsQuest && this._defaultModel) {\n                    if (notifyObject.pressed) {\n                        this._defaultModel.getChildren()[2].position.y = -0.001;\n                    }\n                    else {\n                        this._defaultModel.getChildren()[2].position.y = 0;\n                    }\n                }\n                this.onSecondaryButtonStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 5:\n                this.onThumbRestChangedObservable.notifyObservers(notifyObject);\n                return;\n        }\n    }\n}\n/**\n * Base Url for the controller model.\n */\nOculusTouchController.MODEL_BASE_URL = \"https://controllers.babylonjs.com/oculus/\";\n/**\n * File name for the left controller model.\n */\nOculusTouchController.MODEL_LEFT_FILENAME = \"left.babylon\";\n/**\n * File name for the right controller model.\n */\nOculusTouchController.MODEL_RIGHT_FILENAME = \"right.babylon\";\n/**\n * Base Url for the Quest controller model.\n */\nOculusTouchController.QUEST_MODEL_BASE_URL = \"https://controllers.babylonjs.com/oculusQuest/\";\n/**\n * @internal\n * If the controllers are running on a device that needs the updated Quest controller models\n */\nOculusTouchController._IsQuest = false;\nPoseEnabledControllerHelper._ControllerFactories.push({\n    canCreate: (gamepadInfo) => {\n        // If the headset reports being an Oculus Quest, use the Quest controller models\n        if (EngineStore.LastCreatedEngine && EngineStore.LastCreatedEngine._vrDisplay && EngineStore.LastCreatedEngine._vrDisplay.displayName === \"Oculus Quest\") {\n            OculusTouchController._IsQuest = true;\n        }\n        return gamepadInfo.id.indexOf(\"Oculus Touch\") !== -1;\n    },\n    create: (gamepadInfo) => {\n        return new OculusTouchController(gamepadInfo);\n    },\n});\n//# sourceMappingURL=oculusTouchController.js.map","import { SceneLoader } from \"../../Loading/sceneLoader.js\";\nimport { WebVRController } from \"./webVRController.js\";\nimport { PoseEnabledControllerType, PoseEnabledControllerHelper } from \"./poseEnabledController.js\";\n/**\n * Vive Controller\n */\nexport class ViveController extends WebVRController {\n    /**\n     * Creates a new ViveController from a gamepad\n     * @param vrGamepad the gamepad that the controller should be created from\n     */\n    constructor(vrGamepad) {\n        super(vrGamepad);\n        this.controllerType = PoseEnabledControllerType.VIVE;\n        this._invertLeftStickY = true;\n    }\n    /**\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\n     * @param scene scene in which to add meshes\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\n     */\n    initControllerMesh(scene, meshLoaded) {\n        SceneLoader.ImportMesh(\"\", ViveController.MODEL_BASE_URL, ViveController.MODEL_FILENAME, scene, (newMeshes) => {\n            /*\n            Parent Mesh name: ViveWand\n            - body\n            - r_gripper\n            - l_gripper\n            - menu_button\n            - system_button\n            - trackpad\n            - trigger\n            - LED\n            */\n            this._defaultModel = newMeshes[1];\n            this.attachToMesh(this._defaultModel);\n            if (meshLoaded) {\n                meshLoaded(this._defaultModel);\n            }\n        });\n    }\n    /**\n     * Fired when the left button on this controller is modified\n     */\n    get onLeftButtonStateChangedObservable() {\n        return this.onMainButtonStateChangedObservable;\n    }\n    /**\n     * Fired when the right button on this controller is modified\n     */\n    get onRightButtonStateChangedObservable() {\n        return this.onMainButtonStateChangedObservable;\n    }\n    /**\n     * Fired when the menu button on this controller is modified\n     */\n    get onMenuButtonStateChangedObservable() {\n        return this.onSecondaryButtonStateChangedObservable;\n    }\n    /**\n     * Called once for each button that changed state since the last frame\n     * Vive mapping:\n     * 0: touchpad\n     * 1: trigger\n     * 2: left AND right buttons\n     * 3: menu button\n     * @param buttonIdx Which button index changed\n     * @param state New state of the button\n     */\n    _handleButtonChange(buttonIdx, state) {\n        const notifyObject = state; //{ state: state, changes: changes };\n        switch (buttonIdx) {\n            case 0:\n                this.onPadStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 1: // index trigger\n                if (this._defaultModel) {\n                    this._defaultModel.getChildren()[6].rotation.x = -notifyObject.value * 0.15;\n                }\n                this.onTriggerStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 2: // left AND right button\n                this.onMainButtonStateChangedObservable.notifyObservers(notifyObject);\n                return;\n            case 3:\n                if (this._defaultModel) {\n                    if (notifyObject.pressed) {\n                        this._defaultModel.getChildren()[2].position.y = -0.001;\n                    }\n                    else {\n                        this._defaultModel.getChildren()[2].position.y = 0;\n                    }\n                }\n                this.onSecondaryButtonStateChangedObservable.notifyObservers(notifyObject);\n                return;\n        }\n    }\n}\n/**\n * Base Url for the controller model.\n */\nViveController.MODEL_BASE_URL = \"https://controllers.babylonjs.com/vive/\";\n/**\n * File name for the controller model.\n */\nViveController.MODEL_FILENAME = \"wand.babylon\";\nPoseEnabledControllerHelper._ControllerFactories.push({\n    canCreate: (gamepadInfo) => {\n        return gamepadInfo.id.toLowerCase().indexOf(\"openvr\") !== -1;\n    },\n    create: (gamepadInfo) => {\n        return new ViveController(gamepadInfo);\n    },\n});\n//# sourceMappingURL=viveController.js.map","import { Logger } from \"../../Misc/logger.js\";\nimport { Observable } from \"../../Misc/observable.js\";\nimport { Quaternion, Vector3 } from \"../../Maths/math.vector.js\";\nimport { Mesh } from \"../../Meshes/mesh.js\";\nimport { Ray } from \"../../Culling/ray.js\";\nimport { SceneLoader } from \"../../Loading/sceneLoader.js\";\nimport { WebVRController } from \"./webVRController.js\";\nimport { GenericController } from \"./genericController.js\";\nimport { PoseEnabledController, PoseEnabledControllerType, PoseEnabledControllerHelper } from \"./poseEnabledController.js\";\n/**\n * Defines the LoadedMeshInfo object that describes information about the loaded webVR controller mesh\n */\nclass LoadedMeshInfo {\n    constructor() {\n        /**\n         * Map of the button meshes contained in the controller\n         */\n        this.buttonMeshes = {};\n        /**\n         * Map of the axis meshes contained in the controller\n         */\n        this.axisMeshes = {};\n    }\n}\n/**\n * Defines the WindowsMotionController object that the state of the windows motion controller\n */\nexport class WindowsMotionController extends WebVRController {\n    /**\n     * Creates a new WindowsMotionController from a gamepad\n     * @param vrGamepad the gamepad that the controller should be created from\n     */\n    constructor(vrGamepad) {\n        super(vrGamepad);\n        this._mapping = {\n            // Semantic button names\n            buttons: [\"thumbstick\", \"trigger\", \"grip\", \"menu\", \"trackpad\"],\n            // trigger, grip, trackpad, thumbstick, menu\n            // A mapping of the button name to glTF model node name\n            // that should be transformed by button value.\n            buttonMeshNames: {\n                trigger: \"SELECT\",\n                menu: \"MENU\",\n                grip: \"GRASP\",\n                thumbstick: \"THUMBSTICK_PRESS\",\n                trackpad: \"TOUCHPAD_PRESS\",\n            },\n            // This mapping is used to translate from the Motion Controller to Babylon semantics\n            buttonObservableNames: {\n                trigger: \"onTriggerStateChangedObservable\",\n                menu: \"onSecondaryButtonStateChangedObservable\",\n                grip: \"onMainButtonStateChangedObservable\",\n                thumbstick: \"onPadStateChangedObservable\",\n                trackpad: \"onTrackpadChangedObservable\",\n            },\n            // A mapping of the axis name to glTF model node name\n            // that should be transformed by axis value.\n            // This array mirrors the browserGamepad.axes array, such that\n            // the mesh corresponding to axis 0 is in this array index 0.\n            axisMeshNames: [\"THUMBSTICK_X\", \"THUMBSTICK_Y\", \"TOUCHPAD_TOUCH_X\", \"TOUCHPAD_TOUCH_Y\"],\n            // upside down in webxr\n            pointingPoseMeshName: PoseEnabledController.POINTING_POSE,\n        };\n        /**\n         * Fired when the trackpad on this controller is clicked\n         */\n        this.onTrackpadChangedObservable = new Observable();\n        /**\n         * Fired when the trackpad on this controller is modified\n         */\n        this.onTrackpadValuesChangedObservable = new Observable();\n        /**\n         * The current x and y values of this controller's trackpad\n         */\n        this.trackpad = { x: 0, y: 0 };\n        this.controllerType = PoseEnabledControllerType.WINDOWS;\n        this._loadedMeshInfo = null;\n    }\n    /**\n     * Fired when the trigger on this controller is modified\n     */\n    get onTriggerButtonStateChangedObservable() {\n        return this.onTriggerStateChangedObservable;\n    }\n    /**\n     * Fired when the menu button on this controller is modified\n     */\n    get onMenuButtonStateChangedObservable() {\n        return this.onSecondaryButtonStateChangedObservable;\n    }\n    /**\n     * Fired when the grip button on this controller is modified\n     */\n    get onGripButtonStateChangedObservable() {\n        return this.onMainButtonStateChangedObservable;\n    }\n    /**\n     * Fired when the thumbstick button on this controller is modified\n     */\n    get onThumbstickButtonStateChangedObservable() {\n        return this.onPadStateChangedObservable;\n    }\n    /**\n     * Fired when the touchpad button on this controller is modified\n     */\n    get onTouchpadButtonStateChangedObservable() {\n        return this.onTrackpadChangedObservable;\n    }\n    /**\n     * Fired when the touchpad values on this controller are modified\n     */\n    get onTouchpadValuesChangedObservable() {\n        return this.onTrackpadValuesChangedObservable;\n    }\n    _updateTrackpad() {\n        if (this.browserGamepad.axes && (this.browserGamepad.axes[2] != this.trackpad.x || this.browserGamepad.axes[3] != this.trackpad.y)) {\n            this.trackpad.x = this.browserGamepad[\"axes\"][this._mapping.axisMeshNames.indexOf(\"TOUCHPAD_TOUCH_X\")];\n            this.trackpad.y = this.browserGamepad[\"axes\"][this._mapping.axisMeshNames.indexOf(\"TOUCHPAD_TOUCH_Y\")];\n            this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad);\n        }\n    }\n    /**\n     * Called once per frame by the engine.\n     */\n    update() {\n        super.update();\n        if (this.browserGamepad.axes) {\n            this._updateTrackpad();\n            // Only need to animate axes if there is a loaded mesh\n            if (this._loadedMeshInfo) {\n                for (let axis = 0; axis < this._mapping.axisMeshNames.length; axis++) {\n                    this._lerpAxisTransform(axis, this.browserGamepad.axes[axis]);\n                }\n            }\n        }\n    }\n    /**\n     * Called once for each button that changed state since the last frame\n     * @param buttonIdx Which button index changed\n     * @param state New state of the button\n     */\n    _handleButtonChange(buttonIdx, state) {\n        const buttonName = this._mapping.buttons[buttonIdx];\n        if (!buttonName) {\n            return;\n        }\n        // Update the trackpad to ensure trackpad.x/y are accurate during button events between frames\n        this._updateTrackpad();\n        // Only emit events for buttons that we know how to map from index to name\n        const observable = this[this._mapping.buttonObservableNames[buttonName]];\n        if (observable) {\n            observable.notifyObservers(state);\n        }\n        this._lerpButtonTransform(buttonName, state.value);\n    }\n    /**\n     * Moves the buttons on the controller mesh based on their current state\n     * @param buttonName the name of the button to move\n     * @param buttonValue the value of the button which determines the buttons new position\n     */\n    _lerpButtonTransform(buttonName, buttonValue) {\n        // If there is no loaded mesh, there is nothing to transform.\n        if (!this._loadedMeshInfo) {\n            return;\n        }\n        const meshInfo = this._loadedMeshInfo.buttonMeshes[buttonName];\n        if (!meshInfo || !meshInfo.unpressed.rotationQuaternion || !meshInfo.pressed.rotationQuaternion || !meshInfo.value.rotationQuaternion) {\n            return;\n        }\n        Quaternion.SlerpToRef(meshInfo.unpressed.rotationQuaternion, meshInfo.pressed.rotationQuaternion, buttonValue, meshInfo.value.rotationQuaternion);\n        Vector3.LerpToRef(meshInfo.unpressed.position, meshInfo.pressed.position, buttonValue, meshInfo.value.position);\n    }\n    /**\n     * Moves the axis on the controller mesh based on its current state\n     * @param axis the index of the axis\n     * @param axisValue the value of the axis which determines the meshes new position\n     * @internal\n     */\n    _lerpAxisTransform(axis, axisValue) {\n        if (!this._loadedMeshInfo) {\n            return;\n        }\n        const meshInfo = this._loadedMeshInfo.axisMeshes[axis];\n        if (!meshInfo) {\n            return;\n        }\n        if (!meshInfo.min.rotationQuaternion || !meshInfo.max.rotationQuaternion || !meshInfo.value.rotationQuaternion) {\n            return;\n        }\n        // Convert from gamepad value range (-1 to +1) to lerp range (0 to 1)\n        const lerpValue = axisValue * 0.5 + 0.5;\n        Quaternion.SlerpToRef(meshInfo.min.rotationQuaternion, meshInfo.max.rotationQuaternion, lerpValue, meshInfo.value.rotationQuaternion);\n        Vector3.LerpToRef(meshInfo.min.position, meshInfo.max.position, lerpValue, meshInfo.value.position);\n    }\n    /**\n     * Implements abstract method on WebVRController class, loading controller meshes and calling this.attachToMesh if successful.\n     * @param scene scene in which to add meshes\n     * @param meshLoaded optional callback function that will be called if the mesh loads successfully.\n     * @param forceDefault\n     */\n    initControllerMesh(scene, meshLoaded, forceDefault = false) {\n        let path;\n        let filename;\n        // Checking if GLB loader is present\n        if (SceneLoader.IsPluginForExtensionAvailable(\".glb\")) {\n            // Determine the device specific folder based on the ID suffix\n            let device = \"default\";\n            if (this.id && !forceDefault) {\n                const match = this.id.match(WindowsMotionController.GAMEPAD_ID_PATTERN);\n                device = (match && match[0]) || device;\n            }\n            // Hand\n            if (this.hand === \"left\") {\n                filename = WindowsMotionController.MODEL_LEFT_FILENAME;\n            }\n            else {\n                // Right is the default if no hand is specified\n                filename = WindowsMotionController.MODEL_RIGHT_FILENAME;\n            }\n            path = WindowsMotionController.MODEL_BASE_URL + device + \"/\";\n        }\n        else {\n            Logger.Warn(\"You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models\");\n            path = GenericController.MODEL_BASE_URL;\n            filename = GenericController.MODEL_FILENAME;\n        }\n        SceneLoader.ImportMesh(\"\", path, filename, scene, (meshes) => {\n            // glTF files successfully loaded from the remote server, now process them to ensure they are in the right format.\n            this._loadedMeshInfo = this._processModel(scene, meshes);\n            if (!this._loadedMeshInfo) {\n                return;\n            }\n            this._defaultModel = this._loadedMeshInfo.rootNode;\n            this.attachToMesh(this._defaultModel);\n            if (meshLoaded) {\n                meshLoaded(this._defaultModel);\n            }\n        }, null, (scene, message) => {\n            Logger.Log(message);\n            Logger.Warn(\"Failed to retrieve controller model from the remote server: \" + path + filename);\n            if (!forceDefault) {\n                this.initControllerMesh(scene, meshLoaded, true);\n            }\n        });\n    }\n    /**\n     * Takes a list of meshes (as loaded from the glTF file) and finds the root node, as well as nodes that\n     * can be transformed by button presses and axes values, based on this._mapping.\n     *\n     * @param scene scene in which the meshes exist\n     * @param meshes list of meshes that make up the controller model to process\n     * @returns structured view of the given meshes, with mapping of buttons and axes to meshes that can be transformed.\n     */\n    _processModel(scene, meshes) {\n        let loadedMeshInfo = null;\n        // Create a new mesh to contain the glTF hierarchy\n        const parentMesh = new Mesh(this.id + \" \" + this.hand, scene);\n        // Find the root node in the loaded glTF scene, and attach it as a child of 'parentMesh'\n        let childMesh = null;\n        for (let i = 0; i < meshes.length; i++) {\n            const mesh = meshes[i];\n            if (!mesh.parent) {\n                // Exclude controller meshes from picking results\n                mesh.isPickable = false;\n                // Handle root node, attach to the new parentMesh\n                childMesh = mesh;\n                break;\n            }\n        }\n        if (childMesh) {\n            childMesh.setParent(parentMesh);\n            // Create our mesh info. Note that this method will always return non-null.\n            loadedMeshInfo = this._createMeshInfo(parentMesh);\n        }\n        else {\n            Logger.Warn(\"Could not find root node in model file.\");\n        }\n        return loadedMeshInfo;\n    }\n    _createMeshInfo(rootNode) {\n        const loadedMeshInfo = new LoadedMeshInfo();\n        let i;\n        loadedMeshInfo.rootNode = rootNode;\n        // Reset the caches\n        loadedMeshInfo.buttonMeshes = {};\n        loadedMeshInfo.axisMeshes = {};\n        // Button Meshes\n        for (i = 0; i < this._mapping.buttons.length; i++) {\n            const buttonMeshName = this._mapping.buttonMeshNames[this._mapping.buttons[i]];\n            if (!buttonMeshName) {\n                Logger.Log(\"Skipping unknown button at index: \" + i + \" with mapped name: \" + this._mapping.buttons[i]);\n                continue;\n            }\n            const buttonMesh = getChildByName(rootNode, buttonMeshName);\n            if (!buttonMesh) {\n                Logger.Warn(\"Missing button mesh with name: \" + buttonMeshName);\n                continue;\n            }\n            const buttonMeshInfo = {\n                index: i,\n                value: getImmediateChildByName(buttonMesh, \"VALUE\"),\n                pressed: getImmediateChildByName(buttonMesh, \"PRESSED\"),\n                unpressed: getImmediateChildByName(buttonMesh, \"UNPRESSED\"),\n            };\n            if (buttonMeshInfo.value && buttonMeshInfo.pressed && buttonMeshInfo.unpressed) {\n                loadedMeshInfo.buttonMeshes[this._mapping.buttons[i]] = buttonMeshInfo;\n            }\n            else {\n                // If we didn't find the mesh, it simply means this button won't have transforms applied as mapped button value changes.\n                Logger.Warn(\"Missing button submesh under mesh with name: \" +\n                    buttonMeshName +\n                    \"(VALUE: \" +\n                    !!buttonMeshInfo.value +\n                    \", PRESSED: \" +\n                    !!buttonMeshInfo.pressed +\n                    \", UNPRESSED:\" +\n                    !!buttonMeshInfo.unpressed +\n                    \")\");\n            }\n        }\n        // Axis Meshes\n        for (i = 0; i < this._mapping.axisMeshNames.length; i++) {\n            const axisMeshName = this._mapping.axisMeshNames[i];\n            if (!axisMeshName) {\n                Logger.Log(\"Skipping unknown axis at index: \" + i);\n                continue;\n            }\n            const axisMesh = getChildByName(rootNode, axisMeshName);\n            if (!axisMesh) {\n                Logger.Warn(\"Missing axis mesh with name: \" + axisMeshName);\n                continue;\n            }\n            const axisMeshInfo = {\n                index: i,\n                value: getImmediateChildByName(axisMesh, \"VALUE\"),\n                min: getImmediateChildByName(axisMesh, \"MIN\"),\n                max: getImmediateChildByName(axisMesh, \"MAX\"),\n            };\n            if (axisMeshInfo.value && axisMeshInfo.min && axisMeshInfo.max) {\n                loadedMeshInfo.axisMeshes[i] = axisMeshInfo;\n            }\n            else {\n                // If we didn't find the mesh, it simply means thit axis won't have transforms applied as mapped axis values change.\n                Logger.Warn(\"Missing axis submesh under mesh with name: \" +\n                    axisMeshName +\n                    \"(VALUE: \" +\n                    !!axisMeshInfo.value +\n                    \", MIN: \" +\n                    !!axisMeshInfo.min +\n                    \", MAX:\" +\n                    !!axisMeshInfo.max +\n                    \")\");\n            }\n        }\n        // Pointing Ray\n        loadedMeshInfo.pointingPoseNode = getChildByName(rootNode, this._mapping.pointingPoseMeshName);\n        if (!loadedMeshInfo.pointingPoseNode) {\n            Logger.Warn(\"Missing pointing pose mesh with name: \" + this._mapping.pointingPoseMeshName);\n        }\n        else {\n            this._pointingPoseNode = loadedMeshInfo.pointingPoseNode;\n        }\n        return loadedMeshInfo;\n        // Look through all children recursively. This will return null if no mesh exists with the given name.\n        function getChildByName(node, name) {\n            return node.getChildren((n) => n.name === name, false)[0];\n        }\n        // Look through only immediate children. This will return null if no mesh exists with the given name.\n        function getImmediateChildByName(node, name) {\n            return node.getChildren((n) => n.name == name, true)[0];\n        }\n    }\n    /**\n     * Gets the ray of the controller in the direction the controller is pointing\n     * @param length the length the resulting ray should be\n     * @returns a ray in the direction the controller is pointing\n     */\n    getForwardRay(length = 100) {\n        if (!(this._loadedMeshInfo && this._loadedMeshInfo.pointingPoseNode)) {\n            return super.getForwardRay(length);\n        }\n        const m = this._loadedMeshInfo.pointingPoseNode.getWorldMatrix();\n        const origin = m.getTranslation();\n        const forward = new Vector3(0, 0, -1);\n        const forwardWorld = Vector3.TransformNormal(forward, m);\n        const direction = Vector3.Normalize(forwardWorld);\n        return new Ray(origin, direction, length);\n    }\n    /**\n     * Disposes of the controller\n     */\n    dispose() {\n        super.dispose();\n        this.onTrackpadChangedObservable.clear();\n        this.onTrackpadValuesChangedObservable.clear();\n    }\n}\n/**\n * The base url used to load the left and right controller models\n */\nWindowsMotionController.MODEL_BASE_URL = \"https://controllers.babylonjs.com/microsoft/\";\n/**\n * The name of the left controller model file\n */\nWindowsMotionController.MODEL_LEFT_FILENAME = \"left.glb\";\n/**\n * The name of the right controller model file\n */\nWindowsMotionController.MODEL_RIGHT_FILENAME = \"right.glb\";\n/**\n * The controller name prefix for this controller type\n */\nWindowsMotionController.GAMEPAD_ID_PREFIX = \"Spatial Controller (Spatial Interaction Source) \";\n/**\n * The controller id pattern for this controller type\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nWindowsMotionController.GAMEPAD_ID_PATTERN = /([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/;\n/**\n * This class represents a new windows motion controller in XR.\n */\nexport class XRWindowsMotionController extends WindowsMotionController {\n    /**\n     * Construct a new XR-Based windows motion controller\n     *\n     * @param gamepadInfo the gamepad object from the browser\n     */\n    constructor(gamepadInfo) {\n        super(gamepadInfo);\n        /**\n         * Changing the original WIndowsMotionController mapping to fir the new mapping\n         */\n        this._mapping = {\n            // Semantic button names\n            buttons: [\"trigger\", \"grip\", \"trackpad\", \"thumbstick\", \"menu\"],\n            // trigger, grip, trackpad, thumbstick, menu\n            // A mapping of the button name to glTF model node name\n            // that should be transformed by button value.\n            buttonMeshNames: {\n                trigger: \"SELECT\",\n                menu: \"MENU\",\n                grip: \"GRASP\",\n                thumbstick: \"THUMBSTICK_PRESS\",\n                trackpad: \"TOUCHPAD_PRESS\",\n            },\n            // This mapping is used to translate from the Motion Controller to Babylon semantics\n            buttonObservableNames: {\n                trigger: \"onTriggerStateChangedObservable\",\n                menu: \"onSecondaryButtonStateChangedObservable\",\n                grip: \"onMainButtonStateChangedObservable\",\n                thumbstick: \"onThumbstickStateChangedObservable\",\n                trackpad: \"onTrackpadChangedObservable\",\n            },\n            // A mapping of the axis name to glTF model node name\n            // that should be transformed by axis value.\n            // This array mirrors the browserGamepad.axes array, such that\n            // the mesh corresponding to axis 0 is in this array index 0.\n            axisMeshNames: [\"TOUCHPAD_TOUCH_X\", \"TOUCHPAD_TOUCH_Y\", \"THUMBSTICK_X\", \"THUMBSTICK_Y\"],\n            // upside down in webxr\n            pointingPoseMeshName: PoseEnabledController.POINTING_POSE,\n        };\n        /**\n         * holds the thumbstick values (X,Y)\n         */\n        this.thumbstickValues = { x: 0, y: 0 };\n        /**\n         * Fired when the thumbstick on this controller is clicked\n         */\n        this.onThumbstickStateChangedObservable = new Observable();\n        /**\n         * Fired when the thumbstick on this controller is modified\n         */\n        this.onThumbstickValuesChangedObservable = new Observable();\n        /**\n         * Fired when the touchpad button on this controller is modified\n         */\n        this.onTrackpadChangedObservable = this.onPadStateChangedObservable;\n        /**\n         * Fired when the touchpad values on this controller are modified\n         */\n        this.onTrackpadValuesChangedObservable = this.onPadValuesChangedObservable;\n    }\n    /**\n     * Fired when the thumbstick button on this controller is modified\n     * here to prevent breaking changes\n     */\n    get onThumbstickButtonStateChangedObservable() {\n        return this.onThumbstickStateChangedObservable;\n    }\n    /**\n     * updating the thumbstick(!) and not the trackpad.\n     * This is named this way due to the difference between WebVR and XR and to avoid\n     * changing the parent class.\n     */\n    _updateTrackpad() {\n        if (this.browserGamepad.axes && (this.browserGamepad.axes[2] != this.thumbstickValues.x || this.browserGamepad.axes[3] != this.thumbstickValues.y)) {\n            this.trackpad.x = this.browserGamepad[\"axes\"][2];\n            this.trackpad.y = this.browserGamepad[\"axes\"][3];\n            this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad);\n        }\n    }\n    /**\n     * Disposes the class with joy\n     */\n    dispose() {\n        super.dispose();\n        this.onThumbstickStateChangedObservable.clear();\n        this.onThumbstickValuesChangedObservable.clear();\n    }\n}\nPoseEnabledControllerHelper._ControllerFactories.push({\n    canCreate: (gamepadInfo) => {\n        return gamepadInfo.id.indexOf(WindowsMotionController.GAMEPAD_ID_PREFIX) === 0;\n    },\n    create: (gamepadInfo) => {\n        return new WindowsMotionController(gamepadInfo);\n    },\n});\n//# sourceMappingURL=windowsMotionController.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { Gamepad } from \"../Gamepads/gamepad.js\";\n/**\n * Defines supported buttons for XBox360 compatible gamepads\n */\nexport var Xbox360Button;\n(function (Xbox360Button) {\n    /** A */\n    Xbox360Button[Xbox360Button[\"A\"] = 0] = \"A\";\n    /** B */\n    Xbox360Button[Xbox360Button[\"B\"] = 1] = \"B\";\n    /** X */\n    Xbox360Button[Xbox360Button[\"X\"] = 2] = \"X\";\n    /** Y */\n    Xbox360Button[Xbox360Button[\"Y\"] = 3] = \"Y\";\n    /** Left button */\n    Xbox360Button[Xbox360Button[\"LB\"] = 4] = \"LB\";\n    /** Right button */\n    Xbox360Button[Xbox360Button[\"RB\"] = 5] = \"RB\";\n    /** Back */\n    Xbox360Button[Xbox360Button[\"Back\"] = 8] = \"Back\";\n    /** Start */\n    Xbox360Button[Xbox360Button[\"Start\"] = 9] = \"Start\";\n    /** Left stick */\n    Xbox360Button[Xbox360Button[\"LeftStick\"] = 10] = \"LeftStick\";\n    /** Right stick */\n    Xbox360Button[Xbox360Button[\"RightStick\"] = 11] = \"RightStick\";\n})(Xbox360Button || (Xbox360Button = {}));\n/** Defines values for XBox360 DPad  */\nexport var Xbox360Dpad;\n(function (Xbox360Dpad) {\n    /** Up */\n    Xbox360Dpad[Xbox360Dpad[\"Up\"] = 12] = \"Up\";\n    /** Down */\n    Xbox360Dpad[Xbox360Dpad[\"Down\"] = 13] = \"Down\";\n    /** Left */\n    Xbox360Dpad[Xbox360Dpad[\"Left\"] = 14] = \"Left\";\n    /** Right */\n    Xbox360Dpad[Xbox360Dpad[\"Right\"] = 15] = \"Right\";\n})(Xbox360Dpad || (Xbox360Dpad = {}));\n/**\n * Defines a XBox360 gamepad\n */\nexport class Xbox360Pad extends Gamepad {\n    /**\n     * Creates a new XBox360 gamepad object\n     * @param id defines the id of this gamepad\n     * @param index defines its index\n     * @param gamepad defines the internal HTML gamepad object\n     * @param xboxOne defines if it is a XBox One gamepad\n     */\n    constructor(id, index, gamepad, xboxOne = false) {\n        super(id, index, gamepad, 0, 1, 2, 3);\n        this._leftTrigger = 0;\n        this._rightTrigger = 0;\n        /** Observable raised when a button is pressed */\n        this.onButtonDownObservable = new Observable();\n        /** Observable raised when a button is released */\n        this.onButtonUpObservable = new Observable();\n        /** Observable raised when a pad is pressed */\n        this.onPadDownObservable = new Observable();\n        /** Observable raised when a pad is released */\n        this.onPadUpObservable = new Observable();\n        this._buttonA = 0;\n        this._buttonB = 0;\n        this._buttonX = 0;\n        this._buttonY = 0;\n        this._buttonBack = 0;\n        this._buttonStart = 0;\n        this._buttonLB = 0;\n        this._buttonRB = 0;\n        this._buttonLeftStick = 0;\n        this._buttonRightStick = 0;\n        this._dPadUp = 0;\n        this._dPadDown = 0;\n        this._dPadLeft = 0;\n        this._dPadRight = 0;\n        this._isXboxOnePad = false;\n        this.type = Gamepad.XBOX;\n        this._isXboxOnePad = xboxOne;\n    }\n    /**\n     * Defines the callback to call when left trigger is pressed\n     * @param callback defines the callback to use\n     */\n    onlefttriggerchanged(callback) {\n        this._onlefttriggerchanged = callback;\n    }\n    /**\n     * Defines the callback to call when right trigger is pressed\n     * @param callback defines the callback to use\n     */\n    onrighttriggerchanged(callback) {\n        this._onrighttriggerchanged = callback;\n    }\n    /**\n     * Gets the left trigger value\n     */\n    get leftTrigger() {\n        return this._leftTrigger;\n    }\n    /**\n     * Sets the left trigger value\n     */\n    set leftTrigger(newValue) {\n        if (this._onlefttriggerchanged && this._leftTrigger !== newValue) {\n            this._onlefttriggerchanged(newValue);\n        }\n        this._leftTrigger = newValue;\n    }\n    /**\n     * Gets the right trigger value\n     */\n    get rightTrigger() {\n        return this._rightTrigger;\n    }\n    /**\n     * Sets the right trigger value\n     */\n    set rightTrigger(newValue) {\n        if (this._onrighttriggerchanged && this._rightTrigger !== newValue) {\n            this._onrighttriggerchanged(newValue);\n        }\n        this._rightTrigger = newValue;\n    }\n    /**\n     * Defines the callback to call when a button is pressed\n     * @param callback defines the callback to use\n     */\n    onbuttondown(callback) {\n        this._onbuttondown = callback;\n    }\n    /**\n     * Defines the callback to call when a button is released\n     * @param callback defines the callback to use\n     */\n    onbuttonup(callback) {\n        this._onbuttonup = callback;\n    }\n    /**\n     * Defines the callback to call when a pad is pressed\n     * @param callback defines the callback to use\n     */\n    ondpaddown(callback) {\n        this._ondpaddown = callback;\n    }\n    /**\n     * Defines the callback to call when a pad is released\n     * @param callback defines the callback to use\n     */\n    ondpadup(callback) {\n        this._ondpadup = callback;\n    }\n    _setButtonValue(newValue, currentValue, buttonType) {\n        if (newValue !== currentValue) {\n            if (newValue === 1) {\n                if (this._onbuttondown) {\n                    this._onbuttondown(buttonType);\n                }\n                this.onButtonDownObservable.notifyObservers(buttonType);\n            }\n            if (newValue === 0) {\n                if (this._onbuttonup) {\n                    this._onbuttonup(buttonType);\n                }\n                this.onButtonUpObservable.notifyObservers(buttonType);\n            }\n        }\n        return newValue;\n    }\n    _setDPadValue(newValue, currentValue, buttonType) {\n        if (newValue !== currentValue) {\n            if (newValue === 1) {\n                if (this._ondpaddown) {\n                    this._ondpaddown(buttonType);\n                }\n                this.onPadDownObservable.notifyObservers(buttonType);\n            }\n            if (newValue === 0) {\n                if (this._ondpadup) {\n                    this._ondpadup(buttonType);\n                }\n                this.onPadUpObservable.notifyObservers(buttonType);\n            }\n        }\n        return newValue;\n    }\n    /**\n     * Gets the value of the `A` button\n     */\n    get buttonA() {\n        return this._buttonA;\n    }\n    /**\n     * Sets the value of the `A` button\n     */\n    set buttonA(value) {\n        this._buttonA = this._setButtonValue(value, this._buttonA, Xbox360Button.A);\n    }\n    /**\n     * Gets the value of the `B` button\n     */\n    get buttonB() {\n        return this._buttonB;\n    }\n    /**\n     * Sets the value of the `B` button\n     */\n    set buttonB(value) {\n        this._buttonB = this._setButtonValue(value, this._buttonB, Xbox360Button.B);\n    }\n    /**\n     * Gets the value of the `X` button\n     */\n    get buttonX() {\n        return this._buttonX;\n    }\n    /**\n     * Sets the value of the `X` button\n     */\n    set buttonX(value) {\n        this._buttonX = this._setButtonValue(value, this._buttonX, Xbox360Button.X);\n    }\n    /**\n     * Gets the value of the `Y` button\n     */\n    get buttonY() {\n        return this._buttonY;\n    }\n    /**\n     * Sets the value of the `Y` button\n     */\n    set buttonY(value) {\n        this._buttonY = this._setButtonValue(value, this._buttonY, Xbox360Button.Y);\n    }\n    /**\n     * Gets the value of the `Start` button\n     */\n    get buttonStart() {\n        return this._buttonStart;\n    }\n    /**\n     * Sets the value of the `Start` button\n     */\n    set buttonStart(value) {\n        this._buttonStart = this._setButtonValue(value, this._buttonStart, Xbox360Button.Start);\n    }\n    /**\n     * Gets the value of the `Back` button\n     */\n    get buttonBack() {\n        return this._buttonBack;\n    }\n    /**\n     * Sets the value of the `Back` button\n     */\n    set buttonBack(value) {\n        this._buttonBack = this._setButtonValue(value, this._buttonBack, Xbox360Button.Back);\n    }\n    /**\n     * Gets the value of the `Left` button\n     */\n    get buttonLB() {\n        return this._buttonLB;\n    }\n    /**\n     * Sets the value of the `Left` button\n     */\n    set buttonLB(value) {\n        this._buttonLB = this._setButtonValue(value, this._buttonLB, Xbox360Button.LB);\n    }\n    /**\n     * Gets the value of the `Right` button\n     */\n    get buttonRB() {\n        return this._buttonRB;\n    }\n    /**\n     * Sets the value of the `Right` button\n     */\n    set buttonRB(value) {\n        this._buttonRB = this._setButtonValue(value, this._buttonRB, Xbox360Button.RB);\n    }\n    /**\n     * Gets the value of the Left joystick\n     */\n    get buttonLeftStick() {\n        return this._buttonLeftStick;\n    }\n    /**\n     * Sets the value of the Left joystick\n     */\n    set buttonLeftStick(value) {\n        this._buttonLeftStick = this._setButtonValue(value, this._buttonLeftStick, Xbox360Button.LeftStick);\n    }\n    /**\n     * Gets the value of the Right joystick\n     */\n    get buttonRightStick() {\n        return this._buttonRightStick;\n    }\n    /**\n     * Sets the value of the Right joystick\n     */\n    set buttonRightStick(value) {\n        this._buttonRightStick = this._setButtonValue(value, this._buttonRightStick, Xbox360Button.RightStick);\n    }\n    /**\n     * Gets the value of D-pad up\n     */\n    get dPadUp() {\n        return this._dPadUp;\n    }\n    /**\n     * Sets the value of D-pad up\n     */\n    set dPadUp(value) {\n        this._dPadUp = this._setDPadValue(value, this._dPadUp, Xbox360Dpad.Up);\n    }\n    /**\n     * Gets the value of D-pad down\n     */\n    get dPadDown() {\n        return this._dPadDown;\n    }\n    /**\n     * Sets the value of D-pad down\n     */\n    set dPadDown(value) {\n        this._dPadDown = this._setDPadValue(value, this._dPadDown, Xbox360Dpad.Down);\n    }\n    /**\n     * Gets the value of D-pad left\n     */\n    get dPadLeft() {\n        return this._dPadLeft;\n    }\n    /**\n     * Sets the value of D-pad left\n     */\n    set dPadLeft(value) {\n        this._dPadLeft = this._setDPadValue(value, this._dPadLeft, Xbox360Dpad.Left);\n    }\n    /**\n     * Gets the value of D-pad right\n     */\n    get dPadRight() {\n        return this._dPadRight;\n    }\n    /**\n     * Sets the value of D-pad right\n     */\n    set dPadRight(value) {\n        this._dPadRight = this._setDPadValue(value, this._dPadRight, Xbox360Dpad.Right);\n    }\n    /**\n     * Force the gamepad to synchronize with device values\n     */\n    update() {\n        super.update();\n        if (this._isXboxOnePad) {\n            this.buttonA = this.browserGamepad.buttons[0].value;\n            this.buttonB = this.browserGamepad.buttons[1].value;\n            this.buttonX = this.browserGamepad.buttons[2].value;\n            this.buttonY = this.browserGamepad.buttons[3].value;\n            this.buttonLB = this.browserGamepad.buttons[4].value;\n            this.buttonRB = this.browserGamepad.buttons[5].value;\n            this.leftTrigger = this.browserGamepad.buttons[6].value;\n            this.rightTrigger = this.browserGamepad.buttons[7].value;\n            this.buttonBack = this.browserGamepad.buttons[8].value;\n            this.buttonStart = this.browserGamepad.buttons[9].value;\n            this.buttonLeftStick = this.browserGamepad.buttons[10].value;\n            this.buttonRightStick = this.browserGamepad.buttons[11].value;\n            this.dPadUp = this.browserGamepad.buttons[12].value;\n            this.dPadDown = this.browserGamepad.buttons[13].value;\n            this.dPadLeft = this.browserGamepad.buttons[14].value;\n            this.dPadRight = this.browserGamepad.buttons[15].value;\n        }\n        else {\n            this.buttonA = this.browserGamepad.buttons[0].value;\n            this.buttonB = this.browserGamepad.buttons[1].value;\n            this.buttonX = this.browserGamepad.buttons[2].value;\n            this.buttonY = this.browserGamepad.buttons[3].value;\n            this.buttonLB = this.browserGamepad.buttons[4].value;\n            this.buttonRB = this.browserGamepad.buttons[5].value;\n            this.leftTrigger = this.browserGamepad.buttons[6].value;\n            this.rightTrigger = this.browserGamepad.buttons[7].value;\n            this.buttonBack = this.browserGamepad.buttons[8].value;\n            this.buttonStart = this.browserGamepad.buttons[9].value;\n            this.buttonLeftStick = this.browserGamepad.buttons[10].value;\n            this.buttonRightStick = this.browserGamepad.buttons[11].value;\n            this.dPadUp = this.browserGamepad.buttons[12].value;\n            this.dPadDown = this.browserGamepad.buttons[13].value;\n            this.dPadLeft = this.browserGamepad.buttons[14].value;\n            this.dPadRight = this.browserGamepad.buttons[15].value;\n        }\n    }\n    /**\n     * Disposes the gamepad\n     */\n    dispose() {\n        super.dispose();\n        this.onButtonDownObservable.clear();\n        this.onButtonUpObservable.clear();\n        this.onPadDownObservable.clear();\n        this.onPadUpObservable.clear();\n    }\n}\n//# sourceMappingURL=xboxGamepad.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { TransformNode } from \"../Meshes/transformNode.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { CreateCylinder } from \"../Meshes/Builders/cylinderBuilder.js\";\nimport { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { TmpVectors } from \"../Maths/math.vector.js\";\n/**\n * Single axis drag gizmo\n */\nexport class AxisDragGizmo extends Gizmo {\n    /** Default material used to render when gizmo is not disabled or hovered */\n    get coloredMaterial() {\n        return this._coloredMaterial;\n    }\n    /** Material used to render when gizmo is hovered with mouse*/\n    get hoverMaterial() {\n        return this._hoverMaterial;\n    }\n    /** Material used to render when gizmo is disabled. typically grey.*/\n    get disableMaterial() {\n        return this._disableMaterial;\n    }\n    /**\n     * @internal\n     */\n    static _CreateArrow(scene, material, thickness = 1, isCollider = false) {\n        const arrow = new TransformNode(\"arrow\", scene);\n        const cylinder = CreateCylinder(\"cylinder\", { diameterTop: 0, height: 0.075, diameterBottom: 0.0375 * (1 + (thickness - 1) / 4), tessellation: 96 }, scene);\n        const line = CreateCylinder(\"cylinder\", { diameterTop: 0.005 * thickness, height: 0.275, diameterBottom: 0.005 * thickness, tessellation: 96 }, scene);\n        // Position arrow pointing in its drag axis\n        cylinder.parent = arrow;\n        cylinder.material = material;\n        cylinder.rotation.x = Math.PI / 2;\n        cylinder.position.z += 0.3;\n        line.parent = arrow;\n        line.material = material;\n        line.position.z += 0.275 / 2;\n        line.rotation.x = Math.PI / 2;\n        if (isCollider) {\n            line.visibility = 0;\n            cylinder.visibility = 0;\n        }\n        return arrow;\n    }\n    /**\n     * @internal\n     */\n    static _CreateArrowInstance(scene, arrow) {\n        const instance = new TransformNode(\"arrow\", scene);\n        for (const mesh of arrow.getChildMeshes()) {\n            const childInstance = mesh.createInstance(mesh.name);\n            childInstance.parent = instance;\n        }\n        return instance;\n    }\n    /**\n     * Creates an AxisDragGizmo\n     * @param dragAxis The axis which the gizmo will be able to drag on\n     * @param color The color of the gizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param parent\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(dragAxis, color = Color3.Gray(), gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer, parent = null, thickness = 1) {\n        var _a;\n        super(gizmoLayer);\n        this._pointerObserver = null;\n        /**\n         * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n         */\n        this.snapDistance = 0;\n        /**\n         * Event that fires each time the gizmo snaps to a new location.\n         * * snapDistance is the the change in distance\n         */\n        this.onSnapObservable = new Observable();\n        this._isEnabled = true;\n        this._parent = null;\n        this._dragging = false;\n        this._parent = parent;\n        // Create Material\n        this._coloredMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = color;\n        this._coloredMaterial.specularColor = color.subtract(new Color3(0.1, 0.1, 0.1));\n        this._hoverMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = Color3.Yellow();\n        this._disableMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._disableMaterial.diffuseColor = Color3.Gray();\n        this._disableMaterial.alpha = 0.4;\n        // Build Mesh + Collider\n        const arrow = AxisDragGizmo._CreateArrow(gizmoLayer.utilityLayerScene, this._coloredMaterial, thickness);\n        const collider = AxisDragGizmo._CreateArrow(gizmoLayer.utilityLayerScene, this._coloredMaterial, thickness + 4, true);\n        // Add to Root Node\n        this._gizmoMesh = new Mesh(\"\", gizmoLayer.utilityLayerScene);\n        this._gizmoMesh.addChild(arrow);\n        this._gizmoMesh.addChild(collider);\n        this._gizmoMesh.lookAt(this._rootMesh.position.add(dragAxis));\n        this._gizmoMesh.scaling.scaleInPlace(1 / 3);\n        this._gizmoMesh.parent = this._rootMesh;\n        let currentSnapDragDistance = 0;\n        const tmpSnapEvent = { snapDistance: 0 };\n        // Add drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new PointerDragBehavior({ dragAxis: dragAxis });\n        this.dragBehavior.moveAttached = false;\n        this.dragBehavior.updateDragPlane = false;\n        this._rootMesh.addBehavior(this.dragBehavior);\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                this._handlePivot();\n                // Keep world translation and use it to update world transform\n                // if the node has parent, the local transform properties (position, rotation, scale)\n                // will be recomputed in _matrixChanged function\n                let matrixChanged = false;\n                // Snapping logic\n                if (this.snapDistance == 0) {\n                    this.attachedNode.getWorldMatrix().getTranslationToRef(TmpVectors.Vector3[2]);\n                    TmpVectors.Vector3[2].addInPlace(event.delta);\n                    if (this.dragBehavior.validateDrag(TmpVectors.Vector3[2])) {\n                        if (this.attachedNode.position) {\n                            // Required for nodes like lights\n                            this.attachedNode.position.addInPlaceFromFloats(event.delta.x, event.delta.y, event.delta.z);\n                        }\n                        // use _worldMatrix to not force a matrix update when calling GetWorldMatrix especially with Cameras\n                        this.attachedNode.getWorldMatrix().addTranslationFromFloats(event.delta.x, event.delta.y, event.delta.z);\n                        this.attachedNode.updateCache();\n                        matrixChanged = true;\n                    }\n                }\n                else {\n                    currentSnapDragDistance += event.dragDistance;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        const dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        event.delta.normalizeToRef(TmpVectors.Vector3[1]);\n                        TmpVectors.Vector3[1].scaleInPlace(this.snapDistance * dragSteps);\n                        this.attachedNode.getWorldMatrix().getTranslationToRef(TmpVectors.Vector3[2]);\n                        TmpVectors.Vector3[2].addInPlace(TmpVectors.Vector3[1]);\n                        if (this.dragBehavior.validateDrag(TmpVectors.Vector3[2])) {\n                            this.attachedNode.getWorldMatrix().addTranslationFromFloats(TmpVectors.Vector3[1].x, TmpVectors.Vector3[1].y, TmpVectors.Vector3[1].z);\n                            this.attachedNode.updateCache();\n                            tmpSnapEvent.snapDistance = this.snapDistance * dragSteps;\n                            this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                            matrixChanged = true;\n                        }\n                    }\n                }\n                if (matrixChanged) {\n                    this._matrixChanged();\n                }\n            }\n        });\n        this.dragBehavior.onDragStartObservable.add(() => {\n            this._dragging = true;\n        });\n        this.dragBehavior.onDragEndObservable.add(() => {\n            this._dragging = false;\n        });\n        const light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(false));\n        const cache = {\n            gizmoMeshes: arrow.getChildMeshes(),\n            colliderMeshes: collider.getChildMeshes(),\n            material: this._coloredMaterial,\n            hoverMaterial: this._hoverMaterial,\n            disableMaterial: this._disableMaterial,\n            active: false,\n            dragBehavior: this.dragBehavior,\n        };\n        (_a = this._parent) === null || _a === void 0 ? void 0 : _a.addToAxisCache(collider, cache);\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            var _a;\n            if (this._customMeshSet) {\n                return;\n            }\n            this._isHovered = !!(cache.colliderMeshes.indexOf((_a = pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.pickInfo) === null || _a === void 0 ? void 0 : _a.pickedMesh) != -1);\n            if (!this._parent) {\n                const material = this.dragBehavior.enabled ? (this._isHovered || this._dragging ? this._hoverMaterial : this._coloredMaterial) : this._disableMaterial;\n                this._setGizmoMeshMaterial(cache.gizmoMeshes, material);\n            }\n        });\n        this.dragBehavior.onEnabledObservable.add((newState) => {\n            this._setGizmoMeshMaterial(cache.gizmoMeshes, newState ? cache.material : cache.disableMaterial);\n        });\n    }\n    _attachedNodeChanged(value) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n    /**\n     * If the gizmo is enabled\n     */\n    set isEnabled(value) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedMesh = null;\n            this.attachedNode = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedMesh = this._parent.attachedMesh;\n                this.attachedNode = this._parent.attachedNode;\n            }\n        }\n    }\n    get isEnabled() {\n        return this._isEnabled;\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        if (this._gizmoMesh) {\n            this._gizmoMesh.dispose();\n        }\n        [this._coloredMaterial, this._hoverMaterial, this._disableMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n        super.dispose();\n    }\n}\n//# sourceMappingURL=axisDragGizmo.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { Vector3, Matrix, TmpVectors } from \"../Maths/math.vector.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { CreateBox } from \"../Meshes/Builders/boxBuilder.js\";\nimport { CreateCylinder } from \"../Meshes/Builders/cylinderBuilder.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\nimport { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\n/**\n * Single axis scale gizmo\n */\nexport class AxisScaleGizmo extends Gizmo {\n    /** Default material used to render when gizmo is not disabled or hovered */\n    get coloredMaterial() {\n        return this._coloredMaterial;\n    }\n    /** Material used to render when gizmo is hovered with mouse*/\n    get hoverMaterial() {\n        return this._hoverMaterial;\n    }\n    /** Material used to render when gizmo is disabled. typically grey.*/\n    get disableMaterial() {\n        return this._disableMaterial;\n    }\n    /**\n     * Creates an AxisScaleGizmo\n     * @param dragAxis The axis which the gizmo will be able to scale on\n     * @param color The color of the gizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param parent\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(dragAxis, color = Color3.Gray(), gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer, parent = null, thickness = 1) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        super(gizmoLayer);\n        this._pointerObserver = null;\n        /**\n         * Scale distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n         */\n        this.snapDistance = 0;\n        /**\n         * Event that fires each time the gizmo snaps to a new location.\n         * * snapDistance is the the change in distance\n         */\n        this.onSnapObservable = new Observable();\n        /**\n         * If the scaling operation should be done on all axis (default: false)\n         */\n        this.uniformScaling = false;\n        /**\n         * Custom sensitivity value for the drag strength\n         */\n        this.sensitivity = 1;\n        /**\n         * The magnitude of the drag strength (scaling factor)\n         */\n        this.dragScale = 1;\n        this._isEnabled = true;\n        this._parent = null;\n        this._dragging = false;\n        this._tmpVector = new Vector3(0, 0, 0);\n        this._parent = parent;\n        // Create Material\n        this._coloredMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = color;\n        this._coloredMaterial.specularColor = color.subtract(new Color3(0.1, 0.1, 0.1));\n        this._hoverMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = Color3.Yellow();\n        this._disableMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._disableMaterial.diffuseColor = Color3.Gray();\n        this._disableMaterial.alpha = 0.4;\n        // Build mesh + Collider\n        this._gizmoMesh = new Mesh(\"axis\", gizmoLayer.utilityLayerScene);\n        const { arrowMesh, arrowTail } = this._createGizmoMesh(this._gizmoMesh, thickness);\n        const collider = this._createGizmoMesh(this._gizmoMesh, thickness + 4, true);\n        this._gizmoMesh.lookAt(this._rootMesh.position.add(dragAxis));\n        this._rootMesh.addChild(this._gizmoMesh, Gizmo.PreserveScaling);\n        this._gizmoMesh.scaling.scaleInPlace(1 / 3);\n        // Closure of initial prop values for resetting\n        const nodePosition = arrowMesh.position.clone();\n        const linePosition = arrowTail.position.clone();\n        const lineScale = arrowTail.scaling.clone();\n        const increaseGizmoMesh = (dragDistance) => {\n            const dragStrength = dragDistance * (3 / this._rootMesh.scaling.length()) * 6;\n            arrowMesh.position.z += dragStrength / 3.5;\n            arrowTail.scaling.y += dragStrength;\n            this.dragScale = arrowTail.scaling.y;\n            arrowTail.position.z = arrowMesh.position.z / 2;\n        };\n        const resetGizmoMesh = () => {\n            arrowMesh.position.set(nodePosition.x, nodePosition.y, nodePosition.z);\n            arrowTail.position.set(linePosition.x, linePosition.y, linePosition.z);\n            arrowTail.scaling.set(lineScale.x, lineScale.y, lineScale.z);\n            this.dragScale = arrowTail.scaling.y;\n            this._dragging = false;\n        };\n        // Add drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new PointerDragBehavior({ dragAxis: dragAxis });\n        this.dragBehavior.moveAttached = false;\n        this.dragBehavior.updateDragPlane = false;\n        this._rootMesh.addBehavior(this.dragBehavior);\n        let currentSnapDragDistance = 0;\n        const tmpSnapEvent = { snapDistance: 0 };\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                this._handlePivot();\n                // Drag strength is modified by the scale of the gizmo (eg. for small objects like boombox the strength will be increased to match the behavior of larger objects)\n                const dragStrength = this.sensitivity * event.dragDistance * ((this.scaleRatio * 3) / this._rootMesh.scaling.length());\n                const tmpVector = this._tmpVector;\n                // Snapping logic\n                let snapped = false;\n                let dragSteps = 0;\n                if (this.uniformScaling) {\n                    tmpVector.setAll(0.57735); // 1 / sqrt(3)\n                }\n                else {\n                    tmpVector.copyFrom(dragAxis);\n                }\n                if (this.snapDistance == 0) {\n                    tmpVector.scaleToRef(dragStrength, tmpVector);\n                }\n                else {\n                    currentSnapDragDistance += dragStrength;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        if (currentSnapDragDistance < 0) {\n                            dragSteps *= -1;\n                        }\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        tmpVector.scaleToRef(this.snapDistance * dragSteps, tmpVector);\n                        snapped = true;\n                    }\n                    else {\n                        tmpVector.scaleInPlace(0);\n                    }\n                }\n                Matrix.ScalingToRef(1 + tmpVector.x, 1 + tmpVector.y, 1 + tmpVector.z, TmpVectors.Matrix[2]);\n                TmpVectors.Matrix[2].multiplyToRef(this.attachedNode.getWorldMatrix(), TmpVectors.Matrix[1]);\n                const transformNode = this.attachedNode._isMesh ? this.attachedNode : undefined;\n                TmpVectors.Matrix[1].decompose(TmpVectors.Vector3[1], undefined, undefined, Gizmo.PreserveScaling ? transformNode : undefined);\n                const maxScale = 100000;\n                if (Math.abs(TmpVectors.Vector3[1].x) < maxScale && Math.abs(TmpVectors.Vector3[1].y) < maxScale && Math.abs(TmpVectors.Vector3[1].z) < maxScale) {\n                    this.attachedNode.getWorldMatrix().copyFrom(TmpVectors.Matrix[1]);\n                }\n                if (snapped) {\n                    tmpSnapEvent.snapDistance = this.snapDistance * dragSteps;\n                    this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                }\n                this._matrixChanged();\n            }\n        });\n        // On Drag Listener: to move gizmo mesh with user action\n        this.dragBehavior.onDragStartObservable.add(() => {\n            this._dragging = true;\n        });\n        this.dragBehavior.onDragObservable.add((e) => increaseGizmoMesh(e.dragDistance));\n        this.dragBehavior.onDragEndObservable.add(resetGizmoMesh);\n        // Listeners for Universal Scalar\n        (_c = (_b = (_a = parent === null || parent === void 0 ? void 0 : parent.uniformScaleGizmo) === null || _a === void 0 ? void 0 : _a.dragBehavior) === null || _b === void 0 ? void 0 : _b.onDragObservable) === null || _c === void 0 ? void 0 : _c.add((e) => increaseGizmoMesh(e.delta.y));\n        (_f = (_e = (_d = parent === null || parent === void 0 ? void 0 : parent.uniformScaleGizmo) === null || _d === void 0 ? void 0 : _d.dragBehavior) === null || _e === void 0 ? void 0 : _e.onDragEndObservable) === null || _f === void 0 ? void 0 : _f.add(resetGizmoMesh);\n        const cache = {\n            gizmoMeshes: [arrowMesh, arrowTail],\n            colliderMeshes: [collider.arrowMesh, collider.arrowTail],\n            material: this._coloredMaterial,\n            hoverMaterial: this._hoverMaterial,\n            disableMaterial: this._disableMaterial,\n            active: false,\n            dragBehavior: this.dragBehavior,\n        };\n        (_g = this._parent) === null || _g === void 0 ? void 0 : _g.addToAxisCache(this._gizmoMesh, cache);\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            var _a;\n            if (this._customMeshSet) {\n                return;\n            }\n            this._isHovered = !!(cache.colliderMeshes.indexOf((_a = pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.pickInfo) === null || _a === void 0 ? void 0 : _a.pickedMesh) != -1);\n            if (!this._parent) {\n                const material = this.dragBehavior.enabled ? (this._isHovered || this._dragging ? this._hoverMaterial : this._coloredMaterial) : this._disableMaterial;\n                this._setGizmoMeshMaterial(cache.gizmoMeshes, material);\n            }\n        });\n        this.dragBehavior.onEnabledObservable.add((newState) => {\n            this._setGizmoMeshMaterial(cache.gizmoMeshes, newState ? this._coloredMaterial : this._disableMaterial);\n        });\n        const light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes());\n    }\n    /**\n     * Create Geometry for Gizmo\n     * @param parentMesh\n     * @param thickness\n     * @param isCollider\n     */\n    _createGizmoMesh(parentMesh, thickness, isCollider = false) {\n        const arrowMesh = CreateBox(\"yPosMesh\", { size: 0.4 * (1 + (thickness - 1) / 4) }, this.gizmoLayer.utilityLayerScene);\n        const arrowTail = CreateCylinder(\"cylinder\", { diameterTop: 0.005 * thickness, height: 0.275, diameterBottom: 0.005 * thickness, tessellation: 96 }, this.gizmoLayer.utilityLayerScene);\n        // Position arrow pointing in its drag axis\n        arrowMesh.scaling.scaleInPlace(0.1);\n        arrowMesh.material = this._coloredMaterial;\n        arrowMesh.rotation.x = Math.PI / 2;\n        arrowMesh.position.z += 0.3;\n        arrowTail.material = this._coloredMaterial;\n        arrowTail.position.z += 0.275 / 2;\n        arrowTail.rotation.x = Math.PI / 2;\n        if (isCollider) {\n            arrowMesh.visibility = 0;\n            arrowTail.visibility = 0;\n        }\n        parentMesh.addChild(arrowMesh);\n        parentMesh.addChild(arrowTail);\n        return { arrowMesh, arrowTail };\n    }\n    _attachedNodeChanged(value) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n    /**\n     * If the gizmo is enabled\n     */\n    set isEnabled(value) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedMesh = null;\n            this.attachedNode = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedMesh = this._parent.attachedMesh;\n                this.attachedNode = this._parent.attachedNode;\n            }\n        }\n    }\n    get isEnabled() {\n        return this._isEnabled;\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        if (this._gizmoMesh) {\n            this._gizmoMesh.dispose();\n        }\n        [this._coloredMaterial, this._hoverMaterial, this._disableMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n        super.dispose();\n    }\n    /**\n     * Disposes and replaces the current meshes in the gizmo with the specified mesh\n     * @param mesh The mesh to replace the default mesh of the gizmo\n     * @param useGizmoMaterial If the gizmo's default material should be used (default: false)\n     */\n    setCustomMesh(mesh, useGizmoMaterial = false) {\n        super.setCustomMesh(mesh);\n        if (useGizmoMaterial) {\n            this._rootMesh.getChildMeshes().forEach((m) => {\n                m.material = this._coloredMaterial;\n                if (m.color) {\n                    m.color = this._coloredMaterial.diffuseColor;\n                }\n            });\n            this._customMeshSet = false;\n        }\n    }\n}\n//# sourceMappingURL=axisScaleGizmo.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { Logger } from \"../Misc/logger.js\";\nimport { Quaternion, Matrix, Vector3 } from \"../Maths/math.vector.js\";\nimport { AbstractMesh } from \"../Meshes/abstractMesh.js\";\nimport { CreateSphere } from \"../Meshes/Builders/sphereBuilder.js\";\nimport { CreateBox } from \"../Meshes/Builders/boxBuilder.js\";\nimport { CreateLines } from \"../Meshes/Builders/linesBuilder.js\";\nimport { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\nimport { PivotTools } from \"../Misc/pivotTools.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { Epsilon } from \"../Maths/math.constants.js\";\n/**\n * Bounding box gizmo\n */\nexport class BoundingBoxGizmo extends Gizmo {\n    /**\n     * Sets the axis factor\n     * @param factor the Vector3 value\n     */\n    set axisFactor(factor) {\n        this._axisFactor = factor;\n        // update scale cube visibility\n        const scaleBoxes = this._scaleBoxesParent.getChildMeshes();\n        let index = 0;\n        for (let i = 0; i < 3; i++) {\n            for (let j = 0; j < 3; j++) {\n                for (let k = 0; k < 3; k++) {\n                    const zeroAxisCount = (i === 1 ? 1 : 0) + (j === 1 ? 1 : 0) + (k === 1 ? 1 : 0);\n                    if (zeroAxisCount === 1 || zeroAxisCount === 3) {\n                        continue;\n                    }\n                    if (scaleBoxes[index]) {\n                        const dragAxis = new Vector3(i - 1, j - 1, k - 1);\n                        dragAxis.multiplyInPlace(this._axisFactor);\n                        scaleBoxes[index].setEnabled(dragAxis.lengthSquared() > Epsilon);\n                    }\n                    index++;\n                }\n            }\n        }\n    }\n    /**\n     * Gets the axis factor\n     * @returns the Vector3 factor value\n     */\n    get axisFactor() {\n        return this._axisFactor;\n    }\n    /**\n     * Sets scale drag speed value\n     * @param value the new speed value\n     */\n    set scaleDragSpeed(value) {\n        this._scaleDragSpeed = value;\n    }\n    /**\n     * Gets scale drag speed\n     * @returns the scale speed number\n     */\n    get scaleDragSpeed() {\n        return this._scaleDragSpeed;\n    }\n    /** Default material used to render when gizmo is not disabled or hovered */\n    get coloredMaterial() {\n        return this._coloredMaterial;\n    }\n    /** Material used to render when gizmo is hovered with mouse*/\n    get hoverMaterial() {\n        return this._hoverColoredMaterial;\n    }\n    /**\n     * Get the pointerDragBehavior\n     */\n    get pointerDragBehavior() {\n        return this._pointerDragBehavior;\n    }\n    /**\n     * Sets the color of the bounding box gizmo\n     * @param color the color to set\n     */\n    setColor(color) {\n        this._coloredMaterial.emissiveColor = color;\n        this._hoverColoredMaterial.emissiveColor = color.clone().add(new Color3(0.3, 0.3, 0.3));\n        this._lineBoundingBox.getChildren().forEach((l) => {\n            if (l.color) {\n                l.color = color;\n            }\n        });\n    }\n    /**\n     * Creates an BoundingBoxGizmo\n     * @param color The color of the gizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     */\n    constructor(color = Color3.Gray(), gizmoLayer = UtilityLayerRenderer.DefaultKeepDepthUtilityLayer) {\n        super(gizmoLayer);\n        this._boundingDimensions = new Vector3(1, 1, 1);\n        this._renderObserver = null;\n        this._pointerObserver = null;\n        this._scaleDragSpeed = 0.2;\n        this._tmpQuaternion = new Quaternion();\n        this._tmpVector = new Vector3(0, 0, 0);\n        this._tmpRotationMatrix = new Matrix();\n        /**\n         * If child meshes should be ignored when calculating the bounding box. This should be set to true to avoid perf hits with heavily nested meshes (Default: false)\n         */\n        this.ignoreChildren = false;\n        /**\n         * Returns true if a descendant should be included when computing the bounding box. When null, all descendants are included. If ignoreChildren is set this will be ignored. (Default: null)\n         */\n        this.includeChildPredicate = null;\n        /**\n         * The size of the rotation spheres attached to the bounding box (Default: 0.1)\n         */\n        this.rotationSphereSize = 0.1;\n        /**\n         * The size of the scale boxes attached to the bounding box (Default: 0.1)\n         */\n        this.scaleBoxSize = 0.1;\n        /**\n         * If set, the rotation spheres and scale boxes will increase in size based on the distance away from the camera to have a consistent screen size (Default: false)\n         * Note : fixedDragMeshScreenSize takes precedence over fixedDragMeshBoundsSize if both are true\n         */\n        this.fixedDragMeshScreenSize = false;\n        /**\n         * If set, the rotation spheres and scale boxes will increase in size based on the size of the bounding box\n         * Note : fixedDragMeshScreenSize takes precedence over fixedDragMeshBoundsSize if both are true\n         */\n        this.fixedDragMeshBoundsSize = false;\n        /**\n         * The distance away from the object which the draggable meshes should appear world sized when fixedDragMeshScreenSize is set to true (default: 10)\n         */\n        this.fixedDragMeshScreenSizeDistanceFactor = 10;\n        /**\n         * Fired when a rotation sphere or scale box is dragged\n         */\n        this.onDragStartObservable = new Observable();\n        /**\n         * Fired when a scale box is dragged\n         */\n        this.onScaleBoxDragObservable = new Observable();\n        /**\n         * Fired when a scale box drag is ended\n         */\n        this.onScaleBoxDragEndObservable = new Observable();\n        /**\n         * Fired when a rotation sphere is dragged\n         */\n        this.onRotationSphereDragObservable = new Observable();\n        /**\n         * Fired when a rotation sphere drag is ended\n         */\n        this.onRotationSphereDragEndObservable = new Observable();\n        /**\n         * Relative bounding box pivot used when scaling the attached node. When null object with scale from the opposite corner. 0.5,0.5,0.5 for center and 0.5,0,0.5 for bottom (Default: null)\n         */\n        this.scalePivot = null;\n        /**\n         * Scale factor used for masking some axis\n         */\n        this._axisFactor = new Vector3(1, 1, 1);\n        this._existingMeshScale = new Vector3();\n        // Dragging\n        this._dragMesh = null;\n        this._pointerDragBehavior = new PointerDragBehavior();\n        // Do not update the gizmo's scale so it has a fixed size to the object its attached to\n        this.updateScale = false;\n        this._anchorMesh = new AbstractMesh(\"anchor\", gizmoLayer.utilityLayerScene);\n        // Create Materials\n        this._coloredMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.disableLighting = true;\n        this._hoverColoredMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverColoredMaterial.disableLighting = true;\n        // Build bounding box out of lines\n        this._lineBoundingBox = new AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n        this._lineBoundingBox.rotationQuaternion = new Quaternion();\n        const lines = [];\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(0, 0, 0), new Vector3(this._boundingDimensions.x, 0, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(0, 0, 0), new Vector3(0, this._boundingDimensions.y, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(0, 0, 0), new Vector3(0, 0, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(this._boundingDimensions.x, 0, 0), new Vector3(this._boundingDimensions.x, this._boundingDimensions.y, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(this._boundingDimensions.x, 0, 0), new Vector3(this._boundingDimensions.x, 0, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(0, this._boundingDimensions.y, 0), new Vector3(this._boundingDimensions.x, this._boundingDimensions.y, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(0, this._boundingDimensions.y, 0), new Vector3(0, this._boundingDimensions.y, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(0, 0, this._boundingDimensions.z), new Vector3(this._boundingDimensions.x, 0, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", { points: [new Vector3(0, 0, this._boundingDimensions.z), new Vector3(0, this._boundingDimensions.y, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", {\n            points: [\n                new Vector3(this._boundingDimensions.x, this._boundingDimensions.y, this._boundingDimensions.z),\n                new Vector3(0, this._boundingDimensions.y, this._boundingDimensions.z),\n            ],\n        }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", {\n            points: [\n                new Vector3(this._boundingDimensions.x, this._boundingDimensions.y, this._boundingDimensions.z),\n                new Vector3(this._boundingDimensions.x, 0, this._boundingDimensions.z),\n            ],\n        }, gizmoLayer.utilityLayerScene));\n        lines.push(CreateLines(\"lines\", {\n            points: [\n                new Vector3(this._boundingDimensions.x, this._boundingDimensions.y, this._boundingDimensions.z),\n                new Vector3(this._boundingDimensions.x, this._boundingDimensions.y, 0),\n            ],\n        }, gizmoLayer.utilityLayerScene));\n        lines.forEach((l) => {\n            l.color = color;\n            l.position.addInPlace(new Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n            l.isPickable = false;\n            this._lineBoundingBox.addChild(l);\n        });\n        this._rootMesh.addChild(this._lineBoundingBox);\n        this.setColor(color);\n        // Create rotation spheres\n        this._rotateSpheresParent = new AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n        this._rotateSpheresParent.rotationQuaternion = new Quaternion();\n        for (let i = 0; i < 12; i++) {\n            const sphere = CreateSphere(\"\", { diameter: 1 }, gizmoLayer.utilityLayerScene);\n            sphere.rotationQuaternion = new Quaternion();\n            sphere.material = this._coloredMaterial;\n            sphere.isNearGrabbable = true;\n            // Drag behavior\n            const _dragBehavior = new PointerDragBehavior({});\n            _dragBehavior.moveAttached = false;\n            _dragBehavior.updateDragPlane = false;\n            sphere.addBehavior(_dragBehavior);\n            const startingTurnDirection = new Vector3(1, 0, 0);\n            let totalTurnAmountOfDrag = 0;\n            _dragBehavior.onDragStartObservable.add(() => {\n                startingTurnDirection.copyFrom(sphere.forward);\n                totalTurnAmountOfDrag = 0;\n            });\n            _dragBehavior.onDragObservable.add((event) => {\n                this.onRotationSphereDragObservable.notifyObservers({});\n                if (this.attachedMesh) {\n                    const originalParent = this.attachedMesh.parent;\n                    if (originalParent && originalParent.scaling && originalParent.scaling.isNonUniformWithinEpsilon(0.001)) {\n                        Logger.Warn(\"BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling\");\n                        return;\n                    }\n                    PivotTools._RemoveAndStorePivotPoint(this.attachedMesh);\n                    const worldDragDirection = startingTurnDirection;\n                    // Project the world right on to the drag plane\n                    const toSub = event.dragPlaneNormal.scale(Vector3.Dot(event.dragPlaneNormal, worldDragDirection));\n                    const dragAxis = worldDragDirection.subtract(toSub).normalizeToNew();\n                    // project drag delta on to the resulting drag axis and rotate based on that\n                    let projectDist = Vector3.Dot(dragAxis, event.delta) < 0 ? Math.abs(event.delta.length()) : -Math.abs(event.delta.length());\n                    // Make rotation relative to size of mesh.\n                    projectDist = (projectDist / this._boundingDimensions.length()) * this._anchorMesh.scaling.length();\n                    // Rotate based on axis\n                    if (!this.attachedMesh.rotationQuaternion) {\n                        this.attachedMesh.rotationQuaternion = Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y, this.attachedMesh.rotation.x, this.attachedMesh.rotation.z);\n                    }\n                    if (!this._anchorMesh.rotationQuaternion) {\n                        this._anchorMesh.rotationQuaternion = Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y, this._anchorMesh.rotation.x, this._anchorMesh.rotation.z);\n                    }\n                    // Do not allow the object to turn more than a full circle\n                    totalTurnAmountOfDrag += projectDist;\n                    if (Math.abs(totalTurnAmountOfDrag) <= 2 * Math.PI) {\n                        if (i >= 8) {\n                            Quaternion.RotationYawPitchRollToRef(0, 0, projectDist, this._tmpQuaternion);\n                        }\n                        else if (i >= 4) {\n                            Quaternion.RotationYawPitchRollToRef(projectDist, 0, 0, this._tmpQuaternion);\n                        }\n                        else {\n                            Quaternion.RotationYawPitchRollToRef(0, projectDist, 0, this._tmpQuaternion);\n                        }\n                        // Rotate around center of bounding box\n                        this._anchorMesh.addChild(this.attachedMesh, Gizmo.PreserveScaling);\n                        if (this._anchorMesh.getScene().useRightHandedSystem) {\n                            this._tmpQuaternion.conjugateInPlace();\n                        }\n                        this._anchorMesh.rotationQuaternion.multiplyToRef(this._tmpQuaternion, this._anchorMesh.rotationQuaternion);\n                        this._anchorMesh.removeChild(this.attachedMesh, Gizmo.PreserveScaling);\n                        this.attachedMesh.setParent(originalParent, Gizmo.PreserveScaling);\n                    }\n                    this.updateBoundingBox();\n                    PivotTools._RestorePivotPoint(this.attachedMesh);\n                }\n                this._updateDummy();\n            });\n            // Selection/deselection\n            _dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n                this._selectNode(sphere);\n            });\n            _dragBehavior.onDragEndObservable.add((event) => {\n                this.onRotationSphereDragEndObservable.notifyObservers({});\n                this._selectNode(null);\n                this._updateDummy();\n                this._unhoverMeshOnTouchUp(event.pointerInfo, sphere);\n            });\n            this._rotateSpheresParent.addChild(sphere);\n        }\n        this._rootMesh.addChild(this._rotateSpheresParent);\n        // Create scale cubes\n        this._scaleBoxesParent = new AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n        this._scaleBoxesParent.rotationQuaternion = new Quaternion();\n        for (let i = 0; i < 3; i++) {\n            for (let j = 0; j < 3; j++) {\n                for (let k = 0; k < 3; k++) {\n                    // create box for relevant axis\n                    const zeroAxisCount = (i === 1 ? 1 : 0) + (j === 1 ? 1 : 0) + (k === 1 ? 1 : 0);\n                    if (zeroAxisCount === 1 || zeroAxisCount === 3) {\n                        continue;\n                    }\n                    const box = CreateBox(\"\", { size: 1 }, gizmoLayer.utilityLayerScene);\n                    box.material = this._coloredMaterial;\n                    box._internalMetadata = zeroAxisCount === 2; // None homogenous scale handle\n                    box.isNearGrabbable = true;\n                    // Dragging logic\n                    const dragAxis = new Vector3(i - 1, j - 1, k - 1).normalize();\n                    const _dragBehavior = new PointerDragBehavior({ dragAxis: dragAxis });\n                    _dragBehavior.updateDragPlane = false;\n                    _dragBehavior.moveAttached = false;\n                    box.addBehavior(_dragBehavior);\n                    _dragBehavior.onDragObservable.add((event) => {\n                        this.onScaleBoxDragObservable.notifyObservers({});\n                        if (this.attachedMesh) {\n                            const originalParent = this.attachedMesh.parent;\n                            if (originalParent && originalParent.scaling && originalParent.scaling.isNonUniformWithinEpsilon(0.001)) {\n                                Logger.Warn(\"BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling\");\n                                return;\n                            }\n                            PivotTools._RemoveAndStorePivotPoint(this.attachedMesh);\n                            const relativeDragDistance = (event.dragDistance / this._boundingDimensions.length()) * this._anchorMesh.scaling.length();\n                            const deltaScale = new Vector3(relativeDragDistance, relativeDragDistance, relativeDragDistance);\n                            if (zeroAxisCount === 2) {\n                                // scale on 1 axis when using the anchor box in the face middle\n                                deltaScale.x *= Math.abs(dragAxis.x);\n                                deltaScale.y *= Math.abs(dragAxis.y);\n                                deltaScale.z *= Math.abs(dragAxis.z);\n                            }\n                            deltaScale.scaleInPlace(this._scaleDragSpeed);\n                            deltaScale.multiplyInPlace(this._axisFactor);\n                            this.updateBoundingBox();\n                            if (this.scalePivot) {\n                                this.attachedMesh.getWorldMatrix().getRotationMatrixToRef(this._tmpRotationMatrix);\n                                // Move anchor to desired pivot point (Bottom left corner + dimension/2)\n                                this._boundingDimensions.scaleToRef(0.5, this._tmpVector);\n                                Vector3.TransformCoordinatesToRef(this._tmpVector, this._tmpRotationMatrix, this._tmpVector);\n                                this._anchorMesh.position.subtractInPlace(this._tmpVector);\n                                this._boundingDimensions.multiplyToRef(this.scalePivot, this._tmpVector);\n                                Vector3.TransformCoordinatesToRef(this._tmpVector, this._tmpRotationMatrix, this._tmpVector);\n                                this._anchorMesh.position.addInPlace(this._tmpVector);\n                            }\n                            else {\n                                // Scale from the position of the opposite corner\n                                box.absolutePosition.subtractToRef(this._anchorMesh.position, this._tmpVector);\n                                this._anchorMesh.position.subtractInPlace(this._tmpVector);\n                            }\n                            this._anchorMesh.addChild(this.attachedMesh, Gizmo.PreserveScaling);\n                            this._anchorMesh.scaling.addInPlace(deltaScale);\n                            if (this._anchorMesh.scaling.x < 0 || this._anchorMesh.scaling.y < 0 || this._anchorMesh.scaling.z < 0) {\n                                this._anchorMesh.scaling.subtractInPlace(deltaScale);\n                            }\n                            this._anchorMesh.removeChild(this.attachedMesh, Gizmo.PreserveScaling);\n                            this.attachedMesh.setParent(originalParent, Gizmo.PreserveScaling);\n                            PivotTools._RestorePivotPoint(this.attachedMesh);\n                        }\n                        this._updateDummy();\n                    });\n                    // Selection/deselection\n                    _dragBehavior.onDragStartObservable.add(() => {\n                        this.onDragStartObservable.notifyObservers({});\n                        this._selectNode(box);\n                    });\n                    _dragBehavior.onDragEndObservable.add((event) => {\n                        this.onScaleBoxDragEndObservable.notifyObservers({});\n                        this._selectNode(null);\n                        this._updateDummy();\n                        this._unhoverMeshOnTouchUp(event.pointerInfo, box);\n                    });\n                    this._scaleBoxesParent.addChild(box);\n                }\n            }\n        }\n        this._rootMesh.addChild(this._scaleBoxesParent);\n        // Hover color change\n        const pointerIds = new Array();\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (!pointerIds[pointerInfo.event.pointerId]) {\n                this._rotateSpheresParent\n                    .getChildMeshes()\n                    .concat(this._scaleBoxesParent.getChildMeshes())\n                    .forEach((mesh) => {\n                    if (pointerInfo.pickInfo && pointerInfo.pickInfo.pickedMesh == mesh) {\n                        pointerIds[pointerInfo.event.pointerId] = mesh;\n                        mesh.material = this._hoverColoredMaterial;\n                    }\n                });\n            }\n            else {\n                if (pointerInfo.pickInfo && pointerInfo.pickInfo.pickedMesh != pointerIds[pointerInfo.event.pointerId]) {\n                    pointerIds[pointerInfo.event.pointerId].material = this._coloredMaterial;\n                    delete pointerIds[pointerInfo.event.pointerId];\n                }\n            }\n        });\n        // Update bounding box positions\n        this._renderObserver = this.gizmoLayer.originalScene.onBeforeRenderObservable.add(() => {\n            // Only update the bounding box if scaling has changed\n            if (this.attachedMesh && !this._existingMeshScale.equals(this.attachedMesh.scaling)) {\n                this.updateBoundingBox();\n            }\n            else if (this.fixedDragMeshScreenSize || this.fixedDragMeshBoundsSize) {\n                this._updateRotationSpheres();\n                this._updateScaleBoxes();\n            }\n            // If drag mesh is enabled and dragging, update the attached mesh pose to match the drag mesh\n            if (this._dragMesh && this.attachedMesh && this._pointerDragBehavior.dragging) {\n                this._lineBoundingBox.position.rotateByQuaternionToRef(this._rootMesh.rotationQuaternion, this._tmpVector);\n                this.attachedMesh.setAbsolutePosition(this._dragMesh.position.add(this._tmpVector.scale(-1)));\n            }\n        });\n        this.updateBoundingBox();\n    }\n    _attachedNodeChanged(value) {\n        if (value) {\n            // Reset anchor mesh to match attached mesh's scale\n            // This is needed to avoid invalid box/sphere position on first drag\n            this._anchorMesh.scaling.setAll(1);\n            PivotTools._RemoveAndStorePivotPoint(value);\n            const originalParent = value.parent;\n            this._anchorMesh.addChild(value, Gizmo.PreserveScaling);\n            this._anchorMesh.removeChild(value, Gizmo.PreserveScaling);\n            value.setParent(originalParent, Gizmo.PreserveScaling);\n            PivotTools._RestorePivotPoint(value);\n            this.updateBoundingBox();\n            value.getChildMeshes(false).forEach((m) => {\n                m.markAsDirty(\"scaling\");\n            });\n            this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(() => {\n                this._updateDummy();\n            });\n        }\n    }\n    _selectNode(selectedMesh) {\n        this._rotateSpheresParent\n            .getChildMeshes()\n            .concat(this._scaleBoxesParent.getChildMeshes())\n            .forEach((m) => {\n            m.isVisible = !selectedMesh || m == selectedMesh;\n        });\n    }\n    _unhoverMeshOnTouchUp(pointerInfo, selectedMesh) {\n        // force unhover mesh if not a mouse event\n        if ((pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.event) instanceof PointerEvent && (pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.event.pointerType) === \"touch\") {\n            selectedMesh.material = this._coloredMaterial;\n        }\n    }\n    /**\n     * returns an array containing all boxes used for scaling (in increasing x, y and z orders)\n     */\n    getScaleBoxes() {\n        return this._scaleBoxesParent.getChildMeshes();\n    }\n    /**\n     * Updates the bounding box information for the Gizmo\n     */\n    updateBoundingBox() {\n        if (this.attachedMesh) {\n            PivotTools._RemoveAndStorePivotPoint(this.attachedMesh);\n            // Store original parent\n            const originalParent = this.attachedMesh.parent;\n            this.attachedMesh.setParent(null, Gizmo.PreserveScaling);\n            this._update();\n            // Rotate based on axis\n            if (!this.attachedMesh.rotationQuaternion) {\n                this.attachedMesh.rotationQuaternion = Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y, this.attachedMesh.rotation.x, this.attachedMesh.rotation.z);\n            }\n            if (!this._anchorMesh.rotationQuaternion) {\n                this._anchorMesh.rotationQuaternion = Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y, this._anchorMesh.rotation.x, this._anchorMesh.rotation.z);\n            }\n            this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion);\n            // Store original position and reset mesh to origin before computing the bounding box\n            this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion);\n            this._tmpVector.copyFrom(this.attachedMesh.position);\n            this.attachedMesh.rotationQuaternion.set(0, 0, 0, 1);\n            this.attachedMesh.position.set(0, 0, 0);\n            // Update bounding dimensions/positions\n            const boundingMinMax = this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren, this.includeChildPredicate);\n            boundingMinMax.max.subtractToRef(boundingMinMax.min, this._boundingDimensions);\n            // Update gizmo to match bounding box scaling and rotation\n            // The position set here is the offset from the origin for the boundingbox when the attached mesh is at the origin\n            // The position of the gizmo is then set to the attachedMesh in gizmo._update\n            this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions);\n            this._lineBoundingBox.position.set((boundingMinMax.max.x + boundingMinMax.min.x) / 2, (boundingMinMax.max.y + boundingMinMax.min.y) / 2, (boundingMinMax.max.z + boundingMinMax.min.z) / 2);\n            this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position);\n            this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position);\n            this._lineBoundingBox.computeWorldMatrix();\n            this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition);\n            // Restore position/rotation values\n            this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion);\n            this.attachedMesh.position.copyFrom(this._tmpVector);\n            // Restore original parent\n            this.attachedMesh.setParent(originalParent, Gizmo.PreserveScaling);\n        }\n        this._updateRotationSpheres();\n        this._updateScaleBoxes();\n        if (this.attachedMesh) {\n            this._existingMeshScale.copyFrom(this.attachedMesh.scaling);\n            PivotTools._RestorePivotPoint(this.attachedMesh);\n        }\n    }\n    _updateRotationSpheres() {\n        const rotateSpheres = this._rotateSpheresParent.getChildMeshes();\n        for (let i = 0; i < 3; i++) {\n            for (let j = 0; j < 2; j++) {\n                for (let k = 0; k < 2; k++) {\n                    const index = i * 4 + j * 2 + k;\n                    if (i == 0) {\n                        rotateSpheres[index].position.set(this._boundingDimensions.x / 2, this._boundingDimensions.y * j, this._boundingDimensions.z * k);\n                        rotateSpheres[index].position.addInPlace(new Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        rotateSpheres[index].lookAt(Vector3.Cross(rotateSpheres[index].position.normalizeToNew(), Vector3.Right()).normalizeToNew().add(rotateSpheres[index].position));\n                    }\n                    if (i == 1) {\n                        rotateSpheres[index].position.set(this._boundingDimensions.x * j, this._boundingDimensions.y / 2, this._boundingDimensions.z * k);\n                        rotateSpheres[index].position.addInPlace(new Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        rotateSpheres[index].lookAt(Vector3.Cross(rotateSpheres[index].position.normalizeToNew(), Vector3.Up()).normalizeToNew().add(rotateSpheres[index].position));\n                    }\n                    if (i == 2) {\n                        rotateSpheres[index].position.set(this._boundingDimensions.x * j, this._boundingDimensions.y * k, this._boundingDimensions.z / 2);\n                        rotateSpheres[index].position.addInPlace(new Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        rotateSpheres[index].lookAt(Vector3.Cross(rotateSpheres[index].position.normalizeToNew(), Vector3.Forward()).normalizeToNew().add(rotateSpheres[index].position));\n                    }\n                    if (this.fixedDragMeshScreenSize && this.gizmoLayer.utilityLayerScene.activeCamera) {\n                        rotateSpheres[index].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector);\n                        const distanceFromCamera = (this.rotationSphereSize * this._tmpVector.length()) / this.fixedDragMeshScreenSizeDistanceFactor;\n                        rotateSpheres[index].scaling.set(distanceFromCamera, distanceFromCamera, distanceFromCamera);\n                    }\n                    else if (this.fixedDragMeshBoundsSize) {\n                        rotateSpheres[index].scaling.set(this.rotationSphereSize * this._boundingDimensions.x, this.rotationSphereSize * this._boundingDimensions.y, this.rotationSphereSize * this._boundingDimensions.z);\n                    }\n                    else {\n                        rotateSpheres[index].scaling.set(this.rotationSphereSize, this.rotationSphereSize, this.rotationSphereSize);\n                    }\n                }\n            }\n        }\n    }\n    _updateScaleBoxes() {\n        const scaleBoxes = this._scaleBoxesParent.getChildMeshes();\n        let index = 0;\n        for (let i = 0; i < 3; i++) {\n            for (let j = 0; j < 3; j++) {\n                for (let k = 0; k < 3; k++) {\n                    const zeroAxisCount = (i === 1 ? 1 : 0) + (j === 1 ? 1 : 0) + (k === 1 ? 1 : 0);\n                    if (zeroAxisCount === 1 || zeroAxisCount === 3) {\n                        continue;\n                    }\n                    if (scaleBoxes[index]) {\n                        scaleBoxes[index].position.set(this._boundingDimensions.x * (i / 2), this._boundingDimensions.y * (j / 2), this._boundingDimensions.z * (k / 2));\n                        scaleBoxes[index].position.addInPlace(new Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        if (this.fixedDragMeshScreenSize && this.gizmoLayer.utilityLayerScene.activeCamera) {\n                            scaleBoxes[index].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector);\n                            const distanceFromCamera = (this.scaleBoxSize * this._tmpVector.length()) / this.fixedDragMeshScreenSizeDistanceFactor;\n                            scaleBoxes[index].scaling.set(distanceFromCamera, distanceFromCamera, distanceFromCamera);\n                        }\n                        else if (this.fixedDragMeshBoundsSize) {\n                            scaleBoxes[index].scaling.set(this.scaleBoxSize * this._boundingDimensions.x, this.scaleBoxSize * this._boundingDimensions.y, this.scaleBoxSize * this._boundingDimensions.z);\n                        }\n                        else {\n                            scaleBoxes[index].scaling.set(this.scaleBoxSize, this.scaleBoxSize, this.scaleBoxSize);\n                        }\n                    }\n                    index++;\n                }\n            }\n        }\n    }\n    /**\n     * Enables rotation on the specified axis and disables rotation on the others\n     * @param axis The list of axis that should be enabled (eg. \"xy\" or \"xyz\")\n     */\n    setEnabledRotationAxis(axis) {\n        this._rotateSpheresParent.getChildMeshes().forEach((m, i) => {\n            if (i < 4) {\n                m.setEnabled(axis.indexOf(\"x\") != -1);\n            }\n            else if (i < 8) {\n                m.setEnabled(axis.indexOf(\"y\") != -1);\n            }\n            else {\n                m.setEnabled(axis.indexOf(\"z\") != -1);\n            }\n        });\n    }\n    /**\n     * Enables/disables scaling\n     * @param enable if scaling should be enabled\n     * @param homogeneousScaling defines if scaling should only be homogeneous\n     */\n    setEnabledScaling(enable, homogeneousScaling = false) {\n        this._scaleBoxesParent.getChildMeshes().forEach((m) => {\n            let enableMesh = enable;\n            // Disable heterogeneous scale handles if requested.\n            if (homogeneousScaling && m._internalMetadata === true) {\n                enableMesh = false;\n            }\n            m.setEnabled(enableMesh);\n        });\n    }\n    _updateDummy() {\n        if (this._dragMesh) {\n            this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition());\n            this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling);\n            this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion);\n        }\n    }\n    /**\n     * Enables a pointer drag behavior on the bounding box of the gizmo\n     */\n    enableDragBehavior() {\n        this._dragMesh = CreateBox(\"dummy\", { size: 1 }, this.gizmoLayer.utilityLayerScene);\n        this._dragMesh.visibility = 0;\n        this._dragMesh.rotationQuaternion = new Quaternion();\n        this._pointerDragBehavior.useObjectOrientationForDragging = false;\n        this._dragMesh.addBehavior(this._pointerDragBehavior);\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver);\n        this._lineBoundingBox.dispose();\n        this._rotateSpheresParent.dispose();\n        this._scaleBoxesParent.dispose();\n        if (this._dragMesh) {\n            this._dragMesh.dispose();\n        }\n        super.dispose();\n    }\n    /**\n     * Makes a mesh not pickable and wraps the mesh inside of a bounding box mesh that is pickable. (This is useful to avoid picking within complex geometry)\n     * @param mesh the mesh to wrap in the bounding box mesh and make not pickable\n     * @returns the bounding box mesh with the passed in mesh as a child\n     */\n    static MakeNotPickableAndWrapInBoundingBox(mesh) {\n        const makeNotPickable = (root) => {\n            root.isPickable = false;\n            root.getChildMeshes().forEach((c) => {\n                makeNotPickable(c);\n            });\n        };\n        makeNotPickable(mesh);\n        // Reset position to get bounding box from origin with no rotation\n        if (!mesh.rotationQuaternion) {\n            mesh.rotationQuaternion = Quaternion.RotationYawPitchRoll(mesh.rotation.y, mesh.rotation.x, mesh.rotation.z);\n        }\n        const oldPos = mesh.position.clone();\n        const oldRot = mesh.rotationQuaternion.clone();\n        mesh.rotationQuaternion.set(0, 0, 0, 1);\n        mesh.position.set(0, 0, 0);\n        // Update bounding dimensions/positions\n        const box = CreateBox(\"box\", { size: 1 }, mesh.getScene());\n        const boundingMinMax = mesh.getHierarchyBoundingVectors();\n        boundingMinMax.max.subtractToRef(boundingMinMax.min, box.scaling);\n        // Adjust scale to avoid undefined behavior when adding child\n        if (box.scaling.y === 0) {\n            box.scaling.y = Epsilon;\n        }\n        if (box.scaling.x === 0) {\n            box.scaling.x = Epsilon;\n        }\n        if (box.scaling.z === 0) {\n            box.scaling.z = Epsilon;\n        }\n        box.position.set((boundingMinMax.max.x + boundingMinMax.min.x) / 2, (boundingMinMax.max.y + boundingMinMax.min.y) / 2, (boundingMinMax.max.z + boundingMinMax.min.z) / 2);\n        // Restore original positions\n        mesh.addChild(box);\n        mesh.rotationQuaternion.copyFrom(oldRot);\n        mesh.position.copyFrom(oldPos);\n        // Reverse parenting\n        mesh.removeChild(box);\n        box.addChild(mesh);\n        box.visibility = 0;\n        return box;\n    }\n    /**\n     * CustomMeshes are not supported by this gizmo\n     */\n    setCustomMesh() {\n        Logger.Error(\"Custom meshes are not supported on this gizmo\");\n    }\n}\n//# sourceMappingURL=boundingBoxGizmo.js.map","import { Quaternion, Vector3, Matrix, TmpVectors } from \"../Maths/math.vector.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { Camera } from \"../Cameras/camera.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { PointerEventTypes } from \"../Events/pointerEvents.js\";\nimport { Light } from \"../Lights/light.js\";\n/**\n * Renders gizmos on top of an existing scene which provide controls for position, rotation, etc.\n */\nexport class Gizmo {\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    set scaleRatio(value) {\n        this._scaleRatio = value;\n    }\n    get scaleRatio() {\n        return this._scaleRatio;\n    }\n    /**\n     * True when the mouse pointer is hovered a gizmo mesh\n     */\n    get isHovered() {\n        return this._isHovered;\n    }\n    /**\n     * Mesh that the gizmo will be attached to. (eg. on a drag gizmo the mesh that will be dragged)\n     * * When set, interactions will be enabled\n     */\n    get attachedMesh() {\n        return this._attachedMesh;\n    }\n    set attachedMesh(value) {\n        this._attachedMesh = value;\n        if (value) {\n            this._attachedNode = value;\n        }\n        this._rootMesh.setEnabled(value ? true : false);\n        this._attachedNodeChanged(value);\n    }\n    /**\n     * Node that the gizmo will be attached to. (eg. on a drag gizmo the mesh, bone or NodeTransform that will be dragged)\n     * * When set, interactions will be enabled\n     */\n    get attachedNode() {\n        return this._attachedNode;\n    }\n    set attachedNode(value) {\n        this._attachedNode = value;\n        this._attachedMesh = null;\n        this._rootMesh.setEnabled(value ? true : false);\n        this._attachedNodeChanged(value);\n    }\n    /**\n     * Disposes and replaces the current meshes in the gizmo with the specified mesh\n     * @param mesh The mesh to replace the default mesh of the gizmo\n     */\n    setCustomMesh(mesh) {\n        if (mesh.getScene() != this.gizmoLayer.utilityLayerScene) {\n            throw \"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)\";\n        }\n        this._rootMesh.getChildMeshes().forEach((c) => {\n            c.dispose();\n        });\n        mesh.parent = this._rootMesh;\n        this._customMeshSet = true;\n    }\n    /**\n     * If set the gizmo's rotation will be updated to match the attached mesh each frame (Default: true)\n     * NOTE: This is only possible for meshes with uniform scaling, as otherwise it's not possible to decompose the rotation\n     */\n    set updateGizmoRotationToMatchAttachedMesh(value) {\n        this._updateGizmoRotationToMatchAttachedMesh = value;\n    }\n    get updateGizmoRotationToMatchAttachedMesh() {\n        return this._updateGizmoRotationToMatchAttachedMesh;\n    }\n    /**\n     * If set the gizmo's position will be updated to match the attached mesh each frame (Default: true)\n     */\n    set updateGizmoPositionToMatchAttachedMesh(value) {\n        this._updateGizmoPositionToMatchAttachedMesh = value;\n    }\n    get updateGizmoPositionToMatchAttachedMesh() {\n        return this._updateGizmoPositionToMatchAttachedMesh;\n    }\n    /**\n     * When set, the gizmo will always appear the same size no matter where the camera is (default: true)\n     */\n    set updateScale(value) {\n        this._updateScale = value;\n    }\n    get updateScale() {\n        return this._updateScale;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _attachedNodeChanged(value) { }\n    /**\n     * Creates a gizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     */\n    constructor(\n    /** The utility layer the gizmo will be added to */\n    gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer) {\n        this.gizmoLayer = gizmoLayer;\n        this._attachedMesh = null;\n        this._attachedNode = null;\n        this._customRotationQuaternion = null;\n        /**\n         * Ratio for the scale of the gizmo (Default: 1)\n         */\n        this._scaleRatio = 1;\n        /**\n         * boolean updated by pointermove when a gizmo mesh is hovered\n         */\n        this._isHovered = false;\n        /**\n         * If a custom mesh has been set (Default: false)\n         */\n        this._customMeshSet = false;\n        this._updateGizmoRotationToMatchAttachedMesh = true;\n        this._updateGizmoPositionToMatchAttachedMesh = true;\n        this._updateScale = true;\n        this._interactionsEnabled = true;\n        this._rightHandtoLeftHandMatrix = Matrix.RotationY(Math.PI);\n        this._rootMesh = new Mesh(\"gizmoRootNode\", gizmoLayer.utilityLayerScene);\n        this._rootMesh.rotationQuaternion = Quaternion.Identity();\n        this._beforeRenderObserver = this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(() => {\n            this._update();\n        });\n    }\n    /**\n     * posture that the gizmo will be display\n     * When set null, default value will be used (Quaternion(0, 0, 0, 1))\n     */\n    get customRotationQuaternion() {\n        return this._customRotationQuaternion;\n    }\n    set customRotationQuaternion(customRotationQuaternion) {\n        this._customRotationQuaternion = customRotationQuaternion;\n    }\n    /**\n     * Updates the gizmo to match the attached mesh's position/rotation\n     */\n    _update() {\n        if (this.attachedNode) {\n            let effectiveNode = this.attachedNode;\n            if (this.attachedMesh) {\n                effectiveNode = this.attachedMesh || this.attachedNode;\n            }\n            // Position\n            if (this.updateGizmoPositionToMatchAttachedMesh) {\n                const row = effectiveNode.getWorldMatrix().getRow(3);\n                const position = row ? row.toVector3() : new Vector3(0, 0, 0);\n                this._rootMesh.position.copyFrom(position);\n            }\n            // Rotation\n            if (this.updateGizmoRotationToMatchAttachedMesh) {\n                const supportedNode = effectiveNode._isMesh ||\n                    effectiveNode.getClassName() === \"AbstractMesh\" ||\n                    effectiveNode.getClassName() === \"TransformNode\" ||\n                    effectiveNode.getClassName() === \"InstancedMesh\";\n                const transformNode = supportedNode ? effectiveNode : undefined;\n                effectiveNode.getWorldMatrix().decompose(undefined, this._rootMesh.rotationQuaternion, undefined, Gizmo.PreserveScaling ? transformNode : undefined);\n            }\n            else {\n                if (this._customRotationQuaternion) {\n                    this._rootMesh.rotationQuaternion.copyFrom(this._customRotationQuaternion);\n                }\n                else {\n                    this._rootMesh.rotationQuaternion.set(0, 0, 0, 1);\n                }\n            }\n            // Scale\n            if (this.updateScale) {\n                const activeCamera = this.gizmoLayer.utilityLayerScene.activeCamera;\n                let cameraPosition = activeCamera.globalPosition;\n                if (activeCamera.devicePosition) {\n                    cameraPosition = activeCamera.devicePosition;\n                }\n                this._rootMesh.position.subtractToRef(cameraPosition, TmpVectors.Vector3[0]);\n                let scale = this.scaleRatio;\n                if (activeCamera.mode == Camera.ORTHOGRAPHIC_CAMERA) {\n                    if (activeCamera.orthoTop && activeCamera.orthoBottom) {\n                        const orthoHeight = activeCamera.orthoTop - activeCamera.orthoBottom;\n                        scale *= orthoHeight;\n                    }\n                }\n                else {\n                    const camForward = activeCamera.getScene().useRightHandedSystem ? Vector3.RightHandedForwardReadOnly : Vector3.LeftHandedForwardReadOnly;\n                    const direction = activeCamera.getDirection(camForward);\n                    scale *= Vector3.Dot(TmpVectors.Vector3[0], direction);\n                }\n                this._rootMesh.scaling.setAll(scale);\n                // Account for handedness, similar to Matrix.decompose\n                if (effectiveNode._getWorldMatrixDeterminant() < 0 && !Gizmo.PreserveScaling) {\n                    this._rootMesh.scaling.y *= -1;\n                }\n            }\n            else {\n                this._rootMesh.scaling.setAll(this.scaleRatio);\n            }\n        }\n    }\n    /**\n     * Handle position/translation when using an attached node using pivot\n     */\n    _handlePivot() {\n        const attachedNodeTransform = this._attachedNode;\n        // check there is an active pivot for the TransformNode attached\n        if (attachedNodeTransform.isUsingPivotMatrix && attachedNodeTransform.isUsingPivotMatrix() && attachedNodeTransform.position) {\n            // When a TransformNode has an active pivot, even without parenting,\n            // translation from the world matrix is different from TransformNode.position.\n            // Pivot works like a virtual parent that's using the node orientation.\n            // As the world matrix is transformed by the gizmo and then decomposed to TRS\n            // its translation part must be set to the Node's position.\n            attachedNodeTransform.getWorldMatrix().setTranslation(attachedNodeTransform.position);\n        }\n    }\n    /**\n     * computes the rotation/scaling/position of the transform once the Node world matrix has changed.\n     */\n    _matrixChanged() {\n        if (!this._attachedNode) {\n            return;\n        }\n        if (this._attachedNode._isCamera) {\n            const camera = this._attachedNode;\n            let worldMatrix;\n            let worldMatrixUC;\n            if (camera.parent) {\n                const parentInv = TmpVectors.Matrix[1];\n                camera.parent._worldMatrix.invertToRef(parentInv);\n                this._attachedNode._worldMatrix.multiplyToRef(parentInv, TmpVectors.Matrix[0]);\n                worldMatrix = TmpVectors.Matrix[0];\n            }\n            else {\n                worldMatrix = this._attachedNode._worldMatrix;\n            }\n            if (camera.getScene().useRightHandedSystem) {\n                // avoid desync with RH matrix computation. Otherwise, rotation of PI around Y axis happens each frame resulting in axis flipped because worldMatrix is computed as inverse of viewMatrix.\n                this._rightHandtoLeftHandMatrix.multiplyToRef(worldMatrix, TmpVectors.Matrix[1]);\n                worldMatrixUC = TmpVectors.Matrix[1];\n            }\n            else {\n                worldMatrixUC = worldMatrix;\n            }\n            worldMatrixUC.decompose(TmpVectors.Vector3[1], TmpVectors.Quaternion[0], TmpVectors.Vector3[0]);\n            const inheritsTargetCamera = this._attachedNode.getClassName() === \"FreeCamera\" ||\n                this._attachedNode.getClassName() === \"FlyCamera\" ||\n                this._attachedNode.getClassName() === \"ArcFollowCamera\" ||\n                this._attachedNode.getClassName() === \"TargetCamera\" ||\n                this._attachedNode.getClassName() === \"TouchCamera\" ||\n                this._attachedNode.getClassName() === \"UniversalCamera\";\n            if (inheritsTargetCamera) {\n                const targetCamera = this._attachedNode;\n                targetCamera.rotation = TmpVectors.Quaternion[0].toEulerAngles();\n                if (targetCamera.rotationQuaternion) {\n                    targetCamera.rotationQuaternion.copyFrom(TmpVectors.Quaternion[0]);\n                    targetCamera.rotationQuaternion.normalize();\n                }\n            }\n            camera.position.copyFrom(TmpVectors.Vector3[0]);\n        }\n        else if (this._attachedNode._isMesh ||\n            this._attachedNode.getClassName() === \"AbstractMesh\" ||\n            this._attachedNode.getClassName() === \"TransformNode\" ||\n            this._attachedNode.getClassName() === \"InstancedMesh\") {\n            const transform = this._attachedNode;\n            if (transform.parent) {\n                const parentInv = TmpVectors.Matrix[0];\n                const localMat = TmpVectors.Matrix[1];\n                transform.parent.getWorldMatrix().invertToRef(parentInv);\n                this._attachedNode.getWorldMatrix().multiplyToRef(parentInv, localMat);\n                localMat.decompose(TmpVectors.Vector3[0], TmpVectors.Quaternion[0], transform.position, Gizmo.PreserveScaling ? transform : undefined);\n            }\n            else {\n                this._attachedNode._worldMatrix.decompose(TmpVectors.Vector3[0], TmpVectors.Quaternion[0], transform.position, Gizmo.PreserveScaling ? transform : undefined);\n            }\n            transform.scaling.copyFrom(TmpVectors.Vector3[0]);\n            if (!transform.billboardMode) {\n                if (transform.rotationQuaternion) {\n                    transform.rotationQuaternion.copyFrom(TmpVectors.Quaternion[0]);\n                    transform.rotationQuaternion.normalize();\n                }\n                else {\n                    transform.rotation = TmpVectors.Quaternion[0].toEulerAngles();\n                }\n            }\n        }\n        else if (this._attachedNode.getClassName() === \"Bone\") {\n            const bone = this._attachedNode;\n            const parent = bone.getParent();\n            if (parent) {\n                const invParent = TmpVectors.Matrix[0];\n                const boneLocalMatrix = TmpVectors.Matrix[1];\n                parent.getWorldMatrix().invertToRef(invParent);\n                bone.getWorldMatrix().multiplyToRef(invParent, boneLocalMatrix);\n                const lmat = bone.getLocalMatrix();\n                lmat.copyFrom(boneLocalMatrix);\n            }\n            else {\n                const lmat = bone.getLocalMatrix();\n                lmat.copyFrom(bone.getWorldMatrix());\n            }\n            bone.markAsDirty();\n        }\n        else {\n            const light = this._attachedNode;\n            if (light.getTypeID) {\n                const type = light.getTypeID();\n                if (type === Light.LIGHTTYPEID_DIRECTIONALLIGHT || type === Light.LIGHTTYPEID_SPOTLIGHT || type === Light.LIGHTTYPEID_POINTLIGHT) {\n                    const parent = light.parent;\n                    if (parent) {\n                        const invParent = TmpVectors.Matrix[0];\n                        const nodeLocalMatrix = TmpVectors.Matrix[1];\n                        parent.getWorldMatrix().invertToRef(invParent);\n                        light.getWorldMatrix().multiplyToRef(invParent, nodeLocalMatrix);\n                        nodeLocalMatrix.decompose(undefined, TmpVectors.Quaternion[0], TmpVectors.Vector3[0]);\n                    }\n                    else {\n                        this._attachedNode._worldMatrix.decompose(undefined, TmpVectors.Quaternion[0], TmpVectors.Vector3[0]);\n                    }\n                    // setter doesn't copy values. Need a new Vector3\n                    light.position = new Vector3(TmpVectors.Vector3[0].x, TmpVectors.Vector3[0].y, TmpVectors.Vector3[0].z);\n                    if (light.direction) {\n                        light.direction = new Vector3(light.direction.x, light.direction.y, light.direction.z);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * refresh gizmo mesh material\n     * @param gizmoMeshes\n     * @param material material to apply\n     */\n    _setGizmoMeshMaterial(gizmoMeshes, material) {\n        if (gizmoMeshes) {\n            gizmoMeshes.forEach((m) => {\n                m.material = material;\n                if (m.color) {\n                    m.color = material.diffuseColor;\n                }\n            });\n        }\n    }\n    /**\n     * Subscribes to pointer up, down, and hover events. Used for responsive gizmos.\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param gizmoAxisCache Gizmo axis definition used for reactive gizmo UI\n     * @returns {Observer<PointerInfo>} pointerObserver\n     */\n    static GizmoAxisPointerObserver(gizmoLayer, gizmoAxisCache) {\n        let dragging = false;\n        const pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            var _a, _b;\n            if (pointerInfo.pickInfo) {\n                // On Hover Logic\n                if (pointerInfo.type === PointerEventTypes.POINTERMOVE) {\n                    if (dragging) {\n                        return;\n                    }\n                    gizmoAxisCache.forEach((cache) => {\n                        var _a, _b;\n                        if (cache.colliderMeshes && cache.gizmoMeshes) {\n                            const isHovered = ((_a = cache.colliderMeshes) === null || _a === void 0 ? void 0 : _a.indexOf((_b = pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.pickInfo) === null || _b === void 0 ? void 0 : _b.pickedMesh)) != -1;\n                            const material = cache.dragBehavior.enabled ? (isHovered || cache.active ? cache.hoverMaterial : cache.material) : cache.disableMaterial;\n                            cache.gizmoMeshes.forEach((m) => {\n                                m.material = material;\n                                if (m.color) {\n                                    m.color = material.diffuseColor;\n                                }\n                            });\n                        }\n                    });\n                }\n                // On Mouse Down\n                if (pointerInfo.type === PointerEventTypes.POINTERDOWN) {\n                    // If user Clicked Gizmo\n                    if (gizmoAxisCache.has((_a = pointerInfo.pickInfo.pickedMesh) === null || _a === void 0 ? void 0 : _a.parent)) {\n                        dragging = true;\n                        const statusMap = gizmoAxisCache.get((_b = pointerInfo.pickInfo.pickedMesh) === null || _b === void 0 ? void 0 : _b.parent);\n                        statusMap.active = true;\n                        gizmoAxisCache.forEach((cache) => {\n                            var _a, _b;\n                            const isHovered = ((_a = cache.colliderMeshes) === null || _a === void 0 ? void 0 : _a.indexOf((_b = pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.pickInfo) === null || _b === void 0 ? void 0 : _b.pickedMesh)) != -1;\n                            const material = (isHovered || cache.active) && cache.dragBehavior.enabled ? cache.hoverMaterial : cache.disableMaterial;\n                            cache.gizmoMeshes.forEach((m) => {\n                                m.material = material;\n                                if (m.color) {\n                                    m.color = material.diffuseColor;\n                                }\n                            });\n                        });\n                    }\n                }\n                // On Mouse Up\n                if (pointerInfo.type === PointerEventTypes.POINTERUP) {\n                    gizmoAxisCache.forEach((cache) => {\n                        cache.active = false;\n                        dragging = false;\n                        cache.gizmoMeshes.forEach((m) => {\n                            m.material = cache.dragBehavior.enabled ? cache.material : cache.disableMaterial;\n                            if (m.color) {\n                                m.color = cache.material.diffuseColor;\n                            }\n                        });\n                    });\n                }\n            }\n        });\n        return pointerObserver;\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        this._rootMesh.dispose();\n        if (this._beforeRenderObserver) {\n            this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver);\n        }\n    }\n}\n/**\n * When enabled, any gizmo operation will perserve scaling sign. Default is off.\n * Only valid for TransformNode derived classes (Mesh, AbstractMesh, ...)\n */\nGizmo.PreserveScaling = false;\n//# sourceMappingURL=gizmo.js.map","import { Vector3, Quaternion } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { AbstractMesh } from \"../Meshes/abstractMesh.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\nimport { HemisphericLight } from \"../Lights/hemisphericLight.js\";\nimport { DirectionalLight } from \"../Lights/directionalLight.js\";\nimport { CreateSphere } from \"../Meshes/Builders/sphereBuilder.js\";\nimport { CreateHemisphere } from \"../Meshes/Builders/hemisphereBuilder.js\";\nimport { SpotLight } from \"../Lights/spotLight.js\";\nimport { TransformNode } from \"../Meshes/transformNode.js\";\nimport { PointerEventTypes } from \"../Events/pointerEvents.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { CreateCylinder } from \"../Meshes/Builders/cylinderBuilder.js\";\n/**\n * Gizmo that enables viewing a light\n */\nexport class LightGizmo extends Gizmo {\n    /**\n     * Creates a LightGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     */\n    constructor(gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer) {\n        super(gizmoLayer);\n        this._cachedPosition = new Vector3();\n        this._cachedForward = new Vector3(0, 0, 1);\n        this._pointerObserver = null;\n        /**\n         * Event that fires each time the gizmo is clicked\n         */\n        this.onClickedObservable = new Observable();\n        this._light = null;\n        this.attachedMesh = new AbstractMesh(\"\", this.gizmoLayer.utilityLayerScene);\n        this._attachedMeshParent = new TransformNode(\"parent\", this.gizmoLayer.utilityLayerScene);\n        this.attachedMesh.parent = this._attachedMeshParent;\n        this._material = new StandardMaterial(\"light\", this.gizmoLayer.utilityLayerScene);\n        this._material.diffuseColor = new Color3(0.5, 0.5, 0.5);\n        this._material.specularColor = new Color3(0.1, 0.1, 0.1);\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (!this._light) {\n                return;\n            }\n            this._isHovered = !!(pointerInfo.pickInfo && this._rootMesh.getChildMeshes().indexOf(pointerInfo.pickInfo.pickedMesh) != -1);\n            if (this._isHovered && pointerInfo.event.button === 0) {\n                this.onClickedObservable.notifyObservers(this._light);\n            }\n        }, PointerEventTypes.POINTERDOWN);\n    }\n    /**\n     * Override attachedNode because lightgizmo only support attached mesh\n     * It will return the attached mesh (if any) and setting an attached node will log\n     * a warning\n     */\n    get attachedNode() {\n        return this.attachedMesh;\n    }\n    set attachedNode(value) {\n        console.warn(\"Nodes cannot be attached to LightGizmo. Attach to a mesh instead.\");\n    }\n    /**\n     * The light that the gizmo is attached to\n     */\n    set light(light) {\n        this._light = light;\n        if (light) {\n            // Create the mesh for the given light type\n            if (this._lightMesh) {\n                this._lightMesh.dispose();\n            }\n            if (light instanceof HemisphericLight) {\n                this._lightMesh = LightGizmo._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene);\n            }\n            else if (light instanceof DirectionalLight) {\n                this._lightMesh = LightGizmo._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene);\n            }\n            else if (light instanceof SpotLight) {\n                this._lightMesh = LightGizmo._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene);\n            }\n            else {\n                this._lightMesh = LightGizmo._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene);\n            }\n            this._lightMesh.getChildMeshes(false).forEach((m) => {\n                m.material = this._material;\n            });\n            this._lightMesh.parent = this._rootMesh;\n            // Add lighting to the light gizmo\n            const gizmoLight = this.gizmoLayer._getSharedGizmoLight();\n            gizmoLight.includedOnlyMeshes = gizmoLight.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(false));\n            this._lightMesh.rotationQuaternion = new Quaternion();\n            if (!this.attachedMesh.reservedDataStore) {\n                this.attachedMesh.reservedDataStore = {};\n            }\n            this.attachedMesh.reservedDataStore.lightGizmo = this;\n            if (light.parent) {\n                this._attachedMeshParent.freezeWorldMatrix(light.parent.getWorldMatrix());\n            }\n            // Get update position and direction if the light has it\n            if (light.position) {\n                this.attachedMesh.position.copyFrom(light.position);\n                this.attachedMesh.computeWorldMatrix(true);\n                this._cachedPosition.copyFrom(this.attachedMesh.position);\n            }\n            if (light.direction) {\n                this.attachedMesh.setDirection(light.direction);\n                this.attachedMesh.computeWorldMatrix(true);\n                this._cachedForward.copyFrom(this.attachedMesh.forward);\n            }\n            this._update();\n        }\n    }\n    get light() {\n        return this._light;\n    }\n    /**\n     * Gets the material used to render the light gizmo\n     */\n    get material() {\n        return this._material;\n    }\n    /**\n     * @internal\n     * Updates the gizmo to match the attached mesh's position/rotation\n     */\n    _update() {\n        super._update();\n        if (!this._light) {\n            return;\n        }\n        if (this._light.parent) {\n            this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix());\n        }\n        // For light position and direction, a dirty flag is set to true in the setter\n        // It means setting values individually or copying values will not call setter and\n        // dirty flag will not be set to true. Hence creating a new Vector3.\n        if (this._light.position) {\n            // If the gizmo is moved update the light otherwise update the gizmo to match the light\n            if (!this.attachedMesh.position.equals(this._cachedPosition)) {\n                // update light to match gizmo\n                const position = this.attachedMesh.position;\n                this._light.position = new Vector3(position.x, position.y, position.z);\n                this._cachedPosition.copyFrom(this.attachedMesh.position);\n            }\n            else {\n                // update gizmo to match light\n                this.attachedMesh.position.copyFrom(this._light.position);\n                this.attachedMesh.computeWorldMatrix(true);\n                this._cachedPosition.copyFrom(this.attachedMesh.position);\n            }\n        }\n        if (this._light.direction) {\n            // If the gizmo is moved update the light otherwise update the gizmo to match the light\n            if (Vector3.DistanceSquared(this.attachedMesh.forward, this._cachedForward) > 0.0001) {\n                // update light to match gizmo\n                const direction = this.attachedMesh.forward;\n                this._light.direction = new Vector3(direction.x, direction.y, direction.z);\n                this._cachedForward.copyFrom(this.attachedMesh.forward);\n            }\n            else if (Vector3.DistanceSquared(this.attachedMesh.forward, this._light.direction) > 0.0001) {\n                // update gizmo to match light\n                this.attachedMesh.setDirection(this._light.direction);\n                this.attachedMesh.computeWorldMatrix(true);\n                this._cachedForward.copyFrom(this.attachedMesh.forward);\n            }\n        }\n    }\n    /**\n     * Disposes of the light gizmo\n     */\n    dispose() {\n        this.onClickedObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this._material.dispose();\n        super.dispose();\n        this._attachedMeshParent.dispose();\n    }\n    static _CreateHemisphericLightMesh(scene) {\n        const root = new Mesh(\"hemisphereLight\", scene);\n        const hemisphere = CreateHemisphere(root.name, { segments: 10, diameter: 1 }, scene);\n        hemisphere.position.z = -0.15;\n        hemisphere.rotation.x = Math.PI / 2;\n        hemisphere.parent = root;\n        const lines = this._CreateLightLines(3, scene);\n        lines.parent = root;\n        root.scaling.scaleInPlace(LightGizmo._Scale);\n        root.rotation.x = Math.PI / 2;\n        return root;\n    }\n    static _CreatePointLightMesh(scene) {\n        const root = new Mesh(\"pointLight\", scene);\n        const sphere = CreateSphere(root.name, { segments: 10, diameter: 1 }, scene);\n        sphere.rotation.x = Math.PI / 2;\n        sphere.parent = root;\n        const lines = this._CreateLightLines(5, scene);\n        lines.parent = root;\n        root.scaling.scaleInPlace(LightGizmo._Scale);\n        root.rotation.x = Math.PI / 2;\n        return root;\n    }\n    static _CreateSpotLightMesh(scene) {\n        const root = new Mesh(\"spotLight\", scene);\n        const sphere = CreateSphere(root.name, { segments: 10, diameter: 1 }, scene);\n        sphere.parent = root;\n        const hemisphere = CreateHemisphere(root.name, { segments: 10, diameter: 2 }, scene);\n        hemisphere.parent = root;\n        hemisphere.rotation.x = -Math.PI / 2;\n        const lines = this._CreateLightLines(2, scene);\n        lines.parent = root;\n        root.scaling.scaleInPlace(LightGizmo._Scale);\n        root.rotation.x = Math.PI / 2;\n        return root;\n    }\n    static _CreateDirectionalLightMesh(scene) {\n        const root = new Mesh(\"directionalLight\", scene);\n        const mesh = new Mesh(root.name, scene);\n        mesh.parent = root;\n        const sphere = CreateSphere(root.name, { diameter: 1.2, segments: 10 }, scene);\n        sphere.parent = mesh;\n        const line = CreateCylinder(root.name, {\n            updatable: false,\n            height: 6,\n            diameterTop: 0.3,\n            diameterBottom: 0.3,\n            tessellation: 6,\n            subdivisions: 1,\n        }, scene);\n        line.parent = mesh;\n        let left = line.clone(root.name);\n        left.scaling.y = 0.5;\n        left.position.x += 1.25;\n        let right = line.clone(root.name);\n        right.scaling.y = 0.5;\n        right.position.x += -1.25;\n        const arrowHead = CreateCylinder(root.name, {\n            updatable: false,\n            height: 1,\n            diameterTop: 0,\n            diameterBottom: 0.6,\n            tessellation: 6,\n            subdivisions: 1,\n        }, scene);\n        arrowHead.position.y += 3;\n        arrowHead.parent = mesh;\n        left = arrowHead.clone(root.name);\n        left.position.y = 1.5;\n        left.position.x += 1.25;\n        right = arrowHead.clone(root.name);\n        right.position.y = 1.5;\n        right.position.x += -1.25;\n        mesh.scaling.scaleInPlace(LightGizmo._Scale);\n        mesh.rotation.z = Math.PI / 2;\n        mesh.rotation.y = Math.PI / 2;\n        return root;\n    }\n}\n// Static helper methods\nLightGizmo._Scale = 0.007;\n/**\n * Creates the lines for a light mesh\n * @param levels\n * @param scene\n */\nLightGizmo._CreateLightLines = (levels, scene) => {\n    const distFromSphere = 1.2;\n    const root = new Mesh(\"root\", scene);\n    root.rotation.x = Math.PI / 2;\n    // Create the top line, this will be cloned for all other lines\n    const linePivot = new Mesh(\"linePivot\", scene);\n    linePivot.parent = root;\n    const line = CreateCylinder(\"line\", {\n        updatable: false,\n        height: 2,\n        diameterTop: 0.2,\n        diameterBottom: 0.3,\n        tessellation: 6,\n        subdivisions: 1,\n    }, scene);\n    line.position.y = line.scaling.y / 2 + distFromSphere;\n    line.parent = linePivot;\n    if (levels < 2) {\n        return linePivot;\n    }\n    for (let i = 0; i < 4; i++) {\n        const l = linePivot.clone(\"lineParentClone\");\n        l.rotation.z = Math.PI / 4;\n        l.rotation.y = Math.PI / 2 + (Math.PI / 2) * i;\n        l.getChildMeshes()[0].scaling.y = 0.5;\n        l.getChildMeshes()[0].scaling.x = l.getChildMeshes()[0].scaling.z = 0.8;\n        l.getChildMeshes()[0].position.y = l.getChildMeshes()[0].scaling.y / 2 + distFromSphere;\n    }\n    if (levels < 3) {\n        return root;\n    }\n    for (let i = 0; i < 4; i++) {\n        const l = linePivot.clone(\"linePivotClone\");\n        l.rotation.z = Math.PI / 2;\n        l.rotation.y = (Math.PI / 2) * i;\n    }\n    if (levels < 4) {\n        return root;\n    }\n    for (let i = 0; i < 4; i++) {\n        const l = linePivot.clone(\"linePivotClone\");\n        l.rotation.z = Math.PI + Math.PI / 4;\n        l.rotation.y = Math.PI / 2 + (Math.PI / 2) * i;\n        l.getChildMeshes()[0].scaling.y = 0.5;\n        l.getChildMeshes()[0].scaling.x = l.getChildMeshes()[0].scaling.z = 0.8;\n        l.getChildMeshes()[0].position.y = l.getChildMeshes()[0].scaling.y / 2 + distFromSphere;\n    }\n    if (levels < 5) {\n        return root;\n    }\n    const l = linePivot.clone(\"linePivotClone\");\n    l.rotation.z = Math.PI;\n    return root;\n};\n//# sourceMappingURL=lightGizmo.js.map","import { Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\nimport { CreateBox } from \"../Meshes/Builders/boxBuilder.js\";\nimport { CreateCylinder } from \"../Meshes/Builders/cylinderBuilder.js\";\nimport { Matrix } from \"../Maths/math.js\";\nimport { CreateLines } from \"../Meshes/Builders/linesBuilder.js\";\nimport { PointerEventTypes } from \"../Events/pointerEvents.js\";\nimport { Observable } from \"../Misc/observable.js\";\n/**\n * Gizmo that enables viewing a camera\n */\nexport class CameraGizmo extends Gizmo {\n    /**\n     * Creates a CameraGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     */\n    constructor(gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer) {\n        super(gizmoLayer);\n        this._pointerObserver = null;\n        /**\n         * Event that fires each time the gizmo is clicked\n         */\n        this.onClickedObservable = new Observable();\n        this._camera = null;\n        this._invProjection = new Matrix();\n        this._material = new StandardMaterial(\"cameraGizmoMaterial\", this.gizmoLayer.utilityLayerScene);\n        this._material.diffuseColor = new Color3(0.5, 0.5, 0.5);\n        this._material.specularColor = new Color3(0.1, 0.1, 0.1);\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (!this._camera) {\n                return;\n            }\n            this._isHovered = !!(pointerInfo.pickInfo && this._rootMesh.getChildMeshes().indexOf(pointerInfo.pickInfo.pickedMesh) != -1);\n            if (this._isHovered && pointerInfo.event.button === 0) {\n                this.onClickedObservable.notifyObservers(this._camera);\n            }\n        }, PointerEventTypes.POINTERDOWN);\n    }\n    /** Gets or sets a boolean indicating if frustum lines must be rendered (true by default)) */\n    get displayFrustum() {\n        return this._cameraLinesMesh.isEnabled();\n    }\n    set displayFrustum(value) {\n        this._cameraLinesMesh.setEnabled(value);\n    }\n    /**\n     * The camera that the gizmo is attached to\n     */\n    set camera(camera) {\n        this._camera = camera;\n        this.attachedNode = camera;\n        if (camera) {\n            // Create the mesh for the given camera\n            if (this._cameraMesh) {\n                this._cameraMesh.dispose();\n            }\n            if (this._cameraLinesMesh) {\n                this._cameraLinesMesh.dispose();\n            }\n            this._cameraMesh = CameraGizmo._CreateCameraMesh(this.gizmoLayer.utilityLayerScene);\n            this._cameraLinesMesh = CameraGizmo._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene);\n            this._cameraMesh.getChildMeshes(false).forEach((m) => {\n                m.material = this._material;\n            });\n            this._cameraMesh.parent = this._rootMesh;\n            this._cameraLinesMesh.parent = this._rootMesh;\n            if (this.gizmoLayer.utilityLayerScene.activeCamera && this.gizmoLayer.utilityLayerScene.activeCamera.maxZ < camera.maxZ * 1.5) {\n                this.gizmoLayer.utilityLayerScene.activeCamera.maxZ = camera.maxZ * 1.5;\n            }\n            if (!this.attachedNode.reservedDataStore) {\n                this.attachedNode.reservedDataStore = {};\n            }\n            this.attachedNode.reservedDataStore.cameraGizmo = this;\n            // Add lighting to the camera gizmo\n            const gizmoLight = this.gizmoLayer._getSharedGizmoLight();\n            gizmoLight.includedOnlyMeshes = gizmoLight.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(false));\n            this._update();\n        }\n    }\n    get camera() {\n        return this._camera;\n    }\n    /**\n     * Gets the material used to render the camera gizmo\n     */\n    get material() {\n        return this._material;\n    }\n    /**\n     * @internal\n     * Updates the gizmo to match the attached mesh's position/rotation\n     */\n    _update() {\n        super._update();\n        if (!this._camera) {\n            return;\n        }\n        // frustum matrix\n        this._camera.getProjectionMatrix().invertToRef(this._invProjection);\n        this._cameraLinesMesh.setPivotMatrix(this._invProjection, false);\n        this._cameraLinesMesh.scaling.x = 1 / this._rootMesh.scaling.x;\n        this._cameraLinesMesh.scaling.y = 1 / this._rootMesh.scaling.y;\n        this._cameraLinesMesh.scaling.z = 1 / this._rootMesh.scaling.z;\n        // take care of coordinate system in camera scene to properly display the mesh with the good Y axis orientation in this scene\n        this._cameraMesh.parent = null;\n        this._cameraMesh.rotation.y = Math.PI * 0.5 * (this._camera.getScene().useRightHandedSystem ? 1 : -1);\n        this._cameraMesh.parent = this._rootMesh;\n    }\n    /**\n     * Disposes of the camera gizmo\n     */\n    dispose() {\n        this.onClickedObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        if (this._cameraMesh) {\n            this._cameraMesh.dispose();\n        }\n        if (this._cameraLinesMesh) {\n            this._cameraLinesMesh.dispose();\n        }\n        this._material.dispose();\n        super.dispose();\n    }\n    static _CreateCameraMesh(scene) {\n        const root = new Mesh(\"rootCameraGizmo\", scene);\n        const mesh = new Mesh(root.name, scene);\n        mesh.parent = root;\n        const box = CreateBox(root.name, { width: 1.0, height: 0.8, depth: 0.5 }, scene);\n        box.parent = mesh;\n        const cyl1 = CreateCylinder(root.name, { height: 0.5, diameterTop: 0.8, diameterBottom: 0.8 }, scene);\n        cyl1.parent = mesh;\n        cyl1.position.y = 0.3;\n        cyl1.position.x = -0.6;\n        cyl1.rotation.x = Math.PI * 0.5;\n        const cyl2 = CreateCylinder(root.name, { height: 0.5, diameterTop: 0.6, diameterBottom: 0.6 }, scene);\n        cyl2.parent = mesh;\n        cyl2.position.y = 0.5;\n        cyl2.position.x = 0.4;\n        cyl2.rotation.x = Math.PI * 0.5;\n        const cyl3 = CreateCylinder(root.name, { height: 0.5, diameterTop: 0.5, diameterBottom: 0.5 }, scene);\n        cyl3.parent = mesh;\n        cyl3.position.y = 0.0;\n        cyl3.position.x = 0.6;\n        cyl3.rotation.z = Math.PI * 0.5;\n        root.scaling.scaleInPlace(CameraGizmo._Scale);\n        mesh.position.x = -0.9;\n        return root;\n    }\n    static _CreateCameraFrustum(scene) {\n        const root = new Mesh(\"rootCameraGizmo\", scene);\n        const mesh = new Mesh(root.name, scene);\n        mesh.parent = root;\n        for (let y = 0; y < 4; y += 2) {\n            for (let x = 0; x < 4; x += 2) {\n                let line = CreateLines(\"lines\", { points: [new Vector3(-1 + x, -1 + y, -1), new Vector3(-1 + x, -1 + y, 1)] }, scene);\n                line.parent = mesh;\n                line.alwaysSelectAsActiveMesh = true;\n                line.isPickable = false;\n                line = CreateLines(\"lines\", { points: [new Vector3(-1, -1 + x, -1 + y), new Vector3(1, -1 + x, -1 + y)] }, scene);\n                line.parent = mesh;\n                line.alwaysSelectAsActiveMesh = true;\n                line.isPickable = false;\n                line = CreateLines(\"lines\", { points: [new Vector3(-1 + x, -1, -1 + y), new Vector3(-1 + x, 1, -1 + y)] }, scene);\n                line.parent = mesh;\n                line.alwaysSelectAsActiveMesh = true;\n                line.isPickable = false;\n            }\n        }\n        return root;\n    }\n}\n// Static helper methods\nCameraGizmo._Scale = 0.05;\n//# sourceMappingURL=cameraGizmo.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { TransformNode } from \"../Meshes/transformNode.js\";\nimport { CreatePlane } from \"../Meshes/Builders/planeBuilder.js\";\nimport { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\n/**\n * Single plane drag gizmo\n */\nexport class PlaneDragGizmo extends Gizmo {\n    /** Default material used to render when gizmo is not disabled or hovered */\n    get coloredMaterial() {\n        return this._coloredMaterial;\n    }\n    /** Material used to render when gizmo is hovered with mouse*/\n    get hoverMaterial() {\n        return this._hoverMaterial;\n    }\n    /** Material used to render when gizmo is disabled. typically grey.*/\n    get disableMaterial() {\n        return this._disableMaterial;\n    }\n    /**\n     * @internal\n     */\n    static _CreatePlane(scene, material) {\n        const plane = new TransformNode(\"plane\", scene);\n        //make sure plane is double sided\n        const dragPlane = CreatePlane(\"dragPlane\", { width: 0.1375, height: 0.1375, sideOrientation: 2 }, scene);\n        dragPlane.material = material;\n        dragPlane.parent = plane;\n        return plane;\n    }\n    /**\n     * Creates a PlaneDragGizmo\n     * @param dragPlaneNormal The axis normal to which the gizmo will be able to drag on\n     * @param color The color of the gizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param parent\n     */\n    constructor(dragPlaneNormal, color = Color3.Gray(), gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer, parent = null) {\n        var _a;\n        super(gizmoLayer);\n        this._pointerObserver = null;\n        /**\n         * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n         */\n        this.snapDistance = 0;\n        /**\n         * Event that fires each time the gizmo snaps to a new location.\n         * * snapDistance is the the change in distance\n         */\n        this.onSnapObservable = new Observable();\n        this._isEnabled = false;\n        this._parent = null;\n        this._dragging = false;\n        this._parent = parent;\n        // Create Material\n        this._coloredMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = color;\n        this._coloredMaterial.specularColor = color.subtract(new Color3(0.1, 0.1, 0.1));\n        this._hoverMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = Color3.Yellow();\n        this._disableMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._disableMaterial.diffuseColor = Color3.Gray();\n        this._disableMaterial.alpha = 0.4;\n        // Build plane mesh on root node\n        this._gizmoMesh = PlaneDragGizmo._CreatePlane(gizmoLayer.utilityLayerScene, this._coloredMaterial);\n        this._gizmoMesh.lookAt(this._rootMesh.position.add(dragPlaneNormal));\n        this._gizmoMesh.scaling.scaleInPlace(1 / 3);\n        this._gizmoMesh.parent = this._rootMesh;\n        let currentSnapDragDistance = 0;\n        const tmpVector = new Vector3();\n        const tmpSnapEvent = { snapDistance: 0 };\n        // Add dragPlaneNormal drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new PointerDragBehavior({ dragPlaneNormal: dragPlaneNormal });\n        this.dragBehavior.moveAttached = false;\n        this._rootMesh.addBehavior(this.dragBehavior);\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                this._handlePivot();\n                // Keep world translation and use it to update world transform\n                // if the node has parent, the local transform properties (position, rotation, scale)\n                // will be recomputed in _matrixChanged function\n                // Snapping logic\n                if (this.snapDistance == 0) {\n                    this.attachedNode.getWorldMatrix().addTranslationFromFloats(event.delta.x, event.delta.y, event.delta.z);\n                }\n                else {\n                    currentSnapDragDistance += event.dragDistance;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        const dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        event.delta.normalizeToRef(tmpVector);\n                        tmpVector.scaleInPlace(this.snapDistance * dragSteps);\n                        this.attachedNode.getWorldMatrix().addTranslationFromFloats(tmpVector.x, tmpVector.y, tmpVector.z);\n                        tmpSnapEvent.snapDistance = this.snapDistance * dragSteps;\n                        this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                    }\n                }\n                this._matrixChanged();\n            }\n        });\n        this.dragBehavior.onDragStartObservable.add(() => {\n            this._dragging = true;\n        });\n        this.dragBehavior.onDragEndObservable.add(() => {\n            this._dragging = false;\n        });\n        const light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(false));\n        const cache = {\n            gizmoMeshes: this._gizmoMesh.getChildMeshes(),\n            colliderMeshes: this._gizmoMesh.getChildMeshes(),\n            material: this._coloredMaterial,\n            hoverMaterial: this._hoverMaterial,\n            disableMaterial: this._disableMaterial,\n            active: false,\n            dragBehavior: this.dragBehavior,\n        };\n        (_a = this._parent) === null || _a === void 0 ? void 0 : _a.addToAxisCache(this._gizmoMesh, cache);\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            var _a;\n            if (this._customMeshSet) {\n                return;\n            }\n            this._isHovered = !!(cache.colliderMeshes.indexOf((_a = pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.pickInfo) === null || _a === void 0 ? void 0 : _a.pickedMesh) != -1);\n            if (!this._parent) {\n                const material = cache.dragBehavior.enabled ? (this._isHovered || this._dragging ? this._hoverMaterial : this._coloredMaterial) : this._disableMaterial;\n                this._setGizmoMeshMaterial(cache.gizmoMeshes, material);\n            }\n        });\n        this.dragBehavior.onEnabledObservable.add((newState) => {\n            this._setGizmoMeshMaterial(cache.gizmoMeshes, newState ? this._coloredMaterial : this._disableMaterial);\n        });\n    }\n    _attachedNodeChanged(value) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n    /**\n     * If the gizmo is enabled\n     */\n    set isEnabled(value) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedNode = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedNode = this._parent.attachedNode;\n            }\n        }\n    }\n    get isEnabled() {\n        return this._isEnabled;\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        super.dispose();\n        if (this._gizmoMesh) {\n            this._gizmoMesh.dispose();\n        }\n        [this._coloredMaterial, this._hoverMaterial, this._disableMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n    }\n}\n//# sourceMappingURL=planeDragGizmo.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { Quaternion, Matrix, Vector3, TmpVectors } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport \"../Meshes/Builders/linesBuilder.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\nimport { ShaderMaterial } from \"../Materials/shaderMaterial.js\";\nimport { Effect } from \"../Materials/effect.js\";\nimport { CreatePlane } from \"../Meshes/Builders/planeBuilder.js\";\nimport { CreateTorus } from \"../Meshes/Builders/torusBuilder.js\";\nimport { Epsilon } from \"../Maths/math.constants.js\";\nimport { Logger } from \"../Misc/logger.js\";\n/**\n * Single plane rotation gizmo\n */\nexport class PlaneRotationGizmo extends Gizmo {\n    /** Default material used to render when gizmo is not disabled or hovered */\n    get coloredMaterial() {\n        return this._coloredMaterial;\n    }\n    /** Material used to render when gizmo is hovered with mouse*/\n    get hoverMaterial() {\n        return this._hoverMaterial;\n    }\n    /** Material used to render when gizmo is disabled. typically grey.*/\n    get disableMaterial() {\n        return this._disableMaterial;\n    }\n    /**\n     * Creates a PlaneRotationGizmo\n     * @param planeNormal The normal of the plane which the gizmo will be able to rotate on\n     * @param color The color of the gizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param tessellation Amount of tessellation to be used when creating rotation circles\n     * @param parent\n     * @param useEulerRotation Use and update Euler angle instead of quaternion\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(planeNormal, color = Color3.Gray(), gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer, tessellation = 32, parent = null, \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    useEulerRotation = false, thickness = 1) {\n        var _a;\n        super(gizmoLayer);\n        this._pointerObserver = null;\n        /**\n         * Rotation distance in radians that the gizmo will snap to (Default: 0)\n         */\n        this.snapDistance = 0;\n        /**\n         * Event that fires each time the gizmo snaps to a new location.\n         * * snapDistance is the the change in distance\n         */\n        this.onSnapObservable = new Observable();\n        /**\n         * Accumulated relative angle value for rotation on the axis. Reset to 0 when a dragStart occurs\n         */\n        this.angle = 0;\n        this._isEnabled = true;\n        this._parent = null;\n        this._dragging = false;\n        this._angles = new Vector3();\n        this._parent = parent;\n        // Create Material\n        this._coloredMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = color;\n        this._coloredMaterial.specularColor = color.subtract(new Color3(0.1, 0.1, 0.1));\n        this._hoverMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = Color3.Yellow();\n        this._disableMaterial = new StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._disableMaterial.diffuseColor = Color3.Gray();\n        this._disableMaterial.alpha = 0.4;\n        // Build mesh on root node\n        this._gizmoMesh = new Mesh(\"\", gizmoLayer.utilityLayerScene);\n        const { rotationMesh, collider } = this._createGizmoMesh(this._gizmoMesh, thickness, tessellation);\n        // Setup Rotation Circle\n        this._rotationDisplayPlane = CreatePlane(\"rotationDisplay\", { size: 0.6, updatable: false }, this.gizmoLayer.utilityLayerScene);\n        this._rotationDisplayPlane.rotation.z = Math.PI * 0.5;\n        this._rotationDisplayPlane.parent = this._gizmoMesh;\n        this._rotationDisplayPlane.setEnabled(false);\n        Effect.ShadersStore[\"rotationGizmoVertexShader\"] = PlaneRotationGizmo._RotationGizmoVertexShader;\n        Effect.ShadersStore[\"rotationGizmoFragmentShader\"] = PlaneRotationGizmo._RotationGizmoFragmentShader;\n        this._rotationShaderMaterial = new ShaderMaterial(\"shader\", this.gizmoLayer.utilityLayerScene, {\n            vertex: \"rotationGizmo\",\n            fragment: \"rotationGizmo\",\n        }, {\n            attributes: [\"position\", \"uv\"],\n            uniforms: [\"worldViewProjection\", \"angles\"],\n        });\n        this._rotationShaderMaterial.backFaceCulling = false;\n        this._rotationDisplayPlane.material = this._rotationShaderMaterial;\n        this._rotationDisplayPlane.visibility = 0.999;\n        this._gizmoMesh.lookAt(this._rootMesh.position.add(planeNormal));\n        this._rootMesh.addChild(this._gizmoMesh, Gizmo.PreserveScaling);\n        this._gizmoMesh.scaling.scaleInPlace(1 / 3);\n        // Add drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new PointerDragBehavior({ dragPlaneNormal: planeNormal });\n        this.dragBehavior.moveAttached = false;\n        this.dragBehavior.maxDragAngle = PlaneRotationGizmo.MaxDragAngle;\n        this.dragBehavior._useAlternatePickedPointAboveMaxDragAngle = true;\n        this._rootMesh.addBehavior(this.dragBehavior);\n        // Closures for drag logic\n        const lastDragPosition = new Vector3();\n        const rotationMatrix = new Matrix();\n        const planeNormalTowardsCamera = new Vector3();\n        let localPlaneNormalTowardsCamera = new Vector3();\n        this.dragBehavior.onDragStartObservable.add((e) => {\n            if (this.attachedNode) {\n                lastDragPosition.copyFrom(e.dragPlanePoint);\n                this._rotationDisplayPlane.setEnabled(true);\n                this._rotationDisplayPlane.getWorldMatrix().invertToRef(rotationMatrix);\n                Vector3.TransformCoordinatesToRef(e.dragPlanePoint, rotationMatrix, lastDragPosition);\n                this._angles.x = Math.atan2(lastDragPosition.y, lastDragPosition.x) + Math.PI;\n                this._angles.y = 0;\n                this._angles.z = this.updateGizmoRotationToMatchAttachedMesh ? 1 : 0;\n                this._dragging = true;\n                lastDragPosition.copyFrom(e.dragPlanePoint);\n                this._rotationShaderMaterial.setVector3(\"angles\", this._angles);\n                this.angle = 0;\n            }\n        });\n        this.dragBehavior.onDragEndObservable.add(() => {\n            this._dragging = false;\n            this._rotationDisplayPlane.setEnabled(false);\n        });\n        const tmpSnapEvent = { snapDistance: 0 };\n        let currentSnapDragDistance = 0;\n        const tmpMatrix = new Matrix();\n        const amountToRotate = new Quaternion();\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                // Calc angle over full 360 degree (https://stackoverflow.com/questions/43493711/the-angle-between-two-3d-vectors-with-a-result-range-0-360)\n                const nodeScale = new Vector3(1, 1, 1);\n                const nodeQuaternion = new Quaternion(0, 0, 0, 1);\n                const nodeTranslation = new Vector3(0, 0, 0);\n                this._handlePivot();\n                this.attachedNode.getWorldMatrix().decompose(nodeScale, nodeQuaternion, nodeTranslation);\n                // uniform scaling of absolute value of components\n                // (-1,1,1) is uniform but (1,1.001,1) is not\n                const uniformScaling = Math.abs(Math.abs(nodeScale.x) - Math.abs(nodeScale.y)) <= Epsilon && Math.abs(Math.abs(nodeScale.x) - Math.abs(nodeScale.z)) <= Epsilon;\n                if (!uniformScaling && this.updateGizmoRotationToMatchAttachedMesh) {\n                    Logger.Warn(\"Unable to use a rotation gizmo matching mesh rotation with non uniform scaling. Use uniform scaling or set updateGizmoRotationToMatchAttachedMesh to false.\");\n                    return;\n                }\n                nodeQuaternion.normalize();\n                const nodeTranslationForOperation = this.updateGizmoPositionToMatchAttachedMesh ? nodeTranslation : this._rootMesh.absolutePosition;\n                const newVector = event.dragPlanePoint.subtract(nodeTranslationForOperation).normalize();\n                const originalVector = lastDragPosition.subtract(nodeTranslationForOperation).normalize();\n                const cross = Vector3.Cross(newVector, originalVector);\n                const dot = Vector3.Dot(newVector, originalVector);\n                let angle = Math.atan2(cross.length(), dot);\n                planeNormalTowardsCamera.copyFrom(planeNormal);\n                localPlaneNormalTowardsCamera.copyFrom(planeNormal);\n                if (this.updateGizmoRotationToMatchAttachedMesh) {\n                    nodeQuaternion.toRotationMatrix(rotationMatrix);\n                    localPlaneNormalTowardsCamera = Vector3.TransformCoordinates(planeNormalTowardsCamera, rotationMatrix);\n                }\n                // Flip up vector depending on which side the camera is on\n                let cameraFlipped = false;\n                if (gizmoLayer.utilityLayerScene.activeCamera) {\n                    const camVec = gizmoLayer.utilityLayerScene.activeCamera.position.subtract(nodeTranslationForOperation).normalize();\n                    if (Vector3.Dot(camVec, localPlaneNormalTowardsCamera) > 0) {\n                        planeNormalTowardsCamera.scaleInPlace(-1);\n                        localPlaneNormalTowardsCamera.scaleInPlace(-1);\n                        cameraFlipped = true;\n                    }\n                }\n                const halfCircleSide = Vector3.Dot(localPlaneNormalTowardsCamera, cross) > 0.0;\n                if (halfCircleSide) {\n                    angle = -angle;\n                }\n                // Snapping logic\n                let snapped = false;\n                if (this.snapDistance != 0) {\n                    currentSnapDragDistance += angle;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        let dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        if (currentSnapDragDistance < 0) {\n                            dragSteps *= -1;\n                        }\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        angle = this.snapDistance * dragSteps;\n                        snapped = true;\n                    }\n                    else {\n                        angle = 0;\n                    }\n                }\n                // Convert angle and axis to quaternion (http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm)\n                const quaternionCoefficient = Math.sin(angle / 2);\n                amountToRotate.set(planeNormalTowardsCamera.x * quaternionCoefficient, planeNormalTowardsCamera.y * quaternionCoefficient, planeNormalTowardsCamera.z * quaternionCoefficient, Math.cos(angle / 2));\n                // If the meshes local scale is inverted (eg. loaded gltf file parent with z scale of -1) the rotation needs to be inverted on the y axis\n                if (tmpMatrix.determinant() > 0) {\n                    const tmpVector = new Vector3();\n                    amountToRotate.toEulerAnglesToRef(tmpVector);\n                    Quaternion.RotationYawPitchRollToRef(tmpVector.y, -tmpVector.x, -tmpVector.z, amountToRotate);\n                }\n                if (this.updateGizmoRotationToMatchAttachedMesh) {\n                    // Rotate selected mesh quaternion over fixed axis\n                    nodeQuaternion.multiplyToRef(amountToRotate, nodeQuaternion);\n                    // recompose matrix\n                    Matrix.ComposeToRef(nodeScale, nodeQuaternion, nodeTranslation, this.attachedNode.getWorldMatrix());\n                }\n                else {\n                    // Rotate selected mesh quaternion over rotated axis\n                    amountToRotate.toRotationMatrix(TmpVectors.Matrix[0]);\n                    TmpVectors.Matrix[0].multiplyToRef(this.attachedNode.getWorldMatrix(), this.attachedNode.getWorldMatrix());\n                }\n                lastDragPosition.copyFrom(event.dragPlanePoint);\n                if (snapped) {\n                    tmpSnapEvent.snapDistance = angle;\n                    this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                }\n                this._angles.y += angle;\n                this.angle += cameraFlipped ? -angle : angle;\n                this._rotationShaderMaterial.setVector3(\"angles\", this._angles);\n                this._matrixChanged();\n            }\n        });\n        const light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(false));\n        const cache = {\n            colliderMeshes: [collider],\n            gizmoMeshes: [rotationMesh],\n            material: this._coloredMaterial,\n            hoverMaterial: this._hoverMaterial,\n            disableMaterial: this._disableMaterial,\n            active: false,\n            dragBehavior: this.dragBehavior,\n        };\n        (_a = this._parent) === null || _a === void 0 ? void 0 : _a.addToAxisCache(this._gizmoMesh, cache);\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            var _a;\n            if (this._customMeshSet) {\n                return;\n            }\n            // updating here the maxangle because ondragstart is too late (value already used) and the updated value is not taken into account\n            this.dragBehavior.maxDragAngle = PlaneRotationGizmo.MaxDragAngle;\n            this._isHovered = !!(cache.colliderMeshes.indexOf((_a = pointerInfo === null || pointerInfo === void 0 ? void 0 : pointerInfo.pickInfo) === null || _a === void 0 ? void 0 : _a.pickedMesh) != -1);\n            if (!this._parent) {\n                const material = cache.dragBehavior.enabled ? (this._isHovered || this._dragging ? this._hoverMaterial : this._coloredMaterial) : this._disableMaterial;\n                this._setGizmoMeshMaterial(cache.gizmoMeshes, material);\n            }\n        });\n        this.dragBehavior.onEnabledObservable.add((newState) => {\n            this._setGizmoMeshMaterial(cache.gizmoMeshes, newState ? this._coloredMaterial : this._disableMaterial);\n        });\n    }\n    /**\n     * Create Geometry for Gizmo\n     * @param parentMesh\n     * @param thickness\n     * @param tessellation\n     */\n    _createGizmoMesh(parentMesh, thickness, tessellation) {\n        const collider = CreateTorus(\"ignore\", {\n            diameter: 0.6,\n            thickness: 0.03 * thickness,\n            tessellation,\n        }, this.gizmoLayer.utilityLayerScene);\n        collider.visibility = 0;\n        const rotationMesh = CreateTorus(\"\", {\n            diameter: 0.6,\n            thickness: 0.005 * thickness,\n            tessellation,\n        }, this.gizmoLayer.utilityLayerScene);\n        rotationMesh.material = this._coloredMaterial;\n        // Position arrow pointing in its drag axis\n        rotationMesh.rotation.x = Math.PI / 2;\n        collider.rotation.x = Math.PI / 2;\n        parentMesh.addChild(rotationMesh, Gizmo.PreserveScaling);\n        parentMesh.addChild(collider, Gizmo.PreserveScaling);\n        return { rotationMesh, collider };\n    }\n    _attachedNodeChanged(value) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n    /**\n     * If the gizmo is enabled\n     */\n    set isEnabled(value) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedMesh = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedMesh = this._parent.attachedMesh;\n            }\n        }\n    }\n    get isEnabled() {\n        return this._isEnabled;\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        if (this._gizmoMesh) {\n            this._gizmoMesh.dispose();\n        }\n        if (this._rotationDisplayPlane) {\n            this._rotationDisplayPlane.dispose();\n        }\n        if (this._rotationShaderMaterial) {\n            this._rotationShaderMaterial.dispose();\n        }\n        [this._coloredMaterial, this._hoverMaterial, this._disableMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n        super.dispose();\n    }\n}\n/**\n * The maximum angle between the camera and the rotation allowed for interaction\n * If a rotation plane appears 'flat', a lower value allows interaction.\n */\nPlaneRotationGizmo.MaxDragAngle = (Math.PI * 9) / 20;\nPlaneRotationGizmo._RotationGizmoVertexShader = `\r\n        precision highp float;\r\n        attribute vec3 position;\r\n        attribute vec2 uv;\r\n        uniform mat4 worldViewProjection;\r\n        varying vec3 vPosition;\r\n        varying vec2 vUV;\r\n        void main(void) {\r\n            gl_Position = worldViewProjection * vec4(position, 1.0);\r\n            vUV = uv;\r\n        }`;\nPlaneRotationGizmo._RotationGizmoFragmentShader = `\r\n        precision highp float;\r\n        varying vec2 vUV;\r\n        varying vec3 vPosition;\r\n        uniform vec3 angles;\r\n        #define twopi 6.283185307\r\n        void main(void) {\r\n            vec2 uv = vUV - vec2(0.5);\r\n            float angle = atan(uv.y, uv.x) + 3.141592;\r\n            float delta = gl_FrontFacing ? angles.y : -angles.y;\r\n            float begin = angles.x - delta * angles.z;\r\n            float start = (begin < (begin + delta)) ? begin : (begin + delta);\r\n            float end = (begin > (begin + delta)) ? begin : (begin + delta);\r\n            float len = sqrt(dot(uv,uv));\r\n            float opacity = 1. - step(0.5, len);\r\n\r\n            float base = abs(floor(start / twopi)) * twopi;\r\n            start += base;\r\n            end += base;\r\n\r\n            float intensity = 0.;\r\n            for (int i = 0; i < 5; i++)\r\n            {\r\n                intensity += max(step(start, angle) - step(end, angle), 0.);\r\n                angle += twopi;\r\n            }\r\n            gl_FragColor = vec4(1.,1.,0., min(intensity * 0.25, 0.8)) * opacity;\r\n        }`;\n//# sourceMappingURL=planeRotationGizmo.js.map","import { Logger } from \"../Misc/logger.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { AxisDragGizmo } from \"./axisDragGizmo.js\";\nimport { PlaneDragGizmo } from \"./planeDragGizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\n/**\n * Gizmo that enables dragging a mesh along 3 axis\n */\nexport class PositionGizmo extends Gizmo {\n    get attachedMesh() {\n        return this._meshAttached;\n    }\n    set attachedMesh(mesh) {\n        this._meshAttached = mesh;\n        this._nodeAttached = mesh;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedMesh = mesh;\n            }\n            else {\n                gizmo.attachedMesh = null;\n            }\n        });\n    }\n    get attachedNode() {\n        return this._nodeAttached;\n    }\n    set attachedNode(node) {\n        this._meshAttached = null;\n        this._nodeAttached = node;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedNode = node;\n            }\n            else {\n                gizmo.attachedNode = null;\n            }\n        });\n    }\n    /**\n     * True when the mouse pointer is hovering a gizmo mesh\n     */\n    get isHovered() {\n        let hovered = false;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            hovered = hovered || gizmo.isHovered;\n        });\n        return hovered;\n    }\n    /**\n     * Creates a PositionGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n      @param thickness display gizmo axis thickness\n     * @param gizmoManager\n     */\n    constructor(gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer, thickness = 1, gizmoManager) {\n        super(gizmoLayer);\n        /**\n         * protected variables\n         */\n        this._meshAttached = null;\n        this._nodeAttached = null;\n        this._observables = [];\n        /** Node Caching for quick lookup */\n        this._gizmoAxisCache = new Map();\n        /** Fires an event when any of it's sub gizmos are dragged */\n        this.onDragStartObservable = new Observable();\n        /** Fires an event when any of it's sub gizmos are released from dragging */\n        this.onDragEndObservable = new Observable();\n        /**\n         * If set to true, planar drag is enabled\n         */\n        this._planarGizmoEnabled = false;\n        this.xGizmo = new AxisDragGizmo(new Vector3(1, 0, 0), Color3.Red().scale(0.5), gizmoLayer, this, thickness);\n        this.yGizmo = new AxisDragGizmo(new Vector3(0, 1, 0), Color3.Green().scale(0.5), gizmoLayer, this, thickness);\n        this.zGizmo = new AxisDragGizmo(new Vector3(0, 0, 1), Color3.Blue().scale(0.5), gizmoLayer, this, thickness);\n        this.xPlaneGizmo = new PlaneDragGizmo(new Vector3(1, 0, 0), Color3.Red().scale(0.5), this.gizmoLayer, this);\n        this.yPlaneGizmo = new PlaneDragGizmo(new Vector3(0, 1, 0), Color3.Green().scale(0.5), this.gizmoLayer, this);\n        this.zPlaneGizmo = new PlaneDragGizmo(new Vector3(0, 0, 1), Color3.Blue().scale(0.5), this.gizmoLayer, this);\n        // Relay drag events\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            gizmo.dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n            });\n            gizmo.dragBehavior.onDragEndObservable.add(() => {\n                this.onDragEndObservable.notifyObservers({});\n            });\n        });\n        this.attachedMesh = null;\n        if (gizmoManager) {\n            gizmoManager.addToAxisCache(this._gizmoAxisCache);\n        }\n        else {\n            // Only subscribe to pointer event if gizmoManager isnt\n            Gizmo.GizmoAxisPointerObserver(gizmoLayer, this._gizmoAxisCache);\n        }\n    }\n    /**\n     * If the planar drag gizmo is enabled\n     * setting this will enable/disable XY, XZ and YZ planes regardless of individual gizmo settings.\n     */\n    set planarGizmoEnabled(value) {\n        this._planarGizmoEnabled = value;\n        [this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.isEnabled = value;\n                if (value) {\n                    if (gizmo.attachedMesh) {\n                        gizmo.attachedMesh = this.attachedMesh;\n                    }\n                    else {\n                        gizmo.attachedNode = this.attachedNode;\n                    }\n                }\n            }\n        }, this);\n    }\n    get planarGizmoEnabled() {\n        return this._planarGizmoEnabled;\n    }\n    /**\n     * If set the gizmo's rotation will be updated to match the attached mesh each frame (Default: true)\n     * NOTE: This is only possible for meshes with uniform scaling, as otherwise it's not possible to decompose the rotation\n     */\n    set updateGizmoRotationToMatchAttachedMesh(value) {\n        this._updateGizmoRotationToMatchAttachedMesh = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.updateGizmoRotationToMatchAttachedMesh = value;\n            }\n        });\n    }\n    get updateGizmoRotationToMatchAttachedMesh() {\n        return this._updateGizmoRotationToMatchAttachedMesh;\n    }\n    set updateGizmoPositionToMatchAttachedMesh(value) {\n        this._updateGizmoPositionToMatchAttachedMesh = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.updateGizmoPositionToMatchAttachedMesh = value;\n            }\n        });\n    }\n    get updateGizmoPositionToMatchAttachedMesh() {\n        return this._updateGizmoPositionToMatchAttachedMesh;\n    }\n    set updateScale(value) {\n        if (this.xGizmo) {\n            this.xGizmo.updateScale = value;\n            this.yGizmo.updateScale = value;\n            this.zGizmo.updateScale = value;\n        }\n    }\n    get updateScale() {\n        return this.xGizmo.updateScale;\n    }\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    set snapDistance(value) {\n        this._snapDistance = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.snapDistance = value;\n            }\n        });\n    }\n    get snapDistance() {\n        return this._snapDistance;\n    }\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    set scaleRatio(value) {\n        this._scaleRatio = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.scaleRatio = value;\n            }\n        });\n    }\n    get scaleRatio() {\n        return this._scaleRatio;\n    }\n    /**\n     * Builds Gizmo Axis Cache to enable features such as hover state preservation and graying out other axis during manipulation\n     * @param mesh Axis gizmo mesh\n     * @param cache Gizmo axis definition used for reactive gizmo UI\n     */\n    addToAxisCache(mesh, cache) {\n        this._gizmoAxisCache.set(mesh, cache);\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.dispose();\n            }\n        });\n        this._observables.forEach((obs) => {\n            this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(obs);\n        });\n        this.onDragStartObservable.clear();\n        this.onDragEndObservable.clear();\n    }\n    /**\n     * CustomMeshes are not supported by this gizmo\n     */\n    setCustomMesh() {\n        Logger.Error(\"Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)\");\n    }\n}\n//# sourceMappingURL=positionGizmo.js.map","import { Logger } from \"../Misc/logger.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { PlaneRotationGizmo } from \"./planeRotationGizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\n/**\n * Gizmo that enables rotating a mesh along 3 axis\n */\nexport class RotationGizmo extends Gizmo {\n    get attachedMesh() {\n        return this._meshAttached;\n    }\n    set attachedMesh(mesh) {\n        this._meshAttached = mesh;\n        this._nodeAttached = mesh;\n        this._checkBillboardTransform();\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedMesh = mesh;\n            }\n            else {\n                gizmo.attachedMesh = null;\n            }\n        });\n    }\n    get attachedNode() {\n        return this._nodeAttached;\n    }\n    set attachedNode(node) {\n        this._meshAttached = null;\n        this._nodeAttached = node;\n        this._checkBillboardTransform();\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedNode = node;\n            }\n            else {\n                gizmo.attachedNode = null;\n            }\n        });\n    }\n    _checkBillboardTransform() {\n        if (this._nodeAttached && this._nodeAttached.billboardMode) {\n            console.log(\"Rotation Gizmo will not work with transforms in billboard mode.\");\n        }\n    }\n    /**\n     * True when the mouse pointer is hovering a gizmo mesh\n     */\n    get isHovered() {\n        let hovered = false;\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            hovered = hovered || gizmo.isHovered;\n        });\n        return hovered;\n    }\n    /**\n     * Creates a RotationGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param tessellation Amount of tessellation to be used when creating rotation circles\n     * @param useEulerRotation Use and update Euler angle instead of quaternion\n     * @param thickness display gizmo axis thickness\n     * @param gizmoManager Gizmo manager\n     * @param options More options\n     */\n    constructor(gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer, tessellation = 32, useEulerRotation = false, thickness = 1, gizmoManager, options) {\n        super(gizmoLayer);\n        /** Fires an event when any of it's sub gizmos are dragged */\n        this.onDragStartObservable = new Observable();\n        /** Fires an event when any of it's sub gizmos are released from dragging */\n        this.onDragEndObservable = new Observable();\n        this._observables = [];\n        /** Node Caching for quick lookup */\n        this._gizmoAxisCache = new Map();\n        const xColor = options && options.xOptions && options.xOptions.color ? options.xOptions.color : Color3.Red().scale(0.5);\n        const yColor = options && options.yOptions && options.yOptions.color ? options.yOptions.color : Color3.Green().scale(0.5);\n        const zColor = options && options.zOptions && options.zOptions.color ? options.zOptions.color : Color3.Blue().scale(0.5);\n        this.xGizmo = new PlaneRotationGizmo(new Vector3(1, 0, 0), xColor, gizmoLayer, tessellation, this, useEulerRotation, thickness);\n        this.yGizmo = new PlaneRotationGizmo(new Vector3(0, 1, 0), yColor, gizmoLayer, tessellation, this, useEulerRotation, thickness);\n        this.zGizmo = new PlaneRotationGizmo(new Vector3(0, 0, 1), zColor, gizmoLayer, tessellation, this, useEulerRotation, thickness);\n        // Relay drag events and set update scale\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            //must set updateScale on each gizmo, as setting it on root RotationGizmo doesnt prevent individual gizmos from updating\n            //currently updateScale is a property with no getter/setter, so no good way to override behavior at runtime, so we will at least set it on startup\n            if (options && options.updateScale != undefined) {\n                gizmo.updateScale = options.updateScale;\n            }\n            gizmo.dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n            });\n            gizmo.dragBehavior.onDragEndObservable.add(() => {\n                this.onDragEndObservable.notifyObservers({});\n            });\n        });\n        this.attachedMesh = null;\n        this.attachedNode = null;\n        if (gizmoManager) {\n            gizmoManager.addToAxisCache(this._gizmoAxisCache);\n        }\n        else {\n            // Only subscribe to pointer event if gizmoManager isnt\n            Gizmo.GizmoAxisPointerObserver(gizmoLayer, this._gizmoAxisCache);\n        }\n    }\n    /**\n     * If set the gizmo's rotation will be updated to match the attached mesh each frame (Default: true)\n     * NOTE: This is only possible for meshes with uniform scaling, as otherwise it's not possible to decompose the rotation\n     */\n    set updateGizmoRotationToMatchAttachedMesh(value) {\n        if (this.xGizmo) {\n            this.xGizmo.updateGizmoRotationToMatchAttachedMesh = value;\n            this.yGizmo.updateGizmoRotationToMatchAttachedMesh = value;\n            this.zGizmo.updateGizmoRotationToMatchAttachedMesh = value;\n        }\n    }\n    get updateGizmoRotationToMatchAttachedMesh() {\n        return this.xGizmo.updateGizmoRotationToMatchAttachedMesh;\n    }\n    set updateGizmoPositionToMatchAttachedMesh(value) {\n        if (this.xGizmo) {\n            this.xGizmo.updateGizmoPositionToMatchAttachedMesh = value;\n            this.yGizmo.updateGizmoPositionToMatchAttachedMesh = value;\n            this.zGizmo.updateGizmoPositionToMatchAttachedMesh = value;\n        }\n    }\n    get updateGizmoPositionToMatchAttachedMesh() {\n        return this.xGizmo.updateGizmoPositionToMatchAttachedMesh;\n    }\n    set updateScale(value) {\n        if (this.xGizmo) {\n            this.xGizmo.updateScale = value;\n            this.yGizmo.updateScale = value;\n            this.zGizmo.updateScale = value;\n        }\n    }\n    get updateScale() {\n        return this.xGizmo.updateScale;\n    }\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    set snapDistance(value) {\n        if (this.xGizmo) {\n            this.xGizmo.snapDistance = value;\n            this.yGizmo.snapDistance = value;\n            this.zGizmo.snapDistance = value;\n        }\n    }\n    get snapDistance() {\n        return this.xGizmo.snapDistance;\n    }\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    set scaleRatio(value) {\n        if (this.xGizmo) {\n            this.xGizmo.scaleRatio = value;\n            this.yGizmo.scaleRatio = value;\n            this.zGizmo.scaleRatio = value;\n        }\n    }\n    get scaleRatio() {\n        return this.xGizmo.scaleRatio;\n    }\n    /**\n     * Builds Gizmo Axis Cache to enable features such as hover state preservation and graying out other axis during manipulation\n     * @param mesh Axis gizmo mesh\n     * @param cache Gizmo axis definition used for reactive gizmo UI\n     */\n    addToAxisCache(mesh, cache) {\n        this._gizmoAxisCache.set(mesh, cache);\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        this.xGizmo.dispose();\n        this.yGizmo.dispose();\n        this.zGizmo.dispose();\n        this.onDragStartObservable.clear();\n        this.onDragEndObservable.clear();\n        this._observables.forEach((obs) => {\n            this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(obs);\n        });\n    }\n    /**\n     * CustomMeshes are not supported by this gizmo\n     */\n    setCustomMesh() {\n        Logger.Error(\"Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)\");\n    }\n}\n//# sourceMappingURL=rotationGizmo.js.map","import { Logger } from \"../Misc/logger.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { CreatePolyhedron } from \"../Meshes/Builders/polyhedronBuilder.js\";\nimport { Gizmo } from \"./gizmo.js\";\nimport { AxisScaleGizmo } from \"./axisScaleGizmo.js\";\nimport { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\n/**\n * Gizmo that enables scaling a mesh along 3 axis\n */\nexport class ScaleGizmo extends Gizmo {\n    /** Default material used to render when gizmo is not disabled or hovered */\n    get coloredMaterial() {\n        return this._coloredMaterial;\n    }\n    /** Material used to render when gizmo is hovered with mouse*/\n    get hoverMaterial() {\n        return this._hoverMaterial;\n    }\n    /** Material used to render when gizmo is disabled. typically grey.*/\n    get disableMaterial() {\n        return this._disableMaterial;\n    }\n    get attachedMesh() {\n        return this._meshAttached;\n    }\n    set attachedMesh(mesh) {\n        this._meshAttached = mesh;\n        this._nodeAttached = mesh;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedMesh = mesh;\n            }\n            else {\n                gizmo.attachedMesh = null;\n            }\n        });\n    }\n    get attachedNode() {\n        return this._nodeAttached;\n    }\n    set attachedNode(node) {\n        this._meshAttached = null;\n        this._nodeAttached = node;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedNode = node;\n            }\n            else {\n                gizmo.attachedNode = null;\n            }\n        });\n    }\n    set updateScale(value) {\n        if (this.xGizmo) {\n            this.xGizmo.updateScale = value;\n            this.yGizmo.updateScale = value;\n            this.zGizmo.updateScale = value;\n        }\n    }\n    get updateScale() {\n        return this.xGizmo.updateScale;\n    }\n    /**\n     * True when the mouse pointer is hovering a gizmo mesh\n     */\n    get isHovered() {\n        let hovered = false;\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            hovered = hovered || gizmo.isHovered;\n        });\n        return hovered;\n    }\n    /**\n     * Creates a ScaleGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param thickness display gizmo axis thickness\n     * @param gizmoManager\n     */\n    constructor(gizmoLayer = UtilityLayerRenderer.DefaultUtilityLayer, thickness = 1, gizmoManager) {\n        super(gizmoLayer);\n        this._meshAttached = null;\n        this._nodeAttached = null;\n        this._sensitivity = 1;\n        this._observables = [];\n        /** Node Caching for quick lookup */\n        this._gizmoAxisCache = new Map();\n        /** Fires an event when any of it's sub gizmos are dragged */\n        this.onDragStartObservable = new Observable();\n        /** Fires an event when any of it's sub gizmos are released from dragging */\n        this.onDragEndObservable = new Observable();\n        this.uniformScaleGizmo = this._createUniformScaleMesh();\n        this.xGizmo = new AxisScaleGizmo(new Vector3(1, 0, 0), Color3.Red().scale(0.5), gizmoLayer, this, thickness);\n        this.yGizmo = new AxisScaleGizmo(new Vector3(0, 1, 0), Color3.Green().scale(0.5), gizmoLayer, this, thickness);\n        this.zGizmo = new AxisScaleGizmo(new Vector3(0, 0, 1), Color3.Blue().scale(0.5), gizmoLayer, this, thickness);\n        // Relay drag events\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            gizmo.dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n            });\n            gizmo.dragBehavior.onDragEndObservable.add(() => {\n                this.onDragEndObservable.notifyObservers({});\n            });\n        });\n        this.attachedMesh = null;\n        this.attachedNode = null;\n        if (gizmoManager) {\n            gizmoManager.addToAxisCache(this._gizmoAxisCache);\n        }\n        else {\n            // Only subscribe to pointer event if gizmoManager isnt\n            Gizmo.GizmoAxisPointerObserver(gizmoLayer, this._gizmoAxisCache);\n        }\n    }\n    /** Create Geometry for Gizmo */\n    _createUniformScaleMesh() {\n        this._coloredMaterial = new StandardMaterial(\"\", this.gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = Color3.Gray();\n        this._hoverMaterial = new StandardMaterial(\"\", this.gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = Color3.Yellow();\n        this._disableMaterial = new StandardMaterial(\"\", this.gizmoLayer.utilityLayerScene);\n        this._disableMaterial.diffuseColor = Color3.Gray();\n        this._disableMaterial.alpha = 0.4;\n        const uniformScaleGizmo = new AxisScaleGizmo(new Vector3(0, 1, 0), Color3.Gray().scale(0.5), this.gizmoLayer, this);\n        uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh = false;\n        uniformScaleGizmo.uniformScaling = true;\n        this._uniformScalingMesh = CreatePolyhedron(\"uniform\", { type: 1 }, uniformScaleGizmo.gizmoLayer.utilityLayerScene);\n        this._uniformScalingMesh.scaling.scaleInPlace(0.01);\n        this._uniformScalingMesh.visibility = 0;\n        this._octahedron = CreatePolyhedron(\"\", { type: 1 }, uniformScaleGizmo.gizmoLayer.utilityLayerScene);\n        this._octahedron.scaling.scaleInPlace(0.007);\n        this._uniformScalingMesh.addChild(this._octahedron);\n        uniformScaleGizmo.setCustomMesh(this._uniformScalingMesh, true);\n        const light = this.gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._octahedron);\n        const cache = {\n            gizmoMeshes: [this._octahedron, this._uniformScalingMesh],\n            colliderMeshes: [this._uniformScalingMesh],\n            material: this._coloredMaterial,\n            hoverMaterial: this._hoverMaterial,\n            disableMaterial: this._disableMaterial,\n            active: false,\n            dragBehavior: uniformScaleGizmo.dragBehavior,\n        };\n        this.addToAxisCache(uniformScaleGizmo._rootMesh, cache);\n        return uniformScaleGizmo;\n    }\n    set updateGizmoRotationToMatchAttachedMesh(value) {\n        if (!value) {\n            Logger.Warn(\"Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.\");\n        }\n        else {\n            this._updateGizmoRotationToMatchAttachedMesh = value;\n            [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n                if (gizmo) {\n                    gizmo.updateGizmoRotationToMatchAttachedMesh = value;\n                }\n            });\n        }\n    }\n    get updateGizmoRotationToMatchAttachedMesh() {\n        return this._updateGizmoRotationToMatchAttachedMesh;\n    }\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    set snapDistance(value) {\n        this._snapDistance = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.snapDistance = value;\n            }\n        });\n    }\n    get snapDistance() {\n        return this._snapDistance;\n    }\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    set scaleRatio(value) {\n        this._scaleRatio = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.scaleRatio = value;\n            }\n        });\n    }\n    get scaleRatio() {\n        return this._scaleRatio;\n    }\n    /**\n     * Sensitivity factor for dragging (Default: 1)\n     */\n    set sensitivity(value) {\n        this._sensitivity = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.sensitivity = value;\n            }\n        });\n    }\n    get sensitivity() {\n        return this._sensitivity;\n    }\n    /**\n     * Builds Gizmo Axis Cache to enable features such as hover state preservation and graying out other axis during manipulation\n     * @param mesh Axis gizmo mesh\n     * @param cache Gizmo axis definition used for reactive gizmo UI\n     */\n    addToAxisCache(mesh, cache) {\n        this._gizmoAxisCache.set(mesh, cache);\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    dispose() {\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.dispose();\n            }\n        });\n        this._observables.forEach((obs) => {\n            this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(obs);\n        });\n        this.onDragStartObservable.clear();\n        this.onDragEndObservable.clear();\n        [this._uniformScalingMesh, this._octahedron].forEach((msh) => {\n            if (msh) {\n                msh.dispose();\n            }\n        });\n        [this._coloredMaterial, this._hoverMaterial, this._disableMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n    }\n}\n//# sourceMappingURL=scaleGizmo.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { ArcRotateCamera } from \"../Cameras/arcRotateCamera.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3, Color4 } from \"../Maths/math.color.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { BaseTexture } from \"../Materials/Textures/baseTexture.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { MirrorTexture } from \"../Materials/Textures/mirrorTexture.js\";\nimport { CubeTexture } from \"../Materials/Textures/cubeTexture.js\";\nimport { BackgroundMaterial } from \"../Materials/Background/backgroundMaterial.js\";\n\nimport { CreatePlane } from \"../Meshes/Builders/planeBuilder.js\";\nimport { CreateBox } from \"../Meshes/Builders/boxBuilder.js\";\nimport { Plane } from \"../Maths/math.plane.js\";\n/**\n * The Environment helper class can be used to add a fully featured none expensive background to your scene.\n * It includes by default a skybox and a ground relying on the BackgroundMaterial.\n * It also helps with the default setup of your imageProcessing configuration.\n */\nexport class EnvironmentHelper {\n    /**\n     * Creates the default options for the helper.\n     */\n    static _GetDefaultOptions() {\n        return {\n            createGround: true,\n            groundSize: 15,\n            groundTexture: this._GroundTextureCDNUrl,\n            groundColor: new Color3(0.2, 0.2, 0.3).toLinearSpace().scale(3),\n            groundOpacity: 0.9,\n            enableGroundShadow: true,\n            groundShadowLevel: 0.5,\n            enableGroundMirror: false,\n            groundMirrorSizeRatio: 0.3,\n            groundMirrorBlurKernel: 64,\n            groundMirrorAmount: 1,\n            groundMirrorFresnelWeight: 1,\n            groundMirrorFallOffDistance: 0,\n            groundMirrorTextureType: 0,\n            groundYBias: 0.00001,\n            createSkybox: true,\n            skyboxSize: 20,\n            skyboxTexture: this._SkyboxTextureCDNUrl,\n            skyboxColor: new Color3(0.2, 0.2, 0.3).toLinearSpace().scale(3),\n            backgroundYRotation: 0,\n            sizeAuto: true,\n            rootPosition: Vector3.Zero(),\n            setupImageProcessing: true,\n            environmentTexture: this._EnvironmentTextureCDNUrl,\n            cameraExposure: 0.8,\n            cameraContrast: 1.2,\n            toneMappingEnabled: true,\n        };\n    }\n    /**\n     * Gets the root mesh created by the helper.\n     */\n    get rootMesh() {\n        return this._rootMesh;\n    }\n    /**\n     * Gets the skybox created by the helper.\n     */\n    get skybox() {\n        return this._skybox;\n    }\n    /**\n     * Gets the skybox texture created by the helper.\n     */\n    get skyboxTexture() {\n        return this._skyboxTexture;\n    }\n    /**\n     * Gets the skybox material created by the helper.\n     */\n    get skyboxMaterial() {\n        return this._skyboxMaterial;\n    }\n    /**\n     * Gets the ground mesh created by the helper.\n     */\n    get ground() {\n        return this._ground;\n    }\n    /**\n     * Gets the ground texture created by the helper.\n     */\n    get groundTexture() {\n        return this._groundTexture;\n    }\n    /**\n     * Gets the ground mirror created by the helper.\n     */\n    get groundMirror() {\n        return this._groundMirror;\n    }\n    /**\n     * Gets the ground mirror render list to helps pushing the meshes\n     * you wish in the ground reflection.\n     */\n    get groundMirrorRenderList() {\n        if (this._groundMirror) {\n            return this._groundMirror.renderList;\n        }\n        return null;\n    }\n    /**\n     * Gets the ground material created by the helper.\n     */\n    get groundMaterial() {\n        return this._groundMaterial;\n    }\n    /**\n     * constructor\n     * @param options Defines the options we want to customize the helper\n     * @param scene The scene to add the material to\n     */\n    constructor(options, scene) {\n        this._errorHandler = (message, exception) => {\n            this.onErrorObservable.notifyObservers({ message: message, exception: exception });\n        };\n        this._options = {\n            ...EnvironmentHelper._GetDefaultOptions(),\n            ...options,\n        };\n        this._scene = scene;\n        this.onErrorObservable = new Observable();\n        this._setupBackground();\n        this._setupImageProcessing();\n    }\n    /**\n     * Updates the background according to the new options\n     * @param options\n     */\n    updateOptions(options) {\n        const newOptions = {\n            ...this._options,\n            ...options,\n        };\n        if (this._ground && !newOptions.createGround) {\n            this._ground.dispose();\n            this._ground = null;\n        }\n        if (this._groundMaterial && !newOptions.createGround) {\n            this._groundMaterial.dispose();\n            this._groundMaterial = null;\n        }\n        if (this._groundTexture) {\n            if (this._options.groundTexture != newOptions.groundTexture) {\n                this._groundTexture.dispose();\n                this._groundTexture = null;\n            }\n        }\n        if (this._skybox && !newOptions.createSkybox) {\n            this._skybox.dispose();\n            this._skybox = null;\n        }\n        if (this._skyboxMaterial && !newOptions.createSkybox) {\n            this._skyboxMaterial.dispose();\n            this._skyboxMaterial = null;\n        }\n        if (this._skyboxTexture) {\n            if (this._options.skyboxTexture != newOptions.skyboxTexture) {\n                this._skyboxTexture.dispose();\n                this._skyboxTexture = null;\n            }\n        }\n        if (this._groundMirror && !newOptions.enableGroundMirror) {\n            this._groundMirror.dispose();\n            this._groundMirror = null;\n        }\n        if (this._scene.environmentTexture) {\n            if (this._options.environmentTexture != newOptions.environmentTexture) {\n                this._scene.environmentTexture.dispose();\n            }\n        }\n        this._options = newOptions;\n        this._setupBackground();\n        this._setupImageProcessing();\n    }\n    /**\n     * Sets the primary color of all the available elements.\n     * @param color the main color to affect to the ground and the background\n     */\n    setMainColor(color) {\n        if (this.groundMaterial) {\n            this.groundMaterial.primaryColor = color;\n        }\n        if (this.skyboxMaterial) {\n            this.skyboxMaterial.primaryColor = color;\n        }\n        if (this.groundMirror) {\n            this.groundMirror.clearColor = new Color4(color.r, color.g, color.b, 1.0);\n        }\n    }\n    /**\n     * Setup the image processing according to the specified options.\n     */\n    _setupImageProcessing() {\n        if (this._options.setupImageProcessing) {\n            this._scene.imageProcessingConfiguration.contrast = this._options.cameraContrast;\n            this._scene.imageProcessingConfiguration.exposure = this._options.cameraExposure;\n            this._scene.imageProcessingConfiguration.toneMappingEnabled = this._options.toneMappingEnabled;\n            this._setupEnvironmentTexture();\n        }\n    }\n    /**\n     * Setup the environment texture according to the specified options.\n     */\n    _setupEnvironmentTexture() {\n        if (this._scene.environmentTexture) {\n            return;\n        }\n        if (this._options.environmentTexture instanceof BaseTexture) {\n            this._scene.environmentTexture = this._options.environmentTexture;\n            return;\n        }\n        const environmentTexture = CubeTexture.CreateFromPrefilteredData(this._options.environmentTexture, this._scene);\n        this._scene.environmentTexture = environmentTexture;\n    }\n    /**\n     * Setup the background according to the specified options.\n     */\n    _setupBackground() {\n        if (!this._rootMesh) {\n            this._rootMesh = new Mesh(\"BackgroundHelper\", this._scene);\n        }\n        this._rootMesh.rotation.y = this._options.backgroundYRotation;\n        const sceneSize = this._getSceneSize();\n        if (this._options.createGround) {\n            this._setupGround(sceneSize);\n            this._setupGroundMaterial();\n            this._setupGroundDiffuseTexture();\n            if (this._options.enableGroundMirror) {\n                this._setupGroundMirrorTexture(sceneSize);\n            }\n            this._setupMirrorInGroundMaterial();\n        }\n        if (this._options.createSkybox) {\n            this._setupSkybox(sceneSize);\n            this._setupSkyboxMaterial();\n            this._setupSkyboxReflectionTexture();\n        }\n        this._rootMesh.position.x = sceneSize.rootPosition.x;\n        this._rootMesh.position.z = sceneSize.rootPosition.z;\n        this._rootMesh.position.y = sceneSize.rootPosition.y;\n    }\n    /**\n     * Get the scene sizes according to the setup.\n     */\n    _getSceneSize() {\n        let groundSize = this._options.groundSize;\n        let skyboxSize = this._options.skyboxSize;\n        let rootPosition = this._options.rootPosition;\n        if (!this._scene.meshes || this._scene.meshes.length === 1) {\n            // 1 only means the root of the helper.\n            return { groundSize, skyboxSize, rootPosition };\n        }\n        const sceneExtends = this._scene.getWorldExtends((mesh) => {\n            return mesh !== this._ground && mesh !== this._rootMesh && mesh !== this._skybox;\n        });\n        const sceneDiagonal = sceneExtends.max.subtract(sceneExtends.min);\n        if (this._options.sizeAuto) {\n            if (this._scene.activeCamera instanceof ArcRotateCamera && this._scene.activeCamera.upperRadiusLimit) {\n                groundSize = this._scene.activeCamera.upperRadiusLimit * 2;\n                skyboxSize = groundSize;\n            }\n            const sceneDiagonalLenght = sceneDiagonal.length();\n            if (sceneDiagonalLenght > groundSize) {\n                groundSize = sceneDiagonalLenght * 2;\n                skyboxSize = groundSize;\n            }\n            // 10 % bigger.\n            groundSize *= 1.1;\n            skyboxSize *= 1.5;\n            rootPosition = sceneExtends.min.add(sceneDiagonal.scale(0.5));\n            rootPosition.y = sceneExtends.min.y - this._options.groundYBias;\n        }\n        return { groundSize, skyboxSize, rootPosition };\n    }\n    /**\n     * Setup the ground according to the specified options.\n     * @param sceneSize\n     */\n    _setupGround(sceneSize) {\n        if (!this._ground || this._ground.isDisposed()) {\n            this._ground = CreatePlane(\"BackgroundPlane\", { size: sceneSize.groundSize }, this._scene);\n            this._ground.rotation.x = Math.PI / 2; // Face up by default.\n            this._ground.parent = this._rootMesh;\n            this._ground.onDisposeObservable.add(() => {\n                this._ground = null;\n            });\n        }\n        this._ground.receiveShadows = this._options.enableGroundShadow;\n    }\n    /**\n     * Setup the ground material according to the specified options.\n     */\n    _setupGroundMaterial() {\n        if (!this._groundMaterial) {\n            this._groundMaterial = new BackgroundMaterial(\"BackgroundPlaneMaterial\", this._scene);\n        }\n        this._groundMaterial.alpha = this._options.groundOpacity;\n        this._groundMaterial.alphaMode = 8;\n        this._groundMaterial.shadowLevel = this._options.groundShadowLevel;\n        this._groundMaterial.primaryColor = this._options.groundColor;\n        this._groundMaterial.useRGBColor = false;\n        this._groundMaterial.enableNoise = true;\n        if (this._ground) {\n            this._ground.material = this._groundMaterial;\n        }\n    }\n    /**\n     * Setup the ground diffuse texture according to the specified options.\n     */\n    _setupGroundDiffuseTexture() {\n        if (!this._groundMaterial) {\n            return;\n        }\n        if (this._groundTexture) {\n            return;\n        }\n        if (this._options.groundTexture instanceof BaseTexture) {\n            this._groundMaterial.diffuseTexture = this._options.groundTexture;\n            return;\n        }\n        this._groundTexture = new Texture(this._options.groundTexture, this._scene, undefined, undefined, undefined, undefined, this._errorHandler);\n        this._groundTexture.gammaSpace = false;\n        this._groundTexture.hasAlpha = true;\n        this._groundMaterial.diffuseTexture = this._groundTexture;\n    }\n    /**\n     * Setup the ground mirror texture according to the specified options.\n     * @param sceneSize\n     */\n    _setupGroundMirrorTexture(sceneSize) {\n        const wrapping = Texture.CLAMP_ADDRESSMODE;\n        if (!this._groundMirror) {\n            this._groundMirror = new MirrorTexture(\"BackgroundPlaneMirrorTexture\", { ratio: this._options.groundMirrorSizeRatio }, this._scene, false, this._options.groundMirrorTextureType, Texture.BILINEAR_SAMPLINGMODE, true);\n            this._groundMirror.mirrorPlane = new Plane(0, -1, 0, sceneSize.rootPosition.y);\n            this._groundMirror.anisotropicFilteringLevel = 1;\n            this._groundMirror.wrapU = wrapping;\n            this._groundMirror.wrapV = wrapping;\n            if (this._groundMirror.renderList) {\n                for (let i = 0; i < this._scene.meshes.length; i++) {\n                    const mesh = this._scene.meshes[i];\n                    if (mesh !== this._ground && mesh !== this._skybox && mesh !== this._rootMesh) {\n                        this._groundMirror.renderList.push(mesh);\n                    }\n                }\n            }\n        }\n        const gammaGround = this._options.groundColor.toGammaSpace();\n        this._groundMirror.clearColor = new Color4(gammaGround.r, gammaGround.g, gammaGround.b, 1);\n        this._groundMirror.adaptiveBlurKernel = this._options.groundMirrorBlurKernel;\n    }\n    /**\n     * Setup the ground to receive the mirror texture.\n     */\n    _setupMirrorInGroundMaterial() {\n        if (this._groundMaterial) {\n            this._groundMaterial.reflectionTexture = this._groundMirror;\n            this._groundMaterial.reflectionFresnel = true;\n            this._groundMaterial.reflectionAmount = this._options.groundMirrorAmount;\n            this._groundMaterial.reflectionStandardFresnelWeight = this._options.groundMirrorFresnelWeight;\n            this._groundMaterial.reflectionFalloffDistance = this._options.groundMirrorFallOffDistance;\n        }\n    }\n    /**\n     * Setup the skybox according to the specified options.\n     * @param sceneSize\n     */\n    _setupSkybox(sceneSize) {\n        if (!this._skybox || this._skybox.isDisposed()) {\n            this._skybox = CreateBox(\"BackgroundSkybox\", { size: sceneSize.skyboxSize, sideOrientation: Mesh.BACKSIDE }, this._scene);\n            this._skybox.onDisposeObservable.add(() => {\n                this._skybox = null;\n            });\n        }\n        this._skybox.parent = this._rootMesh;\n    }\n    /**\n     * Setup the skybox material according to the specified options.\n     */\n    _setupSkyboxMaterial() {\n        if (!this._skybox) {\n            return;\n        }\n        if (!this._skyboxMaterial) {\n            this._skyboxMaterial = new BackgroundMaterial(\"BackgroundSkyboxMaterial\", this._scene);\n        }\n        this._skyboxMaterial.useRGBColor = false;\n        this._skyboxMaterial.primaryColor = this._options.skyboxColor;\n        this._skyboxMaterial.enableNoise = true;\n        this._skybox.material = this._skyboxMaterial;\n    }\n    /**\n     * Setup the skybox reflection texture according to the specified options.\n     */\n    _setupSkyboxReflectionTexture() {\n        if (!this._skyboxMaterial) {\n            return;\n        }\n        if (this._skyboxTexture) {\n            return;\n        }\n        if (this._options.skyboxTexture instanceof BaseTexture) {\n            this._skyboxMaterial.reflectionTexture = this._options.skyboxTexture;\n            return;\n        }\n        this._skyboxTexture = new CubeTexture(this._options.skyboxTexture, this._scene, undefined, undefined, undefined, undefined, this._errorHandler);\n        this._skyboxTexture.coordinatesMode = Texture.SKYBOX_MODE;\n        this._skyboxTexture.gammaSpace = false;\n        this._skyboxMaterial.reflectionTexture = this._skyboxTexture;\n    }\n    /**\n     * Dispose all the elements created by the Helper.\n     */\n    dispose() {\n        if (this._groundMaterial) {\n            this._groundMaterial.dispose(true, true);\n        }\n        if (this._skyboxMaterial) {\n            this._skyboxMaterial.dispose(true, true);\n        }\n        this._rootMesh.dispose(false);\n    }\n}\n/**\n * Default ground texture URL.\n */\nEnvironmentHelper._GroundTextureCDNUrl = \"https://assets.babylonjs.com/environments/backgroundGround.png\";\n/**\n * Default skybox texture URL.\n */\nEnvironmentHelper._SkyboxTextureCDNUrl = \"https://assets.babylonjs.com/environments/backgroundSkybox.dds\";\n/**\n * Default environment texture URL.\n */\nEnvironmentHelper._EnvironmentTextureCDNUrl = \"https://assets.babylonjs.com/environments/environmentSpecular.env\";\n//# sourceMappingURL=environmentHelper.js.map","import { TransformNode } from \"../Meshes/transformNode.js\";\nimport { Mesh } from \"../Meshes/mesh.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { BackgroundMaterial } from \"../Materials/Background/backgroundMaterial.js\";\nimport { CreateSphere } from \"../Meshes/Builders/sphereBuilder.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Axis } from \"../Maths/math.js\";\n/**\n * Display a 360/180 degree texture on an approximately spherical surface, useful for VR applications or skyboxes.\n * As a subclass of TransformNode, this allow parenting to the camera or multiple textures with different locations in the scene.\n * This class achieves its effect with a Texture and a correctly configured BackgroundMaterial on an inverted sphere.\n * Potential additions to this helper include zoom and and non-infinite distance rendering effects.\n */\nexport class TextureDome extends TransformNode {\n    /**\n     * Gets the texture being displayed on the sphere\n     */\n    get texture() {\n        return this._texture;\n    }\n    /**\n     * Sets the texture being displayed on the sphere\n     */\n    set texture(newTexture) {\n        if (this._texture === newTexture) {\n            return;\n        }\n        this._texture = newTexture;\n        if (this._useDirectMapping) {\n            this._texture.wrapU = Texture.CLAMP_ADDRESSMODE;\n            this._texture.wrapV = Texture.CLAMP_ADDRESSMODE;\n            this._material.diffuseTexture = this._texture;\n        }\n        else {\n            this._texture.coordinatesMode = Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE; // matches orientation\n            this._texture.wrapV = Texture.CLAMP_ADDRESSMODE;\n            this._material.reflectionTexture = this._texture;\n        }\n        this._changeTextureMode(this._textureMode);\n    }\n    /**\n     * Gets the mesh used for the dome.\n     */\n    get mesh() {\n        return this._mesh;\n    }\n    /**\n     * The current fov(field of view) multiplier, 0.0 - 2.0. Defaults to 1.0. Lower values \"zoom in\" and higher values \"zoom out\".\n     * Also see the options.resolution property.\n     */\n    get fovMultiplier() {\n        return this._material.fovMultiplier;\n    }\n    set fovMultiplier(value) {\n        this._material.fovMultiplier = value;\n    }\n    /**\n     * Gets or set the current texture mode for the texture. It can be:\n     * * TextureDome.MODE_MONOSCOPIC : Define the texture source as a Monoscopic panoramic 360.\n     * * TextureDome.MODE_TOPBOTTOM  : Define the texture source as a Stereoscopic TopBottom/OverUnder panoramic 360.\n     * * TextureDome.MODE_SIDEBYSIDE : Define the texture source as a Stereoscopic Side by Side panoramic 360.\n     */\n    get textureMode() {\n        return this._textureMode;\n    }\n    /**\n     * Sets the current texture mode for the texture. It can be:\n     * * TextureDome.MODE_MONOSCOPIC : Define the texture source as a Monoscopic panoramic 360.\n     * * TextureDome.MODE_TOPBOTTOM  : Define the texture source as a Stereoscopic TopBottom/OverUnder panoramic 360.\n     * * TextureDome.MODE_SIDEBYSIDE : Define the texture source as a Stereoscopic Side by Side panoramic 360.\n     */\n    set textureMode(value) {\n        if (this._textureMode === value) {\n            return;\n        }\n        this._changeTextureMode(value);\n    }\n    /**\n     * Is it a 180 degrees dome (half dome) or 360 texture (full dome)\n     */\n    get halfDome() {\n        return this._halfDome;\n    }\n    /**\n     * Set the halfDome mode. If set, only the front (180 degrees) will be displayed and the back will be blacked out.\n     */\n    set halfDome(enabled) {\n        this._halfDome = enabled;\n        this._halfDomeMask.setEnabled(enabled);\n        this._changeTextureMode(this._textureMode);\n    }\n    /**\n     * Set the cross-eye mode. If set, images that can be seen when crossing eyes will render correctly\n     */\n    set crossEye(enabled) {\n        this._crossEye = enabled;\n        this._changeTextureMode(this._textureMode);\n    }\n    /**\n     * Is it a cross-eye texture?\n     */\n    get crossEye() {\n        return this._crossEye;\n    }\n    /**\n     * The background material of this dome.\n     */\n    get material() {\n        return this._material;\n    }\n    /**\n     * Create an instance of this class and pass through the parameters to the relevant classes- Texture, StandardMaterial, and Mesh.\n     * @param name Element's name, child elements will append suffixes for their own names.\n     * @param textureUrlOrElement defines the url(s) or the (video) HTML element to use\n     * @param options An object containing optional or exposed sub element properties\n     * @param options.resolution\n     * @param options.clickToPlay\n     * @param options.autoPlay\n     * @param options.loop\n     * @param options.size\n     * @param options.poster\n     * @param options.faceForward\n     * @param options.useDirectMapping\n     * @param options.halfDomeMode\n     * @param options.crossEyeMode\n     * @param options.generateMipMaps\n     * @param options.mesh\n     * @param scene\n     * @param onError\n     */\n    constructor(name, textureUrlOrElement, options, scene, \n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    onError = null) {\n        super(name, scene);\n        this.onError = onError;\n        this._halfDome = false;\n        this._crossEye = false;\n        this._useDirectMapping = false;\n        this._textureMode = TextureDome.MODE_MONOSCOPIC;\n        /**\n         * Oberserver used in Stereoscopic VR Mode.\n         */\n        this._onBeforeCameraRenderObserver = null;\n        /**\n         * Observable raised when an error occurred while loading the texture\n         */\n        this.onLoadErrorObservable = new Observable();\n        /**\n         * Observable raised when the texture finished loading\n         */\n        this.onLoadObservable = new Observable();\n        scene = this.getScene();\n        // set defaults and manage values\n        name = name || \"textureDome\";\n        options.resolution = Math.abs(options.resolution) | 0 || 32;\n        options.clickToPlay = Boolean(options.clickToPlay);\n        options.autoPlay = options.autoPlay === undefined ? true : Boolean(options.autoPlay);\n        options.loop = options.loop === undefined ? true : Boolean(options.loop);\n        options.size = Math.abs(options.size) || (scene.activeCamera ? scene.activeCamera.maxZ * 0.48 : 1000);\n        if (options.useDirectMapping === undefined) {\n            this._useDirectMapping = true;\n        }\n        else {\n            this._useDirectMapping = options.useDirectMapping;\n        }\n        if (options.faceForward === undefined) {\n            options.faceForward = true;\n        }\n        this._setReady(false);\n        if (!options.mesh) {\n            this._mesh = CreateSphere(name + \"_mesh\", { segments: options.resolution, diameter: options.size, updatable: false, sideOrientation: Mesh.BACKSIDE }, scene);\n        }\n        else {\n            this._mesh = options.mesh;\n        }\n        // configure material\n        const material = (this._material = new BackgroundMaterial(name + \"_material\", scene));\n        material.useEquirectangularFOV = true;\n        material.fovMultiplier = 1.0;\n        material.opacityFresnel = false;\n        const texture = this._initTexture(textureUrlOrElement, scene, options);\n        this.texture = texture;\n        // configure mesh\n        this._mesh.material = material;\n        this._mesh.parent = this;\n        // create a (disabled until needed) mask to cover unneeded segments of 180 texture.\n        this._halfDomeMask = CreateSphere(\"\", { slice: 0.5, diameter: options.size * 0.98, segments: options.resolution * 2, sideOrientation: Mesh.BACKSIDE }, scene);\n        this._halfDomeMask.rotate(Axis.X, -Math.PI / 2);\n        // set the parent, so it will always be positioned correctly AND will be disposed when the main sphere is disposed\n        this._halfDomeMask.parent = this._mesh;\n        this._halfDome = !!options.halfDomeMode;\n        // enable or disable according to the settings\n        this._halfDomeMask.setEnabled(this._halfDome);\n        this._crossEye = !!options.crossEyeMode;\n        // create\n        this._texture.anisotropicFilteringLevel = 1;\n        this._texture.onLoadObservable.addOnce(() => {\n            this._setReady(true);\n        });\n        // Initial rotation\n        if (options.faceForward && scene.activeCamera) {\n            const camera = scene.activeCamera;\n            const forward = Vector3.Forward();\n            const direction = Vector3.TransformNormal(forward, camera.getViewMatrix());\n            direction.normalize();\n            this.rotation.y = Math.acos(Vector3.Dot(forward, direction));\n        }\n        this._changeTextureMode(this._textureMode);\n    }\n    _changeTextureMode(value) {\n        this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver);\n        this._textureMode = value;\n        // Default Setup and Reset.\n        this._texture.uScale = 1;\n        this._texture.vScale = 1;\n        this._texture.uOffset = 0;\n        this._texture.vOffset = 0;\n        this._texture.vAng = 0;\n        switch (value) {\n            case TextureDome.MODE_MONOSCOPIC:\n                if (this._halfDome) {\n                    this._texture.uScale = 2;\n                    this._texture.uOffset = -1;\n                }\n                break;\n            case TextureDome.MODE_SIDEBYSIDE: {\n                // in half-dome mode the uScale should be double of 360 texture\n                // Use 0.99999 to boost perf by not switching program\n                this._texture.uScale = this._halfDome ? 0.99999 : 0.5;\n                const rightOffset = this._halfDome ? 0.0 : 0.5;\n                const leftOffset = this._halfDome ? -0.5 : 0.0;\n                this._onBeforeCameraRenderObserver = this._scene.onBeforeCameraRenderObservable.add((camera) => {\n                    let isRightCamera = camera.isRightCamera;\n                    if (this._crossEye) {\n                        isRightCamera = !isRightCamera;\n                    }\n                    if (isRightCamera) {\n                        this._texture.uOffset = rightOffset;\n                    }\n                    else {\n                        this._texture.uOffset = leftOffset;\n                    }\n                });\n                break;\n            }\n            case TextureDome.MODE_TOPBOTTOM:\n                // in half-dome mode the vScale should be double of 360 texture\n                // Use 0.99999 to boost perf by not switching program\n                this._texture.vScale = this._halfDome ? 0.99999 : 0.5;\n                this._onBeforeCameraRenderObserver = this._scene.onBeforeCameraRenderObservable.add((camera) => {\n                    let isRightCamera = camera.isRightCamera;\n                    // allow \"cross-eye\" if left and right were switched in this mode\n                    if (this._crossEye) {\n                        isRightCamera = !isRightCamera;\n                    }\n                    this._texture.vOffset = isRightCamera ? 0.5 : 0.0;\n                });\n                break;\n        }\n    }\n    /**\n     * Releases resources associated with this node.\n     * @param doNotRecurse Set to true to not recurse into each children (recurse into each children by default)\n     * @param disposeMaterialAndTextures Set to true to also dispose referenced materials and textures (false by default)\n     */\n    dispose(doNotRecurse, disposeMaterialAndTextures = false) {\n        this._texture.dispose();\n        this._mesh.dispose();\n        this._material.dispose();\n        this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver);\n        this.onLoadErrorObservable.clear();\n        this.onLoadObservable.clear();\n        super.dispose(doNotRecurse, disposeMaterialAndTextures);\n    }\n}\n/**\n * Define the source as a Monoscopic panoramic 360/180.\n */\nTextureDome.MODE_MONOSCOPIC = 0;\n/**\n * Define the source as a Stereoscopic TopBottom/OverUnder panoramic 360/180.\n */\nTextureDome.MODE_TOPBOTTOM = 1;\n/**\n * Define the source as a Stereoscopic Side by Side panoramic 360/180.\n */\nTextureDome.MODE_SIDEBYSIDE = 2;\n//# sourceMappingURL=textureDome.js.map","import { Texture } from \"../Materials/Textures/texture.js\";\nimport { TextureDome } from \"./textureDome.js\";\n/**\n * Display a 360 degree photo on an approximately spherical surface, useful for VR applications or skyboxes.\n * As a subclass of TransformNode, this allow parenting to the camera with different locations in the scene.\n * This class achieves its effect with a Texture and a correctly configured BackgroundMaterial on an inverted sphere.\n * Potential additions to this helper include zoom and and non-infinite distance rendering effects.\n */\nexport class PhotoDome extends TextureDome {\n    /**\n     * Gets or sets the texture being displayed on the sphere\n     */\n    get photoTexture() {\n        return this.texture;\n    }\n    /**\n     * sets the texture being displayed on the sphere\n     */\n    set photoTexture(value) {\n        this.texture = value;\n    }\n    /**\n     * Gets the current video mode for the video. It can be:\n     * * TextureDome.MODE_MONOSCOPIC : Define the texture source as a Monoscopic panoramic 360.\n     * * TextureDome.MODE_TOPBOTTOM  : Define the texture source as a Stereoscopic TopBottom/OverUnder panoramic 360.\n     * * TextureDome.MODE_SIDEBYSIDE : Define the texture source as a Stereoscopic Side by Side panoramic 360.\n     */\n    get imageMode() {\n        return this.textureMode;\n    }\n    /**\n     * Sets the current video mode for the video. It can be:\n     * * TextureDome.MODE_MONOSCOPIC : Define the texture source as a Monoscopic panoramic 360.\n     * * TextureDome.MODE_TOPBOTTOM  : Define the texture source as a Stereoscopic TopBottom/OverUnder panoramic 360.\n     * * TextureDome.MODE_SIDEBYSIDE : Define the texture source as a Stereoscopic Side by Side panoramic 360.\n     */\n    set imageMode(value) {\n        this.textureMode = value;\n    }\n    _initTexture(urlsOrElement, scene, options) {\n        return new Texture(urlsOrElement, scene, !options.generateMipMaps, !this._useDirectMapping, undefined, () => {\n            this.onLoadObservable.notifyObservers();\n        }, (message, exception) => {\n            this.onLoadErrorObservable.notifyObservers(message || \"Unknown error occured\");\n            if (this.onError) {\n                this.onError(message, exception);\n            }\n        });\n    }\n}\n/**\n * Define the image as a Monoscopic panoramic 360 image.\n */\nPhotoDome.MODE_MONOSCOPIC = TextureDome.MODE_MONOSCOPIC;\n/**\n * Define the image as a Stereoscopic TopBottom/OverUnder panoramic 360 image.\n */\nPhotoDome.MODE_TOPBOTTOM = TextureDome.MODE_TOPBOTTOM;\n/**\n * Define the image as a Stereoscopic Side by Side panoramic 360 image.\n */\nPhotoDome.MODE_SIDEBYSIDE = TextureDome.MODE_SIDEBYSIDE;\n//# sourceMappingURL=photoDome.js.map","import { Texture } from \"../Materials/Textures/texture.js\";\nimport { VideoTexture } from \"../Materials/Textures/videoTexture.js\";\nimport { TextureDome } from \"./textureDome.js\";\nimport { PointerEventTypes } from \"../Events/pointerEvents.js\";\n/**\n * Display a 360/180 degree video on an approximately spherical surface, useful for VR applications or skyboxes.\n * As a subclass of TransformNode, this allow parenting to the camera or multiple videos with different locations in the scene.\n * This class achieves its effect with a VideoTexture and a correctly configured BackgroundMaterial on an inverted sphere.\n * Potential additions to this helper include zoom and and non-infinite distance rendering effects.\n */\nexport class VideoDome extends TextureDome {\n    /**\n     * Get the video texture associated with this video dome\n     */\n    get videoTexture() {\n        return this._texture;\n    }\n    /**\n     * Get the video mode of this dome\n     */\n    get videoMode() {\n        return this.textureMode;\n    }\n    /**\n     * Set the video mode of this dome.\n     * @see textureMode\n     */\n    set videoMode(value) {\n        this.textureMode = value;\n    }\n    _initTexture(urlsOrElement, scene, options) {\n        const tempOptions = { loop: options.loop, autoPlay: options.autoPlay, autoUpdateTexture: true, poster: options.poster };\n        const texture = new VideoTexture((this.name || \"videoDome\") + \"_texture\", urlsOrElement, scene, options.generateMipMaps, this._useDirectMapping, Texture.TRILINEAR_SAMPLINGMODE, tempOptions);\n        // optional configuration\n        if (options.clickToPlay) {\n            this._pointerObserver = scene.onPointerObservable.add((data) => {\n                var _a;\n                ((_a = data.pickInfo) === null || _a === void 0 ? void 0 : _a.pickedMesh) === this.mesh && this._texture.video.play();\n            }, PointerEventTypes.POINTERDOWN);\n        }\n        this._textureObserver = texture.onLoadObservable.add(() => {\n            this.onLoadObservable.notifyObservers();\n        });\n        return texture;\n    }\n    /**\n     * Releases resources associated with this node.\n     * @param doNotRecurse Set to true to not recurse into each children (recurse into each children by default)\n     * @param disposeMaterialAndTextures Set to true to also dispose referenced materials and textures (false by default)\n     */\n    dispose(doNotRecurse, disposeMaterialAndTextures = false) {\n        this._texture.onLoadObservable.remove(this._textureObserver);\n        this._scene.onPointerObservable.remove(this._pointerObserver);\n        super.dispose(doNotRecurse, disposeMaterialAndTextures);\n    }\n}\n/**\n * Define the video source as a Monoscopic panoramic 360 video.\n */\nVideoDome.MODE_MONOSCOPIC = TextureDome.MODE_MONOSCOPIC;\n/**\n * Define the video source as a Stereoscopic TopBottom/OverUnder panoramic 360 video.\n */\nVideoDome.MODE_TOPBOTTOM = TextureDome.MODE_TOPBOTTOM;\n/**\n * Define the video source as a Stereoscopic Side by Side panoramic 360 video.\n */\nVideoDome.MODE_SIDEBYSIDE = TextureDome.MODE_SIDEBYSIDE;\n//# sourceMappingURL=videoDome.js.map","import { Logger } from \"../Misc/logger.js\";\nimport { Scene } from \"../scene.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { StandardMaterial } from \"../Materials/standardMaterial.js\";\nimport { PBRMaterial } from \"../Materials/PBR/pbrMaterial.js\";\nimport { HemisphericLight } from \"../Lights/hemisphericLight.js\";\nimport { EnvironmentHelper } from \"./environmentHelper.js\";\nimport { FreeCamera } from \"../Cameras/freeCamera.js\";\nimport { ArcRotateCamera } from \"../Cameras/arcRotateCamera.js\";\nimport { VRExperienceHelper } from \"../Cameras/VR/vrExperienceHelper.js\";\nimport \"../Materials/Textures/Loaders/ddsTextureLoader.js\";\nimport \"../Materials/Textures/Loaders/envTextureLoader.js\";\nimport \"../Materials/Textures/Loaders/ktxTextureLoader.js\";\nimport { CreateBox } from \"../Meshes/Builders/boxBuilder.js\";\nimport { WebXRDefaultExperience } from \"../XR/webXRDefaultExperience.js\";\n/** @internal */\n// eslint-disable-next-line no-var\nexport var _forceSceneHelpersToBundle = true;\nScene.prototype.createDefaultLight = function (replace = false) {\n    // Dispose existing light in replace mode.\n    if (replace) {\n        if (this.lights) {\n            for (let i = 0; i < this.lights.length; i++) {\n                this.lights[i].dispose();\n            }\n        }\n    }\n    // Light\n    if (this.lights.length === 0) {\n        new HemisphericLight(\"default light\", Vector3.Up(), this);\n    }\n};\nScene.prototype.createDefaultCamera = function (createArcRotateCamera = false, replace = false, attachCameraControls = false) {\n    // Dispose existing camera in replace mode.\n    if (replace) {\n        if (this.activeCamera) {\n            this.activeCamera.dispose();\n            this.activeCamera = null;\n        }\n    }\n    // Camera\n    if (!this.activeCamera) {\n        const worldExtends = this.getWorldExtends((mesh) => mesh.isVisible && mesh.isEnabled());\n        const worldSize = worldExtends.max.subtract(worldExtends.min);\n        const worldCenter = worldExtends.min.add(worldSize.scale(0.5));\n        let camera;\n        let radius = worldSize.length() * 1.5;\n        // empty scene scenario!\n        if (!isFinite(radius)) {\n            radius = 1;\n            worldCenter.copyFromFloats(0, 0, 0);\n        }\n        if (createArcRotateCamera) {\n            const arcRotateCamera = new ArcRotateCamera(\"default camera\", -(Math.PI / 2), Math.PI / 2, radius, worldCenter, this);\n            arcRotateCamera.lowerRadiusLimit = radius * 0.01;\n            arcRotateCamera.wheelPrecision = 100 / radius;\n            camera = arcRotateCamera;\n        }\n        else {\n            const freeCamera = new FreeCamera(\"default camera\", new Vector3(worldCenter.x, worldCenter.y, -radius), this);\n            freeCamera.setTarget(worldCenter);\n            camera = freeCamera;\n        }\n        camera.minZ = radius * 0.01;\n        camera.maxZ = radius * 1000;\n        camera.speed = radius * 0.2;\n        this.activeCamera = camera;\n        if (attachCameraControls) {\n            camera.attachControl();\n        }\n    }\n};\nScene.prototype.createDefaultCameraOrLight = function (createArcRotateCamera = false, replace = false, attachCameraControls = false) {\n    this.createDefaultLight(replace);\n    this.createDefaultCamera(createArcRotateCamera, replace, attachCameraControls);\n};\nScene.prototype.createDefaultSkybox = function (environmentTexture, pbr = false, scale = 1000, blur = 0, setGlobalEnvTexture = true) {\n    if (!environmentTexture) {\n        Logger.Warn(\"Can not create default skybox without environment texture.\");\n        return null;\n    }\n    if (setGlobalEnvTexture) {\n        if (environmentTexture) {\n            this.environmentTexture = environmentTexture;\n        }\n    }\n    // Skybox\n    const hdrSkybox = CreateBox(\"hdrSkyBox\", { size: scale }, this);\n    if (pbr) {\n        const hdrSkyboxMaterial = new PBRMaterial(\"skyBox\", this);\n        hdrSkyboxMaterial.backFaceCulling = false;\n        hdrSkyboxMaterial.reflectionTexture = environmentTexture.clone();\n        if (hdrSkyboxMaterial.reflectionTexture) {\n            hdrSkyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\n        }\n        hdrSkyboxMaterial.microSurface = 1.0 - blur;\n        hdrSkyboxMaterial.disableLighting = true;\n        hdrSkyboxMaterial.twoSidedLighting = true;\n        hdrSkybox.material = hdrSkyboxMaterial;\n    }\n    else {\n        const skyboxMaterial = new StandardMaterial(\"skyBox\", this);\n        skyboxMaterial.backFaceCulling = false;\n        skyboxMaterial.reflectionTexture = environmentTexture.clone();\n        if (skyboxMaterial.reflectionTexture) {\n            skyboxMaterial.reflectionTexture.coordinatesMode = Texture.SKYBOX_MODE;\n        }\n        skyboxMaterial.disableLighting = true;\n        hdrSkybox.material = skyboxMaterial;\n    }\n    hdrSkybox.isPickable = false;\n    hdrSkybox.infiniteDistance = true;\n    hdrSkybox.ignoreCameraMaxZ = true;\n    return hdrSkybox;\n};\nScene.prototype.createDefaultEnvironment = function (options) {\n    if (EnvironmentHelper) {\n        return new EnvironmentHelper(options, this);\n    }\n    return null;\n};\nScene.prototype.createDefaultVRExperience = function (webVROptions = {}) {\n    return new VRExperienceHelper(this, webVROptions);\n};\nScene.prototype.createDefaultXRExperienceAsync = function (options = {}) {\n    return WebXRDefaultExperience.CreateAsync(this, options).then((helper) => {\n        return helper;\n    });\n};\n//# sourceMappingURL=sceneHelpers.js.map","import { PointerInfoPre, PointerInfo, PointerEventTypes } from \"../Events/pointerEvents.js\";\nimport { AbstractActionManager } from \"../Actions/abstractActionManager.js\";\nimport { PickingInfo } from \"../Collisions/pickingInfo.js\";\nimport { Vector2, Matrix } from \"../Maths/math.vector.js\";\n\nimport { ActionEvent } from \"../Actions/actionEvent.js\";\nimport { KeyboardEventTypes, KeyboardInfoPre, KeyboardInfo } from \"../Events/keyboardEvents.js\";\nimport { DeviceType, PointerInput } from \"../DeviceInput/InputDevices/deviceEnums.js\";\nimport { DeviceSourceManager } from \"../DeviceInput/InputDevices/deviceSourceManager.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nclass _ClickInfo {\n    constructor() {\n        this._singleClick = false;\n        this._doubleClick = false;\n        this._hasSwiped = false;\n        this._ignore = false;\n    }\n    get singleClick() {\n        return this._singleClick;\n    }\n    get doubleClick() {\n        return this._doubleClick;\n    }\n    get hasSwiped() {\n        return this._hasSwiped;\n    }\n    get ignore() {\n        return this._ignore;\n    }\n    set singleClick(b) {\n        this._singleClick = b;\n    }\n    set doubleClick(b) {\n        this._doubleClick = b;\n    }\n    set hasSwiped(b) {\n        this._hasSwiped = b;\n    }\n    set ignore(b) {\n        this._ignore = b;\n    }\n}\n/**\n * Class used to manage all inputs for the scene.\n */\nexport class InputManager {\n    /**\n     * Creates a new InputManager\n     * @param scene - defines the hosting scene\n     */\n    constructor(scene) {\n        /** This is a defensive check to not allow control attachment prior to an already active one. If already attached, previous control is unattached before attaching the new one. */\n        this._alreadyAttached = false;\n        this._meshPickProceed = false;\n        this._currentPickResult = null;\n        this._previousPickResult = null;\n        this._totalPointersPressed = 0;\n        this._doubleClickOccured = false;\n        this._isSwiping = false;\n        this._swipeButtonPressed = -1;\n        this._skipPointerTap = false;\n        this._isMultiTouchGesture = false;\n        this._pointerX = 0;\n        this._pointerY = 0;\n        this._startingPointerPosition = new Vector2(0, 0);\n        this._previousStartingPointerPosition = new Vector2(0, 0);\n        this._startingPointerTime = 0;\n        this._previousStartingPointerTime = 0;\n        this._pointerCaptures = {};\n        this._meshUnderPointerId = {};\n        this._movePointerInfo = null;\n        this._cameraObserverCount = 0;\n        this._deviceSourceManager = null;\n        this._scene = scene || EngineStore.LastCreatedScene;\n        if (!this._scene) {\n            return;\n        }\n    }\n    /**\n     * Gets the mesh that is currently under the pointer\n     * @returns Mesh that the pointer is pointer is hovering over\n     */\n    get meshUnderPointer() {\n        if (this._movePointerInfo) {\n            // Because _pointerOverMesh is populated as part of _pickMove, we need to force a pick to update it.\n            // Calling _pickMove calls _setCursorAndPointerOverMesh which calls setPointerOverMesh\n            this._movePointerInfo._generatePickInfo();\n            // Once we have what we need, we can clear _movePointerInfo because we don't need it anymore\n            this._movePointerInfo = null;\n        }\n        return this._pointerOverMesh;\n    }\n    /**\n     * When using more than one pointer (for example in XR) you can get the mesh under the specific pointer\n     * @param pointerId - the pointer id to use\n     * @returns The mesh under this pointer id or null if not found\n     */\n    getMeshUnderPointerByPointerId(pointerId) {\n        return this._meshUnderPointerId[pointerId] || null;\n    }\n    /**\n     * Gets the pointer coordinates in 2D without any translation (ie. straight out of the pointer event)\n     * @returns Vector with X/Y values directly from pointer event\n     */\n    get unTranslatedPointer() {\n        return new Vector2(this._unTranslatedPointerX, this._unTranslatedPointerY);\n    }\n    /**\n     * Gets or sets the current on-screen X position of the pointer\n     * @returns Translated X with respect to screen\n     */\n    get pointerX() {\n        return this._pointerX;\n    }\n    set pointerX(value) {\n        this._pointerX = value;\n    }\n    /**\n     * Gets or sets the current on-screen Y position of the pointer\n     * @returns Translated Y with respect to screen\n     */\n    get pointerY() {\n        return this._pointerY;\n    }\n    set pointerY(value) {\n        this._pointerY = value;\n    }\n    _updatePointerPosition(evt) {\n        const canvasRect = this._scene.getEngine().getInputElementClientRect();\n        if (!canvasRect) {\n            return;\n        }\n        this._pointerX = evt.clientX - canvasRect.left;\n        this._pointerY = evt.clientY - canvasRect.top;\n        this._unTranslatedPointerX = this._pointerX;\n        this._unTranslatedPointerY = this._pointerY;\n    }\n    _processPointerMove(pickResult, evt) {\n        const scene = this._scene;\n        const engine = scene.getEngine();\n        const canvas = engine.getInputElement();\n        if (canvas) {\n            canvas.tabIndex = engine.canvasTabIndex;\n            // Restore pointer\n            if (!scene.doNotHandleCursors) {\n                canvas.style.cursor = scene.defaultCursor;\n            }\n        }\n        this._setCursorAndPointerOverMesh(pickResult, evt, scene);\n        for (const step of scene._pointerMoveStage) {\n            const isMeshPicked = (pickResult === null || pickResult === void 0 ? void 0 : pickResult.pickedMesh) ? true : false;\n            pickResult = step.action(this._unTranslatedPointerX, this._unTranslatedPointerY, pickResult, isMeshPicked, canvas);\n        }\n        const type = evt.inputIndex >= PointerInput.MouseWheelX && evt.inputIndex <= PointerInput.MouseWheelZ ? PointerEventTypes.POINTERWHEEL : PointerEventTypes.POINTERMOVE;\n        if (scene.onPointerMove) {\n            // Because of lazy picking, we need to force a pick to update the pickResult\n            pickResult = pickResult || this._pickMove(evt);\n            scene.onPointerMove(evt, pickResult, type);\n        }\n        let pointerInfo;\n        if (pickResult) {\n            pointerInfo = new PointerInfo(type, evt, pickResult);\n            this._setRayOnPointerInfo(pickResult, evt);\n        }\n        else {\n            pointerInfo = new PointerInfo(type, evt, null, this);\n            this._movePointerInfo = pointerInfo;\n        }\n        if (scene.onPointerObservable.hasObservers()) {\n            scene.onPointerObservable.notifyObservers(pointerInfo, type);\n        }\n    }\n    // Pointers handling\n    /** @internal */\n    _setRayOnPointerInfo(pickInfo, event) {\n        const scene = this._scene;\n        if (pickInfo && scene._pickingAvailable) {\n            if (!pickInfo.ray) {\n                pickInfo.ray = scene.createPickingRay(event.offsetX, event.offsetY, Matrix.Identity(), scene.activeCamera);\n            }\n        }\n    }\n    /** @internal */\n    _addCameraPointerObserver(observer, mask) {\n        this._cameraObserverCount++;\n        return this._scene.onPointerObservable.add(observer, mask);\n    }\n    /** @internal */\n    _removeCameraPointerObserver(observer) {\n        this._cameraObserverCount--;\n        return this._scene.onPointerObservable.remove(observer);\n    }\n    _checkForPicking() {\n        return !!(this._scene.onPointerObservable.observers.length > this._cameraObserverCount || this._scene.onPointerPick);\n    }\n    _checkPrePointerObservable(pickResult, evt, type) {\n        const scene = this._scene;\n        const pi = new PointerInfoPre(type, evt, this._unTranslatedPointerX, this._unTranslatedPointerY);\n        if (pickResult) {\n            pi.originalPickingInfo = pickResult;\n            pi.ray = pickResult.ray;\n            if (pickResult.originMesh) {\n                pi.nearInteractionPickingInfo = pickResult;\n            }\n        }\n        scene.onPrePointerObservable.notifyObservers(pi, type);\n        if (pi.skipOnPointerObservable) {\n            return true;\n        }\n        else {\n            return false;\n        }\n    }\n    /** @internal */\n    _pickMove(evt) {\n        const scene = this._scene;\n        const pickResult = scene.pick(this._unTranslatedPointerX, this._unTranslatedPointerY, scene.pointerMovePredicate, false, scene.cameraToUseForPointers, scene.pointerMoveTrianglePredicate);\n        this._setCursorAndPointerOverMesh(pickResult, evt, scene);\n        return pickResult;\n    }\n    _setCursorAndPointerOverMesh(pickResult, evt, scene) {\n        const engine = scene.getEngine();\n        const canvas = engine.getInputElement();\n        if (pickResult === null || pickResult === void 0 ? void 0 : pickResult.pickedMesh) {\n            this.setPointerOverMesh(pickResult.pickedMesh, evt.pointerId, pickResult, evt);\n            if (!scene.doNotHandleCursors && canvas && this._pointerOverMesh) {\n                const actionManager = this._pointerOverMesh._getActionManagerForTrigger();\n                if (actionManager && actionManager.hasPointerTriggers) {\n                    canvas.style.cursor = actionManager.hoverCursor || scene.hoverCursor;\n                }\n            }\n        }\n        else {\n            this.setPointerOverMesh(null, evt.pointerId, pickResult, evt);\n        }\n    }\n    /**\n     * Use this method to simulate a pointer move on a mesh\n     * The pickResult parameter can be obtained from a scene.pick or scene.pickWithRay\n     * @param pickResult - pickingInfo of the object wished to simulate pointer event on\n     * @param pointerEventInit - pointer event state to be used when simulating the pointer event (eg. pointer id for multitouch)\n     */\n    simulatePointerMove(pickResult, pointerEventInit) {\n        const evt = new PointerEvent(\"pointermove\", pointerEventInit);\n        evt.inputIndex = PointerInput.Move;\n        if (this._checkPrePointerObservable(pickResult, evt, PointerEventTypes.POINTERMOVE)) {\n            return;\n        }\n        this._processPointerMove(pickResult, evt);\n    }\n    /**\n     * Use this method to simulate a pointer down on a mesh\n     * The pickResult parameter can be obtained from a scene.pick or scene.pickWithRay\n     * @param pickResult - pickingInfo of the object wished to simulate pointer event on\n     * @param pointerEventInit - pointer event state to be used when simulating the pointer event (eg. pointer id for multitouch)\n     */\n    simulatePointerDown(pickResult, pointerEventInit) {\n        const evt = new PointerEvent(\"pointerdown\", pointerEventInit);\n        evt.inputIndex = evt.button + 2;\n        if (this._checkPrePointerObservable(pickResult, evt, PointerEventTypes.POINTERDOWN)) {\n            return;\n        }\n        this._processPointerDown(pickResult, evt);\n    }\n    _processPointerDown(pickResult, evt) {\n        const scene = this._scene;\n        if (pickResult === null || pickResult === void 0 ? void 0 : pickResult.pickedMesh) {\n            this._pickedDownMesh = pickResult.pickedMesh;\n            const actionManager = pickResult.pickedMesh._getActionManagerForTrigger();\n            if (actionManager) {\n                if (actionManager.hasPickTriggers) {\n                    actionManager.processTrigger(5, ActionEvent.CreateNew(pickResult.pickedMesh, evt));\n                    switch (evt.button) {\n                        case 0:\n                            actionManager.processTrigger(2, ActionEvent.CreateNew(pickResult.pickedMesh, evt));\n                            break;\n                        case 1:\n                            actionManager.processTrigger(4, ActionEvent.CreateNew(pickResult.pickedMesh, evt));\n                            break;\n                        case 2:\n                            actionManager.processTrigger(3, ActionEvent.CreateNew(pickResult.pickedMesh, evt));\n                            break;\n                    }\n                }\n                if (actionManager.hasSpecificTrigger(8)) {\n                    window.setTimeout(() => {\n                        const pickResult = scene.pick(this._unTranslatedPointerX, this._unTranslatedPointerY, (mesh) => ((mesh.isPickable &&\n                            mesh.isVisible &&\n                            mesh.isReady() &&\n                            mesh.actionManager &&\n                            mesh.actionManager.hasSpecificTrigger(8) &&\n                            mesh === this._pickedDownMesh)), false, scene.cameraToUseForPointers);\n                        if ((pickResult === null || pickResult === void 0 ? void 0 : pickResult.pickedMesh) && actionManager) {\n                            if (this._totalPointersPressed !== 0 && Date.now() - this._startingPointerTime > InputManager.LongPressDelay && !this._isPointerSwiping()) {\n                                this._startingPointerTime = 0;\n                                actionManager.processTrigger(8, ActionEvent.CreateNew(pickResult.pickedMesh, evt));\n                            }\n                        }\n                    }, InputManager.LongPressDelay);\n                }\n            }\n        }\n        else {\n            for (const step of scene._pointerDownStage) {\n                pickResult = step.action(this._unTranslatedPointerX, this._unTranslatedPointerY, pickResult, evt, false);\n            }\n        }\n        let pointerInfo;\n        const type = PointerEventTypes.POINTERDOWN;\n        if (pickResult) {\n            if (scene.onPointerDown) {\n                scene.onPointerDown(evt, pickResult, type);\n            }\n            pointerInfo = new PointerInfo(type, evt, pickResult);\n            this._setRayOnPointerInfo(pickResult, evt);\n        }\n        else {\n            pointerInfo = new PointerInfo(type, evt, null, this);\n        }\n        if (scene.onPointerObservable.hasObservers()) {\n            scene.onPointerObservable.notifyObservers(pointerInfo, type);\n        }\n    }\n    /**\n     * @internal\n     * @internals Boolean if delta for pointer exceeds drag movement threshold\n     */\n    _isPointerSwiping() {\n        return this._isSwiping;\n    }\n    /**\n     * Use this method to simulate a pointer up on a mesh\n     * The pickResult parameter can be obtained from a scene.pick or scene.pickWithRay\n     * @param pickResult - pickingInfo of the object wished to simulate pointer event on\n     * @param pointerEventInit - pointer event state to be used when simulating the pointer event (eg. pointer id for multitouch)\n     * @param doubleTap - indicates that the pointer up event should be considered as part of a double click (false by default)\n     */\n    simulatePointerUp(pickResult, pointerEventInit, doubleTap) {\n        const evt = new PointerEvent(\"pointerup\", pointerEventInit);\n        evt.inputIndex = PointerInput.Move;\n        const clickInfo = new _ClickInfo();\n        if (doubleTap) {\n            clickInfo.doubleClick = true;\n        }\n        else {\n            clickInfo.singleClick = true;\n        }\n        if (this._checkPrePointerObservable(pickResult, evt, PointerEventTypes.POINTERUP)) {\n            return;\n        }\n        this._processPointerUp(pickResult, evt, clickInfo);\n    }\n    _processPointerUp(pickResult, evt, clickInfo) {\n        const scene = this._scene;\n        if (pickResult === null || pickResult === void 0 ? void 0 : pickResult.pickedMesh) {\n            this._pickedUpMesh = pickResult.pickedMesh;\n            if (this._pickedDownMesh === this._pickedUpMesh) {\n                if (scene.onPointerPick) {\n                    scene.onPointerPick(evt, pickResult);\n                }\n                if (clickInfo.singleClick && !clickInfo.ignore && scene.onPointerObservable.observers.length > this._cameraObserverCount) {\n                    const type = PointerEventTypes.POINTERPICK;\n                    const pi = new PointerInfo(type, evt, pickResult);\n                    this._setRayOnPointerInfo(pickResult, evt);\n                    scene.onPointerObservable.notifyObservers(pi, type);\n                }\n            }\n            const actionManager = pickResult.pickedMesh._getActionManagerForTrigger();\n            if (actionManager && !clickInfo.ignore) {\n                actionManager.processTrigger(7, ActionEvent.CreateNew(pickResult.pickedMesh, evt, pickResult));\n                if (!clickInfo.hasSwiped && clickInfo.singleClick) {\n                    actionManager.processTrigger(1, ActionEvent.CreateNew(pickResult.pickedMesh, evt, pickResult));\n                }\n                const doubleClickActionManager = pickResult.pickedMesh._getActionManagerForTrigger(6);\n                if (clickInfo.doubleClick && doubleClickActionManager) {\n                    doubleClickActionManager.processTrigger(6, ActionEvent.CreateNew(pickResult.pickedMesh, evt, pickResult));\n                }\n            }\n        }\n        else {\n            if (!clickInfo.ignore) {\n                for (const step of scene._pointerUpStage) {\n                    pickResult = step.action(this._unTranslatedPointerX, this._unTranslatedPointerY, pickResult, evt, clickInfo.doubleClick);\n                }\n            }\n        }\n        if (this._pickedDownMesh && this._pickedDownMesh !== this._pickedUpMesh) {\n            const pickedDownActionManager = this._pickedDownMesh._getActionManagerForTrigger(16);\n            if (pickedDownActionManager) {\n                pickedDownActionManager.processTrigger(16, ActionEvent.CreateNew(this._pickedDownMesh, evt));\n            }\n        }\n        if (!clickInfo.ignore) {\n            const pi = new PointerInfo(PointerEventTypes.POINTERUP, evt, pickResult);\n            // Set ray on picking info.  Note that this info will also be reused for the tap notification.\n            this._setRayOnPointerInfo(pickResult, evt);\n            scene.onPointerObservable.notifyObservers(pi, PointerEventTypes.POINTERUP);\n            if (scene.onPointerUp) {\n                scene.onPointerUp(evt, pickResult, PointerEventTypes.POINTERUP);\n            }\n            if (!clickInfo.hasSwiped && !this._skipPointerTap && !this._isMultiTouchGesture) {\n                let type = 0;\n                if (clickInfo.singleClick) {\n                    type = PointerEventTypes.POINTERTAP;\n                }\n                else if (clickInfo.doubleClick) {\n                    type = PointerEventTypes.POINTERDOUBLETAP;\n                }\n                if (type) {\n                    const pi = new PointerInfo(type, evt, pickResult);\n                    if (scene.onPointerObservable.hasObservers() && scene.onPointerObservable.hasSpecificMask(type)) {\n                        scene.onPointerObservable.notifyObservers(pi, type);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Gets a boolean indicating if the current pointer event is captured (meaning that the scene has already handled the pointer down)\n     * @param pointerId - defines the pointer id to use in a multi-touch scenario (0 by default)\n     * @returns true if the pointer was captured\n     */\n    isPointerCaptured(pointerId = 0) {\n        return this._pointerCaptures[pointerId];\n    }\n    /**\n     * Attach events to the canvas (To handle actionManagers triggers and raise onPointerMove, onPointerDown and onPointerUp\n     * @param attachUp - defines if you want to attach events to pointerup\n     * @param attachDown - defines if you want to attach events to pointerdown\n     * @param attachMove - defines if you want to attach events to pointermove\n     * @param elementToAttachTo - defines the target DOM element to attach to (will use the canvas by default)\n     */\n    attachControl(attachUp = true, attachDown = true, attachMove = true, elementToAttachTo = null) {\n        const scene = this._scene;\n        const engine = scene.getEngine();\n        if (!elementToAttachTo) {\n            elementToAttachTo = engine.getInputElement();\n        }\n        if (this._alreadyAttached) {\n            this.detachControl();\n        }\n        if (elementToAttachTo) {\n            this._alreadyAttachedTo = elementToAttachTo;\n        }\n        this._deviceSourceManager = new DeviceSourceManager(engine);\n        // Because this is only called from _initClickEvent, which is called in _onPointerUp, we'll use the pointerUpPredicate for the pick call\n        this._initActionManager = (act) => {\n            if (!this._meshPickProceed) {\n                const pickResult = scene.skipPointerUpPicking || (scene._registeredActions === 0 && !this._checkForPicking() && !scene.onPointerUp)\n                    ? null\n                    : scene.pick(this._unTranslatedPointerX, this._unTranslatedPointerY, scene.pointerUpPredicate, false, scene.cameraToUseForPointers);\n                this._currentPickResult = pickResult;\n                if (pickResult) {\n                    act = pickResult.hit && pickResult.pickedMesh ? pickResult.pickedMesh._getActionManagerForTrigger() : null;\n                }\n                this._meshPickProceed = true;\n            }\n            return act;\n        };\n        this._delayedSimpleClick = (btn, clickInfo, cb) => {\n            // double click delay is over and that no double click has been raised since, or the 2 consecutive keys pressed are different\n            if ((Date.now() - this._previousStartingPointerTime > InputManager.DoubleClickDelay && !this._doubleClickOccured) || btn !== this._previousButtonPressed) {\n                this._doubleClickOccured = false;\n                clickInfo.singleClick = true;\n                clickInfo.ignore = false;\n                cb(clickInfo, this._currentPickResult);\n            }\n        };\n        this._initClickEvent = (obs1, obs2, evt, cb) => {\n            const clickInfo = new _ClickInfo();\n            this._currentPickResult = null;\n            let act = null;\n            let checkPicking = obs1.hasSpecificMask(PointerEventTypes.POINTERPICK) ||\n                obs2.hasSpecificMask(PointerEventTypes.POINTERPICK) ||\n                obs1.hasSpecificMask(PointerEventTypes.POINTERTAP) ||\n                obs2.hasSpecificMask(PointerEventTypes.POINTERTAP) ||\n                obs1.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP) ||\n                obs2.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);\n            if (!checkPicking && AbstractActionManager) {\n                act = this._initActionManager(act, clickInfo);\n                if (act) {\n                    checkPicking = act.hasPickTriggers;\n                }\n            }\n            let needToIgnoreNext = false;\n            if (checkPicking) {\n                const btn = evt.button;\n                clickInfo.hasSwiped = this._isPointerSwiping();\n                if (!clickInfo.hasSwiped) {\n                    let checkSingleClickImmediately = !InputManager.ExclusiveDoubleClickMode;\n                    if (!checkSingleClickImmediately) {\n                        checkSingleClickImmediately = !obs1.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP) && !obs2.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);\n                        if (checkSingleClickImmediately && !AbstractActionManager.HasSpecificTrigger(6)) {\n                            act = this._initActionManager(act, clickInfo);\n                            if (act) {\n                                checkSingleClickImmediately = !act.hasSpecificTrigger(6);\n                            }\n                        }\n                    }\n                    if (checkSingleClickImmediately) {\n                        // single click detected if double click delay is over or two different successive keys pressed without exclusive double click or no double click required\n                        if (Date.now() - this._previousStartingPointerTime > InputManager.DoubleClickDelay || btn !== this._previousButtonPressed) {\n                            clickInfo.singleClick = true;\n                            cb(clickInfo, this._currentPickResult);\n                            needToIgnoreNext = true;\n                        }\n                    }\n                    // at least one double click is required to be check and exclusive double click is enabled\n                    else {\n                        // wait that no double click has been raised during the double click delay\n                        this._previousDelayedSimpleClickTimeout = this._delayedSimpleClickTimeout;\n                        this._delayedSimpleClickTimeout = window.setTimeout(this._delayedSimpleClick.bind(this, btn, clickInfo, cb), InputManager.DoubleClickDelay);\n                    }\n                    let checkDoubleClick = obs1.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP) || obs2.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);\n                    if (!checkDoubleClick && AbstractActionManager.HasSpecificTrigger(6)) {\n                        act = this._initActionManager(act, clickInfo);\n                        if (act) {\n                            checkDoubleClick = act.hasSpecificTrigger(6);\n                        }\n                    }\n                    if (checkDoubleClick) {\n                        // two successive keys pressed are equal, double click delay is not over and double click has not just occurred\n                        if (btn === this._previousButtonPressed && Date.now() - this._previousStartingPointerTime < InputManager.DoubleClickDelay && !this._doubleClickOccured) {\n                            // pointer has not moved for 2 clicks, it's a double click\n                            if (!clickInfo.hasSwiped && !this._isPointerSwiping()) {\n                                this._previousStartingPointerTime = 0;\n                                this._doubleClickOccured = true;\n                                clickInfo.doubleClick = true;\n                                clickInfo.ignore = false;\n                                if (InputManager.ExclusiveDoubleClickMode && this._previousDelayedSimpleClickTimeout) {\n                                    clearTimeout(this._previousDelayedSimpleClickTimeout);\n                                }\n                                this._previousDelayedSimpleClickTimeout = this._delayedSimpleClickTimeout;\n                                cb(clickInfo, this._currentPickResult);\n                            }\n                            // if the two successive clicks are too far, it's just two simple clicks\n                            else {\n                                this._doubleClickOccured = false;\n                                this._previousStartingPointerTime = this._startingPointerTime;\n                                this._previousStartingPointerPosition.x = this._startingPointerPosition.x;\n                                this._previousStartingPointerPosition.y = this._startingPointerPosition.y;\n                                this._previousButtonPressed = btn;\n                                if (InputManager.ExclusiveDoubleClickMode) {\n                                    if (this._previousDelayedSimpleClickTimeout) {\n                                        clearTimeout(this._previousDelayedSimpleClickTimeout);\n                                    }\n                                    this._previousDelayedSimpleClickTimeout = this._delayedSimpleClickTimeout;\n                                    cb(clickInfo, this._previousPickResult);\n                                }\n                                else {\n                                    cb(clickInfo, this._currentPickResult);\n                                }\n                            }\n                            needToIgnoreNext = true;\n                        }\n                        // just the first click of the double has been raised\n                        else {\n                            this._doubleClickOccured = false;\n                            this._previousStartingPointerTime = this._startingPointerTime;\n                            this._previousStartingPointerPosition.x = this._startingPointerPosition.x;\n                            this._previousStartingPointerPosition.y = this._startingPointerPosition.y;\n                            this._previousButtonPressed = btn;\n                        }\n                    }\n                }\n            }\n            if (!needToIgnoreNext) {\n                cb(clickInfo, this._currentPickResult);\n            }\n        };\n        this._onPointerMove = (evt) => {\n            // preserve compatibility with Safari when pointerId is not present\n            if (evt.pointerId === undefined) {\n                evt.pointerId = 0;\n            }\n            this._updatePointerPosition(evt);\n            // Check if pointer leaves DragMovementThreshold range to determine if swipe is occurring\n            if (!this._isSwiping && this._swipeButtonPressed !== -1) {\n                this._isSwiping =\n                    Math.abs(this._startingPointerPosition.x - this._pointerX) > InputManager.DragMovementThreshold ||\n                        Math.abs(this._startingPointerPosition.y - this._pointerY) > InputManager.DragMovementThreshold;\n            }\n            // PreObservable support\n            if (this._checkPrePointerObservable(null, evt, evt.inputIndex >= PointerInput.MouseWheelX && evt.inputIndex <= PointerInput.MouseWheelZ ? PointerEventTypes.POINTERWHEEL : PointerEventTypes.POINTERMOVE)) {\n                return;\n            }\n            if (!scene.cameraToUseForPointers && !scene.activeCamera) {\n                return;\n            }\n            if (scene.skipPointerMovePicking) {\n                this._processPointerMove(new PickingInfo(), evt);\n                return;\n            }\n            if (!scene.pointerMovePredicate) {\n                scene.pointerMovePredicate = (mesh) => mesh.isPickable &&\n                    mesh.isVisible &&\n                    mesh.isReady() &&\n                    mesh.isEnabled() &&\n                    (mesh.enablePointerMoveEvents || scene.constantlyUpdateMeshUnderPointer || mesh._getActionManagerForTrigger() !== null) &&\n                    (!scene.cameraToUseForPointers || (scene.cameraToUseForPointers.layerMask & mesh.layerMask) !== 0);\n            }\n            const pickResult = scene._registeredActions > 0 ? this._pickMove(evt) : null;\n            this._processPointerMove(pickResult, evt);\n        };\n        this._onPointerDown = (evt) => {\n            this._totalPointersPressed++;\n            this._pickedDownMesh = null;\n            this._meshPickProceed = false;\n            // preserve compatibility with Safari when pointerId is not present\n            if (evt.pointerId === undefined) {\n                evt.pointerId = 0;\n            }\n            this._updatePointerPosition(evt);\n            if (this._swipeButtonPressed === -1) {\n                this._swipeButtonPressed = evt.button;\n            }\n            if (scene.preventDefaultOnPointerDown && elementToAttachTo) {\n                evt.preventDefault();\n                elementToAttachTo.focus();\n            }\n            this._startingPointerPosition.x = this._pointerX;\n            this._startingPointerPosition.y = this._pointerY;\n            this._startingPointerTime = Date.now();\n            // PreObservable support\n            if (this._checkPrePointerObservable(null, evt, PointerEventTypes.POINTERDOWN)) {\n                return;\n            }\n            if (!scene.cameraToUseForPointers && !scene.activeCamera) {\n                return;\n            }\n            this._pointerCaptures[evt.pointerId] = true;\n            if (!scene.pointerDownPredicate) {\n                scene.pointerDownPredicate = (mesh) => {\n                    return (mesh.isPickable &&\n                        mesh.isVisible &&\n                        mesh.isReady() &&\n                        mesh.isEnabled() &&\n                        (!scene.cameraToUseForPointers || (scene.cameraToUseForPointers.layerMask & mesh.layerMask) !== 0));\n                };\n            }\n            // Meshes\n            this._pickedDownMesh = null;\n            let pickResult;\n            if (scene.skipPointerDownPicking || (scene._registeredActions === 0 && !this._checkForPicking() && !scene.onPointerDown)) {\n                pickResult = new PickingInfo();\n            }\n            else {\n                pickResult = scene.pick(this._unTranslatedPointerX, this._unTranslatedPointerY, scene.pointerDownPredicate, false, scene.cameraToUseForPointers);\n            }\n            this._processPointerDown(pickResult, evt);\n        };\n        this._onPointerUp = (evt) => {\n            if (this._totalPointersPressed === 0) {\n                // We are attaching the pointer up to windows because of a bug in FF\n                return; // So we need to test it the pointer down was pressed before.\n            }\n            this._totalPointersPressed--;\n            this._pickedUpMesh = null;\n            this._meshPickProceed = false;\n            // preserve compatibility with Safari when pointerId is not present\n            if (evt.pointerId === undefined) {\n                evt.pointerId = 0;\n            }\n            this._updatePointerPosition(evt);\n            if (scene.preventDefaultOnPointerUp && elementToAttachTo) {\n                evt.preventDefault();\n                elementToAttachTo.focus();\n            }\n            this._initClickEvent(scene.onPrePointerObservable, scene.onPointerObservable, evt, (clickInfo, pickResult) => {\n                // PreObservable support\n                if (scene.onPrePointerObservable.hasObservers()) {\n                    this._skipPointerTap = false;\n                    if (!clickInfo.ignore) {\n                        if (this._checkPrePointerObservable(null, evt, PointerEventTypes.POINTERUP)) {\n                            // If we're skipping the next observable, we need to reset the swipe state before returning\n                            if (this._swipeButtonPressed === evt.button) {\n                                this._isSwiping = false;\n                                this._swipeButtonPressed = -1;\n                            }\n                            return;\n                        }\n                        if (!clickInfo.hasSwiped) {\n                            if (clickInfo.singleClick && scene.onPrePointerObservable.hasSpecificMask(PointerEventTypes.POINTERTAP)) {\n                                if (this._checkPrePointerObservable(null, evt, PointerEventTypes.POINTERTAP)) {\n                                    this._skipPointerTap = true;\n                                }\n                            }\n                            if (clickInfo.doubleClick && scene.onPrePointerObservable.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)) {\n                                if (this._checkPrePointerObservable(null, evt, PointerEventTypes.POINTERDOUBLETAP)) {\n                                    this._skipPointerTap = true;\n                                }\n                            }\n                        }\n                    }\n                }\n                // There should be a pointer captured at this point so if there isn't we should reset and return\n                if (!this._pointerCaptures[evt.pointerId]) {\n                    if (this._swipeButtonPressed === evt.button) {\n                        this._isSwiping = false;\n                        this._swipeButtonPressed = -1;\n                    }\n                    return;\n                }\n                // Only release capture if all buttons are released\n                if (evt.buttons === 0) {\n                    this._pointerCaptures[evt.pointerId] = false;\n                }\n                if (!scene.cameraToUseForPointers && !scene.activeCamera) {\n                    return;\n                }\n                if (!scene.pointerUpPredicate) {\n                    scene.pointerUpPredicate = (mesh) => {\n                        return (mesh.isPickable &&\n                            mesh.isVisible &&\n                            mesh.isReady() &&\n                            mesh.isEnabled() &&\n                            (!scene.cameraToUseForPointers || (scene.cameraToUseForPointers.layerMask & mesh.layerMask) !== 0));\n                    };\n                }\n                // Meshes\n                if (!this._meshPickProceed && ((AbstractActionManager && AbstractActionManager.HasTriggers) || this._checkForPicking() || scene.onPointerUp)) {\n                    this._initActionManager(null, clickInfo);\n                }\n                if (!pickResult) {\n                    pickResult = this._currentPickResult;\n                }\n                this._processPointerUp(pickResult, evt, clickInfo);\n                this._previousPickResult = this._currentPickResult;\n                if (this._swipeButtonPressed === evt.button) {\n                    this._isSwiping = false;\n                    this._swipeButtonPressed = -1;\n                }\n            });\n        };\n        this._onKeyDown = (evt) => {\n            const type = KeyboardEventTypes.KEYDOWN;\n            if (scene.onPreKeyboardObservable.hasObservers()) {\n                const pi = new KeyboardInfoPre(type, evt);\n                scene.onPreKeyboardObservable.notifyObservers(pi, type);\n                if (pi.skipOnKeyboardObservable) {\n                    return;\n                }\n            }\n            if (scene.onKeyboardObservable.hasObservers()) {\n                const pi = new KeyboardInfo(type, evt);\n                scene.onKeyboardObservable.notifyObservers(pi, type);\n            }\n            if (scene.actionManager) {\n                scene.actionManager.processTrigger(14, ActionEvent.CreateNewFromScene(scene, evt));\n            }\n        };\n        this._onKeyUp = (evt) => {\n            const type = KeyboardEventTypes.KEYUP;\n            if (scene.onPreKeyboardObservable.hasObservers()) {\n                const pi = new KeyboardInfoPre(type, evt);\n                scene.onPreKeyboardObservable.notifyObservers(pi, type);\n                if (pi.skipOnKeyboardObservable) {\n                    return;\n                }\n            }\n            if (scene.onKeyboardObservable.hasObservers()) {\n                const pi = new KeyboardInfo(type, evt);\n                scene.onKeyboardObservable.notifyObservers(pi, type);\n            }\n            if (scene.actionManager) {\n                scene.actionManager.processTrigger(15, ActionEvent.CreateNewFromScene(scene, evt));\n            }\n        };\n        // If a device connects that we can handle, wire up the observable\n        this._deviceSourceManager.onDeviceConnectedObservable.add((deviceSource) => {\n            if (deviceSource.deviceType === DeviceType.Mouse) {\n                deviceSource.onInputChangedObservable.add((eventData) => {\n                    if (eventData.inputIndex === PointerInput.LeftClick ||\n                        eventData.inputIndex === PointerInput.MiddleClick ||\n                        eventData.inputIndex === PointerInput.RightClick ||\n                        eventData.inputIndex === PointerInput.BrowserBack ||\n                        eventData.inputIndex === PointerInput.BrowserForward) {\n                        if (attachDown && deviceSource.getInput(eventData.inputIndex) === 1) {\n                            this._onPointerDown(eventData);\n                        }\n                        else if (attachUp && deviceSource.getInput(eventData.inputIndex) === 0) {\n                            this._onPointerUp(eventData);\n                        }\n                    }\n                    else if (attachMove) {\n                        if (eventData.inputIndex === PointerInput.Move) {\n                            this._onPointerMove(eventData);\n                        }\n                        else if (eventData.inputIndex === PointerInput.MouseWheelX ||\n                            eventData.inputIndex === PointerInput.MouseWheelY ||\n                            eventData.inputIndex === PointerInput.MouseWheelZ) {\n                            this._onPointerMove(eventData);\n                        }\n                    }\n                });\n            }\n            else if (deviceSource.deviceType === DeviceType.Touch) {\n                deviceSource.onInputChangedObservable.add((eventData) => {\n                    if (eventData.inputIndex === PointerInput.LeftClick) {\n                        if (attachDown && deviceSource.getInput(eventData.inputIndex) === 1) {\n                            this._onPointerDown(eventData);\n                            if (this._totalPointersPressed > 1) {\n                                this._isMultiTouchGesture = true;\n                            }\n                        }\n                        else if (attachUp && deviceSource.getInput(eventData.inputIndex) === 0) {\n                            this._onPointerUp(eventData);\n                            if (this._totalPointersPressed === 0) {\n                                this._isMultiTouchGesture = false;\n                            }\n                        }\n                    }\n                    if (attachMove && eventData.inputIndex === PointerInput.Move) {\n                        this._onPointerMove(eventData);\n                    }\n                });\n            }\n            else if (deviceSource.deviceType === DeviceType.Keyboard) {\n                deviceSource.onInputChangedObservable.add((eventData) => {\n                    if (eventData.type === \"keydown\") {\n                        this._onKeyDown(eventData);\n                    }\n                    else if (eventData.type === \"keyup\") {\n                        this._onKeyUp(eventData);\n                    }\n                });\n            }\n        });\n        this._alreadyAttached = true;\n    }\n    /**\n     * Detaches all event handlers\n     */\n    detachControl() {\n        if (this._alreadyAttached) {\n            this._deviceSourceManager.dispose();\n            this._deviceSourceManager = null;\n            // Cursor\n            if (this._alreadyAttachedTo && !this._scene.doNotHandleCursors) {\n                this._alreadyAttachedTo.style.cursor = this._scene.defaultCursor;\n            }\n            this._alreadyAttached = false;\n            this._alreadyAttachedTo = null;\n        }\n    }\n    /**\n     * Force the value of meshUnderPointer\n     * @param mesh - defines the mesh to use\n     * @param pointerId - optional pointer id when using more than one pointer. Defaults to 0\n     * @param pickResult - optional pickingInfo data used to find mesh\n     * @param evt - optional pointer event\n     */\n    setPointerOverMesh(mesh, pointerId = 0, pickResult, evt) {\n        if (this._meshUnderPointerId[pointerId] === mesh && (!mesh || !mesh._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting)) {\n            return;\n        }\n        const underPointerMesh = this._meshUnderPointerId[pointerId];\n        let actionManager;\n        if (underPointerMesh) {\n            actionManager = underPointerMesh._getActionManagerForTrigger(10);\n            if (actionManager) {\n                actionManager.processTrigger(10, ActionEvent.CreateNew(underPointerMesh, evt, { pointerId }));\n            }\n        }\n        if (mesh) {\n            this._meshUnderPointerId[pointerId] = mesh;\n            this._pointerOverMesh = mesh;\n            actionManager = mesh._getActionManagerForTrigger(9);\n            if (actionManager) {\n                actionManager.processTrigger(9, ActionEvent.CreateNew(mesh, evt, { pointerId, pickResult }));\n            }\n        }\n        else {\n            delete this._meshUnderPointerId[pointerId];\n            this._pointerOverMesh = null;\n        }\n    }\n    /**\n     * Gets the mesh under the pointer\n     * @returns a Mesh or null if no mesh is under the pointer\n     */\n    getPointerOverMesh() {\n        return this.meshUnderPointer;\n    }\n    /**\n     * @param mesh - Mesh to invalidate\n     * @internal\n     */\n    _invalidateMesh(mesh) {\n        if (this._pointerOverMesh === mesh) {\n            this._pointerOverMesh = null;\n        }\n        if (this._pickedDownMesh === mesh) {\n            this._pickedDownMesh = null;\n        }\n        if (this._pickedUpMesh === mesh) {\n            this._pickedUpMesh = null;\n        }\n        for (const pointerId in this._meshUnderPointerId) {\n            if (this._meshUnderPointerId[pointerId] === mesh) {\n                delete this._meshUnderPointerId[pointerId];\n            }\n        }\n    }\n}\n/** The distance in pixel that you have to move to prevent some events */\nInputManager.DragMovementThreshold = 10; // in pixels\n/** Time in milliseconds to wait to raise long press events if button is still pressed */\nInputManager.LongPressDelay = 500; // in milliseconds\n/** Time in milliseconds with two consecutive clicks will be considered as a double click */\nInputManager.DoubleClickDelay = 300; // in milliseconds\n/** If you need to check double click without raising a single click at first click, enable this flag */\nInputManager.ExclusiveDoubleClickMode = false;\n//# sourceMappingURL=scene.inputManager.js.map","/**\n * @internal\n **/\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class _TimeToken {\n    constructor() {\n        this._timeElapsedQueryEnded = false;\n    }\n}\n//# sourceMappingURL=timeToken.js.map","import { __decorate } from \"../tslib.es6.js\";\nimport { serialize, serializeAsColor4, serializeAsCameraReference } from \"../Misc/decorators.js\";\nimport { Tools } from \"../Misc/tools.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { Color4 } from \"../Maths/math.color.js\";\nimport { Engine } from \"../Engines/engine.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture.js\";\nimport { Material } from \"../Materials/material.js\";\nimport { MaterialHelper } from \"../Materials/materialHelper.js\";\n\nimport \"../Shaders/glowMapGeneration.fragment.js\";\nimport \"../Shaders/glowMapGeneration.vertex.js\";\nimport { _WarnImport } from \"../Misc/devTools.js\";\nimport { EffectFallbacks } from \"../Materials/effectFallbacks.js\";\nimport { DrawWrapper } from \"../Materials/drawWrapper.js\";\nimport { addClipPlaneUniforms, bindClipPlane, prepareDefinesForClipPlanes } from \"../Materials/clipPlaneMaterialHelper.js\";\n/**\n * The effect layer Helps adding post process effect blended with the main pass.\n *\n * This can be for instance use to generate glow or highlight effects on the scene.\n *\n * The effect layer class can not be used directly and is intented to inherited from to be\n * customized per effects.\n */\nexport class EffectLayer {\n    /**\n     * Gets the camera attached to the layer.\n     */\n    get camera() {\n        return this._effectLayerOptions.camera;\n    }\n    /**\n     * Gets the rendering group id the layer should render in.\n     */\n    get renderingGroupId() {\n        return this._effectLayerOptions.renderingGroupId;\n    }\n    set renderingGroupId(renderingGroupId) {\n        this._effectLayerOptions.renderingGroupId = renderingGroupId;\n    }\n    /**\n     * Gets the main texture where the effect is rendered\n     */\n    get mainTexture() {\n        return this._mainTexture;\n    }\n    /**\n     * Sets a specific material to be used to render a mesh/a list of meshes in the layer\n     * @param mesh mesh or array of meshes\n     * @param material material to use by the layer when rendering the mesh(es). If undefined is passed, the specific material created by the layer will be used.\n     */\n    setMaterialForRendering(mesh, material) {\n        this._mainTexture.setMaterialForRendering(mesh, material);\n        if (Array.isArray(mesh)) {\n            for (let i = 0; i < mesh.length; ++i) {\n                const currentMesh = mesh[i];\n                if (!material) {\n                    delete this._materialForRendering[currentMesh.uniqueId];\n                }\n                else {\n                    this._materialForRendering[currentMesh.uniqueId] = [currentMesh, material];\n                }\n            }\n        }\n        else {\n            if (!material) {\n                delete this._materialForRendering[mesh.uniqueId];\n            }\n            else {\n                this._materialForRendering[mesh.uniqueId] = [mesh, material];\n            }\n        }\n    }\n    /**\n     * Instantiates a new effect Layer and references it in the scene.\n     * @param name The name of the layer\n     * @param scene The scene to use the layer in\n     */\n    constructor(\n    /** The Friendly of the effect in the scene */\n    name, scene) {\n        this._vertexBuffers = {};\n        this._maxSize = 0;\n        this._mainTextureDesiredSize = { width: 0, height: 0 };\n        this._shouldRender = true;\n        this._postProcesses = [];\n        this._textures = [];\n        this._emissiveTextureAndColor = { texture: null, color: new Color4() };\n        /**\n         * The clear color of the texture used to generate the glow map.\n         */\n        this.neutralColor = new Color4();\n        /**\n         * Specifies whether the highlight layer is enabled or not.\n         */\n        this.isEnabled = true;\n        /**\n         * Specifies if the bounding boxes should be rendered normally or if they should undergo the effect of the layer\n         */\n        this.disableBoundingBoxesFromEffectLayer = false;\n        /**\n         * An event triggered when the effect layer has been disposed.\n         */\n        this.onDisposeObservable = new Observable();\n        /**\n         * An event triggered when the effect layer is about rendering the main texture with the glowy parts.\n         */\n        this.onBeforeRenderMainTextureObservable = new Observable();\n        /**\n         * An event triggered when the generated texture is being merged in the scene.\n         */\n        this.onBeforeComposeObservable = new Observable();\n        /**\n         * An event triggered when the mesh is rendered into the effect render target.\n         */\n        this.onBeforeRenderMeshToEffect = new Observable();\n        /**\n         * An event triggered after the mesh has been rendered into the effect render target.\n         */\n        this.onAfterRenderMeshToEffect = new Observable();\n        /**\n         * An event triggered when the generated texture has been merged in the scene.\n         */\n        this.onAfterComposeObservable = new Observable();\n        /**\n         * An event triggered when the effect layer changes its size.\n         */\n        this.onSizeChangedObservable = new Observable();\n        this._materialForRendering = {};\n        this.name = name;\n        this._scene = scene || EngineStore.LastCreatedScene;\n        EffectLayer._SceneComponentInitialization(this._scene);\n        this._engine = this._scene.getEngine();\n        this._maxSize = this._engine.getCaps().maxTextureSize;\n        this._scene.effectLayers.push(this);\n        this._mergeDrawWrapper = [];\n        // Generate Buffers\n        this._generateIndexBuffer();\n        this._generateVertexBuffer();\n    }\n    /**\n     * Number of times _internalRender will be called. Some effect layers need to render the mesh several times, so they should override this method with the number of times the mesh should be rendered\n     * @returns Number of times a mesh must be rendered in the layer\n     */\n    _numInternalDraws() {\n        return 1;\n    }\n    /**\n     * Initializes the effect layer with the required options.\n     * @param options Sets of none mandatory options to use with the layer (see IEffectLayerOptions for more information)\n     */\n    _init(options) {\n        // Adapt options\n        this._effectLayerOptions = {\n            mainTextureRatio: 0.5,\n            alphaBlendingMode: 2,\n            camera: null,\n            renderingGroupId: -1,\n            mainTextureType: 0,\n            ...options,\n        };\n        this._setMainTextureSize();\n        this._createMainTexture();\n        this._createTextureAndPostProcesses();\n    }\n    /**\n     * Generates the index buffer of the full screen quad blending to the main canvas.\n     */\n    _generateIndexBuffer() {\n        // Indices\n        const indices = [];\n        indices.push(0);\n        indices.push(1);\n        indices.push(2);\n        indices.push(0);\n        indices.push(2);\n        indices.push(3);\n        this._indexBuffer = this._engine.createIndexBuffer(indices);\n    }\n    /**\n     * Generates the vertex buffer of the full screen quad blending to the main canvas.\n     */\n    _generateVertexBuffer() {\n        // VBO\n        const vertices = [];\n        vertices.push(1, 1);\n        vertices.push(-1, 1);\n        vertices.push(-1, -1);\n        vertices.push(1, -1);\n        const vertexBuffer = new VertexBuffer(this._engine, vertices, VertexBuffer.PositionKind, false, false, 2);\n        this._vertexBuffers[VertexBuffer.PositionKind] = vertexBuffer;\n    }\n    /**\n     * Sets the main texture desired size which is the closest power of two\n     * of the engine canvas size.\n     */\n    _setMainTextureSize() {\n        if (this._effectLayerOptions.mainTextureFixedSize) {\n            this._mainTextureDesiredSize.width = this._effectLayerOptions.mainTextureFixedSize;\n            this._mainTextureDesiredSize.height = this._effectLayerOptions.mainTextureFixedSize;\n        }\n        else {\n            this._mainTextureDesiredSize.width = this._engine.getRenderWidth() * this._effectLayerOptions.mainTextureRatio;\n            this._mainTextureDesiredSize.height = this._engine.getRenderHeight() * this._effectLayerOptions.mainTextureRatio;\n            this._mainTextureDesiredSize.width = this._engine.needPOTTextures\n                ? Engine.GetExponentOfTwo(this._mainTextureDesiredSize.width, this._maxSize)\n                : this._mainTextureDesiredSize.width;\n            this._mainTextureDesiredSize.height = this._engine.needPOTTextures\n                ? Engine.GetExponentOfTwo(this._mainTextureDesiredSize.height, this._maxSize)\n                : this._mainTextureDesiredSize.height;\n        }\n        this._mainTextureDesiredSize.width = Math.floor(this._mainTextureDesiredSize.width);\n        this._mainTextureDesiredSize.height = Math.floor(this._mainTextureDesiredSize.height);\n    }\n    /**\n     * Creates the main texture for the effect layer.\n     */\n    _createMainTexture() {\n        this._mainTexture = new RenderTargetTexture(\"EffectLayerMainRTT\", {\n            width: this._mainTextureDesiredSize.width,\n            height: this._mainTextureDesiredSize.height,\n        }, this._scene, false, true, this._effectLayerOptions.mainTextureType);\n        this._mainTexture.activeCamera = this._effectLayerOptions.camera;\n        this._mainTexture.wrapU = Texture.CLAMP_ADDRESSMODE;\n        this._mainTexture.wrapV = Texture.CLAMP_ADDRESSMODE;\n        this._mainTexture.anisotropicFilteringLevel = 1;\n        this._mainTexture.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);\n        this._mainTexture.renderParticles = false;\n        this._mainTexture.renderList = null;\n        this._mainTexture.ignoreCameraViewport = true;\n        for (const id in this._materialForRendering) {\n            const [mesh, material] = this._materialForRendering[id];\n            this._mainTexture.setMaterialForRendering(mesh, material);\n        }\n        this._mainTexture.customIsReadyFunction = (mesh, refreshRate, preWarm) => {\n            if ((preWarm || refreshRate === 0) && mesh.subMeshes) {\n                for (let i = 0; i < mesh.subMeshes.length; ++i) {\n                    const subMesh = mesh.subMeshes[i];\n                    const material = subMesh.getMaterial();\n                    const renderingMesh = subMesh.getRenderingMesh();\n                    if (!material) {\n                        continue;\n                    }\n                    const batch = renderingMesh._getInstancesRenderList(subMesh._id, !!subMesh.getReplacementMesh());\n                    const hardwareInstancedRendering = batch.hardwareInstancedRendering[subMesh._id] || renderingMesh.hasThinInstances;\n                    this._setEmissiveTextureAndColor(renderingMesh, subMesh, material);\n                    if (!this._isReady(subMesh, hardwareInstancedRendering, this._emissiveTextureAndColor.texture)) {\n                        return false;\n                    }\n                }\n            }\n            return true;\n        };\n        // Custom render function\n        this._mainTexture.customRenderFunction = (opaqueSubMeshes, alphaTestSubMeshes, transparentSubMeshes, depthOnlySubMeshes) => {\n            this.onBeforeRenderMainTextureObservable.notifyObservers(this);\n            let index;\n            const engine = this._scene.getEngine();\n            if (depthOnlySubMeshes.length) {\n                engine.setColorWrite(false);\n                for (index = 0; index < depthOnlySubMeshes.length; index++) {\n                    this._renderSubMesh(depthOnlySubMeshes.data[index]);\n                }\n                engine.setColorWrite(true);\n            }\n            for (index = 0; index < opaqueSubMeshes.length; index++) {\n                this._renderSubMesh(opaqueSubMeshes.data[index]);\n            }\n            for (index = 0; index < alphaTestSubMeshes.length; index++) {\n                this._renderSubMesh(alphaTestSubMeshes.data[index]);\n            }\n            const previousAlphaMode = engine.getAlphaMode();\n            for (index = 0; index < transparentSubMeshes.length; index++) {\n                this._renderSubMesh(transparentSubMeshes.data[index], true);\n            }\n            engine.setAlphaMode(previousAlphaMode);\n        };\n        this._mainTexture.onClearObservable.add((engine) => {\n            engine.clear(this.neutralColor, true, true, true);\n        });\n        // Prevent package size in es6 (getBoundingBoxRenderer might not be present)\n        if (this._scene.getBoundingBoxRenderer) {\n            const boundingBoxRendererEnabled = this._scene.getBoundingBoxRenderer().enabled;\n            this._mainTexture.onBeforeBindObservable.add(() => {\n                this._scene.getBoundingBoxRenderer().enabled = !this.disableBoundingBoxesFromEffectLayer && boundingBoxRendererEnabled;\n            });\n            this._mainTexture.onAfterUnbindObservable.add(() => {\n                this._scene.getBoundingBoxRenderer().enabled = boundingBoxRendererEnabled;\n            });\n        }\n    }\n    /**\n     * Adds specific effects defines.\n     * @param defines The defines to add specifics to.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _addCustomEffectDefines(defines) {\n        // Nothing to add by default.\n    }\n    /**\n     * Checks for the readiness of the element composing the layer.\n     * @param subMesh the mesh to check for\n     * @param useInstances specify whether or not to use instances to render the mesh\n     * @param emissiveTexture the associated emissive texture used to generate the glow\n     * @returns true if ready otherwise, false\n     */\n    _isReady(subMesh, useInstances, emissiveTexture) {\n        var _a;\n        const engine = this._scene.getEngine();\n        const mesh = subMesh.getMesh();\n        const renderingMaterial = (_a = mesh._internalAbstractMeshDataInfo._materialForRenderPass) === null || _a === void 0 ? void 0 : _a[engine.currentRenderPassId];\n        if (renderingMaterial) {\n            return renderingMaterial.isReadyForSubMesh(mesh, subMesh, useInstances);\n        }\n        const material = subMesh.getMaterial();\n        if (!material) {\n            return false;\n        }\n        if (this._useMeshMaterial(subMesh.getRenderingMesh())) {\n            return material.isReadyForSubMesh(subMesh.getMesh(), subMesh, useInstances);\n        }\n        const defines = [];\n        const attribs = [VertexBuffer.PositionKind];\n        let uv1 = false;\n        let uv2 = false;\n        // Diffuse\n        if (material) {\n            const needAlphaTest = material.needAlphaTesting();\n            const diffuseTexture = material.getAlphaTestTexture();\n            const needAlphaBlendFromDiffuse = diffuseTexture && diffuseTexture.hasAlpha && (material.useAlphaFromDiffuseTexture || material._useAlphaFromAlbedoTexture);\n            if (diffuseTexture && (needAlphaTest || needAlphaBlendFromDiffuse)) {\n                defines.push(\"#define DIFFUSE\");\n                if (mesh.isVerticesDataPresent(VertexBuffer.UV2Kind) && diffuseTexture.coordinatesIndex === 1) {\n                    defines.push(\"#define DIFFUSEUV2\");\n                    uv2 = true;\n                }\n                else if (mesh.isVerticesDataPresent(VertexBuffer.UVKind)) {\n                    defines.push(\"#define DIFFUSEUV1\");\n                    uv1 = true;\n                }\n                if (needAlphaTest) {\n                    defines.push(\"#define ALPHATEST\");\n                    defines.push(\"#define ALPHATESTVALUE 0.4\");\n                }\n                if (!diffuseTexture.gammaSpace) {\n                    defines.push(\"#define DIFFUSE_ISLINEAR\");\n                }\n            }\n            const opacityTexture = material.opacityTexture;\n            if (opacityTexture) {\n                defines.push(\"#define OPACITY\");\n                if (mesh.isVerticesDataPresent(VertexBuffer.UV2Kind) && opacityTexture.coordinatesIndex === 1) {\n                    defines.push(\"#define OPACITYUV2\");\n                    uv2 = true;\n                }\n                else if (mesh.isVerticesDataPresent(VertexBuffer.UVKind)) {\n                    defines.push(\"#define OPACITYUV1\");\n                    uv1 = true;\n                }\n            }\n        }\n        // Emissive\n        if (emissiveTexture) {\n            defines.push(\"#define EMISSIVE\");\n            if (mesh.isVerticesDataPresent(VertexBuffer.UV2Kind) && emissiveTexture.coordinatesIndex === 1) {\n                defines.push(\"#define EMISSIVEUV2\");\n                uv2 = true;\n            }\n            else if (mesh.isVerticesDataPresent(VertexBuffer.UVKind)) {\n                defines.push(\"#define EMISSIVEUV1\");\n                uv1 = true;\n            }\n            if (!emissiveTexture.gammaSpace) {\n                defines.push(\"#define EMISSIVE_ISLINEAR\");\n            }\n        }\n        // Vertex\n        if (mesh.useVertexColors && mesh.isVerticesDataPresent(VertexBuffer.ColorKind) && mesh.hasVertexAlpha && material.transparencyMode !== Material.MATERIAL_OPAQUE) {\n            attribs.push(VertexBuffer.ColorKind);\n            defines.push(\"#define VERTEXALPHA\");\n        }\n        if (uv1) {\n            attribs.push(VertexBuffer.UVKind);\n            defines.push(\"#define UV1\");\n        }\n        if (uv2) {\n            attribs.push(VertexBuffer.UV2Kind);\n            defines.push(\"#define UV2\");\n        }\n        // Bones\n        const fallbacks = new EffectFallbacks();\n        if (mesh.useBones && mesh.computeBonesUsingShaders) {\n            attribs.push(VertexBuffer.MatricesIndicesKind);\n            attribs.push(VertexBuffer.MatricesWeightsKind);\n            if (mesh.numBoneInfluencers > 4) {\n                attribs.push(VertexBuffer.MatricesIndicesExtraKind);\n                attribs.push(VertexBuffer.MatricesWeightsExtraKind);\n            }\n            defines.push(\"#define NUM_BONE_INFLUENCERS \" + mesh.numBoneInfluencers);\n            const skeleton = mesh.skeleton;\n            if (skeleton && skeleton.isUsingTextureForMatrices) {\n                defines.push(\"#define BONETEXTURE\");\n            }\n            else {\n                defines.push(\"#define BonesPerMesh \" + (skeleton ? skeleton.bones.length + 1 : 0));\n            }\n            if (mesh.numBoneInfluencers > 0) {\n                fallbacks.addCPUSkinningFallback(0, mesh);\n            }\n        }\n        else {\n            defines.push(\"#define NUM_BONE_INFLUENCERS 0\");\n        }\n        // Morph targets\n        const manager = mesh.morphTargetManager;\n        let morphInfluencers = 0;\n        if (manager) {\n            if (manager.numInfluencers > 0) {\n                defines.push(\"#define MORPHTARGETS\");\n                morphInfluencers = manager.numInfluencers;\n                defines.push(\"#define NUM_MORPH_INFLUENCERS \" + morphInfluencers);\n                if (manager.isUsingTextureForTargets) {\n                    defines.push(\"#define MORPHTARGETS_TEXTURE\");\n                }\n                MaterialHelper.PrepareAttributesForMorphTargetsInfluencers(attribs, mesh, morphInfluencers);\n            }\n        }\n        // Instances\n        if (useInstances) {\n            defines.push(\"#define INSTANCES\");\n            MaterialHelper.PushAttributesForInstances(attribs);\n            if (subMesh.getRenderingMesh().hasThinInstances) {\n                defines.push(\"#define THIN_INSTANCES\");\n            }\n        }\n        // ClipPlanes\n        prepareDefinesForClipPlanes(material, this._scene, defines);\n        this._addCustomEffectDefines(defines);\n        // Get correct effect\n        const drawWrapper = subMesh._getDrawWrapper(undefined, true);\n        const cachedDefines = drawWrapper.defines;\n        const join = defines.join(\"\\n\");\n        if (cachedDefines !== join) {\n            const uniforms = [\n                \"world\",\n                \"mBones\",\n                \"viewProjection\",\n                \"glowColor\",\n                \"morphTargetInfluences\",\n                \"boneTextureWidth\",\n                \"diffuseMatrix\",\n                \"emissiveMatrix\",\n                \"opacityMatrix\",\n                \"opacityIntensity\",\n                \"morphTargetTextureInfo\",\n                \"morphTargetTextureIndices\",\n            ];\n            addClipPlaneUniforms(uniforms);\n            drawWrapper.setEffect(this._engine.createEffect(\"glowMapGeneration\", attribs, uniforms, [\"diffuseSampler\", \"emissiveSampler\", \"opacitySampler\", \"boneSampler\", \"morphTargets\"], join, fallbacks, undefined, undefined, { maxSimultaneousMorphTargets: morphInfluencers }), join);\n        }\n        return drawWrapper.effect.isReady();\n    }\n    /**\n     * Renders the glowing part of the scene by blending the blurred glowing meshes on top of the rendered scene.\n     */\n    render() {\n        for (let i = 0; i < this._postProcesses.length; i++) {\n            if (!this._postProcesses[i].isReady()) {\n                return;\n            }\n        }\n        const engine = this._scene.getEngine();\n        const numDraws = this._numInternalDraws();\n        // Check\n        let isReady = true;\n        for (let i = 0; i < numDraws; ++i) {\n            let currentEffect = this._mergeDrawWrapper[i];\n            if (!currentEffect) {\n                currentEffect = this._mergeDrawWrapper[i] = new DrawWrapper(this._engine);\n                currentEffect.setEffect(this._createMergeEffect());\n            }\n            isReady = isReady && currentEffect.effect.isReady();\n        }\n        if (!isReady) {\n            return;\n        }\n        this.onBeforeComposeObservable.notifyObservers(this);\n        const previousAlphaMode = engine.getAlphaMode();\n        for (let i = 0; i < numDraws; ++i) {\n            const currentEffect = this._mergeDrawWrapper[i];\n            // Render\n            engine.enableEffect(currentEffect);\n            engine.setState(false);\n            // VBOs\n            engine.bindBuffers(this._vertexBuffers, this._indexBuffer, currentEffect.effect);\n            // Go Blend.\n            engine.setAlphaMode(this._effectLayerOptions.alphaBlendingMode);\n            // Blends the map on the main canvas.\n            this._internalRender(currentEffect.effect, i);\n        }\n        // Restore Alpha\n        engine.setAlphaMode(previousAlphaMode);\n        this.onAfterComposeObservable.notifyObservers(this);\n        // Handle size changes.\n        const size = this._mainTexture.getSize();\n        this._setMainTextureSize();\n        if ((size.width !== this._mainTextureDesiredSize.width || size.height !== this._mainTextureDesiredSize.height) &&\n            this._mainTextureDesiredSize.width !== 0 &&\n            this._mainTextureDesiredSize.height !== 0) {\n            // Recreate RTT and post processes on size change.\n            this.onSizeChangedObservable.notifyObservers(this);\n            this._disposeTextureAndPostProcesses();\n            this._createMainTexture();\n            this._createTextureAndPostProcesses();\n        }\n    }\n    /**\n     * Determine if a given mesh will be used in the current effect.\n     * @param mesh mesh to test\n     * @returns true if the mesh will be used\n     */\n    hasMesh(mesh) {\n        if (this.renderingGroupId === -1 || mesh.renderingGroupId === this.renderingGroupId) {\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Returns true if the layer contains information to display, otherwise false.\n     * @returns true if the glow layer should be rendered\n     */\n    shouldRender() {\n        return this.isEnabled && this._shouldRender;\n    }\n    /**\n     * Returns true if the mesh should render, otherwise false.\n     * @param mesh The mesh to render\n     * @returns true if it should render otherwise false\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _shouldRenderMesh(mesh) {\n        return true;\n    }\n    /**\n     * Returns true if the mesh can be rendered, otherwise false.\n     * @param mesh The mesh to render\n     * @param material The material used on the mesh\n     * @returns true if it can be rendered otherwise false\n     */\n    _canRenderMesh(mesh, material) {\n        return !material.needAlphaBlendingForMesh(mesh);\n    }\n    /**\n     * Returns true if the mesh should render, otherwise false.\n     * @returns true if it should render otherwise false\n     */\n    _shouldRenderEmissiveTextureForMesh() {\n        return true;\n    }\n    /**\n     * Renders the submesh passed in parameter to the generation map.\n     * @param subMesh\n     * @param enableAlphaMode\n     */\n    _renderSubMesh(subMesh, enableAlphaMode = false) {\n        var _a, _b;\n        if (!this.shouldRender()) {\n            return;\n        }\n        const material = subMesh.getMaterial();\n        const ownerMesh = subMesh.getMesh();\n        const replacementMesh = subMesh.getReplacementMesh();\n        const renderingMesh = subMesh.getRenderingMesh();\n        const effectiveMesh = subMesh.getEffectiveMesh();\n        const scene = this._scene;\n        const engine = scene.getEngine();\n        effectiveMesh._internalAbstractMeshDataInfo._isActiveIntermediate = false;\n        if (!material) {\n            return;\n        }\n        // Do not block in blend mode.\n        if (!this._canRenderMesh(renderingMesh, material)) {\n            return;\n        }\n        // Culling\n        let sideOrientation = (_a = renderingMesh.overrideMaterialSideOrientation) !== null && _a !== void 0 ? _a : material.sideOrientation;\n        const mainDeterminant = effectiveMesh._getWorldMatrixDeterminant();\n        if (mainDeterminant < 0) {\n            sideOrientation = sideOrientation === Material.ClockWiseSideOrientation ? Material.CounterClockWiseSideOrientation : Material.ClockWiseSideOrientation;\n        }\n        const reverse = sideOrientation === Material.ClockWiseSideOrientation;\n        engine.setState(material.backFaceCulling, material.zOffset, undefined, reverse, material.cullBackFaces, undefined, material.zOffsetUnits);\n        // Managing instances\n        const batch = renderingMesh._getInstancesRenderList(subMesh._id, !!replacementMesh);\n        if (batch.mustReturn) {\n            return;\n        }\n        // Early Exit per mesh\n        if (!this._shouldRenderMesh(renderingMesh)) {\n            return;\n        }\n        const hardwareInstancedRendering = batch.hardwareInstancedRendering[subMesh._id] || renderingMesh.hasThinInstances;\n        this._setEmissiveTextureAndColor(renderingMesh, subMesh, material);\n        this.onBeforeRenderMeshToEffect.notifyObservers(ownerMesh);\n        if (this._useMeshMaterial(renderingMesh)) {\n            renderingMesh.render(subMesh, enableAlphaMode, replacementMesh || undefined);\n        }\n        else if (this._isReady(subMesh, hardwareInstancedRendering, this._emissiveTextureAndColor.texture)) {\n            const renderingMaterial = (_b = effectiveMesh._internalAbstractMeshDataInfo._materialForRenderPass) === null || _b === void 0 ? void 0 : _b[engine.currentRenderPassId];\n            let drawWrapper = subMesh._getDrawWrapper();\n            if (!drawWrapper && renderingMaterial) {\n                drawWrapper = renderingMaterial._getDrawWrapper();\n            }\n            if (!drawWrapper) {\n                return;\n            }\n            const effect = drawWrapper.effect;\n            engine.enableEffect(drawWrapper);\n            if (!hardwareInstancedRendering) {\n                const fillMode = scene.forcePointsCloud ? Material.PointFillMode : scene.forceWireframe ? Material.WireFrameFillMode : material.fillMode;\n                renderingMesh._bind(subMesh, effect, fillMode);\n            }\n            if (!renderingMaterial) {\n                effect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\n                effect.setMatrix(\"world\", effectiveMesh.getWorldMatrix());\n                effect.setFloat4(\"glowColor\", this._emissiveTextureAndColor.color.r, this._emissiveTextureAndColor.color.g, this._emissiveTextureAndColor.color.b, this._emissiveTextureAndColor.color.a);\n            }\n            else {\n                renderingMaterial.bindForSubMesh(effectiveMesh.getWorldMatrix(), effectiveMesh, subMesh);\n            }\n            if (!renderingMaterial) {\n                const needAlphaTest = material.needAlphaTesting();\n                const diffuseTexture = material.getAlphaTestTexture();\n                const needAlphaBlendFromDiffuse = diffuseTexture && diffuseTexture.hasAlpha && (material.useAlphaFromDiffuseTexture || material._useAlphaFromAlbedoTexture);\n                if (diffuseTexture && (needAlphaTest || needAlphaBlendFromDiffuse)) {\n                    effect.setTexture(\"diffuseSampler\", diffuseTexture);\n                    const textureMatrix = diffuseTexture.getTextureMatrix();\n                    if (textureMatrix) {\n                        effect.setMatrix(\"diffuseMatrix\", textureMatrix);\n                    }\n                }\n                const opacityTexture = material.opacityTexture;\n                if (opacityTexture) {\n                    effect.setTexture(\"opacitySampler\", opacityTexture);\n                    effect.setFloat(\"opacityIntensity\", opacityTexture.level);\n                    const textureMatrix = opacityTexture.getTextureMatrix();\n                    if (textureMatrix) {\n                        effect.setMatrix(\"opacityMatrix\", textureMatrix);\n                    }\n                }\n                // Glow emissive only\n                if (this._emissiveTextureAndColor.texture) {\n                    effect.setTexture(\"emissiveSampler\", this._emissiveTextureAndColor.texture);\n                    effect.setMatrix(\"emissiveMatrix\", this._emissiveTextureAndColor.texture.getTextureMatrix());\n                }\n                // Bones\n                if (renderingMesh.useBones && renderingMesh.computeBonesUsingShaders && renderingMesh.skeleton) {\n                    const skeleton = renderingMesh.skeleton;\n                    if (skeleton.isUsingTextureForMatrices) {\n                        const boneTexture = skeleton.getTransformMatrixTexture(renderingMesh);\n                        if (!boneTexture) {\n                            return;\n                        }\n                        effect.setTexture(\"boneSampler\", boneTexture);\n                        effect.setFloat(\"boneTextureWidth\", 4.0 * (skeleton.bones.length + 1));\n                    }\n                    else {\n                        effect.setMatrices(\"mBones\", skeleton.getTransformMatrices(renderingMesh));\n                    }\n                }\n                // Morph targets\n                MaterialHelper.BindMorphTargetParameters(renderingMesh, effect);\n                if (renderingMesh.morphTargetManager && renderingMesh.morphTargetManager.isUsingTextureForTargets) {\n                    renderingMesh.morphTargetManager._bind(effect);\n                }\n                // Alpha mode\n                if (enableAlphaMode) {\n                    engine.setAlphaMode(material.alphaMode);\n                }\n                // Clip planes\n                bindClipPlane(effect, material, scene);\n            }\n            // Draw\n            renderingMesh._processRendering(effectiveMesh, subMesh, effect, material.fillMode, batch, hardwareInstancedRendering, (isInstance, world) => effect.setMatrix(\"world\", world));\n        }\n        else {\n            // Need to reset refresh rate of the main map\n            this._mainTexture.resetRefreshCounter();\n        }\n        this.onAfterRenderMeshToEffect.notifyObservers(ownerMesh);\n    }\n    /**\n     * Defines whether the current material of the mesh should be use to render the effect.\n     * @param mesh defines the current mesh to render\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _useMeshMaterial(mesh) {\n        return false;\n    }\n    /**\n     * Rebuild the required buffers.\n     * @internal Internal use only.\n     */\n    _rebuild() {\n        const vb = this._vertexBuffers[VertexBuffer.PositionKind];\n        if (vb) {\n            vb._rebuild();\n        }\n        this._generateIndexBuffer();\n    }\n    /**\n     * Dispose only the render target textures and post process.\n     */\n    _disposeTextureAndPostProcesses() {\n        this._mainTexture.dispose();\n        for (let i = 0; i < this._postProcesses.length; i++) {\n            if (this._postProcesses[i]) {\n                this._postProcesses[i].dispose();\n            }\n        }\n        this._postProcesses = [];\n        for (let i = 0; i < this._textures.length; i++) {\n            if (this._textures[i]) {\n                this._textures[i].dispose();\n            }\n        }\n        this._textures = [];\n    }\n    /**\n     * Dispose the highlight layer and free resources.\n     */\n    dispose() {\n        const vertexBuffer = this._vertexBuffers[VertexBuffer.PositionKind];\n        if (vertexBuffer) {\n            vertexBuffer.dispose();\n            this._vertexBuffers[VertexBuffer.PositionKind] = null;\n        }\n        if (this._indexBuffer) {\n            this._scene.getEngine()._releaseBuffer(this._indexBuffer);\n            this._indexBuffer = null;\n        }\n        for (const drawWrapper of this._mergeDrawWrapper) {\n            drawWrapper.dispose();\n        }\n        this._mergeDrawWrapper = [];\n        // Clean textures and post processes\n        this._disposeTextureAndPostProcesses();\n        // Remove from scene\n        const index = this._scene.effectLayers.indexOf(this, 0);\n        if (index > -1) {\n            this._scene.effectLayers.splice(index, 1);\n        }\n        // Callback\n        this.onDisposeObservable.notifyObservers(this);\n        this.onDisposeObservable.clear();\n        this.onBeforeRenderMainTextureObservable.clear();\n        this.onBeforeComposeObservable.clear();\n        this.onBeforeRenderMeshToEffect.clear();\n        this.onAfterRenderMeshToEffect.clear();\n        this.onAfterComposeObservable.clear();\n        this.onSizeChangedObservable.clear();\n    }\n    /**\n     * Gets the class name of the effect layer\n     * @returns the string with the class name of the effect layer\n     */\n    getClassName() {\n        return \"EffectLayer\";\n    }\n    /**\n     * Creates an effect layer from parsed effect layer data\n     * @param parsedEffectLayer defines effect layer data\n     * @param scene defines the current scene\n     * @param rootUrl defines the root URL containing the effect layer information\n     * @returns a parsed effect Layer\n     */\n    static Parse(parsedEffectLayer, scene, rootUrl) {\n        const effectLayerType = Tools.Instantiate(parsedEffectLayer.customType);\n        return effectLayerType.Parse(parsedEffectLayer, scene, rootUrl);\n    }\n}\n/**\n * @internal\n */\nEffectLayer._SceneComponentInitialization = (_) => {\n    throw _WarnImport(\"EffectLayerSceneComponent\");\n};\n__decorate([\n    serialize()\n], EffectLayer.prototype, \"name\", void 0);\n__decorate([\n    serializeAsColor4()\n], EffectLayer.prototype, \"neutralColor\", void 0);\n__decorate([\n    serialize()\n], EffectLayer.prototype, \"isEnabled\", void 0);\n__decorate([\n    serializeAsCameraReference()\n], EffectLayer.prototype, \"camera\", null);\n__decorate([\n    serialize()\n], EffectLayer.prototype, \"renderingGroupId\", null);\n__decorate([\n    serialize()\n], EffectLayer.prototype, \"disableBoundingBoxesFromEffectLayer\", void 0);\n//# sourceMappingURL=effectLayer.js.map","import { Camera } from \"../Cameras/camera.js\";\nimport { SceneComponentConstants } from \"../sceneComponent.js\";\nimport { EffectLayer } from \"./effectLayer.js\";\nimport { AbstractScene } from \"../abstractScene.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\n// Adds the parser to the scene parsers.\nAbstractScene.AddParser(SceneComponentConstants.NAME_EFFECTLAYER, (parsedData, scene, container, rootUrl) => {\n    if (parsedData.effectLayers) {\n        if (!container.effectLayers) {\n            container.effectLayers = new Array();\n        }\n        for (let index = 0; index < parsedData.effectLayers.length; index++) {\n            const effectLayer = EffectLayer.Parse(parsedData.effectLayers[index], scene, rootUrl);\n            container.effectLayers.push(effectLayer);\n        }\n    }\n});\nAbstractScene.prototype.removeEffectLayer = function (toRemove) {\n    const index = this.effectLayers.indexOf(toRemove);\n    if (index !== -1) {\n        this.effectLayers.splice(index, 1);\n    }\n    return index;\n};\nAbstractScene.prototype.addEffectLayer = function (newEffectLayer) {\n    this.effectLayers.push(newEffectLayer);\n};\n/**\n * Defines the layer scene component responsible to manage any effect layers\n * in a given scene.\n */\nexport class EffectLayerSceneComponent {\n    /**\n     * Creates a new instance of the component for the given scene\n     * @param scene Defines the scene to register the component in\n     */\n    constructor(scene) {\n        /**\n         * The component name helpful to identify the component in the list of scene components.\n         */\n        this.name = SceneComponentConstants.NAME_EFFECTLAYER;\n        this._renderEffects = false;\n        this._needStencil = false;\n        this._previousStencilState = false;\n        this.scene = scene || EngineStore.LastCreatedScene;\n        if (!this.scene) {\n            return;\n        }\n        this._engine = this.scene.getEngine();\n        this.scene.effectLayers = new Array();\n    }\n    /**\n     * Registers the component in a given scene\n     */\n    register() {\n        this.scene._isReadyForMeshStage.registerStep(SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER, this, this._isReadyForMesh);\n        this.scene._cameraDrawRenderTargetStage.registerStep(SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER, this, this._renderMainTexture);\n        this.scene._beforeCameraDrawStage.registerStep(SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER, this, this._setStencil);\n        this.scene._afterRenderingGroupDrawStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW, this, this._drawRenderingGroup);\n        this.scene._afterCameraDrawStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER, this, this._setStencilBack);\n        this.scene._afterCameraDrawStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW, this, this._drawCamera);\n    }\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    rebuild() {\n        const layers = this.scene.effectLayers;\n        for (const effectLayer of layers) {\n            effectLayer._rebuild();\n        }\n    }\n    /**\n     * Serializes the component data to the specified json object\n     * @param serializationObject The object to serialize to\n     */\n    serialize(serializationObject) {\n        // Effect layers\n        serializationObject.effectLayers = [];\n        const layers = this.scene.effectLayers;\n        for (const effectLayer of layers) {\n            if (effectLayer.serialize) {\n                serializationObject.effectLayers.push(effectLayer.serialize());\n            }\n        }\n    }\n    /**\n     * Adds all the elements from the container to the scene\n     * @param container the container holding the elements\n     */\n    addFromContainer(container) {\n        if (!container.effectLayers) {\n            return;\n        }\n        container.effectLayers.forEach((o) => {\n            this.scene.addEffectLayer(o);\n        });\n    }\n    /**\n     * Removes all the elements in the container from the scene\n     * @param container contains the elements to remove\n     * @param dispose if the removed element should be disposed (default: false)\n     */\n    removeFromContainer(container, dispose) {\n        if (!container.effectLayers) {\n            return;\n        }\n        container.effectLayers.forEach((o) => {\n            this.scene.removeEffectLayer(o);\n            if (dispose) {\n                o.dispose();\n            }\n        });\n    }\n    /**\n     * Disposes the component and the associated resources.\n     */\n    dispose() {\n        const layers = this.scene.effectLayers;\n        while (layers.length) {\n            layers[0].dispose();\n        }\n    }\n    _isReadyForMesh(mesh, hardwareInstancedRendering) {\n        const currentRenderPassId = this._engine.currentRenderPassId;\n        const layers = this.scene.effectLayers;\n        for (const layer of layers) {\n            if (!layer.hasMesh(mesh)) {\n                continue;\n            }\n            const renderTarget = layer._mainTexture;\n            this._engine.currentRenderPassId = renderTarget.renderPassId;\n            for (const subMesh of mesh.subMeshes) {\n                if (!layer.isReady(subMesh, hardwareInstancedRendering)) {\n                    this._engine.currentRenderPassId = currentRenderPassId;\n                    return false;\n                }\n            }\n        }\n        this._engine.currentRenderPassId = currentRenderPassId;\n        return true;\n    }\n    _renderMainTexture(camera) {\n        this._renderEffects = false;\n        this._needStencil = false;\n        let needRebind = false;\n        const layers = this.scene.effectLayers;\n        if (layers && layers.length > 0) {\n            this._previousStencilState = this._engine.getStencilBuffer();\n            for (const effectLayer of layers) {\n                if (effectLayer.shouldRender() &&\n                    (!effectLayer.camera ||\n                        (effectLayer.camera.cameraRigMode === Camera.RIG_MODE_NONE && camera === effectLayer.camera) ||\n                        (effectLayer.camera.cameraRigMode !== Camera.RIG_MODE_NONE && effectLayer.camera._rigCameras.indexOf(camera) > -1))) {\n                    this._renderEffects = true;\n                    this._needStencil = this._needStencil || effectLayer.needStencil();\n                    const renderTarget = effectLayer._mainTexture;\n                    if (renderTarget._shouldRender()) {\n                        this.scene.incrementRenderId();\n                        renderTarget.render(false, false);\n                        needRebind = true;\n                    }\n                }\n            }\n            this.scene.incrementRenderId();\n        }\n        return needRebind;\n    }\n    _setStencil() {\n        // Activate effect Layer stencil\n        if (this._needStencil) {\n            this._engine.setStencilBuffer(true);\n        }\n    }\n    _setStencilBack() {\n        // Restore effect Layer stencil\n        if (this._needStencil) {\n            this._engine.setStencilBuffer(this._previousStencilState);\n        }\n    }\n    _draw(renderingGroupId) {\n        if (this._renderEffects) {\n            this._engine.setDepthBuffer(false);\n            const layers = this.scene.effectLayers;\n            for (let i = 0; i < layers.length; i++) {\n                const effectLayer = layers[i];\n                if (effectLayer.renderingGroupId === renderingGroupId) {\n                    if (effectLayer.shouldRender()) {\n                        effectLayer.render();\n                    }\n                }\n            }\n            this._engine.setDepthBuffer(true);\n        }\n    }\n    _drawCamera() {\n        if (this._renderEffects) {\n            this._draw(-1);\n        }\n    }\n    _drawRenderingGroup(index) {\n        if (!this.scene._isInIntermediateRendering() && this._renderEffects) {\n            this._draw(index);\n        }\n    }\n}\nEffectLayer._SceneComponentInitialization = (scene) => {\n    let component = scene._getComponent(SceneComponentConstants.NAME_EFFECTLAYER);\n    if (!component) {\n        component = new EffectLayerSceneComponent(scene);\n        scene._addComponent(component);\n    }\n};\n//# sourceMappingURL=effectLayerSceneComponent.js.map","import { __decorate } from \"../tslib.es6.js\";\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { serialize, SerializationHelper } from \"../Misc/decorators.js\";\nimport { Vector2 } from \"../Maths/math.vector.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture.js\";\nimport { Material } from \"../Materials/material.js\";\nimport { BlurPostProcess } from \"../PostProcesses/blurPostProcess.js\";\nimport { EffectLayer } from \"./effectLayer.js\";\nimport { AbstractScene } from \"../abstractScene.js\";\n\nimport { RegisterClass } from \"../Misc/typeStore.js\";\nimport { Engine } from \"../Engines/engine.js\";\nimport { Color4 } from \"../Maths/math.color.js\";\nimport \"../Shaders/glowMapMerge.fragment.js\";\nimport \"../Shaders/glowMapMerge.vertex.js\";\nimport \"../Layers/effectLayerSceneComponent.js\";\nAbstractScene.prototype.getGlowLayerByName = function (name) {\n    var _a;\n    for (let index = 0; index < ((_a = this.effectLayers) === null || _a === void 0 ? void 0 : _a.length); index++) {\n        if (this.effectLayers[index].name === name && this.effectLayers[index].getEffectName() === GlowLayer.EffectName) {\n            return this.effectLayers[index];\n        }\n    }\n    return null;\n};\n/**\n * The glow layer Helps adding a glow effect around the emissive parts of a mesh.\n *\n * Once instantiated in a scene, by default, all the emissive meshes will glow.\n *\n * Documentation: https://doc.babylonjs.com/features/featuresDeepDive/mesh/glowLayer\n */\nexport class GlowLayer extends EffectLayer {\n    /**\n     * Sets the kernel size of the blur.\n     */\n    set blurKernelSize(value) {\n        if (value === this._options.blurKernelSize) {\n            return;\n        }\n        this._options.blurKernelSize = value;\n        const effectiveKernel = this._getEffectiveBlurKernelSize();\n        this._horizontalBlurPostprocess1.kernel = effectiveKernel;\n        this._verticalBlurPostprocess1.kernel = effectiveKernel;\n        this._horizontalBlurPostprocess2.kernel = effectiveKernel;\n        this._verticalBlurPostprocess2.kernel = effectiveKernel;\n    }\n    /**\n     * Gets the kernel size of the blur.\n     */\n    get blurKernelSize() {\n        return this._options.blurKernelSize;\n    }\n    /**\n     * Sets the glow intensity.\n     */\n    set intensity(value) {\n        this._intensity = value;\n    }\n    /**\n     * Gets the glow intensity.\n     */\n    get intensity() {\n        return this._intensity;\n    }\n    /**\n     * Instantiates a new glow Layer and references it to the scene.\n     * @param name The name of the layer\n     * @param scene The scene to use the layer in\n     * @param options Sets of none mandatory options to use with the layer (see IGlowLayerOptions for more information)\n     */\n    constructor(name, scene, options) {\n        super(name, scene);\n        this._intensity = 1.0;\n        this._includedOnlyMeshes = [];\n        this._excludedMeshes = [];\n        this._meshesUsingTheirOwnMaterials = [];\n        this.neutralColor = new Color4(0, 0, 0, 1);\n        // Adapt options\n        this._options = {\n            mainTextureRatio: GlowLayer.DefaultTextureRatio,\n            blurKernelSize: 32,\n            mainTextureFixedSize: undefined,\n            camera: null,\n            mainTextureSamples: 1,\n            renderingGroupId: -1,\n            ldrMerge: false,\n            alphaBlendingMode: 1,\n            mainTextureType: 0,\n            ...options,\n        };\n        // Initialize the layer\n        this._init({\n            alphaBlendingMode: this._options.alphaBlendingMode,\n            camera: this._options.camera,\n            mainTextureFixedSize: this._options.mainTextureFixedSize,\n            mainTextureRatio: this._options.mainTextureRatio,\n            renderingGroupId: this._options.renderingGroupId,\n            mainTextureType: this._options.mainTextureType,\n        });\n    }\n    /**\n     * Get the effect name of the layer.\n     * @returns The effect name\n     */\n    getEffectName() {\n        return GlowLayer.EffectName;\n    }\n    /**\n     * Create the merge effect. This is the shader use to blit the information back\n     * to the main canvas at the end of the scene rendering.\n     */\n    _createMergeEffect() {\n        let defines = \"#define EMISSIVE \\n\";\n        if (this._options.ldrMerge) {\n            defines += \"#define LDR \\n\";\n        }\n        // Effect\n        return this._engine.createEffect(\"glowMapMerge\", [VertexBuffer.PositionKind], [\"offset\"], [\"textureSampler\", \"textureSampler2\"], defines);\n    }\n    /**\n     * Creates the render target textures and post processes used in the glow layer.\n     */\n    _createTextureAndPostProcesses() {\n        let blurTextureWidth = this._mainTextureDesiredSize.width;\n        let blurTextureHeight = this._mainTextureDesiredSize.height;\n        blurTextureWidth = this._engine.needPOTTextures ? Engine.GetExponentOfTwo(blurTextureWidth, this._maxSize) : blurTextureWidth;\n        blurTextureHeight = this._engine.needPOTTextures ? Engine.GetExponentOfTwo(blurTextureHeight, this._maxSize) : blurTextureHeight;\n        let textureType = 0;\n        if (this._engine.getCaps().textureHalfFloatRender) {\n            textureType = 2;\n        }\n        else {\n            textureType = 0;\n        }\n        this._blurTexture1 = new RenderTargetTexture(\"GlowLayerBlurRTT\", {\n            width: blurTextureWidth,\n            height: blurTextureHeight,\n        }, this._scene, false, true, textureType);\n        this._blurTexture1.wrapU = Texture.CLAMP_ADDRESSMODE;\n        this._blurTexture1.wrapV = Texture.CLAMP_ADDRESSMODE;\n        this._blurTexture1.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);\n        this._blurTexture1.renderParticles = false;\n        this._blurTexture1.ignoreCameraViewport = true;\n        const blurTextureWidth2 = Math.floor(blurTextureWidth / 2);\n        const blurTextureHeight2 = Math.floor(blurTextureHeight / 2);\n        this._blurTexture2 = new RenderTargetTexture(\"GlowLayerBlurRTT2\", {\n            width: blurTextureWidth2,\n            height: blurTextureHeight2,\n        }, this._scene, false, true, textureType);\n        this._blurTexture2.wrapU = Texture.CLAMP_ADDRESSMODE;\n        this._blurTexture2.wrapV = Texture.CLAMP_ADDRESSMODE;\n        this._blurTexture2.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);\n        this._blurTexture2.renderParticles = false;\n        this._blurTexture2.ignoreCameraViewport = true;\n        this._textures = [this._blurTexture1, this._blurTexture2];\n        const effectiveKernel = this._getEffectiveBlurKernelSize();\n        this._horizontalBlurPostprocess1 = new BlurPostProcess(\"GlowLayerHBP1\", new Vector2(1.0, 0), effectiveKernel, {\n            width: blurTextureWidth,\n            height: blurTextureHeight,\n        }, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, textureType);\n        this._horizontalBlurPostprocess1.width = blurTextureWidth;\n        this._horizontalBlurPostprocess1.height = blurTextureHeight;\n        this._horizontalBlurPostprocess1.externalTextureSamplerBinding = true;\n        this._horizontalBlurPostprocess1.onApplyObservable.add((effect) => {\n            effect.setTexture(\"textureSampler\", this._mainTexture);\n        });\n        this._verticalBlurPostprocess1 = new BlurPostProcess(\"GlowLayerVBP1\", new Vector2(0, 1.0), effectiveKernel, {\n            width: blurTextureWidth,\n            height: blurTextureHeight,\n        }, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, textureType);\n        this._horizontalBlurPostprocess2 = new BlurPostProcess(\"GlowLayerHBP2\", new Vector2(1.0, 0), effectiveKernel, {\n            width: blurTextureWidth2,\n            height: blurTextureHeight2,\n        }, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, textureType);\n        this._horizontalBlurPostprocess2.width = blurTextureWidth2;\n        this._horizontalBlurPostprocess2.height = blurTextureHeight2;\n        this._horizontalBlurPostprocess2.externalTextureSamplerBinding = true;\n        this._horizontalBlurPostprocess2.onApplyObservable.add((effect) => {\n            effect.setTexture(\"textureSampler\", this._blurTexture1);\n        });\n        this._verticalBlurPostprocess2 = new BlurPostProcess(\"GlowLayerVBP2\", new Vector2(0, 1.0), effectiveKernel, {\n            width: blurTextureWidth2,\n            height: blurTextureHeight2,\n        }, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, textureType);\n        this._postProcesses = [this._horizontalBlurPostprocess1, this._verticalBlurPostprocess1, this._horizontalBlurPostprocess2, this._verticalBlurPostprocess2];\n        this._postProcesses1 = [this._horizontalBlurPostprocess1, this._verticalBlurPostprocess1];\n        this._postProcesses2 = [this._horizontalBlurPostprocess2, this._verticalBlurPostprocess2];\n        this._mainTexture.samples = this._options.mainTextureSamples;\n        this._mainTexture.onAfterUnbindObservable.add(() => {\n            const internalTexture = this._blurTexture1.renderTarget;\n            if (internalTexture) {\n                this._scene.postProcessManager.directRender(this._postProcesses1, internalTexture, true);\n                const internalTexture2 = this._blurTexture2.renderTarget;\n                if (internalTexture2) {\n                    this._scene.postProcessManager.directRender(this._postProcesses2, internalTexture2, true);\n                }\n                this._engine.unBindFramebuffer(internalTexture2 !== null && internalTexture2 !== void 0 ? internalTexture2 : internalTexture, true);\n            }\n        });\n        // Prevent autoClear.\n        this._postProcesses.map((pp) => {\n            pp.autoClear = false;\n        });\n    }\n    /**\n     * @returns The blur kernel size used by the glow.\n     * Note: The value passed in the options is divided by 2 for back compatibility.\n     */\n    _getEffectiveBlurKernelSize() {\n        return this._options.blurKernelSize / 2;\n    }\n    /**\n     * Checks for the readiness of the element composing the layer.\n     * @param subMesh the mesh to check for\n     * @param useInstances specify whether or not to use instances to render the mesh\n     * @returns true if ready otherwise, false\n     */\n    isReady(subMesh, useInstances) {\n        const material = subMesh.getMaterial();\n        const mesh = subMesh.getRenderingMesh();\n        if (!material || !mesh) {\n            return false;\n        }\n        const emissiveTexture = material.emissiveTexture;\n        return super._isReady(subMesh, useInstances, emissiveTexture);\n    }\n    /**\n     * Returns whether or not the layer needs stencil enabled during the mesh rendering.\n     */\n    needStencil() {\n        return false;\n    }\n    /**\n     * Returns true if the mesh can be rendered, otherwise false.\n     * @param mesh The mesh to render\n     * @param material The material used on the mesh\n     * @returns true if it can be rendered otherwise false\n     */\n    _canRenderMesh(mesh, material) {\n        return true;\n    }\n    /**\n     * Implementation specific of rendering the generating effect on the main canvas.\n     * @param effect The effect used to render through\n     */\n    _internalRender(effect) {\n        // Texture\n        effect.setTexture(\"textureSampler\", this._blurTexture1);\n        effect.setTexture(\"textureSampler2\", this._blurTexture2);\n        effect.setFloat(\"offset\", this._intensity);\n        // Cache\n        const engine = this._engine;\n        const previousStencilBuffer = engine.getStencilBuffer();\n        // Draw order\n        engine.setStencilBuffer(false);\n        engine.drawElementsType(Material.TriangleFillMode, 0, 6);\n        // Draw order\n        engine.setStencilBuffer(previousStencilBuffer);\n    }\n    /**\n     * Sets the required values for both the emissive texture and and the main color.\n     * @param mesh\n     * @param subMesh\n     * @param material\n     */\n    _setEmissiveTextureAndColor(mesh, subMesh, material) {\n        var _a;\n        let textureLevel = 1.0;\n        if (this.customEmissiveTextureSelector) {\n            this._emissiveTextureAndColor.texture = this.customEmissiveTextureSelector(mesh, subMesh, material);\n        }\n        else {\n            if (material) {\n                this._emissiveTextureAndColor.texture = material.emissiveTexture;\n                if (this._emissiveTextureAndColor.texture) {\n                    textureLevel = this._emissiveTextureAndColor.texture.level;\n                }\n            }\n            else {\n                this._emissiveTextureAndColor.texture = null;\n            }\n        }\n        if (this.customEmissiveColorSelector) {\n            this.customEmissiveColorSelector(mesh, subMesh, material, this._emissiveTextureAndColor.color);\n        }\n        else {\n            if (material.emissiveColor) {\n                const emissiveIntensity = (_a = material.emissiveIntensity) !== null && _a !== void 0 ? _a : 1;\n                textureLevel *= emissiveIntensity;\n                this._emissiveTextureAndColor.color.set(material.emissiveColor.r * textureLevel, material.emissiveColor.g * textureLevel, material.emissiveColor.b * textureLevel, material.alpha);\n            }\n            else {\n                this._emissiveTextureAndColor.color.set(this.neutralColor.r, this.neutralColor.g, this.neutralColor.b, this.neutralColor.a);\n            }\n        }\n    }\n    /**\n     * Returns true if the mesh should render, otherwise false.\n     * @param mesh The mesh to render\n     * @returns true if it should render otherwise false\n     */\n    _shouldRenderMesh(mesh) {\n        return this.hasMesh(mesh);\n    }\n    /**\n     * Adds specific effects defines.\n     * @param defines The defines to add specifics to.\n     */\n    _addCustomEffectDefines(defines) {\n        defines.push(\"#define GLOW\");\n    }\n    /**\n     * Add a mesh in the exclusion list to prevent it to impact or being impacted by the glow layer.\n     * @param mesh The mesh to exclude from the glow layer\n     */\n    addExcludedMesh(mesh) {\n        if (this._excludedMeshes.indexOf(mesh.uniqueId) === -1) {\n            this._excludedMeshes.push(mesh.uniqueId);\n        }\n    }\n    /**\n     * Remove a mesh from the exclusion list to let it impact or being impacted by the glow layer.\n     * @param mesh The mesh to remove\n     */\n    removeExcludedMesh(mesh) {\n        const index = this._excludedMeshes.indexOf(mesh.uniqueId);\n        if (index !== -1) {\n            this._excludedMeshes.splice(index, 1);\n        }\n    }\n    /**\n     * Add a mesh in the inclusion list to impact or being impacted by the glow layer.\n     * @param mesh The mesh to include in the glow layer\n     */\n    addIncludedOnlyMesh(mesh) {\n        if (this._includedOnlyMeshes.indexOf(mesh.uniqueId) === -1) {\n            this._includedOnlyMeshes.push(mesh.uniqueId);\n        }\n    }\n    /**\n     * Remove a mesh from the Inclusion list to prevent it to impact or being impacted by the glow layer.\n     * @param mesh The mesh to remove\n     */\n    removeIncludedOnlyMesh(mesh) {\n        const index = this._includedOnlyMeshes.indexOf(mesh.uniqueId);\n        if (index !== -1) {\n            this._includedOnlyMeshes.splice(index, 1);\n        }\n    }\n    /**\n     * Determine if a given mesh will be used in the glow layer\n     * @param mesh The mesh to test\n     * @returns true if the mesh will be highlighted by the current glow layer\n     */\n    hasMesh(mesh) {\n        if (!super.hasMesh(mesh)) {\n            return false;\n        }\n        // Included Mesh\n        if (this._includedOnlyMeshes.length) {\n            return this._includedOnlyMeshes.indexOf(mesh.uniqueId) !== -1;\n        }\n        // Excluded Mesh\n        if (this._excludedMeshes.length) {\n            return this._excludedMeshes.indexOf(mesh.uniqueId) === -1;\n        }\n        return true;\n    }\n    /**\n     * Defines whether the current material of the mesh should be use to render the effect.\n     * @param mesh defines the current mesh to render\n     */\n    _useMeshMaterial(mesh) {\n        if (this._meshesUsingTheirOwnMaterials.length == 0) {\n            return false;\n        }\n        return this._meshesUsingTheirOwnMaterials.indexOf(mesh.uniqueId) > -1;\n    }\n    /**\n     * Add a mesh to be rendered through its own material and not with emissive only.\n     * @param mesh The mesh for which we need to use its material\n     */\n    referenceMeshToUseItsOwnMaterial(mesh) {\n        mesh.resetDrawCache(this._mainTexture.renderPassId);\n        this._meshesUsingTheirOwnMaterials.push(mesh.uniqueId);\n        mesh.onDisposeObservable.add(() => {\n            this._disposeMesh(mesh);\n        });\n    }\n    /**\n     * Remove a mesh from being rendered through its own material and not with emissive only.\n     * @param mesh The mesh for which we need to not use its material\n     */\n    unReferenceMeshFromUsingItsOwnMaterial(mesh) {\n        let index = this._meshesUsingTheirOwnMaterials.indexOf(mesh.uniqueId);\n        while (index >= 0) {\n            this._meshesUsingTheirOwnMaterials.splice(index, 1);\n            index = this._meshesUsingTheirOwnMaterials.indexOf(mesh.uniqueId);\n        }\n        mesh.resetDrawCache(this._mainTexture.renderPassId);\n    }\n    /**\n     * Free any resources and references associated to a mesh.\n     * Internal use\n     * @param mesh The mesh to free.\n     * @internal\n     */\n    _disposeMesh(mesh) {\n        this.removeIncludedOnlyMesh(mesh);\n        this.removeExcludedMesh(mesh);\n    }\n    /**\n     * Gets the class name of the effect layer\n     * @returns the string with the class name of the effect layer\n     */\n    getClassName() {\n        return \"GlowLayer\";\n    }\n    /**\n     * Serializes this glow layer\n     * @returns a serialized glow layer object\n     */\n    serialize() {\n        const serializationObject = SerializationHelper.Serialize(this);\n        serializationObject.customType = \"BABYLON.GlowLayer\";\n        let index;\n        // Included meshes\n        serializationObject.includedMeshes = [];\n        if (this._includedOnlyMeshes.length) {\n            for (index = 0; index < this._includedOnlyMeshes.length; index++) {\n                const mesh = this._scene.getMeshByUniqueId(this._includedOnlyMeshes[index]);\n                if (mesh) {\n                    serializationObject.includedMeshes.push(mesh.id);\n                }\n            }\n        }\n        // Excluded meshes\n        serializationObject.excludedMeshes = [];\n        if (this._excludedMeshes.length) {\n            for (index = 0; index < this._excludedMeshes.length; index++) {\n                const mesh = this._scene.getMeshByUniqueId(this._excludedMeshes[index]);\n                if (mesh) {\n                    serializationObject.excludedMeshes.push(mesh.id);\n                }\n            }\n        }\n        return serializationObject;\n    }\n    /**\n     * Creates a Glow Layer from parsed glow layer data\n     * @param parsedGlowLayer defines glow layer data\n     * @param scene defines the current scene\n     * @param rootUrl defines the root URL containing the glow layer information\n     * @returns a parsed Glow Layer\n     */\n    static Parse(parsedGlowLayer, scene, rootUrl) {\n        const gl = SerializationHelper.Parse(() => new GlowLayer(parsedGlowLayer.name, scene, parsedGlowLayer.options), parsedGlowLayer, scene, rootUrl);\n        let index;\n        // Excluded meshes\n        for (index = 0; index < parsedGlowLayer.excludedMeshes.length; index++) {\n            const mesh = scene.getMeshById(parsedGlowLayer.excludedMeshes[index]);\n            if (mesh) {\n                gl.addExcludedMesh(mesh);\n            }\n        }\n        // Included meshes\n        for (index = 0; index < parsedGlowLayer.includedMeshes.length; index++) {\n            const mesh = scene.getMeshById(parsedGlowLayer.includedMeshes[index]);\n            if (mesh) {\n                gl.addIncludedOnlyMesh(mesh);\n            }\n        }\n        return gl;\n    }\n}\n/**\n * Effect Name of the layer.\n */\nGlowLayer.EffectName = \"GlowLayer\";\n/**\n * The default blur kernel size used for the glow.\n */\nGlowLayer.DefaultBlurKernelSize = 32;\n/**\n * The default texture size ratio used for the glow.\n */\nGlowLayer.DefaultTextureRatio = 0.5;\n__decorate([\n    serialize()\n], GlowLayer.prototype, \"blurKernelSize\", null);\n__decorate([\n    serialize()\n], GlowLayer.prototype, \"intensity\", null);\n__decorate([\n    serialize(\"options\")\n], GlowLayer.prototype, \"_options\", void 0);\nRegisterClass(\"BABYLON.GlowLayer\", GlowLayer);\n//# sourceMappingURL=glowLayer.js.map","import { __decorate } from \"../tslib.es6.js\";\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { serialize, SerializationHelper } from \"../Misc/decorators.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { Vector2 } from \"../Maths/math.vector.js\";\nimport { Engine } from \"../Engines/engine.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { Material } from \"../Materials/material.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture.js\";\nimport { PostProcess } from \"../PostProcesses/postProcess.js\";\nimport { PassPostProcess } from \"../PostProcesses/passPostProcess.js\";\nimport { BlurPostProcess } from \"../PostProcesses/blurPostProcess.js\";\nimport { EffectLayer } from \"./effectLayer.js\";\nimport { AbstractScene } from \"../abstractScene.js\";\n\nimport { Logger } from \"../Misc/logger.js\";\nimport { RegisterClass } from \"../Misc/typeStore.js\";\nimport { Color4, Color3 } from \"../Maths/math.color.js\";\nimport \"../Shaders/glowMapMerge.fragment.js\";\nimport \"../Shaders/glowMapMerge.vertex.js\";\nimport \"../Shaders/glowBlurPostProcess.fragment.js\";\nimport \"../Layers/effectLayerSceneComponent.js\";\nAbstractScene.prototype.getHighlightLayerByName = function (name) {\n    var _a;\n    for (let index = 0; index < ((_a = this.effectLayers) === null || _a === void 0 ? void 0 : _a.length); index++) {\n        if (this.effectLayers[index].name === name && this.effectLayers[index].getEffectName() === HighlightLayer.EffectName) {\n            return this.effectLayers[index];\n        }\n    }\n    return null;\n};\n/**\n * Special Glow Blur post process only blurring the alpha channel\n * It enforces keeping the most luminous color in the color channel.\n */\nclass GlowBlurPostProcess extends PostProcess {\n    constructor(name, direction, kernel, options, camera, samplingMode = Texture.BILINEAR_SAMPLINGMODE, engine, reusable) {\n        super(name, \"glowBlurPostProcess\", [\"screenSize\", \"direction\", \"blurWidth\"], null, options, camera, samplingMode, engine, reusable);\n        this.direction = direction;\n        this.kernel = kernel;\n        this.onApplyObservable.add((effect) => {\n            effect.setFloat2(\"screenSize\", this.width, this.height);\n            effect.setVector2(\"direction\", this.direction);\n            effect.setFloat(\"blurWidth\", this.kernel);\n        });\n    }\n}\n/**\n * The highlight layer Helps adding a glow effect around a mesh.\n *\n * Once instantiated in a scene, simply use the addMesh or removeMesh method to add or remove\n * glowy meshes to your scene.\n *\n * !!! THIS REQUIRES AN ACTIVE STENCIL BUFFER ON THE CANVAS !!!\n */\nexport class HighlightLayer extends EffectLayer {\n    /**\n     * Specifies the horizontal size of the blur.\n     */\n    set blurHorizontalSize(value) {\n        this._horizontalBlurPostprocess.kernel = value;\n        this._options.blurHorizontalSize = value;\n    }\n    /**\n     * Specifies the vertical size of the blur.\n     */\n    set blurVerticalSize(value) {\n        this._verticalBlurPostprocess.kernel = value;\n        this._options.blurVerticalSize = value;\n    }\n    /**\n     * Gets the horizontal size of the blur.\n     */\n    get blurHorizontalSize() {\n        return this._horizontalBlurPostprocess.kernel;\n    }\n    /**\n     * Gets the vertical size of the blur.\n     */\n    get blurVerticalSize() {\n        return this._verticalBlurPostprocess.kernel;\n    }\n    /**\n     * Instantiates a new highlight Layer and references it to the scene..\n     * @param name The name of the layer\n     * @param scene The scene to use the layer in\n     * @param options Sets of none mandatory options to use with the layer (see IHighlightLayerOptions for more information)\n     */\n    constructor(name, scene, options) {\n        super(name, scene);\n        this.name = name;\n        /**\n         * Specifies whether or not the inner glow is ACTIVE in the layer.\n         */\n        this.innerGlow = true;\n        /**\n         * Specifies whether or not the outer glow is ACTIVE in the layer.\n         */\n        this.outerGlow = true;\n        /**\n         * An event triggered when the highlight layer is being blurred.\n         */\n        this.onBeforeBlurObservable = new Observable();\n        /**\n         * An event triggered when the highlight layer has been blurred.\n         */\n        this.onAfterBlurObservable = new Observable();\n        this._instanceGlowingMeshStencilReference = HighlightLayer.GlowingMeshStencilReference++;\n        this._meshes = {};\n        this._excludedMeshes = {};\n        this.neutralColor = HighlightLayer.NeutralColor;\n        // Warn on stencil\n        if (!this._engine.isStencilEnable) {\n            Logger.Warn(\"Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }\");\n        }\n        // Adapt options\n        this._options = {\n            mainTextureRatio: 0.5,\n            blurTextureSizeRatio: 0.5,\n            blurHorizontalSize: 1.0,\n            blurVerticalSize: 1.0,\n            alphaBlendingMode: 2,\n            camera: null,\n            renderingGroupId: -1,\n            mainTextureType: 0,\n            ...options,\n        };\n        // Initialize the layer\n        this._init({\n            alphaBlendingMode: this._options.alphaBlendingMode,\n            camera: this._options.camera,\n            mainTextureFixedSize: this._options.mainTextureFixedSize,\n            mainTextureRatio: this._options.mainTextureRatio,\n            renderingGroupId: this._options.renderingGroupId,\n            mainTextureType: this._options.mainTextureType,\n        });\n        // Do not render as long as no meshes have been added\n        this._shouldRender = false;\n    }\n    /**\n     * Get the effect name of the layer.\n     * @returns The effect name\n     */\n    getEffectName() {\n        return HighlightLayer.EffectName;\n    }\n    _numInternalDraws() {\n        return 2; // we need two rendering, one for the inner glow and the other for the outer glow\n    }\n    /**\n     * Create the merge effect. This is the shader use to blit the information back\n     * to the main canvas at the end of the scene rendering.\n     */\n    _createMergeEffect() {\n        // Effect\n        return this._engine.createEffect(\"glowMapMerge\", [VertexBuffer.PositionKind], [\"offset\"], [\"textureSampler\"], this._options.isStroke ? \"#define STROKE \\n\" : undefined);\n    }\n    /**\n     * Creates the render target textures and post processes used in the highlight layer.\n     */\n    _createTextureAndPostProcesses() {\n        let blurTextureWidth = this._mainTextureDesiredSize.width * this._options.blurTextureSizeRatio;\n        let blurTextureHeight = this._mainTextureDesiredSize.height * this._options.blurTextureSizeRatio;\n        blurTextureWidth = this._engine.needPOTTextures ? Engine.GetExponentOfTwo(blurTextureWidth, this._maxSize) : blurTextureWidth;\n        blurTextureHeight = this._engine.needPOTTextures ? Engine.GetExponentOfTwo(blurTextureHeight, this._maxSize) : blurTextureHeight;\n        let textureType = 0;\n        if (this._engine.getCaps().textureHalfFloatRender) {\n            textureType = 2;\n        }\n        else {\n            textureType = 0;\n        }\n        this._blurTexture = new RenderTargetTexture(\"HighlightLayerBlurRTT\", {\n            width: blurTextureWidth,\n            height: blurTextureHeight,\n        }, this._scene, false, true, textureType);\n        this._blurTexture.wrapU = Texture.CLAMP_ADDRESSMODE;\n        this._blurTexture.wrapV = Texture.CLAMP_ADDRESSMODE;\n        this._blurTexture.anisotropicFilteringLevel = 16;\n        this._blurTexture.updateSamplingMode(Texture.TRILINEAR_SAMPLINGMODE);\n        this._blurTexture.renderParticles = false;\n        this._blurTexture.ignoreCameraViewport = true;\n        this._textures = [this._blurTexture];\n        if (this._options.alphaBlendingMode === 2) {\n            this._downSamplePostprocess = new PassPostProcess(\"HighlightLayerPPP\", this._options.blurTextureSizeRatio, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine());\n            this._downSamplePostprocess.externalTextureSamplerBinding = true;\n            this._downSamplePostprocess.onApplyObservable.add((effect) => {\n                effect.setTexture(\"textureSampler\", this._mainTexture);\n            });\n            this._horizontalBlurPostprocess = new GlowBlurPostProcess(\"HighlightLayerHBP\", new Vector2(1.0, 0), this._options.blurHorizontalSize, 1, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine());\n            this._horizontalBlurPostprocess.onApplyObservable.add((effect) => {\n                effect.setFloat2(\"screenSize\", blurTextureWidth, blurTextureHeight);\n            });\n            this._verticalBlurPostprocess = new GlowBlurPostProcess(\"HighlightLayerVBP\", new Vector2(0, 1.0), this._options.blurVerticalSize, 1, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine());\n            this._verticalBlurPostprocess.onApplyObservable.add((effect) => {\n                effect.setFloat2(\"screenSize\", blurTextureWidth, blurTextureHeight);\n            });\n            this._postProcesses = [this._downSamplePostprocess, this._horizontalBlurPostprocess, this._verticalBlurPostprocess];\n        }\n        else {\n            this._horizontalBlurPostprocess = new BlurPostProcess(\"HighlightLayerHBP\", new Vector2(1.0, 0), this._options.blurHorizontalSize / 2, {\n                width: blurTextureWidth,\n                height: blurTextureHeight,\n            }, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, textureType);\n            this._horizontalBlurPostprocess.width = blurTextureWidth;\n            this._horizontalBlurPostprocess.height = blurTextureHeight;\n            this._horizontalBlurPostprocess.externalTextureSamplerBinding = true;\n            this._horizontalBlurPostprocess.onApplyObservable.add((effect) => {\n                effect.setTexture(\"textureSampler\", this._mainTexture);\n            });\n            this._verticalBlurPostprocess = new BlurPostProcess(\"HighlightLayerVBP\", new Vector2(0, 1.0), this._options.blurVerticalSize / 2, {\n                width: blurTextureWidth,\n                height: blurTextureHeight,\n            }, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, textureType);\n            this._postProcesses = [this._horizontalBlurPostprocess, this._verticalBlurPostprocess];\n        }\n        this._mainTexture.onAfterUnbindObservable.add(() => {\n            this.onBeforeBlurObservable.notifyObservers(this);\n            const internalTexture = this._blurTexture.renderTarget;\n            if (internalTexture) {\n                this._scene.postProcessManager.directRender(this._postProcesses, internalTexture, true);\n                this._engine.unBindFramebuffer(internalTexture, true);\n            }\n            this.onAfterBlurObservable.notifyObservers(this);\n        });\n        // Prevent autoClear.\n        this._postProcesses.map((pp) => {\n            pp.autoClear = false;\n        });\n    }\n    /**\n     * Returns whether or not the layer needs stencil enabled during the mesh rendering.\n     */\n    needStencil() {\n        return true;\n    }\n    /**\n     * Checks for the readiness of the element composing the layer.\n     * @param subMesh the mesh to check for\n     * @param useInstances specify whether or not to use instances to render the mesh\n     * @returns true if ready otherwise, false\n     */\n    isReady(subMesh, useInstances) {\n        const material = subMesh.getMaterial();\n        const mesh = subMesh.getRenderingMesh();\n        if (!material || !mesh || !this._meshes) {\n            return false;\n        }\n        let emissiveTexture = null;\n        const highlightLayerMesh = this._meshes[mesh.uniqueId];\n        if (highlightLayerMesh && highlightLayerMesh.glowEmissiveOnly && material) {\n            emissiveTexture = material.emissiveTexture;\n        }\n        return super._isReady(subMesh, useInstances, emissiveTexture);\n    }\n    /**\n     * Implementation specific of rendering the generating effect on the main canvas.\n     * @param effect The effect used to render through\n     * @param renderIndex\n     */\n    _internalRender(effect, renderIndex) {\n        // Texture\n        effect.setTexture(\"textureSampler\", this._blurTexture);\n        // Cache\n        const engine = this._engine;\n        engine.cacheStencilState();\n        // Stencil operations\n        engine.setStencilOperationPass(7681);\n        engine.setStencilOperationFail(7680);\n        engine.setStencilOperationDepthFail(7680);\n        // Draw order\n        engine.setStencilMask(0x00);\n        engine.setStencilBuffer(true);\n        engine.setStencilFunctionReference(this._instanceGlowingMeshStencilReference);\n        // 2 passes inner outer\n        if (this.outerGlow && renderIndex === 0) {\n            // the outer glow is rendered the first time _internalRender is called, so when renderIndex == 0 (and only if outerGlow is enabled)\n            effect.setFloat(\"offset\", 0);\n            engine.setStencilFunction(517);\n            engine.drawElementsType(Material.TriangleFillMode, 0, 6);\n        }\n        if (this.innerGlow && renderIndex === 1) {\n            // the inner glow is rendered the second time _internalRender is called, so when renderIndex == 1 (and only if innerGlow is enabled)\n            effect.setFloat(\"offset\", 1);\n            engine.setStencilFunction(514);\n            engine.drawElementsType(Material.TriangleFillMode, 0, 6);\n        }\n        // Restore Cache\n        engine.restoreStencilState();\n    }\n    /**\n     * Returns true if the layer contains information to display, otherwise false.\n     */\n    shouldRender() {\n        if (super.shouldRender()) {\n            return this._meshes ? true : false;\n        }\n        return false;\n    }\n    /**\n     * Returns true if the mesh should render, otherwise false.\n     * @param mesh The mesh to render\n     * @returns true if it should render otherwise false\n     */\n    _shouldRenderMesh(mesh) {\n        // Excluded Mesh\n        if (this._excludedMeshes && this._excludedMeshes[mesh.uniqueId]) {\n            return false;\n        }\n        if (!super.hasMesh(mesh)) {\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Returns true if the mesh can be rendered, otherwise false.\n     * @param mesh The mesh to render\n     * @param material The material used on the mesh\n     * @returns true if it can be rendered otherwise false\n     */\n    _canRenderMesh(mesh, material) {\n        // all meshes can be rendered in the highlight layer, even transparent ones\n        return true;\n    }\n    /**\n     * Adds specific effects defines.\n     * @param defines The defines to add specifics to.\n     */\n    _addCustomEffectDefines(defines) {\n        defines.push(\"#define HIGHLIGHT\");\n    }\n    /**\n     * Sets the required values for both the emissive texture and and the main color.\n     * @param mesh\n     * @param subMesh\n     * @param material\n     */\n    _setEmissiveTextureAndColor(mesh, subMesh, material) {\n        const highlightLayerMesh = this._meshes[mesh.uniqueId];\n        if (highlightLayerMesh) {\n            this._emissiveTextureAndColor.color.set(highlightLayerMesh.color.r, highlightLayerMesh.color.g, highlightLayerMesh.color.b, 1.0);\n        }\n        else {\n            this._emissiveTextureAndColor.color.set(this.neutralColor.r, this.neutralColor.g, this.neutralColor.b, this.neutralColor.a);\n        }\n        if (highlightLayerMesh && highlightLayerMesh.glowEmissiveOnly && material) {\n            this._emissiveTextureAndColor.texture = material.emissiveTexture;\n            this._emissiveTextureAndColor.color.set(1.0, 1.0, 1.0, 1.0);\n        }\n        else {\n            this._emissiveTextureAndColor.texture = null;\n        }\n    }\n    /**\n     * Add a mesh in the exclusion list to prevent it to impact or being impacted by the highlight layer.\n     * @param mesh The mesh to exclude from the highlight layer\n     */\n    addExcludedMesh(mesh) {\n        if (!this._excludedMeshes) {\n            return;\n        }\n        const meshExcluded = this._excludedMeshes[mesh.uniqueId];\n        if (!meshExcluded) {\n            this._excludedMeshes[mesh.uniqueId] = {\n                mesh: mesh,\n                beforeBind: mesh.onBeforeBindObservable.add((mesh) => {\n                    mesh.getEngine().setStencilBuffer(false);\n                }),\n                afterRender: mesh.onAfterRenderObservable.add((mesh) => {\n                    mesh.getEngine().setStencilBuffer(true);\n                }),\n            };\n        }\n    }\n    /**\n     * Remove a mesh from the exclusion list to let it impact or being impacted by the highlight layer.\n     * @param mesh The mesh to highlight\n     */\n    removeExcludedMesh(mesh) {\n        if (!this._excludedMeshes) {\n            return;\n        }\n        const meshExcluded = this._excludedMeshes[mesh.uniqueId];\n        if (meshExcluded) {\n            if (meshExcluded.beforeBind) {\n                mesh.onBeforeBindObservable.remove(meshExcluded.beforeBind);\n            }\n            if (meshExcluded.afterRender) {\n                mesh.onAfterRenderObservable.remove(meshExcluded.afterRender);\n            }\n        }\n        this._excludedMeshes[mesh.uniqueId] = null;\n    }\n    /**\n     * Determine if a given mesh will be highlighted by the current HighlightLayer\n     * @param mesh mesh to test\n     * @returns true if the mesh will be highlighted by the current HighlightLayer\n     */\n    hasMesh(mesh) {\n        if (!this._meshes) {\n            return false;\n        }\n        if (!super.hasMesh(mesh)) {\n            return false;\n        }\n        return this._meshes[mesh.uniqueId] !== undefined && this._meshes[mesh.uniqueId] !== null;\n    }\n    /**\n     * Add a mesh in the highlight layer in order to make it glow with the chosen color.\n     * @param mesh The mesh to highlight\n     * @param color The color of the highlight\n     * @param glowEmissiveOnly Extract the glow from the emissive texture\n     */\n    addMesh(mesh, color, glowEmissiveOnly = false) {\n        if (!this._meshes) {\n            return;\n        }\n        const meshHighlight = this._meshes[mesh.uniqueId];\n        if (meshHighlight) {\n            meshHighlight.color = color;\n        }\n        else {\n            this._meshes[mesh.uniqueId] = {\n                mesh: mesh,\n                color: color,\n                // Lambda required for capture due to Observable this context\n                observerHighlight: mesh.onBeforeBindObservable.add((mesh) => {\n                    if (this.isEnabled) {\n                        if (this._excludedMeshes && this._excludedMeshes[mesh.uniqueId]) {\n                            this._defaultStencilReference(mesh);\n                        }\n                        else {\n                            mesh.getScene().getEngine().setStencilFunctionReference(this._instanceGlowingMeshStencilReference);\n                        }\n                    }\n                }),\n                observerDefault: mesh.onAfterRenderObservable.add((mesh) => {\n                    if (this.isEnabled) {\n                        this._defaultStencilReference(mesh);\n                    }\n                }),\n                glowEmissiveOnly: glowEmissiveOnly,\n            };\n            mesh.onDisposeObservable.add(() => {\n                this._disposeMesh(mesh);\n            });\n        }\n        this._shouldRender = true;\n    }\n    /**\n     * Remove a mesh from the highlight layer in order to make it stop glowing.\n     * @param mesh The mesh to highlight\n     */\n    removeMesh(mesh) {\n        if (!this._meshes) {\n            return;\n        }\n        const meshHighlight = this._meshes[mesh.uniqueId];\n        if (meshHighlight) {\n            if (meshHighlight.observerHighlight) {\n                mesh.onBeforeBindObservable.remove(meshHighlight.observerHighlight);\n            }\n            if (meshHighlight.observerDefault) {\n                mesh.onAfterRenderObservable.remove(meshHighlight.observerDefault);\n            }\n            delete this._meshes[mesh.uniqueId];\n        }\n        this._shouldRender = false;\n        for (const meshHighlightToCheck in this._meshes) {\n            if (this._meshes[meshHighlightToCheck]) {\n                this._shouldRender = true;\n                break;\n            }\n        }\n    }\n    /**\n     * Remove all the meshes currently referenced in the highlight layer\n     */\n    removeAllMeshes() {\n        if (!this._meshes) {\n            return;\n        }\n        for (const uniqueId in this._meshes) {\n            if (Object.prototype.hasOwnProperty.call(this._meshes, uniqueId)) {\n                const mesh = this._meshes[uniqueId];\n                if (mesh) {\n                    this.removeMesh(mesh.mesh);\n                }\n            }\n        }\n    }\n    /**\n     * Force the stencil to the normal expected value for none glowing parts\n     * @param mesh\n     */\n    _defaultStencilReference(mesh) {\n        mesh.getScene().getEngine().setStencilFunctionReference(HighlightLayer.NormalMeshStencilReference);\n    }\n    /**\n     * Free any resources and references associated to a mesh.\n     * Internal use\n     * @param mesh The mesh to free.\n     * @internal\n     */\n    _disposeMesh(mesh) {\n        this.removeMesh(mesh);\n        this.removeExcludedMesh(mesh);\n    }\n    /**\n     * Dispose the highlight layer and free resources.\n     */\n    dispose() {\n        if (this._meshes) {\n            // Clean mesh references\n            for (const id in this._meshes) {\n                const meshHighlight = this._meshes[id];\n                if (meshHighlight && meshHighlight.mesh) {\n                    if (meshHighlight.observerHighlight) {\n                        meshHighlight.mesh.onBeforeBindObservable.remove(meshHighlight.observerHighlight);\n                    }\n                    if (meshHighlight.observerDefault) {\n                        meshHighlight.mesh.onAfterRenderObservable.remove(meshHighlight.observerDefault);\n                    }\n                }\n            }\n            this._meshes = null;\n        }\n        if (this._excludedMeshes) {\n            for (const id in this._excludedMeshes) {\n                const meshHighlight = this._excludedMeshes[id];\n                if (meshHighlight) {\n                    if (meshHighlight.beforeBind) {\n                        meshHighlight.mesh.onBeforeBindObservable.remove(meshHighlight.beforeBind);\n                    }\n                    if (meshHighlight.afterRender) {\n                        meshHighlight.mesh.onAfterRenderObservable.remove(meshHighlight.afterRender);\n                    }\n                }\n            }\n            this._excludedMeshes = null;\n        }\n        super.dispose();\n    }\n    /**\n     * Gets the class name of the effect layer\n     * @returns the string with the class name of the effect layer\n     */\n    getClassName() {\n        return \"HighlightLayer\";\n    }\n    /**\n     * Serializes this Highlight layer\n     * @returns a serialized Highlight layer object\n     */\n    serialize() {\n        const serializationObject = SerializationHelper.Serialize(this);\n        serializationObject.customType = \"BABYLON.HighlightLayer\";\n        // Highlighted meshes\n        serializationObject.meshes = [];\n        if (this._meshes) {\n            for (const m in this._meshes) {\n                const mesh = this._meshes[m];\n                if (mesh) {\n                    serializationObject.meshes.push({\n                        glowEmissiveOnly: mesh.glowEmissiveOnly,\n                        color: mesh.color.asArray(),\n                        meshId: mesh.mesh.id,\n                    });\n                }\n            }\n        }\n        // Excluded meshes\n        serializationObject.excludedMeshes = [];\n        if (this._excludedMeshes) {\n            for (const e in this._excludedMeshes) {\n                const excludedMesh = this._excludedMeshes[e];\n                if (excludedMesh) {\n                    serializationObject.excludedMeshes.push(excludedMesh.mesh.id);\n                }\n            }\n        }\n        return serializationObject;\n    }\n    /**\n     * Creates a Highlight layer from parsed Highlight layer data\n     * @param parsedHightlightLayer defines the Highlight layer data\n     * @param scene defines the current scene\n     * @param rootUrl defines the root URL containing the Highlight layer information\n     * @returns a parsed Highlight layer\n     */\n    static Parse(parsedHightlightLayer, scene, rootUrl) {\n        const hl = SerializationHelper.Parse(() => new HighlightLayer(parsedHightlightLayer.name, scene, parsedHightlightLayer.options), parsedHightlightLayer, scene, rootUrl);\n        let index;\n        // Excluded meshes\n        for (index = 0; index < parsedHightlightLayer.excludedMeshes.length; index++) {\n            const mesh = scene.getMeshById(parsedHightlightLayer.excludedMeshes[index]);\n            if (mesh) {\n                hl.addExcludedMesh(mesh);\n            }\n        }\n        // Included meshes\n        for (index = 0; index < parsedHightlightLayer.meshes.length; index++) {\n            const highlightedMesh = parsedHightlightLayer.meshes[index];\n            const mesh = scene.getMeshById(highlightedMesh.meshId);\n            if (mesh) {\n                hl.addMesh(mesh, Color3.FromArray(highlightedMesh.color), highlightedMesh.glowEmissiveOnly);\n            }\n        }\n        return hl;\n    }\n}\n/**\n * Effect Name of the highlight layer.\n */\nHighlightLayer.EffectName = \"HighlightLayer\";\n/**\n * The neutral color used during the preparation of the glow effect.\n * This is black by default as the blend operation is a blend operation.\n */\nHighlightLayer.NeutralColor = new Color4(0, 0, 0, 0);\n/**\n * Stencil value used for glowing meshes.\n */\nHighlightLayer.GlowingMeshStencilReference = 0x02;\n/**\n * Stencil value used for the other meshes in the scene.\n */\nHighlightLayer.NormalMeshStencilReference = 0x01;\n__decorate([\n    serialize()\n], HighlightLayer.prototype, \"innerGlow\", void 0);\n__decorate([\n    serialize()\n], HighlightLayer.prototype, \"outerGlow\", void 0);\n__decorate([\n    serialize()\n], HighlightLayer.prototype, \"blurHorizontalSize\", null);\n__decorate([\n    serialize()\n], HighlightLayer.prototype, \"blurVerticalSize\", null);\n__decorate([\n    serialize(\"options\")\n], HighlightLayer.prototype, \"_options\", void 0);\nRegisterClass(\"BABYLON.HighlightLayer\", HighlightLayer);\n//# sourceMappingURL=highlightLayer.js.map","import { Observable } from \"../Misc/observable.js\";\nimport { Vector2 } from \"../Maths/math.vector.js\";\nimport { Color4 } from \"../Maths/math.color.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { Material } from \"../Materials/material.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nimport { SceneComponentConstants } from \"../sceneComponent.js\";\nimport { LayerSceneComponent } from \"./layerSceneComponent.js\";\n\nimport { DrawWrapper } from \"../Materials/drawWrapper.js\";\nimport \"../Shaders/layer.fragment.js\";\nimport \"../Shaders/layer.vertex.js\";\n/**\n * This represents a full screen 2d layer.\n * This can be useful to display a picture in the  background of your scene for instance.\n * @see https://www.babylonjs-playground.com/#08A2BS#1\n */\nexport class Layer {\n    /**\n     * Determines if the layer is drawn before (true) or after (false) post-processing.\n     * If the layer is background, it is always before.\n     */\n    set applyPostProcess(value) {\n        this._applyPostProcess = value;\n    }\n    get applyPostProcess() {\n        return this.isBackground || this._applyPostProcess;\n    }\n    /**\n     * Back compatibility with callback before the onDisposeObservable existed.\n     * The set callback will be triggered when the layer has been disposed.\n     */\n    set onDispose(callback) {\n        if (this._onDisposeObserver) {\n            this.onDisposeObservable.remove(this._onDisposeObserver);\n        }\n        this._onDisposeObserver = this.onDisposeObservable.add(callback);\n    }\n    /**\n     * Back compatibility with callback before the onBeforeRenderObservable existed.\n     * The set callback will be triggered just before rendering the layer.\n     */\n    set onBeforeRender(callback) {\n        if (this._onBeforeRenderObserver) {\n            this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);\n        }\n        this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(callback);\n    }\n    /**\n     * Back compatibility with callback before the onAfterRenderObservable existed.\n     * The set callback will be triggered just after rendering the layer.\n     */\n    set onAfterRender(callback) {\n        if (this._onAfterRenderObserver) {\n            this.onAfterRenderObservable.remove(this._onAfterRenderObserver);\n        }\n        this._onAfterRenderObserver = this.onAfterRenderObservable.add(callback);\n    }\n    /**\n     * Instantiates a new layer.\n     * This represents a full screen 2d layer.\n     * This can be useful to display a picture in the  background of your scene for instance.\n     * @see https://www.babylonjs-playground.com/#08A2BS#1\n     * @param name Define the name of the layer in the scene\n     * @param imgUrl Define the url of the texture to display in the layer\n     * @param scene Define the scene the layer belongs to\n     * @param isBackground Defines whether the layer is displayed in front or behind the scene\n     * @param color Defines a color for the layer\n     */\n    constructor(\n    /**\n     * Define the name of the layer.\n     */\n    name, imgUrl, scene, isBackground, color) {\n        this.name = name;\n        this._applyPostProcess = true;\n        /**\n         * Define the scale of the layer in order to zoom in out of the texture.\n         */\n        this.scale = new Vector2(1, 1);\n        /**\n         * Define an offset for the layer in order to shift the texture.\n         */\n        this.offset = new Vector2(0, 0);\n        /**\n         * Define the alpha blending mode used in the layer in case the texture or color has an alpha.\n         */\n        this.alphaBlendingMode = 2;\n        /**\n         * Define a mask to restrict the layer to only some of the scene cameras.\n         */\n        this.layerMask = 0x0fffffff;\n        /**\n         * Define the list of render target the layer is visible into.\n         */\n        this.renderTargetTextures = [];\n        /**\n         * Define if the layer is only used in renderTarget or if it also\n         * renders in the main frame buffer of the canvas.\n         */\n        this.renderOnlyInRenderTargetTextures = false;\n        /**\n         * Define if the layer is enabled (ie. should be displayed). Default: true\n         */\n        this.isEnabled = true;\n        this._vertexBuffers = {};\n        /**\n         * An event triggered when the layer is disposed.\n         */\n        this.onDisposeObservable = new Observable();\n        /**\n         * An event triggered before rendering the scene\n         */\n        this.onBeforeRenderObservable = new Observable();\n        /**\n         * An event triggered after rendering the scene\n         */\n        this.onAfterRenderObservable = new Observable();\n        this.texture = imgUrl ? new Texture(imgUrl, scene, true) : null;\n        this.isBackground = isBackground === undefined ? true : isBackground;\n        this.color = color === undefined ? new Color4(1, 1, 1, 1) : color;\n        this._scene = (scene || EngineStore.LastCreatedScene);\n        let layerComponent = this._scene._getComponent(SceneComponentConstants.NAME_LAYER);\n        if (!layerComponent) {\n            layerComponent = new LayerSceneComponent(this._scene);\n            this._scene._addComponent(layerComponent);\n        }\n        this._scene.layers.push(this);\n        const engine = this._scene.getEngine();\n        this._drawWrapper = new DrawWrapper(engine);\n        // VBO\n        const vertices = [];\n        vertices.push(1, 1);\n        vertices.push(-1, 1);\n        vertices.push(-1, -1);\n        vertices.push(1, -1);\n        const vertexBuffer = new VertexBuffer(engine, vertices, VertexBuffer.PositionKind, false, false, 2);\n        this._vertexBuffers[VertexBuffer.PositionKind] = vertexBuffer;\n        this._createIndexBuffer();\n    }\n    _createIndexBuffer() {\n        const engine = this._scene.getEngine();\n        // Indices\n        const indices = [];\n        indices.push(0);\n        indices.push(1);\n        indices.push(2);\n        indices.push(0);\n        indices.push(2);\n        indices.push(3);\n        this._indexBuffer = engine.createIndexBuffer(indices);\n    }\n    /** @internal */\n    _rebuild() {\n        const vb = this._vertexBuffers[VertexBuffer.PositionKind];\n        if (vb) {\n            vb._rebuild();\n        }\n        this._createIndexBuffer();\n    }\n    /**\n     * Renders the layer in the scene.\n     */\n    render() {\n        if (!this.isEnabled) {\n            return;\n        }\n        const engine = this._scene.getEngine();\n        let defines = \"\";\n        if (this.alphaTest) {\n            defines = \"#define ALPHATEST\";\n        }\n        if (this.texture && !this.texture.gammaSpace) {\n            defines += \"\\r\\n#define LINEAR\";\n        }\n        if (this._previousDefines !== defines) {\n            this._previousDefines = defines;\n            this._drawWrapper.effect = engine.createEffect(\"layer\", [VertexBuffer.PositionKind], [\"textureMatrix\", \"color\", \"scale\", \"offset\"], [\"textureSampler\"], defines);\n        }\n        const currentEffect = this._drawWrapper.effect;\n        // Check\n        if (!currentEffect || !currentEffect.isReady() || !this.texture || !this.texture.isReady()) {\n            return;\n        }\n        this.onBeforeRenderObservable.notifyObservers(this);\n        // Render\n        engine.enableEffect(this._drawWrapper);\n        engine.setState(false);\n        // Texture\n        currentEffect.setTexture(\"textureSampler\", this.texture);\n        currentEffect.setMatrix(\"textureMatrix\", this.texture.getTextureMatrix());\n        // Color\n        currentEffect.setFloat4(\"color\", this.color.r, this.color.g, this.color.b, this.color.a);\n        // Scale / offset\n        currentEffect.setVector2(\"offset\", this.offset);\n        currentEffect.setVector2(\"scale\", this.scale);\n        // VBOs\n        engine.bindBuffers(this._vertexBuffers, this._indexBuffer, currentEffect);\n        // Draw order\n        if (!this.alphaTest) {\n            engine.setAlphaMode(this.alphaBlendingMode);\n            engine.drawElementsType(Material.TriangleFillMode, 0, 6);\n            engine.setAlphaMode(0);\n        }\n        else {\n            engine.drawElementsType(Material.TriangleFillMode, 0, 6);\n        }\n        this.onAfterRenderObservable.notifyObservers(this);\n    }\n    /**\n     * Disposes and releases the associated resources.\n     */\n    dispose() {\n        const vertexBuffer = this._vertexBuffers[VertexBuffer.PositionKind];\n        if (vertexBuffer) {\n            vertexBuffer.dispose();\n            this._vertexBuffers[VertexBuffer.PositionKind] = null;\n        }\n        if (this._indexBuffer) {\n            this._scene.getEngine()._releaseBuffer(this._indexBuffer);\n            this._indexBuffer = null;\n        }\n        if (this.texture) {\n            this.texture.dispose();\n            this.texture = null;\n        }\n        // Clean RTT list\n        this.renderTargetTextures = [];\n        // Remove from scene\n        const index = this._scene.layers.indexOf(this);\n        this._scene.layers.splice(index, 1);\n        // Callback\n        this.onDisposeObservable.notifyObservers(this);\n        this.onDisposeObservable.clear();\n        this.onAfterRenderObservable.clear();\n        this.onBeforeRenderObservable.clear();\n    }\n}\n//# sourceMappingURL=layer.js.map","import { SceneComponentConstants } from \"../sceneComponent.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\n/**\n * Defines the layer scene component responsible to manage any layers\n * in a given scene.\n */\nexport class LayerSceneComponent {\n    /**\n     * Creates a new instance of the component for the given scene\n     * @param scene Defines the scene to register the component in\n     */\n    constructor(scene) {\n        /**\n         * The component name helpful to identify the component in the list of scene components.\n         */\n        this.name = SceneComponentConstants.NAME_LAYER;\n        this.scene = scene || EngineStore.LastCreatedScene;\n        if (!this.scene) {\n            return;\n        }\n        this._engine = this.scene.getEngine();\n        this.scene.layers = new Array();\n    }\n    /**\n     * Registers the component in a given scene\n     */\n    register() {\n        this.scene._beforeCameraDrawStage.registerStep(SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER, this, this._drawCameraBackground);\n        this.scene._afterCameraDrawStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER, this, this._drawCameraForegroundWithPostProcessing);\n        this.scene._afterCameraPostProcessStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERAPOSTPROCESS_LAYER, this, this._drawCameraForegroundWithoutPostProcessing);\n        this.scene._beforeRenderTargetDrawStage.registerStep(SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_LAYER, this, this._drawRenderTargetBackground);\n        this.scene._afterRenderTargetDrawStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERTARGETDRAW_LAYER, this, this._drawRenderTargetForegroundWithPostProcessing);\n        this.scene._afterRenderTargetPostProcessStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER, this, this._drawRenderTargetForegroundWithoutPostProcessing);\n    }\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    rebuild() {\n        const layers = this.scene.layers;\n        for (const layer of layers) {\n            layer._rebuild();\n        }\n    }\n    /**\n     * Disposes the component and the associated resources.\n     */\n    dispose() {\n        const layers = this.scene.layers;\n        while (layers.length) {\n            layers[0].dispose();\n        }\n    }\n    _draw(predicate) {\n        const layers = this.scene.layers;\n        if (layers.length) {\n            this._engine.setDepthBuffer(false);\n            for (const layer of layers) {\n                if (predicate(layer)) {\n                    layer.render();\n                }\n            }\n            this._engine.setDepthBuffer(true);\n        }\n    }\n    _drawCameraPredicate(layer, isBackground, applyPostProcess, cameraLayerMask) {\n        return (!layer.renderOnlyInRenderTargetTextures &&\n            layer.isBackground === isBackground &&\n            layer.applyPostProcess === applyPostProcess &&\n            (layer.layerMask & cameraLayerMask) !== 0);\n    }\n    _drawCameraBackground(camera) {\n        this._draw((layer) => {\n            return this._drawCameraPredicate(layer, true, true, camera.layerMask);\n        });\n    }\n    _drawCameraForegroundWithPostProcessing(camera) {\n        this._draw((layer) => {\n            return this._drawCameraPredicate(layer, false, true, camera.layerMask);\n        });\n    }\n    _drawCameraForegroundWithoutPostProcessing(camera) {\n        this._draw((layer) => {\n            return this._drawCameraPredicate(layer, false, false, camera.layerMask);\n        });\n    }\n    _drawRenderTargetPredicate(layer, isBackground, applyPostProcess, cameraLayerMask, renderTargetTexture) {\n        return (layer.renderTargetTextures.length > 0 &&\n            layer.isBackground === isBackground &&\n            layer.applyPostProcess === applyPostProcess &&\n            layer.renderTargetTextures.indexOf(renderTargetTexture) > -1 &&\n            (layer.layerMask & cameraLayerMask) !== 0);\n    }\n    _drawRenderTargetBackground(renderTarget) {\n        this._draw((layer) => {\n            return this._drawRenderTargetPredicate(layer, true, true, this.scene.activeCamera.layerMask, renderTarget);\n        });\n    }\n    _drawRenderTargetForegroundWithPostProcessing(renderTarget) {\n        this._draw((layer) => {\n            return this._drawRenderTargetPredicate(layer, false, true, this.scene.activeCamera.layerMask, renderTarget);\n        });\n    }\n    _drawRenderTargetForegroundWithoutPostProcessing(renderTarget) {\n        this._draw((layer) => {\n            return this._drawRenderTargetPredicate(layer, false, false, this.scene.activeCamera.layerMask, renderTarget);\n        });\n    }\n    /**\n     * Adds all the elements from the container to the scene\n     * @param container the container holding the elements\n     */\n    addFromContainer(container) {\n        if (!container.layers) {\n            return;\n        }\n        container.layers.forEach((layer) => {\n            this.scene.layers.push(layer);\n        });\n    }\n    /**\n     * Removes all the elements in the container from the scene\n     * @param container contains the elements to remove\n     * @param dispose if the removed element should be disposed (default: false)\n     */\n    removeFromContainer(container, dispose = false) {\n        if (!container.layers) {\n            return;\n        }\n        container.layers.forEach((layer) => {\n            const index = this.scene.layers.indexOf(layer);\n            if (index !== -1) {\n                this.scene.layers.splice(index, 1);\n            }\n            if (dispose) {\n                layer.dispose();\n            }\n        });\n    }\n}\n//# sourceMappingURL=layerSceneComponent.js.map"],"names":["onNativeObjectInitialized","self","Object","prototype","hasOwnProperty","call","__native","defineProperty","get","set","value","notifyObservers","async","RegisterNativeTypeAsync","typeName","constructor","Promise","resolve","_native","addOnce","nativeObject","NativeDataBuffer","CommandBufferEncoder","_engine","this","_pending","Array","_isCommandBufferScopeActive","_commandStream","NativeEngine","_createNativeDataStream","setCommandDataStream","beginCommandScope","Error","endCommandScope","_submit","startEncodingCommand","command","writeNativeData","encodeCommandArgAsUInt32","commandArg","writeUint32","encodeCommandArgAsUInt32s","writeUint32Array","encodeCommandArgAsInt32","writeInt32","encodeCommandArgAsInt32s","writeInt32Array","encodeCommandArgAsFloat32","writeFloat32","encodeCommandArgAsFloat32s","writeFloat32Array","encodeCommandArgAsNativeData","push","finishEncodingCommand","submitCommands","length","getHardwareScalingLevel","setHardwareScalingLevel","level","options","super","undefined","adaptToDeviceRatio","Engine","_camera","Camera","_commandBufferEncoder","_boundBuffersVertexArray","_currentDepthTest","DEPTH_TEST_LEQUAL","_stencilTest","_stencilMask","_stencilFunc","_stencilFuncRef","_stencilFuncMask","_stencilOpStencilFail","_stencilOpDepthFail","_stencilOpStencilDepthPass","_zOffset","_zOffsetUnits","_depthWrite","PROTOCOL_VERSION","_webGLVersion","disableUniformBuffers","_shaderPlatformName","_caps","maxTexturesImageUnits","maxVertexTextureImageUnits","maxCombinedTexturesImageUnits","maxTextureSize","CAPS_LIMITS_MAX_TEXTURE_SIZE","maxCubemapTextureSize","maxRenderTextureSize","maxVertexAttribs","maxVaryingVectors","maxFragmentUniformVectors","maxVertexUniformVectors","standardDerivatives","astc","pvrtc","etc1","etc2","bptc","maxAnisotropy","uintIndices","fragmentDepthSupported","highPrecisionShaderSupported","colorBufferFloat","textureFloat","textureFloatLinearFiltering","textureFloatRender","textureHalfFloat","textureHalfFloatLinearFiltering","textureHalfFloatRender","textureLOD","drawBuffersExtension","depthTextureExtension","vertexArrayObject","instancedArrays","supportOcclusionQuery","canUseTimestampForTimerQuery","blendMinMax","maxMSAASamples","canUseGLInstanceID","canUseGLVertexID","supportComputeShaders","supportSRGBBuffers","supportTransformFeedbacks","textureMaxLevel","texture2DArrayMaxLayerCount","CAPS_LIMITS_MAX_TEXTURE_LAYERS","_features","forceBitmapOverHTMLImageElement","supportRenderAndCopyToLodForFloatTextures","supportDepthStencilTexture","supportShadowSamplers","uniformBufferHardCheckMatrix","allowTexturePrefiltering","trackUbosInFrame","checkUbosContentBeforeUpload","supportCSM","basisNeedsPOT","support3DTextures","needTypeSuffixInShaderConstants","supportMSAA","supportSSAO2","supportExtendedTextureFormats","supportSwitchCaseInShader","supportSyncTextureRead","needsInvertingBitmap","useUBOBindingCache","needShaderCodeInlining","needToAlwaysBindUniformBuffers","supportRenderPasses","supportSpriteInstancing","_collectUbosUpdatedInFrame","scriptUrl","onSuccess","onError","scriptId","data","Function","apply","request","exception","URL","window","createObjectURL","revokeObjectURL","Blob","v","flat","configurable","depth","isNaN","arguments","Number","reduce","acc","cur","isArray","slice","writable","devicePixelRatio","_hardwareScalingLevel","resize","currentDepthFunction","getDepthFunction","setDepthFunction","_shaderProcessor","onNewSceneAddedObservable","add","scene","originalRender","render","args","dispose","_deleteVertexArray","static","_queueNewFrame","bindedRenderFunction","requester","requestAnimationFrame","_bindUnboundFramebuffer","framebuffer","_currentFramebuffer","COMMAND_UNBINDFRAMEBUFFER","COMMAND_BINDFRAMEBUFFER","getHostDocument","clear","color","backBuffer","stencil","useReverseDepthBuffer","COMMAND_CLEAR","r","g","b","a","createIndexBuffer","indices","updateable","_normalizeIndexData","buffer","references","is32Bits","BYTES_PER_ELEMENT","byteLength","nativeIndexBuffer","byteOffset","createVertexBuffer","vertices","ArrayBuffer","isView","Float32Array","nativeVertexBuffer","_recordVertexArrayObject","vertexArray","vertexBuffers","indexBuffer","effect","overrideVertexBuffers","recordIndexBuffer","attributes","getAttributesNames","index","location","getAttributeLocation","kind","vertexBuffer","getBuffer","recordVertexBuffer","byteStride","getSize","_getNativeAttribType","type","normalized","getInstanceDivisor","bindBuffers","createVertexArray","bindVertexArrayObject","recordVertexArrayObject","COMMAND_DELETEVERTEXARRAY","COMMAND_BINDVERTEXARRAY","releaseVertexArrayObject","getAttributes","pipelineContext","attributesNames","nativePipelineContext","nativeProgram","drawElementsType","fillMode","indexStart","indexCount","instancesCount","_drawCalls","addCount","COMMAND_DRAWINDEXED","drawArraysType","verticesStart","verticesCount","COMMAND_DRAW","createPipelineContext","createMaterialContext","createDrawContext","_preparePipelineContext","vertexSourceCode","fragmentSourceCode","createAsRaw","_rawVertexSourceCode","_rawFragmentSourceCode","_rebuildRebind","defines","createRawShaderProgram","createShaderProgram","_isRenderingStateCompiled","_executeWhenRenderingStateIsCompiled","action","_pipelineContext","vertexCode","fragmentCode","onBeforeShaderCompilationObservable","vertexInliner","processCode","code","fragmentInliner","program","createProgram","onAfterShaderCompilationObservable","inlineShaderCode","sci","debug","_setProgram","_currentProgram","COMMAND_SETPROGRAM","_deletePipelineContext","COMMAND_DELETEPROGRAM","getUniforms","uniformsNames","bindUniformBlock","blockName","bindSamplers","getPipelineContext","samplers","getSamplers","uniform","getUniform","_boundUniforms","_currentEffect","getRenderWidth","useScreen","_currentRenderTarget","width","getRenderHeight","height","setViewport","viewport","requiredWidth","requiredHeight","_cachedViewport","COMMAND_SETVIEWPORT","x","y","setState","culling","zOffset","force","reverseSide","cullBackFaces","zOffsetUnits","_a","_b","COMMAND_SETSTATE","getInputElementClientRect","bottom","left","right","top","toJSON","setZOffset","COMMAND_SETZOFFSET","getZOffset","setZOffsetUnits","COMMAND_SETZOFFSETUNITS","getZOffsetUnits","setDepthBuffer","enable","COMMAND_SETDEPTHTEST","DEPTH_TEST_ALWAYS","getDepthWrite","DEPTH_TEST_NEVER","DEPTH_TEST_GREATER","DEPTH_TEST_GEQUAL","DEPTH_TEST_NOTEQUAL","DEPTH_TEST_EQUAL","DEPTH_TEST_LESS","depthFunc","nativeDepthFunc","setDepthWrite","COMMAND_SETDEPTHWRITE","setColorWrite","_colorWrite","COMMAND_SETCOLORWRITE","getColorWrite","applyStencil","_setStencil","_getStencilOpFail","_getStencilDepthFail","_getStencilDepthPass","_getStencilFunc","mask","stencilOpFail","depthOpFail","depthOpPass","func","ref","COMMAND_SETSTENCIL","setStencilBuffer","STENCIL_OP_FAIL_S_KEEP","STENCIL_OP_FAIL_Z_KEEP","STENCIL_OP_PASS_Z_KEEP","STENCIL_TEST_ALWAYS","getStencilBuffer","getStencilOperationPass","setStencilOperationPass","operation","setStencilMask","setStencilFunction","stencilFunc","setStencilFunctionReference","reference","setStencilFunctionMask","setStencilOperationFail","setStencilOperationDepthFail","getStencilMask","getStencilFunction","getStencilFunctionReference","getStencilFunctionMask","getStencilOperationFail","getStencilOperationDepthFail","setAlphaConstants","setAlphaMode","mode","noDepthWriteChange","_alphaMode","nativeMode","_getNativeAlphaMode","COMMAND_SETBLENDMODE","getAlphaMode","setInt","int","COMMAND_SETINT","setIntArray","array","COMMAND_SETINTARRAY","setIntArray2","COMMAND_SETINTARRAY2","setIntArray3","COMMAND_SETINTARRAY3","setIntArray4","COMMAND_SETINTARRAY4","setFloatArray","COMMAND_SETFLOATARRAY","setFloatArray2","COMMAND_SETFLOATARRAY2","setFloatArray3","COMMAND_SETFLOATARRAY3","setFloatArray4","COMMAND_SETFLOATARRAY4","setArray","setArray2","setArray3","setArray4","setMatrices","matrices","COMMAND_SETMATRICES","setMatrix3x3","matrix","COMMAND_SETMATRIX3X3","setMatrix2x2","COMMAND_SETMATRIX2X2","setFloat","COMMAND_SETFLOAT","setFloat2","COMMAND_SETFLOAT2","setFloat3","z","COMMAND_SETFLOAT3","setFloat4","w","COMMAND_SETFLOAT4","setColor3","color3","setColor4","alpha","wipeCaches","bruteForce","preventCacheWipeBetweenFrames","resetTextureCache","_stencilStateComposer","reset","_depthCullingState","_alphaState","_cachedVertexBuffers","_cachedIndexBuffer","_cachedEffectForVertexBuffers","_createTexture","createTexture","_deleteTexture","texture","deleteTexture","updateDynamicTexture","canvas","invertY","premulAlpha","format","_hardwareTexture","source","getCanvasTexture","destination","underlyingResource","copyTexture","isReady","createDynamicTexture","generateMipMaps","samplingMode","Math","max","createRawTexture","Uint8Array","createVideoElement","constraints","createVideo","updateVideoTexture","video","webGLTexture","compression","creationFlags","useSRGBBuffer","baseWidth","baseHeight","_compression","_useSRGBBuffer","_getUseSRGBBuffer","updateRawTexture","filter","_getNativeSamplingMode","_setTextureSampling","_internalTexturesCache","createRawTexture2DArray","textureType","baseDepth","is2DArray","nativeTexture","loadRawTexture2DArray","_getNativeTextureFormat","bufferView","loadRawTexture","url","noMipmap","onLoad","fallback","forcedExtension","mimeType","loaderOptions","fromData","substr","isBase64","indexOf","originalUrl","_transformTextureUrl","lastDot","lastIndexOf","extension","substring","toLowerCase","loader","availableLoader","canLoad","addPendingData","doNotHandleContextLost","_buffer","onLoadObserver","onLoadedObservable","onInternalError","message","removePendingData","remove","onload","loadTexture","getTextureWidth","getTextureHeight","_loadFile","responseURL","wrapNativeTexture","hardwareTexture","internalTexture","wrapWebGLTexture","_createDepthStencilTexture","size","rtWrapper","nativeRTWrapper","createFrameBuffer","_framebufferDepthStencil","_releaseFramebufferObjects","COMMAND_DELETEFRAMEBUFFER","_createImageBitmapFromSource","imageSource","reject","image","createCanvasImage","imageBitmap","createImageBitmap","error","src","onerror","arr","resizeImageBitmap","bufferWidth","bufferHeight","createCubeTexture","rootUrl","files","createPolynomials","lodScale","lodOffset","isCube","_lodGenerationScale","_lodGenerationOffset","_doNotHandleContextLost","_extension","_files","onloaddata","info","specularInfo","specular","lodGenerationScale","imageData","getEngine","updateTextureSamplingMode","_isRGBD","loadCubeTextureWithMips","status","statusText","reorderedFiles","all","map","file","then","loadCubeTexture","_createHardwareTexture","_createHardwareRenderTargetWrapper","isMulti","_renderTargetWrapperCache","_createInternalTexture","_delayGPUTextureCreation","samples","webGLVersion","isWebGPU","layers","nativeTextureFormat","initializeTexture","createRenderTargetTexture","colorAttachment","generateDepthBuffer","generateStencilBuffer","noColorAttachment","_framebuffer","_generateDepthBuffer","_generateStencilBuffer","setTextures","bindFramebuffer","faceIndex","forceFullscreenViewport","unBindFramebuffer","disableGenerateMipMaps","onBeforeUnbind","createDynamicVertexBuffer","updateDynamicIndexBuffer","offset","updateDynamicVertexBuffer","verticies","_setTexture","channel","isPartOfTextureArray","depthStencilTexture","_boundTexturesCache","_activeChannel","update","delayLoadState","delayLoad","getInternalTexture","emptyCubeTexture","is3D","emptyTexture3D","emptyTexture2DArray","emptyTexture","_setTextureWrapMode","_getAddressMode","wrapU","wrapV","wrapR","_updateAnisotropicLevel","_setTextureCore","COMMAND_SETTEXTURESAMPLING","addressModeU","addressModeV","addressModeW","COMMAND_SETTEXTUREWRAPMODE","COMMAND_SETTEXTURE","anisotropicFilteringLevel","_cachedAnisotropicFilteringLevel","COMMAND_SETTEXTUREANISOTROPICLEVEL","wrapMode","ADDRESS_MODE_WRAP","ADDRESS_MODE_CLAMP","ADDRESS_MODE_MIRROR","_bindTexture","_deleteBuffer","COMMAND_DELETEINDEXBUFFER","COMMAND_DELETEVERTEXBUFFER","createCanvas","Canvas","Image","updateTextureData","xOffset","yOffset","lod","_uploadCompressedDataToTextureDirectly","internalFormat","_uploadDataToTextureDirectly","_uploadArrayBufferViewToTexture","_uploadImageToTexture","TEXTURE_NEAREST_NEAREST","TEXTURE_LINEAR_LINEAR","TEXTURE_LINEAR_LINEAR_MIPLINEAR","TEXTURE_NEAREST_NEAREST_MIPNEAREST","TEXTURE_NEAREST_LINEAR_MIPNEAREST","TEXTURE_NEAREST_LINEAR_MIPLINEAR","TEXTURE_NEAREST_LINEAR","TEXTURE_NEAREST_NEAREST_MIPLINEAR","TEXTURE_LINEAR_NEAREST_MIPNEAREST","TEXTURE_LINEAR_NEAREST_MIPLINEAR","TEXTURE_LINEAR_LINEAR_MIPNEAREST","TEXTURE_LINEAR_NEAREST","STENCIL_TEST_LESS","STENCIL_TEST_LEQUAL","STENCIL_TEST_EQUAL","STENCIL_TEST_GEQUAL","STENCIL_TEST_GREATER","STENCIL_TEST_NOTEQUAL","STENCIL_TEST_NEVER","opFail","STENCIL_OP_FAIL_S_ZERO","STENCIL_OP_FAIL_S_REPLACE","STENCIL_OP_FAIL_S_INCR","STENCIL_OP_FAIL_S_DECR","STENCIL_OP_FAIL_S_INVERT","STENCIL_OP_FAIL_S_INCRSAT","STENCIL_OP_FAIL_S_DECRSAT","depthFail","STENCIL_OP_FAIL_Z_ZERO","STENCIL_OP_FAIL_Z_REPLACE","STENCIL_OP_FAIL_Z_INCR","STENCIL_OP_FAIL_Z_DECR","STENCIL_OP_FAIL_Z_INVERT","STENCIL_OP_FAIL_Z_INCRSAT","STENCIL_OP_FAIL_Z_DECRSAT","opPass","STENCIL_OP_PASS_Z_ZERO","STENCIL_OP_PASS_Z_REPLACE","STENCIL_OP_PASS_Z_INCR","STENCIL_OP_PASS_Z_DECR","STENCIL_OP_PASS_Z_INVERT","STENCIL_OP_PASS_Z_INCRSAT","STENCIL_OP_PASS_Z_DECRSAT","TEXTURE_FORMAT_RGB8","TEXTURE_FORMAT_RGBA8","TEXTURE_FORMAT_RGBA16F","TEXTURE_FORMAT_RGBA32F","ALPHA_DISABLE","ALPHA_ADD","ALPHA_COMBINE","ALPHA_SUBTRACT","ALPHA_MULTIPLY","ALPHA_MAXIMIZED","ALPHA_ONEONE","ALPHA_PREMULTIPLIED","ALPHA_PREMULTIPLIED_PORTERDUFF","ALPHA_INTERPOLATE","ALPHA_SCREENMODE","ATTRIB_TYPE_INT8","ATTRIB_TYPE_UINT8","ATTRIB_TYPE_INT16","ATTRIB_TYPE_UINT16","ATTRIB_TYPE_FLOAT","getFontOffset","font","ascent","descent","_readTexturePixels","_flushRenderer","_noDataConversion","_c","_d","readTexture","rawBuffer","PerformanceConfigurator","use64bits","MatrixTrackPrecisionChange","MatrixUse64Bits","MatrixTrackedMatrices","m","values","_m","i","MatrixCurrentType","RenderTargetWrapper","_depthStencilTexture","depthStencilTextureWithStencil","_depthStencilTextureWithStencil","_isCube","_isMulti","_size","_textures","textures","_samples","setSamples","initializeBuffers","result","updateMultipleRenderTargetTextureSampleCount","updateRenderTargetTextureSampleCount","engine","_attachments","setTexture","disposePrevious","createDepthStencilTexture","comparisonFunction","bilinearFiltering","generateStencil","depthTextureFormat","_shareDepth","renderTarget","incrementReferences","_swapAndDie","target","_cloneRenderTargetWrapper","_e","_f","rtw","textureArray","generateDepthTexture","textureCount","lastTextureSource","_source","samplingModes","types","optionsMRT","createMultipleRenderTarget","createRenderTargetCubeTexture","_swapRenderTargetWrapper","_rebuild","bilinear","_comparisonFunction","releaseTextures","disposeOnlyFramebuffers","_releaseRenderTargetWrapper","ShaderStore","shaderLanguage","ShadersRepository","ShadersRepositoryWGSL","ShadersStore","ShadersStoreWGSL","IncludesShadersStore","IncludesShadersStoreWGSL","BufferPointer","ThinEngine","NpmPackage","Version","description","name","parallelShaderCompile","_name","version","_getShaderProcessor","_useReverseDepthBuffer","useReverse","frameId","_frameId","supportsUniformBuffers","getCreationOptions","_creationOptions","_shouldUseHighPrecisionShader","_highPrecisionShadersAllowed","needPOTTextures","forcePOTTextures","activeRenderLoops","_activeRenderLoops","_supportsHardwareTextureRescaling","framebufferDimensionsObject","dimensions","_framebufferDimensionsObject","currentViewport","_emptyTexture","_emptyTexture3D","createRawTexture3D","_emptyTexture2DArray","_emptyCubeTexture","faceData","cubeData","createRawCubeTexture","_isWebGPU","shaderPlatformName","snapshotRendering","activate","snapshotRenderingMode","_snapshotRenderingMode","useExactSrgbConversions","_useExactSrgbConversions","snapshotRenderingReset","document","OffscreenCanvas","createElement","_CreateCanvas","canvasOrContext","antialias","_g","_h","_j","_k","_l","isFullscreen","renderEvenInBackground","validateShaderPrograms","isNDCHalfZRange","hasOriginBottomLeft","onDisposeObservable","_uniformBuffers","_storageBuffers","_windowIsBackground","_badOS","_badDesktopOS","_renderingQueueLaunched","onContextLostObservable","onContextRestoredObservable","_contextWasLost","disableVertexArrayObjects","_colorWriteChanged","_stencilState","_alphaEquation","_currentTextureChannel","_compiledEffects","_vertexAttribArraysEnabled","_uintIndicesCurrentlySet","_currentBoundBuffer","_dummyFramebuffer","_currentBufferPointers","_currentInstanceLocations","_currentInstanceBuffers","_vaoRecordInProgress","_mustWipeVertexAttributes","_nextFreeTextureSlots","_maxSimultaneousTextures","_maxMSAASamplesOverride","_activeRequests","_lastDevicePixelRatio","hostInformation","isMobile","premultipliedAlpha","onBeforeTextureInitObservable","_viewportCached","_unpackFlipYCached","enableUnpackFlipYCached","startTime","stencilGlobal","useHighPrecisionMatrix","deterministicLockstep","lockstepMaxSteps","timeStep","audioEngine","_audioContext","audioEngineOptions","audioContext","_audioDestination","audioDestination","_isStencilEnable","limitDeviceRatio","min","getContext","_renderingCanvas","preserveDrawingBuffer","xrCompatible","navigator","userAgent","_setupMobileChecks","ua","ExceptionList","key","targets","RegExp","test","capture","captureConstraint","constraint","matches","exec","parseInt","_onContextLost","evt","preventDefault","_onContextRestored","_restoreEngineAfterContextLost","_initGLContext","bind","addEventListener","powerPreference","disableWebGL2Support","_gl","deleteQuery","e","renderbufferStorageMultisample","getContextAttributes","pixelStorei","UNPACK_COLORSPACE_CONVERSION_WEBGL","NONE","useHighPrecisionFloats","_initFeatures","versionToLog","setAttribute","_checkForMobile","currentUA","initEngine","setTimeout","depthTest","depthMask","stencilTest","_rebuildEffects","_rebuildComputeEffects","_rebuildBuffers","_rebuildInternalTextures","_rebuildRenderTargetWrappers","_sharedInit","_getShaderProcessingContext","currentState","renderTargetWrapper","_wasPreviouslyReady","_prepareEffect","areAllEffectsReady","uniformBuffer","storageBuffer","getParameter","MAX_TEXTURE_IMAGE_UNITS","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","maxSamples","MAX_SAMPLES","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_RENDERBUFFER_SIZE","MAX_VERTEX_ATTRIBS","MAX_VARYING_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_VERTEX_UNIFORM_VECTORS","getExtension","s3tc","s3tc_srgb","textureAnisotropicFilterExtension","timerQuery","multiview","oculusMultiview","MAX_ARRAY_TEXTURE_LAYERS","_glVersion","VERSION","rendererInfo","_glRenderer","UNMASKED_RENDERER_WEBGL","_glVendor","UNMASKED_VENDOR_WEBGL","VENDOR","RENDERER","HALF_FLOAT_OES","RGBA16F","RGBA32F","DEPTH24_STENCIL8","getQuery","getQueryEXT","TIMESTAMP_EXT","QUERY_COUNTER_BITS_EXT","MAX_TEXTURE_MAX_ANISOTROPY_EXT","_canRenderToFloatFramebuffer","COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR","COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT","COMPRESSED_SRGB_S3TC_DXT1_EXT","COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT","COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT","COMPRESSED_SRGB8_ETC2","COMPRESSED_SRGB8_ALPHA8_ETC2_EAC","_canRenderToHalfFloatFramebuffer","drawBuffers","drawBuffersWEBGL","DRAW_FRAMEBUFFER","FRAMEBUFFER","UNSIGNED_INT_24_8","UNSIGNED_INT_24_8_WEBGL","vertexArrayObjectExtension","createVertexArrayOES","bindVertexArray","bindVertexArrayOES","deleteVertexArray","deleteVertexArrayOES","instanceExtension","drawArraysInstanced","drawArraysInstancedANGLE","drawElementsInstanced","drawElementsInstancedANGLE","vertexAttribDivisor","vertexAttribDivisorANGLE","getShaderPrecisionFormat","vertexhighp","VERTEX_SHADER","HIGH_FLOAT","fragmenthighp","FRAGMENT_SHADER","precision","blendMinMaxExtension","MAX","MAX_EXT","MIN","MIN_EXT","sRGBExtension","SRGB","SRGB_EXT","SRGB8","SRGB_ALPHA_EXT","SRGB8_ALPHA8","forceSRGBBufferSupportState","LEQUAL","slot","getClassName","isStencilEnable","_prepareWorkingCanvas","_workingCanvas","context","_workingContext","getInfo","getGlInfo","vendor","renderer","getLoadedTexturesCache","getCaps","stopRenderLoop","renderFunction","splice","_renderLoop","shouldRender","beginFrame","endFrame","_frameHandler","_boundRenderFunction","getHostWindow","getRenderingCanvas","getAudioContext","getAudioDestination","ownerDocument","defaultView","framebufferWidth","drawingBufferWidth","framebufferHeight","drawingBufferHeight","QueueNewFrame","runRenderLoop","useStencilGlobalOnly","stencilStateComposer","applyStates","clearColor","COLOR_BUFFER_BIT","GEQUAL","clearDepth","DEPTH_BUFFER_BIT","clearStencil","STENCIL_BUFFER_BIT","_viewport","flushFramebuffer","forceSetSize","changeRatio","clientWidth","innerWidth","clientHeight","innerHeight","setSize","lodLevel","layer","webglRTWrapper","_MSAAFramebuffer","gl","framebufferTextureLayer","COLOR_ATTACHMENT0","framebufferTexture2D","TEXTURE_CUBE_MAP_POSITIVE_X","attachment","DEPTH_STENCIL_ATTACHMENT","DEPTH_ATTACHMENT","TEXTURE_2D","pow","cull","cullFace","BACK","FRONT","frontFace","CW","CCW","stencilMaterial","getDepthBuffer","_currentFrameBufferIsDefaultFrameBuffer","generateMipmaps","_bindTextureDirectly","generateMipmap","unBindMultiColorAttachmentFramebuffer","READ_FRAMEBUFFER","blitFramebuffer","NEAREST","flush","restoreDefaultFramebuffer","_resetVertexBufferBinding","bindArrayBuffer","_createVertexBuffer","STATIC_DRAW","usage","vbo","createBuffer","dataBuffer","bufferData","ARRAY_BUFFER","DYNAMIC_DRAW","_resetIndexBufferBinding","bindIndexBuffer","updatable","ELEMENT_ARRAY_BUFFER","Uint32Array","Uint16Array","_unbindVertexArrayObject","_bindBuffer","uniformLocation","getUniformBlockIndex","uniformBlockBinding","bindBuffer","updateArrayBuffer","bufferSubData","_vertexAttribPointer","indx","stride","pointer","changed","active","UNSIGNED_INT","INT","vertexAttribIPointer","vertexAttribPointer","_bindIndexBufferWithCache","_bindVertexBuffersAttributes","unbindAllAttributes","order","ai","enableVertexAttribArray","getIsInstanced","vao","_cachedVertexArrayObject","bindBuffersDirectly","vertexDeclaration","vertexStrideSize","attributesCount","getAttributesCount","FLOAT","unbindInstanceAttributes","boundBuffer","ul","instancesBuffer","offsetLocation","_releaseBuffer","deleteBuffer","updateAndBindInstancesBuffer","offsetLocations","bindInstancesBuffer","attributesInfo","computeStride","attributeSize","getAttributeLocationByName","attributeName","attributeType","divisor","disableInstanceAttributeByName","attributeLocation","disableInstanceAttribute","shouldClean","disableAttributeByIndex","disableVertexAttribArray","draw","useTriangles","drawPointClouds","drawUnIndexed","_reportDrawCall","drawMode","_drawMode","indexFormat","UNSIGNED_SHORT","mult","drawElements","drawArrays","TRIANGLES","POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLE_STRIP","TRIANGLE_FAN","_releaseEffect","_key","webGLPipelineContext","__SPECTOR_rebuildProgram","deleteProgram","_getGlobalDefines","s","createEffect","baseName","attributesNamesOrOptions","uniformsNamesOrEngine","fallbacks","onCompiled","indexParameters","vertex","vertexElement","vertexToken","vertexSource","fragment","fragmentElement","fragmentToken","fragmentSource","globalDefines","fullDefines","compiledEffect","shaderVersion","_compileShader","_compileRawShader","_ConcatenateShader","shader","createShader","NO_ERROR","tempError","getError","isContextLost","shaderSource","compileShader","_getShaderSource","getShaderSource","transformFeedbackVaryings","vertexShader","fragmentShader","_createShaderProgram","shaderProcessingContext","isParallelCompiled","shaderProgram","attachShader","linkProgram","_finalizePipelineContext","getProgramParameter","LINK_STATUS","getShaderParameter","COMPILE_STATUS","log","getShaderInfoLog","vertexCompilationError","fragmentCompilationError","getProgramInfoLog","programLinkError","validateProgram","VALIDATE_STATUS","programValidationError","deleteShader","rawVertexSourceCode","rawFragmentSourceCode","rebuildRebind","webGLRenderingState","COMPLETION_STATUS_KHR","oldHandler","results","getUniformLocation","getAttribLocation","enableEffect","onBind","_onBindObservable","uniform1i","setInt2","uniform2i","setInt3","uniform3i","setInt4","uniform4i","uniform1iv","uniform2iv","uniform3iv","uniform4iv","setUInt","uniform1ui","setUInt2","uniform2ui","setUInt3","uniform3ui","setUInt4","uniform4ui","setUIntArray","uniform1uiv","setUIntArray2","uniform2uiv","setUIntArray3","uniform3uiv","setUIntArray4","uniform4uiv","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix4fv","uniformMatrix3fv","uniformMatrix2fv","uniform1f","uniform2f","uniform3f","uniform4f","colorMask","depthCullingState","alphaState","stencilState","clearInternalTexturesCache","UNPACK_PREMULTIPLY_ALPHA_WEBGL","_getSamplingParameters","magFilter","minFilter","LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","NEAREST_MIPMAP_LINEAR","NEAREST_MIPMAP_NEAREST","mag","delayGPUTextureCreation","filters","TEXTURE_2D_ARRAY","sizedFormat","_getRGBABufferInternalSizedFormat","_getInternalFormat","_getWebGLTextureType","texImage3D","texImage2D","texParameteri","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","_createTextureBase","prepareTexture","prepareTextureProcessFunction","fromBlob","_originalUrl","split","_TextureLoaders","onErrorObservable","callback","loadData","loadMipmap","isCompressed","done","loadFailed","offlineProvider","img","decoding","close","_FileToolsLoadImage","imageOrientation","_prepareWebGLTexture","potWidth","potHeight","continuationCallback","isPot","RGBA","RGB","texelFormat","UNSIGNED_BYTE","drawImage","_rescaleTexture","_releaseTexture","input","imageBitmapOptions","onComplete","_unpackFlipY","UNPACK_FLIP_Y_WEBGL","_getUnpackAlignement","UNPACK_ALIGNMENT","_getTextureTarget","TEXTURE_CUBE_MAP","TEXTURE_3D","isMultiview","_setTextureParameterInteger","updateTextureDimensions","updateTextureWrappingMode","_getTextureWrapMode","_cachedWrapU","_cachedWrapV","TEXTURE_WRAP_R","_cachedWrapR","_setupDepthStencilTexture","samplingParameters","TEXTURE_COMPARE_FUNC","TEXTURE_COMPARE_MODE","COMPARE_REF_TO_TEXTURE","compressedTexImage2D","babylonInternalFormat","useTextureWidthAndHeight","lodMaxWidth","round","LOG2E","lodMaxHeight","targetForBinding","texSubImage2D","bindTarget","_prepareWebGLTextureContinuation","processFunction","GetExponentOfTwo","_setupFramebufferDepthAttachments","_createRenderBuffer","DEPTH_STENCIL","depthFormat","DEPTH_COMPONENT16","DEPTH_COMPONENT32F","STENCIL_INDEX8","STENCIL_ATTACHMENT","msInternalFormat","unbindBuffer","renderBuffer","createRenderbuffer","_updateRenderBuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","framebufferRenderbuffer","unbindAllTextures","_lodTextureHigh","_lodTextureMid","_lodTextureLow","_irradianceTexture","useProgram","_activateCurrentTexture","activeTexture","TEXTURE0","forTextureDataUpdate","wasPreviouslyBound","isTextureForRendering","_associatedChannel","console","bindTexture","_bindSamplerUniformToChannel","sourceSlot","_currentState","REPEAT","MIRRORED_REPEAT","needToBind","_cachedCoordinatesMode","coordinatesMode","textureWrapMode","_setAnisotropicLevel","setTextureArray","_textureUnits","Int32Array","anisotropicFilterExtension","_setTextureParameterFloat","TEXTURE_MAX_ANISOTROPY_EXT","parameter","texParameterf","releaseEffects","deleteFramebuffer","releaseComputeEffects","removeEventListener","abort","attachContextLostEvent","attachContextRestoredEvent","_canRenderToFramebuffer","successful","fb","createFramebuffer","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","readFormat","readType","readPixels","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","BYTE","SHORT","HALF_FLOAT","UNSIGNED_INT_2_10_10_10_REV","UNSIGNED_INT_10F_11F_11F_REV","UNSIGNED_INT_5_9_9_9_REV","FLOAT_32_UNSIGNED_INT_24_8_REV","ALPHA","LUMINANCE","LUMINANCE_ALPHA","RED","RG","RED_INTEGER","RG_INTEGER","RGB_INTEGER","RGBA_INTEGER","R8_SNORM","RG8_SNORM","RGB8_SNORM","R8I","RG8I","RGB8I","RGBA8I","RGBA8_SNORM","R8","RG8","RGB8","RGBA8","R8UI","RG8UI","RGB8UI","RGBA8UI","R16I","RG16I","RGB16I","RGBA16I","R16UI","RG16UI","RGB16UI","RGBA16UI","R32I","RG32I","RGB32I","RGBA32I","R32UI","RG32UI","RGB32UI","RGBA32UI","R32F","RG32F","RGB32F","R16F","RG16F","RGB16F","RGB565","R11F_G11F_B10F","RGB9_E5","RGBA4","RGB5_A1","RGB10_A2","RGB10_A2UI","_getRGBAMultiSampleBufferFormat","onProgress","useArrayBuffer","_FileToolsLoadFile","onCompleteObservable","hasAlpha","flushRenderer","numChannels","IsSupportedAsync","isSupported","IsSupported","_HasMajorPerformanceCaveat","_IsSupported","tempcanvas","WebGLRenderingContext","HasMajorPerformanceCaveat","failIfMajorPerformanceCaveat","c","CeilingPOT","f","FloorPOT","pot","NearestPOT","requestPostAnimationFrame","CollisionsEpsilon","WebGPUEngine","_snapshotRendering","enabled","disableCacheSamplers","_cacheSampler","disabled","disable","disableCacheRenderPipelines","_cacheRenderPipeline","disableCacheBindGroups","_cacheBindGroups","gpu","requestAdapter","adapter","catch","supportedExtensions","_adapterSupportedExtensions","enabledExtensions","_deviceEnabledExtensions","compatibilityMode","_compatibilityMode","currentSampleCount","_mainPassSampleCount","initAsync","glslangOptions","twgslOptions","_uploadEncoderDescriptor","label","_renderEncoderDescriptor","_renderTargetEncoderDescriptor","_clearDepthValue","_clearReverseDepthValue","_clearStencilValue","_defaultSampleCount","_glslang","_tintWASM","_compiledComputeEffects","_counters","numEnableEffects","numEnableDrawWrapper","numBundleCreationNonCompatMode","numBundleReuseNonCompatMode","countersLastFrame","numMaxUncapturedErrors","_commandBuffers","_currentRenderPass","_mainRenderPassWrapper","_rttRenderPassWrapper","_pendingDebugCommands","_onAfterUnbindFrameBufferObservable","_currentOverrideVertexBuffers","_currentIndexBuffer","_colorWriteLocal","_forceEnableEffect","dbgShowShaderCode","dbgSanityChecks","dbgVerboseLogsForFirstFrames","dbgVerboseLogsNumFrames","dbgLogIfNotDrawWrapper","dbgShowEmptyEnableEffectCalls","_viewportsCurrent","h","_scissorsCurrent","_scissorCached","_stencilRefsCurrent","_blendColorsCurrent","deviceDescriptor","enableGPUDebugMarkers","Log","swapChainFormat","getPreferredCanvasFormat","_canvas","_options","_shaderProcessorWGSL","_initGlslang","glslang","UseTWGSL","initTwgsl","msg","_adapter","features","forEach","feature","requiredFeatures","requestedExtensions","validExtensions","requestDevice","device","_device","numUncapturedErrors","event","lost","_bufferManager","_textureHelper","W","_timestampQuery","_occlusionQuery","createQuerySet","_bundleList","_bundleListRenderTarget","_ubInvertY","_ubDontInvertY","_count","_uploadEncoder","createCommandEncoder","_renderEncoder","_renderTargetEncoder","_emptyVertexBuffer","_initializeLimits","setCommandEncoder","_clearQuad","_defaultDrawContext","_currentDrawContext","_defaultMaterialContext","_currentMaterialContext","_initializeContextAndSwapChain","_initializeMainAttachments","trace","_GLSLslangDefaultOptions","wasmPath","jsPath","importScripts","BigUint64Array","_context","_configureContext","_colorFormat","colorAttachmentGPUTextures","_mainTextureExtends","depthOrArrayLayers","bufferDataUpdate","mainColorAttachments","setSubData","mainTextureDescriptor","mipLevelCount","sampleCount","dimension","_mainTexture","releaseTexture","view","createView","clearValue","loadOp","storeOp","_setDepthTextureFormat","depthTextureDescriptor","_depthTexture","mainDepthAttachment","depthClearValue","depthLoadOp","depthStoreOp","stencilClearValue","stencilLoadOp","stencilStoreOp","renderPassDescriptor","colorAttachments","depthStencilAttachment","configure","alphaMode","setAlphaBlendEnabled","alphaBlend","setBuffers","setAlphaBlendFactors","_blendFunctionParameters","_blendEquationParameters","setWriteMask","_resetCurrentViewport","_mustUpdateViewport","renderPass","_applyViewport","floor","_resetCurrentScissor","_mustUpdateScissor","_applyScissor","setScissorRect","_scissorIsActive","enableScissor","disableScissor","_resetCurrentStencilRef","_mustUpdateStencilRef","funcRef","_applyStencilRef","setStencilReference","_resetCurrentColorBlend","_mustUpdateBlendColor","colorBlend","_blendConstants","_applyBlendColor","setBlendConstant","hasScissor","_startRenderTargetRenderPass","addItem","_clearFullQuad","_endRenderTargetRenderPass","_startMainRenderPass","_getCurrentRenderPass","bundleList","_getCurrentRenderPassIndex","setColorFormat","setDepthStencilFormat","_depthTextureFormat","setMRTAttachments","mrtAttachments","mrtTextureArray","mrtTextureCount","bundle","addBundle","_createBuffer","flags","releaseBuffer","_compileRawShaderToSpirV","compileGLSL","_compileShaderToSpirV","_getWGSLShader","join","_createPipelineStageDescriptor","convertSpirV2WGSL","vertexStage","module","createShaderModule","entryPoint","fragmentStage","_compileRawPipelineStageDescriptor","_compilePipelineStageDescriptor","webGpuContext","sources","rawVertex","rawFragment","stages","gpuPipelineContext","availableAttributes","isNewEffect","materialContext","drawContext","uniqueId","webGPUPipelineContext","updateTextureComparisonFunction","fullOptions","createGPUTextureForInternalTexture","_generateMipmaps","gpuTextureWrapper","updateTexture","wrapWebGPUTexture","generateMipMapsForCubemap","additionalUsages","textureAdditionalUsages","release","_setInternalTexture","availableTexture","availableTextures","autoBindSampler","samplerName","setSampler","unused","toString","commandEncoder","gpuHardwareTexture","mipmapCount","generateCubeMipmaps","HTMLImageElement","bitmap","ceil","gpuTexture","gpuTextureFormat","_endMainRenderPass","destroyDeferredTextures","destroyDeferredBuffers","list","reopenPass","currentRenderPassIsNULL","currentPasses","finish","queue","submit","startFrame","setClearStates","gpuDepthStencilWrapper","gpuDepthStencilTexture","gpuDepthStencilMSAATexture","msaaTexture","depthTextureView","depthAttachmentViewDescriptor","depthMSAATextureView","depthTextureHasStencil","setDepthFunctionToGreaterOrEqual","mustClearColor","mustClearDepth","mustClearStencil","_mrtAttachments","_defaultAttachments","mrtTexture","gpuMRTWrapper","gpuMRTTexture","viewDescriptor","colorAttachmentViewDescriptor","gpuMSAATexture","colorTextureView","colorMSAATextureView","resolveTarget","setMRT","gpuWrapper","_debugPushGroup","occlusionQuerySet","hasQueries","querySet","beginRenderPass","_debugFlushPendingCommands","endRenderTargetPass","run","end","_debugPopGroup","swapChainTexture","getCurrentTexture","endMainRenderPass","play","_currentLayer","_setColorFormat","baseArrayLayer","baseMipLevel","arrayLayerCount","aspect","saveCRT","wrapper","setDitheringState","setRasterizerState","_applyRenderPassChanges","mustUpdateViewport","mustUpdateScissor","mustUpdateStencilRef","mustUpdateBlendColor","_draw","drawType","start","count","webgpuPipelineContext","bindUniformBufferBase","isDirty","updateId","forceBindGroupCreation","fastBundle","renderPass2","record","indirectDrawBuffer","setIndirectData","getBundleEncoder","colorFormats","numDrawCalls","textureState","hasFloatTextures","bitVal","textureNames","textureName","pipeline","getRenderPipeline","bindGroups","getBindGroups","createRenderBundleEncoder","depthStencilFormat","setPipeline","setIndexBuffer","setVertexBuffer","_validOffsetRange","setBindGroup","nonCompatMode","drawIndexedIndirect","drawIndirect","drawIndexed","destroy","ClipboardEventTypes","COPY","CUT","PASTE","ClipboardInfo","keyCode","DeviceInputEventType","EventConstants","DOM_DELTA_PIXEL","DOM_DELTA_LINE","DOM_DELTA_PAGE","KeyboardEventTypes","KEYDOWN","KEYUP","KeyboardInfo","KeyboardInfoPre","skipOnPointerObservable","skipOnKeyboardObservable","PointerEventTypes","POINTERDOWN","POINTERUP","POINTERMOVE","POINTERWHEEL","POINTERPICK","POINTERTAP","POINTERDOUBLETAP","PointerInfoBase","PointerInfoPre","localX","localY","ray","originalPickingInfo","localPosition","PointerInfo","pickInfo","_pickInfo","_generatePickInfo","inputManager","_inputManager","_pickMove","_setRayOnPointerInfo","PoseEnabledControllerType","PoseEnabledControllerHelper","vrGamepad","factory","_ControllerFactories","canCreate","create","_DefaultControllerFactory","PoseEnabledController","_disableTrackPosition","fixedPosition","_trackPosition","_calculatedPosition","copyFrom","browserGamepad","id","isXR","_deviceRoomPosition","_deviceRoomRotationQuaternion","devicePosition","deviceRotationQuaternion","deviceScaleFactor","_maxRotationDistFromHeadset","PI","_draggedRoomRotation","_leftHandSystemQuaternion","_deviceToWorld","_pointingPoseNode","_workingMatrix","_meshAttachedObservable","controllerType","GENERIC","position","rotationQuaternion","_calculatedRotation","_updatePoseAndMesh","pose","updateFromDevice","camera","_computeDevicePosition","setTranslation","toEulerAnglesToRef","distanceAway","atan2","sin","cos","abs","rotationAmount","getRotationMatrixToRef","multiplyInPlace","_mesh","poseData","rawPose","copyFromFloats","getScene","useRightHandedSystem","scaleToRef","addInPlace","orientation","multiplyToRef","attachToMesh","mesh","parent","_poseControlledCamera","parents","obj","reverse","p","computeWorldMatrix","attachToPoseControlledCamera","getForwardRay","getWorldMatrix","origin","getTranslation","forward","forwardWorld","direction","POINTING_POSE","WebVRController","onButtonStateChange","_onButtonStateChange","defaultModel","_defaultModel","onTriggerStateChangedObservable","onMainButtonStateChangedObservable","onSecondaryButtonStateChangedObservable","onPadStateChangedObservable","onPadValuesChangedObservable","pad","_changes","pressChanged","touchChanged","valueChanged","_buttons","buttons","hand","_setButtonValue","leftStick","newState","buttonIndex","pressed","touched","_checkChanges","_handleButtonChange","DualShockButton","DualShockDpad","DualShockPad","gamepad","replace","_leftTrigger","_rightTrigger","onButtonDownObservable","onButtonUpObservable","onPadDownObservable","onPadUpObservable","_buttonCross","_buttonCircle","_buttonSquare","_buttonTriangle","_buttonShare","_buttonOptions","_buttonL1","_buttonR1","_buttonLeftStick","_buttonRightStick","_dPadUp","_dPadDown","_dPadLeft","_dPadRight","onlefttriggerchanged","_onlefttriggerchanged","onrighttriggerchanged","_onrighttriggerchanged","leftTrigger","newValue","rightTrigger","onbuttondown","_onbuttondown","onbuttonup","_onbuttonup","ondpaddown","_ondpaddown","ondpadup","_ondpadup","currentValue","buttonType","_setDPadValue","buttonCross","Cross","buttonCircle","Circle","buttonSquare","Square","buttonTriangle","Triangle","buttonOptions","Options","buttonShare","Share","buttonL1","L1","buttonR1","R1","buttonLeftStick","LeftStick","buttonRightStick","RightStick","dPadUp","Up","dPadDown","Down","dPadLeft","Left","dPadRight","Right","Gamepad","isConnected","_isConnected","leftStickX","leftStickY","rightStickX","rightStickY","_leftStick","_rightStick","_invertLeftStickY","GAMEPAD","_leftStickAxisX","_leftStickAxisY","_rightStickAxisX","_rightStickAxisY","axes","onleftstickchanged","_onleftstickchanged","onrightstickchanged","_onrightstickchanged","newValues","rightStick","XBOX","POSE_ENABLED","DUALSHOCK","GenericPad","GamepadManager","_scene","_babylonGamepads","_oneGamepadConnected","_isMonitoring","onGamepadDisconnectedObservable","_gamepadEventSupported","_gamepadSupport","getGamepads","onGamepadConnectedObservable","observer","notifyObserver","_onGamepadConnectedEvent","newGamepad","_addNewGamepad","_startMonitoringGamepads","_onGamepadDisconnectedEvent","disconnectedGamepad","_updateGamepadObjects","hostWindow","gamepads","getGamepadByType","_stopMonitoringGamepads","dualShock","search","xboxOne","_checkGamepadsStatus","_loggedErrors","_gamepadManager","component","_getComponent","GamepadSystemSceneComponent","_addComponent","enumerable","register","_beforeCameraUpdateStage","registerStep","_beforeCameraUpdate","rebuild","gamepadManager","DaydreamController","initControllerMesh","meshLoaded","MODEL_BASE_URL","MODEL_FILENAME","newMeshes","buttonIdx","state","observable","GAMEPAD_ID_PREFIX","gamepadInfo","GearVRController","_buttonIndexToObservableNameMap","GenericController","dir","OculusTouchController","onSecondaryTriggerStateChangedObservable","onThumbRestChangedObservable","meshName","MODEL_LEFT_FILENAME","MODEL_RIGHT_FILENAME","_IsQuest","QUEST_MODEL_BASE_URL","onAButtonStateChangedObservable","onBButtonStateChangedObservable","onXButtonStateChangedObservable","onYButtonStateChangedObservable","notifyObject","triggerDirection","getChildren","rotation","ViveController","onLeftButtonStateChangedObservable","onRightButtonStateChangedObservable","onMenuButtonStateChangedObservable","LoadedMeshInfo","buttonMeshes","axisMeshes","WindowsMotionController","_mapping","buttonMeshNames","trigger","menu","grip","thumbstick","trackpad","buttonObservableNames","axisMeshNames","pointingPoseMeshName","onTrackpadChangedObservable","onTrackpadValuesChangedObservable","_loadedMeshInfo","onTriggerButtonStateChangedObservable","onGripButtonStateChangedObservable","onThumbstickButtonStateChangedObservable","onTouchpadButtonStateChangedObservable","onTouchpadValuesChangedObservable","_updateTrackpad","axis","_lerpAxisTransform","buttonName","_lerpButtonTransform","buttonValue","meshInfo","unpressed","axisValue","lerpValue","forceDefault","path","filename","match","GAMEPAD_ID_PATTERN","meshes","_processModel","rootNode","loadedMeshInfo","parentMesh","childMesh","isPickable","setParent","_createMeshInfo","buttonMeshName","buttonMesh","getChildByName","buttonMeshInfo","getImmediateChildByName","axisMeshName","axisMesh","axisMeshInfo","pointingPoseNode","node","n","Xbox360Button","Xbox360Dpad","Xbox360Pad","_buttonA","_buttonB","_buttonX","_buttonY","_buttonBack","_buttonStart","_buttonLB","_buttonRB","_isXboxOnePad","buttonA","A","buttonB","B","buttonX","X","buttonY","Y","buttonStart","Start","buttonBack","Back","buttonLB","LB","buttonRB","RB","AxisDragGizmo","coloredMaterial","_coloredMaterial","hoverMaterial","_hoverMaterial","disableMaterial","_disableMaterial","material","thickness","isCollider","arrow","cylinder","diameterTop","diameterBottom","tessellation","line","visibility","instance","getChildMeshes","createInstance","dragAxis","gizmoLayer","_pointerObserver","snapDistance","onSnapObservable","_isEnabled","_parent","_dragging","utilityLayerScene","diffuseColor","specularColor","subtract","_CreateArrow","collider","_gizmoMesh","addChild","lookAt","_rootMesh","scaling","scaleInPlace","currentSnapDragDistance","tmpSnapEvent","dragBehavior","moveAttached","updateDragPlane","addBehavior","onDragObservable","attachedNode","_handlePivot","matrixChanged","getTranslationToRef","delta","validateDrag","addInPlaceFromFloats","addTranslationFromFloats","updateCache","dragDistance","dragSteps","normalizeToRef","_matrixChanged","onDragStartObservable","onDragEndObservable","light","_getSharedGizmoLight","includedOnlyMeshes","concat","cache","gizmoMeshes","colliderMeshes","addToAxisCache","onPointerObservable","pointerInfo","_customMeshSet","_isHovered","pickedMesh","_setGizmoMeshMaterial","onEnabledObservable","_attachedNodeChanged","isEnabled","attachedMesh","detach","matl","AxisScaleGizmo","uniformScaling","sensitivity","dragScale","_tmpVector","arrowMesh","arrowTail","_createGizmoMesh","nodePosition","clone","linePosition","lineScale","increaseGizmoMesh","dragStrength","resetGizmoMesh","scaleRatio","tmpVector","snapped","setAll","transformNode","_isMesh","maxScale","uniformScaleGizmo","setCustomMesh","useGizmoMaterial","BoundingBoxGizmo","axisFactor","factor","_axisFactor","scaleBoxes","_scaleBoxesParent","j","k","zeroAxisCount","setEnabled","lengthSquared","scaleDragSpeed","_scaleDragSpeed","_hoverColoredMaterial","pointerDragBehavior","_pointerDragBehavior","setColor","emissiveColor","_lineBoundingBox","l","_boundingDimensions","_renderObserver","_tmpQuaternion","_tmpRotationMatrix","ignoreChildren","includeChildPredicate","rotationSphereSize","scaleBoxSize","fixedDragMeshScreenSize","fixedDragMeshBoundsSize","fixedDragMeshScreenSizeDistanceFactor","onScaleBoxDragObservable","onScaleBoxDragEndObservable","onRotationSphereDragObservable","onRotationSphereDragEndObservable","scalePivot","_existingMeshScale","_dragMesh","updateScale","_anchorMesh","disableLighting","lines","points","_rotateSpheresParent","sphere","diameter","isNearGrabbable","_dragBehavior","startingTurnDirection","totalTurnAmountOfDrag","originalParent","isNonUniformWithinEpsilon","worldDragDirection","toSub","dragPlaneNormal","scale","normalizeToNew","projectDist","conjugateInPlace","removeChild","updateBoundingBox","_updateDummy","_selectNode","_unhoverMeshOnTouchUp","box","_internalMetadata","normalize","relativeDragDistance","deltaScale","subtractInPlace","absolutePosition","subtractToRef","pointerIds","pointerId","originalScene","onBeforeRenderObservable","equals","_updateRotationSpheres","_updateScaleBoxes","dragging","rotateByQuaternionToRef","setAbsolutePosition","markAsDirty","onAfterRenderObservable","selectedMesh","isVisible","PointerEvent","pointerType","getScaleBoxes","_update","boundingMinMax","getHierarchyBoundingVectors","rotateSpheres","activeCamera","distanceFromCamera","setEnabledRotationAxis","setEnabledScaling","homogeneousScaling","enableMesh","getAbsolutePosition","enableDragBehavior","useObjectOrientationForDragging","makeNotPickable","root","oldPos","oldRot","Gizmo","_scaleRatio","isHovered","_attachedMesh","_attachedNode","updateGizmoRotationToMatchAttachedMesh","_updateGizmoRotationToMatchAttachedMesh","updateGizmoPositionToMatchAttachedMesh","_updateGizmoPositionToMatchAttachedMesh","_updateScale","_customRotationQuaternion","_interactionsEnabled","_rightHandtoLeftHandMatrix","_beforeRenderObserver","customRotationQuaternion","effectiveNode","row","getRow","toVector3","decompose","PreserveScaling","cameraPosition","globalPosition","orthoTop","orthoBottom","camForward","getDirection","_getWorldMatrixDeterminant","attachedNodeTransform","isUsingPivotMatrix","_isCamera","worldMatrix","worldMatrixUC","parentInv","_worldMatrix","invertToRef","targetCamera","transform","localMat","billboardMode","bone","getParent","invParent","boneLocalMatrix","getLocalMatrix","getTypeID","nodeLocalMatrix","gizmoAxisCache","has","LightGizmo","_cachedPosition","_cachedForward","onClickedObservable","_light","_attachedMeshParent","_material","button","warn","_lightMesh","_CreateHemisphericLightMesh","_CreateDirectionalLightMesh","_CreateSpotLightMesh","_CreatePointLightMesh","gizmoLight","reservedDataStore","lightGizmo","freezeWorldMatrix","setDirection","hemisphere","segments","_CreateLightLines","_Scale","subdivisions","arrowHead","levels","linePivot","CameraGizmo","_invProjection","displayFrustum","_cameraLinesMesh","_cameraMesh","_CreateCameraMesh","_CreateCameraFrustum","maxZ","cameraGizmo","getProjectionMatrix","setPivotMatrix","cyl1","cyl2","cyl3","alwaysSelectAsActiveMesh","PlaneDragGizmo","plane","dragPlane","sideOrientation","_CreatePlane","PlaneRotationGizmo","planeNormal","useEulerRotation","angle","_angles","rotationMesh","_rotationDisplayPlane","_RotationGizmoVertexShader","_RotationGizmoFragmentShader","_rotationShaderMaterial","uniforms","backFaceCulling","maxDragAngle","MaxDragAngle","_useAlternatePickedPointAboveMaxDragAngle","lastDragPosition","rotationMatrix","planeNormalTowardsCamera","localPlaneNormalTowardsCamera","dragPlanePoint","setVector3","tmpMatrix","amountToRotate","nodeScale","nodeQuaternion","nodeTranslation","nodeTranslationForOperation","newVector","originalVector","cross","dot","toRotationMatrix","cameraFlipped","camVec","quaternionCoefficient","determinant","PositionGizmo","_meshAttached","_nodeAttached","xGizmo","yGizmo","zGizmo","xPlaneGizmo","yPlaneGizmo","zPlaneGizmo","gizmo","hovered","gizmoManager","_observables","_gizmoAxisCache","Map","_planarGizmoEnabled","planarGizmoEnabled","_snapDistance","obs","RotationGizmo","_checkBillboardTransform","xColor","xOptions","yColor","yOptions","zColor","zOptions","ScaleGizmo","_sensitivity","_createUniformScaleMesh","_uniformScalingMesh","_octahedron","msh","EnvironmentHelper","createGround","groundSize","groundTexture","_GroundTextureCDNUrl","groundColor","toLinearSpace","groundOpacity","enableGroundShadow","groundShadowLevel","enableGroundMirror","groundMirrorSizeRatio","groundMirrorBlurKernel","groundMirrorAmount","groundMirrorFresnelWeight","groundMirrorFallOffDistance","groundMirrorTextureType","groundYBias","createSkybox","skyboxSize","skyboxTexture","_SkyboxTextureCDNUrl","skyboxColor","backgroundYRotation","sizeAuto","rootPosition","setupImageProcessing","environmentTexture","_EnvironmentTextureCDNUrl","cameraExposure","cameraContrast","toneMappingEnabled","rootMesh","skybox","_skybox","_skyboxTexture","skyboxMaterial","_skyboxMaterial","ground","_ground","_groundTexture","groundMirror","_groundMirror","groundMirrorRenderList","renderList","groundMaterial","_groundMaterial","_errorHandler","_GetDefaultOptions","_setupBackground","_setupImageProcessing","updateOptions","newOptions","setMainColor","primaryColor","imageProcessingConfiguration","contrast","exposure","_setupEnvironmentTexture","sceneSize","_getSceneSize","_setupGround","_setupGroundMaterial","_setupGroundDiffuseTexture","_setupGroundMirrorTexture","_setupMirrorInGroundMaterial","_setupSkybox","_setupSkyboxMaterial","_setupSkyboxReflectionTexture","sceneExtends","getWorldExtends","sceneDiagonal","upperRadiusLimit","sceneDiagonalLenght","isDisposed","receiveShadows","shadowLevel","useRGBColor","enableNoise","diffuseTexture","gammaSpace","wrapping","ratio","mirrorPlane","gammaGround","toGammaSpace","adaptiveBlurKernel","reflectionTexture","reflectionFresnel","reflectionAmount","reflectionStandardFresnelWeight","reflectionFalloffDistance","TextureDome","_texture","newTexture","_useDirectMapping","_changeTextureMode","_textureMode","fovMultiplier","textureMode","halfDome","_halfDome","_halfDomeMask","crossEye","_crossEye","textureUrlOrElement","MODE_MONOSCOPIC","_onBeforeCameraRenderObserver","onLoadErrorObservable","onLoadObservable","resolution","clickToPlay","Boolean","autoPlay","loop","useDirectMapping","faceForward","_setReady","useEquirectangularFOV","opacityFresnel","_initTexture","rotate","halfDomeMode","crossEyeMode","getViewMatrix","acos","onBeforeCameraRenderObservable","uScale","vScale","uOffset","vOffset","vAng","MODE_SIDEBYSIDE","rightOffset","leftOffset","isRightCamera","MODE_TOPBOTTOM","doNotRecurse","disposeMaterialAndTextures","PhotoDome","photoTexture","imageMode","urlsOrElement","VideoDome","videoTexture","videoMode","tempOptions","autoUpdateTexture","poster","_textureObserver","_forceSceneHelpersToBundle","lights","createArcRotateCamera","attachCameraControls","worldExtends","worldSize","worldCenter","radius","isFinite","arcRotateCamera","lowerRadiusLimit","wheelPrecision","freeCamera","setTarget","minZ","speed","attachControl","createDefaultLight","createDefaultCamera","pbr","blur","setGlobalEnvTexture","hdrSkybox","hdrSkyboxMaterial","microSurface","twoSidedLighting","infiniteDistance","ignoreCameraMaxZ","webVROptions","helper","_ClickInfo","_singleClick","_doubleClick","_hasSwiped","_ignore","singleClick","doubleClick","hasSwiped","ignore","InputManager","_alreadyAttached","_meshPickProceed","_currentPickResult","_previousPickResult","_totalPointersPressed","_doubleClickOccured","_isSwiping","_swipeButtonPressed","_skipPointerTap","_isMultiTouchGesture","_pointerX","_pointerY","_startingPointerPosition","_previousStartingPointerPosition","_startingPointerTime","_previousStartingPointerTime","_pointerCaptures","_meshUnderPointerId","_movePointerInfo","_cameraObserverCount","_deviceSourceManager","meshUnderPointer","_pointerOverMesh","getMeshUnderPointerByPointerId","unTranslatedPointer","_unTranslatedPointerX","_unTranslatedPointerY","pointerX","pointerY","_updatePointerPosition","canvasRect","clientX","clientY","_processPointerMove","pickResult","getInputElement","tabIndex","canvasTabIndex","doNotHandleCursors","style","cursor","defaultCursor","_setCursorAndPointerOverMesh","step","_pointerMoveStage","isMeshPicked","inputIndex","onPointerMove","hasObservers","_pickingAvailable","createPickingRay","offsetX","offsetY","_addCameraPointerObserver","_removeCameraPointerObserver","_checkForPicking","observers","onPointerPick","_checkPrePointerObservable","pi","originMesh","nearInteractionPickingInfo","onPrePointerObservable","pick","pointerMovePredicate","cameraToUseForPointers","pointerMoveTrianglePredicate","setPointerOverMesh","actionManager","_getActionManagerForTrigger","hasPointerTriggers","hoverCursor","simulatePointerMove","pointerEventInit","simulatePointerDown","_processPointerDown","_pickedDownMesh","hasPickTriggers","processTrigger","hasSpecificTrigger","Date","now","LongPressDelay","_isPointerSwiping","_pointerDownStage","onPointerDown","simulatePointerUp","doubleTap","clickInfo","_processPointerUp","_pickedUpMesh","doubleClickActionManager","_pointerUpStage","pickedDownActionManager","onPointerUp","hasSpecificMask","isPointerCaptured","attachUp","attachDown","attachMove","elementToAttachTo","detachControl","_alreadyAttachedTo","_initActionManager","act","skipPointerUpPicking","_registeredActions","pointerUpPredicate","hit","_delayedSimpleClick","btn","cb","DoubleClickDelay","_previousButtonPressed","_initClickEvent","obs1","obs2","checkPicking","needToIgnoreNext","checkSingleClickImmediately","ExclusiveDoubleClickMode","_previousDelayedSimpleClickTimeout","_delayedSimpleClickTimeout","checkDoubleClick","clearTimeout","_onPointerMove","DragMovementThreshold","skipPointerMovePicking","enablePointerMoveEvents","constantlyUpdateMeshUnderPointer","layerMask","_onPointerDown","preventDefaultOnPointerDown","focus","pointerDownPredicate","skipPointerDownPicking","_onPointerUp","preventDefaultOnPointerUp","_onKeyDown","onPreKeyboardObservable","onKeyboardObservable","_onKeyUp","onDeviceConnectedObservable","deviceSource","deviceType","onInputChangedObservable","eventData","getInput","_internalAbstractMeshDataInfo","_pointerOverDisableMeshTesting","underPointerMesh","getPointerOverMesh","_invalidateMesh","_TimeToken","_timeElapsedQueryEnded","EffectLayer","_effectLayerOptions","renderingGroupId","mainTexture","setMaterialForRendering","currentMesh","_materialForRendering","_vertexBuffers","_maxSize","_mainTextureDesiredSize","_shouldRender","_postProcesses","_emissiveTextureAndColor","neutralColor","disableBoundingBoxesFromEffectLayer","onBeforeRenderMainTextureObservable","onBeforeComposeObservable","onBeforeRenderMeshToEffect","onAfterRenderMeshToEffect","onAfterComposeObservable","onSizeChangedObservable","_SceneComponentInitialization","effectLayers","_mergeDrawWrapper","_generateIndexBuffer","_generateVertexBuffer","_numInternalDraws","_init","mainTextureRatio","alphaBlendingMode","mainTextureType","_setMainTextureSize","_createMainTexture","_createTextureAndPostProcesses","_indexBuffer","mainTextureFixedSize","updateSamplingMode","renderParticles","ignoreCameraViewport","customIsReadyFunction","refreshRate","preWarm","subMeshes","subMesh","getMaterial","renderingMesh","getRenderingMesh","hardwareInstancedRendering","_getInstancesRenderList","_id","getReplacementMesh","hasThinInstances","_setEmissiveTextureAndColor","_isReady","customRenderFunction","opaqueSubMeshes","alphaTestSubMeshes","transparentSubMeshes","depthOnlySubMeshes","_renderSubMesh","previousAlphaMode","onClearObservable","getBoundingBoxRenderer","boundingBoxRendererEnabled","onBeforeBindObservable","onAfterUnbindObservable","_addCustomEffectDefines","useInstances","emissiveTexture","getMesh","renderingMaterial","_materialForRenderPass","currentRenderPassId","isReadyForSubMesh","_useMeshMaterial","attribs","uv1","uv2","needAlphaTest","needAlphaTesting","getAlphaTestTexture","needAlphaBlendFromDiffuse","useAlphaFromDiffuseTexture","_useAlphaFromAlbedoTexture","isVerticesDataPresent","coordinatesIndex","opacityTexture","useVertexColors","hasVertexAlpha","transparencyMode","useBones","computeBonesUsingShaders","numBoneInfluencers","skeleton","isUsingTextureForMatrices","bones","addCPUSkinningFallback","manager","morphTargetManager","morphInfluencers","numInfluencers","isUsingTextureForTargets","drawWrapper","_getDrawWrapper","cachedDefines","setEffect","maxSimultaneousMorphTargets","numDraws","currentEffect","_createMergeEffect","_internalRender","_disposeTextureAndPostProcesses","hasMesh","_shouldRenderMesh","_canRenderMesh","needAlphaBlendingForMesh","_shouldRenderEmissiveTextureForMesh","enableAlphaMode","ownerMesh","replacementMesh","effectiveMesh","getEffectiveMesh","_isActiveIntermediate","overrideMaterialSideOrientation","batch","mustReturn","forcePointsCloud","forceWireframe","_bind","bindForSubMesh","setMatrix","getTransformMatrix","textureMatrix","getTextureMatrix","boneTexture","getTransformMatrixTexture","getTransformMatrices","_processRendering","isInstance","world","resetRefreshCounter","vb","parsedEffectLayer","customType","Parse","_","parsedData","container","effectLayer","toRemove","newEffectLayer","EffectLayerSceneComponent","_renderEffects","_needStencil","_previousStencilState","_isReadyForMeshStage","_isReadyForMesh","_cameraDrawRenderTargetStage","_renderMainTexture","_beforeCameraDrawStage","_afterRenderingGroupDrawStage","_drawRenderingGroup","_afterCameraDrawStage","_setStencilBack","_drawCamera","serialize","serializationObject","addFromContainer","o","addEffectLayer","removeFromContainer","removeEffectLayer","renderPassId","needRebind","cameraRigMode","_rigCameras","needStencil","incrementRenderId","_isInIntermediateRendering","getEffectName","GlowLayer","EffectName","blurKernelSize","effectiveKernel","_getEffectiveBlurKernelSize","_horizontalBlurPostprocess1","kernel","_verticalBlurPostprocess1","_horizontalBlurPostprocess2","_verticalBlurPostprocess2","intensity","_intensity","_includedOnlyMeshes","_excludedMeshes","_meshesUsingTheirOwnMaterials","DefaultTextureRatio","mainTextureSamples","ldrMerge","blurTextureWidth","blurTextureHeight","_blurTexture1","blurTextureWidth2","blurTextureHeight2","_blurTexture2","externalTextureSamplerBinding","onApplyObservable","_postProcesses1","_postProcesses2","postProcessManager","directRender","internalTexture2","pp","autoClear","previousStencilBuffer","textureLevel","customEmissiveTextureSelector","customEmissiveColorSelector","emissiveIntensity","addExcludedMesh","removeExcludedMesh","addIncludedOnlyMesh","removeIncludedOnlyMesh","referenceMeshToUseItsOwnMaterial","resetDrawCache","_disposeMesh","unReferenceMeshFromUsingItsOwnMaterial","includedMeshes","getMeshByUniqueId","excludedMeshes","parsedGlowLayer","getMeshById","DefaultBlurKernelSize","HighlightLayer","GlowBlurPostProcess","reusable","setVector2","blurHorizontalSize","_horizontalBlurPostprocess","blurVerticalSize","_verticalBlurPostprocess","innerGlow","outerGlow","onBeforeBlurObservable","onAfterBlurObservable","_instanceGlowingMeshStencilReference","GlowingMeshStencilReference","_meshes","NeutralColor","blurTextureSizeRatio","isStroke","_blurTexture","_downSamplePostprocess","highlightLayerMesh","glowEmissiveOnly","renderIndex","cacheStencilState","restoreStencilState","beforeBind","afterRender","meshExcluded","addMesh","meshHighlight","observerHighlight","_defaultStencilReference","observerDefault","removeMesh","meshHighlightToCheck","removeAllMeshes","NormalMeshStencilReference","asArray","meshId","excludedMesh","parsedHightlightLayer","hl","highlightedMesh","Layer","applyPostProcess","_applyPostProcess","isBackground","onDispose","_onDisposeObserver","onBeforeRender","_onBeforeRenderObserver","onAfterRender","_onAfterRenderObserver","imgUrl","renderTargetTextures","renderOnlyInRenderTargetTextures","layerComponent","_drawWrapper","_createIndexBuffer","alphaTest","_previousDefines","LayerSceneComponent","_drawCameraBackground","_drawCameraForegroundWithPostProcessing","_afterCameraPostProcessStage","_drawCameraForegroundWithoutPostProcessing","_beforeRenderTargetDrawStage","_drawRenderTargetBackground","_afterRenderTargetDrawStage","_drawRenderTargetForegroundWithPostProcessing","_afterRenderTargetPostProcessStage","_drawRenderTargetForegroundWithoutPostProcessing","predicate","_drawCameraPredicate","cameraLayerMask","_drawRenderTargetPredicate","renderTargetTexture"],"sourceRoot":""}